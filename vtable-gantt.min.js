!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).VTableGantt={})}(this,(function(t){"use strict";var e,i,o;!function(t){t.default="default",t.grabing="grabing",t.scrolling="scrolling"}(e||(e={})),function(t){t.FinishToStart="finish_to_start",t.StartToStart="start_to_start",t.FinishToFinish="finish_to_finish",t.StartToFinish="start_to_finish"}(i||(i={})),function(t){t.Tasks_Separate="tasks_separate",t.Sub_Tasks_Inline="sub_tasks_inline",t.Sub_Tasks_Separate="sub_tasks_separate",t.Sub_Tasks_Arrange="sub_tasks_arrange",t.Sub_Tasks_Compact="sub_tasks_compact"}(o||(o={}));const n={SCROLL:"scroll",CHANGE_DATE_RANGE:"change_date_range",CLICK_TASK_BAR:"click_task_bar",CONTEXTMENU_TASK_BAR:"contextmenu_task_bar",MOUSEENTER_TASK_BAR:"mouseenter_task_bar",MOUSELEAVE_TASK_BAR:"mouseleave_task_bar",CREATE_TASK_SCHEDULE:"create_task_schedule",CREATE_DEPENDENCY_LINK:"create_dependency_link",DELETE_DEPENDENCY_LINK:"delete_dependency_link",CLICK_DEPENDENCY_LINK_POINT:"click_dependency_link_point",CONTEXTMENU_DEPENDENCY_LINK:"contextmenu_dependency_link",CLICK_MARKLINE_CREATE:"click_markline_create",CLICK_MARKLINE_CONTENT:"click_markline_content"};var r=Object.freeze({__proto__:null,get DependencyType(){return i},GANTT_EVENT_TYPE:n,get InteractionState(){return e},get TasksShowMode(){return o}});class s{static GenAutoIncrementId(){return s.auto_increment_id++}}s.auto_increment_id=0;class a{constructor(t){this.id=s.GenAutoIncrementId(),this.registry=t}}const l="named",h="inject",d="multi_inject",c="inversify:tagged",u="inversify:paramtypes";class g{constructor(t,e){this.key=t,this.value=e}toString(){return this.key===l?`named: ${String(this.value).toString()} `:`tagged: { key:${this.key.toString()}, value: ${String(this.value)} }`}}var p=function(t){var e;return function(t){const e="function"==typeof Symbol&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=Object.getPrototypeOf(Function),o=("object"==typeof process&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL,Map),n=new WeakMap;function r(t,e,i){let r=n.get(t);if(h(r)){if(!i)return;r=new o,n.set(t,r)}let s=r.get(e);if(h(s)){if(!i)return;s=new o,r.set(e,s)}return s}function s(t,e,i){if(a(t,e,i))return!0;const o=f(e);return!d(o)&&s(t,o,i)}function a(t,e,i){const o=r(e,i,!1);return!h(o)&&!!o.has(t)}function l(t,e,i){if(a(t,e,i))return function(t,e,i){const o=r(e,i,!1);if(!h(o))return o.get(t)}(t,e,i);const o=f(e);return d(o)?void 0:l(t,o,i)}function h(t){return void 0===t}function d(t){return null===t}function c(t){return"object"==typeof t?null!==t:"function"==typeof t}function u(t,i){switch(function(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}const o=3===i?"string":5===i?"number":"default",n=function(t,e){const i=t[e];if(null!=i){if(!p(i))throw new TypeError;return i}}(t,e);if(void 0!==n){const e=n.call(t,o);if(c(e))throw new TypeError;return e}return function(t,e){if("string"===e){const e=t.toString;if(p(e)){const i=e.call(t);if(!c(i))return i}const i=t.valueOf;if(p(i)){const e=i.call(t);if(!c(e))return e}}else{const e=t.valueOf;if(p(e)){const i=e.call(t);if(!c(i))return i}const i=t.toString;if(p(i)){const e=i.call(t);if(!c(e))return e}}throw new TypeError}(t,"default"===o?"number":o)}function g(t){const e=u(t,3);return"symbol"==typeof e?e:function(t){return""+t}(e)}function p(t){return"function"==typeof t}function f(t){const e=Object.getPrototypeOf(t);if("function"!=typeof t||t===i)return e;if(e!==i)return e;const o=t.prototype,n=o&&Object.getPrototypeOf(o);if(null==n||n===Object.prototype)return e;const r=n.constructor;return"function"!=typeof r||r===t?e:r}t("defineMetadata",(function(t,e,i,o){if(!c(i))throw new TypeError;return n=t,s=e,void r(i,o,!0).set(n,s);var n,s})),t("hasMetadata",(function(t,e,i){if(!c(e))throw new TypeError;return h(i)||(i=g(i)),s(t,e,i)})),t("hasOwnMetadata",(function(t,e,i){if(!c(e))throw new TypeError;return h(i)||(i=g(i)),a(t,e,i)})),t("getMetadata",(function(t,e,i){if(!c(e))throw new TypeError;return h(i)||(i=g(i)),l(t,e,i)}))}((e=t,function(t,i){"function"!=typeof e[t]&&Object.defineProperty(e,t,{configurable:!0,writable:!0,value:i})})),t}({});function f(t,e,i,o){!function(t,e,i,o){const n=[o];let r={};p.hasOwnMetadata(t,e)&&(r=p.getMetadata(t,e));let s=r[i];void 0===s&&(s=[]),s.push(...n),r[i]=s,p.defineMetadata(t,r,e)}(c,t,i.toString(),o)}function v(t){return(e,i,o)=>{f(e,0,o,t)}}function b(t){return e=>(i,o,n)=>v(new g(t,e))(i,o,n)}const m=b(h),y=b(d);function C(){return function(t){return p.defineMetadata(u,null,t),t}}function w(t){return v(new g(l,t))}const x="Singleton",_="Transient",S="ConstantValue",A="DynamicValue",B="Factory",R="Function",T="Instance",k="Invalid";class M{constructor(t,e){this.id=s.GenAutoIncrementId(),this.activated=!1,this.serviceIdentifier=t,this.scope=e,this.type=k,this.constraint=t=>!0,this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.dynamicValue=null}clone(){const t=new M(this.serviceIdentifier,this.scope);return t.activated=t.scope===x&&this.activated,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.provider=this.provider,t.constraint=this.constraint,t.cache=this.cache,t}}class L{getConstructorMetadata(t){return{compilerGeneratedMetadata:p.getMetadata(u,t),userGeneratedMetadata:p.getMetadata(c,t)||{}}}getPropertiesMetadata(t){throw new Error("暂未实现")}}const P=(E=l,t=>{const e=e=>{if(null==e)return!1;if(e.key===E&&e.value===t)return!0;if(null==e.constructorArgsMetadata)return!1;const i=e.constructorArgsMetadata;for(let e=0;e<i.length;e++)if(i[e].key===E&&i[e].value===t)return!0;return!1};return e.metaData=new g(E,t),e});var E;class H{constructor(t){this._binding=t}inRequestScope(){throw new Error("暂未实现")}inSingletonScope(){return this._binding.scope=x,this}inTransientScope(){return this._binding.scope=_,this}whenTargetNamed(t){return this._binding.constraint=P(t),this}}class F{constructor(t){this._binding=t}to(t){return this._binding.type=T,this._binding.implementationType=t,new H(this._binding)}toSelf(){const t=this._binding.serviceIdentifier;return this.to(t)}toDynamicValue(t){return this._binding.type=A,this._binding.cache=null,this._binding.dynamicValue=t,this._binding.implementationType=null,new H(this._binding)}toConstantValue(t){return this._binding.type=S,this._binding.cache=t,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=x,new H(this._binding)}toFactory(t){return this._binding.type=B,this._binding.factory=t,this._binding.scope=x,new H(this._binding)}toService(t){this.toDynamicValue((e=>e.container.get(t)))}}const O=Symbol("ContributionProvider");class I{constructor(t,e){this.serviceIdentifier=t,this.container=e}getContributions(){return this.caches||(this.caches=[],this.container&&this.container.isBound(this.serviceIdentifier)&&this.caches.push(...this.container.getAll(this.serviceIdentifier))),this.caches}}function z(t,e){t(O).toDynamicValue((t=>{let{container:i}=t;return new I(e,i)})).inSingletonScope().whenTargetNamed(e)}class D{constructor(t,e){this._args=t,this.name=e,this.taps=[]}tap(t,e){this._tap("sync",t,e)}unTap(t,e){const i="string"==typeof t?t.trim():t.name;i&&(this.taps=this.taps.filter((t=>!(t.name===i&&(!e||t.fn===e)))))}_parseOptions(t,e,i){let o;if("string"==typeof e)o={name:e.trim()};else if("object"!=typeof e||null===e)throw new Error("Invalid tap options");if("string"!=typeof o.name||""===o.name)throw new Error("Missing name for tap");return o=Object.assign({type:t,fn:i},o),o}_tap(t,e,i){this._insert(this._parseOptions(t,e,i))}_insert(t){let e;"string"==typeof t.before?e=new Set([t.before]):Array.isArray(t.before)&&(e=new Set(t.before));let i=0;"number"==typeof t.stage&&(i=t.stage);let o=this.taps.length;for(;o>0;){o--;const t=this.taps[o];this.taps[o+1]=t;const n=t.stage||0;if(e){if(e.has(t.name)){e.delete(t.name);continue}if(e.size>0)continue}if(!(n>i)){o++;break}}this.taps[o]=t}}class W extends D{call(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this.taps.map((t=>t.fn)).forEach((t=>t(...e)))}}const N=Symbol.for("EnvContribution"),G=Symbol.for("VGlobal");var j=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},V=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},U=function(t,e){return function(i,o){e(i,o,t)}},$=function(t,e,i,o){return new(i||(i=Promise))((function(n,r){function s(t){try{l(o.next(t))}catch(t){r(t)}}function a(t){try{l(o.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((o=o.apply(t,e||[])).next())}))};let X=class{get env(){return this._env}get isImageAnonymous(){return this._isImageAnonymous}set isImageAnonymous(t){this._isImageAnonymous=t}get devicePixelRatio(){return this._env||this.setEnv("browser"),this.envContribution.getDevicePixelRatio()}get supportEvent(){return this._env||this.setEnv("browser"),this.envContribution.supportEvent}set supportEvent(t){this._env||this.setEnv("browser"),this.envContribution.supportEvent=t}get supportsTouchEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsTouchEvents}set supportsTouchEvents(t){this._env||this.setEnv("browser"),this.envContribution.supportsTouchEvents=t}get supportsPointerEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsPointerEvents}set supportsPointerEvents(t){this._env||this.setEnv("browser"),this.envContribution.supportsPointerEvents=t}get supportsMouseEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsMouseEvents}set supportsMouseEvents(t){this._env||this.setEnv("browser"),this.envContribution.supportsMouseEvents=t}get applyStyles(){return this._env||this.setEnv("browser"),this.envContribution.applyStyles}set applyStyles(t){this._env||this.setEnv("browser"),this.envContribution.applyStyles=t}constructor(t){this.contributions=t,this._isImageAnonymous=!0,this.id=s.GenAutoIncrementId(),this.hooks={onSetEnv:new W(["lastEnv","env","global"])},this.measureTextMethod="native",this.optimizeVisible=!1}bindContribution(t){const e=[];if(this.contributions.getContributions().forEach((i=>{const o=i.configure(this,t);o&&o.then&&e.push(o)})),e.length)return Promise.all(e)}getDynamicCanvasCount(){return this._env||this.setEnv("browser"),this.envContribution.getDynamicCanvasCount()}getStaticCanvasCount(){return this._env||this.setEnv("browser"),this.envContribution.getStaticCanvasCount()}setEnv(t,e){if(e&&!0===e.force||this._env!==t)return this.deactiveCurrentEnv(),this.activeEnv(t,e)}deactiveCurrentEnv(){this.envContribution&&this.envContribution.release()}activeEnv(t,e){const i=this._env;this._env=t;const o=this.bindContribution(e);if(o&&o.then)return o.then((()=>{this.envParams=e,this.hooks.onSetEnv.call(i,t,this)}));this.envParams=e,this.hooks.onSetEnv.call(i,t,this)}setActiveEnvContribution(t){this.envContribution=t}createCanvas(t){return this._env||this.setEnv("browser"),this.envContribution.createCanvas(t)}createOffscreenCanvas(t){return this._env||this.setEnv("browser"),this.envContribution.createOffscreenCanvas(t)}releaseCanvas(t){return this._env||this.setEnv("browser"),this.envContribution.releaseCanvas(t)}addEventListener(t,e,i){return this._env||this.setEnv("browser"),this.envContribution.addEventListener(t,e,i)}removeEventListener(t,e,i){return this._env||this.setEnv("browser"),this.envContribution.removeEventListener(t,e,i)}dispatchEvent(t){return this._env||this.setEnv("browser"),this.envContribution.dispatchEvent(t)}getRequestAnimationFrame(){return this._env||this.setEnv("browser"),this.envContribution.getRequestAnimationFrame()}getCancelAnimationFrame(){return this._env||this.setEnv("browser"),this.envContribution.getCancelAnimationFrame()}getElementById(t){return this._env||this.setEnv("browser"),this.envContribution.getElementById?this.envContribution.getElementById(t):null}getRootElement(){return this._env||this.setEnv("browser"),this.envContribution.getRootElement?this.envContribution.getRootElement():null}getDocument(){return this._env||this.setEnv("browser"),this.envContribution.getDocument?this.envContribution.getDocument():null}mapToCanvasPoint(t,e){return this._env||this.setEnv("browser"),this.envContribution.mapToCanvasPoint?this.envContribution.mapToCanvasPoint(t,e):null}loadImage(t){return this._env||this.setEnv("browser"),this.envContribution.loadImage(t)}loadSvg(t){return this._env||this.setEnv("browser"),this.envContribution.loadSvg(t)}loadJson(t){return this._env||this.setEnv("browser"),this.envContribution.loadJson(t)}loadArrayBuffer(t){return this._env||this.setEnv("browser"),this.envContribution.loadArrayBuffer(t)}loadBlob(t){return this._env||this.setEnv("browser"),this.envContribution.loadBlob(t)}loadFont(t,e,i){return $(this,void 0,void 0,(function*(){return this._env||this.setEnv("browser"),this.envContribution.loadFont(t,e,i)}))}isChrome(){return null!=this._isChrome||(this._env||this.setEnv("browser"),this._isChrome="browser"===this._env&&navigator.userAgent.indexOf("Chrome")>-1),this._isChrome}isSafari(){return null!=this._isSafari||(this._env||this.setEnv("browser"),this._isSafari="browser"===this._env&&/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)),this._isSafari}getNativeAABBBounds(t){return this._env||this.setEnv("browser"),this.envContribution.getNativeAABBBounds(t)}removeDom(t){return this._env||this.setEnv("browser"),this.envContribution.removeDom(t)}createDom(t){return this._env||this.setEnv("browser"),this.envContribution.createDom(t)}updateDom(t,e){return this._env||this.setEnv("browser"),this.envContribution.updateDom(t,e)}getElementTop(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._env||this.setEnv("browser"),this.envContribution.getElementTop(t,e)}getElementLeft(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._env||this.setEnv("browser"),this.envContribution.getElementLeft(t,e)}getElementTopLeft(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._env||this.setEnv("browser"),this.envContribution.getElementTopLeft(t,e)}};var Y;X=j([C(),U(0,m(O)),U(0,w(N)),V("design:paramtypes",[Object])],X),function(t){t[t.estimate=0]="estimate",t[t.actualBounding=1]="actualBounding",t[t.fontBounding=2]="fontBounding"}(Y||(Y={}));var K="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function q(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Z={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,i="~";function o(){}function n(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function r(t,e,o,r,s){if("function"!=typeof o)throw new TypeError("The listener must be a function");var a=new n(o,r||t,s),l=i?i+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],a]:t._events[l].push(a):(t._events[l]=a,t._eventsCount++),t}function s(t,e){0==--t._eventsCount?t._events=new o:delete t._events[e]}function a(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),a.prototype.eventNames=function(){var t,o,n=[];if(0===this._eventsCount)return n;for(o in t=this._events)e.call(t,o)&&n.push(i?o.slice(1):o);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},a.prototype.listeners=function(t){var e=i?i+t:t,o=this._events[e];if(!o)return[];if(o.fn)return[o.fn];for(var n=0,r=o.length,s=new Array(r);n<r;n++)s[n]=o[n].fn;return s},a.prototype.listenerCount=function(t){var e=i?i+t:t,o=this._events[e];return o?o.fn?1:o.length:0},a.prototype.emit=function(t,e,o,n,r,s){var a=i?i+t:t;if(!this._events[a])return!1;var l,h,d=this._events[a],c=arguments.length;if(d.fn){switch(d.once&&this.removeListener(t,d.fn,void 0,!0),c){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,e),!0;case 3:return d.fn.call(d.context,e,o),!0;case 4:return d.fn.call(d.context,e,o,n),!0;case 5:return d.fn.call(d.context,e,o,n,r),!0;case 6:return d.fn.call(d.context,e,o,n,r,s),!0}for(h=1,l=new Array(c-1);h<c;h++)l[h-1]=arguments[h];d.fn.apply(d.context,l)}else{var u,g=d.length;for(h=0;h<g;h++)switch(d[h].once&&this.removeListener(t,d[h].fn,void 0,!0),c){case 1:d[h].fn.call(d[h].context);break;case 2:d[h].fn.call(d[h].context,e);break;case 3:d[h].fn.call(d[h].context,e,o);break;case 4:d[h].fn.call(d[h].context,e,o,n);break;default:if(!l)for(u=1,l=new Array(c-1);u<c;u++)l[u-1]=arguments[u];d[h].fn.apply(d[h].context,l)}}return!0},a.prototype.on=function(t,e,i){return r(this,t,e,i,!1)},a.prototype.once=function(t,e,i){return r(this,t,e,i,!0)},a.prototype.removeListener=function(t,e,o,n){var r=i?i+t:t;if(!this._events[r])return this;if(!e)return s(this,r),this;var a=this._events[r];if(a.fn)a.fn!==e||n&&!a.once||o&&a.context!==o||s(this,r);else{for(var l=0,h=[],d=a.length;l<d;l++)(a[l].fn!==e||n&&!a[l].once||o&&a[l].context!==o)&&h.push(a[l]);h.length?this._events[r]=1===h.length?h[0]:h:s(this,r)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&s(this,e)):(this._events=new o,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,t.exports=a}(Z);var J=q(Z.exports);var Q=(t,e)=>Object.prototype.toString.call(t)===`[object ${e}]`;var tt=function(t){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"boolean"==typeof t:!0===t||!1===t||Q(t,"Boolean")};var et=t=>"function"==typeof t;var it=t=>null==t;var ot=t=>null!=t;var nt=t=>{const e=typeof t;return null!==t&&"object"===e||"function"===e};var rt=t=>"object"==typeof t&&null!==t;var st=function(t){if(!rt(t)||!Q(t,"Object"))return!1;if(null===Object.getPrototypeOf(t))return!0;let e=t;for(;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e};var at=t=>void 0===t;var lt=function(t){const e=typeof t;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"string"===e:"string"===e||Q(t,"String")};var ht=t=>Array.isArray?Array.isArray(t):Q(t,"Array");var dt=function(t){return null!==t&&"function"!=typeof t&&Number.isFinite(t.length)};var ct=t=>Q(t,"Date");var ut=function(t){const e=typeof t;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"number"===e:"number"===e||Q(t,"Number")};var gt=t=>ut(t)&&Number.isFinite(t);var pt=t=>new RegExp(/^(http(s)?:\/\/)\w+[^\s]+(\.[^\s]+){1,}$/).test(t);var ft=t=>new RegExp(/^data:image\/(?:gif|png|jpeg|bmp|webp|svg\+xml)(?:;charset=utf-8)?;base64,(?:[A-Za-z0-9]|[+/])+={0,2}/g).test(t);var vt=t=>({}.toString.call(t).replace(/^\[object /,"").replace(/]$/,""));const bt=Object.prototype;var mt=function(t){const e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||bt)};const yt=Object.prototype.hasOwnProperty;function Ct(t){if(it(t))return!0;if(dt(t))return!t.length;const e=vt(t);if("Map"===e||"Set"===e)return!t.size;if(mt(t))return!Object.keys(t).length;for(const e in t)if(yt.call(t,e))return!1;return!0}var wt=(t,e,i)=>{const o=lt(e)?e.split("."):e;for(let e=0;e<o.length;e++)t=t?t[o[e]]:void 0;return void 0===t?i:t};const xt=Object.prototype.hasOwnProperty;var _t=(t,e)=>null!=t&&xt.call(t,e);function St(t,e,i){let o;if(!ot(t)||"object"!=typeof t||e&&e(t))return t;const n=ht(t),r=t.length;o=n?new Array(r):"object"==typeof t?{}:tt(t)||ut(t)||lt(t)?t:ct(t)?new Date(+t):void 0;const s=n?void 0:Object.keys(Object(t));let a=-1;if(o)for(;++a<(s||t).length;){const n=s?s[a]:a,r=t[n];i&&i.includes(n.toString())?o[n]=r:o[n]=St(r,e,i)}return o}function At(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e){if(t===e)return;if(ot(e)&&"object"==typeof e){const n=Object(e),r=[];for(const t in n)r.push(t);let{length:s}=r,a=-1;for(;s--;){const s=r[++a];!ot(n[s])||"object"!=typeof n[s]||o&&ht(t[s])?Rt(t,s,n[s]):Bt(t,e,s,i,o)}}}}function Bt(t,e,i){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const r=t[i],s=e[i];let a=e[i],l=!0;if(ht(s)){if(o)a=[];else if(ht(r))a=r;else if(dt(r)){a=new Array(r.length);let t=-1;const e=r.length;for(;++t<e;)a[t]=r[t]}}else st(s)?(a=null!=r?r:{},"function"!=typeof r&&"object"==typeof r||(a={})):l=!1;l&&At(a,s,o,n),Rt(t,i,a)}function Rt(t,e,i){(void 0!==i&&!function(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}(t[e],i)||void 0===i&&!(e in t))&&(t[e]=i)}function Tt(t){let e=-1;const i=arguments.length<=1?0:arguments.length-1;for(;++e<i;)At(t,e+1<1||arguments.length<=e+1?void 0:arguments[e+1],!0);return t}function kt(t){return Object.prototype.toString.call(t)}function Mt(t){return Object.keys(t)}function Lt(t,e,i){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(null==t||null==e)return!1;if(Number.isNaN(t)&&Number.isNaN(e))return!0;if(kt(t)!==kt(e))return!1;if(et(t))return!!(null==i?void 0:i.skipFunction);if("object"!=typeof t)return!1;if(ht(t)){if(t.length!==e.length)return!1;for(let o=t.length-1;o>=0;o--)if(!Lt(t[o],e[o],i))return!1;return!0}if(!st(t))return!1;const o=Mt(t),n=Mt(e);if(o.length!==n.length)return!1;o.sort(),n.sort();for(let t=o.length-1;t>=0;t--)if(o[t]!=n[t])return!1;for(let n=o.length-1;n>=0;n--){const r=o[n];if(!Lt(t[r],e[r],i))return!1}return!0}function Pt(t,e,i){const o=function(t){if(!t)return[];if(Object.keys)return Object.keys(t);const e=[];for(const i in t)t.hasOwnProperty(i)&&e.push(i);return e}(e);for(let n=0;n<o.length;n++){const r=o[n];(i?null!=e[r]:null==t[r])&&(t[r]=e[r])}return t}function Et(t){return ot(t)?ht(t)?t:[t]:[]}function Ht(t){if(dt(t))return t[t.length-1]}const Ft=(t,e)=>{var i;if(0===t.length)return;let o=t[0];for(let n=1;n<t.length;n++){const r=t[n];(null!==(i=null==e?void 0:e(r,o))&&void 0!==i?i:r-o)>0&&(o=r)}return o},Ot=(t,e)=>{var i;if(0===t.length)return;let o=t[0];for(let n=1;n<t.length;n++){const r=t[n];(null!==(i=null==e?void 0:e(r,o))&&void 0!==i?i:r-o)<0&&(o=r)}return o};function It(t,e){if(!ht(t)||!ht(e))return!1;if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function zt(t){if(!ht(t))return[t];const e=[];for(const i of t)e.push(...zt(i));return e}function Dt(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Wt(t){return Number(t)}const Nt="undefined"!=typeof console;function Gt(t,e,i){const o=[e].concat([].slice.call(i));Nt&&console[t].apply(console,o)}var jt;!function(t){t[t.None=0]="None",t[t.Error=1]="Error",t[t.Warn=2]="Warn",t[t.Info=3]="Info",t[t.Debug=4]="Debug"}(jt||(jt={}));let Vt=class t{static getInstance(e,i){return t._instance&&ut(e)?t._instance.level(e):t._instance||(t._instance=new t(e,i)),t._instance}static setInstance(e){return t._instance=e}static setInstanceLevel(e){t._instance?t._instance.level(e):t._instance=new t(e)}static clearInstance(){t._instance=null}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:jt.None,e=arguments.length>1?arguments[1]:void 0;this._onErrorHandler=[],this._level=t,this._method=e}addErrorHandler(t){this._onErrorHandler.find((e=>e===t))||this._onErrorHandler.push(t)}removeErrorHandler(t){const e=this._onErrorHandler.findIndex((e=>e===t));e<0||this._onErrorHandler.splice(e,1)}callErrorHandler(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this._onErrorHandler.forEach((t=>t(...e)))}canLogInfo(){return this._level>=jt.Info}canLogDebug(){return this._level>=jt.Debug}canLogError(){return this._level>=jt.Error}canLogWarn(){return this._level>=jt.Warn}level(t){return arguments.length?(this._level=+t,this):this._level}error(){for(var t,e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return this._level>=jt.Error&&(this._onErrorHandler.length?this.callErrorHandler(...i):Gt(null!==(t=this._method)&&void 0!==t?t:"error","ERROR",i)),this}warn(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this._level>=jt.Warn&&Gt(this._method||"warn","WARN",e),this}info(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this._level>=jt.Info&&Gt(this._method||"log","INFO",e),this}debug(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this._level>=jt.Debug&&Gt(this._method||"log","DEBUG",e),this}};Vt._instance=null;function Ut(t,e){const i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-10,o=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-10)*Math.max(t,e);return Math.abs(t-e)<=Math.max(i,o)}const $t=t=>{let e=null,i=null;return function(){for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];return e&&n.every(((t,i)=>t===e[i]))||(e=n,i=t(...n)),i}};var Xt=function(t,e,i){return t<e?e:t>i?i:t};var Yt=(t,e,i)=>{let[o,n]=t;n<o&&(o=t[1],n=t[0]);const r=n-o;return r>=i-e?[e,i]:(o=Math.min(Math.max(o,e),i-r),[o,o+r])};let Kt=!1;try{Kt="function"==typeof requestAnimationFrame&&"function"==typeof cancelAnimationFrame}catch(t){Kt=!1}function qt(t,e,i){let o,n,r,s,a,l,h=0,d=!1,c=!1,u=!0;const g=!e&&0!==e&&Kt;if("function"!=typeof t)throw new TypeError("Expected a function");function p(e){const i=o,r=n;return o=n=void 0,h=e,s=t.apply(r,i),s}function f(t,e){return g?(cancelAnimationFrame(a),requestAnimationFrame(t)):setTimeout(t,e)}function v(t){const i=t-l;return void 0===l||i>=e||i<0||c&&t-h>=r}function b(){const t=Date.now();if(v(t))return m(t);a=f(b,function(t){const i=t-h,o=e-(t-l);return c?Math.min(o,r-i):o}(t))}function m(t){return a=void 0,u&&o?p(t):(o=n=void 0,s)}function y(){const t=Date.now(),i=v(t);for(var r=arguments.length,u=new Array(r),g=0;g<r;g++)u[g]=arguments[g];if(o=u,n=this,l=t,i){if(void 0===a)return function(t){return h=t,a=f(b,e),d?p(t):s}(l);if(c)return a=f(b,e),p(l)}return void 0===a&&(a=f(b,e)),s}return e=+e||0,nt(i)&&(d=!!i.leading,c="maxWait"in i,c&&(r=Math.max(gt(i.maxWait)?i.maxWait:0,e)),u="trailing"in i?!!i.trailing:u),y.cancel=function(){void 0!==a&&function(t){if(g)return cancelAnimationFrame(t);clearTimeout(t)}(a),h=0,o=l=n=a=void 0},y.flush=function(){return void 0===a?s:m(Date.now())},y.pending=function(){return void 0!==a},y}function Zt(t,e,i){let o=!0,n=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return nt(i)&&(o="leading"in i?!!i.leading:o,n="trailing"in i?!!i.trailing:n),qt(t,e,{leading:o,trailing:n,maxWait:e})}function Jt(t,e){return i=>t*(1-i)+e*i}function Qt(t,e){return function(i){return Math.round(t*(1-i)+e*i)}}Kt=!1;const te=1e-12,ee=Math.PI,ie=ee/2,oe=2*ee,ne=2*Math.PI,re=Math.abs,se=Math.atan2,ae=Math.cos,le=Math.max,he=Math.min,de=Math.sin,ce=Math.sqrt,ue=Math.pow;function ge(t){return t>=1?ie:t<=-1?-ie:Math.asin(t)}function pe(t,e,i,o,n){let r=i,s=o;return"number"==typeof t&&"number"==typeof i&&(r=(1-n)*t+n*i),"number"==typeof e&&"number"==typeof o&&(s=(1-n)*e+n*o),{x:r,y:s}}class fe{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0;this.x=0,this.y=0,this.x=t,this.y=e,this.x1=i,this.y1=o}clone(){return new fe(this.x,this.y)}copyFrom(t){return this.x=t.x,this.y=t.y,this.x1=t.x1,this.y1=t.y1,this.defined=t.defined,this.context=t.context,this}set(t,e){return this.x=t,this.y=e,this}add(t){return ut(t)?(this.x+=t,void(this.y+=t)):(this.x+=t.x,this.y+=t.y,this)}sub(t){return ut(t)?(this.x-=t,void(this.y-=t)):(this.x-=t.x,this.y-=t.y,this)}multi(t){throw new Error("暂不支持")}div(t){throw new Error("暂不支持")}}class ve{static distancePP(t,e){return ce(ue(t.x-e.x,2)+ue(t.y-e.y,2))}static distanceNN(t,e,i,o){return ce(ue(t-i,2)+ue(e-o,2))}static distancePN(t,e,i){return ce(ue(e-t.x,2)+ue(i-t.y,2))}static pointAtPP(t,e,i){return new fe((e.x-t.x)*i+t.x,(e.y-t.y)*i+t.y)}}function be(t){return t*(Math.PI/180)}const me=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(t<0)for(;t<-oe;)t+=oe;else if(t>0)for(;t>oe;)t-=oe;return t};function ye(t){for(;t<0;)t+=2*Math.PI;for(;t>=2*Math.PI;)t-=2*Math.PI;return t}function Ce(t,e,i){if(null===t)return e;if(null===e)return t;const{x11:o,x12:n,y11:r,y12:s,x21:a,x22:l,y21:h,y22:d}=xe(t,e,i);return o>=l||n<=a||r>=d||s<=h?{x1:0,y1:0,x2:0,y2:0}:{x1:Math.max(o,a),y1:Math.max(r,h),x2:Math.min(n,l),y2:Math.min(s,d)}}var we;!function(t){t[t.NONE=0]="NONE",t[t.BBOX1=1]="BBOX1",t[t.BBOX2=2]="BBOX2"}(we||(we={}));const xe=(t,e,i)=>{let o=t.x1,n=t.x2,r=t.y1,s=t.y2,a=e.x1,l=e.x2,h=e.y1,d=e.y2;return i&&(o>n&&([o,n]=[n,o]),r>s&&([r,s]=[s,r]),a>l&&([a,l]=[l,a]),h>d&&([h,d]=[d,h])),{x11:o,x12:n,y11:r,y12:s,x21:a,x22:l,y21:h,y22:d}};function _e(t,e,i){if(!t||!e)return we.NONE;const{x11:o,x12:n,y11:r,y12:s,x21:a,x22:l,y21:h,y22:d}=xe(t,e,i);return o>a&&n<l&&r>h&&s<d?we.BBOX1:a>o&&l<n&&h>r&&d<s?we.BBOX2:we.NONE}function Se(t,e,i){if(t&&e){if(!i)return!(t.x1>e.x2||t.x2<e.x1||t.y1>e.y2||t.y2<e.y1);const{x11:o,x12:n,y11:r,y12:s,x21:a,x22:l,y21:h,y22:d}=xe(t,e,!0);return!(o>l||n<a||r>d||s<h)}return!0}function Ae(t,e){return Math.abs(e[0]*t[0]+e[1]*t[1])}function Be(t,e){let{x:i,y:o}=t,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:0,y:0};return{x:(i-n.x)*Math.cos(e)-(o-n.y)*Math.sin(e)+n.x,y:(i-n.x)*Math.sin(e)+(o-n.y)*Math.cos(e)+n.y}}function Re(t){return{x:(t.x1+t.x2)/2,y:(t.y1+t.y2)/2}}function Te(t,e){const i=e?be(t.angle):t.angle,o=Re(t);return[Be({x:t.x1,y:t.y1},i,o),Be({x:t.x2,y:t.y1},i,o),Be({x:t.x2,y:t.y2},i,o),Be({x:t.x1,y:t.y2},i,o)]}function ke(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=Te(t,i),n=Te(e,i),r=(t,e)=>[e.x-t.x,e.y-t.y],s=r(Re(t),Re(e)),a=r(o[0],o[1]),l=r(o[1],o[2]),h=r(n[0],n[1]),d=r(n[1],n[2]),c=i?be(t.angle):t.angle;let u=i?be(90-t.angle):t.angle+ie;const g=i?be(e.angle):e.angle;let p=i?be(90-e.angle):e.angle+ie;u>ne&&(u-=ne),p>ne&&(p-=ne);const f=(t,e,i,o)=>{const n=[Math.cos(e),Math.sin(e)];return t+(Ae(n,i)+Ae(n,o))/2>Ae(n,s)};return f((t.x2-t.x1)/2,c,h,d)&&f((t.y2-t.y1)/2,u,h,d)&&f((e.x2-e.x1)/2,g,a,l)&&f((e.y2-e.y1)/2,p,a,l)}const Me=t=>{let e=t.charCodeAt(0),i=2===t.length?t.charCodeAt(1):0,o=e;return 55296<=e&&e<=56319&&56320<=i&&i<=57343&&(e&=1023,i&=1023,o=e<<10|i,o+=65536),12288===o||65281<=o&&o<=65376||65504<=o&&o<=65510?"F":8361===o||65377<=o&&o<=65470||65474<=o&&o<=65479||65482<=o&&o<=65487||65490<=o&&o<=65495||65498<=o&&o<=65500||65512<=o&&o<=65518?"H":4352<=o&&o<=4447||4515<=o&&o<=4519||4602<=o&&o<=4607||9001<=o&&o<=9002||11904<=o&&o<=11929||11931<=o&&o<=12019||12032<=o&&o<=12245||12272<=o&&o<=12283||12289<=o&&o<=12350||12353<=o&&o<=12438||12441<=o&&o<=12543||12549<=o&&o<=12589||12593<=o&&o<=12686||12688<=o&&o<=12730||12736<=o&&o<=12771||12784<=o&&o<=12830||12832<=o&&o<=12871||12880<=o&&o<=13054||13056<=o&&o<=19903||19968<=o&&o<=42124||42128<=o&&o<=42182||43360<=o&&o<=43388||44032<=o&&o<=55203||55216<=o&&o<=55238||55243<=o&&o<=55291||63744<=o&&o<=64255||65040<=o&&o<=65049||65072<=o&&o<=65106||65108<=o&&o<=65126||65128<=o&&o<=65131||110592<=o&&o<=110593||127488<=o&&o<=127490||127504<=o&&o<=127546||127552<=o&&o<=127560||127568<=o&&o<=127569||131072<=o&&o<=194367||177984<=o&&o<=196605||196608<=o&&o<=262141?"W":32<=o&&o<=126||162<=o&&o<=163||165<=o&&o<=166||172===o||175===o||10214<=o&&o<=10221||10629<=o&&o<=10630?"Na":161===o||164===o||167<=o&&o<=168||170===o||173<=o&&o<=174||176<=o&&o<=180||182<=o&&o<=186||188<=o&&o<=191||198===o||208===o||215<=o&&o<=216||222<=o&&o<=225||230===o||232<=o&&o<=234||236<=o&&o<=237||240===o||242<=o&&o<=243||247<=o&&o<=250||252===o||254===o||257===o||273===o||275===o||283===o||294<=o&&o<=295||299===o||305<=o&&o<=307||312===o||319<=o&&o<=322||324===o||328<=o&&o<=331||333===o||338<=o&&o<=339||358<=o&&o<=359||363===o||462===o||464===o||466===o||468===o||470===o||472===o||474===o||476===o||593===o||609===o||708===o||711===o||713<=o&&o<=715||717===o||720===o||728<=o&&o<=731||733===o||735===o||768<=o&&o<=879||913<=o&&o<=929||931<=o&&o<=937||945<=o&&o<=961||963<=o&&o<=969||1025===o||1040<=o&&o<=1103||1105===o||8208===o||8211<=o&&o<=8214||8216<=o&&o<=8217||8220<=o&&o<=8221||8224<=o&&o<=8226||8228<=o&&o<=8231||8240===o||8242<=o&&o<=8243||8245===o||8251===o||8254===o||8308===o||8319===o||8321<=o&&o<=8324||8364===o||8451===o||8453===o||8457===o||8467===o||8470===o||8481<=o&&o<=8482||8486===o||8491===o||8531<=o&&o<=8532||8539<=o&&o<=8542||8544<=o&&o<=8555||8560<=o&&o<=8569||8585===o||8592<=o&&o<=8601||8632<=o&&o<=8633||8658===o||8660===o||8679===o||8704===o||8706<=o&&o<=8707||8711<=o&&o<=8712||8715===o||8719===o||8721===o||8725===o||8730===o||8733<=o&&o<=8736||8739===o||8741===o||8743<=o&&o<=8748||8750===o||8756<=o&&o<=8759||8764<=o&&o<=8765||8776===o||8780===o||8786===o||8800<=o&&o<=8801||8804<=o&&o<=8807||8810<=o&&o<=8811||8814<=o&&o<=8815||8834<=o&&o<=8835||8838<=o&&o<=8839||8853===o||8857===o||8869===o||8895===o||8978===o||9312<=o&&o<=9449||9451<=o&&o<=9547||9552<=o&&o<=9587||9600<=o&&o<=9615||9618<=o&&o<=9621||9632<=o&&o<=9633||9635<=o&&o<=9641||9650<=o&&o<=9651||9654<=o&&o<=9655||9660<=o&&o<=9661||9664<=o&&o<=9665||9670<=o&&o<=9672||9675===o||9678<=o&&o<=9681||9698<=o&&o<=9701||9711===o||9733<=o&&o<=9734||9737===o||9742<=o&&o<=9743||9748<=o&&o<=9749||9756===o||9758===o||9792===o||9794===o||9824<=o&&o<=9825||9827<=o&&o<=9829||9831<=o&&o<=9834||9836<=o&&o<=9837||9839===o||9886<=o&&o<=9887||9918<=o&&o<=9919||9924<=o&&o<=9933||9935<=o&&o<=9953||9955===o||9960<=o&&o<=9983||10045===o||10071===o||10102<=o&&o<=10111||11093<=o&&o<=11097||12872<=o&&o<=12879||57344<=o&&o<=63743||65024<=o&&o<=65039||65533===o||127232<=o&&o<=127242||127248<=o&&o<=127277||127280<=o&&o<=127337||127344<=o&&o<=127386||917760<=o&&o<=917999||983040<=o&&o<=1048573||1048576<=o&&o<=1114109?"A":"N"};function Le(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;i||(i=1);const{fontStyle:o=e.fontStyle,fontVariant:n=e.fontVariant,fontWeight:r=e.fontWeight,fontSize:s=e.fontSize,fontFamily:a=e.fontFamily}=t;return(o?o+" ":"")+(n?n+" ":"")+(r?r+" ":"")+s*i+"px "+(a||"sans-serif")}class Pe{constructor(t,e){this._numberCharSize=null,this._fullCharSize=null,this._letterCharSize=null,this._specialCharSizeMap={},this._canvas=null,this._context=null,this._contextSaved=!1,this._notSupportCanvas=!1,this._notSupportVRender=!1,this._userSpec={},this.specialCharSet="-/: .,@%'\"~",this._option=t,this._userSpec=null!=e?e:{},this.textSpec=this._initSpec(),ot(t.specialCharSet)&&(this.specialCharSet=t.specialCharSet),this._standardMethod=ot(t.getTextBounds)?this.fullMeasure.bind(this):this.measureWithNaiveCanvas.bind(this)}initContext(){if(this._notSupportCanvas)return!1;if(it(this._canvas)&&(ot(this._option.getCanvasForMeasure)&&(this._canvas=this._option.getCanvasForMeasure()),it(this._canvas)&&"undefined"!=typeof window&&void 0!==window.document&&globalThis&&ot(globalThis.document)&&(this._canvas=globalThis.document.createElement("canvas"))),it(this._context)&&ot(this._canvas)){const t=this._canvas.getContext("2d");ot(t)&&(t.save(),t.font=Le(this.textSpec),this._contextSaved=!0,this._context=t)}return!it(this._context)||(this._notSupportCanvas=!0,!1)}_initSpec(){var t,e,i;const{defaultFontParams:o={}}=this._option,{fontStyle:n=o.fontStyle,fontVariant:r=o.fontVariant,fontWeight:s=(null!==(t=o.fontWeight)&&void 0!==t?t:"normal"),fontSize:a=(null!==(e=o.fontSize)&&void 0!==e?e:12),fontFamily:l=(null!==(i=o.fontFamily)&&void 0!==i?i:"sans-serif"),align:h,textAlign:d=(null!=h?h:"center"),baseline:c,textBaseline:u=(null!=c?c:"middle"),ellipsis:g,limit:p}=this._userSpec;let{lineHeight:f=a}=this._userSpec;if(lt(f)&&"%"===f[f.length-1]){const t=Number.parseFloat(f.substring(0,f.length-1))/100;f=a*t}return{fontStyle:n,fontVariant:r,fontFamily:l,fontSize:a,fontWeight:s,textAlign:d,textBaseline:u,ellipsis:g,limit:p,lineHeight:f}}measure(t,e){switch(e){case"vrender":case"canopus":return this.fullMeasure(t);case"canvas":return this.measureWithNaiveCanvas(t);case"simple":return this.quickMeasureWithoutCanvas(t);default:return this.quickMeasure(t)}}fullMeasure(t){if(it(t))return{width:0,height:0};if(it(this._option.getTextBounds)||!this._notSupportVRender)return this.measureWithNaiveCanvas(t);const{fontFamily:e,fontSize:i,fontWeight:o,textAlign:n,textBaseline:r,ellipsis:s,limit:a,lineHeight:l}=this.textSpec;let h;try{const d=this._option.getTextBounds({text:t,fontFamily:e,fontSize:i,fontWeight:o,textAlign:n,textBaseline:r,ellipsis:!!s,maxLineWidth:a||1/0,lineHeight:l});h={width:d.width(),height:d.height()}}catch(e){this._notSupportVRender=!0,h=this.measureWithNaiveCanvas(t)}return h}measureWithNaiveCanvas(t){return this._measureReduce(t,this._measureWithNaiveCanvas.bind(this))}_measureWithNaiveCanvas(t){var e;if(!this.initContext())return this._quickMeasureWithoutCanvas(t);const i=this._context.measureText(t),{fontSize:o,lineHeight:n}=this.textSpec;return{width:i.width,height:null!==(e=n)&&void 0!==e?e:o,fontBoundingBoxAscent:i.fontBoundingBoxAscent,fontBoundingBoxDescent:i.fontBoundingBoxDescent}}quickMeasure(t){return this._measureReduce(t,this._quickMeasure.bind(this))}_quickMeasure(t){const e={width:0,height:0};for(let i=0;i<t.length;i++){const o=t[i];let n=this._measureSpecialChar(o);it(n)&&Pe.NUMBERS_CHAR_SET.includes(o)&&(n=this._measureNumberChar()),it(n)&&["F","W"].includes(Me(o))&&(n=this._measureFullSizeChar()),it(n)&&(n=this._measureLetterChar()),e.width+=n.width,e.height=Math.max(e.height,n.height),!it(n.fontBoundingBoxAscent)&&(e.fontBoundingBoxAscent=n.fontBoundingBoxAscent),!it(n.fontBoundingBoxDescent)&&(e.fontBoundingBoxDescent=n.fontBoundingBoxDescent)}return e}quickMeasureWithoutCanvas(t){return this._measureReduce(t,this._quickMeasureWithoutCanvas.bind(this))}_quickMeasureWithoutCanvas(t){var e;const i={width:0,height:0},{fontSize:o,lineHeight:n}=this.textSpec;for(let e=0;e<t.length;e++){const n=t[e],r=["F","W"].includes(Me(n))?1:.53;i.width+=r*o}return i.height=null!==(e=n)&&void 0!==e?e:o,i}_measureReduce(t,e){var i;const{fontSize:o,lineHeight:n}=this.textSpec,r={width:0,height:0};if(it(t))return r;if(ht(t)){const s=t.filter(ot).map((t=>t.toString()));return 0===s.length?r:1===s.length?e(s[0]):{width:s.reduce(((t,i)=>Math.max(t,e(i).width)),0),height:s.length*((null!==(i=n)&&void 0!==i?i:o)+1)+1}}return e(t.toString())}_measureNumberChar(){if(it(this._numberCharSize)){const t=this._standardMethod(Pe.NUMBERS_CHAR_SET);this._numberCharSize={width:t.width/Pe.NUMBERS_CHAR_SET.length,height:t.height,fontBoundingBoxAscent:t.fontBoundingBoxAscent,fontBoundingBoxDescent:t.fontBoundingBoxDescent}}return this._numberCharSize}_measureFullSizeChar(){return it(this._fullCharSize)&&(this._fullCharSize=this._standardMethod(Pe.FULL_SIZE_CHAR)),this._fullCharSize}_measureLetterChar(){if(it(this._letterCharSize)){const t=this._standardMethod(Pe.ALPHABET_CHAR_SET);this._letterCharSize={width:t.width/Pe.ALPHABET_CHAR_SET.length,height:t.height,fontBoundingBoxAscent:t.fontBoundingBoxAscent,fontBoundingBoxDescent:t.fontBoundingBoxDescent}}return this._letterCharSize}_measureSpecialChar(t){return ot(this._specialCharSizeMap[t])?this._specialCharSizeMap[t]:this.specialCharSet.includes(t)?(this._specialCharSizeMap[t]=this._standardMethod(t),this._specialCharSizeMap[t]):null}release(){ot(this._canvas)&&(this._canvas=null),ot(this._context)&&(this._contextSaved&&(this._context.restore(),this._contextSaved=!1),this._context=null)}}function Ee(t,e,i){const{x1:o,y1:n,x2:r,y2:s}=e;return i.onlyTranslate()?(t!==e&&t.setValue(e.x1,e.y1,e.x2,e.y2),t.translate(i.e,i.f),e):(t.clear(),t.add(i.a*o+i.c*n+i.e,i.b*o+i.d*n+i.f),t.add(i.a*r+i.c*n+i.e,i.b*r+i.d*n+i.f),t.add(i.a*r+i.c*s+i.e,i.b*r+i.d*s+i.f),t.add(i.a*o+i.c*s+i.e,i.b*o+i.d*s+i.f),e)}Pe.ALPHABET_CHAR_SET="abcdefghijklmnopqrstuvwxyz",Pe.NUMBERS_CHAR_SET="0123456789",Pe.FULL_SIZE_CHAR="字";class He{constructor(t){t?this.setValue(t.x1,t.y1,t.x2,t.y2):this.clear()}clone(){return new He(this)}clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this}empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE}equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2}setValue(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.x1=t,this.y1=e,this.x2=i,this.y2=o,this}set(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return i<t?(this.x2=t,this.x1=i):(this.x1=t,this.x2=i),o<e?(this.y2=e,this.y1=o):(this.y1=e,this.y2=o),this}add(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this}expand(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return ht(t)?(this.y1-=t[0],this.x2+=t[1],this.y2+=t[2],this.x1-=t[3]):(this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t),this}round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this}translate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this}rotate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const o=this.rotatedPoints(t,e,i);return this.clear().add(o[0],o[1]).add(o[2],o[3]).add(o[4],o[5]).add(o[6],o[7])}scale(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const n=this.scalePoints(t,e,i,o);return this.clear().add(n[0],n[1]).add(n[2],n[3])}union(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this}intersect(t){return t.x1>this.x1&&(this.x1=t.x1),t.y1>this.y1&&(this.y1=t.y1),t.x2<this.x2&&(this.x2=t.x2),t.y2<this.y2&&(this.y2=t.y2),this}encloses(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2}alignsWith(t){return t&&(this.x1===t.x1||this.x2===t.x2||this.y1===t.y1||this.y2===t.y2)}intersects(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)}contains(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)}containsPoint(t){return!(t.x<this.x1||t.x>this.x2||t.y<this.y1||t.y>this.y2)}width(){return this.empty()?0:this.x2-this.x1}height(){return this.empty()?0:this.y2-this.y1}scaleX(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.x1*=t,this.x2*=t,this}scaleY(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.y1*=t,this.y2*=t,this}transformWithMatrix(t){return Ee(this,this,t),this}copy(t){return this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2,this}rotatedPoints(t,e,i){const{x1:o,y1:n,x2:r,y2:s}=this,a=Math.cos(t),l=Math.sin(t),h=e-e*a+i*l,d=i-e*l-i*a;return[a*o-l*n+h,l*o+a*n+d,a*o-l*s+h,l*o+a*s+d,a*r-l*n+h,l*r+a*n+d,a*r-l*s+h,l*r+a*s+d]}scalePoints(t,e,i,o){const{x1:n,y1:r,x2:s,y2:a}=this;return[t*n+(1-t)*i,e*r+(1-e)*o,t*s+(1-t)*i,e*a+(1-e)*o]}}class Fe extends He{}class Oe extends He{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;var i;super(t),t&&(this.angle=null!==(i=t.angle)&&void 0!==i?i:e)}intersects(t){return ke(this,t)}setValue(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return super.setValue(t,e,i,o),this.angle=n,this}clone(){return new Oe(this)}}class Ie{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.a=t,this.b=e,this.c=i,this.d=o,this.e=n,this.f=r}equalToMatrix(t){return!(this.e!==t.e||this.f!==t.f||this.a!==t.a||this.d!==t.d||this.b!==t.b||this.c!==t.c)}equalTo(t,e,i,o,n,r){return!(this.e!==n||this.f!==r||this.a!==t||this.d!==o||this.b!==e||this.c!==i)}setValue(t,e,i,o,n,r){return this.a=t,this.b=e,this.c=i,this.d=o,this.e=n,this.f=r,this}reset(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}getInverse(){const t=this.a,e=this.b,i=this.c,o=this.d,n=this.e,r=this.f,s=new Ie,a=t*o-e*i;return s.a=o/a,s.b=-e/a,s.c=-i/a,s.d=t/a,s.e=(i*r-o*n)/a,s.f=-(t*r-e*n)/a,s}rotate(t){const e=Math.cos(t),i=Math.sin(t),o=this.a*e+this.c*i,n=this.b*e+this.d*i,r=this.a*-i+this.c*e,s=this.b*-i+this.d*e;return this.a=o,this.b=n,this.c=r,this.d=s,this}rotateByCenter(t,e,i){const o=Math.cos(t),n=Math.sin(t),r=(1-o)*e+n*i,s=(1-o)*i-n*e,a=o*this.a-n*this.b,l=n*this.a+o*this.b,h=o*this.c-n*this.d,d=n*this.c+o*this.d,c=o*this.e-n*this.f+r,u=n*this.e+o*this.f+s;return this.a=a,this.b=l,this.c=h,this.d=d,this.e=c,this.f=u,this}scale(t,e){return this.a*=t,this.b*=t,this.c*=e,this.d*=e,this}setScale(t,e){return this.b=this.b/this.a*t,this.c=this.c/this.d*e,this.a=t,this.d=e,this}transform(t,e,i,o,n,r){return this.multiply(t,e,i,o,n,r),this}translate(t,e){return this.e+=this.a*t+this.c*e,this.f+=this.b*t+this.d*e,this}transpose(){const{a:t,b:e,c:i,d:o,e:n,f:r}=this;return this.a=e,this.b=t,this.c=o,this.d=i,this.e=r,this.f=n,this}multiply(t,e,i,o,n,r){const s=this.a,a=this.b,l=this.c,h=this.d,d=s*t+l*e,c=a*t+h*e,u=s*i+l*o,g=a*i+h*o,p=s*n+l*r+this.e,f=a*n+h*r+this.f;return this.a=d,this.b=c,this.c=u,this.d=g,this.e=p,this.f=f,this}interpolate(t,e){const i=new Ie;return i.a=this.a+(t.a-this.a)*e,i.b=this.b+(t.b-this.b)*e,i.c=this.c+(t.c-this.c)*e,i.d=this.d+(t.d-this.d)*e,i.e=this.e+(t.e-this.e)*e,i.f=this.f+(t.f-this.f)*e,i}transformPoint(t,e){const{a:i,b:o,c:n,d:r,e:s,f:a}=this,l=i*r-o*n,h=r/l,d=-o/l,c=-n/l,u=i/l,g=(n*a-r*s)/l,p=-(i*a-o*s)/l,{x:f,y:v}=t;e.x=f*h+v*c+g,e.y=f*d+v*u+p}onlyTranslate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.a===t&&0===this.b&&0===this.c&&this.d===t}clone(){return new Ie(this.a,this.b,this.c,this.d,this.e,this.f)}toTransformAttrs(){const t=this.a,e=this.b,i=this.c,o=this.d,n=t*o-e*i,r={x:this.e,y:this.f,rotateDeg:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(0!==t||0!==e){const s=Math.sqrt(t*t+e*e);r.rotateDeg=e>0?Math.acos(t/s):-Math.acos(t/s),r.scaleX=s,r.scaleY=n/s,r.skewX=(t*i+e*o)/n,r.skewY=0}else if(0!==i||0!==o){const s=Math.sqrt(i*i+o*o);r.rotateDeg=Math.PI/2-(o>0?Math.acos(-i/s):-Math.acos(i/s)),r.scaleX=n/s,r.scaleY=s,r.skewX=0,r.skewY=(t*i+e*o)/n}return r.rotateDeg=180*r.rotateDeg/Math.PI,r}}class ze{constructor(){this.CLEAN_THRESHOLD=1e3,this.L_TIME=1e3,this.R_COUNT=1,this.R_TIMESTAMP_MAX_SIZE=20}clearCache(t,e){const{CLEAN_THRESHOLD:i=this.CLEAN_THRESHOLD,L_TIME:o=this.L_TIME,R_COUNT:n=this.R_COUNT}=e;if(t.size<i)return 0;let r=0;const s=e=>{r++,t.delete(e)},a=Date.now();return t.forEach(((t,e)=>{if(t.timestamp.length<n)return s(e);let i=0;for(;a-t.timestamp[t.timestamp.length-1-i]<o&&(i++,!(i>=n)););if(i<n)return s(e);for(;a-t.timestamp[0]>o;)t.timestamp.shift()})),r}addLimitedTimestamp(t,e,i){const{R_TIMESTAMP_MAX_SIZE:o=this.R_TIMESTAMP_MAX_SIZE}=i;t.timestamp.length>o&&t.timestamp.shift(),t.timestamp.push(e)}clearTimeStamp(t,e){const{L_TIME:i=this.L_TIME}=e,o=Date.now();t.forEach((t=>{for(;o-t.timestamp[0]>i;)t.timestamp.shift()}))}clearItemTimestamp(t,e){const{L_TIME:i=this.L_TIME}=e,o=Date.now();for(;o-t.timestamp[0]>i;)t.timestamp.shift()}}function De(t,e,i){e/=100,i/=100;const o=(1-Math.abs(2*i-1))*e,n=o*(1-Math.abs(t/60%2-1)),r=i-o/2;let s=0,a=0,l=0;return 0<=t&&t<60?(s=o,a=n,l=0):60<=t&&t<120?(s=n,a=o,l=0):120<=t&&t<180?(s=0,a=o,l=n):180<=t&&t<240?(s=0,a=n,l=o):240<=t&&t<300?(s=n,a=0,l=o):300<=t&&t<360&&(s=o,a=0,l=n),s=Math.round(255*(s+r)),a=Math.round(255*(a+r)),l=Math.round(255*(l+r)),{r:s,g:a,b:l}}function We(t,e,i){t/=255,e/=255,i/=255;const o=Math.min(t,e,i),n=Math.max(t,e,i),r=n-o;let s=0,a=0,l=0;return s=0===r?0:n===t?(e-i)/r%6:n===e?(i-t)/r+2:(t-e)/r+4,s=Math.round(60*s),s<0&&(s+=360),l=(n+o)/2,a=0===r?0:r/(1-Math.abs(2*l-1)),a=+(100*a).toFixed(1),l=+(100*l).toFixed(1),{h:s,s:a,l:l}}const Ne=/^#([0-9a-f]{3,8})$/,Ge={transparent:4294967040},je={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Ve(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function Ue(t){return ut(t)?new qe(t>>16,t>>8&255,255&t,1):ht(t)?new qe(t[0],t[1],t[2]):new qe(255,255,255)}function $e(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Xe(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}const Ye=(t,e)=>{const i=Ne.exec(t);if(e||i){const t=parseInt(i[1],16),e=i[1].length;return 3===e?new qe((t>>8&15)+((t>>8&15)<<4),(t>>4&15)+((t>>4&15)<<4),(15&t)+((15&t)<<4),1):6===e?Ue(t):8===e?new qe(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):null}};let Ke=class t{static Brighter(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return 1===i?e:new t(e).brighter(i).toRGBA()}static SetOpacity(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return 1===i?e:new t(e).setOpacity(i).toRGBA()}static getColorBrightness(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"hsl";const o=e instanceof t?e:new t(e);switch(i){case"hsv":default:return o.getHSVBrightness();case"hsl":return o.getHSLBrightness();case"lum":return o.getLuminance();case"lum2":return o.getLuminance2();case"lum3":return o.getLuminance3();case"wcag":return o.getLuminanceWCAG()}}static parseColorString(t){if(ot(Ge[t]))return function(t){return ut(t)?new qe(t>>>24,t>>>16&255,t>>>8&255,255&t):ht(t)?new qe(t[0],t[1],t[2],t[3]):new qe(255,255,255,1)}(Ge[t]);if(ot(je[t]))return Ue(je[t]);const e=`${t}`.trim().toLowerCase(),i=Ye(e);if(void 0!==i)return i;if(/^(rgb|RGB|rgba|RGBA)/.test(e)){const t=e.replace(/(?:\(|\)|rgba|RGBA|rgb|RGB)*/g,"").split(",");return new qe(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10),parseFloat(t[3]))}if(/^(hsl|HSL|hsla|HSLA)/.test(e)){const t=e.replace(/(?:\(|\)|hsla|HSLA|hsl|HSL)*/g,"").split(","),i=De(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10));return new qe(i.r,i.g,i.b,parseFloat(t[3]))}}constructor(e){const i=t.parseColorString(e);this.color=i||new qe(255,255,255)}toRGBA(){return this.color.formatRgb()}toString(){return this.color.formatRgb()}toHex(){return this.color.formatHex()}toHsl(){return this.color.formatHsl()}brighter(t){const{r:e,g:i,b:o}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t))),this.color.b=Math.max(0,Math.min(255,Math.floor(o*t))),this}add(t){const{r:e,g:i,b:o}=this.color;return this.color.r+=Math.min(255,e+t.color.r),this.color.g+=Math.min(255,i+t.color.g),this.color.b+=Math.min(255,o+t.color.b),this}sub(t){return this.color.r=Math.max(0,this.color.r-t.color.r),this.color.g=Math.max(0,this.color.g-t.color.g),this.color.b=Math.max(0,this.color.b-t.color.b),this}multiply(t){const{r:e,g:i,b:o}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t.color.r))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t.color.g))),this.color.b=Math.max(0,Math.min(255,Math.floor(o*t.color.b))),this}getHSVBrightness(){return Math.max(this.color.r,this.color.g,this.color.b)/255}getHSLBrightness(){return.5*(Math.max(this.color.r,this.color.g,this.color.b)/255+Math.min(this.color.r,this.color.g,this.color.b)/255)}setHsl(t,e,i){const o=this.color.opacity,n=We(this.color.r,this.color.g,this.color.b),r=De(it(t)?n.h:Xt(t,0,360),it(e)?n.s:e>=0&&e<=1?100*e:e,it(i)?n.l:i<=1&&i>=0?100*i:i);return this.color=new qe(r.r,r.g,r.b,o),this}setRGB(t,e,i){return!it(t)&&(this.color.r=t),!it(e)&&(this.color.g=e),!it(i)&&(this.color.b=i),this}setHex(t){const e=`${t}`.trim().toLowerCase(),i=Ye(e,!0);return null!=i?i:this}setColorName(t){const e=je[t.toLowerCase()];return void 0!==e&&this.setHex(e),this}setScalar(t){return this.color.r=t,this.color.g=t,this.color.b=t,this}setOpacity(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.color.opacity=t,this}getLuminance(){return(.2126*this.color.r+.7152*this.color.g+.0722*this.color.b)/255}getLuminance2(){return(.2627*this.color.r+.678*this.color.g+.0593*this.color.b)/255}getLuminance3(){return(.299*this.color.r+.587*this.color.g+.114*this.color.b)/255}getLuminanceWCAG(){const t=this.color.r/255,e=this.color.g/255,i=this.color.b/255;let o,n,r;return o=t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4),n=e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4),r=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4),.2126*o+.7152*n+.0722*r}clone(){return new t(this.color.toString())}copyGammaToLinear(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return this.color.r=Math.pow(t.color.r,e),this.color.g=Math.pow(t.color.g,e),this.color.b=Math.pow(t.color.b,e),this}copyLinearToGamma(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const i=e>0?1/e:1;return this.color.r=Math.pow(t.color.r,i),this.color.g=Math.pow(t.color.g,i),this.color.b=Math.pow(t.color.b,i),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.color.r=$e(t.color.r),this.color.g=$e(t.color.g),this.color.b=$e(t.color.b),this}copyLinearToSRGB(t){return this.color.r=Xe(t.color.r),this.color.g=Xe(t.color.g),this.color.b=Xe(t.color.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}},qe=class{constructor(t,e,i,o){this.r=isNaN(+t)?255:Math.max(0,Math.min(255,+t)),this.g=isNaN(+e)?255:Math.max(0,Math.min(255,+e)),this.b=isNaN(+i)?255:Math.max(0,Math.min(255,+i)),ot(o)?this.opacity=isNaN(+o)?1:Math.max(0,Math.min(1,+o)):this.opacity=1}formatHex(){return`#${Ve(this.r)+Ve(this.g)+Ve(this.b)+(1===this.opacity?"":Ve(255*this.opacity))}`}formatRgb(){const t=this.opacity;return`${1===t?"rgb(":"rgba("}${this.r},${this.g},${this.b}${1===t?")":`,${t})`}`}formatHsl(){const t=this.opacity,{h:e,s:i,l:o}=We(this.r,this.g,this.b);return`${1===t?"hsl(":"hsla("}${e},${i}%,${o}%${1===t?")":`,${t})`}`}toString(){return this.formatHex()}};var Ze=Object.freeze({__proto__:null,Color:Ke,DEFAULT_COLORS:je,RGB:qe,hexToRgb:function(t){let e="",i="",o="";const n="#"===t[0]?1:0;for(let r=n;r<t.length;r++)"#"!==t[r]&&(r<n+2?e+=t[r]:r<n+4?i+=t[r]:r<n+6&&(o+=t[r]));return[parseInt(e,16),parseInt(i,16),parseInt(o,16)]},hslToRgb:De,interpolateRgb:function(t,e){const i=t.r,o=e.r,n=t.g,r=e.g,s=t.b,a=e.b,l=t.opacity,h=e.opacity;return t=>{const e=Math.round(i*(1-t)+o*t),d=Math.round(n*(1-t)+r*t),c=Math.round(s*(1-t)+a*t);return new qe(e,d,c,l*(1-t)+h*t)}},rgbToHex:function(t,e,i){return Number((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1)},rgbToHsl:We});function Je(t){if(gt(t))return[t,t,t,t];if(ht(t)){const e=t.length;if(1===e){const e=t[0];return[e,e,e,e]}if(2===e){const[e,i]=t;return[e,i,e,i]}if(3===e){const[e,i,o]=t;return[e,i,o,i]}if(4===e)return t}if(nt(t)){const{top:e=0,right:i=0,bottom:o=0,left:n=0}=t;return[e,i,o,n]}return[0,0,0,0]}const Qe=oe-1e-8;class ti{constructor(t){this.init(t)}init(t){this.bounds=t}arc(t,e,i,o,n,r){if(Math.abs(n-o)>Qe)return this.bounds.add(t-i,e-i),void this.bounds.add(t+i,e+i);let s,a,l,h,d=1/0,c=-1/0,u=1/0,g=-1/0;function p(t){l=i*Math.cos(t),h=i*Math.sin(t),l<d&&(d=l),l>c&&(c=l),h<u&&(u=h),h>g&&(g=h)}if(p(o),p(n),n!==o)if((o%=oe)<0&&(o+=oe),(n%=oe)<0&&(n+=oe),n<o&&(r=!r,s=o,o=n,n=s),r)for(n-=oe,s=o-o%ie,a=0;a<4&&s>n;++a,s-=ie)p(s);else for(s=o-o%ie+ie,a=0;a<4&&s<n;++a,s+=ie)p(s);this.bounds.add(t+d,e+u),this.bounds.add(t+c,e+g)}arcTo(t,e,i,o,n){this.bounds.add(t,e)}bezierCurveTo(t,e,i,o,n,r){this.bounds.add(t,e),this.bounds.add(i,o),this.bounds.add(n,r)}closePath(){}ellipse(){throw new Error("不支持ellipse")}lineTo(t,e){this.bounds.add(t,e)}moveTo(t,e){this.bounds.add(t,e)}quadraticCurveTo(t,e,i,o){this.bounds.add(t,e),this.bounds.add(i,o)}rect(t,e,i,o){this.bounds.add(t,e),this.bounds.add(t+i,e+o)}clear(){this.bounds.clear()}release(){}}class ei{constructor(){this.curves=[],this.bounds=new Fe}getCurveLengths(){return this.curves.map((t=>t.getLength()))}getPointAt(t){return{x:0,y:0}}getLength(){return 0}getBounds(){return this.bounds}}const ii=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,oi={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,M:2,L:2,H:1,V:1,C:6,S:4,Q:4,T:2,A:7},ni=0,ri=1,si=2,ai=3,li=4,hi=5,di=6,ci=7,ui=8;let gi,pi,fi,vi,bi,mi;var yi,Ci,wi,xi,_i,Si,Ai,Bi,Ri;function Ti(t){const e=t[0],i=t[1],o=t[2],n=t[3],r=t[4],s=t[5],a=t[6],l=t[7],h=l*r,d=-a*s,c=a*r,u=l*s,g=Math.cos(o),p=Math.sin(o),f=Math.cos(n),v=Math.sin(n),b=.5*(n-o),m=Math.sin(.5*b),y=8/3*m*m/Math.sin(b),C=e+g-y*p,w=i+p+y*g,x=e+f,_=i+v,S=x+y*v,A=_-y*f;return[h*C+d*w,c*C+u*w,h*S+d*A,c*S+u*A,h*x+d*_,c*x+u*_]}function ki(t,e,i,o){const n=function(t,e,i,o,n,r,s,a,l){const h=be(s),d=Math.sin(h),c=Math.cos(h),u=c*(a-t)*.5+d*(l-e)*.5,g=c*(l-e)*.5-d*(a-t)*.5;let p=u*u/((i=Math.abs(i))*i)+g*g/((o=Math.abs(o))*o);p>1&&(p=Math.sqrt(p),i*=p,o*=p);const f=c/i,v=d/i,b=-d/o,m=c/o,y=f*a+v*l,C=b*a+m*l,w=f*t+v*e,x=b*t+m*e;let _=1/((w-y)*(w-y)+(x-C)*(x-C))-.25;_<0&&(_=0);let S=Math.sqrt(_);r===n&&(S=-S);const A=.5*(y+w)-S*(x-C),B=.5*(C+x)+S*(w-y),R=Math.atan2(C-B,y-A);let T=Math.atan2(x-B,w-A)-R;T<0&&1===r?T+=oe:T>0&&0===r&&(T-=oe);const k=Math.ceil(Math.abs(T/(ie+.001))),M=[];for(let t=0;t<k;++t){const e=R+t*T/k,n=R+(t+1)*T/k;M[t]=[A,B,e,n,i,o,d,c]}return M}(o[5],o[6],o[0],o[1],o[3],o[4],o[2],e,i);for(let e=0;e<n.length;++e){const i=Ti(n[e]);t.bezierCurveTo(i[0],i[1],i[2],i[3],i[4],i[5])}}!function(t){t[t.NONE=0]="NONE",t[t.UPDATE_BOUNDS=1]="UPDATE_BOUNDS",t[t.UPDATE_SHAPE=2]="UPDATE_SHAPE",t[t.CLEAR_SHAPE=253]="CLEAR_SHAPE",t[t.UPDATE_SHAPE_AND_BOUNDS=3]="UPDATE_SHAPE_AND_BOUNDS",t[t.INIT=179]="INIT",t[t.CLEAR_BOUNDS=254]="CLEAR_BOUNDS",t[t.UPDATE_GLOBAL_MATRIX=32]="UPDATE_GLOBAL_MATRIX",t[t.CLEAR_GLOBAL_MATRIX=223]="CLEAR_GLOBAL_MATRIX",t[t.UPDATE_LOCAL_MATRIX=16]="UPDATE_LOCAL_MATRIX",t[t.CLEAR_LOCAL_MATRIX=239]="CLEAR_LOCAL_MATRIX",t[t.UPDATE_GLOBAL_LOCAL_MATRIX=48]="UPDATE_GLOBAL_LOCAL_MATRIX",t[t.UPDATE_LAYOUT=128]="UPDATE_LAYOUT",t[t.CLEAR_LAYOUT=127]="CLEAR_LAYOUT"}(yi||(yi={})),function(t){t[t.GLOBAL=1]="GLOBAL",t[t.LOCAL=16]="LOCAL",t[t.GLOBAL_ACCURATE=3]="GLOBAL_ACCURATE",t[t.LOCAL_ACCURATE=48]="LOCAL_ACCURATE"}(Ci||(Ci={})),function(t){t[t.INIT=0]="INIT",t[t.DEFAULT=1]="DEFAULT",t[t.STATE=2]="STATE",t[t.ANIMATE_BIND=10]="ANIMATE_BIND",t[t.ANIMATE_PLAY=11]="ANIMATE_PLAY",t[t.ANIMATE_START=12]="ANIMATE_START",t[t.ANIMATE_UPDATE=13]="ANIMATE_UPDATE",t[t.ANIMATE_END=14]="ANIMATE_END",t[t.TRANSLATE=20]="TRANSLATE",t[t.TRANSLATE_TO=21]="TRANSLATE_TO",t[t.SCALE=22]="SCALE",t[t.SCALE_TO=23]="SCALE_TO",t[t.ROTATE=24]="ROTATE",t[t.ROTATE_TO=25]="ROTATE_TO"}(wi||(wi={})),function(t){t[t.INITIAL=0]="INITIAL",t[t.RUNNING=1]="RUNNING",t[t.PAUSED=2]="PAUSED",t[t.END=3]="END"}(xi||(xi={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.SET_ATTR_IMMEDIATELY=1]="SET_ATTR_IMMEDIATELY"}(_i||(_i={})),function(t){t.wait="wait",t.from="from",t.to="to",t.customAnimate="customAnimate"}(Si||(Si={})),function(t){t[t.ROW=1]="ROW",t[t.COLUMN=2]="COLUMN"}(Ai||(Ai={})),function(t){t[t.CubicBezierCurve=0]="CubicBezierCurve",t[t.QuadraticBezierCurve=1]="QuadraticBezierCurve",t[t.ArcCurve=2]="ArcCurve",t[t.LineCurve=3]="LineCurve",t[t.EllipseCurve=4]="EllipseCurve",t[t.MoveCurve=5]="MoveCurve"}(Bi||(Bi={})),function(t){t[t.beforeFillStroke=0]="beforeFillStroke",t[t.afterFillStroke=1]="afterFillStroke"}(Ri||(Ri={}));const Mi=[(t,e,i,o,n,r,s)=>e.arc(t[1]*n+i,t[2]*r+o,t[3]*(n+r)/2,t[4],t[5],t[6],s),(t,e,i,o,n,r,s)=>e.arcTo(t[1]*n+i,t[2]*r+o,t[3]*n+i,t[4]*r+o,t[5]*(n+r)/2,s),(t,e,i,o,n,r,s)=>e.bezierCurveTo(t[1]*n+i,t[2]*r+o,t[3]*n+i,t[4]*r+o,t[5]*n+i,t[6]*r+o,s),(t,e,i,o)=>e.closePath(),(t,e,i,o,n,r)=>e.ellipse(t[1]*n+i,t[2]*r+o,t[3]*n,t[4]*r,t[5],t[6],t[7],t[8]),(t,e,i,o,n,r,s)=>e.lineTo(t[1]*n+i,t[2]*r+o,s),(t,e,i,o,n,r,s)=>e.moveTo(t[1]*n+i,t[2]*r+o,s),(t,e,i,o,n,r,s)=>e.quadraticCurveTo(t[1]*n+i,t[2]*r+o,t[3]*n+i,t[4]*r+o,s),(t,e,i,o,n,r,s)=>e.rect(t[1]*n+i,t[2]*r+o,t[3]*n,t[4]*r,s)];function Li(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,s=arguments.length>6?arguments[6]:void 0;for(let a=0;a<t.length;a++){const l=t[a];Mi[l[0]](l,e,i,o,n,r,s)}}class Pi{getLength(t){return null!=t?this.calcProjLength(t):(Number.isFinite(this.length)||(this.length=this.calcLength()),this.length)}}function Ei(t,e,i,o,n){return function(t,e){let i=0;const o=t.length;for(let n=0;n<o;n++){const r=t[n],s=e[n],a=t[(n+1)%o],l=e[(n+1)%o];i+=ve.distanceNN(r,s,a,l)}return i/2}([t.x,e.x,i.x,o.x],[t.y,e.y,i.y,o.y])}function Hi(t,e,i,o,n){const r=1-n;return r*r*r*t+3*e*n*r*r+3*i*n*n*r+o*n*n*n}function Fi(t,e,i,o,n){const r=Hi(t.x,e.x,i.x,o.x,n),s=Hi(t.y,e.y,i.y,o.y,n);return new fe(r,s)}function Oi(t,e){const{p0:i,p1:o,p2:n,p3:r}=t,s=Fi(i,o,n,r,e),a=ve.pointAtPP(i,o,e),l=ve.pointAtPP(o,n,e),h=ve.pointAtPP(n,r,e),d=ve.pointAtPP(a,l,e),c=ve.pointAtPP(l,h,e);return[new Ii(i,a,d,s),new Ii(s,c,h,r)]}class Ii extends Pi{constructor(t,e,i,o){super(),this.type=Bi.CubicBezierCurve,this.p0=t,this.p1=e,this.p2=i,this.p3=o}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y+this.p2.x+this.p2.y+this.p3.x+this.p3.y)}getPointAt(t){if(!1!==this.defined)return Fi(this.p0,this.p1,this.p2,this.p3,t);throw new Error("defined为false的点不能getPointAt")}calcLength(){return this._validPoint()?Ei(this.p0,this.p1,this.p2,this.p3):60}calcProjLength(t){return t===Ai.ROW?re(this.p0.x-this.p3.x):t===Ai.COLUMN?re(this.p0.y-this.p3.y):0}getAngleAt(t){const e=le(t-.01,0),i=he(t+.01,1),o=this.getPointAt(e),n=this.getPointAt(i);return se(n.y-o.y,n.x-o.x)}}function zi(t,e){const{p0:i,p1:o}=t,n=ve.pointAtPP(i,o,e);return[new Di(i,n),new Di(n,o)]}class Di extends Pi{constructor(t,e){super(),this.type=Bi.LineCurve,this.p0=t,this.p1=e}getPointAt(t){if(!1!==this.defined)return ve.pointAtPP(this.p0,this.p1,t);throw new Error("defined为false的点不能getPointAt")}getAngleAt(t){return null==this.angle&&(this.angle=se(this.p1.y-this.p0.y,this.p1.x-this.p0.x)),this.angle}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y)}calcLength(){return this._validPoint()?ve.distancePP(this.p0,this.p1):60}calcProjLength(t){return t===Ai.ROW?re(this.p0.x-this.p1.x):t===Ai.COLUMN?re(this.p0.y-this.p1.y):0}}class Wi{get endX(){return this._lastX}get endY(){return this._lastY}constructor(t,e){this.init(t,e)}init(t,e){this._lastX=this._lastY=this._startX=this._startY=0,this.curveType=t,this.direction=e,this.curves=[]}bezierCurveTo(t,e,i,o,n,r,s,a){const l=new Ii(new fe(this._lastX,this._lastY),new fe(t,e),new fe(i,o),new fe(n,r));l.originP1=this._lastOriginP,l.originP2=a,l.defined=s,this.curves.push(l),this._lastX=n,this._lastY=r,this._lastOriginP=a}closePath(){if(this.curves.length<2)return;const t=this.curves[this.curves.length-1];this.lineTo(this._startX,this._startY,t.defined,this._startOriginP)}ellipse(){throw new Error("SegContext不支持调用ellipse")}lineTo(t,e,i,o){const n=this.addLinearCurve(t,e,i,this._lastOriginP,o);this.curves.push(n),this._lastX=t,this._lastY=e,this._lastOriginP=o}moveTo(t,e,i){return this._lastX=this._startX=t,this._lastY=this._startY=e,this._lastOriginP=i,this._startOriginP=i,this}quadraticCurveTo(t,e,i,o){throw new Error("SegContext不支持调用quadraticCurveTo")}clear(){this.curves=[],this.length=NaN}tryUpdateLength(t){return this.getLength(t)}addLinearCurve(t,e,i,o,n){const r=new Di(new fe(this._lastX,this._lastY),new fe(t,e));return r.originP1=o,r.originP2=n,r.defined=i,r}getPointAt(t){throw new Error("暂未实现")}getCurveLengths(){return[]}getLength(t){var e,i;if(t===Ai.COLUMN){if(!this.curves.length)return 0;const t=this.curves[0],i=this.curves[this.curves.length-1],o=null!==(e=i.p3)&&void 0!==e?e:i.p1;return re(t.p0.y-o.y)}if(t===Ai.ROW){if(!this.curves.length)return 0;const t=this.curves[0],e=this.curves[this.curves.length-1],o=null!==(i=e.p3)&&void 0!==i?i:e.p1;return re(t.p0.x-o.x)}return Number.isFinite(this.length)||(this.length=this.curves.reduce(((t,e)=>t+e.getLength()),0)),this.length}}class Ni extends Wi{bezierCurveTo(t,e,i,o,n,r,s,a){return super.bezierCurveTo(e,t,o,i,r,n,s,a)}lineTo(t,e,i,o){return super.lineTo(e,t,i,o)}moveTo(t,e,i){return super.moveTo(e,t,i)}clear(){return super.clear()}}function Gi(t,e){let i=!1;for(let o=0,n=e.length;o<=n;o++)o>=n===i&&((i=!i)?t.lineStart():t.lineEnd()),i&&t.point(e[o])}function ji(t,e,i){const o=null!=e?e:re(i[i.length-1].x-i[0].x)>re(i[i.length-1].y-i[0].y)?Ai.ROW:Ai.COLUMN;return"monotoneY"===t?new Ni(t,o):new Wi(t,o)}class Vi{constructor(t,e){this.context=t,e&&(this.startPoint=e)}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){(this._line||0!==this._line&&1===this._point)&&this.context.closePath(),this._line=1-this._line}point(t){const e=t.x,i=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,!1!==this._lastDefined&&!1!==t.defined,t):this.context.moveTo(e,i,t);break;case 1:this._point=2;default:this.context.lineTo(e,i,!1!==this._lastDefined&&!1!==t.defined,t)}this._lastDefined=t.defined}tryUpdateLength(){return this.context.tryUpdateLength()}}function Ui(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{direction:i,startPoint:o}=e;if(t.length<2-Number(!!o))return null;const n=ji("linear",i,t);return function(t,e){Gi(t,e)}(new Vi(n,o),t),n}function $i(t,e,i,o,n){t.context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+i)/6,o,t.lastPoint1)}class Xi{constructor(t,e){this.context=t,this.startPoint=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){2===this._point&&$i(this,6*this._x1-(this._x0+4*this._x1),6*this._y1-(this._y0+4*this._y1),!1!==this._lastDefined1&&!1!==this._lastDefined2,this.lastPoint1),(this._line||0!==this._line&&1===this._point)&&this.context.closePath(),this._line=1-this._line}point(t){const e=t.x,i=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,!1!==this._lastDefined1&&!1!==this._lastDefined2,t):this.context.moveTo(e,i,t);break;case 1:this._point=2;break;default:$i(this,e,i,!1!==this._lastDefined1&&!1!==this._lastDefined2)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=i,this._lastDefined1=this._lastDefined2,this._lastDefined2=t.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}}function Yi(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{direction:i,startPoint:o}=e;if(t.length<2-Number(!!o))return null;if(t.length<3-Number(!!o))return Ui(t,e);const n=ji("basis",i,t);return function(t,e){Gi(t,e)}(new Xi(n,o),t),n}function Ki(t){return t<0?-1:1}function qi(t,e,i){const o=t._x1-t._x0,n=e-t._x1,r=(t._y1-t._y0)/(o||Number(n<0&&-0)),s=(i-t._y1)/(n||Number(o<0&&-0)),a=(r*n+s*o)/(o+n);return(Ki(r)+Ki(s))*Math.min(Math.abs(r),Math.abs(s),.5*Math.abs(a))||0}function Zi(t,e){const i=t._x1-t._x0;return i?(3*(t._y1-t._y0)/i-e)/2:e}function Ji(t,e,i,o,n){const r=t._x0,s=t._y0,a=t._x1,l=t._y1,h=(a-r)/3;t.context.bezierCurveTo(r+h,s+h*e,a-h,l-h*i,a,l,o,t.lastPoint1)}class Qi{constructor(t,e){this.context=t,this.startPoint=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){switch(this._point){case 2:this.context.lineTo(this._x1,this._y1,!1!==this._lastDefined1&&!1!==this._lastDefined2,this.lastPoint1);break;case 3:Ji(this,this._t0,Zi(this,this._t0),!1!==this._lastDefined1&&!1!==this._lastDefined2,this.lastPoint1)}(this._line||0!==this._line&&1===this._point)&&this.context.closePath(),this._line=1-this._line}point(t){let e=NaN;const i=t.x,o=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(i,o,!1!==this._lastDefined1&&!1!==this._lastDefined2,t):this.context.moveTo(i,o,t);break;case 1:this._point=2;break;case 2:this._point=3,Ji(this,Zi(this,e=qi(this,i,o)),e,!1!==this._lastDefined1&&!1!==this._lastDefined2);break;default:Ji(this,this._t0,e=qi(this,i,o),!1!==this._lastDefined1&&!1!==this._lastDefined2)}this._x0=this._x1,this._x1=i,this._y0=this._y1,this._y1=o,this._t0=e,this._lastDefined1=this._lastDefined2,this._lastDefined2=!1!==t.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}}class to extends Qi{constructor(t,e){super(t,e)}point(t){return super.point({y:t.x,x:t.y,defined:t.defined})}}function eo(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{direction:i,startPoint:o}=e;if(t.length<2-Number(!!o))return null;if(t.length<3-Number(!!o))return Ui(t,e);const n=ji("monotoneX",i,t);return function(t,e){Gi(t,e)}(new Qi(n,o),t),n}function io(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{direction:i,startPoint:o}=e;if(t.length<2-Number(!!o))return null;if(t.length<3-Number(!!o))return Ui(t,e);const n=ji("monotoneY",i,t);return function(t,e){Gi(t,e)}(new to(n,o),t),n}let oo=class{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,i=arguments.length>2?arguments[2]:void 0;this.context=t,this._t=e,this.startPoint=i}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x=this._y=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){0<this._t&&this._t<1&&2===this._point&&this.context.lineTo(this._x,this._y,!1!==this._lastDefined,this.lastPoint),(this._line||0!==this._line&&1===this._point)&&this.context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)}point(t){const e=t.x,i=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,!1!==this._lastDefined&&!1!==t.defined,t):this.context.moveTo(e,i,t);break;case 1:this._point=2;default:if(this._t<=0)this.context.lineTo(this._x,i,!1!==this._lastDefined&&!1!==t.defined,this.lastPoint),this.context.lineTo(e,i,!1!==this._lastDefined&&!1!==t.defined,t);else{const o=this._x*(1-this._t)+e*this._t;this.context.lineTo(o,this._y,!1!==this._lastDefined&&!1!==t.defined,this.lastPoint),this.context.lineTo(o,i,!1!==this._lastDefined&&!1!==t.defined,t)}}this._lastDefined=t.defined,this._x=e,this._y=i,this.lastPoint=t}tryUpdateLength(){return this.context.tryUpdateLength()}};function no(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{direction:o,startPoint:n}=i;if(t.length<2-Number(!!n))return null;const r=new Wi("step",null!=o?o:re(t[t.length-1].x-t[0].x)>re(t[t.length-1].y-t[0].y)?Ai.ROW:Ai.COLUMN);return function(t,e){Gi(t,e)}(new oo(r,e,n),t),r}class ro extends Vi{lineEnd(){this.context.closePath()}}function so(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{direction:i,startPoint:o}=e;if(t.length<2-Number(!!o))return null;const n=ji("linear",i,t);return function(t,e){Gi(t,e)}(new ro(n,o),t),n}function ao(t,e,i,o,n){let r=t._x1,s=t._y1,a=t._x2,l=t._y2;if(t._l01_a>te){const e=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,i=3*t._l01_a*(t._l01_a+t._l12_a);r=(r*e-t._x0*t._l12_2a+t._x2*t._l01_2a)/i,s=(s*e-t._y0*t._l12_2a+t._y2*t._l01_2a)/i}if(t._l23_a>te){const o=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,n=3*t._l23_a*(t._l23_a+t._l12_a);a=(a*o+t._x1*t._l23_2a-e*t._l12_2a)/n,l=(l*o+t._y1*t._l23_2a-i*t._l12_2a)/n}t.context.bezierCurveTo(r,s,a,l,t._x2,t._y2,o,t.lastPoint1)}function lo(t,e){return function(i,o){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{direction:r,startPoint:s}=n;if(i.length<2-Number(!!s))return null;if(i.length<3-Number(!!s))return Ui(i,n);const a=ji(t,r,i);return Gi(new e(a,o,s),i),a}}const ho=lo("catmullRom",class{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,i=arguments.length>2?arguments[2]:void 0;this.context=t,this.startPoint=i,this._alpha=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0}lineEnd(){switch(this._point){case 2:this.context.lineTo(this._x2,this._y2,!1!==this._lastDefined1&&!1!==this._lastDefined2,this.lastPoint1);break;case 3:this.point({x:this._x2,y:this._y2})}(this._line||0!==this._line&&1===this._point)&&this.context.closePath(),this._line=1-this._line}point(t){const{x:e,y:i}=t;if(this._point){const t=this._x2-e,o=this._y2-i;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(t*t+o*o,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,!1!==this._lastDefined1&&!1!==this._lastDefined2):this.context.moveTo(e,i);break;case 1:this._point=2;break;case 2:this._point=3;default:ao(this,e,i,!1!==this._lastDefined1&&!1!==this._lastDefined2)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=i,this._lastDefined1=this._lastDefined2,this._lastDefined2=t.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}});const co=lo("catmullRomClosed",class{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,i=arguments.length>2?arguments[2]:void 0;this.context=t,this.startPoint=i,this._alpha=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0}lineEnd(){switch(this._point){case 1:this.context.moveTo(this._x3,this._y3,this.lastPoint1),this.context.closePath();break;case 2:this.context.lineTo(this._x3,this._y3,!1!==this._lastDefined1&&!1!==this._lastDefined2,this.lastPoint1),this.context.closePath();break;case 3:this.point({x:this._x3,y:this._y3}),this.point({x:this._x4,y:this._y4}),this.point({x:this._x5,y:this._y5})}}point(t){const{x:e,y:i}=t;if(this._point){const t=this._x2-e,o=this._y2-i;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(t*t+o*o,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=i;break;case 1:this._point=2,this.context.moveTo(this._x4=e,this._y4=i,t);break;case 2:this._point=3,this._x5=e,this._y5=i;break;default:ao(this,e,i,!1!==this._lastDefined1&&!1!==this._lastDefined2)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=i,this._lastDefined1=this._lastDefined2,this._lastDefined2=t.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}});function uo(t,e,i){var o,n;switch(e){case"linear":default:return Ui(t,i);case"basis":return Yi(t,i);case"monotoneX":return eo(t,i);case"monotoneY":return io(t,i);case"step":return no(t,.5,i);case"stepBefore":return no(t,0,i);case"stepAfter":return no(t,1,i);case"catmullRom":return ho(t,null!==(o=null==i?void 0:i.curveTension)&&void 0!==o?o:.5,i);case"catmullRomClosed":return co(t,null!==(n=null==i?void 0:i.curveTension)&&void 0!==n?n:.5,i);case"linearClosed":return so(t,i)}}class go extends ei{constructor(t){super(),this.commandList=[],t&&(this._ctx=t),this._boundsContext=new ti(this.bounds)}setCtx(t){this._ctx=t}moveTo(t,e){return this.commandList.push([di,t,e]),this._ctx&&this._ctx.moveTo(t,e),this}lineTo(t,e){return this.commandList.push([hi,t,e]),this._ctx&&this._ctx.lineTo(t,e),this}quadraticCurveTo(t,e,i,o){return this.commandList.push([ci,t,e,i,o]),this._ctx&&this._ctx.quadraticCurveTo(t,e,i,o),this}bezierCurveTo(t,e,i,o,n,r){return this.commandList.push([si,t,e,i,o,n,r]),this._ctx&&this._ctx.bezierCurveTo(t,e,i,o,n,r),this}arcTo(t,e,i,o,n){return this.commandList.push([ri,t,e,i,o,n]),this._ctx&&this._ctx.arcTo(t,e,i,o,n),this}ellipse(t,e,i,o,n,r,s,a){return this.commandList.push([li,t,e,i,o,n,r,s,a]),this._ctx&&this._ctx.ellipse(t,e,i,o,n,r,s,a),this}rect(t,e,i,o){return this.commandList.push([ui,t,e,i,o]),this._ctx&&this._ctx.rect(t,e,i,o),this}arc(t,e,i,o,n,r){return this.commandList.push([ni,t,e,i,o,n,r]),this._ctx&&this._ctx.arc(t,e,i,o,n,r),this}closePath(){return this.commandList.push([ai]),this._ctx&&this._ctx.closePath(),this}addCurve(t){this.curves.push(t)}clear(){this.transformCbList=null,this.commandList.length=0,this.curves.length=0}beginPath(){this.clear()}toString(){if(!this.toStringCbList){const t=[];t[di]=t=>`M${t[1]} ${t[2]}`,t[hi]=t=>`L${t[1]} ${t[2]}`,t[ci]=t=>`Q${t[1]} ${t[2]} ${t[3]} ${t[4]}`,t[si]=t=>`C${t[1]} ${t[2]} ${t[3]} ${t[4]} ${t[5]} ${t[6]}`,t[ni]=t=>{const e=[];((t,e,i,o,n,r,s)=>{const a=Math.abs(i-e),l=a>.5*Math.PI?Math.ceil(2*a/Math.PI):1,h=(i-e)/l;for(let i=0;i<l;i++){const a=e+h*i,l=e+h*(i+1),d=4*Math.tan(Math.abs(h)/4)/3,c=l<a?-1:1,u=Math.cos(a),g=Math.sin(a),p=Math.cos(l),f=Math.sin(l),v=u*r+o,b=g*s+n,m=p*r+o,y=f*s+n,C=r*d*c,w=s*d*c;t.push(v-C*g,b+w*u,m+C*f,y-w*p,m,y)}})(e,t[4],t[5],t[1],t[2],t[3],t[3]);let i="";for(let t=0;t<e.length;t+=6)i+=`C${e[t]} ${e[t+1]} ${e[t+2]} ${e[t+3]} ${e[t+4]} ${e[t+5]}`;return i},t[ui]=t=>`M${t[1]} ${t[2]} h${t[3]} v${t[4]} H${t[1]}Z`,t[ai]=t=>"Z",this.toStringCbList=t}const t=this.toStringCbList;let e="";return this.commandList.forEach((i=>{e+=t[i[0]](i)})),e}fromString(t,e,i,o,n){this.clear();const r=function(t){if(!t)return[];const e=t.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);if(null===e)return[];let i,o;const n=[];for(let t=0,r=e.length;t<r;t++)if(gi=e[t],pi=gi.slice(1),fi=gi[0],i=[fi],o=pi.match(ii),null!==o){for(let t=0,e=o.length;t<e;t++)vi=o[t],bi=parseFloat(vi),Number.isNaN(bi)||i.push(bi);if(mi=oi[fi],i.length-1>mi){let t,e=fi;for(let o=1,r=i.length;o<r;o+=mi){t=[e];for(let e=o,n=o+mi;e<n;e++)t.push(i[e]);n.push(t),"m"===e?e="l":"M"===e&&(e="L")}}else n.push(i)}else n.push(i);return n}(t);return this._runCommandStrList(r,e,i,o,n),this._updateBounds(),this}fromLine(t){const{points:e,curveType:i,clipRangeByDimension:o}=t.attribute;if(!e)return;const n=uo(e,i);"x"===o?this.direction=Ai.ROW:"y"===o?this.direction=Ai.COLUMN:"auto"===o&&(this.direction=n.direction),this.curves=n.curves}fromCustomPath2D(t,e,i,o,n){return this.clear(),this._runCommandList(t.commandList,e,i,o,n),this._updateBounds(),this}transform(t,e,i,o){const n=this.commandList;if(!this.transformCbList){const t=[];t[di]=this.moveToTransform,t[hi]=this.lineToTransform,t[ci]=this.quadraticCurveToTransform,t[si]=this.bezierCurveToTransform,t[ri]=this.arcToTransform,t[li]=this.ellipseTransform,t[ui]=this.rectTransform,t[ni]=this.arcTransform,t[ai]=this.closePathTransform,this.transformCbList=t}n.forEach((n=>{this.transformCbList[n[0]](n,t,e,i,o)})),this._updateBounds()}moveToTransform(t,e,i,o,n){t[1]=t[1]*o+e,t[2]=t[2]*n+i}lineToTransform(t,e,i,o,n){t[1]=t[1]*o+e,t[2]=t[2]*n+i}quadraticCurveToTransform(t,e,i,o,n){t[1]=t[1]*o+e,t[2]=t[2]*n+i,t[3]=t[3]*o+e,t[4]=t[4]*n+i}bezierCurveToTransform(t,e,i,o,n){t[1]=t[1]*o+e,t[2]=t[2]*n+i,t[3]=t[3]*o+e,t[4]=t[4]*n+i,t[5]=t[5]*o+e,t[6]=t[6]*n+i}arcToTransform(t,e,i,o,n){t[1]=t[1]*o+e,t[2]=t[2]*n+i,t[3]=t[3]*o+e,t[4]=t[4]*n+i,t[5]=t[5]*(o+n)/2}ellipseTransform(t,e,i,o,n){t[1]=t[1]*o+e,t[2]=t[2]*n+i,t[3]=t[3]*o,t[4]=t[4]*n}rectTransform(t,e,i,o,n){t[1]=t[1]*o+e,t[2]=t[2]*n+i,t[3]=t[3]*o,t[4]=t[4]*n}arcTransform(t,e,i,o,n){t[1]=t[1]*o+e,t[2]=t[2]*n+i,t[3]=t[3]*(o+n)/2}closePathTransform(){}_runCommandStrList(t){let e,i,o,n,r,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,d=null,c=0,u=0,g=0,p=0;for(let f=0,v=t.length;f<v;++f){switch(e=t[f],1===l&&1===h||(e=fo(e,l,h)),e[0]){case"l":c+=e[1],u+=e[2],this.lineTo(c+s,u+a);break;case"L":c=e[1],u=e[2],this.lineTo(c+s,u+a);break;case"h":c+=e[1],this.lineTo(c+s,u+a);break;case"H":c=e[1],this.lineTo(c+s,u+a);break;case"v":u+=e[1],this.lineTo(c+s,u+a);break;case"V":u=e[1],this.lineTo(c+s,u+a);break;case"m":c+=e[1],u+=e[2],this.moveTo(c+s,u+a);break;case"M":c=e[1],u=e[2],this.moveTo(c+s,u+a);break;case"c":i=c+e[5],o=u+e[6],g=c+e[3],p=u+e[4],this.bezierCurveTo(c+e[1]+s,u+e[2]+a,g+s,p+a,i+s,o+a),c=i,u=o;break;case"C":c=e[5],u=e[6],g=e[3],p=e[4],this.bezierCurveTo(e[1]+s,e[2]+a,g+s,p+a,c+s,u+a);break;case"s":i=c+e[3],o=u+e[4],g=2*c-g,p=2*u-p,this.bezierCurveTo(g+s,p+a,c+e[1]+s,u+e[2]+a,i+s,o+a),g=c+e[1],p=u+e[2],c=i,u=o;break;case"S":i=e[3],o=e[4],g=2*c-g,p=2*u-p,this.bezierCurveTo(g+s,p+a,e[1]+s,e[2]+a,i+s,o+a),c=i,u=o,g=e[1],p=e[2];break;case"q":i=c+e[3],o=u+e[4],g=c+e[1],p=u+e[2],this.quadraticCurveTo(g+s,p+a,i+s,o+a),c=i,u=o;break;case"Q":i=e[3],o=e[4],this.quadraticCurveTo(e[1]+s,e[2]+a,i+s,o+a),c=i,u=o,g=e[1],p=e[2];break;case"t":i=c+e[1],o=u+e[2],null===d[0].match(/[QqTt]/)?(g=c,p=u):"t"===d[0]?(g=2*c-n,p=2*u-r):"q"===d[0]&&(g=2*c-g,p=2*u-p),n=g,r=p,this.quadraticCurveTo(g+s,p+a,i+s,o+a),c=i,u=o,g=c+e[1],p=u+e[2];break;case"T":i=e[1],o=e[2],g=2*c-g,p=2*u-p,this.quadraticCurveTo(g+s,p+a,i+s,o+a),c=i,u=o;break;case"a":ki(this,c+s,u+a,[e[1],e[2],e[3],e[4],e[5],e[6]+c+s,e[7]+u+a]),c+=e[6],u+=e[7];break;case"A":ki(this,c+s,u+a,[e[1],e[2],e[3],e[4],e[5],e[6]+s,e[7]+a]),c=e[6],u=e[7];break;case"z":case"Z":this.closePath()}d=e}}_runCommandList(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(0!==e||0!==i||1!==o||1!==n)for(let r=0,s=t.length;r<s;++r){const s=t[r].slice();switch(s[0]){case hi:this.lineToTransform(s,e,i,o,n);break;case di:this.moveToTransform(s,e,i,o,n);break;case si:this.bezierCurveToTransform(s,e,i,o,n);break;case ci:this.quadraticCurveToTransform(s,e,i,o,n);break;case ni:this.arcToTransform(s,e,i,o,n);break;case li:this.ellipseTransform(s,e,i,o,n);break;case ui:this.rectTransform(s,e,i,o,n);break;case ri:this.arcToTransform(s,e,i,o,n);break;case ai:this.closePath()}}else this.commandList=t.map((t=>t.slice()))}_updateBounds(){this.bounds.clear(),Li(this.commandList,this._boundsContext)}release(){this.commandList=[],this._boundsContext=null,this._ctx=null}getLength(){if(this.direction===Ai.COLUMN){if(!this.curves.length)return 0;const t=this.curves[0],e=this.curves[this.curves.length-1];return re(t.p0.y-e.p1.y)}if(this.direction===Ai.ROW){if(!this.curves.length)return 0;const t=this.curves[0],e=this.curves[this.curves.length-1];return re(t.p0.x-e.p1.x)}return this.curves.reduce(((t,e)=>t+e.getLength()),0)}getAttrAt(t){if(!this.curves)return{pos:{x:0,y:0},angle:0};let e,i=0;for(let o=0;o<this.curves.length;o++){e=this.curves[o];const n=e.getLength(this.direction);if(i+n>=t)break;i+=n}const o=(t-i)/e.getLength(this.direction);return{pos:e.getPointAt(o),angle:e.getAngleAt(o)}}}const po=["l",0,0,0,0,0,0,0];function fo(t,e,i){const o=po[0]=t[0];if("a"===o||"A"===o)po[1]=e*t[1],po[2]=i*t[2],po[3]=t[3],po[4]=t[4],po[5]=t[5],po[6]=e*t[6],po[7]=i*t[7];else if("h"===o||"H"===o)po[1]=e*t[1];else if("v"===o||"V"===o)po[1]=i*t[1];else for(let o=1,n=t.length;o<n;++o)po[o]=(o%2==1?e:i)*t[o];return po}const vo={x:0,y:0,z:0,dx:0,dy:0,dz:0,scrollX:0,scrollY:0,scaleX:1,scaleY:1,scaleZ:1,angle:0,alpha:0,beta:0,scaleCenter:[0,0],anchor:[0,0],anchor3d:[0,0],postMatrix:new Ie},bo={fillOpacity:1,fill:!1,shadowBlur:0,shadowColor:"black",shadowOffsetX:0,shadowOffsetY:0},mo={strokeOpacity:1,lineDash:[],lineDashOffset:0,lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:10,strokeBoundsBuffer:2,stroke:!1},yo=Object.assign({outerBorder:Object.assign(Object.assign({},mo),{distance:0}),innerBorder:Object.assign(Object.assign({},mo),{distance:0})},mo),Co={text:"",maxLineWidth:1/0,maxWidth:1/0,textAlign:"left",textBaseline:"alphabetic",fontSize:16,fontFamily:"PingFang SC,Microsoft Yahei,system-ui,-apple-system,segoe ui,\n    Roboto,Helvetica,Arial,sans-serif, apple color emoji,segoe ui emoji,segoe ui symbol",fontWeight:"",ellipsis:"…",fontVariant:"",fontStyle:"",lineHeight:void 0,underline:0,lineThrough:0,scaleIn3d:!1,direction:"horizontal",wordBreak:"break-all",ignoreBuf:!1,verticalMode:0,wrap:!1,whiteSpace:"no-wrap",heightLimit:1/0,lineClamp:1/0,suffixPosition:"end",underlineDash:[],underlineOffset:0,disableAutoClipedPoptip:void 0,measureMode:Y.fontBounding,keepCenterInLine:!1},wo=Object.assign(Object.assign(Object.assign(Object.assign({forceBoundsWidth:void 0,forceBoundsHeight:void 0,opacity:1,background:null,backgroundOpacity:1,backgroundCornerRadius:0,texture:null,textureColor:"black",textureSize:10,texturePadding:2,backgroundMode:"no-repeat",backgroundFit:!0,blur:0,cursor:null,html:null,react:null},bo),yo),{alignSelf:"auto"}),{pickStrokeBuffer:0}),xo={connectedType:"none",connectedStyle:{},connectedX:NaN,connectedY:NaN},_o=Object.assign(Object.assign(Object.assign({strokeSeg:null,renderable:!0,pickable:!0,shadowGraphic:void 0,childrenPickable:!0,fillPickable:!0,strokePickable:!0,visible:!0,zIndex:0,layout:null,boundsPadding:0,fillStrokeOrder:0,renderStyle:"default",pickMode:"accurate",customPickShape:null,boundsMode:"accurate",keepDirIn3d:!0,shadowRootIdx:1,globalZIndex:1,globalCompositeOperation:"",overflow:"hidden",shadowPickMode:"graphic",keepStrokeScale:!1},{_debug_bounds:!1}),wo),vo),So=Object.assign(Object.assign({},_o),{startAngle:0,endAngle:ne,innerRadius:0,outerRadius:1,innerPadding:0,outerPadding:0,cornerRadius:0,padRadius:0,padAngle:0,cap:!1,forceShowCap:!1}),Ao=Object.assign(Object.assign(Object.assign({},_o),xo),{points:[],segments:[],curveType:"linear",clipRange:1,closePath:!1,curveTension:1}),Bo=Object.assign(Object.assign({},_o),{radius:1,startAngle:0,endAngle:ne}),Ro=Object.assign(Object.assign({},_o),{width:0,height:0,cornerRadius:0,path:[],clip:!1,visibleAll:!0,display:"relative",flexDirection:"row",flexWrap:"wrap",justifyContent:"flex-start",alignItems:"flex-start",alignContent:"flex-start",baseOpacity:1}),To=Object.assign(Object.assign({},_o),{path:"",width:0,height:0,cornerRadius:0,clip:!1}),ko=Object.assign(Object.assign(Object.assign({},_o),xo),{points:[],segments:[],curveType:"linear",clipRange:1,clipRangeByDimension:"default",closePath:!1,curveTension:1}),Mo=Object.assign(Object.assign({},_o),{path:new go,fillStrokeOrder:1,customPath:()=>{Vt.getInstance().warn("空函数")}}),Lo=Object.assign(Object.assign({},_o),{points:[],cornerRadius:0,closePath:!0}),Po=Object.assign(Object.assign({},_o),{width:0,height:0,x1:0,y1:0,strokeBoundsBuffer:0,cornerRadius:0});Object.assign(Object.assign({},_o),{width:0,height:0,x1:0,y1:0,cornerRadius:0,length:0});const Eo=Object.assign(Object.assign({},_o),{symbolType:"circle",size:10,keepDirIn3d:!0}),Ho=Object.assign(Object.assign(Object.assign({},_o),Co),{strokeBoundsBuffer:0,keepDirIn3d:!0}),Fo=Object.assign(Object.assign(Object.assign({},_o),Co),{editable:!1,width:300,height:300,ellipsis:!0,wordBreak:"break-word",verticalDirection:"top",textAlign:"left",textBaseline:"top",layoutDirection:"horizontal",textConfig:[],disableAutoWrapLine:!1,maxHeight:void 0,maxWidth:void 0,singleLine:!1}),Oo=Object.assign(Object.assign({repeatX:"no-repeat",repeatY:"no-repeat",image:"",width:0,height:0},_o),{fill:!0,cornerRadius:0}),Io=Object.assign(Object.assign({},Oo),{backgroundShowMode:"never",backgroundWidth:0,backgroundHeight:0,textAlign:"left",textBaseline:"middle",direction:"horizontal",margin:0,id:"",width:20,height:20,backgroundFill:"rgba(101, 117, 168, 0.1)",backgroundFillOpacity:1,backgroundStroke:!1,backgroundStrokeOpacity:1,backgroundRadius:4,opacity:1});const zo=new class{},Do=function(){const t={linearGradient:/^(linear\-gradient)/i,radialGradient:/^(radial\-gradient)/i,conicGradient:/^(conic\-gradient)/i,sideOrCorner:/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,extentKeywords:/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,positionKeywords:/^(left|center|right|top|bottom)/i,pixelValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,percentageValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,emValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,angleValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,fromAngleValue:/^from\s*(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,startCall:/^\(/,endCall:/^\)/,comma:/^,/,hexColor:/(^\#[0-9a-fA-F]+)/,literalColor:/^([a-zA-Z]+)/,rgbColor:/^(rgb\(\d{1,3},\s*\d{1,3},\s*\d{1,3}\))/i,rgbaColor:/^(rgba\(\d{1,3},\s*\d{1,3},\s*\d{1,3},\s*((\d\.\d+)|\d{1,3})\))/i,number:/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/};let e="";function i(t){const i=new Error(e+": "+t);throw i.source=e,i}function o(){return n("linear",t.linearGradient,r)||n("radial",t.radialGradient,a)||n("conic",t.conicGradient,s)}function n(e,o,n){return function(o,r){const s=b(o);if(s){b(t.startCall)||i("Missing (");const o=function(o){const r=n();return r&&(b(t.comma)||i("Missing comma before color stops")),{type:e,orientation:r,colorStops:u(g)}}();return b(t.endCall)||i("Missing )"),o}}(o)}function r(){return v("directional",t.sideOrCorner,1)||v("angular",t.angleValue,1)}function s(){return v("angular",t.fromAngleValue,1)}function a(){let i,o,n=l();return n&&(i=[],i.push(n),o=e,b(t.comma)&&(n=l(),n?i.push(n):e=o)),i}function l(){let t=function(){const t=v("shape",/^(circle)/i,0);return t&&(t.style=f()||h()),t}()||function(){const t=v("shape",/^(ellipse)/i,0);return t&&(t.style=p()||h()),t}();if(t)t.at=d();else{const e=h();if(e){t=e;const i=d();i&&(t.at=i)}else{const e=c();e&&(t={type:"default-radial",at:e})}}return t}function h(){return v("extent-keyword",t.extentKeywords,1)}function d(){if(v("position",/^at/,0)){const t=c();return t||i("Missing positioning value"),t}}function c(){const t={x:p(),y:p()};if(t.x||t.y)return{type:"position",value:t}}function u(e){let o=e();const n=[];if(o)for(n.push(o);b(t.comma);)o=e(),o?n.push(o):i("One extra comma");return n}function g(){const e=v("hex",t.hexColor,1)||v("rgba",t.rgbaColor,1)||v("rgb",t.rgbColor,1)||v("literal",t.literalColor,0);return e||i("Expected color definition"),e.length=p(),e}function p(){return v("%",t.percentageValue,1)||v("position-keyword",t.positionKeywords,1)||f()}function f(){return v("px",t.pixelValue,1)||v("em",t.emValue,1)}function v(t,e,i){const o=b(e);if(o)return{type:t,value:o[i]}}function b(t){const i=/^[\n\r\t\s]+/.exec(e);i&&m(i[0].length);const o=t.exec(e);return o&&m(o[0].length),o}function m(t){e=e.substr(t)}return function(t){return e=t.toString(),function(){const t=u(o);return e.length>0&&i("Invalid input not EOF"),t}()}}();class Wo{static IsGradient(t){return!("string"==typeof t&&!t.includes("gradient"))}static IsGradientStr(t){return"string"==typeof t&&t.includes("gradient")}static Parse(t){if(Wo.IsGradientStr(t))try{const e=Do(t)[0];if(e){if("linear"===e.type)return Wo.ParseLinear(e);if("radial"===e.type)return Wo.ParseRadial(e);if("conic"===e.type)return Wo.ParseConic(e)}}catch(e){return t}return t}static ParseConic(t){const{orientation:e,colorStops:i=[]}=t,o=ee/2,n=parseFloat(e.value)/180*ee-o;return{gradient:"conical",x:.5,y:.5,startAngle:n,endAngle:n+ne,stops:i.map((t=>({color:t.value,offset:parseFloat(t.length.value)/100})))}}static ParseRadial(t){const{colorStops:e=[]}=t;return{gradient:"radial",x0:.5,y0:.5,x1:.5,y1:.5,r0:0,r1:1,stops:e.map((t=>({color:t.value,offset:parseFloat(t.length.value)/100})))}}static ParseLinear(t){const{orientation:e,colorStops:i=[]}=t,o=ee/2;let n="angular"===e.type?parseFloat(e.value)/180*ee:0;for(;n<0;)n+=ne;for(;n>=ne;)n-=ne;let r=0,s=0,a=0,l=0;return n<o?(r=0,s=1,a=Math.sin(n),l=s-Math.cos(n)):n<ee?(r=0,s=0,a=Math.cos(n-o),l=Math.sin(n-o)):n<ee+o?(r=1,s=0,a=r-Math.sin(n-ee),l=Math.cos(n-ee)):(r=1,a=r-Math.cos(n-o-ee),l-=Math.sin(n-o-ee)),{gradient:"linear",x0:r,y0:s,x1:a,y1:l,stops:i.map((t=>({color:t.value,offset:parseFloat(t.length.value)/100})))}}}function No(t,e,i){let o=e;const{a:n,b:r,c:s,d:a}=t.currentMatrix,l=Math.sign(n)*Math.sqrt(n*n+r*r),h=Math.sign(a)*Math.sqrt(s*s+a*a);return l+h===0?0:(o=o/Math.abs(l+h)*2*i,o)}function Go(t,e,i){let o,n,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(!e||!0===e)return"black";if(ht(e))for(let t=0;t<e.length&&(n=e[t],!n);t++);else n=e;if(n=Wo.Parse(n),"string"==typeof n)return n;if(i.AABBBounds&&(!i.attribute||0!==i.attribute.scaleX||0!==i.attribute.scaleY)){const e=i.AABBBounds;let a=e.x2-e.x1,l=e.y2-e.y1,h=e.x1-r,d=e.y1-s;if(i.attribute){const{scaleX:t=1,scaleY:e=1}=i.attribute;a/=t,l/=e,h/=t,d/=e}"linear"===n.gradient?o=function(t,e,i,o,n,r){var s,a,l,h;const d=t.createLinearGradient(i+(null!==(s=e.x0)&&void 0!==s?s:0)*n,o+(null!==(a=e.y0)&&void 0!==a?a:0)*r,i+(null!==(l=e.x1)&&void 0!==l?l:1)*n,o+(null!==(h=e.y1)&&void 0!==h?h:0)*r);return e.stops.forEach((t=>{d.addColorStop(t.offset,t.color)})),d}(t,n,h,d,a,l):"conical"===n.gradient?o=function(t,e,i,o,n,r){var s,a;const l=t.createConicGradient(i+(null!==(s=e.x)&&void 0!==s?s:0)*n,o+(null!==(a=e.y)&&void 0!==a?a:0)*r,e.startAngle,e.endAngle);return e.stops.forEach((t=>{l.addColorStop(t.offset,t.color)})),l.GetPattern(n+i,r+o,void 0)}(t,n,h,d,a,l):"radial"===n.gradient&&(o=function(t,e,i,o,n,r){var s,a,l,h,d,c;const u=t.createRadialGradient(i+(null!==(s=e.x0)&&void 0!==s?s:.5)*n,o+(null!==(a=e.y0)&&void 0!==a?a:.5)*r,Math.max(n,r)*(null!==(l=e.r0)&&void 0!==l?l:0),i+(null!==(h=e.x1)&&void 0!==h?h:.5)*n,o+(null!==(d=e.y1)&&void 0!==d?d:.5)*r,Math.max(n,r)*(null!==(c=e.r1)&&void 0!==c?c:.5));return e.stops.forEach((t=>{u.addColorStop(t.offset,t.color)})),u}(t,n,h,d,a,l))}return o||"orange"}const jo={horizontal:{width:"width",height:"height",left:"left",top:"top",x:"x",y:"y",bottom:"bottom"},vertical:{width:"height",height:"width",left:"top",top:"left",x:"y",y:"x",bottom:"right"}},Vo=!0,Uo=!1,$o=/\w|\(|\)|-/,Xo=/[.?!,;:/，。？！、；：]/,Yo=/\S/,Ko=(t,e)=>{let i=e.fontSize||16;switch(e.script){case"super":case"sub":i*=.8}t.setTextStyle({textAlign:"left",textBaseline:e.textBaseline||"alphabetic",fontStyle:e.fontStyle||"",fontWeight:e.fontWeight||"",fontSize:i,fontFamily:e.fontFamily})};function qo(t,e,i,o,n){if(!e||e<=0)return 0;const r=zo.graphicUtil.textMeasure;let s=o,a=t.slice(0,s),l=Math.floor(r.measureText(a,i).width),h=t.slice(0,s+1),d=Math.floor(r.measureText(h,i).width);for(;l>e||d<=e;){if(l>e?s--:s++,s>t.length){s=t.length;break}if(s<0){s=0;break}a=t.slice(0,s),l=Math.floor(r.measureText(a,i).width),h=t.slice(0,s+1),d=Math.floor(r.measureText(h,i).width)}return n&&(s=Zo(t,s)),s}function Zo(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=e;for(;$o.test(t[o-1])&&$o.test(t[o])||Xo.test(t[o]);)if(o--,o<=0)return i?Jo(t,e):e;return o}function Jo(t,e){let i=e;for(;$o.test(t[i-1])&&$o.test(t[i])||Xo.test(t[i]);)if(i++,i>=t.length)return i;return i}function Qo(t,e){const i=zo.graphicUtil.textMeasure.measureText(t,e),o={ascent:0,height:0,descent:0,width:0};return"number"!=typeof i.actualBoundingBoxAscent||"number"!=typeof i.actualBoundingBoxDescent?(o.width=Math.floor(i.width),o.height=e.fontSize||0,o.ascent=o.height,o.descent=0):(o.width=Math.floor(i.width),o.height=Math.floor(i.actualBoundingBoxAscent+i.actualBoundingBoxDescent),o.ascent=Math.floor(i.actualBoundingBoxAscent),o.descent=o.height-o.ascent),o}var tn=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let en=class{configure(t,e){this.canvas=t.canvas,this.context=t.context,t.bindTextMeasure(this)}_measureTextWithoutAlignBaseline(t,e,i){this.context.setTextStyleWithoutAlignBaseline(e);const o=this.context.measureText(t);return i?this.compatibleMetrics(o,e):o}_measureTextWithAlignBaseline(t,e,i){this.context.setTextStyle(e);const o=this.context.measureText(t);return i?this.compatibleMetrics(o,e):o}compatibleMetrics(t,e){if(null==t.actualBoundingBoxAscent||null==t.actualBoundingBoxDescent||null==t.fontBoundingBoxAscent||null==t.fontBoundingBoxDescent){t={width:t.width};const{ascent:i,descent:o}=this.measureTextBoundADscentEstimate(e);t.actualBoundingBoxAscent=i,t.actualBoundingBoxDescent=o,t.fontBoundingBoxAscent=i,t.fontBoundingBoxDescent=o}if(null==t.actualBoundingBoxLeft||null==t.actualBoundingBoxRight){t={width:t.width,actualBoundingBoxAscent:t.actualBoundingBoxAscent,actualBoundingBoxDescent:t.actualBoundingBoxDescent,fontBoundingBoxAscent:t.fontBoundingBoxAscent,fontBoundingBoxDescent:t.fontBoundingBoxDescent};const{left:i,right:o}=this.measureTextBoundLeftRightEstimate(e);t.actualBoundingBoxLeft=i,t.actualBoundingBoxRight=o}return t}estimate(t,e){let{fontSize:i=Ho.fontSize}=e,o=0,n=0;for(let e=0;e<t.length;e++)t.charCodeAt(e)<128?o++:n++;return{width:~~(.8*o*i+n*i),height:i}}measureTextWidth(t,e,i){return this.context?(i=null!=i?i:this._measureTextWithoutAlignBaseline(t,e)).width:this.estimate(t,e).width}measureTextBoundsWidth(t,e,i){return this.context?(i=null!=i?i:this._measureTextWithoutAlignBaseline(t,e)).width:this.estimate(t,e).width}measureTextBoundsLeftRight(t,e,i){return this.context?{left:(i=null!=i?i:this._measureTextWithAlignBaseline(t,e,!0)).actualBoundingBoxLeft,right:i.actualBoundingBoxRight}:this.measureTextBoundLeftRightEstimate(e)}measureTextPixelHeight(t,e,i){var o;return this.context?(i=null!=i?i:this._measureTextWithoutAlignBaseline(t,e,!0),Math.abs(i.actualBoundingBoxAscent-i.actualBoundingBoxDescent)):null!==(o=e.fontSize)&&void 0!==o?o:Co.fontSize}measureTextPixelADscent(t,e,i){return this.context?{ascent:(i=null!=i?i:this._measureTextWithAlignBaseline(t,e,!0)).actualBoundingBoxAscent,descent:i.actualBoundingBoxDescent}:this.measureTextBoundADscentEstimate(e)}measureTextBoundHieght(t,e,i){var o;return this.context?(i=null!=i?i:this._measureTextWithoutAlignBaseline(t,e,!0),Math.abs(i.fontBoundingBoxAscent-i.fontBoundingBoxDescent)):null!==(o=e.fontSize)&&void 0!==o?o:Co.fontSize}measureTextBoundADscent(t,e,i){return this.context?{ascent:(i=null!=i?i:this._measureTextWithAlignBaseline(t,e,!0)).fontBoundingBoxAscent,descent:i.fontBoundingBoxDescent}:this.measureTextBoundADscentEstimate(e)}measureTextBoundADscentEstimate(t){var e;const i=null!==(e=t.fontSize)&&void 0!==e?e:Co.fontSize;return{ascent:.79*i,descent:.21*i}}measureTextBoundLeftRightEstimate(t){var e;const i=null!==(e=t.fontSize)&&void 0!==e?e:Co.fontSize,{textAlign:o}=t;return"center"===o?{left:i/2,right:i/2}:"right"===o||"end"===o?{left:i,right:0}:{left:0,right:i}}measureTextPixelADscentAndWidth(t,e,i){if(!this.context)return Object.assign(Object.assign({},this.measureTextBoundADscentEstimate(e)),{width:this.estimate(t,e).width});const o=this._measureTextWithoutAlignBaseline(t,e,!0);if(i===Y.actualBounding)return{ascent:o.actualBoundingBoxAscent,descent:o.actualBoundingBoxDescent,width:o.width};if(i===Y.estimate)return Object.assign(Object.assign({},this.measureTextBoundADscentEstimate(e)),{width:o.width});if(i===Y.fontBounding){let t=o.fontBoundingBoxAscent,e=o.fontBoundingBoxDescent;if(o.actualBoundingBoxDescent&&e<o.actualBoundingBoxDescent){const i=o.actualBoundingBoxDescent-e;e+=i,t-=i}else if(o.actualBoundingBoxAscent&&t<o.actualBoundingBoxAscent){const i=o.actualBoundingBoxAscent-t;t+=i,e-=i}return{ascent:t,descent:e,width:o.width}}return{ascent:o.actualBoundingBoxAscent,descent:o.actualBoundingBoxDescent,width:o.width}}measureText(t,e){return this.context?(this.context.setTextStyleWithoutAlignBaseline(e),this.context.measureText(t)):this.estimate(t,e)}clipTextVertical(t,e,i,o){if(0===t.length)return{verticalList:t,width:0};const{fontSize:n=12}=e;t.forEach((t=>{t.width=0===t.direction?n:this.measureTextWidth(t.text,e)}));const r=[];let s=0,a=0;for(;a<t.length&&s+t[a].width<i;a++)s+=t[a].width,r.push(t[a]);if(t[a]&&t[a].text.length>1){const n=this._clipText(t[a].text,e,i-s,0,t[a].text.length-1,"end",!1);if(o&&n.str!==t[a].text){let i="",o=0;for(let e=0;e<a;e++){const n=t[e];i+=n.text,o+=n.text.length}i+=t[a].text;let r=Zo(i,o+n.str.length);r-=o,r!==n.str.length-1&&(n.str=n.str.substring(0,r),n.width=this.measureTextWidth(n.str,e))}r.push(Object.assign(Object.assign({},t[a]),{text:n.str,width:n.width})),s+=n.width}return{verticalList:r,width:s}}clipText(t,e,i,o,n){if(0===t.length)return{str:"",width:0};let r=this.measureTextWidth(t,e);if(r<=i)return{str:t,width:r};if(r=this.measureTextWidth(t[0],e),r>i)return{str:"",width:0};const s=this._clipText(t,e,i,0,t.length-1,"end",!1);if(o&&s.str!==t){let i=Zo(t,s.str.length,n);i!==s.str.length&&(i>s.str.length&&(s.wordBreaked=i,i=s.str.length),s.str=t.substring(0,i),s.width=this.measureTextWidth(s.str,e))}return s}_clipText(t,e,i,o,n,r,s){let a;if("start"===r)a=this._clipTextStart(t,e,i,o,n),s&&(a.result=s+a.str);else if("middle"===r){const o=this._clipTextMiddle(t,e,i,"","",0,0,1);a={str:"none",width:o.width,result:o.left+s+o.right}}else a=this._clipTextEnd(t,e,i,o,n),s&&(a.result=a.str+s);return a}_clipTextEnd(t,e,i,o,n){if(o===n){Vt.getInstance().warn(`【_clipTextEnd】不应该走到这里${t}, ${o}, ${n}`);const i=t.substring(0,n+1);return{str:i,width:this.measureTextWidth(i,e)}}const r=Math.floor((o+n)/2),s=t.substring(0,r+1),a=this.measureTextWidth(s,e);let l;if(a>i){if(s.length<=1)return{str:"",width:0};const n=t.substring(0,r);return l=this.measureTextWidth(n,e),l<=i?{str:n,width:l}:this._clipTextEnd(t,e,i,o,r)}if(a<i){if(r>=t.length-1)return{str:t,width:this.measureTextWidth(t,e)};const o=t.substring(0,r+2);return l=this.measureTextWidth(o,e),l>=i?{str:s,width:a}:this._clipTextEnd(t,e,i,r,n)}return{str:s,width:a}}_clipTextStart(t,e,i,o,n){const r=Math.ceil((o+n)/2),s=t.substring(r-1,t.length),a=this.measureTextWidth(s,e);let l;if(a>i){if(s.length<=1)return{str:"",width:0};const o=t.substring(r,t.length);return l=this.measureTextWidth(o,e),l<=i?{str:o,width:l}:this._clipTextStart(t,e,i,r,t.length)}if(a<i){if(r<=0)return{str:t,width:this.measureTextWidth(t,e)};const n=t.substring(r-2,t.length);return l=this.measureTextWidth(n,e),l>=i?{str:s,width:a}:this._clipTextStart(t,e,i,o,r)}return{str:s,width:a}}_clipTextMiddle(t,e,i,o,n,r,s,a){const l=t.substring(0,a),h=this.measureTextWidth(l,e);if(h+s>i)return{left:o,right:n,width:r+s};const d=t.substring(t.length-a,t.length),c=this.measureTextWidth(d,e);return h+c>i?{left:l,right:n,width:h+s}:this._clipTextMiddle(t,e,i,l,d,h,c,a+1)}clipTextWithSuffixVertical(t,e,i,o,n,r){if(""===o)return this.clipTextVertical(t,e,i,n);if(0===t.length)return{verticalList:t,width:0};const s=this.clipTextVertical(t,e,i,n);if(s.verticalList.length===t.length&&s.verticalList[s.verticalList.length-1].width===t[t.length-1].width)return s;const a=this.measureTextWidth(o,e);if(a>i)return s;let l;if(i-=a,"start"===r){const r=this.revertVerticalList(t);l=this.clipTextVertical(r,e,i,n);const s=this.revertVerticalList(l.verticalList);s.unshift({text:o,direction:1,width:a}),l.verticalList=s}else if("middle"===r){const r=this.clipTextVertical(t,e,i/2,n),s=this.revertVerticalList(t),h=this.clipTextVertical(s,e,i/2,n);r.verticalList.push({text:o,direction:1,width:a}),this.revertVerticalList(h.verticalList).forEach((t=>r.verticalList.push(t))),l={verticalList:r.verticalList,width:r.width+h.width}}else l=this.clipTextVertical(t,e,i,n),l.verticalList.push({text:o,direction:1,width:a});return l.width+=a,l}revertVerticalList(t){return t.reverse().map((t=>{const e=t.text.split("").reverse().join("");return Object.assign(Object.assign({},t),{text:e})}))}clipTextWithSuffix(t,e,i,o,n,r){let s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(""===o)return this.clipText(t,e,i,n);if(0===t.length)return{str:"",width:0};const a=this.measureTextWidth(t,e);if(!s&&a<=i)return{str:t,width:a};const l=this.measureTextWidth(o,e);if(l>i)return{str:"",width:0};if(s&&a+l<=i)return{str:t+o,width:a+l};i-=l;const h=this._clipText(t,e,i,0,t.length-1,r,o);if(n&&h.str!==t){const i=Zo(t,h.str.length);i!==h.str.length&&(h.result=t.substring(0,i),h.width=this.measureTextWidth(h.str,e))}else s&&h.str===t&&(h.result=t+o);return h.str=h.result,h.width+=l,h}};en=tn([C()],en);var on=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};const nn=Symbol.for("TextMeasureContribution");let rn=class extends en{};rn=on([C()],rn);const sn=new class{constructor(t){const e=t||{};e.defaultScope=e.defaultScope||_,this.options=e,this.id=s.GenAutoIncrementId(),this._bindingDictionary=new Map,this._metadataReader=new L}load(t){const e=this._getContainerModuleHelpersFactory()(t.id);t.registry(e.bindFunction,e.unbindFunction,e.isboundFunction,e.rebindFunction)}get(t){const e=this._getNotAllArgs(t,!1);return this._get(e)}getAll(t){const e=this._getAllArgs(t);return this._get(e)}getTagged(t,e,i){const o=this._getNotAllArgs(t,!1,e,i);return this._get(o)}getNamed(t,e){return this.getTagged(t,l,e)}isBound(t){return this._bindingDictionary.has(t)}bind(t){const e=this.options.defaultScope,i=new M(t,e),o=this._bindingDictionary.get(t)||[];return o.push(i),this._bindingDictionary.set(t,o),new F(i)}unbind(t){this._bindingDictionary.delete(t)}rebind(t){return this.unbind(t),this.bind(t)}_getContainerModuleHelpersFactory(){const t=(t,e)=>{t._binding.moduleId=e},e=e=>i=>{const o=this.bind(i);return t(o,e),o},i=()=>t=>this.unbind(t),o=()=>t=>this.isBound(t),n=e=>i=>{const o=this.rebind(i);return t(o,e),o};return t=>({bindFunction:e(t),isboundFunction:o(),rebindFunction:n(t),unbindFunction:i(),unbindAsyncFunction:t=>null})}_getNotAllArgs(t,e,i,o){return{avoidConstraints:!1,isMultiInject:e,serviceIdentifier:t,key:i,value:o}}_getAllArgs(t){return{avoidConstraints:!0,isMultiInject:!0,serviceIdentifier:t}}_get(t){const e=[];return this._bindingDictionary.get(t.serviceIdentifier).filter((e=>e.constraint(t))).forEach((t=>{e.push(this._resolveFromBinding(t))})),t.isMultiInject||1!==e.length?e:e[0]}_getChildRequest(t){const e=t.implementationType,{userGeneratedMetadata:i}=this._metadataReader.getConstructorMetadata(e),o=Object.keys(i),n=[];for(let t=0;t<o.length;t++){const e=i[t],o={};e.forEach((t=>{o[t.key]=t.value}));const r={inject:o[h],multiInject:o[d]},s=r.inject||r.multiInject,a={serviceIdentifier:s,constructorArgsMetadata:e},l={injectIdentifier:s,metadata:e,bindings:this._bindingDictionary.get(s).filter((t=>t.constraint(a)))};n.push(l)}return n}_resolveFromBinding(t){const e=this._getResolvedFromBinding(t);return this._saveToScope(t,e),e}_getResolvedFromBinding(t){let e;switch(t.type){case S:case R:e=t.cache;break;case T:e=this._resolveInstance(t,t.implementationType);break;default:e=t.dynamicValue({container:this})}return e}_resolveInstance(t,e){if(t.activated)return t.cache;const i=this._getChildRequest(t);return this._createInstance(e,i)}_createInstance(t,e){return e.length?new t(...this._resolveRequests(e)):new t}_resolveRequests(t){return t.map((t=>t.bindings.length>1?t.bindings.map((t=>this._resolveFromBinding(t))):this._resolveFromBinding(t.bindings[0])))}_saveToScope(t,e){t.scope===x&&(t.cache=e,t.activated=!0)}},an=Symbol.for("CanvasFactory"),ln=Symbol.for("Context2dFactory");function hn(t){return sn.getNamed(an,zo.global.env)(t)}const dn=new class{constructor(){this.pools=[],this.allocatedCanvas=[]}shareCanvas(){return this.allocatedCanvas.length?this.allocatedCanvas[0]:this.getCommonCanvas()}getCommonCanvas(){return this._commonCanvas||(this._commonCanvas=this.allocate({width:100,height:100,dpr:2})),this._commonCanvas}allocate(t){if(!this.pools.length){const e=hn(Object.assign({nativeCanvas:zo.global.createCanvas(t)},t));return this.allocatedCanvas.push(e),e}const e=this.pools.pop();return e.resize(t.width,t.height),e.dpr=t.dpr,e}allocateByObj(t){if(!this.pools.length){const e={width:t.width/t.dpr,height:t.height/t.dpr,dpr:t.dpr},i=hn(Object.assign({nativeCanvas:zo.global.createCanvas(e)},e));return this.allocatedCanvas.push(i),i}const e=this.pools.pop();return e.width=t.width,e.height=t.height,e}free(t){this.pools.push(t)}get length(){return this.pools.length}release(){this.pools=[]}};var cn=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},un=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};const gn=Symbol.for("VWindow"),pn=Symbol.for("WindowHandlerContribution");let fn=class{get width(){if(this._handler){const t=this._handler.getWH();return this._width=t.width}return this._width}get height(){if(this._handler){const t=this._handler.getWH();return this._height=t.height}return this._height}get dpr(){return this._handler.getDpr()}constructor(){this.hooks={onChange:new W(["x","y","width","height"])},this.active=()=>{const t=this.global;t.env&&!this.actived&&(sn.getNamed(pn,t.env).configure(this,t),this.actived=!0)},this._uid=s.GenAutoIncrementId(),this.global=zo.global,this.postInit()}postInit(){this.global.hooks.onSetEnv.tap("window",this.active),this.active()}get style(){var t;return null!==(t=this._handler.getStyle())&&void 0!==t?t:{}}set style(t){this._handler.setStyle(t)}create(t){var e,i;this._handler.createWindow(t);const o=this._handler.getWH();this._width=o.width,this._height=o.height,t.viewBox?this.setViewBox(t.viewBox):!1!==t.canvasControled?this.setViewBox({x1:0,y1:0,x2:this._width,y2:this._height}):this.setViewBox({x1:0,y1:0,x2:null!==(e=t.width)&&void 0!==e?e:this._width,y2:null!==(i=t.height)&&void 0!==i?i:this._height}),this.title=this._handler.getTitle(),this.resizable=!0}setWindowHandler(t){this._handler=t}setDpr(t){return this._handler.setDpr(t)}resize(t,e){return this._handler.resizeWindow(t,e)}configure(){throw new Error("暂不支持")}release(){return this.global.hooks.onSetEnv.unTap("window",this.active),this._handler.releaseWindow()}getContext(){return this._handler.getContext()}getNativeHandler(){return this._handler.getNativeHandler()}getImageBuffer(t){return this._handler.getImageBuffer?this._handler.getImageBuffer(t):null}addEventListener(t,e,i){return this._handler.addEventListener(t,e,i)}removeEventListener(t,e,i){return this._handler.removeEventListener(t,e,i)}dispatchEvent(t){return this._handler.dispatchEvent(t)}getBoundingClientRect(){return this._handler.getBoundingClientRect()}getContainer(){return this._handler.container}clearViewBox(t){this._handler.clearViewBox(t)}setViewBox(t){this._handler.setViewBox(t)}setViewBoxTransform(t,e,i,o,n,r){this._handler.setViewBoxTransform(t,e,i,o,n,r)}getViewBox(){return this._handler.getViewBox()}getViewBoxTransform(){return this._handler.getViewBoxTransform()}pointTransform(t,e){const i=this._handler.getViewBox(),o={x:t,y:e};return this._handler.getViewBoxTransform().transformPoint({x:t,y:e},o),o.x-=i.x1,o.y-=i.y1,o}hasSubView(){const t=this._handler.getViewBox();return!(0===t.x1&&0===t.y1&&Ut(this.width,t.width())&&Ut(this.height,t.height()))}isVisible(t){return this._handler.isVisible(t)}onVisibleChange(t){return this._handler.onVisibleChange(t)}getTopLeft(t){return this._handler.getTopLeft(t)}};fn=cn([C(),un("design:paramtypes",[])],fn);var vn=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},bn=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},mn=function(t,e){return function(i,o){e(i,o,t)}};let yn=class{get canvas(){return this.tryInitCanvas(),this._canvas}get context(){return this.tryInitCanvas(),this._context}constructor(t){this.contributions=t,this.configured=!1,this.global=zo.global,this.global.hooks.onSetEnv.tap("graphic-util",((t,e,i)=>{this.configured=!1,this.configure(i,e)}))}get textMeasure(){return this._textMeasure||this.configure(this.global,this.global.env),this._textMeasure}configure(t,e){this.configured||(this.contributions.getContributions().forEach((t=>{t.configure(this,e)})),this.configured=!0)}tryInitCanvas(){if(!this._canvas){const t=dn.shareCanvas();this._canvas=t,this._context=t.getContext("2d")}}bindTextMeasure(t){this._textMeasure=t}measureText(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"native";var o;this.configure(this.global,this.global.env);const n=this.global.measureTextMethod;this.global.measureTextMethod=i;const r={width:this._textMeasure.measureTextWidth(t,e),height:null!==(o=e.fontSize)&&void 0!==o?o:Co.fontSize};return this.global.measureTextMethod=n,r}createTextMeasureInstance(t,e,i){return this.configure(this.global,this.global.env),new Pe(Object.assign({defaultFontParams:{fontFamily:Co.fontFamily,fontSize:Co.fontSize},getCanvasForMeasure:i||(()=>this.canvas),getTextBounds:void 0,specialCharSet:"-/: .,@%'\"~"+Pe.ALPHABET_CHAR_SET+Pe.ALPHABET_CHAR_SET.toUpperCase()},null!=e?e:{}),t)}drawGraphicToCanvas(t,e,i){if(!e.defaultLayer)return null;const o=sn.get(gn),n=t.AABBBounds,r=n.width(),s=n.height(),a=-n.x1,l=-n.y1;o.create({viewBox:{x1:a,y1:l,x2:n.x2,y2:n.y2},width:r,height:s,canvas:i,dpr:e.window.dpr,canvasControled:!0,offscreen:!0,title:""});const h=e.params.optimize.disableCheckGraphicWidthOutRange;e.params.optimize.disableCheckGraphicWidthOutRange=!0,e.defaultLayer.getNativeHandler().drawTo(o,[t],{transMatrix:o.getViewBoxTransform(),viewBox:o.getViewBox(),stage:e,layer:e.defaultLayer,renderService:e.renderService,background:"transparent",clear:!0,updateBounds:!1}),e.params.optimize.disableCheckGraphicWidthOutRange=h;const d=o.getNativeHandler();return d.nativeCanvas?d.nativeCanvas:null}};var Cn;yn=vn([C(),mn(0,m(O)),mn(0,w(nn)),bn("design:paramtypes",[Object])],yn),function(t){t[t.transform=0]="transform",t[t.matrix=1]="matrix"}(Cn||(Cn={}));const wn=new Ie;let xn=class{constructor(){this.matrix=new Ie}init(t){return this.mode=Cn.transform,this.originTransform=t,this.matrix.reset(),this}fromMatrix(t,e){return this.mode=Cn.matrix,this.outSourceMatrix=t,this.outTargetMatrix=e,this}scaleMatrix(t,e,i){const o=this.outSourceMatrix;if(wn.setValue(o.a,o.b,o.c,o.d,o.e,o.f),this.outTargetMatrix.reset(),i){const{x:o,y:n}=i;this.outTargetMatrix.translate(o,n),this.outTargetMatrix.scale(t,e),this.outTargetMatrix.translate(-o,-n)}else this.outTargetMatrix.scale(t,e);return this.outTargetMatrix.multiply(wn.a,wn.b,wn.c,wn.d,wn.e,wn.f),this}rotateMatrix(t,e){const i=this.outSourceMatrix;if(wn.setValue(i.a,i.b,i.c,i.d,i.e,i.f),this.outTargetMatrix.reset(),e){const{x:i,y:o}=e;this.outTargetMatrix.translate(i,o),this.outTargetMatrix.rotate(t),this.outTargetMatrix.translate(-i,-o)}else this.outTargetMatrix.rotate(t);return this.outTargetMatrix.multiply(wn.a,wn.b,wn.c,wn.d,wn.e,wn.f),this}scale(t,e,i){return this.mode===Cn.matrix?this.scaleMatrix(t,e,i):this}rotate(t,e){return this.mode===Cn.matrix?this.rotateMatrix(t,e):this}translateMatrix(t,e){const i=this.outSourceMatrix;return wn.setValue(i.a,i.b,i.c,i.d,i.e,i.f),this.outTargetMatrix.reset(),this.outTargetMatrix.translate(t,e),this.outTargetMatrix.multiply(wn.a,wn.b,wn.c,wn.d,wn.e,wn.f),this}translate(t,e){return this.mode===Cn.matrix?this.translateMatrix(t,e):this}simplify(t){return this.mode===Cn.matrix?this.simplifyMatrix(t):this}simplifyMatrix(t){return this}};xn=vn([C(),bn("design:paramtypes",[])],xn);const _n={arc:So,area:Ao,circle:Bo,line:ko,path:Mo,symbol:Eo,text:Ho,rect:Po,polygon:Lo,richtext:Fo,richtextIcon:Io,image:Oo,group:Ro,glyph:To},Sn=Object.keys(_n);function An(t,e){Object.keys(e).forEach((i=>{t[i]=e[i]}))}const Bn={arc:Object.assign({},_n.arc),area:Object.assign({},_n.area),circle:Object.assign({},_n.circle),line:Object.assign({},_n.line),path:Object.assign({},_n.path),symbol:Object.assign({},_n.symbol),text:Object.assign({},_n.text),rect:Object.assign({},_n.rect),polygon:Object.assign({},_n.polygon),richtext:Object.assign({},_n.richtext),richtextIcon:Object.assign({},_n.richtextIcon),image:Object.assign({},_n.image),group:Object.assign({},_n.group),glyph:Object.assign({},_n.glyph)};class Rn{constructor(){this.initTheme(),this.dirty=!1}initTheme(){this._defaultTheme={},Sn.forEach((t=>{this._defaultTheme[t]=Object.create(Bn[t])})),this.combinedTheme=this._defaultTheme}getTheme(t){if(!t)return this.combinedTheme;if(!this.dirty)return this.combinedTheme;let e={};const i=this.getParentWithTheme(t);return i&&(e=i.theme),this.applyTheme(t,e),this.combinedTheme}getParentWithTheme(t){for(;t.parent;)if((t=t.parent).theme)return t;return null}applyTheme(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.dirty){const o=this.getParentWithTheme(t);if(o){const t=o.theme;(t.dirty||i)&&t.applyTheme(o,e,!0)}this.userTheme?this.doCombine(o&&o.theme.combinedTheme):(o?this.combinedTheme=o.theme.combinedTheme:(this.combinedTheme=this._defaultTheme,Vt.getInstance().warn("未知错误，走到不应该走的区域里")),this.dirty=!1)}return this.combinedTheme}doCombine(t){const e=this.userTheme,i=this.combinedTheme;Sn.forEach((o=>{const n=Object.create(Bn[o]);t&&t[o]&&An(n,t[o]),i[o]&&An(n,i[o]),e[o]&&An(n,e[o]),this.combinedTheme[o]=n})),e.common&&Sn.forEach((t=>{An(this.combinedTheme[t],e.common)})),this.dirty=!1}setTheme(t,e){let i=this.userTheme;i?Object.keys(t).forEach((e=>{i[e]?Object.assign(i[e],t[e]):i[e]=Object.assign({},t[e])})):i=t,this.userTheme=i,this.dirty=!0,this.dirtyChildren(e)}resetTheme(t,e){this.userTheme=t,this.dirty=!0,this.dirtyChildren(e)}dirtyChildren(t){t.forEachChildren((t=>{t.isContainer&&(t.theme&&(t.theme.dirty=!0),this.dirtyChildren(t))}))}}const Tn=new Rn;function kn(t,e){return t.glyphHost?kn(t.glyphHost):e?(t.isContainer,e):function(t){let e;if(e=t.isContainer?t:t.parent,e){for(;e&&!e.theme;)e=e.parent;return e?(e.theme||e.createTheme(),e.theme.getTheme(e)):Tn.getTheme()}return null}(t)||t.attachedThemeGraphic&&kn(t.attachedThemeGraphic)||Tn.getTheme()}var Mn=function(t,e,i,o){return new(i||(i=Promise))((function(n,r){function s(t){try{l(o.next(t))}catch(t){r(t)}}function a(t){try{l(o.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((o=o.apply(t,e||[])).next())}))};class Ln extends J{get previousSibling(){return this._prev}get nextSibling(){return this._next}get children(){return this.getChildren()}get firstChild(){return this._firstChild}get lastChild(){return this._lastChild}get count(){return this._count}get childrenCount(){return this._idMap?this._idMap.size:0}constructor(){super(),this._uid=s.GenAutoIncrementId(),this._firstChild=null,this._lastChild=null,this.parent=null,this._count=1}forEachChildren(t){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]){let e=this._lastChild,i=0;for(;e;){if(t(e,i++))return;e=e._prev}}else{let e=this._firstChild,i=0;for(;e;){if(t(e,i++))return;e=e._next}}}forEachChildrenAsync(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Mn(this,void 0,void 0,(function*(){if(e){let e=this._lastChild,i=0;for(;e;){let o=t(e,i++);if(o.then&&(o=yield o),o)return;e=e._prev}}else{let e=this._firstChild,i=0;for(;e;){let o=t(e,i++);if(o.then&&(o=yield o),o)return;e=e._next}}}))}forEach(t){return this.forEachChildren(t)}appendChild(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this._uid===t._uid)return null;if(!e&&t.isAncestorsOf(this))throw new Error("【Node::appendChild】不能将父辈元素append为子元素");return t.parent&&t.parent.removeChild(t),t.parent=this,this._lastChild?(this._lastChild._next=t,t._prev=this._lastChild,this._lastChild=t):(this._firstChild=this._lastChild=t,t._prev=t._next=null),this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this.setCount(t.count),this._structEdit=!0,t}appendChildArrHighPerformance(t){return t}insertBefore(t,e){if(!e)return this.appendChild(t);if(this===t||t===e)return null;if(t.isAncestorsOf(this))throw new Error("【Node::insertBefore】不能将父辈元素insert为子元素");return e.parent!==this?null:(t.parent&&t.parent.removeChild(t),t.parent=this,t._prev=e._prev,e._prev?e._prev._next=t:this._firstChild=t,e._prev=t,t._next=e,this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this._structEdit=!0,this.setCount(t.count),t)}insertAfter(t,e){if(!e)return this.appendChild(t);if(this===t||t===e)return null;if(t.isAncestorsOf(this))throw new Error("【Node::insertAfter】不能将父辈元素insert为子元素");return e.parent!==this?null:(t.parent&&t.parent.removeChild(t),t.parent=this,e._next?(e._next._prev=t,t._next=e._next):this._lastChild=t,e._next=t,t._prev=e,this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this._structEdit=!0,this.setCount(t.count),t)}insertInto(t,e){if(!this._ignoreWarn&&this._nodeList&&Vt.getInstance().warn("insertIntoKeepIdx和insertInto混用可能会存在错误"),e>=this.childrenCount)return this.appendChild(t);if(this===t)return null;if(t.isAncestorsOf(this))throw new Error("【Node::insertBefore】不能将父辈元素insert为子元素");if(t.parent&&t.parent.removeChild(t),t.parent=this,0===e)t._next=this._firstChild,this._firstChild&&(this._firstChild._prev=t),t._prev=null,this._firstChild=t;else{let i=this._firstChild;for(let t=0;t<e;t++){if(!i)return null;t>0&&(i=i._next)}if(!i)return null;t._next=i._next,t._prev=i,i._next=t,t._next&&(t._next._prev=t)}return this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this._structEdit=!0,this.setCount(t.count),t}insertIntoKeepIdx(t,e){if(this._nodeList||(this._nodeList=this.children),this._nodeList[e]){const i=this._nodeList[e];return this._nodeList.splice(e,0,t),this.insertBefore(t,i)}let i;this._nodeList[e]=t;for(let t=e-1;t>=0&&(i=this._nodeList[t],!i);t--);if(i)return i._next?this.insertBefore(t,i._next):this.appendChild(t);this._ignoreWarn=!0;const o=this.insertInto(t,0);return this._ignoreWarn=!1,o}removeChild(t){if(!this._idMap)return null;if(!this._idMap.has(t._uid))return null;if(this._idMap.delete(t._uid),this._nodeList){const e=this._nodeList.findIndex((e=>e===t));e>=0&&this._nodeList.splice(e,1)}return t._prev?t._prev._next=t._next:this._firstChild=t._next,t._next?t._next._prev=t._prev:this._lastChild=t._prev,t.parent=null,t._prev=null,t._next=null,this._structEdit=!0,this.setCount(-t.count),t}delete(){this.parent&&this.parent.removeChild(this)}removeAllChild(t){if(!this._idMap)return;this._nodeList&&(this._nodeList.length=0);let e=this._firstChild;for(;e;){const t=e._next;e.parent=null,e._prev=null,e._next=null,e=e._next,e=t}this._firstChild=null,this._lastChild=null,this._idMap.clear(),this._structEdit=!0,this.setCount(1-this._count)}replaceChild(t,e){throw new Error("暂不支持")}find(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=null;return this.forEachChildren(((e,o)=>!(e===this||!t(e,o)||(i=e,0)))),e&&this.forEachChildren((e=>{if(e.isContainer){const o=e.find(t,!0);if(o)return i=o,!0}return!1})),i}findAll(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=[];return this.forEachChildren(((e,o)=>{e!==this&&t(e,o)&&i.push(e)})),e&&this.forEachChildren((e=>{if(e.isContainer){const o=e.findAll(t,!0);o.length&&(i=i.concat(o))}})),i}getElementById(t){return this.find((e=>e.id===t),!0)}findChildById(t){return this.getElementById(t)}findChildByUid(t){return this._idMap&&this._idMap.get(t)||null}getElementsByName(t){return this.findAll((e=>e.name===t),!0)}findChildrenByName(t){return this.getElementsByName(t)}getElementsByType(t){return this.findAll((e=>e.type===t),!0)}getChildByName(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.find((e=>e.name===t),e)}getChildAt(t){let e=this._firstChild;if(!e)return null;for(let i=0;i<t;i++){if(!e._next)return null;e=e._next}return e}at(t){return this.getChildAt(t)}containNode(t){if(!this._idMap)return!1;if(this._idMap.has(t._uid))return!0;let e=this._firstChild;for(;e;){if(e.containNode(t))return!0;e=e._next}return!1}getRootNode(){let t=this.parent;for(;null==t?void 0:t.parent;)t=t.parent;return t||this}hasChildNodes(){return null!==this._firstChild}addChild(t){return this.appendChild(t)}add(t){return this.appendChild(t)}getChildren(){const t=[];let e=this._firstChild;for(;e;)t.push(e),e=e._next;return t}isChildOf(t){return!!this.parent&&this.parent._uid===t._uid}isParentOf(t){return t.isChildOf(this)}isDescendantsOf(t){let e=this.parent;if(!e)return!1;do{if(e._uid===t._uid)return!0;e=e.parent}while(null!==e);return!1}isAncestorsOf(t){return t.isDescendantsOf(this)}getAncestor(t){throw new Error("暂不支持")}setAllDescendantsProps(t,e){let i=this._firstChild;for(;i;)i[t]=e,i.setAllDescendantsProps(t,e),i=i._next}setCount(t){this._count+=t;let e=this.parent;if(e)do{e._count+=t,e=e.parent}while(null!==e)}clone(){throw new Error("暂不支持")}cloneTo(t){throw new Error("暂不支持")}getParent(){return this.parent}del(t){return this.removeChild(t)}addEventListener(t,e,i){const o=tt(i,!0)&&i||nt(i)&&i.capture,n=nt(i)&&i.once,r=et(e)?void 0:e;return t=o?`${t}capture`:t,e=et(e)?e:e.handleEvent,n?super.once(t,e,r):super.on(t,e,r),this}on(t,e,i){return this.addEventListener(t,e,i)}removeEventListener(t,e,i){const o=tt(i,!0)&&i||nt(i)&&i.capture,n=et(e)?void 0:e;t=o?`${t}capture`:t,e=et(e)?e:e.handleEvent;const r=nt(i)&&i.once;return super.off(t,e,n,r),this}off(t,e,i){return this.removeEventListener(t,e,i)}once(t,e,i){return nt(i)?(i.once=!0,this.addEventListener(t,e,i)):this.addEventListener(t,e,{once:!0})}removeAllEventListeners(){return super.removeAllListeners(),this}removeAllListeners(){return this.removeAllEventListeners()}dispatchEvent(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),o=1;o<e;o++)i[o-1]=arguments[o];return super.emit(t.type,t,...i),!t.defaultPrevented}emit(t,e){return this.dispatchEvent(t,e)}release(){this.removeAllListeners()}}class Pn{get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get x(){return this.canvas.x}get y(){return this.canvas.y}get canvasX(){return this.canvas.x}get canvasY(){return this.canvas.y}get viewX(){return this.viewport.x}get viewY(){return this.viewport.y}constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=Pn.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer={x:0,y:0},this.page={x:0,y:0},this.canvas={x:0,y:0},this.viewport={x:0,y:0},this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}composedPath(){return!this.manager||this.path&&this.path[this.path.length-1]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.composedDetailPath(),this.path}composedDetailPath(){return this.pickParams&&this.pickParams.graphic?(this.detailPath=this.path.slice(),this._composedDetailPath(this.pickParams)):this.detailPath=this.path.slice(),this.detailPath}_composedDetailPath(t){if(t&&t.graphic){const e=this.pickParams.graphic;if(e.stage){const i=e.stage.eventSystem.manager.propagationPath(e);this.detailPath.push(i),this._composedDetailPath(t.params)}}}preventDefault(){try{this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault()}catch(t){this.nativeEvent.preventDefault&&et(this.nativeEvent.preventDefault)&&this.nativeEvent.preventDefault()}this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){try{this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.stopPropagation()}catch(t){this.nativeEvent.stopPropagation&&et(this.nativeEvent.stopPropagation)&&this.nativeEvent.stopPropagation()}this.propagationStopped=!0}initEvent(){}initUIEvent(){}clone(){throw new Error("Method not implemented.")}}class En extends Pn{constructor(){super(...arguments),this.client={x:0,y:0},this.movement={x:0,y:0},this.offset={x:0,y:0},this.global={x:0,y:0},this.screen={x:0,y:0}}get clientX(){return this.client.x}get clientY(){return this.client.y}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,o,n,r,s,a,l,h,d,c,u,g,p){throw new Error("Method not implemented.")}}class Hn extends En{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}clone(){var t,e,i;const o=new Hn(this.manager);o.eventPhase=o.NONE,o.currentTarget=null,o.path=[],o.detailPath=[],o.target=null,o.nativeEvent=this.nativeEvent,o.originalEvent=this.originalEvent,null===(t=this.manager)||void 0===t||t.copyPointerData(this,o),null===(e=this.manager)||void 0===e||e.copyMouseData(this,o),null===(i=this.manager)||void 0===i||i.copyData(this,o),o.target=this.target,o.path=this.composedPath().slice();const n=this.composedDetailPath();return o.detailPath=n&&n.slice(),o.type=this.type,o}}class Fn extends En{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}clone(){var t,e,i;const o=new Fn(this.manager);o.eventPhase=o.NONE,o.currentTarget=null,o.path=[],o.detailPath=[],o.target=null,o.nativeEvent=this.nativeEvent,o.originalEvent=this.originalEvent,null===(t=this.manager)||void 0===t||t.copyWheelData(this,o),null===(e=this.manager)||void 0===e||e.copyMouseData(this,o),null===(i=this.manager)||void 0===i||i.copyData(this,o),o.target=this.target,o.path=this.composedPath().slice();const n=this.composedDetailPath();return o.detailPath=n&&n.slice(),o.type=this.type,o}}Fn.DOM_DELTA_PIXEL=0,Fn.DOM_DELTA_LINE=1,Fn.DOM_DELTA_PAGE=2;class On extends Pn{constructor(t,e){super(),this.type=t,this.detail=e}}const In="object"==typeof performance&&performance.now?performance:Date;function zn(t){return"mouse"===t||"pen"===t}const Dn={dispatchEvent(t){var e;if(!(t instanceof Pn))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return t.defaultPrevented=!1,t.path=[],t.detailPath&&(t.detailPath=[]),t.target=this,null===(e=null==t?void 0:t.manager)||void 0===e||e.dispatchEvent(t),!t.defaultPrevented},emit(t,e){return this.dispatchEvent(new On(t,e))}},Wn={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};class Nn{constructor(t){this.resolution=1,this.onPointerDown=t=>{if(this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let t=0,i=e.length;t<i;t++){const i=e[t],o=this.bootstrapEvent(this.rootPointerEvent,i);this.manager.mapEvent(o)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerMove=t=>{if(this.supportsTouchEvents&&"touch"===t.pointerType)return;if(this.isEventOutsideOfTargetElement(t))return;const e=this.normalizeToPointerData(t);for(let t=0,i=e.length;t<i;t++){const i=this.bootstrapEvent(this.rootPointerEvent,e[t]);this.manager.mapEvent(i)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerUp=t=>{if(this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.isEventOutsideOfTargetViewPort(t)?"outside":"",i=this.normalizeToPointerData(t);for(let t=0,o=i.length;t<o;t++){const o=this.bootstrapEvent(this.rootPointerEvent,i[t]);o.type+=e,this.manager.mapEvent(o)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerOverOut=t=>{if(this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);for(let t=0,i=e.length;t<i;t++){const i=this.bootstrapEvent(this.rootPointerEvent,e[t]);this.manager.mapEvent(i)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onWheel=t=>{const e=this.normalizeWheelEvent(t);this.manager.mapEvent(e)};const{targetElement:e,resolution:i,rootNode:o,global:n,autoPreventDefault:r=!1,clickInterval:s,supportsTouchEvents:a=n.supportsTouchEvents,supportsPointerEvents:l=n.supportsPointerEvents}=t;this.manager=new class{constructor(t,e){this.dispatch=new J,this.cursorTarget=null,this.pauseNotify=!1,this.mappingState={trackingData:{}},this.eventPool=new Map,this.onPointerDown=(t,e)=>{if(!(t instanceof Hn))return void Vt.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const i=this.createPointerEvent(t,t.type,e);if(this.dispatchEvent(i,"pointerdown"),"touch"===i.pointerType)this.dispatchEvent(i,"touchstart");else if(zn(i.pointerType)){const t=2===i.button;this.dispatchEvent(i,t?"rightdown":"mousedown")}this.trackingData(t.pointerId).pressTargetsByButton[t.button]=i.composedPath(),this.freeEvent(i)},this.onPointerMove=(t,e)=>{var i,o;if(!(t instanceof Hn))return void Vt.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const n=this.createPointerEvent(t,t.type,e),r=zn(n.pointerType),s=this.trackingData(t.pointerId),a=this.findMountedTarget(s.overTargets);if(s.overTargets&&a&&a!==this.rootTarget&&a!==n.target){const e="mousemove"===t.type?"mouseout":"pointerout",i=this.createPointerEvent(t,e,a||void 0);if(this.dispatchEvent(i,"pointerout"),r&&this.dispatchEvent(i,"mouseout"),!n.composedPath().includes(a)){const e=this.createPointerEvent(t,"pointerleave",a||void 0);for(e.eventPhase=e.AT_TARGET;e.target&&!n.composedPath().includes(e.target);)e.currentTarget=e.target,this.notifyTarget(e),r&&this.notifyTarget(e,"mouseleave"),e.target=e.target.parent;this.freeEvent(e)}this.freeEvent(i)}if(a!==n.target){const e="mousemove"===t.type?"mouseover":"pointerover",i=this.clonePointerEvent(n,e);this.dispatchEvent(i,"pointerover"),r&&this.dispatchEvent(i,"mouseover");let o=null==a?void 0:a.parent;for(;o&&o!==this.rootTarget.parent&&o!==n.target;)o=o.parent;if(!o||o===this.rootTarget.parent){const t=this.clonePointerEvent(n,"pointerenter");t.eventPhase=t.AT_TARGET;let e=t.target;const i=new Set;let o=a;for(;o&&o!==this.rootTarget;)i.add(o),o=o.parent;for(;e&&e!==a&&e!==this.rootTarget.parent;)i.has(e)||(t.currentTarget=e,this.notifyTarget(t),r&&this.notifyTarget(t,"mouseenter")),e=e.parent;this.freeEvent(t)}this.freeEvent(i)}this.dispatchEvent(n,"pointermove"),"touch"===n.pointerType&&this.dispatchEvent(n,"touchmove"),r&&(this.dispatchEvent(n,"mousemove"),this.cursorTarget=n.target,this.cursor=(null===(o=null===(i=n.target)||void 0===i?void 0:i.attribute)||void 0===o?void 0:o.cursor)||this.rootTarget.getCursor()),s.overTargets=n.composedPath(),this.freeEvent(n)},this.onPointerOver=(t,e)=>{var i,o;if(!(t instanceof Hn))return void Vt.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const n=this.trackingData(t.pointerId),r=this.createPointerEvent(t,t.type,e),s=zn(r.pointerType);this.dispatchEvent(r,"pointerover"),s&&this.dispatchEvent(r,"mouseover"),"mouse"===r.pointerType&&(this.cursorTarget=r.target,this.cursor=(null===(o=null===(i=r.target)||void 0===i?void 0:i.attribute)||void 0===o?void 0:o.cursor)||this.rootTarget.getCursor());const a=this.clonePointerEvent(r,"pointerenter");for(a.eventPhase=a.AT_TARGET;a.target&&a.target!==this.rootTarget.parent;)a.currentTarget=a.target,this.notifyTarget(a),s&&this.notifyTarget(a,"mouseenter"),a.target=a.target.parent;n.overTargets=r.composedPath(),this.freeEvent(r),this.freeEvent(a)},this.onPointerOut=(t,e)=>{if(!(t instanceof Hn))return void Vt.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const i=this.trackingData(t.pointerId);if(i.overTargets){const e=zn(t.pointerType),o=this.findMountedTarget(i.overTargets),n=this.createPointerEvent(t,"pointerout",o||void 0);this.dispatchEvent(n),e&&this.dispatchEvent(n,"mouseout");const r=this.createPointerEvent(t,"pointerleave",o||void 0);for(r.eventPhase=r.AT_TARGET;r.target&&r.target!==this.rootTarget.parent;)r.currentTarget=r.target,this.notifyTarget(r),e&&this.notifyTarget(r,"mouseleave"),r.target=r.target.parent;i.overTargets=[],this.freeEvent(n),this.freeEvent(r)}this.cursorTarget=null,this.cursor=""},this.onPointerUp=(t,e)=>{var i;if(!(t instanceof Hn))return void Vt.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const o=In.now(),n=this.createPointerEvent(t,t.type,e);if(this.dispatchEvent(n,"pointerup"),"touch"===n.pointerType)this.dispatchEvent(n,"touchend");else if(zn(n.pointerType)){const t=2===n.button;this.dispatchEvent(n,t?"rightup":"mouseup")}const r=this.trackingData(t.pointerId),s=this.findMountedTarget(r.pressTargetsByButton[t.button]);let a=s;if(s&&!n.composedPath().includes(s)){let e=s;for(;e&&!n.composedPath().includes(e);){if(n.currentTarget=e,this.notifyTarget(n,"pointerupoutside"),"touch"===n.pointerType)this.notifyTarget(n,"touchendoutside");else if(zn(n.pointerType)){const t=2===n.button;this.notifyTarget(n,t?"rightupoutside":"mouseupoutside")}e=e.parent}delete r.pressTargetsByButton[t.button],a=e}if(a){const e=this.clonePointerEvent(n,"click");e.target=a,e.path=[],e.detailPath=[],r.clicksByButton[t.button]||(r.clicksByButton[t.button]={clickCount:0,target:e.target,timeStamp:o});const s=r.clicksByButton[t.button];s.target===e.target&&o-s.timeStamp<(null!==(i=this._config.clickInterval)&&void 0!==i?i:200)?++s.clickCount:s.clickCount=1,s.target=e.target,s.timeStamp=o,e.detail=s.clickCount,zn(e.pointerType)?(this.dispatchEvent(e,"click"),2===s.clickCount&&this.dispatchEvent(e,"dblclick")):"touch"===e.pointerType&&this._config.supportsTouchEvents&&(this.dispatchEvent(e,"tap"),2===s.clickCount&&this.dispatchEvent(e,"dbltap")),this.dispatchEvent(e,"pointertap"),this.freeEvent(e)}this.freeEvent(n)},this.onPointerUpOutside=(t,e)=>{if(!(t instanceof Hn))return void Vt.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const i=this.trackingData(t.pointerId),o=this.findMountedTarget(i.pressTargetsByButton[t.button]),n=this.createPointerEvent(t,t.type,e);if(o){let e=o;for(;e;)n.currentTarget=e,this.notifyTarget(n,"pointerupoutside"),"touch"===n.pointerType?this.notifyTarget(n,"touchendoutside"):zn(n.pointerType)&&this.notifyTarget(n,2===n.button?"rightupoutside":"mouseupoutside"),e=e.parent;delete i.pressTargetsByButton[t.button]}this.freeEvent(n)},this.onWheel=(t,e)=>{if(!(t instanceof Fn))return void Vt.getInstance().warn("EventManager cannot map a non-wheel event as a wheel event");const i=this.createWheelEvent(t,e);this.dispatchEvent(i),this.freeEvent(i)},this.rootTarget=t,this.mappingTable={},this._config=Object.assign({clickInterval:200},e),this.addEventMapping("pointerdown",this.onPointerDown),this.addEventMapping("pointermove",this.onPointerMove),this.addEventMapping("pointerout",this.onPointerOut),this.addEventMapping("pointerleave",this.onPointerOut),this.addEventMapping("pointerover",this.onPointerOver),this.addEventMapping("pointerup",this.onPointerUp),this.addEventMapping("pointerupoutside",this.onPointerUpOutside),this.addEventMapping("wheel",this.onWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort(((t,e)=>t.priority-e.priority))}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){var e,i,o,n,r,s,a;if(!this.rootTarget)return;const l=this.mappingTable[t.type];let h;const d=`${t.canvasX}-${t.canvasY}`;if((null===(e=this._prePointTargetCache)||void 0===e?void 0:e[d])&&(null===(o=null===(i=this._prePointTargetCache)||void 0===i?void 0:i[d])||void 0===o?void 0:o.stage)&&(null===(r=null===(n=this._prePointTargetCache)||void 0===n?void 0:n[d])||void 0===r?void 0:r.stage.renderCount)===(null===(s=this._prePointTargetCache)||void 0===s?void 0:s.stageRenderCount)?h=this._prePointTargetCache[d]:(h=this.pickTarget(t.viewX,t.viewY,t),t.pickParams||(this._prePointTargetCache={[d]:h,stageRenderCount:null!==(a=null==h?void 0:h.stage.renderCount)&&void 0!==a?a:-1})),l)for(let e=0,i=l.length;e<i;e++)l[e].fn(t,h);else Vt.getInstance().warn(`[EventManager]: Event mapping not defined for ${t.type}`)}propagate(t,e){if(!t.target)return;const i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let o=0,n=i.length-1;o<n;o++)if(t.currentTarget=i[o],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let o=i.length-2;o>=0;o--)if(t.currentTarget=i[o],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}propagationPath(t){const e=[t];for(let i=0;i<2048&&t!==this.rootTarget&&t.parent;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}notifyTarget(t,e){if(this.pauseNotify)return;e=null!=e?e:t.type;const i=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,i),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let i=1;i<t.length&&t[i].parent===e;i++)e=t[i];return e}createPointerEvent(t,e,i){var o,n;const r=this.allocateEvent(Hn);return this.copyPointerData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.nativeEvent=t.nativeEvent,r.originalEvent=t,r.target=i||this.pickTarget(null!==(o=r.viewX)&&void 0!==o?o:r.global.x,null!==(n=r.viewY)&&void 0!==n?n:r.global.y,r),"string"==typeof e&&(r.type=e),r}createWheelEvent(t,e){var i,o;const n=this.allocateEvent(Fn);return this.copyWheelData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.nativeEvent=t.nativeEvent,n.originalEvent=t,n.target=e||this.pickTarget(null!==(i=n.viewX)&&void 0!==i?i:n.global.x,null!==(o=n.viewY)&&void 0!==o?o:n.global.y,n),n}clonePointerEvent(t,e){const i=this.allocateEvent(Hn);i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice();const o=t.composedDetailPath();return i.detailPath=o&&o.slice(),i.type=null!=e?e:i.type,i}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof Hn&&e instanceof Hn&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof En&&e instanceof En&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.ctrlKey=t.ctrlKey,e.shiftKey=t.shiftKey,e.metaKey=t.metaKey,["client","movement","canvas","screen","global","offset","viewport"].forEach((i=>{e[i].x=t[i].x,e[i].y=t[i].y})))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=In.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.x=t.layer.x,e.layer.y=t.layer.y,e.page.x=t.page.x,e.page.y=t.page.y,e.pickParams=t.pickParams}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){var e;this.eventPool.has(t)||this.eventPool.set(t,[]);const i=(null===(e=this.eventPool.get(t))||void 0===e?void 0:e.pop())||new t(this);return i.eventPhase=i.NONE,i.currentTarget=null,i.path=[],i.detailPath=[],i.target=null,i}freeEvent(t){var e;if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventManager!");const i=t.constructor;this.eventPool.has(i)||this.eventPool.set(i,[]),null===(e=this.eventPool.get(i))||void 0===e||e.push(t)}notifyListeners(t,e){const i=t.currentTarget._events[e];if(i)if("fn"in i)i.once&&t.currentTarget.removeEventListener(e,i.fn,{once:!0}),i.fn.call(i.context,t);else for(let o=0,n=i.length;o<n&&!t.propagationImmediatelyStopped;o++)i[o].once&&t.currentTarget.removeEventListener(e,i[o].fn,{once:!0}),i[o].fn.call(i[o].context,t);this.emitDelegation(t,e)}emitDelegation(t,e){const i=t.currentTarget._events["*"];if(i)if("fn"in i)i.fn.call(i.context,t,e);else for(let o=0,n=i.length;o<n&&!t.propagationImmediatelyStopped;o++)i[o].fn.call(i[o].context,t,e)}pickTarget(t,e,i){let o;const n=this.rootTarget.pick(t,e);return o=n&&n.graphic?n.graphic:n&&n.group?n.group:this.rootTarget.AABBBounds.contains(t,e)?this.rootTarget:null,i&&(i.pickParams=n.params),o}release(){this.dispatch.removeAllListeners(),this.eventPool.clear(),this.rootTarget=null,this.mappingTable=null,this.mappingState=null,this.cursorTarget=null}}(o,{clickInterval:s,supportsTouchEvents:a}),this.globalObj=n,this.supportsPointerEvents=l,this.supportsTouchEvents=a,this.supportsMouseEvents=n.supportsMouseEvents,this.applyStyles=n.applyStyles,this.autoPreventDefault=r,this.eventsAdded=!1,this.rootPointerEvent=new Hn,this.rootWheelEvent=new Fn,this.cursorStyles={default:"inherit",pointer:"pointer"},this.resolution=i,this.setTargetElement(e)}release(){this.removeEvents(),this.manager&&this.manager.release(),this.domElement=null,this.manager=null,this.globalObj=null}setCursor(t,e){if(!e&&!this.manager.rootTarget.window._handler.canvas.controled)return;t||(t="default");const{applyStyles:i,domElement:o}=this;if(this.currentCursor===t)return;this.currentCursor=t;const n=this.cursorStyles[t];n?"string"==typeof n&&i?o.style.cursor=n:"function"==typeof n?n(t):"object"==typeof n&&i&&Object.assign(o.style,n):i&&lt(t)&&!_t(this.cursorStyles,t)&&(o.style.cursor=t)}setTargetElement(t){this.removeEvents(),this.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;const{globalObj:t,domElement:e}=this;this.supportsPointerEvents?(t.getDocument()?(t.getDocument().addEventListener("pointermove",this.onPointerMove,!0),t.getDocument().addEventListener("pointerup",this.onPointerUp,!0)):(e.addEventListener("pointermove",this.onPointerMove,!0),e.addEventListener("pointerup",this.onPointerUp,!0)),e.addEventListener("pointerdown",this.onPointerDown,!0),e.addEventListener("pointerleave",this.onPointerOverOut,!0),e.addEventListener("pointerover",this.onPointerOverOut,!0)):(t.getDocument()?(t.getDocument().addEventListener("mousemove",this.onPointerMove,!0),t.getDocument().addEventListener("mouseup",this.onPointerUp,!0)):(e.addEventListener("mousemove",this.onPointerMove,!0),e.addEventListener("mouseup",this.onPointerUp,!0)),e.addEventListener("mousedown",this.onPointerDown,!0),e.addEventListener("mouseout",this.onPointerOverOut,!0),e.addEventListener("mouseover",this.onPointerOverOut,!0)),this.supportsTouchEvents&&(e.addEventListener("touchstart",this.onPointerDown,!0),e.addEventListener("touchend",this.onPointerUp,!0),e.addEventListener("touchmove",this.onPointerMove,!0)),e.addEventListener("wheel",this.onWheel,{capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;const{globalObj:t,domElement:e}=this;this.supportsPointerEvents?(t.getDocument()?(t.getDocument().removeEventListener("pointermove",this.onPointerMove,!0),t.getDocument().removeEventListener("pointerup",this.onPointerUp,!0)):(e.removeEventListener("pointermove",this.onPointerMove,!0),e.removeEventListener("pointerup",this.onPointerUp,!0)),e.removeEventListener("pointerdown",this.onPointerDown,!0),e.removeEventListener("pointerleave",this.onPointerOverOut,!0),e.removeEventListener("pointerover",this.onPointerOverOut,!0)):(t.getDocument()?(t.getDocument().removeEventListener("mousemove",this.onPointerMove,!0),t.getDocument().removeEventListener("mouseup",this.onPointerUp,!0)):(e.removeEventListener("mousemove",this.onPointerMove,!0),e.removeEventListener("mouseup",this.onPointerUp,!0)),e.removeEventListener("mousedown",this.onPointerDown,!0),e.removeEventListener("mouseout",this.onPointerOverOut,!0),e.removeEventListener("mouseover",this.onPointerOverOut,!0)),this.supportsTouchEvents&&(e.removeEventListener("touchstart",this.onPointerDown,!0),e.removeEventListener("touchend",this.onPointerUp,!0),e.removeEventListener("touchmove",this.onPointerMove,!0)),e.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapToViewportPoint(t){return this.domElement.pointTransform?this.domElement.pointTransform(t.x,t.y):t}mapToCanvasPoint(t){var e,i;const o=null===(e=this.globalObj)||void 0===e?void 0:e.mapToCanvasPoint(t,this.domElement);if(o)return o;let n=0,r=0;if(t.changedTouches){const e=null!==(i=t.changedTouches[0])&&void 0!==i?i:{};n=e.clientX||0,r=e.clientY||0}else n=t.clientX||0,r=t.clientY||0;const s=this.domElement.getBoundingClientRect();return{x:n-s.left,y:r-s.top}}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t.changedTouches&&t.changedTouches.length)for(let i=0,o=t.changedTouches.length;i<o;i++){const o=t.changedTouches[i];at(o.button)&&(o.button=0),at(o.buttons)&&(o.buttons=1),at(o.isPrimary)&&(o.isPrimary=1===t.touches.length&&"touchstart"===t.type),at(o.width)&&(o.width=o.radiusX||1),at(o.height)&&(o.height=o.radiusY||1),at(o.tiltX)&&(o.tiltX=0),at(o.tiltY)&&(o.tiltY=0),at(o.pointerType)&&(o.pointerType="touch"),at(o.pointerId)&&(o.pointerId=o.identifier||0),at(o.pressure)&&(o.pressure=o.force||.5),at(o.twist)&&(o.twist=0),at(o.tangentialPressure)&&(o.tangentialPressure=0),at(o.layerX)&&(o.layerX=o.offsetX=o.clientX),at(o.layerY)&&(o.layerY=o.offsetY=o.clientY),o.isNormalized=!0,o.type=t.type,e.push(o)}else if(!this.globalObj.supportsMouseEvents||t instanceof MouseEvent&&!(this.supportsPointerEvents&&t instanceof PointerEvent)){const i=t;at(i.isPrimary)&&(i.isPrimary=!0),at(i.width)&&(i.width=1),at(i.height)&&(i.height=1),at(i.tiltX)&&(i.tiltX=0),at(i.tiltY)&&(i.tiltY=0),at(i.pointerType)&&(i.pointerType="mouse"),at(i.pointerId)&&(i.pointerId=1),at(i.pressure)&&(i.pressure=.5),at(i.twist)&&(i.twist=0),at(i.tangentialPressure)&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;this.transferMouseData(e,t),e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ;const{x:i,y:o}=this.mapToCanvasPoint(t);e.canvas.x=i,e.canvas.y=o,e.global.x=i,e.global.y=o,e.offset.x=i,e.offset.y=o;const{x:n,y:r}=this.mapToViewportPoint(e);return e.viewport.x=n,e.viewport.y=r,e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e);const{x:i,y:o}=this.mapToCanvasPoint(e);t.canvas.x=i,t.canvas.y=o,t.global.x=i,t.global.y=o,t.offset.x=i,t.offset.y=o;const{x:n,y:r}=this.mapToViewportPoint(t);return t.viewport.x=n,t.viewport.y=r,t.isTrusted=e.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=Wn[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=In.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.shiftKey=e.shiftKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null}isEventOutsideOfTargetViewPort(t){if(this.isEventOutsideOfTargetElement(t))return!0;if(this.domElement.getViewBox){const e=this.mapToViewportPoint(this.mapToCanvasPoint(t)),i=this.domElement.getViewBox(),o=i.width(),n=i.height();return!(e.x<o&&e.y<n&&e.x>0&&e.y>0)}return!1}isEventOutsideOfTargetElement(t){let e=t.target;return t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]),e!==(this.domElement.getNativeHandler?this.domElement.getNativeHandler().nativeCanvas:this.domElement)}pauseTriggerEvent(){this.manager.pauseNotify=!0}resumeTriggerEvent(){this.manager.pauseNotify=!1}}var Gn;!function(t){t[t.INITIAL=0]="INITIAL",t[t.RUNNING=1]="RUNNING",t[t.PAUSE=2]="PAUSE"}(Gn||(Gn={}));class jn{static Avaliable(){return!!zo.global.getRequestAnimationFrame()}avaliable(){return jn.Avaliable()}tick(t,e){zo.global.getRequestAnimationFrame()((()=>{this.released||e(this)}))}release(){this.released=!0}getTime(){return Date.now()}}class Vn{static Avaliable(){return!0}avaliable(){return Vn.Avaliable()}tick(t,e){this.timerId=setTimeout((()=>{e(this)}),t)}release(){this.timerId>0&&(clearTimeout(this.timerId),this.timerId=-1)}getTime(){return Date.now()}}class Un extends J{set mode(t){this._mode!==t&&(this._mode=t,this.setupTickHandler())}get mode(){return this._mode}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.handleTick=(t,e)=>{const{once:i=!1}=null!=e?e:{};this.ifCanStop()?this.stop():(this._handlerTick(),i||t.tick(this.interval,this.handleTick))},this._handlerTick=()=>{const t=this.tickerHandler.getTime();let e=0;this.lastFrameTime>=0&&(e=t-this.lastFrameTime),this.lastFrameTime=t,this.status===Gn.RUNNING&&(this.tickCounts++,this.timelines.forEach((t=>{t.tick(e)})),this.emit("afterTick"))},this.init(),this.lastFrameTime=-1,this.tickCounts=0,this.timelines=t,this.autoStop=!0}init(){this.interval=NaN,this.status=Gn.INITIAL,zo.global.hooks.onSetEnv.tap("default-ticker",(()=>{this.initHandler()})),zo.global.env&&this.initHandler()}addTimeline(t){this.timelines.push(t)}remTimeline(t){this.timelines=this.timelines.filter((e=>e!==t))}initHandler(){if(this._mode)return null;const t=[{mode:"raf",cons:jn},{mode:"timeout",cons:Vn}];for(let e=0;e<t.length;e++)if(t[e].cons.Avaliable()){this.mode=t[e].mode;break}return null}setupTickHandler(){let t;switch(this._mode){case"raf":t=new jn;break;case"timeout":t=new Vn;break;default:Vt.getInstance().warn("非法的计时器模式"),t=new jn}return!!t.avaliable()&&(this.tickerHandler&&this.tickerHandler.release(),this.tickerHandler=t,!0)}setInterval(t){this.interval=t}getInterval(){return this.interval}setFPS(t){this.setInterval(1e3/t)}getFPS(){return 1e3/this.interval}tick(t){this.tickerHandler.tick(t,(t=>{this.handleTick(t,{once:!0})}))}tickTo(t){this.tickerHandler.tickTo&&this.tickerHandler.tickTo(t,(t=>{this.handleTick(t,{once:!0})}))}pause(){return this.status!==Gn.INITIAL&&(this.status=Gn.PAUSE,!0)}resume(){return this.status!==Gn.INITIAL&&(this.status=Gn.RUNNING,!0)}ifCanStop(){if(this.autoStop){if(!this.timelines.length)return!0;if(0===this.timelines.reduce(((t,e)=>t+e.animateCount),0))return!0}return!1}start(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.status===Gn.RUNNING)return!1;if(!this.tickerHandler)return!1;if(!t){if(this.status===Gn.PAUSE)return!1;if(!this.timelines.length)return!1;if(0===this.timelines.reduce(((t,e)=>t+e.animateCount),0))return!1}return this.status=Gn.RUNNING,this.tickerHandler.tick(0,this.handleTick),!0}stop(){this.status=Gn.INITIAL,this.setupTickHandler(),this.lastFrameTime=-1}trySyncTickStatus(){this.status===Gn.RUNNING&&this._handlerTick()}}class $n{constructor(){}static linear(t){return t}static none(){return this.linear}static get(t){return t<-1?t=-1:t>1&&(t=1),function(e){return 0===t?e:t<0?e*(e*-t+1+t):e*((2-e)*t+(1-t))}}static getPowIn(t){return function(e){return Math.pow(e,t)}}static getPowOut(t){return function(e){return 1-Math.pow(1-e,t)}}static getPowInOut(t){return function(e){return(e*=2)<1?.5*Math.pow(e,t):1-.5*Math.abs(Math.pow(2-e,t))}}static getBackIn(t){return function(e){return e*e*((t+1)*e-t)}}static getBackOut(t){return function(e){return--e*e*((t+1)*e+t)+1}}static getBackInOut(t){return t*=1.525,function(e){return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}}static sineIn(t){return 1-Math.cos(t*Math.PI/2)}static sineOut(t){return Math.sin(t*Math.PI/2)}static sineInOut(t){return-(Math.cos(Math.PI*t)-1)/2}static expoIn(t){return 0===t?0:Math.pow(2,10*t-10)}static expoOut(t){return 1===t?1:1-Math.pow(2,-10*t)}static expoInOut(t){return 0===t?0:1===t?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2}static circIn(t){return-(Math.sqrt(1-t*t)-1)}static circOut(t){return Math.sqrt(1- --t*t)}static circInOut(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}static bounceOut(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}static bounceIn(t){return 1-$n.bounceOut(1-t)}static bounceInOut(t){return t<.5?.5*$n.bounceIn(2*t):.5*$n.bounceOut(2*t-1)+.5}static getElasticIn(t,e){return function(i){if(0===i||1===i)return i;const o=e/ne*Math.asin(1/t);return-t*Math.pow(2,10*(i-=1))*Math.sin((i-o)*ne/e)}}static getElasticOut(t,e){return function(i){if(0===i||1===i)return i;const o=e/ne*Math.asin(1/t);return t*Math.pow(2,-10*i)*Math.sin((i-o)*ne/e)+1}}static getElasticInOut(t,e){return function(i){const o=e/ne*Math.asin(1/t);return(i*=2)<1?t*Math.pow(2,10*(i-=1))*Math.sin((i-o)*ne/e)*-.5:t*Math.pow(2,-10*(i-=1))*Math.sin((i-o)*ne/e)*.5+1}}}$n.quadIn=$n.getPowIn(2),$n.quadOut=$n.getPowOut(2),$n.quadInOut=$n.getPowInOut(2),$n.cubicIn=$n.getPowIn(3),$n.cubicOut=$n.getPowOut(3),$n.cubicInOut=$n.getPowInOut(3),$n.quartIn=$n.getPowIn(4),$n.quartOut=$n.getPowOut(4),$n.quartInOut=$n.getPowInOut(4),$n.quintIn=$n.getPowIn(5),$n.quintOut=$n.getPowOut(5),$n.quintInOut=$n.getPowInOut(5),$n.backIn=$n.getBackIn(1.7),$n.backOut=$n.getBackOut(1.7),$n.backInOut=$n.getBackInOut(1.7),$n.elasticIn=$n.getElasticIn(1,.3),$n.elasticOut=$n.getElasticOut(1,.3),$n.elasticInOut=$n.getElasticInOut(1,.3*1.5);class Xn{constructor(){this.id=s.GenAutoIncrementId(),this.animateHead=null,this.animateTail=null,this.animateCount=0,this.paused=!1}addAnimate(t){this.animateTail?(this.animateTail.nextAnimate=t,t.prevAnimate=this.animateTail,this.animateTail=t,t.nextAnimate=null):(this.animateHead=t,this.animateTail=t),this.animateCount++}pause(){this.paused=!0}resume(){this.paused=!1}tick(t){if(this.paused)return;let e=this.animateHead;for(this.animateCount=0;e;)e.status===xi.END?this.removeAnimate(e):e.status===xi.RUNNING||e.status===xi.INITIAL?(this.animateCount++,e.advance(t)):e.status===xi.PAUSED&&this.animateCount++,e=e.nextAnimate}clear(){let t=this.animateHead;for(;t;)t.release(),t=t.nextAnimate;this.animateHead=null,this.animateTail=null,this.animateCount=0}removeAnimate(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t._onRemove&&t._onRemove.forEach((t=>t())),t===this.animateHead?(this.animateHead=t.nextAnimate,t===this.animateTail?this.animateTail=null:this.animateHead.prevAnimate=null):t===this.animateTail?(this.animateTail=t.prevAnimate,this.animateTail.nextAnimate=null):(t.prevAnimate.nextAnimate=t.nextAnimate,t.nextAnimate.prevAnimate=t.prevAnimate),e&&t.release()}}const Yn=new Xn;class Kn{constructor(t,e,i,o,n){this.from=t,this.to=e,this.duration=i,this.easing=o,this.params=n,this.updateCount=0}bind(t,e){this.target=t,this.subAnimate=e,this.onBind()}onBind(){}onFirstRun(){}onStart(){}onEnd(){}getEndProps(){return this.to}getFromProps(){return this.from}getMergedEndProps(){var t;const e=this.getEndProps();return e?this._endProps===e?this._mergedEndProps:(this._endProps=e,void(this._mergedEndProps=Object.assign({},null!==(t=this.step.prev.getLastProps())&&void 0!==t?t:{},e))):this.step.prev?this.step.prev.getLastProps():e}update(t,e,i){if(0===this.updateCount){this.onFirstRun();const t=this.step.getLastProps();Object.keys(t).forEach((e=>{this.subAnimate.animate.validAttr(e)&&(i[e]=t[e])}))}this.updateCount+=1,this.onUpdate(t,e,i),t&&this.onEnd()}}class qn extends Kn{constructor(t){super(null,null,0,"linear"),this.cb=t}onUpdate(t,e,i){}onStart(){this.cb()}}class Zn{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.GenAutoIncrementId(),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Yn,i=arguments.length>2?arguments[2]:void 0;this.id=t,this.timeline=e,this.status=xi.INITIAL,this.tailAnimate=new Jn(this),this.subAnimates=[this.tailAnimate],this.timeScale=1,this.rawPosition=-1,this._startTime=0,this._duringTime=0,this.timeline.addAnimate(this),this.slience=i}setTimeline(t){t!==this.timeline&&(this.timeline.removeAnimate(this,!1),t.addAnimate(this))}getStartTime(){return this._startTime}getDuration(){return this.subAnimates.reduce(((t,e)=>t+e.totalDuration),0)}after(t){const e=t.getDuration();return this._startTime=e,this}afterAll(t){let e=-1/0;return t.forEach((t=>{e=le(t.getDuration(),e)})),this._startTime=e,this}parallel(t){return this._startTime=t.getStartTime(),this}static AddInterpolate(t,e){Zn.interpolateMap.set(t,e)}play(t){if(this.tailAnimate.play(t),this.target){const t=this.target.stage;t&&t.renderNextFrame()}return 1===this.subAnimates.length&&this.tailAnimate.totalDuration===t.duration&&this.trySetAttribute(t.getFromProps(),t.mode),this}trySetAttribute(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Zn.mode;t&&e&_i.SET_ATTR_IMMEDIATELY&&this.target.setAttributes&&this.target.setAttributes(t,!1,{type:wi.ANIMATE_PLAY})}runCb(t){const e=new qn((()=>{t(this,e.step.prev)}));return this.tailAnimate.play(e),this}customInterpolate(t,e,i,o,n,r){const s=Zn.interpolateMap.get(t)||Zn.interpolateMap.get("");return!!s&&s(t,e,i,o,n,r)}pause(){this.status===xi.RUNNING&&(this.status=xi.PAUSED)}resume(){this.status===xi.PAUSED&&(this.status=xi.RUNNING)}to(t,e,i,o){if(this.tailAnimate.to(t,e,i,o),this.target){const t=this.target.stage;t&&t.renderNextFrame()}return this}from(t,e,i,o){if(this.tailAnimate.from(t,e,i,o),this.target){const t=this.target.stage;t&&t.renderNextFrame()}return this}wait(t){if(this.tailAnimate.wait(t),this.target){const t=this.target.stage;t&&t.renderNextFrame()}return this}startAt(t){if(this.tailAnimate.startAt(t),this.target){const t=this.target.stage;t&&t.renderNextFrame()}return this}loop(t){if(this.tailAnimate.loop=t,this.target){const t=this.target.stage;t&&t.renderNextFrame()}return this}reversed(t){if(this.tailAnimate.reversed=t,this.target){const t=this.target.stage;t&&t.renderNextFrame()}return this}bounce(t){if(this.tailAnimate.bounce=t,this.target){const t=this.target.stage;t&&t.renderNextFrame()}return this}subAnimate(){const t=new Jn(this,this.tailAnimate);return this.tailAnimate=t,this.subAnimates.push(t),t.bind(this.target),this}getStartProps(){return this.subAnimates[0].getStartProps()}getEndProps(){return this.tailAnimate.getEndProps()}depreventAttr(t){this._preventAttrs&&this._preventAttrs.delete(t)}preventAttr(t){this._preventAttrs||(this._preventAttrs=new Set),this._preventAttrs.add(t)}preventAttrs(t){t.forEach((t=>this.preventAttr(t)))}validAttr(t){return!this._preventAttrs||!this._preventAttrs.has(t)}bind(t){return this.target=t,this.target.onAnimateBind&&!this.slience&&this.target.onAnimateBind(this),this.subAnimates.forEach((e=>{e.bind(t)})),this}advance(t){if(this._duringTime<this._startTime){if(this._duringTime+t*this.timeScale<this._startTime)return void(this._duringTime+=t*this.timeScale);t=this._duringTime+t*this.timeScale-this._startTime,this._duringTime=this._startTime}this.status===xi.INITIAL&&(this.status=xi.RUNNING,this._onStart&&this._onStart.forEach((t=>t()))),this.setPosition(Math.max(this.rawPosition,0)+t*this.timeScale)&&this.status===xi.RUNNING&&(this.status=xi.END,this._onEnd&&this._onEnd.forEach((t=>t())))}setPosition(t){let e,i=0;const o=this.rawPosition,n=this.subAnimates.reduce(((t,e)=>t+e.totalDuration),0);t<0&&(t=0);const r=t>=n;if(r&&(t=n),t===o)return r;for(let o=0;o<this.subAnimates.length&&(e=this.subAnimates[o],!(i+e.totalDuration>=t));o++)i+=e.totalDuration,e=void 0;return this.rawPosition=t,e.setPosition(t-i),r}onStart(t){this._onStart||(this._onStart=[]),this._onStart.push(t)}onEnd(t){this._onEnd||(this._onEnd=[]),this._onEnd.push(t)}onRemove(t){this._onRemove||(this._onRemove=[]),this._onRemove.push(t)}onFrame(t){this._onFrame||(this._onFrame=[]),this._onFrame.push(t)}release(){this.status=xi.END}stop(t){t||this.target.onStop(),"start"===t?this.target.onStop(this.getStartProps()):"end"===t?this.target.onStop(this.getEndProps()):this.target.onStop(t),this.release()}}Zn.mode=_i.NORMAL,Zn.interpolateMap=new Map;class Jn{get totalDuration(){return this.calcAttr(),this._totalDuration+this._startAt}constructor(t,e){this.rawPosition=-1,this.position=0,this.loop=0,this.duration=0,this.animate=t,this.stepHead=new Qn(0,0,e?Object.assign({},e.stepTail.props):{}),this.stepTail=this.stepHead,this.dirty=!0,this._startAt=0}calcAttr(){this.dirty&&(this._totalDuration=this.duration*(this.loop+1))}bind(t){return this.target=t,this}play(t){let e=t.duration;(null==e||e<0)&&(e=0);const i=t.easing,o="string"==typeof i?$n[i]:i,n=this._addStep(e,null,o);return n.type=Si.customAnimate,this._appendProps(t.getEndProps(),n,!1),this._appendCustomAnimate(t,n),this}to(t,e,i,o){(null==e||e<0)&&(e=0);const n="string"==typeof i?$n[i]:i,r=this._addStep(e,null,n);return r.type=Si.to,this._appendProps(t,r,!!o&&o.tempProps),r.propKeys||(r.propKeys=Object.keys(r.props)),o&&o.noPreventAttrs||this.target.animates.forEach((t=>{t.id!==this.animate.id&&t.preventAttrs(r.propKeys)})),this}from(t,e,i,o){this.to(t,0,i,o);const n={};this.stepTail.propKeys||(this.stepTail.propKeys=Object.keys(this.stepTail.props)),this.stepTail.propKeys.forEach((t=>{n[t]=this.getLastPropByName(t,this.stepTail)})),this.to(n,e,i,o),this.stepTail.type=Si.from}startAt(t){return t<0&&(t=0),this._startAt=t,this}getStartProps(){var t;return null===(t=this.stepHead)||void 0===t?void 0:t.props}getEndProps(){return this.stepTail.props}getLastStep(){return this._lastStep}wait(t){if(t>0){const e=this._addStep(+t,null);e.type=Si.wait,e.prev.customAnimate?e.props=e.prev.customAnimate.getEndProps():e.props=e.prev.props,this.target.onAddStep&&this.target.onAddStep(e)}return this}_addStep(t,e,i){const o=new Qn(this.duration,t,e,i);return this.duration+=t,this.stepTail.append(o),this.stepTail=o,o}_appendProps(t,e,i){e.props=i?t:Object.assign({},t);let o=e.prev;const n=e.props;for(e.propKeys||(e.propKeys=Object.keys(e.props)),e.propKeys.forEach((t=>{void 0===e.props[t]&&(e.props[t]=this.target.getDefaultAttribute(t))}));o.prev;)o.props&&(o.propKeys||(o.propKeys=Object.keys(o.props)),o.propKeys.forEach((t=>{void 0===n[t]&&(n[t]=o.props[t])}))),e.propKeys=Object.keys(e.props),o=o.prev;const r=this.stepHead.props;e.propKeys||(e.propKeys=Object.keys(n)),e.propKeys.forEach((t=>{if(void 0===r[t]){const e=this.animate.getStartProps();r[t]=e[t]=this.target.getComputedAttribute(t)}})),this.target.onAddStep&&this.target.onAddStep(e)}_appendCustomAnimate(t,e){e.customAnimate=t,t.step=e,t.bind(this.target,this)}setPosition(t){var e;const i=this.duration,o=this.loop,n=this.rawPosition;let r,s,a=!1;const l=null!==(e=this._startAt)&&void 0!==e?e:0;if(t<0&&(t=0),t<l)return this.rawPosition=t,!1;if(t-=l,i<=0&&(a=!0,i<0))return a;if(r=Math.floor(t/i),s=t-r*i,a=t>=o*i+i,a&&(s=i,r=o,t=s*r+i),t===n)return a;const h=!this.reversed!=!(this.bounce&&r%2);return h&&(s=i-s),this._deltaPosition=s-this.position,this.position=s,this.rawPosition=t+l,this.updatePosition(a,h),a}updatePosition(t,e){if(!this.stepHead)return;let i=this.stepHead.next;const o=this.position,n=this.duration;if(this.target&&i){let r=i.next;for(;r&&r.position<=o;)i=r,r=i.next;let s=t?0===n?1:o/n:(o-i.position)/i.duration;i.easing&&(s=i.easing(s)),this.tryCallCustomAnimateLifeCycle(i,this._lastStep||(e?this.stepTail:this.stepHead),e),this.updateTarget(i,s,t),this._lastStep=i,this.animate._onFrame&&this.animate._onFrame.forEach((t=>t(i,s)))}}tryCallCustomAnimateLifeCycle(t,e,i){if(t!==e)if(i){let i=e.prev;for(;i&&i!==t;)i.customAnimate&&(i.customAnimate.onStart&&i.customAnimate.onStart(),i.customAnimate.onEnd&&i.customAnimate.onEnd()),i=t.prev;e&&e.customAnimate&&e.customAnimate.onEnd&&e.customAnimate.onEnd(),t&&t.customAnimate&&t.customAnimate.onStart&&t.customAnimate.onStart()}else{let i=e.next;for(;i&&i!==t;)i.customAnimate&&(i.customAnimate.onStart&&i.customAnimate.onStart(),i.customAnimate.onEnd&&i.customAnimate.onEnd()),i=i.next;e&&e.customAnimate&&e.customAnimate.onEnd&&e.customAnimate.onEnd(),t&&t.customAnimate&&t.customAnimate.onStart&&t.customAnimate.onStart()}}getLastPropByName(t,e){let i=e.prev;for(;i;){if(i.props&&void 0!==i.props[t])return i.props[t];if(i.customAnimate){const e=i.customAnimate.getEndProps()[t];if(void 0!==e)return e}i=i.prev}return Vt.getInstance().warn("未知错误，step中找不到属性"),e.props[t]}updateTarget(t,e,i){null==t.props&&null==t.customAnimate||this.target.onStep(this,this.animate,t,e,i)}}class Qn{constructor(t,e,i,o){this.duration=e,this.position=t,this.props=i,this.easing=o}append(t){t.prev=this,t.next=this.next,this.next=t}getLastProps(){let t=this.prev;for(;t;){if(t.props)return t.props;if(t.customAnimate)return t.customAnimate.getMergedEndProps();t=t.prev}return null}}const tr=200,er="cubicOut";var ir;!function(t){t[t.Top=1]="Top",t[t.Right=2]="Right",t[t.Bottom=4]="Bottom",t[t.Left=8]="Left",t[t.ALL=15]="ALL"}(ir||(ir={}));const or=[!1,!1,!1,!1],nr=[0,0,0,0],rr=t=>t?ht(t)?0===t.length?0:1===t.length?t[0]:2===t.length?(nr[0]=t[0],nr[2]=t[0],nr[1]=t[1],nr[3]=t[1],nr):t:t:0,sr=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],ar=[1,2,3,0,1,2,3,0];function lr(t,e,i,o){for(;t>=ne;)t-=ne;for(;t<0;)t+=ne;for(;t>e;)e+=ne;sr[0].x=i,sr[1].y=i,sr[2].x=-i,sr[3].y=-i;const n=Math.ceil(t/ie)%4,r=Math.ceil(e/ie)%4;if(o.add(ae(t)*i,de(t)*i),o.add(ae(e)*i,de(e)*i),n!==r||e-t>ee){let t=!1;for(let e=0;e<ar.length;e++)if(t||n!==ar[e]){if(t&&r===ar[e])break;if(t){const t=sr[ar[e]];o.add(t.x,t.y)}}else{t=!0;const e=sr[n];o.add(e.x,e.y)}}}function hr(t,e,i){const{x:o,y:n}=pe(t.x,t.y,e.x,e.y,i),{x:r,y:s}=pe(t.x1,t.y1,e.x1,e.y1,i),a=new fe(o,n,r,s);return a.defined=e.defined,a}function dr(t,e,i){if(!t||!e)return[];Array.isArray(t)||(t=[t]),Array.isArray(e)||(e=[e]);let o=[];if(t.length>e.length){o=e.map((t=>{const e=new fe(t.x,t.y,t.x1,t.y1);return e.defined=t.defined,e}));for(let n=0;n<e.length;n++)o[n]=hr(t[n],e[n],i)}else{o=e.map((t=>{const e=new fe(t.x,t.y,t.x1,t.y1);return e.defined=t.defined,e}));for(let n=0;n<t.length;n++)o[n]=hr(t[n],e[n],i)}return o}function cr(t,e){if(ht(t)){let i;for(let o=0;o<t.length&&void 0===i;o++)i=t[o][e];return i}return t[e]}class ur{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ur.TimeOut;this.durations=[],this.timeout=t,this.lastDate=0,this.durationsListThreshold=30}call(t){return this.lastDate=Date.now(),setTimeout((()=>{this.appendDuration(Date.now()-this.lastDate),t(0)}),this.timeout,!0)}clear(t){clearTimeout(t)}appendDuration(t){this.durations.push(t),this.durations.length>this.durationsListThreshold&&this.durations.shift(),this.timeout=Math.min(Math.max(this.durations.reduce(((t,e)=>t+e),0)/this.durations.length,1e3/60),1e3/30)}}ur.TimeOut=1e3/60;const gr=new ur,pr=(t,e)=>{const i=((t,e)=>lt(t)&&"%"===t[t.length-1]?e*(Number.parseFloat(t.substring(0,t.length-1))/100):t)(t,e);return isNaN(i)?i:Math.max(e,i)};var fr;!function(t){t[t.Color255=0]="Color255",t[t.Color1=1]="Color1"}(fr||(fr={}));class vr{static Get(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:fr.Color1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0,1];if(e===fr.Color1){const e=vr.store1[t];if(e)return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i;const o=Ke.parseColorString(t);if(o){const e=[o.r/255,o.g/255,o.b/255,o.opacity];vr.store1[t]=e,vr.store255[t]=[o.r,o.g,o.b,o.opacity],i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]}return i}const o=vr.store255[t];if(o)return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i;const n=Ke.parseColorString(t);return n&&(vr.store1[t]=[n.r/255,n.g/255,n.b/255,n.opacity],vr.store255[t]=[n.r,n.g,n.b,n.opacity],i[0]=n.r,i[1]=n.g,i[2]=n.b,i[3]=n.opacity),i}static Set(t,e,i){if(e===fr.Color1){if(vr.store1[t])return;vr.store1[t]=i,vr.store255[t]=[Math.floor(255*i[0]),Math.floor(255*i[1]),Math.floor(255*i[2]),Math.floor(255*i[3])]}else{if(vr.store255[t])return;vr.store255[t]=i,vr.store1[t]=[i[0]/255,i[1]/255,i[2]/255,i[3]]}}}function br(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Array.isArray(t)&&ut(t[0])?e?`rgb(${Math.round(t[0])},${Math.round(t[1])},${Math.round(t[2])},${t[3].toFixed(2)})`:`rgb(${Math.round(t[0])},${Math.round(t[1])},${Math.round(t[2])})`:t}function mr(t,e,i,o,n){return Array.isArray(t)&&!ut(t[0])||Array.isArray(e)&&!ut(e[0])?new Array(4).fill(0).map(((n,r)=>yr(ht(t)?t[r]:t,ht(e)?e[r]:e,i,o))):yr(t,e,i,o,n)}function yr(t,e,i,o,n){if(!t||!e)return t&&br(t)||e&&br(e)||!1;let r,s,a=!1,l=!1;if(Array.isArray(t)?r=t:"string"==typeof t?r=vr.Get(t,fr.Color255):a=!0,Array.isArray(e)?s=e:"string"==typeof e?s=vr.Get(e,fr.Color255):l=!0,a!==l){const r=a?t:e,s=a?e:t,l=Object.assign(Object.assign({},r),{stops:r.stops.map((t=>Object.assign(Object.assign({},t),{color:br(s)})))});return a?mr(r,l,i,o,n):mr(l,r,i,o,n)}if(a){if(t.gradient===e.gradient){const o=t,n=e,r=o.stops,s=n.stops;if(r.length!==s.length)return!1;if("linear"===o.gradient)return function(t,e,i){const o=t.stops,n=e.stops;return{gradient:"linear",x0:t.x0+(e.x0-t.x0)*i,x1:t.x1+(e.x1-t.x1)*i,y0:t.y0+(e.y0-t.y0)*i,y1:t.y1+(e.y1-t.y1)*i,stops:new Array(o.length).fill(0).map(((t,e)=>({color:xr(o[e].color,n[e].color,i),offset:o[e].offset+(n[e].offset-o[e].offset)*i})))}}(o,n,i);if("radial"===o.gradient)return function(t,e,i){const o=t.stops,n=e.stops;return{gradient:"radial",x0:t.x0+(e.x0-t.x0)*i,x1:t.x1+(e.x1-t.x1)*i,y0:t.y0+(e.y0-t.y0)*i,y1:t.y1+(e.y1-t.y1)*i,r0:t.r0+(e.r0-t.r0)*i,r1:t.r1+(e.r1-t.r1)*i,stops:new Array(o.length).fill(0).map(((t,e)=>({color:xr(o[e].color,n[e].color,i),offset:o[e].offset+(n[e].offset-o[e].offset)*i})))}}(o,n,i);if("conical"===o.gradient)return function(t,e,i){const o=t.stops,n=e.stops;return{gradient:"conical",startAngle:t.startAngle+(e.startAngle-t.startAngle)*i,endAngle:t.endAngle+(e.endAngle-t.endAngle)*i,x:t.x+(e.x-t.x)*i,y:t.y+(e.y-t.y)*i,stops:new Array(o.length).fill(0).map(((t,e)=>({color:xr(o[e].color,n[e].color,i),offset:o[e].offset+(n[e].offset-o[e].offset)*i})))}}(o,n,i)}return!1}return n&&n(r,s),br(function(t,e,i){return[t[0]+(e[0]-t[0])*i,t[1]+(e[1]-t[1])*i,t[2]+(e[2]-t[2])*i,t[3]+(e[3]-t[3])*i]}(r,s,i),o)}vr.store255={},vr.store1={};const Cr=[0,0,0,0],wr=[0,0,0,0];function xr(t,e,i){return vr.Get(t,fr.Color255,Cr),vr.Get(e,fr.Color255,wr),`rgba(${Math.round(Cr[0]+(wr[0]-Cr[0])*i)},${Math.round(Cr[1]+(wr[1]-Cr[1])*i)},${Math.round(Cr[2]+(wr[2]-Cr[2])*i)},${Cr[3]+(wr[3]-Cr[3])*i})`}class _r{static GetImage(t,e){var i;const o=_r.cache.get(t);o?"fail"===o.loadState?zo.global.getRequestAnimationFrame()((()=>{e.imageLoadFail(t)})):"init"===o.loadState||"loading"===o.loadState?null===(i=o.waitingMark)||void 0===i||i.push(e):e&&e.imageLoadSuccess(t,o.data):_r.loadImage(t,e)}static GetSvg(t,e){var i;let o=_r.cache.get(t);o?"fail"===o.loadState?zo.global.getRequestAnimationFrame()((()=>{e.imageLoadFail(t)})):"init"===o.loadState||"loading"===o.loadState?null===(i=o.waitingMark)||void 0===i||i.push(e):e&&e.imageLoadSuccess(t,o.data):(o={type:"image",loadState:"init"},_r.cache.set(t,o),o.dataPromise=zo.global.loadSvg(t),o.dataPromise?(o.waitingMark=[e],o.dataPromise.then((e=>{var i;o.loadState=(null==e?void 0:e.data)?"success":"fail",o.data=null==e?void 0:e.data,null===(i=o.waitingMark)||void 0===i||i.map(((i,n)=>{(null==e?void 0:e.data)?(o.loadState="success",o.data=e.data,i.imageLoadSuccess(t,e.data)):(o.loadState="fail",i.imageLoadFail(t))})),o.waitingMark&&(o.waitingMark=[])}))):(o.loadState="fail",e.imageLoadFail(t)))}static GetFile(t,e){let i=_r.cache.get(t);return i?"fail"===i.loadState?Promise.reject():"init"===i.loadState||"loading"===i.loadState?i.dataPromise.then((t=>t.data)):Promise.resolve(i.data):(i={type:e,loadState:"init"},_r.cache.set(t,i),"arrayBuffer"===e?i.dataPromise=zo.global.loadArrayBuffer(t):"blob"===e?i.dataPromise=zo.global.loadBlob(t):"json"===e&&(i.dataPromise=zo.global.loadJson(t)),i.dataPromise.then((t=>t.data)))}static loading(){setTimeout((()=>{if(!_r.isLoading&&_r.toLoadAueue.length){_r.isLoading=!0;const t=_r.toLoadAueue.splice(0,10),e=[];t.forEach((t=>{const{url:i,marks:o}=t,n={type:"image",loadState:"init"};if(_r.cache.set(i,n),n.dataPromise=zo.global.loadImage(i),n.dataPromise){n.waitingMark=o;const t=n.dataPromise.then((t=>{var e;n.loadState=(null==t?void 0:t.data)?"success":"fail",n.data=null==t?void 0:t.data,null===(e=n.waitingMark)||void 0===e||e.map(((e,o)=>{(null==t?void 0:t.data)?(n.loadState="success",n.data=t.data,e.imageLoadSuccess(i,t.data)):(n.loadState="fail",e.imageLoadFail(i))})),n.waitingMark&&(n.waitingMark=[])}));e.push(t)}else n.loadState="fail",o.forEach((t=>t.imageLoadFail(i)))})),Promise.all(e).then((()=>{_r.isLoading=!1,this.onLoadSuccessCb.forEach((t=>t())),_r.loading()})).catch((t=>{_r.isLoading=!1,this.onLoadSuccessCb.forEach((t=>t())),_r.loading()}))}}),0)}static loadImage(t,e){const i=Sr(t,_r.toLoadAueue);if(-1!==i)return _r.toLoadAueue[i].marks.push(e),void _r.loading();_r.toLoadAueue.push({url:t,marks:[e]}),_r.loading()}static improveImageLoading(t){const e=Sr(t,_r.toLoadAueue);if(-1!==e){const t=_r.toLoadAueue.splice(e,1);_r.toLoadAueue.unshift(t[0])}}static onLoadSuccess(t){this.onLoadSuccessCb.push(t)}}function Sr(t,e){for(let i=0;i<e.length;i++)if(e[i].url===t)return i;return-1}_r.cache=new Map,_r.isLoading=!1,_r.toLoadAueue=[],_r.onLoadSuccessCb=[];const Ar=new Ie,Br=new Fe,Rr=["lineWidth","scaleX","scaleY","angle","anchor","visible"],Tr=["x","y"],kr=["scaleX","scaleY"],Mr=["angle"],Lr=new fe,Pr={strokeSeg:1,boundsPadding:2,pickMode:1,boundsMode:1,customPickShape:1,pickable:1,childrenPickable:1,visible:1,zIndex:1,layout:1,keepDirIn3d:1,globalZIndex:1,outerBorder:1,innerBorder:1,lineDash:1,lineCap:1,lineJoin:1,miterLimit:2,strokeBoundsBuffer:2,scaleCenter:1,anchor:1,anchor3d:1,postMatrix:1,backgroundMode:2,background:1,texture:1,cursor:1,html:1};class Er extends Ln{static mixin(t){const e=Object.keys(t);for(let i=0;i<e.length;++i){const o=e[i];Object.defineProperty(Er.prototype,o,Object.getOwnPropertyDescriptor(t,o))}}get AABBBounds(){return this.tryUpdateAABBBounds("imprecise"===this.attribute.boundsMode)}get OBBBounds(){return this.tryUpdateOBBBounds()}get globalAABBBounds(){return this.tryUpdateGlobalAABBBounds()}get transMatrix(){return this.tryUpdateLocalTransMatrix(!0)}get globalTransMatrix(){return this.tryUpdateGlobalTransMatrix(!0)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var e;super(),this._AABBBounds=new Fe,this._updateTag=yi.INIT,this.attribute=t,this.valid=this.isValid(),this.updateAABBBoundsStamp=0,t.background?this.loadImage(null!==(e=t.background.background)&&void 0!==e?e:t.background,!0):t.shadowGraphic&&this.setShadowGraphic(t.shadowGraphic)}setMode(t){"3d"===t?this.set3dMode():this.set2dMode()}set3dMode(){this.in3dMode=!0}set2dMode(){this.in3dMode=!1}getOffsetXY(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var i,o;const{dx:n=t.dx,dy:r=t.dy}=this.attribute;if(e&&this.parent){const t=this.parent.attribute;Lr.x=n+(null!==(i=t.scrollX)&&void 0!==i?i:0),Lr.y=r+(null!==(o=t.scrollY)&&void 0!==o?o:0)}else Lr.x=n,Lr.y=r;return Lr}onAnimateBind(t){this._emitCustomEvent("animate-bind",t)}tryUpdateAABBBounds(t){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;if(!this.valid)return this._AABBBounds.clear(),this._AABBBounds;zo.graphicService.beforeUpdateAABBBounds(this,this.stage,!0,this._AABBBounds);const e=this.doUpdateAABBBounds(t);return zo.graphicService.afterUpdateAABBBounds(this,this.stage,this._AABBBounds,this,!0),e}tryUpdateOBBBounds(){return this._OBBBounds||(this._OBBBounds=new Oe),this.tryUpdateAABBBounds(),this.updateOBBBoundsStamp===this.updateAABBBoundsStamp?this._OBBBounds:(this.updateOBBBoundsStamp=this.updateAABBBoundsStamp,this.valid?this.doUpdateOBBBounds():(this._OBBBounds.clear(),this._OBBBounds))}combindShadowAABBBounds(t){if(this.shadowRoot){const e=this.shadowRoot.AABBBounds.clone();t.union(e)}}doUpdateOBBBounds(){return this._OBBBounds}doUpdateAABBBounds(t){this.updateAABBBoundsStamp++;const e=this.getGraphicTheme();this._AABBBounds.clear();const i=this.attribute,o=this.updateAABBBounds(i,e,this._AABBBounds,t),{boundsPadding:n=e.boundsPadding}=i,r=rr(n);return r&&o.expand(r),this.clearUpdateBoundTag(),o}updatePathProxyAABBBounds(t){const e="function"==typeof this.pathProxy?this.pathProxy(this.attribute):this.pathProxy;if(!e)return!1;const i=new ti(t);return Li(e.commandList,i,0,0),!0}tryUpdateGlobalAABBBounds(){const t=this.AABBBounds;return this._globalAABBBounds?this._globalAABBBounds.setValue(t.x1,t.y1,t.x2,t.y2):this._globalAABBBounds=t.clone(),this._globalAABBBounds.empty()||this.parent&&this._globalAABBBounds.transformWithMatrix(this.parent.globalTransMatrix),this._globalAABBBounds}tryUpdateGlobalTransMatrix(){if(this._globalTransMatrix){if(this.parent){const t=this.parent.globalTransMatrix;this._globalTransMatrix.setValue(t.a,t.b,t.c,t.d,t.e,t.f)}}else this._globalTransMatrix=this.parent?this.parent.globalTransMatrix.clone():this.transMatrix.clone();return this.shouldUpdateGlobalMatrix()&&this.doUpdateGlobalMatrix(),this._globalTransMatrix}shouldUpdateGlobalMatrix(){return!0}tryUpdateLocalTransMatrix(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._transMatrix||(this._transMatrix=new Ie),this.shouldUpdateLocalMatrix()&&(this.doUpdateLocalMatrix(),t&&this.clearUpdateLocalPositionTag()),this._transMatrix}shouldUpdateAABBBounds(){return this.shadowRoot?(!!(this._updateTag&yi.UPDATE_BOUNDS)||this.shadowRoot.shouldUpdateAABBBounds())&&zo.graphicService.validCheck(this.attribute,this.getGraphicTheme(),this._AABBBounds,this):!!(this._updateTag&yi.UPDATE_BOUNDS)&&zo.graphicService.validCheck(this.attribute,this.getGraphicTheme(),this._AABBBounds,this)}shouldSelfChangeUpdateAABBBounds(){return this.shadowRoot?!!(this._updateTag&yi.UPDATE_BOUNDS)||this.shadowRoot.shouldUpdateAABBBounds():!!(this._updateTag&yi.UPDATE_BOUNDS)}shouldUpdateLocalMatrix(){return!!(this._updateTag&yi.UPDATE_LOCAL_MATRIX)}isValid(){var t,e;const i=this.attribute;return Number.isFinite((null!==(t=i.x)&&void 0!==t?t:0)+(null!==(e=i.y)&&void 0!==e?e:0))}_validNumber(t){return null==t||Number.isFinite(t)}shouldUpdateShape(){return!!(this._updateTag&yi.UPDATE_SHAPE)}clearUpdateShapeTag(){this._updateTag&=yi.CLEAR_SHAPE}containsPoint(t,e,i,o){if(!o)return!1;if(i===Ci.GLOBAL){const i=new fe(t,e);this.parent&&this.parent.globalTransMatrix.transformPoint(i,i),t=i.x,e=i.y}return o.containsPoint(this,{x:t,y:e})}setAttributes(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;(t=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,null,i)||t).background?this.loadImage(t.background,!0):t.shadowGraphic&&this.setShadowGraphic(t.shadowGraphic),this._setAttributes(t,e,i)}_setAttributes(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;const o=Object.keys(t);for(let e=0;e<o.length;e++){const i=o[e];this.attribute[i]=t[i]}this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!e&&!this.needUpdateTags(o)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(i)}setAttribute(t,e,i,o){var n;const r=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({[t]:e},this.attribute,t,o);r?this._setAttributes(r,i,o):it(null===(n=this.normalAttrs)||void 0===n?void 0:n[t])?(this.attribute[t]=e,this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!i&&!this.needUpdateTag(t)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(o)):this.normalAttrs[t]=e,"background"===t?this.loadImage(e,!0):"shadowGraphic"===t&&this.setShadowGraphic(e)}needUpdateTags(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Rr;for(let i=0;i<e.length;i++){const o=e[i];if(-1!==t.indexOf(o))return!0}return!1}needUpdateTag(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Rr;for(let i=0;i<e.length;i++)if(t===e[i])return!0;return!1}initAttributes(t){const e={type:wi.INIT};t=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,null,e)||t,this.attribute=t,t.background?this.loadImage(t.background,!0):t.shadowGraphic&&this.setShadowGraphic(t.shadowGraphic),this._updateTag=yi.INIT,this.valid=this.isValid(),this.onAttributeUpdate(e)}translate(t,e){var i,o;if(0===t&&0===e)return this;const n={type:wi.TRANSLATE},r=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({x:t,y:e},this.attribute,Tr,n);r&&(t=r.x,e=r.y,delete r.x,delete r.y,this._setAttributes(r));const s=this.attribute,a=s.postMatrix;return a?zo.transformUtil.fromMatrix(a,a).translate(t,e):(s.x=(null!==(i=s.x)&&void 0!==i?i:vo.x)+t,s.y=(null!==(o=s.y)&&void 0!==o?o:vo.y)+e),this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(n),this}translateTo(t,e){const i=this.attribute;if(i.x===t&&i.y===e)return this;const o={type:wi.TRANSLATE_TO},n=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({x:t,y:e},this.attribute,Tr,o);return n?(this._setAttributes(n,!1,o),this):(i.x=t,i.y=e,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(o),this)}scale(t,e,i){var o,n;if(1===t&&1===e)return this;const r={type:wi.SCALE},s=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({scaleX:t,scaleY:e,scaleCenter:i},this.attribute,kr,r);s&&(t=s.scaleX,e=s.scaleY,delete s.scaleX,delete s.scaleY,this._setAttributes(s));const a=this.attribute;if(i){let{postMatrix:o}=this.attribute;o||(o=new Ie,a.postMatrix=o),zo.transformUtil.fromMatrix(o,o).scale(t,e,i)}else a.scaleX=(null!==(o=a.scaleX)&&void 0!==o?o:vo.scaleX)*t,a.scaleY=(null!==(n=a.scaleY)&&void 0!==n?n:vo.scaleY)*e;return this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r),this}scaleTo(t,e){const i=this.attribute;if(i.scaleX===t&&i.scaleY===e)return this;const o={type:wi.SCALE_TO},n=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({scaleX:t,scaleY:e},this.attribute,kr,o);return n?(this._setAttributes(n,!1,o),this):(i.scaleX=t,i.scaleY=e,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(o),this)}rotate(t,e){var i;if(0===t)return this;const o={type:wi.ROTATE},n=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({angle:t,rotateCenter:e},this.attribute,Mr,o);n&&(delete n.angle,this._setAttributes(n,!1,o));const r=this.attribute;if(e){let{postMatrix:i}=this.attribute;i||(i=new Ie,r.postMatrix=i),zo.transformUtil.fromMatrix(i,i).rotate(t,e)}else r.angle=(null!==(i=r.angle)&&void 0!==i?i:vo.angle)+t;return this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(o),this}rotateTo(t){const e=this.attribute;if(e.angle===t)return this;const i={type:wi.ROTATE_TO},o=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,Mr,i);return o?(this._setAttributes(o,!1,i),this):(e.angle=t,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(i),this)}skewTo(t,e){return this}animate(t){this.animates||(this.animates=new Map);const e=new Zn(null==t?void 0:t.id,this.stage&&this.stage.getTimeline(),null==t?void 0:t.slience);if(e.bind(this),t){const{onStart:i,onFrame:o,onEnd:n,onRemove:r}=t;null!=i&&e.onStart(i),null!=o&&e.onFrame(o),null!=n&&e.onEnd(n),null!=r&&e.onRemove(r),e.interpolateFunc=t.interpolate}return this.animates.set(e.id,e),e.onRemove((()=>{this.animates.delete(e.id)})),e}onAttributeUpdate(t){t&&t.skipUpdateCallback||(zo.graphicService.onAttributeUpdate(this),this._emitCustomEvent("afterAttributeUpdate",t))}update(t){t?(t.bounds&&this.tryUpdateAABBBounds("imprecise"===this.attribute.boundsMode),t.trans&&this.tryUpdateLocalTransMatrix()):(this.tryUpdateAABBBounds("imprecise"===this.attribute.boundsMode),this.tryUpdateLocalTransMatrix())}hasState(t){return!(!this.currentStates||!this.currentStates.length)&&(!!it(t)||this.currentStates.includes(t))}getState(t){var e;return null===(e=this.states)||void 0===e?void 0:e[t]}applyStateAttrs(t,e,i,o){var n,r,s,a;if(i){const i=Object.keys(t),l=this.getNoWorkAnimateAttr(),h={};let d;i.forEach((e=>{l[e]?(d||(d={}),d[e]=t[e]):h[e]=o&&void 0===t[e]?this.getDefaultAttribute(e):t[e]}));const c=this.animate({slience:!0});c.stateNames=e,c.to(h,null!==(r=null===(n=this.stateAnimateConfig)||void 0===n?void 0:n.duration)&&void 0!==r?r:tr,null!==(a=null===(s=this.stateAnimateConfig)||void 0===s?void 0:s.easing)&&void 0!==a?a:er),d&&this.setAttributes(d,!1,{type:wi.STATE})}else this.stopStateAnimates(),this.setAttributes(t,!1,{type:wi.STATE})}updateNormalAttrs(t){const e={};this.normalAttrs?(Object.keys(t).forEach((t=>{t in this.normalAttrs?(e[t]=this.normalAttrs[t],delete this.normalAttrs[t]):e[t]=this.getNormalAttribute(t)})),Object.keys(this.normalAttrs).forEach((e=>{t[e]=this.normalAttrs[e]}))):Object.keys(t).forEach((t=>{e[t]=this.getNormalAttribute(t)})),this.normalAttrs=e}stopStateAnimates(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"end";this.animates&&this.animates.forEach((e=>{e.stateNames&&(e.stop(t),this.animates.delete(e.id))}))}getNormalAttribute(t){let e=this.attribute[t];return this.animates&&this.animates.forEach((i=>{if(i.stateNames){const o=i.getEndProps();_t(o,t)&&(e=o[t])}})),e}clearStates(t){this.hasState()&&this.normalAttrs?(this.currentStates=[],this.applyStateAttrs(this.normalAttrs,this.currentStates,t,!0)):this.currentStates=[],this.normalAttrs=null}removeState(t,e){if((this.currentStates?this.currentStates.indexOf(t):-1)>=0){const i=this.currentStates.filter((e=>e!==t));this.useStates(i,e)}}toggleState(t,e){if(this.hasState(t))this.removeState(t,e);else if((this.currentStates?this.currentStates.indexOf(t):-1)<0){const i=this.currentStates?this.currentStates.slice():[];i.push(t),this.useStates(i,e)}}addState(t,e,i){var o;if(this.currentStates&&this.currentStates.includes(t)&&(e||1===this.currentStates.length))return;const n=e&&(null===(o=this.currentStates)||void 0===o?void 0:o.length)?this.currentStates.concat([t]):[t];this.useStates(n,i)}useStates(t,e){var i;if(!t.length)return void this.clearStates(e);if((null===(i=this.currentStates)||void 0===i?void 0:i.length)===t.length&&!t.some(((t,e)=>this.currentStates[e]!==t)))return;const o={};t.forEach((e=>{var i;const n=this.stateProxy?this.stateProxy(e,t):null===(i=this.states)||void 0===i?void 0:i[e];n&&Object.assign(o,n)})),this.updateNormalAttrs(o),this.currentStates=t,this.applyStateAttrs(o,t,e)}addUpdateBoundTag(){this._updateTag|=yi.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag(),this.glyphHost&&this.glyphHost.addUpdateBoundTag()}addUpdateShapeTag(){this._updateTag|=yi.UPDATE_SHAPE}addUpdateShapeAndBoundsTag(){this._updateTag|=yi.UPDATE_SHAPE_AND_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag(),this.glyphHost&&this.glyphHost.addUpdateBoundTag()}updateShapeAndBoundsTagSetted(){return(this._updateTag&yi.UPDATE_SHAPE_AND_BOUNDS)===yi.UPDATE_SHAPE_AND_BOUNDS}clearUpdateBoundTag(){this._updateTag&=yi.CLEAR_BOUNDS}addUpdatePositionTag(){this.shadowRoot&&this.shadowRoot.addUpdateGlobalPositionTag(),this._updateTag|=yi.UPDATE_GLOBAL_LOCAL_MATRIX}addUpdateGlobalPositionTag(){this.shadowRoot&&this.shadowRoot.addUpdateGlobalPositionTag(),this._updateTag|=yi.UPDATE_GLOBAL_MATRIX}clearUpdateLocalPositionTag(){this._updateTag&=yi.CLEAR_LOCAL_MATRIX}clearUpdateGlobalPositionTag(){this._updateTag&=yi.CLEAR_GLOBAL_MATRIX}addUpdateLayoutTag(){this._updateTag|=yi.UPDATE_LAYOUT}clearUpdateLayoutTag(){this._updateTag&=yi.CLEAR_LAYOUT}needUpdateLayout(){return!!(this._updateTag&yi.UPDATE_LAYOUT)}getAnchor(t,e){const i=[0,0],o=()=>{if(e.b)return e.b;const{scaleX:t,scaleY:i,angle:o}=this.attribute;return Br.copy(this._AABBBounds),this.setAttributes({scaleX:1,scaleY:1,angle:0}),e.b=this.AABBBounds.clone(),this._AABBBounds.copy(Br),this.setAttributes({scaleX:t,scaleY:i,angle:o}),e.b};if("string"==typeof t[0]){const e=parseFloat(t[0])/100,n=o();i[0]=n.x1+(n.x2-n.x1)*e}else i[0]=t[0];if("string"==typeof t[1]){const e=parseFloat(t[1])/100,n=o();i[1]=n.y1+(n.y2-n.y1)*e}else i[1]=t[1];return i}doUpdateLocalMatrix(){const{x:t=vo.x,y:e=vo.y,scaleX:i=vo.scaleX,scaleY:o=vo.scaleY,angle:n=vo.angle,scaleCenter:r,anchor:s,postMatrix:a}=this.attribute;let l=[0,0];const h={};if(s&&(l=this.getAnchor(s,h)),!r||1===i&&1===o)!function(t,e,i,o,n,r,s,a){const l=e.a,h=e.b,d=e.c,c=e.d,u=e.e,g=e.f,p=ae(s),f=de(s);let v,b;a?(v=a[0],b=a[1]):(v=i,b=o);const m=v-i,y=b-o,C=l*p+d*f,w=h*p+c*f,x=d*p-l*f,_=c*p-h*f;t.a=n*C,t.b=n*w,t.c=r*x,t.d=r*_,t.e=u+l*v+d*b-C*m-x*y,t.f=g+h*v+c*b-w*m-_*y}(this._transMatrix,this._transMatrix.reset(),t,e,i,o,n,s&&l);else{const s=this._transMatrix;s.reset(),s.translate(l[0],l[1]),s.rotate(n),s.translate(-l[0],-l[1]),s.translate(t,e),l=this.getAnchor(r,h),zo.transformUtil.fromMatrix(s,s).scale(i,o,{x:l[0],y:l[1]})}const d=this.getOffsetXY(vo);if(this._transMatrix.e+=d.x,this._transMatrix.f+=d.y,a){const t=Ar.setValue(a.a,a.b,a.c,a.d,a.e,a.f),e=this._transMatrix;t.multiply(e.a,e.b,e.c,e.d,e.e,e.f),e.setValue(t.a,t.b,t.c,t.d,t.e,t.f)}}doUpdateGlobalMatrix(){if(this.parent){this._globalTransMatrix.multiply(this.transMatrix.a,this.transMatrix.b,this.transMatrix.c,this.transMatrix.d,this.transMatrix.e,this.transMatrix.f);const{scrollX:t=0,scrollY:e=0}=this.parent.attribute;this._globalTransMatrix.translate(t,e)}}setStage(t,e){if(this.stage!==t){if(this.stage=t,this.layer=e,this.setStageToShadowRoot(t,e),this.animates&&this.animates.size){const e=t.getTimeline();this.animates.forEach((t=>{t.setTimeline(e)}))}this._onSetStage&&this._onSetStage(this,t,e),zo.graphicService.onSetStage(this,t)}}setStageToShadowRoot(t,e){this.shadowRoot&&this.shadowRoot.setStage(t,e)}onAddStep(t){}onStop(t){t&&this.setAttributes(t,!1,{type:wi.ANIMATE_END})}onStep(t,e,i,o,n){const r={};if(i.customAnimate)i.customAnimate.update(n,o,r);else{const s=i.props,a=i.parsedProps,l=i.propKeys;this.stepInterpolate(t,e,r,i,o,n,s,void 0,a,l)}this.setAttributes(r,!1,{type:wi.ANIMATE_UPDATE,animationState:{ratio:o,end:n,step:i,isFirstFrameOfStep:t.getLastStep()!==i}}),this.stage&&this.stage.renderNextFrame()}stepInterpolate(t,e,i,o,n,r,s,a,l,h){h||(h=Object.keys(s),o.propKeys=h),r?o.propKeys.forEach((t=>{e.validAttr(t)&&(i[t]=s[t])})):h.forEach((r=>{var h;if(!e.validAttr(r))return;const d=s[r],c=null!==(h=a&&a[r])&&void 0!==h?h:t.getLastPropByName(r,o);if(null==d||null==c||d===c)return void(i[r]=d);let u;u=e.interpolateFunc&&e.interpolateFunc(r,n,c,d,i),u||(u=e.customInterpolate(r,n,c,d,this,i),u||this.defaultInterpolate(d,c,r,i,l,n)||this._interpolate(r,n,c,d,i))})),o.parsedProps=l}defaultInterpolate(t,e,i,o,n,r){if(Number.isFinite(t))return o[i]=e+(t-e)*r,!0;if("fill"===i){n||(n={});const s=n.fillColorArray,a=mr(e,null!=s?s:t,r,!1,((t,e)=>{n.fillColorArray=e}));return a&&(o[i]=a),!0}if("stroke"===i){n||(n={});const s=n.strokeColorArray,a=mr(e,null!=s?s:t,r,!1,((t,e)=>{n.strokeColorArray=e}));return a&&(o[i]=a),!0}if("shadowColor"===i){n||(n={});const s=n.shadowColorArray,a=mr(e,null!=s?s:t,r,!0,((t,e)=>{n.shadowColorArray=e}));return a&&(o[i]=a),!0}return!1}_interpolate(t,e,i,o,n){}getDefaultAttribute(t){return this.getGraphicTheme()[t]}getComputedAttribute(t){var e;return null!==(e=this.attribute[t])&&void 0!==e?e:this.getDefaultAttribute(t)}onSetStage(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._onSetStage=t,e&&this.stage&&t(this,this.stage)}attachShadow(t){return t&&(t.shadowHost=this),this.shadowRoot=null!=t?t:zo.graphicService.creator.shadowRoot(this),this.addUpdateBoundTag(),this.shadowRoot.setStage(this.stage,this.layer),this.shadowRoot}detachShadow(){this.shadowRoot&&(this.addUpdateBoundTag(),this.shadowRoot=null)}toJson(){return{attribute:this.attribute,_uid:this._uid,type:this.type,name:this.name,children:this.children.map((t=>t.toJson()))}}createPathProxy(t){return lt(t,!0)?this.pathProxy=(new go).fromString(t):this.pathProxy=new go,this.pathProxy}loadImage(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t||e&&function(t){return!(!t.fill&&!t.stroke)}(t))return;const i=t;this.resources||(this.resources=new Map);const o={data:"init",state:null};this.resources.set(i,o),"string"==typeof t?(o.state="loading",t.startsWith("<svg")?(_r.GetSvg(t,this),this.backgroundImg=this.backgroundImg||e):(pt(t)||t.includes("/")||ft(t))&&(_r.GetImage(t,this),this.backgroundImg=this.backgroundImg||e)):nt(t)?(o.state="success",o.data=t,this.backgroundImg=this.backgroundImg||e):o.state="fail"}setShadowGraphic(t){t?this.attachShadow().add(t):this.detachShadow()}imageLoadSuccess(t,e,i){if(!this.resources)return;const o=this.resources.get(t);o&&(o.state="success",o.data=e,i&&i(),this.addUpdateBoundTag(),this.stage&&this.stage.renderNextFrame())}imageLoadFail(t,e){if(!this.resources)return;const i=this.resources.get(t);i&&(i.state="fail",e&&e())}_stopAnimates(t){t&&t.forEach((t=>{t.stop()}))}stopAnimates(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._stopAnimates(this.animates),this.shadowRoot&&this.shadowRoot.stopAnimates(!0),this.isContainer&&t&&this.forEachChildren((e=>{e.stopAnimates(t)}))}release(){this.releaseStatus="released",zo.graphicService.onRelease(this)}_emitCustomEvent(t,e){var i,o;if(this._events&&t in this._events){const n=new On(t,e);n.bubbles=!1,n.manager=null===(o=null===(i=this.stage)||void 0===i?void 0:i.eventSystem)||void 0===o?void 0:o.manager,this.dispatchEvent(n)}}}Er.mixin(Dn);class Hr{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,e){"__proto__"===t&&(t="#__proto__"),this.child.push({[t]:e})}addChild(t){"__proto__"===t.tagname&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child})}}function Fr(t,e,i,o){const n=t.indexOf(e,i);if(-1===n)throw new Error(o);return n+e.length-1}function Or(t,e,i){const o=function(t,e){let i,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:">",n="";for(let r=e;r<t.length;r++){let e=t[r];if(i)e===i&&(i="");else if('"'===e||"'"===e)i=e;else if(e===o[0]){if(!o[1])return{data:n,index:r};if(t[r+1]===o[1])return{data:n,index:r}}else"\t"===e&&(e=" ");n+=e}}(t,e+1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:">");if(!o)return;let n=o.data;const r=o.index,s=n.search(/\s/);let a=n,l=!0;-1!==s&&(a=n.substr(0,s).replace(/\s\s*$/,""),n=n.substr(s+1));const h=a;if(i){const t=a.indexOf(":");-1!==t&&(a=a.substr(t+1),l=a!==o.data.substr(t+1))}return{tagName:a,tagExp:n,closeIndex:r,attrExpPresent:l,rawTagName:h}}const Ir=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");class zr{constructor(t){this.currentNode=null,this.options=t,this.tagsNodeStack=[],this.docTypeEntities={}}addChild(t,e,i){const o=e.tagname;"string"==typeof o?(e.tagname=o,t.addChild(e)):t.addChild(e)}buildAttributesMap(t,e,i){const o={};if(!t)return;const n=function(t,e){const i=[];let o=e.exec(t);for(;o;){const n=[];n.startIndex=e.lastIndex-o[0].length;const r=o.length;for(let t=0;t<r;t++)n.push(o[t]);i.push(n),o=e.exec(t)}return i}(t,Ir),r=n.length;for(let t=0;t<r;t++){const e=n[t][1],i=n[t][4];e&&(o[e]=void 0===i||(isNaN(i)?i:Number(i)))}return o}parseXml(t){t=t.replace(/\r\n?/g,"\n");const e=new Hr("!xml");let i=e,o="",n="";for(let r=0;r<t.length;r++)if("<"===t[r])if("/"===t[r+1]){const e=Fr(t,">",r,"Closing Tag is not closed."),s=n.lastIndexOf(".");n=n.substring(0,s),i=this.tagsNodeStack.pop(),i&&i.child&&o&&i.child[i.child.length-1][":@"]&&(i.child[i.child.length-1][":@"].text=o),o="",r=e}else if("?"===t[r+1])r=Or(t,r,!1,"?>").closeIndex+1;else if("!--"===t.substr(r+1,3))r=Fr(t,"--\x3e",r+4,"Comment is not closed.");else{const s=Or(t,r,!1);let a=s.tagName,l=s.tagExp;const h=s.attrExpPresent,d=s.closeIndex;if(a!==e.tagname&&(n+=n?"."+a:a),l.length>0&&l.lastIndexOf("/")===l.length-1){"/"===a[a.length-1]?(a=a.substr(0,a.length-1),n=n.substr(0,n.length-1),l=a):l=l.substr(0,l.length-1);const t=new Hr(a);a!==l&&h&&(t[":@"]=this.buildAttributesMap(l,n,a)),this.addChild(i,t,n),n=n.substr(0,n.lastIndexOf("."))}else{const t=new Hr(a);this.tagsNodeStack.push(i),a!==l&&h&&(t[":@"]=this.buildAttributesMap(l,n,a)),this.addChild(i,t,n),i=t}o="",r=d}else o+=t[r];return e.child}}function Dr(t,e){return Wr(t)}function Wr(t,e){const i={};for(let e=0;e<t.length;e++){const o=t[e],n=Nr(o);if(void 0!==n&&o[n]){const t=Wr(o[n]);jr(t),o[":@"]&&Gr(t,o[":@"]),void 0!==i[n]&&i.hasOwnProperty(n)?(Array.isArray(i[n])||(i[n]=[i[n]]),i[n].push(t)):i[n]=t}}return i}function Nr(t){const e=Object.keys(t);for(let t=0;t<e.length;t++){const i=e[t];if(":@"!==i)return i}}function Gr(t,e,i){if(e){const i=Object.keys(e),o=i.length;for(let n=0;n<o;n++){const o=i[n];t[o]=e[o]}}}function jr(t){return 0===Object.keys(t).length}class Vr{constructor(t){this.options=Object.assign({},Vr.defaultOptions,t)}valid(t){return t.startsWith("<")}parse(t){if(!this.valid)return!1;return Dr(new zr(this.options).parseXml(t),this.options)}}function Ur(t,e,i){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return t.expand(e+(o/2+(i?function(t,e){return t?e:0}(i,e):0))),t}Vr.defaultOptions={};let $r=0;function Xr(){return $r++}var Yr;!function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(Yr||(Yr={}));const Kr=new Map;["…","（","）","—","【","】","「","」","《","》"].forEach((t=>Kr.set(t,!0)));const qr=new Map;function Zr(t){if(Kr.has(t))return!0;if(qr.has(t))return!1;let e=!1;return t.codePointAt(0)<256&&(e=!0),e}[""].forEach((t=>qr.set(t,!0)));const Jr=Xr(),Qr=Xr(),ts=Xr(),es=Xr();Xr();const is=Xr(),os=Xr(),ns=Xr(),rs=Xr(),ss=Xr();Xr();const as=Xr();Xr();const ls=Xr(),hs=Xr(),ds=Xr(),cs=Symbol.for("GraphicService"),us=Symbol.for("GraphicCreator"),gs={"stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-dasharray":"lineDash","stroke-dashoffset":"lineDashOffset","stroke-width":"lineWidth","fill-opacity":"fillOpacity","stroke-opacity":"strokeOpacity",stroke:"stroke",fill:"fill"},ps=Object.keys(gs);var fs;!function(t){t[t.LESS_GROUP=0]="LESS_GROUP",t[t.MORE_GROUP=1]="MORE_GROUP"}(fs||(fs={}));let vs=class t extends Er{constructor(t){super(t),this.type="group",this.parent=null,this.isContainer=!0,this.numberType=is,this._childUpdateTag=yi.UPDATE_BOUNDS}setMode(t){"3d"===t?this.set3dMode():this.set2dMode()}set3dMode(){this.in3dMode=!0}set2dMode(){this.in3dMode=!1}setTheme(t){return this.theme||(this.theme=new Rn),this.theme.setTheme(t,this)}createTheme(){this.theme||(this.theme=new Rn)}visibleAll(t){this.setAttribute("visible",t),this.forEachChildren((e=>{e.isContainer&&e.visibleAll?e.visibleAll(t):e.setAttribute("visible",t)}))}hideAll(){this.visibleAll(!1)}showAll(){this.visibleAll(!0)}containsPoint(t,e,i){if(i===Ci.GLOBAL){const i=new fe(t,e);return this.parent&&this.parent.globalTransMatrix.transformPoint(i,i),this.AABBBounds.contains(i.x,i.y)}return this.AABBBounds.contains(t,e)}shouldUpdateAABBBounds(){return!!super.shouldUpdateAABBBounds()||!!(this._childUpdateTag&yi.UPDATE_BOUNDS)}tryUpdateAABBBounds(){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;zo.graphicService.beforeUpdateAABBBounds(this,this.stage,!0,this._AABBBounds);const t=this.shouldSelfChangeUpdateAABBBounds(),e=this.doUpdateAABBBounds();return this.addUpdateLayoutTag(),zo.graphicService.afterUpdateAABBBounds(this,this.stage,this._AABBBounds,this,t),e}doUpdateLocalMatrix(){const{x:t=vo.x,y:e=vo.y,dx:i=vo.dx,dy:o=vo.dy,scaleX:n=vo.scaleX,scaleY:r=vo.scaleY,angle:s=vo.angle,postMatrix:a}=this.attribute;if(0!==t||0!==e||0!==i||0!==o||1!==n||1!==r||0!==s||a)return super.doUpdateLocalMatrix();this._transMatrix.reset()}getGraphicTheme(){return kn(this).group}updateAABBBounds(t,e,i){const o=i;i=i.clone();const{width:n,height:r,path:s,clip:a=e.clip}=t;if(s&&s.length?s.forEach((t=>{i.union(t.AABBBounds)})):null!=n&&null!=r&&i.set(0,0,Math.max(0,n),Math.max(0,r)),!a){this.forEachChildren((t=>{i.union(t.AABBBounds)}));const{scrollX:e=0,scrollY:o=0}=t;i.translate(e,o)}return zo.graphicService.updateTempAABBBounds(i),zo.graphicService.transformAABBBounds(t,i,e,!1,this),o.copy(i),o}doUpdateAABBBounds(){this.updateAABBBoundsStamp++;const t=super.doUpdateAABBBounds();return this.parent&&this.parent.addChildUpdateBoundTag(),this._emitCustomEvent("AAABBBoundsChange"),t}clearUpdateBoundTag(){this._updateTag&=yi.CLEAR_BOUNDS,this._childUpdateTag&=yi.CLEAR_BOUNDS}addUpdateBoundTag(){this._updateTag|=yi.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag()}addChildUpdateBoundTag(){this._childUpdateTag&yi.UPDATE_BOUNDS||(this._childUpdateTag|=yi.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag())}getTheme(){return this.theme.getTheme(this)}incrementalAppendChild(t){const e=super.appendChild(t);return this.stage&&e&&(e.stage=this.stage,e.layer=this.layer),this.addUpdateBoundTag(),zo.graphicService.onAddIncremental(t,this,this.stage),e}incrementalClearChild(){super.removeAllChild(),this.addUpdateBoundTag(),zo.graphicService.onClearIncremental(this,this.stage)}_updateChildToStage(t){return this.stage&&t&&t.setStage(this.stage,this.layer),this.addUpdateBoundTag(),t}appendChild(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=super.appendChild(t);return e&&this.stage&&i&&i.setStage(this.stage,this.layer),this.addUpdateBoundTag(),i}insertBefore(t,e){return this._updateChildToStage(super.insertBefore(t,e))}insertAfter(t,e){return this._updateChildToStage(super.insertAfter(t,e))}insertInto(t,e){return this._updateChildToStage(super.insertInto(t,e))}removeChild(t){const e=super.removeChild(t);return t.stage=null,zo.graphicService.onRemove(t),this.addUpdateBoundTag(),e}removeAllChild(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.forEachChildren((e=>{zo.graphicService.onRemove(e),t&&e.isContainer&&e.removeAllChild(t)})),super.removeAllChild(),this.addUpdateBoundTag()}setStage(t,e){this.stage!==t&&(this.stage=t,this.layer=e,this.setStageToShadowRoot(t,e),this._onSetStage&&this._onSetStage(this,t,e),zo.graphicService.onSetStage(this,t),this.forEachChildren((e=>{e.setStage(t,this.layer)})))}addUpdatePositionTag(){super.addUpdatePositionTag(),this.forEachChildren((t=>{t.isContainer&&t.addUpdateGlobalPositionTag()}))}addUpdateGlobalPositionTag(){super.addUpdateGlobalPositionTag(),this.forEachChildren((t=>{t.isContainer&&t.addUpdateGlobalPositionTag()}))}tryUpdateGlobalTransMatrix(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.shouldUpdateGlobalMatrix()){if(this._globalTransMatrix){if(this.parent){const t=this.parent.globalTransMatrix;this._globalTransMatrix.setValue(t.a,t.b,t.c,t.d,t.e,t.f)}}else this._globalTransMatrix=this.parent?this.parent.globalTransMatrix.clone():this.transMatrix.clone();this.doUpdateGlobalMatrix(),t&&this.clearUpdateGlobalPositionTag()}return this._globalTransMatrix}shouldUpdateGlobalMatrix(){return!!(this._updateTag&yi.UPDATE_GLOBAL_MATRIX)}_getChildByName(t,e){return this.find((e=>e.name===t),e)}createOrUpdateChild(t,e,i){let o=this._getChildByName(t);return o?o.setAttributes(e):(o=zo.graphicService.creator[i](e),o.name=t,this.add(o)),o}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}};function bs(t){return new vs(t)}vs.NOWORK_ANIMATE_ATTR=Pr;class ms extends vs{get offscreen(){return this.layerHandler.offscreen}get layerMode(){return this.layerHandler.type}get width(){return this.stage?this.stage.width:0}get height(){return this.stage?this.stage.height:0}get viewWidth(){return this.stage?this.stage.viewWidth:0}get viewHeight(){return this.stage?this.stage.viewHeight:0}get dirtyBound(){throw new Error("暂不支持")}get dpr(){return this._dpr}constructor(t,e,i,o){var n;super({}),this.stage=t,this.global=e,this.window=i,this.main=o.main,this.layerHandler=o.layerHandler,this.layerHandler.init(this,i,{main:o.main,canvasId:o.canvasId,width:this.viewWidth,height:this.viewHeight,zIndex:null!==(n=o.zIndex)&&void 0!==n?n:0}),this.layer=this,this.subLayers=new Map,this.theme=new Rn,this.background="rgba(0, 0, 0, 0)",this.afterDrawCbs=[]}combineSubLayer(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const e=Array.from(this.subLayers.values()).sort(((t,e)=>t.zIndex-e.zIndex));this.layerHandler.merge(e.map((e=>(e.layer.subLayers.size&&e.layer.combineSubLayer(t),e.layer.getNativeHandler())))),t&&e.forEach((t=>{t.group&&(t.group.incremental=0)})),e.forEach((t=>{zo.layerService.releaseLayer(this.stage,t.layer)})),this.subLayers.clear()}getNativeHandler(){return this.layerHandler}setStage(t,e){super.setStage(t,this)}pick(t,e){throw new Error("暂不支持")}tryRenderSecondaryLayer(t,e){this.layerHandler.secondaryHandlers&&this.layerHandler.secondaryHandlers.length&&this.layerHandler.secondaryHandlers.forEach((i=>{i.layer.renderCount=this.renderCount,i.layer.render(t,e)}))}render(t,e){var i;this.layerHandler.render([this],{renderService:t.renderService,stage:this.stage,layer:this,viewBox:t.viewBox,transMatrix:t.transMatrix,background:null!==(i=t.background)&&void 0!==i?i:this.background,updateBounds:t.updateBounds},e),this.afterDrawCbs.forEach((t=>t(this))),this.tryRenderSecondaryLayer(t,e)}resize(t,e){this.layerHandler.resize(t,e)}resizeView(t,e){this.layerHandler.resizeView(t,e)}setDpr(t){this.layerHandler.setDpr(t)}afterDraw(t){this.afterDrawCbs.push(t)}startAnimate(t){throw new Error("暂不支持")}setToFrame(t){throw new Error("暂不支持")}prepare(t,e){}release(){super.release(),this.layerHandler.release(),this.subLayers&&this.subLayers.forEach((t=>{zo.layerService.releaseLayer(this.stage,t.layer)}))}drawTo(t,e){var i;this.layerHandler.drawTo(t,[this],Object.assign({background:null!==(i=e.background)&&void 0!==i?i:this.background,renderService:e.renderService,viewBox:e.viewBox,transMatrix:e.transMatrix,stage:this.stage,layer:this},e)),this.afterDrawCbs.forEach((t=>t(this)))}}const ys=Symbol.for("TransformUtil"),Cs=Symbol.for("GraphicUtil"),ws=Symbol.for("LayerService"),xs=Symbol.for("StaticLayerHandlerContribution"),_s=Symbol.for("DynamicLayerHandlerContribution"),Ss=Symbol.for("VirtualLayerHandlerContribution");var As,Bs=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Rs=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let Ts=As=class{static GenerateLayerId(){return`${As.idprefix}_${As.prefix_count++}`}constructor(){this.layerMap=new Map,this.global=zo.global}tryInit(){this.inited||(this.staticLayerCountInEnv=this.global.getStaticCanvasCount(),this.dynamicLayerCountInEnv=this.global.getDynamicCanvasCount(),this.inited=!0)}getStageLayer(t){return this.layerMap.get(t)}getRecommendedLayerType(t){return t||(0!==this.staticLayerCountInEnv?"static":0!==this.dynamicLayerCountInEnv?"dynamic":"virtual")}getLayerHandler(t){let e;return e="static"===t?sn.get(xs):"dynamic"===t?sn.get(_s):sn.get(Ss),e}createLayer(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{main:!1};var i;this.tryInit();let o=this.getRecommendedLayerType(e.layerMode);o=e.main||e.canvasId?"static":o;const n=this.getLayerHandler(o),r=new ms(t,this.global,t.window,Object.assign(Object.assign({main:!1},e),{layerMode:o,canvasId:null!==(i=e.canvasId)&&void 0!==i?i:As.GenerateLayerId(),layerHandler:n})),s=this.layerMap.get(t)||[];return s.push(r),this.layerMap.set(t,s),this.staticLayerCountInEnv--,r}prepareStageLayer(t){let e;t.forEachChildren((t=>{const i=t.getNativeHandler();"virtual"===i.type?(i.mainHandler=e,e.secondaryHandlers.push(i)):(e=i,e.secondaryHandlers=[])}))}releaseLayer(t,e){e.release();const i=this.layerMap.get(t)||[];this.layerMap.set(t,i.filter((t=>t!==e)))}layerCount(t){return(this.layerMap.get(t)||[]).length}restLayerCount(t){return"browser"===this.global.env?10:0}releaseStage(t){this.layerMap.delete(t)}};Ts.idprefix="visactor_layer",Ts.prefix_count=0,Ts=As=Bs([C(),Rs("design:paramtypes",[])],Ts);var ks=new a((t=>{t(G).to(X).inSingletonScope(),t(gn).to(fn),t(Cs).to(yn).inSingletonScope(),t(ys).to(xn).inSingletonScope(),t(ws).to(Ts).inSingletonScope()}));function Ms(t,e){return!(!t&&!e)}function Ls(t,e){let i;return i=ht(t)?t.some((t=>t||void 0===t)):!!t,i&&e>0}function Ps(t,e,i){return i&&t*e>0}function Es(t,e,i,o,n){return n&&t*e>0&&0!==i&&0!==o}function Hs(t,e){return t*e>0}function Fs(t,e,i,o){return t*e>0&&0!==i&&0!==o}function Os(t,e,i,o,n,r,s){const a=t-i,l=e-o,h=(s?r:-r)/Math.sqrt(a*a+l*l),d=h*l,c=-h*a,u=t+d,g=e+c,p=i+d,f=o+c,v=(u+p)/2,b=(g+f)/2,m=p-u,y=f-g,C=m*m+y*y,w=n-r,x=u*f-p*g,_=(y<0?-1:1)*Math.sqrt(Math.max(0,w*w*C-x*x));let S=(x*y-m*_)/C,A=(-x*m-y*_)/C;const B=(x*y+m*_)/C,R=(-x*m+y*_)/C,T=S-v,k=A-b,M=B-v,L=R-b;return T*T+k*k>M*M+L*L&&(S=B,A=R),{cx:S,cy:A,x01:-d,y01:-c,x11:S*(n/w-1),y11:A*(n/w-1)}}function Is(t,e,i,o,n){const r=re(i-e),s=t.getParsedCornerRadius(),a=ht(s),{outerDeltaAngle:l,innerDeltaAngle:h,outerStartAngle:d,outerEndAngle:c,innerEndAngle:u,innerStartAngle:g}=t.getParsePadAngle(e,i),p=a?s[0]:s,f=a?s[1]:s,v=a?s[2]:s,b=a?s[3]:s,m=Math.max(f,p),y=Math.max(v,b);let C=m,w=y;const x=n*ae(d),_=n*de(d),S=o*ae(u),A=o*de(u);let B,R,T,k;if((y>te||m>te)&&(B=n*ae(c),R=n*de(c),T=o*ae(g),k=o*de(g),r<ee)){const t=function(t,e,i,o,n,r,s,a){const l=i-t,h=o-e,d=s-n,c=a-r;let u=c*l-d*h;return u*u<te?[]:(u=(d*(e-r)-c*(t-n))/u,[t+u*l,e+u*h])}(x,_,T,k,B,R,S,A);if(t){const e=x-t[0],i=_-t[1],r=B-t[0],s=R-t[1],a=1/de(((M=(e*r+i*s)/(ce(e*e+i*i)*ce(r*r+s*s)))>1?0:M<-1?ee:Math.acos(M))/2),l=ce(t[0]*t[0]+t[1]*t[1]);w=he(y,(o-l)/(a-1)),C=he(m,(n-l)/(a+1))}}var M;return{outerDeltaAngle:l,xors:x,yors:_,xirs:T,yirs:k,xore:B,yore:R,xire:S,yire:A,limitedOcr:C,limitedIcr:w,outerCornerRadiusStart:p,outerCornerRadiusEnd:f,maxOuterCornerRadius:m,maxInnerCornerRadius:y,outerStartAngle:d,outerEndAngle:c,innerDeltaAngle:h,innerEndAngle:u,innerStartAngle:g,innerCornerRadiusStart:b,innerCornerRadiusEnd:v}}function zs(t,e,i,o,n,r,s){const{startAngle:a,endAngle:l}=t.getParsedAngle(),h=re(l-a),d=l>a;let c=!1;if(n<r){const t=n;n=r,r=t}if(n<=te)e.moveTo(i,o);else if(h>=ne-te)e.moveTo(i+n*ae(a),o+n*de(a)),e.arc(i,o,n,a,l,!d),r>te&&(e.moveTo(i+r*ae(l),o+r*de(l)),e.arc(i,o,r,l,a,d));else{const{outerDeltaAngle:h,xors:u,yors:g,xirs:p,yirs:f,limitedOcr:v,outerCornerRadiusStart:b,outerCornerRadiusEnd:m,maxOuterCornerRadius:y,xore:C,yore:w,xire:x,yire:_,outerStartAngle:S,outerEndAngle:A,limitedIcr:B,innerDeltaAngle:R,innerEndAngle:T,innerStartAngle:k,innerCornerRadiusStart:M,innerCornerRadiusEnd:L,maxInnerCornerRadius:P}=Is(t,a,l,r,n);if(h<.001)s&&(s[3]||s[1])&&e.moveTo(i+u,o+g),c=!0;else if(v>te){const t=he(b,v),r=he(m,v),a=Os(p,f,u,g,n,t,Number(d)),l=Os(C,w,x,_,n,r,Number(d));v<y&&t===r?!s||s[0]?(e.moveTo(i+a.cx+a.x01,o+a.cy+a.y01),e.arc(i+a.cx,o+a.cy,v,se(a.y01,a.x01),se(l.y01,l.x01),!d)):e.moveTo(i+a.cx+v*ae(se(l.y01,l.x01)),o+a.cy+v*de(se(l.y01,l.x01))):!s||s[0]?(e.moveTo(i+a.cx+a.x01,o+a.cy+a.y01),t>0&&e.arc(i+a.cx,o+a.cy,t,se(a.y01,a.x01),se(a.y11,a.x11),!d),e.arc(i,o,n,se(a.cy+a.y11,a.cx+a.x11),se(l.cy+l.y11,l.cx+l.x11),!d),r>0&&e.arc(i+l.cx,o+l.cy,r,se(l.y11,l.x11),se(l.y01,l.x01),!d)):r>0?e.moveTo(i+l.cx+r*ae(se(l.y01,l.x01)),o+l.cy+r*de(se(l.y01,l.x01))):e.moveTo(i+C,o+n*de(A))}else!s||s[0]?(e.moveTo(i+u,o+g),e.arc(i,o,n,S,A,!d)):e.moveTo(i+n*ae(A),o+n*de(A));if(!(r>te)||R<.001)!s||s[1]?e.lineTo(i+x,o+_):e.moveTo(i+x,o+_),c=!0;else if(B>te){const t=he(M,B),n=he(L,B),a=Os(x,_,C,w,r,-n,Number(d)),l=Os(u,g,p,f,r,-t,Number(d));if(!s||s[1]?e.lineTo(i+a.cx+a.x01,o+a.cy+a.y01):e.moveTo(i+a.cx+a.x01,o+a.cy+a.y01),B<P&&t===n){const t=se(l.y01,l.x01);!s||s[2]?e.arc(i+a.cx,o+a.cy,B,se(a.y01,a.x01),t,!d):e.moveTo(i+a.cx+ae(t),o+a.cy+de(t))}else!s||s[2]?(n>0&&e.arc(i+a.cx,o+a.cy,n,se(a.y01,a.x01),se(a.y11,a.x11),!d),e.arc(i,o,r,se(a.cy+a.y11,a.cx+a.x11),se(l.cy+l.y11,l.cx+l.x11),d),t>0&&e.arc(i+l.cx,o+l.cy,t,se(l.y11,l.x11),se(l.y01,l.x01),!d)):t>0?e.moveTo(i+l.cx+t*ae(se(l.y01,l.x01)),o+l.cy+t*de(se(l.y01,l.x01))):e.moveTo(i+p,o+f)}else!s||s[1]?e.lineTo(i+x,o+_):e.moveTo(i+x,o+_),!s||s[2]?e.arc(i,o,r,T,k,d):e.moveTo(i+r*ae(k),o+r*de(k))}return s?s[3]&&e.lineTo(i+n*ae(a),o+n*de(a)):e.closePath(),c}class Ds{static GetCanvas(){try{return Ds.canvas||(Ds.canvas=zo.global.createCanvas({})),Ds.canvas}catch(t){return null}}static GetCtx(){if(!Ds.ctx){const t=Ds.GetCanvas();Ds.ctx=t.getContext("2d")}return Ds.ctx}}class Ws extends ze{static getInstance(){return Ws._instance||(Ws._instance=new Ws),Ws._instance}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;super(),this.cacheParams={CLEAN_THRESHOLD:100,L_TIME:1e3},this.dataMap=new Map;const i=Ds.GetCanvas(),o=Ds.GetCtx();if(i.width=e,i.height=1,!o)return;if(o.translate(0,0),!o)throw new Error("获取ctx发生错误");const n=o.createLinearGradient(0,0,e,0);t.forEach((t=>{n.addColorStop(t[0],t[1])})),o.fillStyle=n,o.fillRect(0,0,e,1),this.rgbaSet=o.getImageData(0,0,e,1).data}getColor(t){const e=this.rgbaSet.slice(4*t,4*t+4);return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]/255})`}GetOrCreate(t,e,i,o){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:100,s=`${t}${e}${i}${o}`;n.forEach((t=>s+=t.join())),s+=r;let a=this.dataMap.get(s);return a||(a={data:new Ws(n,r),timestamp:[]},this.addLimitedTimestamp(a,Date.now(),{}),this.dataMap.set(s,a)),this.clearCache(this.dataMap,this.cacheParams),a.data}}class Ns{static GetSize(t){for(let e=0;e<Ns.ImageSize.length;e++)if(Ns.ImageSize[e]>=t)return Ns.ImageSize[e];return t}static Get(t,e,i,o,n,r,s){const a=Ns.GenKey(t,e,i,o,n),l=Ns.cache[a];if(!l||0===l.length)return null;for(let t=0;t<l.length;t++)if(l[t].width>=r&&l[t].height>=s)return l[t].pattern;return null}static Set(t,e,i,o,n,r,s,a){const l=Ns.GenKey(t,e,i,o,n);Ns.cache[l]?Ns.cache[l].push({width:s,height:a,pattern:r}):Ns.cache[l]=[{width:s,height:a,pattern:r}]}static GenKey(t,e,i,o,n){return`${e},${i},${o},${n},${t.join()}`}}Ns.cache={},Ns.ImageSize=[20,40,80,160,320,640,1280,2560];const Gs=Symbol.for("ArcRenderContribution"),js=Symbol.for("AreaRenderContribution"),Vs=Symbol.for("CircleRenderContribution"),Us=Symbol.for("GroupRenderContribution"),$s=Symbol.for("ImageRenderContribution"),Xs=Symbol.for("PathRenderContribution"),Ys=Symbol.for("PolygonRenderContribution"),Ks=Symbol.for("RectRenderContribution"),qs=Symbol.for("SymbolRenderContribution"),Zs=Symbol.for("TextRenderContribution"),Js=Symbol.for("InteractiveSubRenderContribution");function Qs(t,e){return"end"===t||"right"===t?-e:"center"===t?-e/2:0}function ta(t,e,i){return"middle"===t?-e/2:"top"===t?0:"bottom"===t?(arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)-e:t&&"alphabetic"!==t?0:(i||(i=e),-(e-i)/2-.79*i)}function ea(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ia(t,e,i){const o=i[0],n=i[1],r=i[2];let s,a,l,h,d,c,u,g,p,f,v,b;return e===t?(t[12]=e[0]*o+e[4]*n+e[8]*r+e[12],t[13]=e[1]*o+e[5]*n+e[9]*r+e[13],t[14]=e[2]*o+e[6]*n+e[10]*r+e[14],t[15]=e[3]*o+e[7]*n+e[11]*r+e[15]):(s=e[0],a=e[1],l=e[2],h=e[3],d=e[4],c=e[5],u=e[6],g=e[7],p=e[8],f=e[9],v=e[10],b=e[11],t[0]=s,t[1]=a,t[2]=l,t[3]=h,t[4]=d,t[5]=c,t[6]=u,t[7]=g,t[8]=p,t[9]=f,t[10]=v,t[11]=b,t[12]=s*o+d*n+p*r+e[12],t[13]=a*o+c*n+f*r+e[13],t[14]=l*o+u*n+v*r+e[14],t[15]=h*o+g*n+b*r+e[15]),t}function oa(t,e){t[0]=e.a,t[1]=e.b,t[2]=0,t[3]=0,t[4]=e.c,t[5]=e.d,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e.e,t[13]=e.f,t[14]=0,t[15]=1}function na(t,e,i){const o=e[0],n=e[1],r=e[2],s=e[3],a=e[4],l=e[5],h=e[6],d=e[7],c=e[8],u=e[9],g=e[10],p=e[11],f=e[12],v=e[13],b=e[14],m=e[15];let y=i[0],C=i[1],w=i[2],x=i[3];return t[0]=y*o+C*a+w*c+x*f,t[1]=y*n+C*l+w*u+x*v,t[2]=y*r+C*h+w*g+x*b,t[3]=y*s+C*d+w*p+x*m,y=i[4],C=i[5],w=i[6],x=i[7],t[4]=y*o+C*a+w*c+x*f,t[5]=y*n+C*l+w*u+x*v,t[6]=y*r+C*h+w*g+x*b,t[7]=y*s+C*d+w*p+x*m,y=i[8],C=i[9],w=i[10],x=i[11],t[8]=y*o+C*a+w*c+x*f,t[9]=y*n+C*l+w*u+x*v,t[10]=y*r+C*h+w*g+x*b,t[11]=y*s+C*d+w*p+x*m,y=i[12],C=i[13],w=i[14],x=i[15],t[12]=y*o+C*a+w*c+x*f,t[13]=y*n+C*l+w*u+x*v,t[14]=y*r+C*h+w*g+x*b,t[15]=y*s+C*d+w*p+x*m,t}function ra(t,e,i){const o=e[0],n=e[1],r=e[2];let s=i[3]*o+i[7]*n+i[11]*r+i[15];return s=s||1,t[0]=(i[0]*o+i[4]*n+i[8]*r+i[12])/s,t[1]=(i[1]*o+i[5]*n+i[9]*r+i[13])/s,t[2]=(i[2]*o+i[6]*n+i[10]*r+i[14])/s,t}class sa{constructor(){this.pools=[]}static identity(t){return ea(t)}allocate(){if(!this.pools.length)return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];const t=this.pools.pop();return sa.identity(t),t}allocateByObj(t){let e;e=this.pools.length?this.pools.pop():[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];for(let i=0;i<e.length;i++)e[i]=t[i];return e}free(t){t&&this.pools.push(t)}get length(){return this.pools.length}release(){this.pools=[]}}const aa=new class{constructor(){this.pools=[]}allocate(t,e,i,o,n,r){if(!this.pools.length)return new Ie(t,e,i,o,n,r);const s=this.pools.pop();return s.a=t,s.b=e,s.c=i,s.d=o,s.e=n,s.f=r,s}allocateByObj(t){if(!this.pools.length)return new Ie(t.a,t.b,t.c,t.d,t.e,t.f);const e=this.pools.pop();return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.e=t.e,e.f=t.f,e}free(t){this.pools.push(t)}get length(){return this.pools.length}release(){this.pools=[]}},la=new sa;var ha=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},da=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ca=function(t,e){return function(i,o){e(i,o,t)}};function ua(t,e,i){var o;const{x:n=i.x,y:r=i.y,z:s=i.z,dx:a=i.dx,dy:l=i.dy,dz:h=i.dz,scaleX:d=i.scaleX,scaleY:c=i.scaleY,scaleZ:u=i.scaleZ,alpha:g=i.alpha,beta:p=i.beta,angle:f=i.angle,anchor3d:v=e.attribute.anchor,anchor:b}=e.attribute,m=[0,0,0];if(v){if("string"==typeof v[0]){const t=parseFloat(v[0])/100,i=e.AABBBounds;m[0]=i.x1+(i.x2-i.x1)*t}else m[0]=v[0];if("string"==typeof v[1]){const t=parseFloat(v[1])/100,i=e.AABBBounds;m[1]=i.x1+(i.x2-i.x1)*t}else m[1]=v[1];m[2]=null!==(o=v[2])&&void 0!==o?o:0}if(ea(t),ia(t,t,[n+a,r+l,s+h]),ia(t,t,[m[0],m[1],m[2]]),function(t,e,i){const o=Math.sin(i),n=Math.cos(i),r=e[4],s=e[5],a=e[6],l=e[7],h=e[8],d=e[9],c=e[10],u=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=r*n+h*o,t[5]=s*n+d*o,t[6]=a*n+c*o,t[7]=l*n+u*o,t[8]=h*n-r*o,t[9]=d*n-s*o,t[10]=c*n-a*o,t[11]=u*n-l*o}(t,t,p),function(t,e,i){const o=Math.sin(i),n=Math.cos(i),r=e[0],s=e[1],a=e[2],l=e[3],h=e[8],d=e[9],c=e[10],u=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=r*n-h*o,t[1]=s*n-d*o,t[2]=a*n-c*o,t[3]=l*n-u*o,t[8]=r*o+h*n,t[9]=s*o+d*n,t[10]=a*o+c*n,t[11]=l*o+u*n}(t,t,g),ia(t,t,[-m[0],-m[1],m[2]]),function(t,e,i){const o=i[0],n=i[1],r=i[2];t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t[3]=e[3]*o,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}(t,t,[d,c,u]),f){const i=la.allocate(),o=[0,0];if(b){if("string"==typeof v[0]){const t=parseFloat(v[0])/100,i=e.AABBBounds;o[0]=i.x1+(i.x2-i.x1)*t}else o[0]=v[0];if("string"==typeof v[1]){const t=parseFloat(v[1])/100,i=e.AABBBounds;o[1]=i.x1+(i.x2-i.x1)*t}else o[1]=v[1]}ia(i,i,[o[0],o[1],0]),function(t,e,i){const o=Math.sin(i),n=Math.cos(i),r=e[0],s=e[1],a=e[2],l=e[3],h=e[4],d=e[5],c=e[6],u=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=r*n+h*o,t[1]=s*n+d*o,t[2]=a*n+c*o,t[3]=l*n+u*o,t[4]=h*n-r*o,t[5]=d*n-s*o,t[6]=c*n-a*o,t[7]=u*n-l*o}(i,i,f),ia(i,i,[-o[0],-o[1],0]),na(t,t,i)}}let ga=class{constructor(t){this.creator=t,this.hooks={onAttributeUpdate:new W(["graphic"]),onSetStage:new W(["graphic","stage"]),onRemove:new W(["graphic"]),onRelease:new W(["graphic"]),onAddIncremental:new W(["graphic","group","stage"]),onClearIncremental:new W(["graphic","group","stage"]),beforeUpdateAABBBounds:new W(["graphic","stage","willUpdate","aabbBounds"]),afterUpdateAABBBounds:new W(["graphic","stage","aabbBounds","globalAABBBounds","selfChange"]),clearAABBBounds:new W(["graphic","stage","aabbBounds"])},this.tempAABBBounds1=new Fe,this.tempAABBBounds2=new Fe}onAttributeUpdate(t){this.hooks.onAttributeUpdate.taps.length&&this.hooks.onAttributeUpdate.call(t)}onSetStage(t,e){this.hooks.onSetStage.taps.length&&this.hooks.onSetStage.call(t,e)}onRemove(t){this.hooks.onRemove.taps.length&&this.hooks.onRemove.call(t)}onRelease(t){this.hooks.onRelease.taps.length&&this.hooks.onRelease.call(t)}onAddIncremental(t,e,i){this.hooks.onAddIncremental.taps.length&&this.hooks.onAddIncremental.call(t,e,i)}onClearIncremental(t,e){this.hooks.onClearIncremental.taps.length&&this.hooks.onClearIncremental.call(t,e)}beforeUpdateAABBBounds(t,e,i,o){this.hooks.beforeUpdateAABBBounds.taps.length&&this.hooks.beforeUpdateAABBBounds.call(t,e,i,o)}afterUpdateAABBBounds(t,e,i,o,n){this.hooks.afterUpdateAABBBounds.taps.length&&this.hooks.afterUpdateAABBBounds.call(t,e,i,o,n)}clearAABBBounds(t,e,i){this.hooks.clearAABBBounds.taps.length&&this.hooks.clearAABBBounds.call(t,e,i)}updatePathProxyAABBBounds(t,e){const i="function"==typeof e.pathProxy?e.pathProxy(e.attribute):e.pathProxy;if(!i)return!1;const o=new ti(t);return Li(i.commandList,o,0,0),!0}updateHTMLTextAABBBounds(t,e,i,o){const{textAlign:n,textBaseline:r}=t;if(null!=t.forceBoundsHeight){const e=ut(t.forceBoundsHeight)?t.forceBoundsHeight:t.forceBoundsHeight(),o=ta(r,e,e);i.set(i.x1,o,i.x2,o+e)}if(null!=t.forceBoundsWidth){const e=ut(t.forceBoundsWidth)?t.forceBoundsWidth:t.forceBoundsWidth(),o=Qs(n,e);i.set(o,i.y1,o+e,i.y2)}}combindShadowAABBBounds(t,e){if(e&&e.shadowRoot){const i=e.shadowRoot.AABBBounds;t.union(i)}}transformAABBBounds(t,e,i,o,n){if(!e.empty()){const{scaleX:n=i.scaleX,scaleY:r=i.scaleY,stroke:s=i.stroke,shadowBlur:a=i.shadowBlur,lineWidth:l=i.lineWidth,pickStrokeBuffer:h=i.pickStrokeBuffer,strokeBoundsBuffer:d=i.strokeBoundsBuffer}=t,c=this.tempAABBBounds1,u=this.tempAABBBounds2;if(s&&l){Ur(c,(l+h)/Math.abs(n+r),o,d),e.union(c),c.setValue(u.x1,u.y1,u.x2,u.y2)}if(a){const{shadowOffsetX:o=i.shadowOffsetX,shadowOffsetY:s=i.shadowOffsetY}=t;Ur(c,a/Math.abs(n+r)*2,!1,d+1),c.translate(o,s),e.union(c)}}if(this.combindShadowAABBBounds(e,n),e.empty())return;let r=!0;const s=n.transMatrix;n&&n.isContainer&&(r=!(1===s.a&&0===s.b&&0===s.c&&1===s.d&&0===s.e&&0===s.f)),r&&Ee(e,e,s)}validCheck(t,e,i,o){if(!o)return!0;if(null!=t.forceBoundsHeight||null!=t.forceBoundsWidth)return!0;if(o.shadowRoot||o.isContainer)return!0;const{visible:n=e.visible}=t;return!(!o.valid||!n)||(i.empty()||(o.parent&&i.transformWithMatrix(o.parent.globalTransMatrix),zo.graphicService.clearAABBBounds(o,o.stage,i),i.clear()),!1)}updateTempAABBBounds(t){const e=this.tempAABBBounds1,i=this.tempAABBBounds2;return e.setValue(t.x1,t.y1,t.x2,t.y2),i.setValue(t.x1,t.y1,t.x2,t.y2),{tb1:e,tb2:i}}};ga=ha([C(),ca(0,m(us)),da("design:paramtypes",[Object])],ga);const pa={x:0,y:0,z:0,lastModelMatrix:null};class fa{init(t){t&&(this._renderContribitions=t.getContributions()),this._renderContribitions||(this._renderContribitions=[]),this.builtinContributions&&this.builtinContributions.forEach((t=>this._renderContribitions.push(t))),this._renderContribitions.length&&(this._renderContribitions.sort(((t,e)=>e.order-t.order)),this._beforeRenderContribitions=this._renderContribitions.filter((t=>t.time===Ri.beforeFillStroke)),this._afterRenderContribitions=this._renderContribitions.filter((t=>t.time===Ri.afterFillStroke)))}beforeRenderStep(t,e,i,o,n,r,s,a,l,h,d,c,u){this._beforeRenderContribitions&&this._beforeRenderContribitions.forEach((g=>{g.supportedAppName&&t.stage&&t.stage.params&&t.stage.params.context&&t.stage.params.context.appName&&!(Array.isArray(g.supportedAppName)?g.supportedAppName:[g.supportedAppName]).includes(t.stage.params.context.appName)||g.drawShape(t,e,i,o,n,r,s,a,l,h,d,c,u)}))}afterRenderStep(t,e,i,o,n,r,s,a,l,h,d,c,u){this._afterRenderContribitions&&this._afterRenderContribitions.forEach((g=>{g.supportedAppName&&t.stage&&t.stage.params&&t.stage.params.context&&t.stage.params.context.appName&&!(Array.isArray(g.supportedAppName)?g.supportedAppName:[g.supportedAppName]).includes(t.stage.params.context.appName)||g.drawShape(t,e,i,o,n,r,s,a,l,h,d,c,u)}))}valid(t,e,i,o){const{fill:n=e.fill,background:r,stroke:s=e.stroke,opacity:a=e.opacity,fillOpacity:l=e.fillOpacity,lineWidth:h=e.lineWidth,strokeOpacity:d=e.strokeOpacity,visible:c=e.visible}=t.attribute,u=Ps(a,l,n),g=Hs(a,d),p=Ms(n,r),f=Ls(s,h);return!(!t.valid||!c)&&!(!p&&!f)&&!!(u||g||i||o||r)&&{fVisible:u,sVisible:g,doFill:p,doStroke:f}}transform(t,e,i){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const{x:n=e.x,y:r=e.y,z:s=e.z,scaleX:a=e.scaleX,scaleY:l=e.scaleY,angle:h=e.angle,postMatrix:d}=t.attribute,c=i.modelMatrix,u=i.camera;pa.x=n,pa.y=r,pa.z=s,pa.lastModelMatrix=c;const g=u&&(o||function(t){const{alpha:e,beta:i}=t.attribute;return e||i}(t)),p=g?t.transMatrix.onlyTranslate()&&!d:1===a&&1===l&&0===h&&!d;if(g){const o=la.allocate(),n=la.allocate();ua(n,t,e),na(o,c||o,n),pa.x=0,pa.y=0,pa.z=0,i.modelMatrix=o,i.setTransform(1,0,0,1,0,0,!0),la.free(n)}if(p&&!c){const o=t.getOffsetXY(e);pa.x+=o.x,pa.y+=o.y,pa.z=s,i.setTransformForCurrent()}else if(g)pa.x=0,pa.y=0,pa.z=0,i.setTransform(1,0,0,1,0,0,!0);else if(u&&i.project){const o=t.getOffsetXY(e);pa.x+=o.x,pa.y+=o.y,this.transformWithoutTranslate(i,pa.x,pa.y,pa.z,a,l,h)}else i.transformFromMatrix(t.transMatrix,!0),pa.x=0,pa.y=0,pa.z=0;return pa}transformUseContext2d(t,e,i,o){const n=o.camera;if(this.camera=n,n){const e=t.AABBBounds,n=e.x2-e.x1,r=e.y2-e.y1,s=o.project(0,0,i),a=o.project(n,0,i),l=o.project(n,r,i),h={x:0,y:0},d={x:n,y:0},c={x:n,y:r};o.camera=null;const u=1/(h.x*(c.y-d.y)-d.x*c.y+c.x*d.y+(d.x-c.x)*h.y),g=-(h.y*(l.x-a.x)-d.y*l.x+c.y*a.x+(d.y-c.y)*s.x)*u,p=(d.y*l.y+h.y*(a.y-l.y)-c.y*a.y+(c.y-d.y)*s.y)*u,f=(h.x*(l.x-a.x)-d.x*l.x+c.x*a.x+(d.x-c.x)*s.x)*u,v=-(d.x*l.y+h.x*(a.y-l.y)-c.x*a.y+(c.x-d.x)*s.y)*u,b=(h.x*(c.y*a.x-d.y*l.x)+h.y*(d.x*l.x-c.x*a.x)+(c.x*d.y-d.x*c.y)*s.x)*u,m=(h.x*(c.y*a.y-d.y*l.y)+h.y*(d.x*l.y-c.x*a.y)+(c.x*d.y-d.x*c.y)*s.y)*u;o.setTransform(g,p,f,v,b,m,!0)}}restoreTransformUseContext2d(t,e,i,o){this.camera&&(o.camera=this.camera)}transformWithoutTranslate(t,e,i,o,n,r,s){const a=t.project(e,i,o);t.translate(a.x,a.y,!1),t.scale(n,r,!1),t.rotate(s,!1),t.translate(-a.x,-a.y,!1),t.setTransformForCurrent()}_draw(t,e,i,o,n){const{context:r}=o;if(!r)return;const{renderable:s}=t.attribute;if(!1===s)return;r.highPerformanceSave();const a=this.transform(t,e,r,i),{x:l,y:h,z:d,lastModelMatrix:c}=a;this.z=d,function(t,e,i,o,n,r,s,a){if(!t.pathProxy)return!1;const l=kn(t,null==r?void 0:r.theme)[t.type.replace("3d","")],{fill:h=l.fill,stroke:d=l.stroke,opacity:c=l.opacity,fillOpacity:u=l.fillOpacity,lineWidth:g=l.lineWidth,strokeOpacity:p=l.strokeOpacity,visible:f=l.visible,x:v=l.x,y:b=l.y}=t.attribute,m=Ps(c,u,h),y=Hs(c,p),C=Ms(h),w=Ls(d,g);return!f||(!C&&!w||(!(m||y||s||a)||(e.beginPath(),Li(("function"==typeof t.pathProxy?t.pathProxy(t.attribute):t.pathProxy).commandList,e,i,o),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),w&&(a?a(e,t.attribute,l):y&&(e.setStrokeStyle(t,t.attribute,i-v,o-b,l),e.stroke())),C&&(s?s(e,t.attribute,l):m&&(e.setCommonStyle(t,t.attribute,i-v,o-b,l),e.fill())),!0)))}(t,r,l,h,0,n)||(this.drawShape(t,r,l,h,o,n),this.z=0,r.modelMatrix!==c&&la.free(r.modelMatrix),r.modelMatrix=c),r.highPerformanceRestore()}}var va=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},ba=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ma=function(t,e){return function(i,o){e(i,o,t)}};class ya{constructor(){this.time=Ri.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,o,n,r,s,a,l,h,d,c,u){var g;const{background:p,backgroundOpacity:f=(null!==(g=t.attribute.fillOpacity)&&void 0!==g?g:l.backgroundOpacity),opacity:v=l.opacity,backgroundMode:b=l.backgroundMode,backgroundFit:m=l.backgroundFit}=t.attribute;if(p)if(t.backgroundImg&&t.resources){const n=t.resources.get(p);if("success"!==n.state||!n.data)return;if(e.save(),t.parent&&!t.transMatrix.onlyTranslate()){const i=kn(t.parent).group,{scrollX:o=i.scrollX,scrollY:n=i.scrollY}=t.parent.attribute;e.setTransformFromMatrix(t.parent.globalTransMatrix,!0),e.translate(o,n)}e.clip();const r=t.AABBBounds;e.setCommonStyle(t,t.attribute,i,o,l),e.globalAlpha=f*v,this.doDrawImage(e,n.data,r,b,m),e.restore(),t.transMatrix.onlyTranslate()||e.setTransformForCurrent()}else e.highPerformanceSave(),e.setCommonStyle(t,t.attribute,i,o,l),e.globalAlpha=f*v,e.fillStyle=p,e.fill(),e.highPerformanceRestore()}doDrawImage(t,e,i,o,n){if("no-repeat"===o)t.drawImage(e,i.x1,i.y1,i.width(),i.height());else{const r=i.width(),s=i.height();let a=r,l=s;if(n&&"repeat"!==o&&(e.width||e.height)){const i=e.width,n=e.height;"repeat-x"===o?(a=i*(s/n),l=s):"repeat-y"===o&&(l=n*(r/i),a=r);const h=t.dpr,d=dn.allocate({width:a,height:l,dpr:h}),c=d.getContext("2d");c&&(c.inuse=!0,c.clearMatrix(),c.setTransformForCurrent(!0),c.clearRect(0,0,a,l),c.drawImage(e,0,0,a,l),e=d.nativeCanvas),dn.free(d)}const h=t.dpr,d=t.createPattern(e,o);d.setTransform&&d.setTransform(new DOMMatrix([1/h,0,0,1/h,0,0])),t.fillStyle=d,t.translate(i.x1,i.y1),t.fillRect(0,0,r,s),t.translate(-i.x1,-i.y1)}}}const Ca=new ya;let wa=class{constructor(t){this.subRenderContribitions=t,this.time=Ri.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,o,n,r,s,a,l,h,d,c,u){this._subRenderContribitions||(this._subRenderContribitions=this.subRenderContribitions.getContributions()),this._subRenderContribitions.forEach((g=>{g.render(t,e,i,o,n,r,s,a,l,h,d,c,u)}))}};wa=va([C(),ma(0,m(O)),ma(0,w(Js)),ba("design:paramtypes",[Object])],wa);class xa{constructor(){this.time=Ri.afterFillStroke,this.useStyle=!0,this.order=10}createCommonPattern(t,e,i,o,n){const r=(t-2*e)/2,s=o.dpr,a=dn.allocate({width:t,height:t,dpr:s}),l=a.getContext("2d");if(!l)return null;l.inuse=!0,l.clearMatrix(),l.setTransformForCurrent(!0),l.clearRect(0,0,t,t),n(r,l);const h=o.createPattern(a.nativeCanvas,"repeat");return h.setTransform&&h.setTransform(new DOMMatrix([1/s,0,0,1/s,0,0])),dn.free(a),h}createCirclePattern(t,e,i,o){return this.createCommonPattern(t,e,i,o,((t,e)=>{e.fillStyle=i,e.arc(t,t,t,0,ne),e.fill()}))}createDiamondPattern(t,e,i,o){return this.createCommonPattern(t,e,i,o,((e,o)=>{const n=t/2,r=n;o.fillStyle=i,o.moveTo(n,r-e),o.lineTo(e+n,r),o.lineTo(n,r+e),o.lineTo(n-e,r),o.closePath(),o.fill()}))}createRectPattern(t,e,i,o){return this.createCommonPattern(t,e,i,o,((t,o)=>{const n=e,r=n;o.fillStyle=i,o.fillRect(n,r,2*t,2*t)}))}createVerticalLinePattern(t,e,i,o){return this.createCommonPattern(t,e,i,o,((o,n)=>{const r=e;n.fillStyle=i,n.fillRect(r,0,2*o,t)}))}createHorizontalLinePattern(t,e,i,o){return this.createCommonPattern(t,e,i,o,((o,n)=>{const r=e;n.fillStyle=i,n.fillRect(0,r,t,2*o)}))}createBiasLRLinePattern(t,e,i,o){return this.createCommonPattern(t,e,i,o,((e,o)=>{o.strokeStyle=i,o.lineWidth=e,o.moveTo(0,0),o.lineTo(t,t);const n=t/2,r=-n;o.moveTo(n,r),o.lineTo(n+t,r+t),o.moveTo(-n,-r),o.lineTo(-n+t,-r+t),o.stroke()}))}createBiasRLLinePattern(t,e,i,o){return this.createCommonPattern(t,e,i,o,((e,o)=>{o.strokeStyle=i,o.lineWidth=e,o.moveTo(t,0),o.lineTo(0,t);const n=t/2,r=n;o.moveTo(t+n,r),o.lineTo(n,r+t),o.moveTo(t-n,-r),o.lineTo(-n,-r+t),o.stroke()}))}createGridPattern(t,e,i,o){return this.createCommonPattern(t,e,i,o,((t,o)=>{const n=e,r=n;o.fillStyle=i,o.fillRect(n,r,t,t),o.fillRect(n+t,r+t,t,t)}))}initTextureMap(t,e){this.textureMap=new Map}drawShape(t,e,i,o,n,r,s,a,l,h,d,c,u){this.textureMap||this.initTextureMap(e,t.stage);const{texture:g=l.texture,textureColor:p=l.textureColor,textureSize:f=l.textureSize,texturePadding:v=l.texturePadding}=t.attribute;g&&this.drawTexture(g,t,e,i,o,l,p,f,v)}drawTexture(t,e,i,o,n,r,s,a,l){let h=this.textureMap.get(t);if(!h)switch(t){case"circle":h=this.createCirclePattern(a,l,s,i);break;case"diamond":h=this.createDiamondPattern(a,l,s,i);break;case"rect":h=this.createRectPattern(a,l,s,i);break;case"vertical-line":h=this.createVerticalLinePattern(a,l,s,i);break;case"horizontal-line":h=this.createHorizontalLinePattern(a,l,s,i);break;case"bias-lr":h=this.createBiasLRLinePattern(a,l,s,i);break;case"bias-rl":h=this.createBiasRLLinePattern(a,l,s,i);break;case"grid":h=this.createGridPattern(a,l,s,i)}h&&(i.highPerformanceSave(),i.setCommonStyle(e,e.attribute,o,n,r),i.fillStyle=h,i.fill(),i.highPerformanceRestore())}}const _a=new xa;const Sa=new class{constructor(){this.time=Ri.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,o,n,r,s,a,l,h,d,c){const{outerBorder:u,innerBorder:g}=t.attribute,p=u&&!1!==u.visible,f=g&&!1!==g.visible;if(!p&&!f)return;const{innerPadding:v=l.innerPadding,outerPadding:b=l.outerPadding,startAngle:m=l.startAngle,endAngle:y=l.endAngle,opacity:C=l.opacity,x:w=l.x,y:x=l.y,scaleX:_=l.scaleX,scaleY:S=l.scaleY,keepStrokeScale:A=l.keepStrokeScale}=t.attribute;let{innerRadius:B=l.innerRadius,outerRadius:R=l.outerRadius}=t.attribute;R+=b,B-=v;const T=(n,r)=>{const s=!(!n||!n.stroke),{distance:a=l[r].distance}=n,h=A?a:No(e,a,e.dpr),d=a/R,u="outerBorder"===r?1:-1;if(t.setAttributes({outerRadius:R+u*h,innerRadius:B-u*h,startAngle:m-u*d,endAngle:y+u*d}),e.beginPath(),zs(t,e,i,o,R+u*h,B-u*h),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),c)c(e,n,l[r]);else if(s){const s=l[r].opacity;l[r].opacity=C,e.setStrokeStyle(t,n,(w-i)/_,(x-o)/S,l[r]),l[r].opacity=s,e.stroke()}};p&&T(u,"outerBorder"),f&&T(g,"innerBorder"),t.setAttributes({outerRadius:R,innerRadius:B,startAngle:m,endAngle:y})}},Aa=_a,Ba=Ca;const Ra=new class{constructor(){this.time=Ri.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,o,n,r,s,a,l,h,d,c){const{outerBorder:u,innerBorder:g}=t.attribute,p=u&&!1!==u.visible,f=g&&!1!==g.visible;if(!p&&!f)return;const{radius:v=l.radius,startAngle:b=l.startAngle,endAngle:m=l.endAngle,opacity:y=l.opacity,x:C=l.x,y:w=l.y,scaleX:x=l.scaleX,scaleY:_=l.scaleY,keepStrokeScale:S=l.keepStrokeScale}=t.attribute,A=(n,r)=>{const s=!(!n||!n.stroke),{distance:a=l[r].distance}=n,h=S?a:No(e,a,e.dpr),d="outerBorder"===r?1:-1;if(e.beginPath(),e.arc(i,o,v+d*h,b,m),e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),c)c(e,n,l[r]);else if(s){const s=l[r].opacity;l[r].opacity=y,e.setStrokeStyle(t,n,(C-i)/x,(w-o)/_,l[r]),l[r].opacity=s,e.stroke()}};p&&A(u,"outerBorder"),f&&A(g,"innerBorder")}},Ta=_a,ka=Ca;const Ma=new class extends ya{constructor(){super(...arguments),this.time=Ri.beforeFillStroke}drawShape(t,e,i,o,n,r,s,a,l,h,d,c){const{background:u,backgroundMode:g=l.backgroundMode,backgroundFit:p=l.backgroundFit}=t.attribute;if(u)if(t.backgroundImg&&t.resources){const i=t.resources.get(u);if("success"!==i.state||!i.data)return;e.highPerformanceSave(),e.setTransformFromMatrix(t.parent.globalTransMatrix,!0);const o=t.AABBBounds;this.doDrawImage(e,i.data,o,g,p),e.highPerformanceRestore(),e.setTransformForCurrent()}else e.highPerformanceSave(),e.fillStyle=u,e.fill(),e.highPerformanceRestore()}},La=ee/2;function Pa(t,e,i,o,n,r,s){let a;if(o<0&&(e+=o,o=-o),n<0&&(i+=n,n=-n),ut(r,!0))a=[r=re(r),r,r,r];else if(Array.isArray(r)){const t=r;let e,i;switch(t.length){case 0:a=[0,0,0,0];break;case 1:e=re(t[0]),a=[e,e,e,e];break;case 2:case 3:e=re(t[0]),i=re(t[1]),a=[e,i,e,i];break;default:a=t,a[0]=re(a[0]),a[1]=re(a[1]),a[2]=re(a[2]),a[3]=re(a[3])}}else a=[0,0,0,0];if(o<0||a[0]+a[1]+a[2]+a[3]<1e-12)return t.rect(e,i,o,n);const[l,h,d,c]=[[e,i],[e+o,i],[e+o,i+n],[e,i+n]],u=Math.min(o/2,n/2),g=[Math.min(u,a[0]),Math.min(u,a[1]),Math.min(u,a[2]),Math.min(u,a[3])],p=[l[0]+g[0],l[1]],f=[l[0],l[1]+g[0]],v=[h[0]-g[1],h[1]],b=[h[0],h[1]+g[1]],m=[d[0]-g[2],d[1]],y=[d[0],d[1]-g[2]],C=[c[0]+g[3],c[1]],w=[c[0],c[1]-g[3]];if(t.moveTo(p[0],p[1]),s&&s[0]?s[0](p[0],p[1],v[0],v[1]):t.lineTo(v[0],v[1]),!It(v,b)){s&&s[0]&&t.moveTo(v[0],v[1]);const e=v[0],i=v[1]+g[1];t.arc(e,i,g[1],-La,0,!1)}if(s&&s[1]?s[1](b[0],b[1],y[0],y[1]):t.lineTo(y[0],y[1]),!It(m,y)){const e=y[0]-g[2],i=y[1];s&&s[1]&&t.moveTo(y[0],y[1]),t.arc(e,i,g[2],0,La,!1)}if(s&&s[2]?s[2](m[0],m[1],C[0],C[1]):t.lineTo(C[0],C[1]),!It(C,w)){const e=C[0],i=C[1]-g[3];s&&s[2]&&t.moveTo(C[0],C[1]),t.arc(e,i,g[3],La,ee,!1)}if(s&&s[3]?s[3](w[0],w[1],f[0],f[1]):t.lineTo(f[0],f[1]),!It(p,f)){const e=p[0],i=p[1]+g[0];s&&s[3]&&t.moveTo(f[0],f[1]),t.arc(e,i,g[0],ee,ee+La,!1)}return!s&&t.closePath(),t}var Ea=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};class Ha{constructor(){this.time=Ri.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,o,n,r,s,a,l,h,d,c){const{outerBorder:u,innerBorder:g}=t.attribute,p=u&&!1!==u.visible,f=g&&!1!==g.visible;if(!p&&!f)return;const{cornerRadius:v=l.cornerRadius,opacity:b=l.opacity,x:m=l.x,y:y=l.y,scaleX:C=l.scaleX,scaleY:w=l.scaleY,x1:x,y1:_,keepStrokeScale:S=l.keepStrokeScale}=t.attribute;let{width:A,height:B}=t.attribute;A=(null!=A?A:x-i)||0,B=(null!=B?B:_-o)||0;const R=(n,r)=>{const s=!(!n||!n.stroke),a="outerBorder"===r?-1:1,{distance:h=l[r].distance}=n,d=S?h:No(e,h,e.dpr),u=i+a*d,g=o+a*d,p=2*d;if(0===v||ht(v)&&v.every((t=>0===t))?(e.beginPath(),e.rect(u,g,A-a*p,B-a*p)):(e.beginPath(),Pa(e,u,g,A-a*p,B-a*p,v)),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),c)c(e,n,l[r]);else if(s){const s=l[r].opacity;l[r].opacity=b,e.setStrokeStyle(t,n,(m-i)/C,(y-o)/w,l[r]),l[r].opacity=s,e.stroke()}};p&&R(u,"outerBorder"),f&&R(g,"innerBorder")}}let Fa=class{constructor(){this.time=Ri.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,o,n,r,s,a,l,h,d,c,u){const{stroke:g=l.stroke}=t.attribute;Array.isArray(g)&&g.some((t=>!1===t))&&(u.doStroke=!1)}};Fa=Ea([C()],Fa);let Oa=class{constructor(){this.time=Ri.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,o,n,r,s,a,l,h,d,c){const{x1:u,y1:g,x:p=l.x,y:f=l.y,stroke:v=l.stroke,cornerRadius:b=l.cornerRadius}=t.attribute;let{width:m,height:y}=t.attribute;if(m=(null!=m?m:u-p)||0,y=(null!=y?y:g-f)||0,Array.isArray(v)&&v.some((t=>!1===t))){if(e.setStrokeStyle(t,t.attribute,i,o,l),!(0===b||ht(b)&&b.every((t=>0===t)))){let n,r=0;return Pa(e,i,o,m,y,b,new Array(4).fill(0).map(((s,a)=>(s,h,d,c)=>{v[a]&&(r===a-1&&v[a]===n||(e.setStrokeStyle(t,Object.assign(Object.assign({},t.attribute),{stroke:v[a]}),i,o,l),e.beginPath(),e.moveTo(s,h),n=v[a]),r=a,e.lineTo(d,c),e.stroke(),3===a&&e.beginPath())}))),void e.stroke()}if(e.beginPath(),e.moveTo(i,o),v[0]?e.lineTo(i+m,o):e.moveTo(i+m,o),v[1]?e.lineTo(i+m,o+y):e.moveTo(i+m,o+y),v[2]?e.lineTo(i,o+y):e.moveTo(i,o+y),v[3]){const t=v[0]?o-e.lineWidth/2:o;e.lineTo(i,t)}else e.moveTo(i,o);e.stroke()}}};Oa=Ea([C()],Oa);const Ia=new Ha,za=_a,Da=Ca;const Wa=new class extends Ha{constructor(){super(...arguments),this.time=Ri.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,o,n,r,s,a,l,h,d,c){return super.drawShape(t,e,i,o,n,r,s,a,l,h,d,c)}},Na=Ca;const Ga=new class{constructor(){this.time=Ri.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,o,n,r,s,a,l,h,d,c){const u=t.getParsedPath();if(!u)return;const{outerBorder:g,innerBorder:p}=t.attribute,f=g&&!1!==g.visible,v=p&&!1!==p.visible;if(!f&&!v)return;const{size:b=l.size,opacity:m=l.opacity,x:y=l.x,y:C=l.y,scaleX:w=l.scaleX,scaleY:x=l.scaleY,keepStrokeScale:_=l.keepStrokeScale}=t.attribute,S=(n,r)=>{const s=!(!n||!n.stroke),{distance:a=l[r].distance}=n,h=_?a:No(e,a,e.dpr),d="outerBorder"===r?1:-1;if(e.beginPath(),!1===u.drawOffset(e,b,i,o,d*h)&&e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),c)c(e,n,l[r]);else if(s){const s=l[r].opacity;l[r].opacity=m,e.setStrokeStyle(t,n,(y-i)/w,(C-o)/x,l[r]),l[r].opacity=s,e.stroke()}};f&&S(g,"outerBorder"),v&&S(p,"innerBorder")}},ja=_a,Va=Ca;var Ua=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},$a=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Xa=function(t,e){return function(i,o){e(i,o,t)}};let Ya=class extends fa{constructor(t){super(),this.arcRenderContribitions=t,this.numberType=Jr,this.builtinContributions=[Sa,Ba,Aa],this.init(t)}drawArcTailCapPath(t,e,i,o,n,r,s,a){const l=a-s,h=t.getParsedAngle(),d=h.startAngle;let c=h.endAngle;c=a;const u=c>d;let g=!1;if(n<r){const t=n;n=r,r=t}const{outerDeltaAngle:p,xors:f,yors:v,xirs:b,yirs:m,limitedOcr:y,outerCornerRadiusStart:C,outerCornerRadiusEnd:w,maxOuterCornerRadius:x,xore:_,yore:S,xire:A,yire:B,limitedIcr:R,innerDeltaAngle:T,innerStartAngle:k,innerCornerRadiusStart:M,innerCornerRadiusEnd:L,maxInnerCornerRadius:P}=Is(t,d,c,r,n);if(y>te){const t=he(C,y),r=he(w,y),s=Os(b,m,f,v,n,t,Number(u)),a=Os(_,S,A,B,n,r,Number(u));if(y<x&&t===r)e.moveTo(i+s.cx+s.x01,o+s.cy+s.y01),e.arc(i+s.cx,o+s.cy,y,se(s.y01,s.x01),se(a.y01,a.x01),!u);else{const t=c-l-.03,s=se(a.y11,a.x11);e.arc(i,o,n,t,s,!u),r>0&&e.arc(i+a.cx,o+a.cy,r,se(a.y11,a.x11),se(a.y01,a.x01),!u)}}else e.moveTo(i+f,o+v);if(!(r>te)||T<.001)e.lineTo(i+A,o+B),g=!0;else if(R>te){const t=he(M,R),n=he(L,R),s=Os(A,B,_,S,r,-n,Number(u)),a=Os(f,v,b,m,r,-t,Number(u));if(e.lineTo(i+s.cx+s.x01,o+s.cy+s.y01),R<P&&t===n){const t=se(a.y01,a.x01);e.arc(i+s.cx,o+s.cy,R,se(s.y01,s.x01),t,!u)}else{n>0&&e.arc(i+s.cx,o+s.cy,n,se(s.y01,s.x01),se(s.y11,s.x11),!u);const t=se(s.cy+s.y11,s.cx+s.x11),a=c-l-.03;e.arc(i,o,r,t,a,u)}}else e.lineTo(i+r*ae(k),o+r*de(k));return g}drawShape(t,e,i,o,n,r,s,a){const l=kn(t,null==r?void 0:r.theme).arc,{fill:h=l.fill,stroke:d=l.stroke,x:c=l.x,y:u=l.y,fillStrokeOrder:g=l.fillStrokeOrder}=t.attribute,p=this.valid(t,l,s,a);if(!p)return;const{fVisible:f,sVisible:v,doFill:b,doStroke:m}=p,{outerPadding:y=l.outerPadding,innerPadding:C=l.innerPadding,cap:w=l.cap,forceShowCap:x=l.forceShowCap}=t.attribute;let{outerRadius:_=l.outerRadius,innerRadius:S=l.innerRadius}=t.attribute;_+=y,S-=C;let A=0;const B=(tt(w)&&w||w[0])&&"conical"===h.gradient;if(B){const{sc:e,startAngle:i,endAngle:o}=t.getParsedAngle();re(o-i)<ne-te&&(A=e||0,h.startAngle-=A,h.endAngle-=A)}let R=!1;const{isFullStroke:T,stroke:k}=(t=>{var e;let i=!0;if(tt(t,!0)){for(let o=0;o<4;o++)or[o]=t,i&&(i=!(null!==(e=or[o])&&void 0!==e&&!e));i=t}else if(Array.isArray(t))for(let e=0;e<4;e++)or[e]=!!t[e],i&&(i=!!or[e]);else or[0]=!1,or[1]=!1,or[2]=!1,or[3]=!1;return{isFullStroke:i,stroke:or}})(d);if(b||T){e.beginPath(),zs(t,e,i,o,_,S),R=!0,e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),this.beforeRenderStep(t,e,i,o,b,m,f,v,l,n,s,a);const r=()=>{b&&(s?s(e,t.attribute,l):f&&(e.setCommonStyle(t,t.attribute,c-i,u-o,l),e.fill()))},h=()=>{m&&T&&(a?a(e,t.attribute,l):v&&(e.setStrokeStyle(t,t.attribute,c-i,u-o,l),e.stroke()))};g?(h(),r()):(r(),h())}if(!T&&m&&(e.beginPath(),zs(t,e,i,o,_,S,k),R||this.beforeRenderStep(t,e,i,o,b,m,f,v,l,n,s,a),a?a(e,t.attribute,l):v&&(e.setStrokeStyle(t,t.attribute,i,o,l),e.stroke())),(tt(w)&&w||w[1])&&x){const{startAngle:r,endAngle:h}=t.getParsedAngle();if(re(h-r)>=ne-te){e.beginPath();const r=Math.abs(_-S)/2/_,{endAngle:h=l.endAngle,fill:d=l.fill}=t.attribute,c=h;this.drawArcTailCapPath(t,e,i,o,_,S,c,c+r),R||this.beforeRenderStep(t,e,i,o,b,m,f,v,l,n,s,a);const u=()=>{if(b){const n=d;if("conical"===n.gradient){const r=function(t,e,i,o){const{stops:n,startAngle:r,endAngle:s}=o;for(;i<0;)i+=ne;for(;i>ne;)i-=ne;if(i<r)return n[0].color;if(i>s)return n[0].color;let a,l,h=(i-r)/(s-r);for(let t=0;t<n.length;t++)if(n[t].offset>=h){a=n[t-1],l=n[t];break}return h=(h-a.offset)/(l.offset-a.offset),mr(a.color,l.color,h,!1)}(0,0,h,n);s||Ps&&(e.setCommonStyle(t,t.attribute,i,o,l),e.fillStyle=r,e.fill())}}},g=()=>{m&&(a||v&&(e.setStrokeStyle(t,t.attribute,i,o,l),e.stroke()))};u(),g()}}this.afterRenderStep(t,e,i,o,b,m,f,v,l,n,s,a),B&&(h.startAngle+=A,h.endAngle+=A)}draw(t,e,i,o){const n=kn(t,null==o?void 0:o.theme).arc;this._draw(t,n,!1,i,o)}};Ya=Ua([C(),Xa(0,m(O)),Xa(0,w(Gs)),$a("design:paramtypes",[Object])],Ya);var Ka=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},qa=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Za=function(t,e){return function(i,o){e(i,o,t)}};let Ja=class extends fa{constructor(t){super(),this.circleRenderContribitions=t,this.numberType=es,this.builtinContributions=[Ra,ka,Ta],this.init(t)}drawShape(t,e,i,o,n,r,s,a){const l=kn(t,null==r?void 0:r.theme).circle,{radius:h=l.radius,startAngle:d=l.startAngle,endAngle:c=l.endAngle,x:u=l.x,y:g=l.y,fillStrokeOrder:p=l.fillStrokeOrder}=t.attribute,f=this.valid(t,l,s,a);if(!f)return;const{fVisible:v,sVisible:b,doFill:m,doStroke:y}=f;e.beginPath(),e.arc(i,o,h,d,c),e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),this.beforeRenderStep(t,e,i,o,m,y,v,b,l,n,s,a);const C=()=>{m&&(s?s(e,t.attribute,l):v&&(e.setCommonStyle(t,t.attribute,u-i,g-o,l),e.fill()))},w=()=>{y&&(a?a(e,t.attribute,l):b&&(e.setStrokeStyle(t,t.attribute,u-i,g-o,l),e.stroke()))};p?(w(),C()):(C(),w()),this.afterRenderStep(t,e,i,o,m,y,v,b,l,n,s,a)}draw(t,e,i,o){const n=kn(t,null==o?void 0:o.theme).circle;this._draw(t,n,!1,i,o)}};function Qa(t,e,i,o){if(!e.p1)return;const{offsetX:n=0,offsetY:r=0,offsetZ:s=0}=o||{};if(1===i)e.p2&&e.p3?t.bezierCurveTo(n+e.p1.x,r+e.p1.y,n+e.p2.x,r+e.p2.y,n+e.p3.x,r+e.p3.y,s):t.lineTo(n+e.p1.x,r+e.p1.y,s);else if(e.p2&&e.p3){const[o]=Oi(e,i);t.bezierCurveTo(n+o.p1.x,r+o.p1.y,n+o.p2.x,r+o.p2.y,n+o.p3.x,r+o.p3.y,s)}else{const o=e.getPointAt(i);t.lineTo(n+o.x,r+o.y,s)}}function tl(t,e,i,o,n,r,s){var a;let l=e.p0,h=o;if(i&&i.originP1===i.originP2&&(l=i.p0),e.defined)o||(t.lineTo(l.x+n,l.y+r,s),h=!o);else{const{originP1:d,originP2:c}=e;let u;if(d&&!1!==d.defined&&!i?u=l:d&&!1!==c.defined&&(u=null!==(a=e.p3)&&void 0!==a?a:e.p1),o){h=!o;const i=u?u.x:e.p0.x,a=u?u.y:e.p0.y;t.moveTo(i+n,a+r,s)}else u&&(h=!o,t.lineTo(u.x+n,u.y+r,s))}return h}function el(t,e,i,o,n){const{offsetX:r=0,offsetY:s=0,offsetZ:a=0,mode:l="none",drawConnect:h=!1}=n||{};if(h&&"none"===l)return;if(!e)return;let d=!0;const{curves:c}=e;if(i>=1){if(h){let e,i=!0;c.forEach(((o,n)=>{o.originP1!==o.originP2?(i=tl(t,o,e,i,r,s,a),e=o):e=o}))}else c.forEach((e=>{e.defined?(d&&t.moveTo(e.p0.x+r,e.p0.y+s,a),Qa(t,e,1,n),d=!1):d=!0}));return}if(i<=0)return;let u;"x"===o?u=Ai.ROW:"y"===o?u=Ai.COLUMN:"auto"===o&&(u=e.direction);const g=i*e.tryUpdateLength(u);let p=0,f=!0,v=null;for(let e=0,i=c.length;e<i;e++){const i=c[e],o=i.getLength(u),l=(g-p)/o;if(p+=o,l<0)break;if(h){if(i.originP1===i.originP2){v=i;continue}f=tl(t,i,v,f,r,s,a),v=i}else{if(!i.defined){d=!0;continue}d&&t.moveTo(i.p0.x+r,i.p0.y+s,a),Qa(t,i,he(l,1),n),d=!1}}}Ja=Ka([C(),Za(0,m(O)),Za(0,w(Vs)),qa("design:paramtypes",[Object])],Ja);var il=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let ol=class extends fa{constructor(){super(...arguments),this.numberType=ns}draw(t,e,i,o){const n=kn(t,null==o?void 0:o.theme).line;this._draw(t,n,!1,i,o)}drawSegmentItem(t,e,i,o,n,r,s,a,l,h,d,c,u,g,p){var f,v,b,m,y;if(!e)return;t.beginPath();const C=null!==(f=this.z)&&void 0!==f?f:0;el(t.camera?t:t.nativeContext,e,l,h,{offsetX:d,offsetY:c,offsetZ:C}),u.cache&&!ht(u.cache)&&u.cache.curves.every((t=>t.defined))&&u.attribute.curveType&&u.attribute.curveType.includes("Closed")&&t.closePath(),t.setShadowBlendStyle&&t.setShadowBlendStyle(u,s,a);const{x:w=0,x:x=0}=s;!1!==i&&(g?g(t,s,a):n&&(t.setCommonStyle(u,s,w-d,x-c,a),t.fill())),!1!==o&&(p?p(t,s,a):r&&(t.setStrokeStyle(u,s,w-d,x-c,a),t.stroke()));let{connectedType:_,connectedX:S,connectedY:A,connectedStyle:B}=s;if(ht(a)?(_=null!==(v=null!=_?_:a[0].connectedType)&&void 0!==v?v:a[1].connectedType,S=null!==(b=null!=S?S:a[0].connectedX)&&void 0!==b?b:a[1].connectedX,A=null!==(m=null!=A?A:a[0].connectedY)&&void 0!==m?m:a[1].connectedY,B=null!==(y=null!=B?B:a[0].connectedStyle)&&void 0!==y?y:a[1].connectedStyle):(_=null!=_?_:a.connectedType,S=null!=S?S:a.connectedX,A=null!=A?A:a.connectedY,B=null!=B?B:a.connectedStyle),"connect"!==_&&"zero"!==_&&(_="none"),"none"!==_){t.beginPath(),el(t.camera?t:t.nativeContext,e,l,h,{offsetX:d,offsetY:c,offsetZ:C,drawConnect:!0,mode:_,zeroX:S,zeroY:A});const f=[];ht(a)?a.forEach((t=>f.push(t))):f.push(a),f.push(s),!1!==i&&(g?g(t,s,a):n&&(t.setCommonStyle(u,B,w-d,x-c,f),t.fill())),!1!==o&&(p?p(t,s,a):r&&(t.setStrokeStyle(u,B,w-d,x-c,f),t.stroke()))}return!1}drawLinearLineHighPerformance(t,e,i,o,n,r,s,a,l,h,d,c,u){var g;e.beginPath();const p=null!==(g=this.z)&&void 0!==g?g:0,{points:f}=t.attribute,v=f[0];e.moveTo(v.x+s,v.y+a,p);for(let t=1;t<f.length;t++){const i=f[t];e.lineTo(i.x+s,i.y+a,p)}e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l);const{x:b=0,x:m=0}=t.attribute;!1!==i&&(c?c(e,t.attribute,l):n&&(e.setCommonStyle(t,t.attribute,b-s,m-a,l),e.fill())),!1!==o&&(u?u(e,t.attribute,l):r&&(e.setStrokeStyle(t,t.attribute,b-s,m-a,l),e.stroke()))}drawShape(t,e,i,o,n,r,s,a){const l=kn(t,null==r?void 0:r.theme).line,{fill:h=l.fill,stroke:d=l.stroke,fillOpacity:c=l.fillOpacity,strokeOpacity:u=l.strokeOpacity,segments:g,points:p,closePath:f,curveTension:v=l.curveTension}=t.attribute;if(!this.valid(t,l,s,a))return;let{curveType:b=l.curveType}=t.attribute;f&&"linear"===b&&(b="linearClosed");const{clipRange:m=l.clipRange,clipRangeByDimension:y=l.clipRangeByDimension}=t.attribute;if(1===m&&!g&&!p.some((t=>!1===t.defined))&&"linear"===b)return this.drawLinearLineHighPerformance(t,e,!!h,!!d,c,u,i,o,l,n,r,s,a);if(t.shouldUpdateShape()){const{points:e,segments:i}=t.attribute,o=e;if(i&&i.length){let e,o;if(t.cache=i.map(((t,i)=>{if(t.points.length<=1&&0===i)return t.points[0]&&(o={endX:t.points[0].x,endY:t.points[0].y,curves:[{defined:!1!==t.points[0].defined}]}),null;1===i?e={x:o.endX,y:o.endY,defined:o.curves[o.curves.length-1].defined}:i>1&&(e.x=o.endX,e.y=o.endY,e.defined=o.curves[o.curves.length-1].defined);const n=uo(t.points,b,{startPoint:e,curveTension:v});return o=n,n})).filter((t=>!!t)),"linearClosed"===b){let e;for(let i=0;i<t.cache.length;i++){const o=t.cache[i];for(let t=0;t<o.curves.length;t++)if(o.curves[t].defined){e=o.curves[t].p0;break}if(e)break}t.cache[t.cache.length-1]&&t.cache[t.cache.length-1].lineTo(e.x,e.y,!0)}}else{if(!e||!e.length)return t.cache=null,void t.clearUpdateShapeTag();t.cache=uo(o,b,{curveTension:v})}t.clearUpdateShapeTag()}if(Array.isArray(t.cache)){const n=t.attribute.segments.filter((t=>t.points.length));if(1===n[0].points.length&&n.shift(),1===m){let r=!1;t.cache.forEach(((g,p)=>{r||(r=this.drawSegmentItem(e,g,!!h,!!d,c,u,n[p],[l,t.attribute],m,y,i,o,t,s,a))}))}else{const r=t.cache.reduce(((t,e)=>t+e.getLength()),0),g=m*r;let p=0,f=!1;t.cache.forEach(((r,v)=>{if(f)return;const b=r.getLength(),m=(g-p)/b;p+=b,m>0&&(f=this.drawSegmentItem(e,r,!!h,!!d,c,u,n[v],[l,t.attribute],he(m,1),y,i,o,t,s,a))}))}}else this.drawSegmentItem(e,t.cache,!!h,!!d,c,u,t.attribute,l,m,y,i,o,t,s,a)}};function nl(t,e,i,o){if(e.length<2)return;const{offsetX:n=0,offsetY:r=0,offsetZ:s=0,mode:a}=o||{};let l=e[0];t.moveTo(l.p0.x+n,l.p0.y+r,s),l=e[e.length-1];let h=l.p3||l.p1;t.lineTo(h.x+n,h.y+r,s),l=i[i.length-1],t.lineTo(l.p0.x+n,l.p0.y+r,s),l=i[0],h=l.p3||l.p1,t.lineTo(h.x+n,h.y+r,s),t.closePath()}function rl(t,e,i,o){const{offsetX:n=0,offsetY:r=0,offsetZ:s=0}=o||{};let a=!0;e.forEach((e=>{e.defined?(a&&t.moveTo(e.p0.x+n,e.p0.y+r,s),Qa(t,e,1,o),a=!1):a=!0})),a=!0;for(let e=i.length-1;e>=0;e--){const l=i[e];l.defined?(a&&t.lineTo(l.p0.x+n,l.p0.y+r,s),Qa(t,l,1,o),a=!1):a=!0}t.closePath()}ol=il([C()],ol);const sl=new class extends xa{constructor(){super(...arguments),this.time=Ri.afterFillStroke}drawShape(t,e,i,o,n,r,s,a,l,h,d,c,u){var g,p,f,v;this.textureMap||this.initTextureMap(e,t.stage);const{attribute:b=t.attribute}=u||{},{texture:m=(null!==(g=t.attribute.texture)&&void 0!==g?g:cr(l,"texture")),textureColor:y=(null!==(p=t.attribute.textureColor)&&void 0!==p?p:cr(l,"textureColor")),textureSize:C=(null!==(f=t.attribute.textureSize)&&void 0!==f?f:cr(l,"textureSize")),texturePadding:w=(null!==(v=t.attribute.texturePadding)&&void 0!==v?v:cr(l,"texturePadding"))}=b;m&&this.drawTexture(m,t,e,i,o,l,y,C,w)}},al=Ca;var ll=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},hl=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},dl=function(t,e){return function(i,o){e(i,o,t)}};let cl=class extends fa{constructor(t){super(),this.areaRenderContribitions=t,this.numberType=ts,this.builtinContributions=[sl,al],this.init(t)}drawLinearAreaHighPerformance(t,e,i,o,n,r,s,a,l,h,d,c,u){var g,p,f;const{points:v}=t.attribute;if(v.length<2)return;e.beginPath();const b=null!==(g=this.z)&&void 0!==g?g:0,m=v[0];e.moveTo(m.x+s,m.y+a,b);for(let t=1;t<v.length;t++){const i=v[t];e.lineTo(i.x+s,i.y+a,b)}for(let t=v.length-1;t>=0;t--){const i=v[t];e.lineTo((null!==(p=i.x1)&&void 0!==p?p:i.x)+s,(null!==(f=i.y1)&&void 0!==f?f:i.y)+a,b)}e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),this.beforeRenderStep(t,e,s,a,!!n,!1,i,!1,l,h,c,null,{attribute:t.attribute});const{x:y=0,x:C=0}=t.attribute;!1!==i&&(c?c(e,t.attribute,l):n&&(e.setCommonStyle(t,t.attribute,y-s,C-a,l),e.fill())),this.afterRenderStep(t,e,s,a,!!n,!1,i,!1,l,h,c,null,{attribute:t.attribute}),(()=>{var i,n;if(o){const{stroke:o=l&&l.stroke}=t.attribute;if(ht(o)&&(o[0]||o[2])&&!1===o[1])if(e.beginPath(),o[0]){e.moveTo(m.x+s,m.y+a,b);for(let t=1;t<v.length;t++){const i=v[t];e.lineTo(i.x+s,i.y+a,b)}}else if(o[2]){const t=v[v.length-1];e.moveTo(t.x+s,t.y+a,b);for(let t=v.length-2;t>=0;t--){const o=v[t];e.lineTo((null!==(i=o.x1)&&void 0!==i?i:o.x)+s,(null!==(n=o.y1)&&void 0!==n?n:o.y)+a,b)}}u?u(e,t.attribute,l):(e.setStrokeStyle(t,t.attribute,y-s,C-a,l),e.stroke())}})()}drawShape(t,e,i,o,n,r,s,a){var l,h,d,c,u,g;const p=kn(t,null==r?void 0:r.theme).area,{fill:f=p.fill,stroke:v=p.stroke,fillOpacity:b=p.fillOpacity,z:m=p.z,strokeOpacity:y=p.strokeOpacity,curveTension:C=p.curveTension}=t.attribute,w=this.valid(t,p,s,a);if(!w)return;const{doFill:x}=w,_=w.doStroke&&w.sVisible,{clipRange:S=p.clipRange,closePath:A,points:B,segments:R}=t.attribute;let{curveType:T=p.curveType}=t.attribute;if(A&&"linear"===T&&(T="linearClosed"),1===S&&!R&&!B.some((t=>!1===t.defined))&&"linear"===T)return this.drawLinearAreaHighPerformance(t,e,!!f,_,b,y,i,o,p,n,r,s,a);if(t.shouldUpdateShape()){if(R&&R.length){let e,i;const o=R.map(((t,o)=>{if(t.points.length<=1&&0===o)return t.points[0]&&(i={endX:t.points[0].x,endY:t.points[0].y}),null;1===o?e={x:i.endX,y:i.endY}:o>1&&(e.x=i.endX,e.y=i.endY);const n=uo(t.points,T,{startPoint:e,curveTension:C});return i=n,n})).filter((t=>!!t));let n;const r=[];for(let t=R.length-1;t>=0;t--){const e=R[t].points,i=[];for(let t=e.length-1;t>=0;t--)i.push({x:null!==(l=e[t].x1)&&void 0!==l?l:e[t].x,y:null!==(h=e[t].y1)&&void 0!==h?h:e[t].y});if(0!==t){const e=R[t-1].points,o=e[e.length-1];o&&i.push({x:null!==(d=o.x1)&&void 0!==d?d:o.x,y:null!==(c=o.y1)&&void 0!==c?c:o.y})}i.length>1&&(n=uo(i,"stepBefore"===T?"stepAfter":"stepAfter"===T?"stepBefore":T,{curveTension:C}),r.unshift(n))}t.cacheArea=r.map(((t,e)=>({top:o[e],bottom:t})))}else{if(!B||!B.length)return t.cacheArea=null,void t.clearUpdateShapeTag();{const e=B,i=[];for(let t=B.length-1;t>=0;t--)i.push({x:null!==(u=B[t].x1)&&void 0!==u?u:B[t].x,y:null!==(g=B[t].y1)&&void 0!==g?g:B[t].y});const o=uo(e,T,{curveTension:C}),n=uo(i,"stepBefore"===T?"stepAfter":"stepAfter"===T?"stepBefore":T,{curveTension:C});t.cacheArea={top:o,bottom:n}}}t.clearUpdateShapeTag()}if(Array.isArray(t.cacheArea)){const r=t.attribute.segments.filter((t=>t.points.length));if(1===r[0].points.length&&r.shift(),1===S){let l=!1;t.cacheArea.forEach(((h,d)=>{l||(l=this.drawSegmentItem(e,h,x,b,_,y,r[d],[p,t.attribute],S,i,o,m,t,n,s,a))}))}else{const l=t.cacheArea.reduce(((t,e)=>t+e.top.getLength()),0),h=S*l;let d=0,c=!1;t.cacheArea.forEach(((l,u)=>{if(c)return;const g=l.top.getLength(),f=(h-d)/g;d+=g,f>0&&(c=this.drawSegmentItem(e,l,x,b,_,y,r[u],[p,t.attribute],he(f,1),i,o,m,t,n,s,a))}))}}else this.drawSegmentItem(e,t.cacheArea,x,b,_,y,t.attribute,p,S,i,o,m,t,n,s,a)}draw(t,e,i,o){const n=kn(t,null==o?void 0:o.theme).area;this._draw(t,n,!1,i,o)}drawSegmentItem(t,e,i,o,n,r,s,a,l,h,d,c,u,g,p,f){let v=!1;return v=v||this._drawSegmentItem(t,e,i,o,n,r,s,a,l,h,d,c,u,g,!1,p,f),v=v||this._drawSegmentItem(t,e,i,o,n,r,s,a,l,h,d,c,u,g,!0,p,f),v}_drawSegmentItem(t,e,i,o,n,r,s,a,l,h,d,c,u,g,p,f,v){var b,m,y,C;if(!(e&&e.top&&e.bottom&&e.top.curves&&e.top.curves.length&&e.bottom.curves&&e.bottom.curves.length))return;let{connectedType:w,connectedX:x,connectedY:_,connectedStyle:S}=s;const A=[];if(p&&(ht(a)?(w=null!==(b=null!=w?w:a[0].connectedType)&&void 0!==b?b:a[1].connectedType,x=null!==(m=null!=x?x:a[0].connectedX)&&void 0!==m?m:a[1].connectedX,_=null!==(y=null!=_?_:a[0].connectedY)&&void 0!==y?y:a[1].connectedY,S=null!==(C=null!=S?S:a[0].connectedStyle)&&void 0!==C?C:a[1].connectedStyle):(w=null!=w?w:a.connectedType,x=null!=x?x:a.connectedX,_=null!=_?_:a.connectedY,S=null!=S?S:a.connectedStyle),"connect"!==w&&"zero"!==w&&(w="none"),ht(a)?a.forEach((t=>A.push(t))):A.push(a),A.push(s)),p&&"none"===w)return!1;t.beginPath();const{points:B,segments:R}=u.attribute;let T,k,M=Ai.ROW;if(R){const t=R[R.length-1];k=R[0].points[0],T=t.points[t.points.length-1]}else k=B[0],T=B[B.length-1];const L=re(T.x-k.x),P=re(T.y-k.y);M=null==T.x1?Ai.ROW:null==T.y1?Ai.COLUMN:Number.isFinite(L+P)?L>P?Ai.ROW:Ai.COLUMN:Ai.ROW,function(t,e,i,o){var n;const{drawConnect:r=!1,mode:s="none"}=o||{};if(r&&"none"===s)return;const{top:a,bottom:l}=e;if(a.curves.length!==l.curves.length)return;if(i>=1){const e=[],i=[];let n=!0;if(r){let n,r,s=!0;const h=a.curves.length;a.curves.forEach(((a,d)=>{const c=l.curves[h-d-1];let u=a,g=c;if(a.originP1===a.originP2)return n=a,void(r=c);if(n&&n.originP1===n.originP2&&(u=n,g=r),a.defined)s||(e.push(u),i.push(g),nl(t,e,i,o),e.length=0,i.length=0,s=!s);else{const{originP1:n,originP2:r}=a;let l,h;n&&!1!==n.defined?(l=u,h=g):n&&!1!==r.defined&&(l=a,h=c),s?(s=!s,e.push(l||a),i.push(h||c)):l&&(s=!s,e.push(l||a),i.push(h||c),nl(t,e,i,o),e.length=0,i.length=0)}n=a})),nl(t,e,i,o)}else{for(let r=0,s=a.curves.length;r<s;r++){const h=a.curves[r];n!==h.defined?(n?(rl(t,e,i,o),e.length=0,i.length=0):(e.push(h),i.push(l.curves[s-r-1])),n=!n):n&&(e.push(h),i.push(l.curves[s-r-1]))}rl(t,e,i,o)}return}if(i<=0)return;let{direction:h}=o||{};const{curves:d}=a,c=null!==(n=d[d.length-1].p3)&&void 0!==n?n:d[d.length-1].p1,u=re(c.x-d[0].p0.x),g=re(c.y-d[0].p0.y);h=null!=h?h:u>g?Ai.ROW:Ai.COLUMN,Number.isFinite(u)||(h=Ai.COLUMN),Number.isFinite(g)||(h=Ai.ROW);const p=i*(h===Ai.ROW?u:g);let f=0,v=!0;const b=[],m=[];let y,C,w=!0;for(let e=0,i=a.curves.length;e<i;e++){const n=a.curves[e],s=n.getLength(h),d=(p-f)/s;if(d<0)break;if(f+=s,r){const r=l.curves[i-e-1];let s=n,a=r;if(n.originP1===n.originP2){y=n,C=r;continue}if(y&&y.originP1===y.originP2&&(s=y,a=C),n.defined)w||(b.push(s),m.push(a),nl(t,b,m,o),b.length=0,m.length=0,w=!w);else{const{originP1:e,originP2:i}=n;let l,h;e&&!1!==e.defined?(l=s,h=a):e&&!1!==i.defined&&(l=n,h=r),w?(w=!w,b.push(l||n),m.push(h||r)):l&&(w=!w,b.push(l||n),m.push(h||r),nl(t,b,m,o),b.length=0,m.length=0)}y=n}else{let r=null,s=null;v!==n.defined?(v?(rl(t,b,m,o),b.length=0,m.length=0):(r=n,s=l.curves[i-e-1]),v=!v):v&&(r=n,s=l.curves[i-e-1]),r&&s&&(d<1&&(r=r.p2&&r.p3?Oi(r,d)[0]:zi(r,d)[0],s=s.p2&&s.p3?Oi(s,1-d)[1]:zi(s,1-d)[1]),r.defined=v,s.defined=v,b.push(r),m.push(s)),r=null,s=null}}r?nl(t,b,m,o):rl(t,b,m,o)}(t.camera?t:t.nativeContext,e,l,{offsetX:h,offsetY:d,offsetZ:c,direction:M,drawConnect:p,mode:w,zeroX:x,zeroY:_}),this.beforeRenderStep(u,t,h,d,!!o,!1,i,!1,a,g,f,null,{attribute:s}),t.setShadowBlendStyle&&t.setShadowBlendStyle(u,s,a);const{x:E=0,x:H=0}=s;return!1!==i&&(f?f(t,s,a):o&&(t.setCommonStyle(u,p?S:s,E-h,H-d,p?A:a),t.fill())),this.afterRenderStep(u,t,h,d,!!o,!1,i,!1,a,g,f,null,{attribute:s}),(()=>{if(!1!==n)if(v)v(t,s,a);else{const{stroke:i=a&&a[1]&&a[1].stroke}=s;ht(i)&&(i[0]||i[2])&&!1===i[1]&&(t.beginPath(),el(t.camera?t:t.nativeContext,i[0]?e.top:e.bottom,l,M===Ai.ROW?"x":"y",{offsetX:h,offsetY:d,offsetZ:c,drawConnect:p,mode:w,zeroX:x,zeroY:_})),t.setStrokeStyle(u,p?S:s,E-h,H-d,p?A:a),t.stroke()}})(),!1}};cl=ll([C(),dl(0,m(O)),dl(0,w(js)),hl("design:paramtypes",[Object])],cl);const ul=_a,gl=Ca;var pl=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},fl=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},vl=function(t,e){return function(i,o){e(i,o,t)}};let bl=class extends fa{constructor(t){super(),this.pathRenderContribitions=t,this.numberType=rs,this.builtinContributions=[gl,ul],this.init(t)}drawShape(t,e,i,o,n,r,s,a){var l,h,d;const c=null!==(l=this.tempTheme)&&void 0!==l?l:kn(t,null==r?void 0:r.theme).path,{x:u=c.x,y:g=c.y,fillStrokeOrder:p=c.fillStrokeOrder}=t.attribute,f=null!==(h=this.z)&&void 0!==h?h:0,v=this.valid(t,c,s,a);if(!v)return;const{fVisible:b,sVisible:m,doFill:y,doStroke:C}=v;if(e.beginPath(),t.pathShape)Li(t.pathShape.commandList,e,i,o,1,1,f);else{Li((null!==(d=t.attribute.path)&&void 0!==d?d:c.path).commandList,e,i,o,1,1,f)}e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,c),this.beforeRenderStep(t,e,i,o,y,C,b,m,c,n,s,a);const w=()=>{C&&(a?a(e,t.attribute,c):m&&(e.setStrokeStyle(t,t.attribute,u-i,g-o,c),e.stroke()))},x=()=>{y&&(s?s(e,t.attribute,c):b&&(e.setCommonStyle(t,t.attribute,u-i,g-o,c),e.fill()))};p?(w(),x()):(x(),w()),this.afterRenderStep(t,e,i,o,y,C,b,m,c,n,s,a)}draw(t,e,i,o){const n=kn(t,null==o?void 0:o.theme).path;this.tempTheme=n,this._draw(t,n,!1,i,o),this.tempTheme=null}};bl=pl([C(),vl(0,m(O)),vl(0,w(Xs)),fl("design:paramtypes",[Object])],bl);var ml=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},yl=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Cl=function(t,e){return function(i,o){e(i,o,t)}};let wl=class extends fa{constructor(t){super(),this.rectRenderContribitions=t,this.type="rect",this.numberType=as,this.builtinContributions=[Ia,Da,za],this.init(t)}drawShape(t,e,i,o,n,r,s,a){var l;const h=null!==(l=this.tempTheme)&&void 0!==l?l:kn(t,null==r?void 0:r.theme).rect,{fill:d=h.fill,background:c,stroke:u=h.stroke,cornerRadius:g=h.cornerRadius,opacity:p=h.opacity,fillOpacity:f=h.fillOpacity,lineWidth:v=h.lineWidth,strokeOpacity:b=h.strokeOpacity,visible:m=h.visible,x1:y,y1:C,x:w=h.x,y:x=h.y,fillStrokeOrder:_=h.fillStrokeOrder}=t.attribute;let{width:S,height:A}=t.attribute;S=(null!=S?S:y-w)||0,A=(null!=A?A:C-x)||0;const B=Es(p,f,S,A,d),R=Fs(p,b,S,A),T=Ms(d,c),k=Ls(u,v);if(!t.valid||!m)return;if(!T&&!k)return;if(!(B||R||s||a||c))return;0===g||ht(g)&&g.every((t=>0===t))?(e.beginPath(),e.rect(i,o,S,A)):(e.beginPath(),Pa(e,i,o,S,A,g));const M={doFill:T,doStroke:k};e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),this.beforeRenderStep(t,e,i,o,T,k,B,R,h,n,s,a,M);const L=()=>{M.doFill&&(s?s(e,t.attribute,h):B&&(e.setCommonStyle(t,t.attribute,w-i,x-o,h),e.fill()))},P=()=>{M.doStroke&&(a?a(e,t.attribute,h):R&&(e.setStrokeStyle(t,t.attribute,w-i,x-o,h),e.stroke()))};_?(P(),L()):(L(),P()),this.afterRenderStep(t,e,i,o,T,k,B,R,h,n,s,a)}draw(t,e,i,o){const n=kn(t,null==o?void 0:o.theme).rect;this.tempTheme=n,this._draw(t,n,!1,i,o),this.tempTheme=null}};wl=ml([C(),Cl(0,m(O)),Cl(0,w(Ks)),yl("design:paramtypes",[Object])],wl);var xl=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},_l=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Sl=function(t,e){return function(i,o){e(i,o,t)}};let Al=class extends fa{constructor(t){super(),this.symbolRenderContribitions=t,this.numberType=hs,this.builtinContributions=[Ga,Va,ja],this.init(t)}drawShape(t,e,i,o,n,r,s,a){var l;const h=kn(t,null==r?void 0:r.theme).symbol,{size:d=h.size,x:c=h.x,y:u=h.y,scaleX:g=h.scaleX,scaleY:p=h.scaleY,fillStrokeOrder:f=h.fillStrokeOrder}=t.attribute,v=this.valid(t,h,s,a);if(!v)return;const{fVisible:b,sVisible:m,doFill:y,doStroke:C}=v,w=t.getParsedPath();if(!w)return;const{keepDirIn3d:x=h.keepDirIn3d}=t.attribute,_=null!==(l=this.z)&&void 0!==l?l:0;e.beginPath();const S=(n,r)=>{var l,d,v;if(t._parsedPath.svgCache){const e=Object.assign({},r);e.fill=null!==(l=r.fill)&&void 0!==l?l:t.attribute.fill,e.opacity=null!==(d=r.opacity)&&void 0!==d?d:t.attribute.opacity,e.fillOpacity=t.attribute.fillOpacity,e.stroke=null!==(v=r.stroke)&&void 0!==v?v:t.attribute.stroke,r=e}const b=()=>{r.fill&&(s?s(e,t.attribute,h):(e.setCommonStyle(t,r,c-i,u-o,h),e.fill()))},m=()=>{r.stroke&&(a?a(e,t.attribute,h):(e.setStrokeStyle(t,r,(c-i)/g,(u-o)/p,h),e.stroke()))};f?(m(),b()):(b(),m())};if(x&&e.camera&&e.project){const t=e.project(i,o,_),n=e.camera;e.camera=null,!1===w.draw(e,ht(d)?[d[0]*g,d[1]*p]:d*g,t.x,t.y,void 0,S)&&e.closePath(),e.camera=n}else!1===w.draw(e,d,i,o,_,S)&&e.closePath();e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),this.beforeRenderStep(t,e,i,o,y,C,b,m,h,n,s,a);const A=()=>{y&&!w.isSvg&&(s?s(e,t.attribute,h):b&&(e.setCommonStyle(t,t.attribute,c-i,u-o,h),e.fill()))},B=()=>{C&&!w.isSvg&&(a?a(e,t.attribute,h):m&&(e.setStrokeStyle(t,t.attribute,(c-i)/g,(u-o)/p,h),e.stroke()))};f?(B(),A()):(A(),B()),this.afterRenderStep(t,e,i,o,y,C,b,m,h,n,s,a)}draw(t,e,i,o){const n=kn(t,null==o?void 0:o.theme).symbol;this._draw(t,n,!1,i,o)}};Al=xl([C(),Sl(0,m(O)),Sl(0,w(qs)),_l("design:paramtypes",[Object])],Al);const Bl=new class{constructor(){this.pools=[];for(let t=0;t<10;t++)this.pools.push(new Fe)}allocate(t,e,i,o){if(!this.pools.length)return(new Fe).setValue(t,e,i,o);const n=this.pools.pop();return n.x1=t,n.y1=e,n.x2=i,n.y2=o,n}allocateByObj(t){if(!this.pools.length)return new Fe(t);const e=this.pools.pop();return e.x1=t.x1,e.y1=t.y1,e.x2=t.x2,e.y2=t.y2,e}free(t){this.pools.push(t)}get length(){return this.pools.length}release(){this.pools=[]}};const Rl=new class{constructor(){this.store=new Map}RegisterGraphicCreator(t,e){this.store.set(t,e),this[t]=e}CreateGraphic(t,e){const i=this.store.get(t);return i?i(e):null}};let Tl;function kl(t){return Tl||(Tl=Rl.CreateGraphic("text",{})),Tl.initAttributes(t),Tl.AABBBounds}const Ml=new class extends ya{constructor(){super(...arguments),this.time=Ri.beforeFillStroke}drawShape(t,e,i,o,n,r,s,a,l,h,d,c){var u,g,p,f,v,b,m,y,C,w;const{backgroundMode:x=l.backgroundMode,backgroundFit:_=l.backgroundFit}=t.attribute;let S,{background:A}=t.attribute;if(!A)return;const B=()=>{"richtext"===t.type&&(e.restore(),e.save(),S&&e.setTransformFromMatrix(S,!0,1))};let R;"richtext"===t.type&&(S=e.currentMatrix.clone(),e.restore(),e.save(),e.setTransformForCurrent());const T=nt(A)&&A.background,k=t.transMatrix.onlyTranslate();if(T){const e=t.AABBBounds,i=(null!==(u=A.x)&&void 0!==u?u:e.x1)+(null!==(g=A.dx)&&void 0!==g?g:0),o=(null!==(p=A.y)&&void 0!==p?p:e.y1)+(null!==(f=A.dy)&&void 0!==f?f:0),n=null!==(v=A.width)&&void 0!==v?v:e.width(),r=null!==(b=A.height)&&void 0!==b?b:e.height();if(R=Bl.allocate(i,o,i+n,o+r),A=A.background,!k){const t=R.width(),e=R.height();R.set((null!==(m=A.x)&&void 0!==m?m:0)+(null!==(y=A.dx)&&void 0!==y?y:0),(null!==(C=A.y)&&void 0!==C?C:0)+(null!==(w=A.dy)&&void 0!==w?w:0),t,e)}}else R=t.AABBBounds,k||(R=kl(Object.assign(Object.assign({},t.attribute),{angle:0,scaleX:1,scaleY:1,x:0,y:0,dx:0,dy:0})).clone());if(t.backgroundImg&&t.resources){const n=t.resources.get(A);if("success"!==n.state||!n.data)return void B();e.highPerformanceSave(),k&&e.setTransformFromMatrix(t.parent.globalTransMatrix,!0),e.setCommonStyle(t,t.attribute,i,o,l),this.doDrawImage(e,n.data,R,x,_),e.highPerformanceRestore(),e.setTransformForCurrent()}else{const{backgroundCornerRadius:n}=t.attribute;e.highPerformanceSave(),e.setCommonStyle(t,t.attribute,i,o,l),e.fillStyle=A,n?(Pa(e,R.x1,R.y1,R.width(),R.height(),n),e.fill()):e.fillRect(R.x1,R.y1,R.width(),R.height()),e.highPerformanceRestore()}T&&Bl.free(R),B()}};var Ll=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Pl=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},El=function(t,e){return function(i,o){e(i,o,t)}};let Hl=class extends fa{constructor(t){super(),this.textRenderContribitions=t,this.numberType=ds,this.builtinContributions=[Ml],this.init(t)}drawShape(t,e,i,o,n,r,s,a){var l,h,d;const c=kn(t,null==r?void 0:r.theme).text,{text:u,underline:g=c.underline,lineThrough:p=c.lineThrough,keepDirIn3d:f=c.keepDirIn3d,direction:v=c.direction,fontSize:b=c.fontSize,verticalMode:m=c.verticalMode,x:y=c.x,y:C=c.y}=t.attribute,w=null!==(l=pr(t.attribute.lineHeight,b))&&void 0!==l?l:b,x=this.valid(t,c,s,a);if(!x)return;const{fVisible:_,sVisible:S,doFill:A,doStroke:B}=x,R=!f,T=this.z||0;e.beginPath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,c),this.beforeRenderStep(t,e,i,o,A,B,_,S,c,n,s,a),R&&this.transformUseContext2d(t,c,T,e);const k=(n,r,l,h)=>{let d=i+r;const u=o+l;if(h){e.highPerformanceSave(),d+=b;const t=aa.allocate(1,0,0,1,0,0);t.rotateByCenter(Math.PI/2,d,u),e.transformFromMatrix(t,!0),aa.free(t)}B&&(a?a(e,t.attribute,c):S&&(e.setStrokeStyle(t,t.attribute,y-i,C-o,c),e.strokeText(n,d,u,T))),A&&(s?s(e,t.attribute,c):_&&(e.setCommonStyle(t,t.attribute,y-i,C-o,c),e.fillText(n,d,u,T))),h&&(e.highPerformanceRestore(),e.setTransformForCurrent())};if(e.setTextStyleWithoutAlignBaseline(t.attribute,c,T),"horizontal"===v){const{multilineLayout:n}=t;if(!n)return void e.highPerformanceRestore();const{xOffset:r,yOffset:l}=n.bbox;B&&(a?a(e,t.attribute,c):S&&(e.setStrokeStyle(t,t.attribute,y-i,C-o,c),n.lines.forEach((t=>{e.strokeText(t.str,(t.leftOffset||0)+r+i,(t.topOffset||0)+l+o,T)})))),A&&(s?s(e,t.attribute,c):_&&(e.setCommonStyle(t,t.attribute,y-i,C-o,c),n.lines.forEach((n=>{e.fillText(n.str,(n.leftOffset||0)+r+i,(n.topOffset||0)+l+o,T),this.drawUnderLine(g,p,t,(n.leftOffset||0)+r+i,(n.topOffset||0)+l+o,n.descent,(n.descent-n.ascent)/2,T,c,e,{width:n.width})}))))}else{let{textAlign:i=c.textAlign,textBaseline:o=c.textBaseline}=t.attribute;if(!m){const e=i;i=null!==(h=t.getBaselineMapAlign()[o])&&void 0!==h?h:"left",o=null!==(d=t.getAlignMapBaseline()[e])&&void 0!==d?d:"top"}t.tryUpdateAABBBounds();const n=t.cache,{verticalList:r}=n;e.textAlign="left",e.textBaseline="top";const s=w*r.length;let a=0;r.forEach((t=>{const e=t.reduce(((t,e)=>t+(e.width||0)),0);a=le(e,a)}));let l=0,u=0;"bottom"===o?u=-s:"middle"===o&&(u=-s/2),"center"===i?l-=a/2:"right"===i&&(l-=a),r.forEach(((t,e)=>{const o=t.reduce(((t,e)=>t+(e.width||0)),0),n=a-o;let r=l;"center"===i?r+=n/2:"right"===i&&(r+=n),t.forEach((t=>{const{text:i,width:o,direction:n}=t;k(i,s-(e+1)*w+u,r,n),r+=o}))}))}R&&this.restoreTransformUseContext2d(t,c,T,e),this.afterRenderStep(t,e,i,o,A,B,_,S,c,n,s,a)}draw(t,e,i,o){const n=kn(t,null==o?void 0:o.theme).text,{keepDirIn3d:r=n.keepDirIn3d}=t.attribute,s=!r;this._draw(t,n,s,i,o)}drawUnderLine(t,e,i,o,n,r,s,a,l,h,d){if(e+t<=0)return;const{textAlign:c=l.textAlign,fill:u=l.fill,opacity:g=l.opacity,underlineOffset:p=l.underlineOffset,underlineDash:f=l.underlineDash,fillOpacity:v=l.fillOpacity}=i.attribute,b=!it(d),m=b?d.width:i.clipedWidth,y=b?0:Qs(c,m),C={lineWidth:0,stroke:u,opacity:g,strokeOpacity:v};if(t){C.lineWidth=t,h.setStrokeStyle(i,C,o,n,l),f&&h.setLineDash(f),h.beginPath();const e=n+r+p;h.moveTo(o+y,e,a),h.lineTo(o+y+m,e,a),h.stroke()}if(e){C.lineWidth=e,h.setStrokeStyle(i,C,o,n,l),h.beginPath();const t=n+s;h.moveTo(o+y,t,a),h.lineTo(o+y+m,t,a),h.stroke()}}};function Fl(t,e,i,o){t.moveTo(e[0].x+i,e[0].y+o);for(let n=1;n<e.length;n++)t.lineTo(e[n].x+i,e[n].y+o)}function Ol(t,e){return Math.sqrt(t*t+e*e)}function Il(t,e,i,o,n){const r=e/i;return{x:t.x-o*r,y:t.y-n*r}}Hl=Ll([C(),El(0,m(O)),El(0,w(Zs)),Pl("design:paramtypes",[Object])],Hl);const zl=_a,Dl=Ca;var Wl=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Nl=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Gl=function(t,e){return function(i,o){e(i,o,t)}};let jl=class extends fa{constructor(t){super(),this.polygonRenderContribitions=t,this.numberType=ss,this.builtinContributions=[Dl,zl],this.init(t)}drawShape(t,e,i,o,n,r,s,a){const l=kn(t,null==r?void 0:r.theme).polygon,{points:h=l.points,cornerRadius:d=l.cornerRadius,x:c=l.x,y:u=l.y,closePath:g=l.closePath,fillStrokeOrder:p=l.fillStrokeOrder}=t.attribute,f=this.valid(t,l,s,a);if(!f)return;const{fVisible:v,sVisible:b,doFill:m,doStroke:y}=f;e.beginPath(),d<=0||ht(d)&&d.every((t=>0===t))?Fl(e.camera?e:e.nativeContext,h,i,o):function(t,e,i,o,n){let r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];var s;if(e.length<3)return void Fl(t,e,i,o);let a=0,l=e.length-1;r||(a+=1,l-=1,t.moveTo(e[0].x+i,e[0].y+o));for(let r=a;r<=l;r++){const a=e[0===r?l:(r-1)%e.length],h=e[r%e.length],d=e[(r+1)%e.length],c=h.x-a.x,u=h.y-a.y,g=h.x-d.x,p=h.y-d.y,f=(Math.atan2(u,c)-Math.atan2(p,g))/2,v=Math.abs(Math.tan(f));let b=Array.isArray(n)?null!==(s=n[r%e.length])&&void 0!==s?s:0:n,m=b/v;const y=Ol(c,u),C=Ol(g,p),w=Math.min(y,C);m>w&&(m=w,b=w*v);const x=Il(h,m,y,c,u),_=Il(h,m,C,g,p),S=2*h.x-x.x-_.x,A=2*h.y-x.y-_.y,B=Ol(S,A),R=Il(h,Ol(m,b),B,S,A);let T=Math.atan2(x.y-R.y,x.x-R.x);const k=Math.atan2(_.y-R.y,_.x-R.x);let M=k-T;M<0&&(T=k,M=-M),M>Math.PI&&(M-=Math.PI),0===r?t.moveTo(x.x+i,x.y+o):t.lineTo(x.x+i,x.y+o),M&&t.arcTo(h.x+i,h.y+o,_.x+i,_.y+o,b),t.lineTo(_.x+i,_.y+o)}r||t.lineTo(e[l+1].x+i,e[l+1].y+o)}(e.camera?e:e.nativeContext,h,i,o,d,g),g&&e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),this.beforeRenderStep(t,e,i,o,m,y,v,b,l,n,s,a);const C=()=>{m&&(s?s(e,t.attribute,l):v&&(e.setCommonStyle(t,t.attribute,c-i,u-o,l),e.fill()))},w=()=>{y&&(a?a(e,t.attribute,l):b&&(e.setStrokeStyle(t,t.attribute,c-i,u-o,l),e.stroke()))};p?(w(),C()):(C(),w()),this.afterRenderStep(t,e,i,o,m,y,v,b,l,n,s,a)}draw(t,e,i,o){const n=kn(t,null==o?void 0:o.theme).polygon;this._draw(t,n,!1,i,o)}};jl=Wl([C(),Gl(0,m(O)),Gl(0,w(Ys)),Nl("design:paramtypes",[Object])],jl);var Vl=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Ul=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},$l=function(t,e){return function(i,o){e(i,o,t)}};let Xl=class{constructor(t){this.groupRenderContribitions=t,this.numberType=is}drawShape(t,e,i,o,n,r,s,a){const l=kn(t,null==r?void 0:r.theme).group,{fill:h=l.fill,background:d,stroke:c=l.stroke,opacity:u=l.opacity,width:g=l.width,height:p=l.height,clip:f=l.clip,fillOpacity:v=l.fillOpacity,strokeOpacity:b=l.strokeOpacity,cornerRadius:m=l.cornerRadius,path:y=l.path,lineWidth:C=l.lineWidth,visible:w=l.visible,fillStrokeOrder:x=l.fillStrokeOrder,x:_=l.x,y:S=l.y}=t.attribute,A=Es(u,v,g,p,h),B=Fs(u,b,g,p),R=Ms(h,d),T=Ls(c,C);if(!t.valid||!w)return;if(!f){if(!R&&!T)return;if(!(A||B||s||a||d))return}if(y&&y.length&&n.drawContribution){const t=e.disableFill,i=e.disableStroke,o=e.disableBeginPath;e.disableFill=!0,e.disableStroke=!0,e.disableBeginPath=!0,y.forEach((t=>{n.drawContribution.getRenderContribution(t).draw(t,n.renderService,n,r)})),e.disableFill=t,e.disableStroke=i,e.disableBeginPath=o}else 0===m||ht(m)&&m.every((t=>0===t))?(e.beginPath(),e.rect(i,o,g,p)):(e.beginPath(),Pa(e,i,o,g,p,m));this._groupRenderContribitions||(this._groupRenderContribitions=this.groupRenderContribitions.getContributions()||[],this._groupRenderContribitions.push(Ma));const k={doFill:R,doStroke:T};this._groupRenderContribitions.forEach((r=>{r.time===Ri.beforeFillStroke&&r.drawShape(t,e,i,o,R,T,A,B,l,n,s,a,k)})),f&&e.clip(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l);const M=()=>{k.doFill&&(s?s(e,t.attribute,l):A&&(e.setCommonStyle(t,t.attribute,_-i,S-o,l),e.fill()))},L=()=>{k.doStroke&&(a?a(e,t.attribute,l):B&&(e.setStrokeStyle(t,t.attribute,_-i,S-o,l),e.stroke()))};x?(L(),M()):(M(),L()),this._groupRenderContribitions.forEach((r=>{r.time===Ri.afterFillStroke&&r.drawShape(t,e,i,o,R,T,A,B,l,n,s,a)}))}draw(t,e,i,o){const{context:n}=i;if(!n)return;const{clip:r,baseOpacity:s=1}=t.attribute;r?n.save():n.highPerformanceSave();const a=n.baseGlobalAlpha;n.baseGlobalAlpha*=s;const l=kn(t,null==o?void 0:o.theme).group,h=n.modelMatrix;if(n.camera){const e=la.allocate(),i=la.allocate();ua(i,t,l),na(e,h||e,i),n.modelMatrix=e,la.free(i),n.setTransform(1,0,0,1,0,0,!0)}else n.transformFromMatrix(t.transMatrix,!0);n.beginPath(),o.skipDraw?this.drawShape(t,n,0,0,i,o,(()=>!1),(()=>!1)):this.drawShape(t,n,0,0,i);const{scrollX:d=l.scrollX,scrollY:c=l.scrollY}=t.attribute;let u;(d||c)&&n.translate(d,c),o&&o.drawingCb&&(u=o.drawingCb()),n.modelMatrix!==h&&la.free(n.modelMatrix),n.modelMatrix=h,n.baseGlobalAlpha=a,u&&u.then?u.then((()=>{r?n.restore():n.highPerformanceRestore()})):r?n.restore():n.highPerformanceRestore()}};Xl=Vl([C(),$l(0,m(O)),$l(0,w(Us)),Ul("design:paramtypes",[Object])],Xl);var Yl=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Kl=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ql=function(t,e){return function(i,o){e(i,o,t)}};const Zl=["","repeat-x","repeat-y","repeat"];let Jl=class extends fa{constructor(t){super(),this.imageRenderContribitions=t,this.numberType=os,this.builtinContributions=[Wa,Na],this.init(t)}drawShape(t,e,i,o,n,r,s,a){const l=kn(t).image,{width:h=l.width,height:d=l.height,repeatX:c=l.repeatX,repeatY:u=l.repeatY,x:g=l.x,y:p=l.y,cornerRadius:f=l.cornerRadius,fillStrokeOrder:v=l.fillStrokeOrder,image:b}=t.attribute,m=this.valid(t,l,s);if(!m)return;const{fVisible:y,sVisible:C,doFill:w,doStroke:x}=m;if(!b||!t.resources)return;const _=t.resources.get(b);if("success"!==_.state)return;let S=!1;0===f||ht(f)&&f.every((t=>0===t))||(e.beginPath(),Pa(e,i,o,h,d,f),S=!0),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l);const A=()=>{if(w)if(s)s(e,t.attribute,l);else if(y){e.setCommonStyle(t,t.attribute,i,o,l);let n=0;if("repeat"===c&&(n|=1),"repeat"===u&&(n|=2),n){const t=e.createPattern(_.data,Zl[n]);e.fillStyle=t,e.translate(i,o,!0),e.fillRect(0,0,h,d),e.translate(-i,-o,!0)}else e.drawImage(_.data,i,o,h,d)}},B=()=>{x&&(a?a(e,t.attribute,l):C&&(e.setStrokeStyle(t,t.attribute,g-i,p-o,l),e.stroke()))};v?(B(),S&&(e.save(),e.clip()),this.beforeRenderStep(t,e,i,o,w,!1,y,!1,l,n,s),A(),S&&e.restore()):(S&&(e.save(),e.clip()),this.beforeRenderStep(t,e,i,o,w,!1,y,!1,l,n,s),A(),S&&e.restore(),B()),this.afterRenderStep(t,e,i,o,w,!1,y,!1,l,n,s)}draw(t,e,i){const{image:o}=t.attribute;if(!o||!t.resources)return;const n=t.resources.get(o);if("loading"===n.state&&lt(o))return void _r.improveImageLoading(o);if("success"!==n.state)return;const{context:r}=e.drawParams;if(!r)return;const s=kn(t).image;this._draw(t,s,!1,i)}};Jl=Yl([C(),ql(0,m(O)),ql(0,w($s)),Kl("design:paramtypes",[Object])],Jl);const Ql=Symbol.for("IncrementalDrawContribution"),th=Symbol.for("ArcRender"),eh=Symbol.for("CircleRender"),ih=Symbol.for("GraphicRender"),oh=Symbol.for("GroupRender"),nh=Symbol.for("LineRender"),rh=Symbol.for("PathRender"),sh=Symbol.for("PolygonRender"),ah=Symbol.for("RectRender"),lh=Symbol.for("SymbolRender"),hh=Symbol.for("TextRender"),dh=Symbol.for("RichTextRender"),ch=Symbol.for("ImageRender"),uh=Symbol.for("DrawContribution"),gh=(t,e,i,o)=>{let n,r=!1,s=!1;if(e.forEachChildren((t=>(r=t.numberType===Qr,!r))),e.forEachChildren((t=>(s=!!t.findFace,!s))),r){const t=e.getChildren(),a=[...t];a.sort(((t,e)=>{var i,o,n,r;let s=(null!==(o=null!==(i=t.attribute.startAngle)&&void 0!==i?i:0+t.attribute.endAngle)&&void 0!==o?o:0)/2,a=(null!==(r=null!==(n=e.attribute.startAngle)&&void 0!==n?n:0+e.attribute.endAngle)&&void 0!==r?r:0)/2;for(;s<0;)s+=ne;for(;a<0;)a+=ne;return a-s})),a.forEach((t=>{t._next=null,t._prev=null})),e.removeAllChild(),e.update(),a.forEach((t=>{e.appendChild(t)})),o.hack_pieFace="outside",n=i(r,s),n&&n.graphic||(o.hack_pieFace="inside",n=i(r,s)),n&&n.graphic||(o.hack_pieFace="top",n=i(r,s)),e.removeAllChild(),t.forEach((t=>{t._next=null,t._prev=null})),t.forEach((t=>{e.appendChild(t)}))}else if(s){const o=e.getChildren(),a=o.map((e=>({ave_z:e.findFace().vertices.map((i=>{var o;return t.view(i[0],i[1],null!==(o=i[2]+e.attribute.z)&&void 0!==o?o:0)[2]})).reduce(((t,e)=>t+e),0),g:e})));a.sort(((t,e)=>e.ave_z-t.ave_z)),e.removeAllChild(),a.forEach((t=>{t.g._next=null,t.g._prev=null})),e.update(),a.forEach((t=>{e.add(t.g)})),n=i(r,s),e.removeAllChild(),o.forEach((t=>{t._next=null,t._prev=null})),e.update(),o.forEach((t=>{e.add(t)}))}else n=i(r,s);return n};var ph=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},fh=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};const vh=Symbol.for("DrawItemInterceptor"),bh=new Fe,mh=new Fe;class yh{constructor(){this.order=1}afterDrawItem(t,e,i,o,n){return null==t.attribute.shadowRootIdx&&t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx<0||(t.attribute.shadowRootIdx>0||!t.attribute.shadowRootIdx||t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx>0)&&this.drawItem(t,e,i,o,n),!1}beforeDrawItem(t,e,i,o,n){return null==t.attribute.shadowRootIdx&&t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx>0||(t.attribute.shadowRootIdx<0||t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx<0)&&this.drawItem(t,e,i,o,n),!1}drawItem(t,e,i,o,n){if(!t.shadowRoot)return!1;const{context:r}=i;if(r.highPerformanceSave(),r.transformFromMatrix(t.transMatrix,!0),o.dirtyBounds&&o.backupDirtyBounds){bh.copy(o.dirtyBounds),mh.copy(o.backupDirtyBounds);const e=t.globalTransMatrix.getInverse();o.dirtyBounds.copy(o.backupDirtyBounds).transformWithMatrix(e),o.backupDirtyBounds.copy(o.dirtyBounds)}return o.renderGroup(t.shadowRoot,i,aa.allocate(1,0,0,1,0,0)),r.highPerformanceRestore(),o.dirtyBounds&&o.backupDirtyBounds&&(o.dirtyBounds.copy(bh),o.backupDirtyBounds.copy(mh)),!0}}class Ch{constructor(){this.order=1}afterDrawItem(t,e,i,o,n){return t.attribute._debug_bounds&&this.drawItem(t,e,i,o,n),!1}drawItem(t,e,i,o,n){if(!t.attribute._debug_bounds)return!1;const{context:r}=i;r.highPerformanceSave(),t.parent&&r.setTransformFromMatrix(t.parent.globalTransMatrix,!0),t.glyphHost&&t.glyphHost.parent&&r.setTransformFromMatrix(t.glyphHost.parent.globalTransMatrix,!0);const s=t.AABBBounds;return!0!==t.attribute._debug_bounds&&t.attribute._debug_bounds(r,t),r.strokeRect(s.x1,s.y1,s.width(),s.height()),r.highPerformanceRestore(),!0}}let wh=class{constructor(){this.order=1,this.interceptors=[new yh,new _h,new xh,new Ch]}afterDrawItem(t,e,i,o,n){for(let r=0;r<this.interceptors.length;r++)if(this.interceptors[r].afterDrawItem&&this.interceptors[r].afterDrawItem(t,e,i,o,n))return!0;return!1}beforeDrawItem(t,e,i,o,n){if((!t.in3dMode||i.in3dInterceptor)&&!t.shadowRoot&&!(t.baseGraphic||t.attribute.globalZIndex||t.interactiveGraphic))return!1;for(let r=0;r<this.interceptors.length;r++)if(this.interceptors[r].beforeDrawItem&&this.interceptors[r].beforeDrawItem(t,e,i,o,n))return!0;return!1}};wh=ph([C(),fh("design:paramtypes",[])],wh);class xh{constructor(){this.order=1}beforeDrawItem(t,e,i,o,n){return!this.processing&&(t.baseGraphic?this.beforeDrawInteractive(t,e,i,o,n):this.beforeSetInteractive(t,e,i,o,n))}beforeSetInteractive(t,e,i,o,n){let r=t.interactiveGraphic;if(t.attribute.globalZIndex){r||(r=t.clone(),t.interactiveGraphic=r,r.baseGraphic=t),r.setAttributes({globalZIndex:0,zIndex:t.attribute.globalZIndex},!1,{skipUpdateCallback:!0}),i.stage.tryInitInteractiveLayer();const e=i.stage.getLayer("_builtin_interactive");return e&&this.getShadowRoot(e).add(r),!0}if(r){i.stage.tryInitInteractiveLayer();const e=i.stage.getLayer("_builtin_interactive");e&&this.getShadowRoot(e).removeChild(r),t.interactiveGraphic=null,r.baseGraphic=null}return!1}beforeDrawInteractive(t,e,i,o,n){const r=t.baseGraphic;let s=!!r.stage,a=r.parent;for(;s&&a&&a.stage!==a;)s=!!a.stage,a=a.parent;if(!s){const e=i.stage.getLayer("_builtin_interactive");return e&&this.getShadowRoot(e).removeChild(t),!0}if(r){this.processing=!0;const{context:t}=i;return t.highPerformanceSave(),t.setTransformFromMatrix(r.parent.globalTransMatrix,!0),r.isContainer?o.renderGroup(r,i,r.parent.globalTransMatrix):o.renderItem(r,i),t.highPerformanceRestore(),this.processing=!1,!0}return!1}getShadowRoot(t){var e;let i=t.getElementById("_interactive_group");return i||(i=Rl.CreateGraphic("group",{}),i.id="_interactive_group",t.add(i)),null!==(e=i.shadowRoot)&&void 0!==e?e:i.attachShadow()}}class _h{constructor(){this.order=1}beforeDrawItem(t,e,i,o,n){if(!t.in3dMode||i.in3dInterceptor)return!1;i.in3dInterceptor=!0;const{context:r,stage:s}=e.drawParams;r.canvas,r.save(),this.initCanvasCtx(r),r.camera=s.camera;const a=r.currentMatrix;a.a/=r.dpr,a.b/=r.dpr,a.c/=r.dpr,a.d/=r.dpr,a.e/=r.dpr,a.f/=r.dpr;const l=la.allocate();oa(l,a);const h=r.modelMatrix;if(h){if(l){const t=la.allocate();r.modelMatrix=na(t,h,l)}}else r.modelMatrix=l;return r.setTransform(1,0,0,1,0,0,!0),t.isContainer?gh(r,t,((e,n)=>o.renderGroup(t,i,t.parent.globalTransMatrix,!e&&n)),i):o.renderItem(t,i),r.camera=null,r.restore(),r.modelMatrix!==h&&la.free(r.modelMatrix),r.modelMatrix=h,i.in3dInterceptor=!1,!0}initCanvasCtx(t){t.setTransformForCurrent()}}var Sh=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Ah=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Bh=function(t,e){return function(i,o){e(i,o,t)}};const Rh=Symbol.for("RenderService");let Th=class{constructor(t){this.drawContribution=t}prepare(t){t&&this.renderTreeRoots.forEach((e=>{this._prepare(e,t)}))}_prepare(t,e){t.forEachChildren((t=>{this._prepare(t,e)})),t.update({bounds:e,trans:!0})}prepareRenderList(){}beforeDraw(t){}draw(t){this.drawContribution.draw(this,Object.assign({},this.drawParams))}afterDraw(t){this.drawContribution.afterDraw&&this.drawContribution.afterDraw(this,Object.assign({},this.drawParams))}render(t,e){this.renderTreeRoots=t,this.drawParams=e;const i=e.updateBounds;this.prepare(i),this.prepareRenderList(),this.beforeDraw(e),this.draw(e),this.afterDraw(e),this.drawParams=null}};Th=Sh([C(),Bh(0,m(uh)),Ah("design:paramtypes",[Object])],Th);var kh=new a((t=>{t(Rh).to(Th)}));const Mh=Symbol.for("PickerService"),Lh=Symbol.for("GlobalPickerService"),Ph=(t,e,i)=>{const{outerBorder:o,shadowBlur:n=e.shadowBlur}=t;if(o){const t=e.outerBorder,{distance:r=t.distance,lineWidth:s=t.lineWidth}=o;i.expand(r+(n+s)/2)}return i},Eh=["radius","startAngle","endAngle",...Rr];let Hh=class t extends Er{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{radius:1}),this.type="circle",this.numberType=es}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{startAngle:t,endAngle:e,radius:i}=this.attribute;return this._validNumber(t)&&this._validNumber(e)&&this._validNumber(i)}getGraphicTheme(){return kn(this).circle}updateAABBBounds(t,e,i,o){this.updatePathProxyAABBBounds(i)||(o?this.updateCircleAABBBoundsImprecise(t,e,i):this.updateCircleAABBBoundsAccurate(t,e,i));const{tb1:n,tb2:r}=zo.graphicService.updateTempAABBBounds(i);return Ph(t,e,n),i.union(n),n.setValue(r.x1,r.y1,r.x2,r.y2),zo.graphicService.transformAABBBounds(t,i,e,!1,this),i}updateCircleAABBBoundsImprecise(t,e,i){const{radius:o=e.radius}=t;return i.set(-o,-o,o,o),i}updateCircleAABBBoundsAccurate(t,e,i){const{startAngle:o=e.startAngle,endAngle:n=e.endAngle,radius:r=e.radius}=t;return n-o>ne-te?i.set(-r,-r,r,r):lr(o,n,r,i),i}needUpdateTags(t){return super.needUpdateTags(t,Eh)}needUpdateTag(t){return super.needUpdateTag(t,Eh)}toCustomPath(){var t,e,i;const o=this.attribute,n=null!==(t=o.radius)&&void 0!==t?t:this.getDefaultAttribute("radius"),r=null!==(e=o.startAngle)&&void 0!==e?e:this.getDefaultAttribute("startAngle"),s=null!==(i=o.endAngle)&&void 0!==i?i:this.getDefaultAttribute("endAngle"),a=new go;return a.arc(0,0,n,r,s),a}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}};function Fh(t){return new Hh(t)}Hh.NOWORK_ANIMATE_ATTR=Pr;class Oh{constructor(t,e,i){this.fontFamily=t,this.textOptions=e,this.textMeasure=i}LayoutBBox(t,e,i,o){if(t.xOffset="left"===e||"start"===e?0:"center"===e?t.width/-2:"right"===e||"end"===e?-t.width:0,"top"===i)t.yOffset=0;else if("middle"===i)t.yOffset=t.height/-2;else if("alphabetic"===i){let e=.79;if(1===o.length){const t=o[0];e=t.ascent/(t.ascent+t.descent)}t.yOffset=t.height*-e}else t.yOffset=-t.height;return t}GetLayoutByLines(t,e,i,o){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",r=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0;const{lineWidth:a,suffixPosition:l="end",measureMode:h=Y.actualBounding,keepCenterInLine:d=!1}=null!=s?s:{};t=t.map((t=>t.toString()));const c=[],u=[0,0];if("number"==typeof a&&a!==1/0){let e;for(let i=0,o=t.length;i<o;i++){const o=this.textMeasure.measureTextPixelADscentAndWidth(t[i],this.textOptions,h);let s=t[i].toString();if(o.width>a){const o=this.textMeasure.clipTextWithSuffix(t[i],this.textOptions,a,n,r,l);s=o.str,e=o.width}else e=o.width;c.push({str:s,width:e,ascent:o.ascent,descent:o.descent,keepCenterInLine:d})}u[0]=a}else{let e,i,o=0;for(let n=0,r=t.length;n<r;n++){i=t[n];const r=this.textMeasure.measureTextPixelADscentAndWidth(t[n],this.textOptions,h);e=r.width,o=Math.max(o,e),c.push({str:i,width:e,ascent:r.ascent,descent:r.descent,keepCenterInLine:d})}u[0]=o}u[1]=c.length*o,u[0]=c.reduce(((t,e)=>Math.max(t,e.width)),0);const g={xOffset:0,yOffset:0,width:u[0],height:u[1]};return this.LayoutBBox(g,e,i,c),this.layoutWithBBox(g,c,e,i,o)}layoutWithBBox(t,e,i,o,n){const r=[0,0],s=e.length*n;"top"===o||("middle"===o?r[1]=(t.height-s)/2:"bottom"===o&&(r[1]=t.height-s));for(let s=0;s<e.length;s++)this.lineOffset(t,e[s],i,o,n,r);return{bbox:t,lines:e,fontFamily:this.fontFamily,fontSize:this.textOptions.fontSize,fontWeight:this.textOptions.fontWeight,lineHeight:n,textAlign:i,textBaseline:o}}lineOffset(t,e,i,o,n,r){if("left"===i||"start"===i?e.leftOffset=0:"center"===i?e.leftOffset=(t.width-e.width)/2:"right"!==i&&"end"!==i||(e.leftOffset=t.width-e.width),e.topOffset=n/2+(e.ascent-e.descent)/2+r[1],!e.keepCenterInLine){const t=0,i=e.ascent+e.descent+t;if(i<n-t&&("bottom"===o?e.topOffset+=(n-i)/2:"top"===o&&(e.topOffset-=(n-i)/2)),"alphabetic"===o){const t=n/(e.ascent+e.descent);e.topOffset=n/2+(e.ascent-e.descent)/2*t+r[1]}}return r[1]+=n,e}}const Ih=["text","maxLineWidth","maxWidth","textAlign","textBaseline","heightLimit","lineClamp","fontSize","fontFamily","fontWeight","ellipsis","lineHeight","direction","wordBreak","heightLimit","lineClamp",...Rr];let zh=class t extends Er{get font(){const t=this.getGraphicTheme();return this._font||(this._font=Le(this.attribute,t)),this._font}get clipedText(){var t;const e=this.attribute,i=this.getGraphicTheme(),o=this.getMaxWidth(i);return Number.isFinite(o)?(this.tryUpdateAABBBounds(),this.cache.clipedText):(null!==(t=e.text)&&void 0!==t?t:i.text).toString()}get clipedWidth(){return this.tryUpdateAABBBounds(),this.cache.clipedWidth}get cliped(){var t,e;const i=this.getGraphicTheme(),o=this.attribute,n=this.getMaxWidth(i);if(!Number.isFinite(n))return!1;const{text:r}=this.attribute;if(this.tryUpdateAABBBounds(),null===(e=null===(t=this.cache)||void 0===t?void 0:t.layoutData)||void 0===e?void 0:e.lines){let t="";return this.cache.layoutData.lines.forEach((e=>{t+=e.str})),(Array.isArray(r)?r.join(""):r)!==t}return"vertical"===o.direction&&this.cache.verticalList&&this.cache.verticalList[0]?this.cache.verticalList[0].map((t=>t.text)).join("")!==o.text.toString():null!=this.clipedText&&this.clipedText!==o.text.toString()}get multilineLayout(){return this.tryUpdateAABBBounds(),this.cache.layoutData}get isMultiLine(){return Array.isArray(this.attribute.text)||"normal"===this.attribute.whiteSpace}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{text:"",fontSize:16}),this.type="text",this.numberType=ds,this.cache={}}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{text:t}=this.attribute;return ht(t)?!t.every((t=>null==t||""===t)):null!=t&&""!==t}getGraphicTheme(){return kn(this).text}doUpdateOBBBounds(){const e=this.getGraphicTheme();this._OBBBounds.clear();const i=this.attribute,{angle:o=e.angle}=i;if(!o){const t=this.AABBBounds;return this._OBBBounds.setValue(t.x1,t.y1,t.x2,t.y2),this._OBBBounds}this.obbText||(this.obbText=new t({})),this.obbText.setAttributes(Object.assign(Object.assign({},i),{angle:0}));const n=this.obbText.AABBBounds,{x:r,y:s}=i,a={x:(n.x1+n.x2)/2,y:(n.y1+n.y2)/2},l=Be(a,o,{x:r,y:s});return this._OBBBounds.copy(n),this._OBBBounds.translate(l.x-a.x,l.y-a.y),this._OBBBounds.angle=o,this._OBBBounds}updateAABBBounds(t,e,i){const{text:o=e.text}=this.attribute;Array.isArray(o)?this.updateMultilineAABBBounds(o):this.updateSingallineAABBBounds(o);const{tb1:n}=zo.graphicService.updateTempAABBBounds(i),{scaleX:r=e.scaleX,scaleY:s=e.scaleY,shadowBlur:a=e.shadowBlur,strokeBoundsBuffer:l=e.strokeBoundsBuffer}=t;if(a){Ur(n,a/Math.abs(r+s),!0,l),i.union(n)}return zo.graphicService.combindShadowAABBBounds(i,this),null==t.forceBoundsHeight&&null==t.forceBoundsWidth||zo.graphicService.updateHTMLTextAABBBounds(t,e,i),Ee(i,i,this.transMatrix),i}updateSingallineAABBBounds(t){this.updateMultilineAABBBounds([t]);const e=this.cache.layoutData;if(e&&e.lines&&e.lines.length){const t=e.lines[0];this.cache.clipedText=t.str,this.cache.clipedWidth=t.width}return this._AABBBounds}updateMultilineAABBBounds(t){const e=this.getGraphicTheme(),{direction:i=e.direction,underlineOffset:o=e.underlineOffset}=this.attribute,n="horizontal"===i?this.updateHorizontalMultilineAABBBounds(t):this.updateVerticalMultilineAABBBounds(t);return"horizontal"===i&&o&&this._AABBBounds.add(this._AABBBounds.x1,this._AABBBounds.y2+o),n}guessLineHeightBuf(t){return t?.1*t:0}updateHorizontalMultilineAABBBounds(t){var e;const i=this.getGraphicTheme(),o=this.attribute,{fontFamily:n=i.fontFamily,textAlign:r=i.textAlign,textBaseline:s=i.textBaseline,fontSize:a=i.fontSize,fontWeight:l=i.fontWeight,ellipsis:h=i.ellipsis,maxLineWidth:d,stroke:c=i.stroke,wrap:u=i.wrap,measureMode:g=i.measureMode,lineWidth:p=i.lineWidth,whiteSpace:f=i.whiteSpace,suffixPosition:v=i.suffixPosition,ignoreBuf:b=i.ignoreBuf,keepCenterInLine:m=i.keepCenterInLine}=o,y=b?0:this.guessLineHeightBuf(a),C=this.getLineHeight(o,i,y);if("normal"===f||u)return this.updateWrapAABBBounds(t);if(!this.shouldUpdateShape()&&(null===(e=this.cache)||void 0===e?void 0:e.layoutData)){const t=this.cache.layoutData.bbox;return this._AABBBounds.set(t.xOffset,t.yOffset,t.xOffset+t.width,t.yOffset+t.height),c&&this._AABBBounds.expand(p/2),this._AABBBounds}const w=zo.graphicUtil.textMeasure,x=new Oh(n,{fontSize:a,fontWeight:l,fontFamily:n,lineHeight:C},w).GetLayoutByLines(t,r,s,C,!0===h?i.ellipsis:h||void 0,!1,{lineWidth:d,suffixPosition:v,measureMode:g,keepCenterInLine:m}),{bbox:_}=x;return this.cache.layoutData=x,this.clearUpdateShapeTag(),this._AABBBounds.set(_.xOffset,_.yOffset,_.xOffset+_.width,_.yOffset+_.height),c&&this._AABBBounds.expand(p/2),this._AABBBounds}updateWrapAABBBounds(t){var e,i,o;const n=this.getGraphicTheme(),{fontFamily:r=n.fontFamily,textAlign:s=n.textAlign,textBaseline:a=n.textBaseline,fontSize:l=n.fontSize,ellipsis:h=n.ellipsis,maxLineWidth:d,stroke:c=n.stroke,lineWidth:u=n.lineWidth,wordBreak:g=n.wordBreak,fontWeight:p=n.fontWeight,ignoreBuf:f=n.ignoreBuf,measureMode:v=n.measureMode,suffixPosition:b=n.suffixPosition,heightLimit:m=0,lineClamp:y,keepCenterInLine:C=n.keepCenterInLine}=this.attribute,w=f?0:this.guessLineHeightBuf(l),x=this.getLineHeight(this.attribute,n,w);if(!this.shouldUpdateShape()&&(null===(e=this.cache)||void 0===e?void 0:e.layoutData)){const t=this.cache.layoutData.bbox;return this._AABBBounds.set(t.xOffset,t.yOffset,t.xOffset+t.width,t.yOffset+t.height),c&&this._AABBBounds.expand(u/2),this._AABBBounds}const _=zo.graphicUtil.textMeasure,S={fontSize:l,fontWeight:p,fontFamily:r,lineHeight:x},A=new Oh(r,S,_),B=ht(t)?t.map((t=>t.toString())):[t.toString()],R=[],T=[0,0];let k=1/0;if(m>0&&(k=Math.max(Math.floor(m/x),1)),y&&(k=Math.min(k,y)),"number"==typeof d&&d!==1/0){if(d>0)for(let t=0;t<B.length;t++){const e=B[t];let n=!0;if(t===k-1){const i=_.clipTextWithSuffix(e,S,d,h,!1,b,t!==B.length-1),o=_.measureTextPixelADscentAndWidth(i.str,S,v);R.push({str:i.str,width:i.width,ascent:o.ascent,descent:o.descent,keepCenterInLine:C});break}const r=_.clipText(e,S,d,"break-all"!==g,"keep-all"===g);if(""!==e&&""===r.str||r.wordBreaked){if(h){const t=_.clipTextWithSuffix(e,S,d,h,!1,b);r.str=null!==(i=t.str)&&void 0!==i?i:"",r.width=null!==(o=t.width)&&void 0!==o?o:0}else r.str="",r.width=0;n=!1}const s=_.measureTextPixelADscentAndWidth(r.str,S,v);R.push({str:r.str,width:r.width,ascent:s.ascent,descent:s.descent,keepCenterInLine:C});let a=r.str.length;if(!r.wordBreaked||""!==e&&""===r.str||(n=!0,a=r.wordBreaked),r.str.length===e.length);else if(n){let i=e.substring(a);"keep-all"===g&&(i=i.replace(/^\s+/g,"")),B.splice(t+1,0,i)}}let t=0;R.forEach((e=>{t=Math.max(t,e.width)})),T[0]=t}else{let t,e,i=0;for(let o=0,n=B.length;o<n;o++){if(o===k-1){const t=_.clipTextWithSuffix(B[o],S,d,h,!1,b),e=_.measureTextPixelADscentAndWidth(t.str,S,v);R.push({str:t.str,width:t.width,ascent:e.ascent,descent:e.descent,keepCenterInLine:C}),i=Math.max(i,t.width);break}e=B[o],t=_.measureTextWidth(e,S),i=Math.max(i,t);const n=_.measureTextPixelADscentAndWidth(e,S,v);R.push({str:e,width:t,ascent:n.ascent,descent:n.descent,keepCenterInLine:C})}T[0]=i}T[1]=R.length*x;const M={xOffset:0,yOffset:0,width:T[0],height:T[1]};A.LayoutBBox(M,s,a,R);const L=A.layoutWithBBox(M,R,s,a,x);return this.cache.layoutData=L,this.clearUpdateShapeTag(),this._AABBBounds.set(M.xOffset,M.yOffset,M.xOffset+M.width,M.yOffset+M.height),c&&this._AABBBounds.expand(u/2),this._AABBBounds}updateVerticalMultilineAABBBounds(e){var i,o;const n=this.getGraphicTheme(),r=zo.graphicUtil.textMeasure;let s;const a=this.attribute,{maxLineWidth:l=n.maxLineWidth,ellipsis:h=n.ellipsis,fontFamily:d=n.fontFamily,fontSize:c=n.fontSize,fontWeight:u=n.fontWeight,stroke:g=n.stroke,lineWidth:p=n.lineWidth,verticalMode:f=n.verticalMode,suffixPosition:v=n.suffixPosition}=a,b=this.getLineHeight(a,n,0);let{textAlign:m=n.textAlign,textBaseline:y=n.textBaseline}=a;if(!f){const e=m;m=null!==(i=t.baselineMapAlign[y])&&void 0!==i?i:"left",y=null!==(o=t.alignMapBaseline[e])&&void 0!==o?o:"top"}if(s=0,!this.shouldUpdateShape()&&this.cache){this.cache.verticalList.forEach((t=>{const e=t.reduce(((t,e)=>t+e.width),0);s=le(e,s)}));const t=Qs(m,s),e=this.cache.verticalList.length*b,i=ta(y,e,c);return this._AABBBounds.set(i,t,i+e,t+s),g&&this._AABBBounds.expand(p/2),this._AABBBounds}const C=e.map((t=>function(t){const e=[];let i=0,o="";for(let n=0;n<t.length;n++)Zr(t[n])?i?o+=t[n]:(i=1,o=t[n]):(i&&(e.push({text:o,direction:Yr.VERTICAL}),o="",i=0),e.push({text:t[n],direction:Yr.HORIZONTAL}));return o&&e.push({text:o,direction:Yr.VERTICAL}),e}(t.toString())));C.forEach(((t,e)=>{if(Number.isFinite(l))if(h){const i=!0===h?n.ellipsis:h,o=r.clipTextWithSuffixVertical(t,{fontSize:c,fontWeight:u,fontFamily:d},l,i,!1,v);C[e]=o.verticalList,s=o.width}else{const i=r.clipTextVertical(t,{fontSize:c,fontWeight:u,fontFamily:d},l,!1);C[e]=i.verticalList,s=i.width}else s=0,t.forEach((t=>{const e=t.direction===Yr.HORIZONTAL?c:r.measureTextWidth(t.text,{fontSize:c,fontWeight:u,fontFamily:d});s+=e,t.width=e}))})),this.cache.verticalList=C,this.clearUpdateShapeTag(),this.cache.verticalList.forEach((t=>{const e=t.reduce(((t,e)=>t+e.width),0);s=le(e,s)}));const w=Qs(m,s),x=this.cache.verticalList.length*b,_=ta(y,x,c);return this._AABBBounds.set(_,w,_+x,w+s),g&&this._AABBBounds.expand(p/2),this._AABBBounds}getMaxWidth(t){var e,i;const o=this.attribute;return null!==(i=null!==(e=o.maxLineWidth)&&void 0!==e?e:o.maxWidth)&&void 0!==i?i:t.maxWidth}getLineHeight(t,e,i){var o;return null!==(o=pr(t.lineHeight,t.fontSize||e.fontSize))&&void 0!==o?o:(t.fontSize||e.fontSize)+i}needUpdateTags(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ih;return super.needUpdateTags(t,e)}needUpdateTag(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ih;return super.needUpdateTag(t,e)}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}getBaselineMapAlign(){return t.baselineMapAlign}getAlignMapBaseline(){return t.alignMapBaseline}};function Dh(t){return new zh(t)}zh.NOWORK_ANIMATE_ATTR=Object.assign({ellipsis:1,wordBreak:1,direction:1,textAlign:1,textBaseline:1,fontFamily:1,fontWeight:1},Pr),zh.baselineMapAlign={top:"left",bottom:"right",middle:"center"},zh.alignMapBaseline={left:"top",right:"bottom",center:"middle"};const Wh=["heightLimit","lineClamp"];class Nh extends zh{constructor(t){super(Object.assign(Object.assign({},t),{wrap:!0}))}_isValid(){const{text:t}=this.attribute;return ht(t)?!t.every((t=>null==t||""===t)):null!=t&&""!==t}updateMultilineAABBBounds(t){var e,i,o,n;const r=this.getGraphicTheme(),{fontFamily:s=r.fontFamily,textAlign:a=r.textAlign,textBaseline:l=r.textBaseline,fontSize:h=r.fontSize,ellipsis:d=r.ellipsis,maxLineWidth:c,stroke:u=r.stroke,lineWidth:g=r.lineWidth,wordBreak:p=r.wordBreak,fontWeight:f=r.fontWeight,ignoreBuf:v=r.ignoreBuf,heightLimit:b=0,suffixPosition:m=r.suffixPosition,lineClamp:y}=this.attribute,C=null!==(e=pr(this.attribute.lineHeight,this.attribute.fontSize||r.fontSize))&&void 0!==e?e:this.attribute.fontSize||r.fontSize,w=v?0:2;if(!this.shouldUpdateShape()&&(null===(i=this.cache)||void 0===i?void 0:i.layoutData)){const t=this.cache.layoutData.bbox;return this._AABBBounds.set(t.xOffset,t.yOffset,t.xOffset+t.width,t.yOffset+t.height),u&&this._AABBBounds.expand(g/2),this._AABBBounds}const x=zo.graphicUtil.textMeasure,_=new Oh(s,{fontSize:h,fontWeight:f,fontFamily:s},x),S=t.map((t=>t.toString())),A=[],B=[0,0];let R=1/0;if(b>0&&(R=Math.max(Math.floor(b/C),1)),y&&(R=Math.min(R,y)),"number"==typeof c&&c!==1/0){if(c>0)for(let t=0;t<S.length;t++){const e=S[t];let i=!0;if(t===R-1){const t=_.textMeasure.clipTextWithSuffix(e,_.textOptions,c,d,!1,m);A.push({str:t.str,width:t.width,ascent:0,descent:0,keepCenterInLine:!1});break}const r=_.textMeasure.clipText(e,_.textOptions,c,"break-word"===p);if(""!==e&&""===r.str){if(d){const t=_.textMeasure.clipTextWithSuffix(e,_.textOptions,c,d,!1,m);r.str=null!==(o=t.str)&&void 0!==o?o:"",r.width=null!==(n=t.width)&&void 0!==n?n:0}else r.str="",r.width=0;i=!1}if(A.push({str:r.str,width:r.width,ascent:0,descent:0,keepCenterInLine:!1}),r.str.length===e.length);else if(i){const i=e.substring(r.str.length);S.splice(t+1,0,i)}}let t=0;A.forEach((e=>{t=Math.max(t,e.width)})),B[0]=t}else{let t,e,i=0;for(let o=0,n=S.length;o<n;o++){if(o===R-1){const t=_.textMeasure.clipTextWithSuffix(S[o],_.textOptions,c,d,!1,m);A.push({str:t.str,width:t.width,ascent:0,descent:0,keepCenterInLine:!1}),i=Math.max(i,t.width);break}e=S[o],t=_.textMeasure.measureTextWidth(e,_.textOptions,"break-word"===p),i=Math.max(i,t),A.push({str:e,width:t,ascent:0,descent:0,keepCenterInLine:!1})}B[0]=i}B[1]=A.length*(C+w);const T={xOffset:0,yOffset:0,width:B[0],height:B[1]};_.LayoutBBox(T,a,l);const k=_.layoutWithBBox(T,A,a,l,C);return this.cache.layoutData=k,this.clearUpdateShapeTag(),this._AABBBounds.set(T.xOffset,T.yOffset,T.xOffset+T.width,T.yOffset+T.height),u&&this._AABBBounds.expand(g/2),this._AABBBounds}needUpdateTags(t){for(let e=0;e<Wh.length;e++){const i=Wh[e];if(-1!==t.indexOf(i))return!0}return super.needUpdateTags(t)}needUpdateTag(t){for(let e=0;e<Wh.length;e++)if(t===Wh[e])return!0;return super.needUpdateTag(t)}getNoWorkAnimateAttr(){return Nh.NOWORK_ANIMATE_ATTR}}function Gh(t){return new Nh(t)}class jh{bounds(t,e){if(ut(t)){const i=t/2;e.x1=-i,e.x2=i,e.y1=-i,e.y2=i}else e.x1=-t[0]/2,e.x2=t[0]/2,e.y1=-t[1]/2,e.y2=t[1]/2}parseSize(t){return ut(t)?t:Math.min(t[0],t[1])}}function Vh(t,e,i,o,n){return n?t.arc(i,o,e,0,oe,!1,n):t.arc(i,o,e,0,oe),!1}var Uh=new class extends jh{constructor(){super(...arguments),this.type="circle",this.pathStr="M0.5,0A0.5,0.5,0,1,1,-0.5,0A0.5,0.5,0,1,1,0.5,0"}draw(t,e,i,o,n){return Vh(t,this.parseSize(e)/2,i,o,n)}drawOffset(t,e,i,o,n,r){return Vh(t,this.parseSize(e)/2+n,i,o,r)}drawToSvgPath(t,e,i,o){const n=this.parseSize(t)/2;return`M ${e-n}, ${i} a ${n},${n} 0 1,0 ${2*n},0 a ${n},${n} 0 1,0 -${2*n},0`}};var $h=new class extends jh{constructor(){super(...arguments),this.type="cross",this.pathStr="M-0.5,-0.2L-0.5,0.2L-0.2,0.2L-0.2,0.5L0.2,0.5L0.2,0.2L0.5,0.2L0.5,-0.2L0.2,-0.2L0.2,-0.5L-0.2,-0.5L-0.2,-0.2Z"}draw(t,e,i,o,n){return function(t,e,i,o,n){return t.moveTo(-3*e+i,-e+o,n),t.lineTo(-e+i,-e+o,n),t.lineTo(-e+i,-3*e+o,n),t.lineTo(e+i,-3*e+o,n),t.lineTo(e+i,-e+o,n),t.lineTo(3*e+i,-e+o,n),t.lineTo(3*e+i,e+o,n),t.lineTo(e+i,e+o,n),t.lineTo(e+i,3*e+o,n),t.lineTo(-e+i,3*e+o,n),t.lineTo(-e+i,e+o,n),t.lineTo(-3*e+i,e+o,n),t.closePath(),!0}(t,this.parseSize(e)/6,i,o,n)}drawOffset(t,e,i,o,n,r){return function(t,e,i,o,n,r){return t.moveTo(-3*e+i-n,-e+o-n,r),t.lineTo(-e+i-n,-e+o-n,r),t.lineTo(-e+i-n,-3*e+o-n,r),t.lineTo(e+i+n,-3*e+o-n,r),t.lineTo(e+i+n,-e+o-n,r),t.lineTo(3*e+i+n,-e+o-n,r),t.lineTo(3*e+i+n,e+o+n,r),t.lineTo(e+i+n,e+o+n,r),t.lineTo(e+i+n,3*e+o+n,r),t.lineTo(-e+i-n,3*e+o+n,r),t.lineTo(-e+i-n,e+o+n,r),t.lineTo(-3*e+i-n,e+o+n,r),t.closePath(),!0}(t,this.parseSize(e)/6,i,o,n,r)}};function Xh(t,e,i,o,n){return t.moveTo(i,o-e,n),t.lineTo(e+i,o,n),t.lineTo(i,o+e,n),t.lineTo(i-e,o,n),t.closePath(),!0}var Yh=new class extends jh{constructor(){super(...arguments),this.type="diamond",this.pathStr="M-0.5,0L0,-0.5L0.5,0L0,0.5Z"}draw(t,e,i,o,n){return Xh(t,this.parseSize(e)/2,i,o,n)}drawFitDir(t,e,i,o,n){return Xh(t,this.parseSize(e)/2,i,o,n)}drawOffset(t,e,i,o,n,r){return Xh(t,this.parseSize(e)/2+n,i,o,r)}};function Kh(t,e,i,o){const n=2*e;return t.rect(i-e,o-e,n,n),!1}var qh=new class extends jh{constructor(){super(...arguments),this.type="square",this.pathStr="M-0.5,-0.5h1v1h-1Z"}draw(t,e,i,o){return Kh(t,this.parseSize(e)/2,i,o)}drawOffset(t,e,i,o,n){return Kh(t,this.parseSize(e)/2+n,i,o)}};function Zh(t,e,i,o){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return t.moveTo(i+e+2*n,e+o+n),t.lineTo(i-e-2*n,e+o+n),t.lineTo(i,o-e-2*n),t.closePath(),!0}class Jh extends jh{constructor(){super(...arguments),this.type="triangleUp",this.pathStr="M0.5,0.5 L-0.5,0.5 L0,-0.5 Z"}draw(t,e,i,o){return Zh(t,this.parseSize(e)/2,i,o)}drawOffset(t,e,i,o,n){return Zh(t,this.parseSize(e)/2,i,o,n)}}var Qh=new Jh;var td=new class extends Jh{constructor(){super(...arguments),this.type="triangle"}};const ed=Math.sin(Math.PI/10)/Math.sin(7*Math.PI/10),id=Math.sin(oe/10)*ed,od=-Math.cos(oe/10)*ed;function nd(t,e,i,o){const n=id*e,r=od*e;t.moveTo(i,-e+o),t.lineTo(n+i,r+o);for(let s=1;s<5;++s){const a=oe*s/5,l=Math.cos(a),h=Math.sin(a);t.lineTo(h*e+i,-l*e+o),t.lineTo(l*n-h*r+i,h*n+l*r+o)}return t.closePath(),!0}var rd=new class extends jh{constructor(){super(...arguments),this.type="star",this.pathStr="M0 -1L0.22451398828979266 -0.3090169943749474L0.9510565162951535 -0.30901699437494745L0.3632712640026804 0.1180339887498948L0.5877852522924732 0.8090169943749473L8.326672684688674e-17 0.3819660112501051L-0.587785252292473 0.8090169943749476L-0.3632712640026804 0.11803398874989487L-0.9510565162951536 -0.30901699437494723L-0.22451398828979274 -0.30901699437494734Z"}draw(t,e,i,o){return nd(t,this.parseSize(e)/2,i,o)}drawOffset(t,e,i,o,n){return nd(t,this.parseSize(e)/2+n,i,o)}};const sd=ce(3);function ad(t,e,i,o){const n=e,r=n/sd,s=r/5,a=e;return t.moveTo(0+i,-n+o),t.lineTo(r/2+i,o),t.lineTo(s/2+i,o),t.lineTo(s/2+i,a+o),t.lineTo(-s/2+i,a+o),t.lineTo(-s/2+i,o),t.lineTo(-r/2+i,o),t.closePath(),!0}var ld=new class extends jh{constructor(){super(...arguments),this.type="arrow",this.pathStr="M-0.07142857142857142,0.5L0.07142857142857142,0.5L0.07142857142857142,-0.0625L0.2,-0.0625L0,-0.5L-0.2,-0.0625L-0.07142857142857142,-0.0625Z"}draw(t,e,i,o){return ad(t,this.parseSize(e)/2,i,o)}drawOffset(t,e,i,o,n){return ad(t,this.parseSize(e)/2+n,i,o)}};function hd(t,e,i,o){const n=2*e;return t.moveTo(i,-e+o),t.lineTo(n/3/2+i,e+o),t.lineTo(-n/3/2+i,e+o),t.closePath(),!0}var dd=new class extends jh{constructor(){super(...arguments),this.type="wedge",this.pathStr="M0,-0.5773502691896257L-0.125,0.28867513459481287L0.125,0.28867513459481287Z"}draw(t,e,i,o){return hd(t,this.parseSize(e)/2,i,o)}drawOffset(t,e,i,o,n){return hd(t,this.parseSize(e)/2+n,i,o)}};function cd(t,e,i,o){return t.moveTo(-e+i,o),t.lineTo(i,e+o),!1}var ud=new class extends jh{constructor(){super(...arguments),this.type="stroke",this.pathStr=""}draw(t,e,i,o){return cd(t,this.parseSize(e)/2,i,o)}drawOffset(t,e,i,o,n){return cd(t,this.parseSize(e)/2+n,i,o)}};const gd=-.5,pd=ce(3)/2,fd=1/ce(12);function vd(t,e,i,o){const n=e/2,r=e*fd,s=n,a=e*fd+e,l=-s,h=a;return t.moveTo(n+i,r+o),t.lineTo(s+i,a+o),t.lineTo(l+i,h+o),t.lineTo(gd*n-pd*r+i,pd*n+gd*r+o),t.lineTo(gd*s-pd*a+i,pd*s+gd*a+o),t.lineTo(gd*l-pd*h+i,pd*l+gd*h+o),t.lineTo(gd*n+pd*r+i,gd*r-pd*n+o),t.lineTo(gd*s+pd*a+i,gd*a-pd*s+o),t.lineTo(gd*l+pd*h+i,gd*h-pd*l+o),t.closePath(),!1}var bd=new class extends jh{constructor(){super(...arguments),this.type="wye",this.pathStr="M0.25 0.14433756729740646L0.25 0.6443375672974064L-0.25 0.6443375672974064L-0.25 0.14433756729740643L-0.6830127018922193 -0.10566243270259357L-0.4330127018922193 -0.5386751345948129L0 -0.28867513459481287L0.4330127018922193 -0.5386751345948129L0.6830127018922193 -0.10566243270259357Z"}draw(t,e,i,o){return vd(t,this.parseSize(e)/2,i,o)}drawOffset(t,e,i,o,n){return vd(t,this.parseSize(e)/2+n,i,o)}};function md(t,e,i,o,n){return t.moveTo(-e+i-2*n,o),t.lineTo(e+i+n,e+o+2*n),t.lineTo(e+i+n,o-e-2*n),t.closePath(),!0}var yd=new class extends jh{constructor(){super(...arguments),this.type="triangleLeft",this.pathStr="M-0.5,0 L0.5,0.5 L0.5,-0.5 Z"}draw(t,e,i,o){return md(t,this.parseSize(e)/2,i,o,0)}drawOffset(t,e,i,o,n){return md(t,this.parseSize(e)/2,i,o,n)}};function Cd(t,e,i,o){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return t.moveTo(i-e-n,e+o+2*n),t.lineTo(e+i+2*n,o),t.lineTo(i-e-n,o-e-2*n),t.closePath(),!0}var wd=new class extends jh{constructor(){super(...arguments),this.type="triangleRight",this.pathStr="M-0.5,0.5 L0.5,0 L-0.5,-0.5 Z"}draw(t,e,i,o){return Cd(t,this.parseSize(e)/2,i,o)}drawOffset(t,e,i,o,n){return Cd(t,this.parseSize(e)/2,i,o,n)}};function xd(t,e,i,o){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return t.moveTo(i-e-2*n,o-e-n),t.lineTo(i+e+2*n,o-e-n),t.lineTo(i,o+e+2*n),t.closePath(),!0}var _d=new class extends jh{constructor(){super(...arguments),this.type="triangleDown",this.pathStr="M-0.5,-0.5 L0.5,-0.5 L0,0.5 Z"}draw(t,e,i,o){return xd(t,this.parseSize(e)/2,i,o)}drawOffset(t,e,i,o,n){return xd(t,this.parseSize(e)/2,i,o,n)}};const Sd=ce(3);function Ad(t,e,i,o){const n=e*Sd;return t.moveTo(i,o+-n/3*2),t.lineTo(e+i,o+n),t.lineTo(i-e,o+n),t.closePath(),!0}var Bd=new class extends jh{constructor(){super(...arguments),this.type="thinTriangle",this.pathStr="M0,-0.5773502691896257L-0.5,0.28867513459481287L0.5,0.28867513459481287Z"}draw(t,e,i,o){return Ad(t,this.parseSize(e)/2/Sd,i,o)}drawOffset(t,e,i,o,n){return Ad(t,this.parseSize(e)/2/Sd+n,i,o)}};function Rd(t,e,i,o){const n=2*e;return t.moveTo(e+i,o-n),t.lineTo(i-e,o),t.lineTo(e+i,n+o),!0}var Td=new class extends jh{constructor(){super(...arguments),this.type="arrow2Left",this.pathStr="M 0.25 -0.5 L -0.25 0 l 0.25 0.5"}draw(t,e,i,o){return Rd(t,this.parseSize(e)/4,i,o)}drawOffset(t,e,i,o,n){return Rd(t,this.parseSize(e)/4+n,i,o)}};function kd(t,e,i,o){const n=2*e;return t.moveTo(i-e,o-n),t.lineTo(i+e,o),t.lineTo(i-e,n+o),!0}var Md=new class extends jh{constructor(){super(...arguments),this.type="arrow2Right",this.pathStr="M -0.25 -0.5 l 0.25 0 l -0.25 0.5"}draw(t,e,i,o){return kd(t,this.parseSize(e)/4,i,o)}drawOffset(t,e,i,o,n){return kd(t,this.parseSize(e)/4+n,i,o)}};function Ld(t,e,i,o){const n=2*e;return t.moveTo(i-n,o+e),t.lineTo(i,o-e),t.lineTo(i+n,o+e),!0}var Pd=new class extends jh{constructor(){super(...arguments),this.type="arrow2Up",this.pathStr="M -0.5 0.25 L 0 -0.25 l 0.5 0.25"}draw(t,e,i,o){return Ld(t,this.parseSize(e)/4,i,o)}drawOffset(t,e,i,o,n){return Ld(t,this.parseSize(e)/4+n,i,o)}};function Ed(t,e,i,o){const n=2*e;return t.moveTo(i-n,o-e),t.lineTo(i,o+e),t.lineTo(i+n,o-e),!0}var Hd=new class extends jh{constructor(){super(...arguments),this.type="arrow2Down",this.pathStr="M -0.5 -0.25 L 0 0.25 l 0.5 -0.25"}draw(t,e,i,o){return Ed(t,this.parseSize(e)/4,i,o)}drawOffset(t,e,i,o,n){return Ed(t,this.parseSize(e)/4+n,i,o)}};function Fd(t,e,i,o,n){return t.moveTo(i,o-e),t.lineTo(i,o+e),!0}var Od=new class extends jh{constructor(){super(...arguments),this.type="lineV",this.pathStr="M0,-0.5L0,0.5"}draw(t,e,i,o,n){return Fd(t,this.parseSize(e)/2,i,o)}drawOffset(t,e,i,o,n,r){return Fd(t,this.parseSize(e)/2+n,i,o)}drawToSvgPath(t,e,i,o){const n=this.parseSize(t)/2;return`M ${e}, ${i-n} L ${e},${i+n}`}};function Id(t,e,i,o,n){return t.moveTo(i-e,o),t.lineTo(i+e,o),!0}var zd=new class extends jh{constructor(){super(...arguments),this.type="lineH",this.pathStr="M-0.5,0L0.5,0"}draw(t,e,i,o,n){return Id(t,this.parseSize(e)/2,i,o)}drawOffset(t,e,i,o,n,r){return Id(t,this.parseSize(e)/2+n,i,o)}drawToSvgPath(t,e,i,o){const n=this.parseSize(t)/2;return`M ${e-n}, ${i} L ${e+n},${i}`}};function Dd(t,e,i,o,n){return t.moveTo(i-e,o-e),t.lineTo(i+e,o+e),t.moveTo(i+e,o-e),t.lineTo(i-e,o+e),!0}var Wd=new class extends jh{constructor(){super(...arguments),this.type="close",this.pathStr="M-0.5,-0.5L0.5,0.5,M0.5,-0.5L-0.5,0.5"}draw(t,e,i,o,n){return Dd(t,this.parseSize(e)/2,i,o)}drawOffset(t,e,i,o,n,r){return Dd(t,this.parseSize(e)/2+n,i,o)}drawToSvgPath(t,e,i,o){const n=this.parseSize(t)/2;return`M ${e-n}, ${i-n} L ${e+n},${i+n} M ${e+n}, ${i-n} L ${e-n},${i+n}`}};function Nd(t,e,i,o){return t.rect(i-e[0]/2,o-e[1]/2,e[0],e[1]),!1}function Gd(t,e,i,o){const n=e,r=e/2;return t.rect(i-n/2,o-r/2,n,r),!1}var jd=new class extends jh{constructor(){super(...arguments),this.type="rect",this.pathStr="M -0.5,0.25 L 0.5,0.25 L 0.5,-0.25,L -0.5,-0.25 Z"}draw(t,e,i,o){return ut(e)?Gd(t,e,i,o):Nd(t,e,i,o)}drawOffset(t,e,i,o,n){return ut(e)?Gd(t,e+2*n,i,o):Nd(t,[e[0]+2*n,e[1]+2*n],i,o)}};const Vd=new Fe;class Ud{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.pathStr="",this.type=t,ht(e)?this.svgCache=e:this.path=e,this.isSvg=i}drawOffset(t,e,i,o,n,r,s){return e=this.parseSize(e),this.isSvg?!!this.svgCache&&(this.svgCache.forEach((n=>{t.beginPath(),Li(n.path.commandList,t,i,o,e,e),s&&s(n.path,n.attribute)})),!1):(Li(this.path.commandList,t,i,o,e+n,e+n),!1)}draw(t,e,i,o,n,r){return e=this.parseSize(e),this.drawOffset(t,e,i,o,0,n,r)}parseSize(t){return ut(t)?t:Math.min(t[0],t[1])}bounds(t,e){if(t=this.parseSize(t),this.isSvg){if(!this.svgCache)return;return e.clear(),void this.svgCache.forEach((i=>{let{path:o}=i;Vd.x1=o.bounds.x1*t,Vd.y1=o.bounds.y1*t,Vd.x2=o.bounds.x2*t,Vd.y2=o.bounds.y2*t,e.union(Vd)}))}this.path.bounds&&(e.x1=this.path.bounds.x1*t,e.y1=this.path.bounds.y1*t,e.x2=this.path.bounds.x2*t,e.y2=this.path.bounds.y2*t)}}const $d={};[Uh,$h,Yh,qh,Bd,td,rd,ld,dd,ud,bd,yd,wd,Qh,_d,Td,Md,Pd,Hd,jd,Od,zd,Wd].forEach((t=>{$d[t.type]=t}));const Xd={arrowLeft:"M 0.25 -0.5 L -0.25 0 l 0.5 0.5",arrowRight:"M -0.25 -0.5 l 0.5 0.5 l -0.5 0.5",rectRound:"M 0.3 -0.5 C 0.41 -0.5 0.5 -0.41 0.5 -0.3 C 0.5 -0.3 0.5 0.3 0.5 0.3 C 0.5 0.41 0.41 0.5 0.3 0.5 C 0.3 0.5 -0.3 0.5 -0.3 0.5 C -0.41 0.5 -0.5 0.41 -0.5 0.3 C -0.5 0.3 -0.5 -0.3 -0.5 -0.3 C -0.5 -0.41 -0.41 -0.5 -0.3 -0.5 C -0.3 -0.5 0.3 -0.5 0.3 -0.5 Z",roundLine:"M 1.2392 -0.258 L -1.3432 -0.258 C -1.4784 -0.258 -1.588 -0.1436 -1.588 -0.002 c 0 0.1416 0.1096 0.256 0.2448 0.256 l 2.5824 0 c 0.1352 0 0.2448 -0.1144 0.2448 -0.256 C 1.484 -0.1436 1.3744 -0.258 1.2392 -0.258 z"},Yd=new Fe,Kd=["symbolType","size",...Rr];let qd=class t extends Er{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{symbolType:"circle"}),this.type="symbol",this.numberType=hs}getParsedPath(){return this.shouldUpdateShape()&&(this.doUpdateParsedPath(),this.clearUpdateShapeTag()),this._parsedPath}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{size:t}=this.attribute;return ht(t)?2===t.length&&t.every(this._validNumber):this._validNumber(t)}doUpdateParsedPath(){const e=this.getGraphicTheme();let{symbolType:i=e.symbolType}=this.attribute,o=$d[i];if(o)return this._parsedPath=o,o;if(o=t.userSymbolMap[i],o)return this._parsedPath=o,o;if(i=Xd[i]||i,!0===function(t){return t.startsWith("<svg")||t.startsWith("<?xml")}(i)){const e=new Vr,{svg:o}=e.parse(i);if(!o)return null;const n=ht(o.path)?o.path:[o.path];Yd.clear();const r=[];n.forEach((t=>{const e=(new go).fromString(t.d),i={};ps.forEach((e=>{t[e]&&(i[gs[e]]=t[e])})),r.push({path:e,attribute:i}),Yd.union(e.bounds)}));const s=Yd.width(),a=Yd.height(),l=1/le(s,a);return r.forEach((t=>t.path.transform(0,0,l,l))),this._parsedPath=new Ud(i,r,!0),t.userSymbolMap[i]=this._parsedPath,this._parsedPath}const n=(new go).fromString(i),r=n.bounds.width(),s=n.bounds.height(),a=1/le(r,s);return n.transform(0,0,a,a),this._parsedPath=new Ud(i,n),t.userSymbolMap[i]=this._parsedPath,this._parsedPath}getGraphicTheme(){return kn(this).symbol}updateAABBBounds(t,e,i,o){this.updatePathProxyAABBBounds(i)||(o?this.updateSymbolAABBBoundsImprecise(t,e,i):this.updateSymbolAABBBoundsAccurate(t,e,i));const{tb1:n,tb2:r}=zo.graphicService.updateTempAABBBounds(i);((t,e,i)=>{const{outerBorder:o,shadowBlur:n=e.shadowBlur,strokeBoundsBuffer:r=e.strokeBoundsBuffer}=t;if(o){const t=e.outerBorder,{distance:s=t.distance,lineWidth:a=t.lineWidth}=o;Ur(i,s+(n+a)/2,!0,r)}})(t,e,n),i.union(n),n.setValue(r.x1,r.y1,r.x2,r.y2);const{lineJoin:s=e.lineJoin}=t;return zo.graphicService.transformAABBBounds(t,i,e,"miter"===s,this),i}updateSymbolAABBBoundsImprecise(t,e,i){const{size:o=e.size}=t;if(ht(o))i.set(-o[0]/2,-o[1]/2,o[0]/2,o[1]/2);else{const t=o/2;i.set(-t,-t,t,t)}return i}updateSymbolAABBBoundsAccurate(t,e,i){const{size:o=e.size}=t;return this.getParsedPath().bounds(o,i),i}needUpdateTags(t){return super.needUpdateTags(t,Kd)}needUpdateTag(t){return super.needUpdateTag(t,Kd)}toCustomPath(){const t=this.getParsedPath(),e=this.attribute.size,i=ht(e)?e:[e,e];return t.path?(new go).fromCustomPath2D(t.path,0,0,i[0],i[1]):(new go).fromString(t.pathStr,0,0,i[0],i[1])}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}};function Zd(t){return new qd(t)}qd.userSymbolMap={},qd.NOWORK_ANIMATE_ATTR=Object.assign({symbolType:1},Pr);const Jd=["segments","points","curveType","curveTension",...Rr];let Qd=class t extends Er{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this.type="line",this.numberType=ns}isValid(){return super.isValid()&&this._isValid()}_isValid(){if(this.pathProxy)return!0;const{points:t,segments:e}=this.attribute;return e?0!==e.length:!(!t||t.length<=1)}_interpolate(t,e,i,o,n){"points"===t&&(n.points=dr(i,o,e))}getGraphicTheme(){return kn(this).line}updateAABBBounds(t,e,i){this.updatePathProxyAABBBounds(i)||(t.segments?this.updateLineAABBBoundsBySegments(t,e,i):this.updateLineAABBBoundsByPoints(t,e,i)),zo.graphicService.updateTempAABBBounds(i);const{lineJoin:o=e.lineJoin}=t;return zo.graphicService.transformAABBBounds(t,i,e,"miter"===o,this),i}updateLineAABBBoundsByPoints(t,e,i,o){const{points:n=e.points,connectedType:r}=t,s=i;return n.forEach((t=>{!1===t.defined&&"zero"!==r&&"connect"!==r||s.add(t.x,t.y)})),s}updateLineAABBBoundsBySegments(t,e,i,o){const{segments:n=e.segments,connectedType:r}=t,s=i;return n.forEach((t=>{t.points.forEach((t=>{!1===t.defined&&"zero"!==r&&"connect"!==r||s.add(t.x,t.y)}))})),s}needUpdateTags(t){return super.needUpdateTags(t,Jd)}needUpdateTag(t){return super.needUpdateTag(t,Jd)}toCustomPath(){const t=this.attribute,e=new go,i=t.segments,o=t=>{if(t&&t.length){let i=!0;t.forEach((t=>{!1!==t.defined&&(i?e.moveTo(t.x,t.y):e.lineTo(t.x,t.y),i=!1)}))}};return i&&i.length?i.forEach((t=>{o(t.points)})):t.points&&o(t.points),e}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}};function tc(t){return new Qd(t)}Qd.NOWORK_ANIMATE_ATTR=Object.assign({segments:1,curveType:1},Pr);const ec=["width","x1","y1","height","cornerRadius",...Rr];let ic=class t extends Er{constructor(t){super(t),this.type="rect",this.numberType=as}isValid(){return super.isValid()&&this._isValid()}_isValid(){return!0}getGraphicTheme(){return kn(this).rect}updateAABBBounds(t,e,i){if(!this.updatePathProxyAABBBounds(i)){let{width:e,height:o}=t;const{x1:n,y1:r,x:s,y:a}=t;e=null!=e?e:n-s,o=null!=o?o:r-a,(isFinite(e)||isFinite(o)||isFinite(s)||isFinite(a))&&i.set(0,0,e||0,o||0)}const{tb1:o,tb2:n}=zo.graphicService.updateTempAABBBounds(i);return Ph(t,e,o),i.union(o),o.setValue(n.x1,n.y1,n.x2,n.y2),zo.graphicService.transformAABBBounds(t,i,e,!1,this),i}needUpdateTags(t){return super.needUpdateTags(t,ec)}needUpdateTag(t){return super.needUpdateTag(t,ec)}toCustomPath(){const t=this.attribute,{x:e,y:i,width:o,height:n}=(t=>{if(!t)return{x:0,y:0,width:0,height:0};let e=it(t.width)?t.x1-t.x:t.width,i=it(t.height)?t.y1-t.y:t.height,o=0,n=0;return e<0?(o=e,e=-e):Number.isNaN(e)&&(e=0),i<0?(n=i,i=-i):Number.isNaN(i)&&(i=0),{x:o,y:n,width:e,height:i}})(t),r=new go;return r.moveTo(e,i),r.rect(e,i,o,n),r}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}};function oc(t){return new ic(t)}ic.NOWORK_ANIMATE_ATTR=Pr;class nc{constructor(t,e,i,o,n,r,s,a,l,h,d,c,u,g){this.left=t,this.top=e,this.width=i,this.height=o,this.actualHeight=0,this.bottom=e+o,this.right=t+i,this.ellipsis=n,this.wordBreak=r,this.verticalDirection=s,this.lines=[],this.globalAlign=a,this.globalBaseline=l,this.layoutDirection=h,this.directionKey=jo[this.layoutDirection],this.isWidthMax=d,this.isHeightMax=c,this.singleLine=u,g?(g.clear(),this.icons=g):this.icons=new Map}draw(t,e){const{width:i,height:o}=this.getActualSize(),n=this.isWidthMax?Math.min(this.width,i):this.width||i||0;let r=this.isHeightMax?Math.min(this.height,o):this.height||o||0;r=Math.min(r,o);let s=0;switch(this.globalBaseline){case"top":s=0;break;case"middle":s=-r/2;break;case"bottom":s=-r}let a=0;"right"===this.globalAlign||"end"===this.globalAlign?a=-n:"center"===this.globalAlign&&(a=-n/2);let l=this[this.directionKey.height];this.singleLine&&(l=this.lines[0].height+1);let h=!1;if("middle"===this.verticalDirection)if(this.actualHeight>=l&&0!==l)for(let i=0;i<this.lines.length;i++){const{top:o,height:n}=this.lines[i];if(o+n<this[this.directionKey.top]||o+n>this[this.directionKey.top]+l)return h;let r=!1;this.ellipsis&&this.lines[i+1]&&this.lines[i+1].top+this.lines[i+1].height>this[this.directionKey.top]+l&&(r=!0,h=!0),this.lines[i].draw(t,r,this.lines[i][this.directionKey.left]+a,this.lines[i][this.directionKey.top]+s,this.ellipsis,e)}else{const i=Math.floor((l-this.actualHeight)/2);"vertical"===this.layoutDirection?a+=i:s+=i;for(let i=0;i<this.lines.length;i++)this.lines[i].draw(t,!1,this.lines[i][this.directionKey.left]+a,this.lines[i][this.directionKey.top]+s,this.ellipsis,e)}else if("bottom"===this.verticalDirection&&"vertical"!==this.layoutDirection)for(let i=0;i<this.lines.length;i++){const{top:o,height:n}=this.lines[i],r=l-this.lines[i].top-this.lines[i].height;if(0===l)this.lines[i].draw(t,!1,a,r+s,this.ellipsis,e);else{if(r+n>this[this.directionKey.top]+l||r<this[this.directionKey.top])return h;{let o=!1;this.ellipsis&&this.lines[i+1]&&r-this.lines[i+1].height<this[this.directionKey.top]&&(o=!0,h=!0),this.lines[i].draw(t,o,a,r+s,this.ellipsis,e)}}}else{"bottom"===this.verticalDirection&&"vertical"===this.layoutDirection&&this.singleLine&&this.isWidthMax&&(a+=this.lines[0].height+1);for(let i=0;i<this.lines.length;i++){"bottom"===this.verticalDirection&&"vertical"===this.layoutDirection&&(a-=this.lines[i].height+this.lines[i].top);const{top:o,height:n}=this.lines[i];if(0===l)this.lines[i].draw(t,!1,this.lines[i][this.directionKey.left]+a,this.lines[i][this.directionKey.top]+s,this.ellipsis,e);else{if(o+n<this[this.directionKey.top]||o+n>this[this.directionKey.top]+l)return h;{let o=!1;this.ellipsis&&this.lines[i+1]&&this.lines[i+1].top+this.lines[i+1].height>this[this.directionKey.top]+l&&(o=!0,h=!0),this.lines[i].draw(t,o,this.lines[i][this.directionKey.left]+a,this.lines[i][this.directionKey.top]+s,this.ellipsis,e)}}}}return h}getActualSize(){return this.ellipsis?this.getActualSizeWidthEllipsis():this.getRawActualSize()}getRawActualSize(){let t=0,e=0;for(let i=0;i<this.lines.length;i++){const o=this.lines[i];o.actualWidth>t&&(t=o.actualWidth),e+=o.height}return{width:"vertical"===this.layoutDirection?e:t,height:"vertical"===this.layoutDirection?t:e}}getActualSizeWidthEllipsis(){let t=0,e=0;const{width:i,height:o}=this.getRawActualSize();this.width,this.height;let n=this[this.directionKey.height];if(this.singleLine&&(n=this.lines[0].height+1),"middle"===this.verticalDirection)if(this.actualHeight>=n&&0!==n)for(let i=0;i<this.lines.length;i++){const{top:o,height:r}=this.lines[i];if(o+r<this[this.directionKey.top]||o+r>this[this.directionKey.top]+n);else if(this.ellipsis&&this.lines[i+1]&&this.lines[i+1].top+this.lines[i+1].height>this[this.directionKey.top]+n){const o=!0===this.ellipsis?"...":this.ellipsis||"",n=this.lines[i].getWidthWithEllips(o);n>t&&(t=n),e+=this.lines[i].height}else this.lines[i].actualWidth>t&&(t=this.lines[i].actualWidth),e+=this.lines[i].height}else{Math.floor((n-this.actualHeight)/2);for(let i=0;i<this.lines.length;i++)this.lines[i].actualWidth>t&&(t=this.lines[i].actualWidth),e+=this.lines[i].height}else if("bottom"===this.verticalDirection)for(let i=0;i<this.lines.length;i++){const{top:o,height:r}=this.lines[i],s=n-this.lines[i].top-this.lines[i].height;if(0===n)this.lines[i].actualWidth>t&&(t=this.lines[i].actualWidth),e+=this.lines[i].height;else if(s+r>this[this.directionKey.top]+n||s<this[this.directionKey.top]);else if(this.ellipsis&&this.lines[i+1]&&s-this.lines[i+1].height<this[this.directionKey.top]){const o=!0===this.ellipsis?"...":this.ellipsis||"",n=this.lines[i].getWidthWithEllips(o);n>t&&(t=n),e+=this.lines[i].height}else this.lines[i].actualWidth>t&&(t=this.lines[i].actualWidth),e+=this.lines[i].height}else for(let i=0;i<this.lines.length;i++){const{top:o,height:r}=this.lines[i];if(0===n)this.lines[i].actualWidth>t&&(t=this.lines[i].actualWidth),e+=this.lines[i].height;else if(o+r<this[this.directionKey.top]||o+r>this[this.directionKey.top]+n);else if(this.ellipsis&&this.lines[i+1]&&this.lines[i+1].top+this.lines[i+1].height>this[this.directionKey.top]+n){const o=!0===this.ellipsis?"...":this.ellipsis||"",n=this.lines[i].getWidthWithEllips(o);n>t&&(t=n),e+=this.lines[i].height}else this.lines[i].actualWidth>t&&(t=this.lines[i].actualWidth),e+=this.lines[i].height}return{width:"vertical"===this.layoutDirection?e:t,height:"vertical"===this.layoutDirection?t:e}}}class rc{constructor(t,e,i){this.fontSize=i.fontSize||16,this.textBaseline=i.textBaseline||"alphabetic";const o=pr(i.lineHeight,this.fontSize);this.lineHeight="number"==typeof o?o>this.fontSize?o:this.fontSize:Math.floor(1.2*this.fontSize),this.height=this.lineHeight;const{ascent:n,height:r,descent:s,width:a}=Qo(t,i);let l=0,h=0,d=0;this.height>r&&(l=(this.height-r)/2,h=Math.ceil(l),d=Math.floor(l)),"top"===this.textBaseline?(this.ascent=l,this.descent=r-l):"bottom"===this.textBaseline?(this.ascent=r-l,this.descent=l):"middle"===this.textBaseline?(this.ascent=this.height/2,this.descent=this.height/2):(this.ascent=n+h,this.descent=s+d),this.length=t.length,this.width=a||0,this.text=t||"",this.newLine=e||!1,this.character=i,this.left=0,this.top=0,this.ellipsis="normal",this.ellipsisWidth=0,this.ellipsisOtherParagraphWidth=0,"vertical"===i.direction&&(this.direction=i.direction,this.widthOrigin=this.width,this.heightOrigin=this.height,this.width=this.heightOrigin,this.height=this.widthOrigin,this.lineHeight=this.height),this.ellipsisStr="..."}updateWidth(){const{width:t}=Qo(this.text,this.character);this.width=t,"vertical"===this.direction&&(this.widthOrigin=this.width,this.width=this.heightOrigin,this.height=this.widthOrigin)}draw(t,e,i,o,n){let r=this.text,s=this.left+i;e+=this.top;let a=this.direction;if(this.verticalEllipsis)r=this.ellipsisStr,a="vertical",e-=this.ellipsisWidth/2;else{if("hide"===this.ellipsis)return;if("add"===this.ellipsis)r+=this.ellipsisStr,"right"!==n&&"end"!==n||(s-=this.ellipsisWidth);else if("replace"===this.ellipsis){const t=qo(r,("vertical"===a?this.height:this.width)-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,r.length-1);if(r=r.slice(0,t),r+=this.ellipsisStr,"right"===n||"end"===n){const{width:e}=Qo(this.text.slice(t),this.character);"vertical"===a||(s-=this.ellipsisWidth-e)}}}switch(this.character.script){case"super":e-=this.ascent*(1/3);break;case"sub":e+=this.descent/2}"vertical"===a&&(t.save(),t.rotateAbout(Math.PI/2,s,e),t.translate(-this.heightOrigin||-this.lineHeight/2,-this.descent/2),t.translate(s,e),s=0,e=0);const{lineWidth:l=1}=this.character;this.character.stroke&&l&&t.strokeText(r,s,e),this.character.fill&&t.fillText(r,s,e),this.character.fill&&("boolean"==typeof this.character.lineThrough||"boolean"==typeof this.character.underline?(this.character.underline&&t.fillRect(s,1+e,this.widthOrigin||this.width,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1),this.character.lineThrough&&t.fillRect(s,1+e-this.ascent/2,this.widthOrigin||this.width,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)):"underline"===this.character.textDecoration?t.fillRect(s,1+e,this.widthOrigin||this.width,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1):"line-through"===this.character.textDecoration&&t.fillRect(s,1+e-this.ascent/2,this.widthOrigin||this.width,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)),"vertical"===a&&t.restore()}getWidthWithEllips(t){let e=this.text;const i="vertical"===t?this.height:this.width;if("hide"===this.ellipsis)return i;if("add"===this.ellipsis)return i+this.ellipsisWidth;if("replace"===this.ellipsis){const t=qo(e,i-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,e.length-1);e=e.slice(0,t),e+=this.ellipsisStr;const{width:o}=Qo(this.text.slice(t),this.character);return i+this.ellipsisWidth-o}return i}}const sc=["width","height","image",...Rr];let ac=class t extends Er{constructor(t){super(t),this.type="image",this.numberType=os,this.loadImage(this.attribute.image)}get width(){var t;return null!==(t=this.attribute.width)&&void 0!==t?t:0}set width(t){this.attribute.width===t&&(this.attribute.width=t,this.addUpdateShapeAndBoundsTag())}get height(){var t;return null!==(t=this.attribute.height)&&void 0!==t?t:0}set height(t){this.attribute.height===t&&(this.attribute.height=t,this.addUpdateShapeAndBoundsTag())}get repeatX(){var t;return null!==(t=this.attribute.repeatX)&&void 0!==t?t:"no-repeat"}set repeatX(t){this.attribute.repeatX===t&&(this.attribute.repeatX=t)}get repeatY(){var t;return null!==(t=this.attribute.repeatY)&&void 0!==t?t:"no-repeat"}set repeatY(t){this.attribute.repeatY===t&&(this.attribute.repeatY=t)}get image(){return this.attribute.image}set image(t){t!==this.attribute.image&&(this.attribute.image=t,this.loadImage(this.attribute.image))}imageLoadSuccess(t,e,i){super.imageLoadSuccess(t,e,(()=>{this.successCallback&&this.successCallback()}))}imageLoadFail(t,e){super.imageLoadFail(t,(()=>{this.failCallback&&this.failCallback()}))}setAttributes(t,e,i){return t.image&&this.loadImage(t.image),super.setAttributes(t,e,i)}setAttribute(t,e,i,o){return"image"===t&&this.loadImage(e),super.setAttribute(t,e,i,o)}getGraphicTheme(){return kn(this).image}updateAABBBounds(t,e,i){if(!this.updatePathProxyAABBBounds(i)){const{width:o=e.width,height:n=e.height}=t;i.set(0,0,o,n)}const{tb1:o,tb2:n}=zo.graphicService.updateTempAABBBounds(i);return Ph(t,e,o),i.union(o),o.setValue(n.x1,n.y1,n.x2,n.y2),zo.graphicService.transformAABBBounds(t,i,e,!1,this),i}getDefaultAttribute(t){return Oo[t]}needUpdateTags(t){return super.needUpdateTags(t,sc)}needUpdateTag(t){return super.needUpdateTag(t,sc)}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}};function lc(t){return new ac(t)}ac.NOWORK_ANIMATE_ATTR=Object.assign({image:1,repeatX:1,repeatY:1},Pr);class hc extends ac{constructor(t){if(super(t),this._x=0,this._y=0,this._hovered=!1,this._marginArray=[0,0,0,0],"always"===t.backgroundShowMode&&(this._hovered=!0),t.margin){const e=rr(t.margin);this._marginArray="number"==typeof e?[e,e,e,e]:e}this.onBeforeAttributeUpdate=(t,e,i)=>{if(ht(i)&&-1!==i.indexOf("margin")||"margin"===i)if(e.margin){const t=rr(e.margin);this._marginArray="number"==typeof t?[t,t,t,t]:t}else this._marginArray=[0,0,0,0]}}get width(){var t;return(null!==(t=this.attribute.width)&&void 0!==t?t:0)+this._marginArray[1]+this._marginArray[3]}get height(){var t;return(null!==(t=this.attribute.height)&&void 0!==t?t:0)+this._marginArray[0]+this._marginArray[2]}tryUpdateAABBBounds(){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;this.doUpdateAABBBounds();const{width:t=Oo.width,height:e=Oo.height}=this.attribute,{backgroundWidth:i=t,backgroundHeight:o=e}=this.attribute,n=(i-t)/2,r=(o-e)/2;return this._AABBBounds.expand([0,2*n,2*r,0]),this._AABBBounds}setHoverState(t){"hover"===this.attribute.backgroundShowMode&&this._hovered!==t&&(this._hovered=t)}}class dc{constructor(t,e,i,o,n,r,s,a){this.left=t,this.width=e,this.baseline=i,this.ascent=o,this.descent=n,this.top=i-o,this.paragraphs=r.map((t=>t)),this.textAlign=(this.paragraphs[0]instanceof hc?this.paragraphs[0].attribute.textAlign:this.paragraphs[0].character.textAlign)||"left",this.direction=s,this.directionKey=jo[this.direction],this.actualWidth=0;let l=0;this.paragraphs.forEach(((t,e)=>{if(0===e&&t instanceof rc){const e=Yo.exec(t.text);0!==(null==e?void 0:e.index)&&(t.text=t.text.slice(null==e?void 0:e.index),t.updateWidth())}this.actualWidth+=t[this.directionKey.width],l=Math.max(t[this.directionKey.height],l)})),this.height=l,this.blankWidth=a?0:this.width-this.actualWidth,this.calcOffset(e,a)}calcOffset(t,e){const i=this.directionKey,o=this.height;let n=this.left,r=0;this.actualWidth<t&&!e&&("right"===this.textAlign||"end"===this.textAlign?n=t-this.actualWidth:"center"===this.textAlign?n=(t-this.actualWidth)/2:"justify"===this.textAlign&&(this.paragraphs.length<2?n=(t-this.actualWidth)/2:r=(t-this.actualWidth)/(this.paragraphs.length-1))),this.paragraphs.map((function(t){t instanceof hc?(t["_"+i.x]=n,n+=t[i.width]+r,t["_"+i.y]="top"===t.attribute.textBaseline?0:"bottom"===t.attribute.textBaseline?o-t.height:(o-t.height)/2):(t[i.left]=n,n+=t[i.width]+r)}))}draw(t,e,i,o,n,r){if(n&&(e||this.paragraphs.some((t=>t.overflow)))){let t=!0,i=!1;for(let e=this.paragraphs.length-1;e>=0;e--){const o=this.paragraphs[e];if(o.overflow)t=t&&""===o.text;else if(t){i=!0;break}}let o=0;if(!i)for(let t=this.paragraphs.length-1;t>=0;t--){const i=this.paragraphs[t];if(i.overflow){if(""===i.text)break;continue}if(i instanceof hc)break;if("vertical"===this.direction&&"vertical"!==i.direction){i.verticalEllipsis=!0;break}const r=!0===n?"...":n||"";i.ellipsisStr=r;const{width:s}=Qo(r,i.character),a=s||0;if(a<=this.blankWidth+o){e&&(i.ellipsis="add");break}if(a<=this.blankWidth+o+i.width){i.ellipsis="replace",i.ellipsisWidth=a,i.ellipsisOtherParagraphWidth=this.blankWidth+o;break}i.ellipsis="hide",o+=i.width}}this.paragraphs.forEach(((e,n)=>{if(e instanceof hc)return e.setAttributes({x:i+e._x,y:o+e._y}),void r(e,t,i+e._x,o+e._y,this.ascent);const s={x1:this.left,y1:this.top,x2:this.left+this.actualWidth,y2:this.top+this.height};(function(t,e){const i=e&&e.stroke||Uo;if(!i)return void(t.globalAlpha=0);const{strokeOpacity:o=1,opacity:n=1}=e;t.globalAlpha=o*n,t.lineWidth=e&&"number"==typeof e.lineWidth?e.lineWidth:1,t.strokeStyle=i,Ko(t,e)})(t,e.character),function(t,e,i){const o=e&&e.fill||Vo;if(!o)return void(t.globalAlpha=0);const{fillOpacity:n=1,opacity:r=1}=e;t.globalAlpha=n*r,t.fillStyle=i?Go(t,o,{AABBBounds:i}):o,Ko(t,e)}(t,e.character,s),e.draw(t,o+this.ascent,i,0===n,this.textAlign)}))}getWidthWithEllips(t){let e=0;for(let i=this.paragraphs.length-1;i>=0;i--){const o=this.paragraphs[i];if(o instanceof hc)break;const{width:n}=Qo(t,o.character),r=n||0;if(r<=this.blankWidth+e){o.ellipsis="add",o.ellipsisWidth=r;break}if(r<=this.blankWidth+e+o.width){o.ellipsis="replace",o.ellipsisWidth=r,o.ellipsisOtherParagraphWidth=this.blankWidth+e;break}o.ellipsis="hide",e+=o.width}let i=0;return this.paragraphs.forEach(((t,e)=>{i+=t instanceof hc?t.width:t.getWidthWithEllips(this.direction)})),i}}class cc{constructor(t){this.frame=t,this.width=this.frame.width,this.height=this.frame.height,this.lineWidth=0,this.y=this.frame.top,this.maxAscent=0,this.maxDescent=0,this.maxAscentForBlank=0,this.maxDescentForBlank=0,this.lineBuffer=[],this.direction=t.layoutDirection,this.directionKey=jo[this.direction]}store(t){if(t instanceof hc){this.frame.icons.set(t.richtextId,t),this.lineBuffer.push(t),this.lineWidth+=t[this.directionKey.width];let e=0,i=0;"top"===t.attribute.textBaseline?(e=0,i=t.height):"bottom"===t.attribute.textBaseline?(e=t.height,i=0):(e=t.height/2,i=t.height/2),this.maxAscent=Math.max(this.maxAscent,e),this.maxDescent=Math.max(this.maxDescent,i)}else this.lineBuffer.push(t),0!==t.text.length?(this.lineWidth+=t[this.directionKey.width],this.maxAscent=Math.max(this.maxAscent,t.ascent),this.maxDescent=Math.max(this.maxDescent,t.descent)):(this.maxAscentForBlank=Math.max(this.maxAscentForBlank,t.ascent),this.maxDescentForBlank=Math.max(this.maxDescentForBlank,t.descent))}send(){if(0===this.lineBuffer.length)return;const t=0===this.maxAscent?this.maxAscentForBlank:this.maxAscent,e=0===this.maxDescent?this.maxDescentForBlank:this.maxDescent,i=new dc(this.frame.left,this[this.directionKey.width],this.y+t,t,e,this.lineBuffer,this.direction,"horizontal"===this.direction?this.frame.isWidthMax:this.frame.isHeightMax);this.frame.lines.push(i),this.frame.actualHeight+=i.height,this.y+=i.height,this.lineBuffer.length=0,this.lineWidth=this.maxAscent=this.maxDescent=this.maxAscentForBlank=this.maxDescentForBlank=0}deal(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t instanceof hc?"horizontal"===this.direction&&0===this.width||"vertical"===this.direction&&0===this.height||this.lineWidth+t[this.directionKey.width]<=this[this.directionKey.width]?this.store(t):0===this.lineBuffer.length?(this.store(t),this.send()):(this.send(),this.deal(t)):"number"!=typeof this.width||this.width<0||(t.newLine&&this.send(),0!==t.text.length&&("horizontal"===this.direction&&0===this.width||"vertical"===this.direction&&0===this.height||this.lineWidth+t[this.directionKey.width]<=this[this.directionKey.width]?this.store(t):this.lineWidth===this[this.directionKey.width]?(this.send(),this.deal(t)):this.cut(t,e)))}cut(t,e){const i=this[this.directionKey.width]-this.lineWidth||0,o=Math.ceil(i/t[this.directionKey.width]*t.length)||0,n=qo(t.text,i,t.character,o,"break-word"===this.frame.wordBreak);if(0!==n){const[i,o]=function(t,e){const i=t.text.slice(0,e),o=t.text.slice(e);return[new rc(i,t.newLine,t.character),new rc(o,!0,t.character)]}(t,n);this.store(i),e?this.send():this.deal(o)}else 0!==this.lineBuffer.length&&(this.send(),this.deal(t))}}const uc=["width","height","ellipsis","wordBreak","verticalDirection","maxHeight","maxWidth","textAlign","textBaseline","textConfig","layoutDirection","fill","stroke","fontSize","fontFamily","fontStyle","fontWeight","lineWidth","opacity","fillOpacity","strokeOpacity",...Rr];class gc extends Er{constructor(t){super(t),this.type="richtext",this._currentHoverIcon=null,this.numberType=ls,this.onBeforeAttributeUpdate=(t,e,i)=>{for(const i in t)if("hoverIconId"===i){if(t[i]===e[i])continue;const o=this._frameCache.icons.get(t[i]);this.updateHoverIconState(o)}}}get width(){var t;return null!==(t=this.attribute.width)&&void 0!==t?t:Fo.width}set width(t){this.attribute.width!==t&&(this.attribute.width=t,this.addUpdateShapeAndBoundsTag())}get height(){var t;return null!==(t=this.attribute.height)&&void 0!==t?t:Fo.height}set height(t){this.attribute.height!==t&&(this.attribute.height=t,this.addUpdateShapeAndBoundsTag())}get maxWidth(){return this.attribute.maxWidth}set maxWidth(t){this.attribute.maxWidth!==t&&(this.attribute.maxWidth=t,this.addUpdateShapeAndBoundsTag())}get maxHeight(){return this.attribute.maxHeight}set maxHeight(t){this.attribute.maxHeight!==t&&(this.attribute.maxHeight=t,this.addUpdateShapeAndBoundsTag())}get ellipsis(){var t;return null!==(t=this.attribute.ellipsis)&&void 0!==t?t:Fo.ellipsis}set ellipsis(t){this.attribute.ellipsis!==t&&(this.attribute.ellipsis=t,this.addUpdateShapeAndBoundsTag())}get wordBreak(){var t;return null!==(t=this.attribute.wordBreak)&&void 0!==t?t:Fo.wordBreak}set wordBreak(t){this.attribute.wordBreak!==t&&(this.attribute.wordBreak=t,this.addUpdateShapeAndBoundsTag())}get verticalDirection(){var t;return null!==(t=this.attribute.verticalDirection)&&void 0!==t?t:Fo.verticalDirection}set verticalDirection(t){this.attribute.verticalDirection!==t&&(this.attribute.verticalDirection=t,this.addUpdateShapeAndBoundsTag())}get textAlign(){var t;return null!==(t=this.attribute.textAlign)&&void 0!==t?t:Fo.textAlign}set textAlign(t){this.attribute.textAlign!==t&&(this.attribute.textAlign=t,this.addUpdateShapeAndBoundsTag())}get textBaseline(){var t;return null!==(t=this.attribute.textBaseline)&&void 0!==t?t:Fo.textBaseline}set textBaseline(t){this.attribute.textBaseline!==t&&(this.attribute.textBaseline=t,this.addUpdateShapeAndBoundsTag())}get textConfig(){var t;return null!==(t=this.attribute.textConfig)&&void 0!==t?t:Fo.textConfig}set textConfig(t){this.attribute.textConfig=t,this.addUpdateShapeAndBoundsTag()}getGraphicTheme(){return kn(this).richtext}updateAABBBounds(t,e,i){const{width:o=e.width,height:n=e.height,maxWidth:r=e.maxWidth,maxHeight:s=e.maxHeight,textAlign:a=e.textAlign,textBaseline:l=e.textBaseline}=t;if(o>0&&n>0)i.set(0,0,o,n);else{const t=this.getFrameCache(),{width:e,height:a}=t.getActualSize();let l=o||e||0,h=n||a||0;h="number"==typeof s&&h>s?s:h||0,l="number"==typeof r&&l>r?r:l||0,i.set(0,0,l,h)}let h=0;switch(l){case"top":h=0;break;case"middle":h=-i.height()/2;break;case"bottom":h=-i.height()}let d=0;switch(a){case"left":d=0;break;case"center":d=-i.width()/2;break;case"right":d=-i.width()}return i.translate(d,h),zo.graphicService.updateTempAABBBounds(i),null==t.forceBoundsHeight&&null==t.forceBoundsWidth||zo.graphicService.updateHTMLTextAABBBounds(t,e,i),zo.graphicService.transformAABBBounds(t,i,e,!1,this),i}needUpdateTags(t){return super.needUpdateTags(t,uc)}needUpdateTag(t){return super.needUpdateTag(t,uc)}getFrameCache(){return this.shouldUpdateShape()&&(this.doUpdateFrameCache(),this.clearUpdateShapeTag()),this._frameCache}get cliped(){const t=this.getFrameCache();if(t.actualHeight>t.height)return!0;const{disableAutoWrapLine:e}=this.attribute;if(e)for(let e=0;e<t.lines.length;e++){const i=t.lines[e];for(let t=0;t<i.paragraphs.length;t++){const e=i.paragraphs[t];if(e.overflow&&""!==e.text)return!0}}return!1}combinedStyleToCharacter(t){const{fill:e,stroke:i,fontSize:o,fontFamily:n,fontStyle:r,fontWeight:s,lineWidth:a,opacity:l,fillOpacity:h,strokeOpacity:d}=this.attribute;return Object.assign({fill:e,stroke:i,fontSize:o,fontFamily:n,fontStyle:r,fontWeight:s,lineWidth:a,opacity:l,fillOpacity:h,strokeOpacity:d},t)}doUpdateFrameCache(t){var e;const{textConfig:i=[],maxWidth:o,maxHeight:n,width:r,height:s,ellipsis:a,wordBreak:l,verticalDirection:h,textAlign:d,textBaseline:c,layoutDirection:u,singleLine:g,disableAutoWrapLine:p}=this.attribute,f=[],v=null!=t?t:i;for(let t=0;t<v.length;t++)if("image"in v[t]){const e=this.combinedStyleToCharacter(v[t]);e.lineWidth=void 0;const i=e.id&&this._frameCache&&this._frameCache.icons&&this._frameCache.icons.get(e.id);if(i)f.push(i);else{const t=new hc(e);t.successCallback=()=>{var t;this.addUpdateBoundTag(),null===(t=this.stage)||void 0===t||t.renderNextFrame()},t.richtextId=e.id,f.push(t)}}else{const e=this.combinedStyleToCharacter(v[t]);if(ut(e.text)&&(e.text=`${e.text}`),e.text&&e.text.includes("\n")){const t=e.text.split("\n");for(let i=0;i<t.length;i++)f.push(new rc(t[i],0!==i,e))}else e.text&&f.push(new rc(e.text,!1,e))}const b="number"==typeof o&&Number.isFinite(o)&&o>0,m="number"==typeof n&&Number.isFinite(n)&&n>0,y="number"==typeof r&&Number.isFinite(r)&&r>0&&(!b||r<=o),C="number"==typeof s&&Number.isFinite(s)&&s>0&&(!m||s<=n),w=new nc(0,0,(y?r:b?o:0)||0,(C?s:m?n:0)||0,a,l,h,d,c,u||"horizontal",!y&&b,!C&&m,g||!1,null===(e=this._frameCache)||void 0===e?void 0:e.icons),x=new cc(w);if(p){let t=0,e=!1;for(let i=0;i<f.length;i++){const o=f[i];e?(o.overflow=!0,o.left=1/0,o.top=1/0,!o.newLine&&w.lines[w.lines.length-1].paragraphs.push(o)):x.deal(o,!0),w.lines.length!==t&&(t=w.lines.length,x.lineBuffer.length=0,o.overflow=!0,o.left=1e3,o.top=1e3,w.lines[w.lines.length-1].paragraphs.push(o),e=!0),o.newLine&&(e=!1,x.lineWidth=0),x.send()}}else for(let t=0;t<f.length;t++)x.deal(f[t]);if(x.send(),!("horizontal"===w.layoutDirection?y:C)){const t=w.getActualSizeWidthEllipsis();let e="horizontal"===w.layoutDirection?t.width:t.height;("horizontal"===w.layoutDirection?b:m)&&(e=Math.min(e,"horizontal"===w.layoutDirection?o:n)),w.lines.forEach((function(t){t.calcOffset(e,!1)}))}this._frameCache=w}clone(){return new gc(Object.assign({},this.attribute))}setStage(t,e){super.setStage(t,e),this.getFrameCache().icons.forEach((i=>{i.setStage(t,e)}))}bindIconEvent(){this.addEventListener("pointermove",(t=>{const e=this.pickIcon(t.global);e&&e===this._currentHoverIcon||(e?this.setAttribute("hoverIconId",e.richtextId):!e&&this._currentHoverIcon&&this.setAttribute("hoverIconId",void 0))})),this.addEventListener("pointerleave",(t=>{this._currentHoverIcon&&this.setAttribute("hoverIconId",void 0)}))}updateHoverIconState(t){var e,i,o,n,r;t?(null===(e=this._currentHoverIcon)||void 0===e||e.setHoverState(!1),this._currentHoverIcon=t,this._currentHoverIcon.setHoverState(!0),null===(i=this.stage)||void 0===i||i.setCursor(t.attribute.cursor),null===(o=this.stage)||void 0===o||o.renderNextFrame()):(this._currentHoverIcon.setHoverState(!1),this._currentHoverIcon=null,null===(n=this.stage)||void 0===n||n.setCursor(),null===(r=this.stage)||void 0===r||r.renderNextFrame())}pickIcon(t){const e=this.getFrameCache(),{e:i,f:o}=this.globalTransMatrix;let n;return e.icons.forEach(((e,r)=>{var s,a;const l=e.AABBBounds.clone();l.translate(e._marginArray[3],e._marginArray[0]),l.containsPoint({x:t.x-i,y:t.y-o})&&(n=e,n.globalX=(null!==(s=n.attribute.x)&&void 0!==s?s:0)+i+e._marginArray[3],n.globalY=(null!==(a=n.attribute.y)&&void 0!==a?a:0)+o+e._marginArray[0])})),n}getNoWorkAnimateAttr(){return gc.NOWORK_ANIMATE_ATTR}}function pc(t){return new gc(t)}gc.NOWORK_ANIMATE_ATTR=Object.assign({ellipsis:1,wordBreak:1,verticalDirection:1,textAlign:1,textBaseline:1,textConfig:1,layoutDirection:1},Pr);const fc=["path","customPath",...Rr];class vc extends Er{constructor(t){super(t),this.type="path",this.numberType=rs}get pathShape(){return this.tryUpdateAABBBounds(),this.getParsedPathShape()}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{path:t}=this.attribute;return null!=t&&""!==t}getParsedPathShape(){const t=this.getGraphicTheme();if(!this.valid)return t.path;const e=this.attribute;return e.path instanceof go?e.path:(it(this.cache)&&this.doUpdatePathShape(),this.cache instanceof go?this.cache:t.path)}getGraphicTheme(){return kn(this).path}updateAABBBounds(t,e,i){if(!this.updatePathProxyAABBBounds(i)){const t=this.getParsedPathShape();i.union(t.getBounds())}const{tb1:o,tb2:n}=zo.graphicService.updateTempAABBBounds(i);Ph(t,e,o),i.union(o),o.setValue(n.x1,n.y1,n.x2,n.y2);const{lineJoin:r=e.lineJoin}=t;return zo.graphicService.transformAABBBounds(t,i,e,"miter"===r,this),i}doUpdateAABBBounds(t){return this.doUpdatePathShape(),super.doUpdateAABBBounds(t)}doUpdatePathShape(){const t=this.attribute;lt(t.path,!0)?this.cache=(new go).fromString(t.path):t.customPath&&(this.cache=new go,t.customPath(this.cache,this))}needUpdateTags(t){return super.needUpdateTags(t,fc)}needUpdateTag(t){return super.needUpdateTag(t,fc)}toCustomPath(){return(new go).fromCustomPath2D(this.getParsedPathShape(),0,0)}clone(){return new vc(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return vc.NOWORK_ANIMATE_ATTR}}function bc(t){return new vc(t)}vc.NOWORK_ANIMATE_ATTR=Object.assign({path:1,customPath:1},Pr);const mc=["segments","points","curveType","curveTension",...Rr];class yc extends Er{constructor(t){super(t),this.type="area",this.numberType=ts}isValid(){return super.isValid()&&this._isValid()}_isValid(){if(this.pathProxy)return!0;const{points:t,segments:e}=this.attribute;return e?0!==e.length:!!t&&0!==t.length}getGraphicTheme(){return kn(this).area}updateAABBBounds(t,e,i){this.updatePathProxyAABBBounds(i)||(t.segments?this.updateAreaAABBBoundsBySegments(t,e,i):this.updateAreaAABBBoundsByPoints(t,e,i)),zo.graphicService.updateTempAABBBounds(i);const{lineJoin:o=e.lineJoin}=t;return zo.graphicService.transformAABBBounds(t,i,e,"miter"===o,this),i}updateAreaAABBBoundsByPoints(t,e,i,o){const{points:n=e.points}=t,r=i;return n.forEach((t=>{var e,i;r.add(t.x,t.y),r.add(null!==(e=t.x1)&&void 0!==e?e:t.x,null!==(i=t.y1)&&void 0!==i?i:t.y)})),r}updateAreaAABBBoundsBySegments(t,e,i,o){const{segments:n=e.segments}=t,r=i;return n.forEach((t=>{t.points.forEach((t=>{var e,i;r.add(t.x,t.y),r.add(null!==(e=t.x1)&&void 0!==e?e:t.x,null!==(i=t.y1)&&void 0!==i?i:t.y)}))})),r}_interpolate(t,e,i,o,n){"points"===t&&(n.points=dr(i,o,e))}needUpdateTags(t){return super.needUpdateTags(t,mc)}needUpdateTag(t){return super.needUpdateTag(t,mc)}toCustomPath(){const t=new go,e=this.attribute,i=e.segments,o=e=>{if(e&&e.length){let i=!0;const o=[];if(e.forEach((e=>{var n,r;!1!==e.defined&&(i?t.moveTo(e.x,e.y):t.lineTo(e.x,e.y),o.push({x:null!==(n=e.x1)&&void 0!==n?n:e.x,y:null!==(r=e.y1)&&void 0!==r?r:e.y}),i=!1)})),o.length){for(let e=o.length-1;e>=0;e--)t.lineTo(o[e].x,o[e].y);t.closePath()}}};return e.points?o(e.points):i&&i.length&&i.forEach((t=>{o(t.points)})),t}clone(){return new yc(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return yc.NOWORK_ANIMATE_ATTR}}yc.NOWORK_ANIMATE_ATTR=Object.assign({segments:1,curveType:1},Pr);const Cc=["innerRadius","outerRadius","startAngle","endAngle","cornerRadius","padAngle","padRadius","cap",...Rr];let wc=class t extends Er{constructor(t){super(t),this.type="arc",this.numberType=Jr}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{startAngle:t,endAngle:e,outerRadius:i,innerRadius:o}=this.attribute;return this._validNumber(t)&&this._validNumber(e)&&this._validNumber(i)&&this._validNumber(o)}getParsedCornerRadius(){const t=this.getGraphicTheme(),{cornerRadius:e=t.cornerRadius,innerPadding:i=t.innerPadding,outerPadding:o=t.outerPadding}=this.attribute;let{outerRadius:n=t.outerRadius,innerRadius:r=t.innerRadius}=this.attribute;if(n+=o,r-=i,0===e||"0%"===e)return 0;const s=Math.abs(n-r),a=t=>Math.min(ut(t,!0)?t:s*parseFloat(t)/100,s/2);if(ht(e)){const t=e.map((t=>a(t)||0));return 0===t.length?[t[0],t[0],t[0],t[0]]:2===t.length?[t[0],t[1],t[0],t[1]]:(3===t.length&&t.push(0),t)}return a(e)}getParsedAngle(){const t=this.getGraphicTheme();let{startAngle:e=t.startAngle,endAngle:i=t.endAngle}=this.attribute;const{cap:o=t.cap}=this.attribute,n=i-e>=0?1:-1,r=i-e;if(e=me(e),i=e+r,o&&re(r)<ne-te){let r=1,s=1;o.length&&(r=Number(o[0]),s=Number(o[1]));let{outerRadius:a=t.outerRadius,innerRadius:l=t.innerRadius}=this.attribute;const{outerPadding:h=t.outerPadding,innerPadding:d=t.innerPadding}=this.attribute;a+=h,l-=d;const c=Math.abs(a-l)/2,u=c/a;if(c>te&&a>te)return{startAngle:e-n*u*r,endAngle:i+n*u*s,sc:n*u*r,ec:n*u*s}}return{startAngle:e,endAngle:i}}getParsePadAngle(t,e){const i=this.getGraphicTheme(),{innerPadding:o=i.innerPadding,outerPadding:n=i.outerPadding,padAngle:r=i.padAngle}=this.attribute;let{outerRadius:s=i.outerRadius,innerRadius:a=i.innerRadius}=this.attribute;s+=n,a-=o;const{padRadius:l=ce(s*s+a*a)}=this.attribute,h=re(e-t);let d=t,c=e,u=t,g=e;const p=r/2;let f=h,v=h;if(p>te&&l>te){const i=e>t?1:-1;let o=ge(Number(l)/a*de(p)),n=ge(Number(l)/s*de(p));return(f-=2*o)>te?(o*=i,u+=o,g-=o):(f=0,u=g=(t+e)/2),(v-=2*n)>te?(n*=i,d+=n,c-=n):(v=0,d=c=(t+e)/2),{outerStartAngle:d,outerEndAngle:c,innerStartAngle:u,innerEndAngle:g,innerDeltaAngle:f,outerDeltaAngle:v}}return{outerStartAngle:d,outerEndAngle:c,innerStartAngle:u,innerEndAngle:g,innerDeltaAngle:f,outerDeltaAngle:v}}getGraphicTheme(){return kn(this).arc}updateAABBBounds(t,e,i,o){this.updatePathProxyAABBBounds(i)||(o?this.updateArcAABBBoundsImprecise(t,e,i):this.updateArcAABBBoundsAccurate(t,e,i));const{tb1:n,tb2:r}=zo.graphicService.updateTempAABBBounds(i);Ph(t,e,n),i.union(n),n.setValue(r.x1,r.y1,r.x2,r.y2);const{lineJoin:s=e.lineJoin}=t;return zo.graphicService.transformAABBBounds(t,i,e,"miter"===s,this),i}updateArcAABBBoundsImprecise(t,e,i){let{outerRadius:o=e.outerRadius,innerRadius:n=e.innerRadius}=t;const{outerPadding:r=e.outerPadding,innerPadding:s=e.innerPadding}=t;return o+=r,n-=s,o<n&&(o=n),i.set(-o,-o,o,o),i}updateArcAABBBoundsAccurate(t,e,i){let{outerRadius:o=e.outerRadius,innerRadius:n=e.innerRadius}=t;const{outerPadding:r=e.outerPadding,innerPadding:s=e.innerPadding}=t;if(o+=r,n-=s,o<n){const t=o;o=n,n=t}let{endAngle:a=e.endAngle,startAngle:l=e.startAngle}=t;if(l>a){const t=l;l=a,a=t}return o<=te?i.set(0,0,0,0):Math.abs(a-l)>ne-te?i.set(-o,-o,o,o):(lr(l,a,o,i),lr(l,a,n,i)),i}needUpdateTags(t){return super.needUpdateTags(t,Cc)}needUpdateTag(t){return super.needUpdateTag(t,Cc)}toCustomPath(){var t,e,i,o;const n=this.attribute,{startAngle:r,endAngle:s}=this.getParsedAngle();let a=(null!==(t=n.innerRadius)&&void 0!==t?t:0)-(null!==(e=n.innerPadding)&&void 0!==e?e:0),l=(null!==(i=n.outerRadius)&&void 0!==i?i:0)-(null!==(o=n.outerPadding)&&void 0!==o?o:0);const h=re(s-r),d=s>r;if(l<a){const t=l;l=a,a=t}const c=new go;if(l<=te)c.moveTo(0,0);else if(h>=ne-te)c.moveTo(0+l*ae(r),0+l*de(r)),c.arc(0,0,l,r,s,!d),a>te&&(c.moveTo(0+a*ae(s),0+a*de(s)),c.arc(0,0,a,s,r,d));else{const t=l*ae(r),e=l*de(r),i=a*ae(s),o=a*de(s);c.moveTo(0+t,0+e),c.arc(0,0,l,r,s,!d),c.lineTo(0+i,0+o),c.arc(0,0,a,s,r,d),c.closePath()}return c}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}};function xc(t){return new wc(t)}wc.NOWORK_ANIMATE_ATTR=Object.assign({cap:1},Pr);const _c=["points","cornerRadius",...Rr];class Sc extends Er{constructor(t){super(t),this.type="polygon",this.numberType=ss}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{points:t}=this.attribute;return t&&t.length>=2}getGraphicTheme(){return kn(this).polygon}updateAABBBounds(t,e,i){this.updatePathProxyAABBBounds(i)||this.updatePolygonAABBBoundsImprecise(t,e,i),zo.graphicService.updateTempAABBBounds(i);const{lineJoin:o=e.lineJoin}=t;return zo.graphicService.transformAABBBounds(t,i,e,"miter"===o,this),i}updatePolygonAABBBoundsImprecise(t,e,i){const{points:o=e.points}=t;return o.forEach((t=>{i.add(t.x,t.y)})),i}_interpolate(t,e,i,o,n){"points"===t&&(n.points=dr(i,o,e))}needUpdateTags(t){return super.needUpdateTags(t,_c)}needUpdateTag(t){return super.needUpdateTag(t,_c)}toCustomPath(){const t=this.attribute.points,e=new go;return t.forEach(((t,i)=>{0===i?e.moveTo(t.x,t.y):e.lineTo(t.x,t.y)})),e.closePath(),e}clone(){return new Sc(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Sc.NOWORK_ANIMATE_ATTR}}function Ac(t){return new Sc(t)}Sc.NOWORK_ANIMATE_ATTR=Pr;class Bc extends vs{constructor(t){super({x:0,y:0}),this.type="shadowroot",this.shadowHost=t}clearUpdateBoundTag(){super.clearUpdateBoundTag(),this.shadowHost&&this.shadowHost.clearUpdateBoundTag()}addUpdateBoundTag(){super.addUpdateBoundTag(),this.shadowHost&&this.shadowHost.addUpdateBoundTag()}addUpdateShapeAndBoundsTag(){super.addUpdateShapeAndBoundsTag(),this.shadowHost&&this.shadowHost.addUpdateBoundTag()}tryUpdateGlobalTransMatrix(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.shouldUpdateGlobalMatrix()){const e=this.transMatrix;this._globalTransMatrix?this._globalTransMatrix.setValue(e.a,e.b,e.c,e.d,e.e,e.f):this._globalTransMatrix=e.clone(),this.doUpdateGlobalMatrix(),t&&this.clearUpdateGlobalPositionTag()}return this._globalTransMatrix}doUpdateGlobalMatrix(){if(this.shadowHost){const t=this.shadowHost.globalTransMatrix;this._globalTransMatrix.multiply(t.a,t.b,t.c,t.d,t.e,t.f)}}tryUpdateGlobalAABBBounds(){return this._globalAABBBounds?this._globalAABBBounds.setValue(this._AABBBounds.x1,this._AABBBounds.y1,this._AABBBounds.x2,this._AABBBounds.y2):this._globalAABBBounds=this._AABBBounds.clone(),this.shadowHost&&this._globalAABBBounds.transformWithMatrix(this.shadowHost.globalTransMatrix),this._globalAABBBounds}}function Rc(t){return new Bc(t)}var Tc=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};const kc=Symbol.for("PickItemInterceptor");let Mc=class{constructor(){this.order=1}afterPickItem(t,e,i,o,n){return t.attribute.shadowRootIdx>0||!t.attribute.shadowRootIdx?this._pickItem(t,e,i,o,n):null}beforePickItem(t,e,i,o,n){return t.attribute.shadowRootIdx<0?this._pickItem(t,e,i,o,n):null}_pickItem(t,e,i,o,n){var r;if(!t.shadowRoot)return null;const{parentMatrix:s}=n||{};if(!s)return null;const a=e.pickContext;a.highPerformanceSave();const l=null===(r=kn(t))||void 0===r?void 0:r[t.type],{shadowPickMode:h=(null==l?void 0:l.shadowPickMode)}=t.attribute,d=t.shadowRoot,c=aa.allocateByObj(s),u=new fe(c.a*i.x+c.c*i.y+c.e,c.b*i.x+c.d*i.y+c.f),g=e.pickGroup(d,u,c,o);return a.highPerformanceRestore(),!g.graphic&&g.group&&"full"===h&&(g.graphic=g.group),g}};Mc=Tc([C()],Mc);let Lc=class{constructor(){this.order=1}beforePickItem(t,e,i,o,n){const r=t.baseGraphic;if(r&&r.parent){const t=new fe(i.x,i.y),n=e.pickContext;n.highPerformanceSave();const s=r.parent.globalTransMatrix;s.transformPoint(t,t);const a=r.isContainer?e.pickGroup(r,t.clone(),s,o):e.pickItem(r,t.clone(),s,o);return n.highPerformanceRestore(),a}return null}};Lc=Tc([C()],Lc);let Pc=class{constructor(){this.order=1}beforePickItem(t,e,i,o,n){if(!t.in3dMode||o.in3dInterceptor)return null;const r=e.pickContext,s=t.stage;if(!r||!s)return null;if(o.in3dInterceptor=!0,r.save(),this.initCanvasCtx(r),r.camera=s.camera,t.isContainer){const s=gh(r,t,(()=>e.pickGroup(t,i,n.parentMatrix,o)),o);return r.camera=null,o.in3dInterceptor=!1,r.restore(),s}return r.restore(),null}initCanvasCtx(t){t.setTransformForCurrent()}};Pc=Tc([C()],Pc);var Ec=new a(((t,e,i)=>{i(Mh)||(t(Lh).toSelf(),t(Mh).toService(Lh)),t(Pc).toSelf().inSingletonScope(),t(kc).toService(Pc),t(Mc).toSelf().inSingletonScope(),t(kc).toService(Mc),t(Lc).toSelf().inSingletonScope(),t(kc).toService(Lc),z(t,kc)})),Hc=new a((t=>{t(cs).to(ga).inSingletonScope(),t(us).toConstantValue(Rl)}));const Fc=Symbol.for("AutoEnablePlugins"),Oc=Symbol.for("PluginService");var Ic=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},zc=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Dc=function(t,e){return function(i,o){e(i,o,t)}};let Wc=class{constructor(t){this.autoEnablePlugins=t,this.onStartupFinishedPlugin=[],this.onRegisterPlugin=[],this.actived=!1}active(t,e){this.stage=t,this.actived=!0;const{pluginList:i}=e;i&&sn.isBound(Fc)&&this.autoEnablePlugins.getContributions().forEach((t=>{i.includes(t.name)&&this.register(t)}))}findPluginsByName(t){const e=[];return this.onStartupFinishedPlugin.forEach((i=>{i.name===t&&e.push(i)})),this.onRegisterPlugin.forEach((i=>{i.name===t&&e.push(i)})),e}register(t){"onStartupFinished"===t.activeEvent?this.onStartupFinishedPlugin.push(t):"onRegister"===t.activeEvent&&(this.onRegisterPlugin.push(t),t.activate(this))}unRegister(t){"onStartupFinished"===t.activeEvent?this.onStartupFinishedPlugin.splice(this.onStartupFinishedPlugin.indexOf(t),1):"onRegister"===t.activeEvent&&this.onRegisterPlugin.splice(this.onStartupFinishedPlugin.indexOf(t),1),t.deactivate(this)}release(){this.onStartupFinishedPlugin.forEach((t=>{t.deactivate(this)})),this.onStartupFinishedPlugin=[],this.onRegisterPlugin.forEach((t=>{t.deactivate(this)})),this.onRegisterPlugin=[]}};Wc=Ic([C(),Dc(0,m(O)),Dc(0,w(Fc)),zc("design:paramtypes",[Object])],Wc);var Nc=new a((t=>{t(Oc).to(Wc),function(t,e){t(O).toDynamicValue((t=>{let{container:i}=t;return new I(e,i)})).whenTargetNamed(e)}(t,Fc)})),Gc=new a((t=>{z(t,N)})),jc=new a((t=>{t(nn).to(rn).inSingletonScope(),z(t,nn)})),Vc=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Uc=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let $c=class{constructor(){this.type="static",this.offscreen=!1,this.global=zo.global}setDpr(t){this.canvas.dpr=t}init(t,e,i){if(this.layer=t,this.window=e,i.main)this.main=!0,this.context=e.getContext(),this.canvas=this.context.getCanvas();else{let t;this.main=!1,i.canvasId&&(t=this.global.getElementById(i.canvasId)),t||(t=this.global.createCanvas({width:e.width,height:e.height})),t.style&&(t.style["pointer-events"]="none");const o=e.getContext().getCanvas().nativeCanvas,n=hn({nativeCanvas:t,width:e.width,height:e.height,dpr:e.dpr,id:i.canvasId,canvasControled:!0,container:e.getContainer(),x:o.offsetLeft,y:o.offsetTop});n.applyPosition(),this.canvas=n,this.context=n.getContext()}}resize(t,e){this.canvas.resize(t,e)}resizeView(t,e){}render(t,e,i){var o;if(!this.main){const t=this.window.getContext().getCanvas().nativeCanvas;!t||this.canvas.x===t.offsetLeft&&this.canvas.y===t.offsetTop||(this.canvas.x=t.offsetLeft,this.canvas.y=t.offsetTop,this.canvas.applyPosition())}e.renderService.render(t,Object.assign(Object.assign({context:this.context,clear:null!==(o=e.background)&&void 0!==o?o:"#ffffff"},e),i))}merge(t){t.forEach((t=>{const e=t.getContext().canvas.nativeCanvas;this.context.drawImage(e,0,0)}))}prepare(t,e){}drawTo(t,e,i){var o;const n=t.getContext();i.renderService.render(e,Object.assign(Object.assign({context:n},i),{clear:i.clear?null!==(o=i.background)&&void 0!==o?o:"#fff":void 0}))}getContext(){return this.context}release(){this.canvas.release()}};$c=Vc([C(),Uc("design:paramtypes",[])],$c);var Xc=new a((t=>{t($c).toSelf(),t(xs).toService($c)}));var Yc=function(t,e,i,o){return new(i||(i=Promise))((function(n,r){function s(t){try{l(o.next(t))}catch(t){r(t)}}function a(t){try{l(o.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((o=o.apply(t,e||[])).next())}))};function Kc(t,e,i){const o={},n=[];return t.forEachChildren((t=>{const{zIndex:i=e}=t.attribute;o[i]?o[i].push(t):(o[i]=[t],n.push(i))}),i),n.sort(((t,e)=>i?e-t:t-e)),{childMap:o,zIdxArray:n}}function qc(t,e,i){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=!1;if(n)r=!0;else{let i;t.forEachChildren(((t,o)=>{const{zIndex:n=e}=t.attribute;if(0===o)i=n;else if(i!==n)return r=!0,!0;return!1}),o)}if(r){const{childMap:r,zIdxArray:s}=Kc(t,e,o);let a=!1;for(let t=0;t<s.length&&!a;t++){const e=r[s[t]];n&&e.sort(((t,e)=>{var i,n;return(o?-1:1)*((null!==(i=e.attribute.z)&&void 0!==i?i:0)-(null!==(n=t.attribute.z)&&void 0!==n?n:0))}));for(let t=0;t<e.length;t++)if(i(e[t],t)){a=!0;break}}}else t.forEachChildren(i,o)}function Zc(t,e,i){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Yc(this,void 0,void 0,(function*(){yield t.forEachChildrenAsync(i,o)}))}function Jc(t,e,i){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=!1;t.forEachChildren(((t,e)=>{const{zIndex:o=i}=t.attribute;if(0===e);else if(void 0!==o)return n=!0,!0;return!1}),o);let r=null,s=!1;if(n){const{childMap:n,zIdxArray:a}=Kc(t,i,o);let l=!1;for(let t=0;t<a.length&&!l;t++){const i=n[a[t]];for(let t=0;t<i.length;t++){if(s){l=!0,r=i[t];break}i[t]._uid!==e||(s=!0)}}}else t.forEachChildren((t=>s?(r=t,!0):(t._uid===e&&(s=!0),!1)),o);return r}var Qc=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},tu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},eu=function(t,e){return function(i,o){e(i,o,t)}};let iu=class{constructor(t,e){this.contributions=t,this.drawItemInterceptorContributions=e,this.currentRenderMap=new Map,this.defaultRenderMap=new Map,this.styleRenderMap=new Map,this.dirtyBounds=new He,this.backupDirtyBounds=new He,this.global=zo.global,this.layerService=zo.layerService,this.init()}init(){this.contributions.forEach((t=>{if(t.style){const e=this.styleRenderMap.get(t.style)||new Map;e.set(t.numberType,t),this.styleRenderMap.set(t.style,e)}else this.defaultRenderMap.set(t.numberType,t)})),this.InterceptorContributions=this.drawItemInterceptorContributions.getContributions().sort(((t,e)=>t.order-e.order))}prepareForDraw(t,e){e.updateBounds?this.useDirtyBounds=!0:this.useDirtyBounds=!e.stage.params.optimize.disableCheckGraphicWidthOutRange}draw(t,e){this.prepareForDraw(t,e),e.drawContribution=this,this.currentRenderMap=this.styleRenderMap.get(e.renderStyle)||this.defaultRenderMap,this.currentRenderService=t;const{context:i,stage:o,viewBox:n,transMatrix:r}=e;if(!i)return;const s=this.dirtyBounds.setValue(0,0,n.width(),n.height());if(o.dirtyBounds&&!o.dirtyBounds.empty()){const t=Ce(s,o.dirtyBounds,!1);s.x1=Math.floor(t.x1),s.y1=Math.floor(t.y1),s.x2=Math.ceil(t.x2),s.y2=Math.ceil(t.y2)}const a=i.dpr%1;(a||.5!==a)&&(s.x1=Math.floor(s.x1*i.dpr)/i.dpr,s.y1=Math.floor(s.y1*i.dpr)/i.dpr,s.x2=Math.ceil(s.x2*i.dpr)/i.dpr,s.y2=Math.ceil(s.y2*i.dpr)/i.dpr),this.backupDirtyBounds.copy(s),i.inuse=!0,i.setClearMatrix(r.a,r.b,r.c,r.d,r.e,r.f),i.clearMatrix(),i.setTransformForCurrent(!0),i.translate(n.x1,n.y1,!0),i.beginPath(),i.rect(s.x1,s.y1,s.width(),s.height()),i.clip(),o.camera&&(this.dirtyBounds.setValue(-1/0,-1/0,1/0,1/0),this.backupDirtyBounds.setValue(-1/0,-1/0,1/0,1/0)),this.clearScreen(t,i,e),i.save(),t.renderTreeRoots.sort(((t,e)=>{var i,o;return(null!==(i=t.attribute.zIndex)&&void 0!==i?i:_o.zIndex)-(null!==(o=e.attribute.zIndex)&&void 0!==o?o:_o.zIndex)})).forEach((t=>{t.isContainer?this.renderGroup(t,e,aa.allocate(1,0,0,1,0,0)):this.renderItem(t,e)})),i.restore(),i.setClearMatrix(1,0,0,1,0,0),i.inuse=!1,i.draw()}doRegister(){throw new Error("暂不支持")}_findNextGraphic(t){let e=t.parent,i=t._uid;for(;e;){const t=Jc(e,i,_o.zIndex);if(t)return t;i=e._uid,e=e.parent}return null}renderGroup(t,e,i,o){if(e.break||!1===t.attribute.visibleAll)return;if(t.incremental&&(null==e.startAtId||e.startAtId===t._uid))return e.break=!0,void this._increaseRender(t,e);if(this.useDirtyBounds&&!Se(t.AABBBounds,this.dirtyBounds,!1))return;let n,r=i;if(this.useDirtyBounds){n=Bl.allocateByObj(this.dirtyBounds);const e=t.transMatrix;r=aa.allocateByObj(i).multiply(e.a,e.b,e.c,e.d,e.e,e.f),this.dirtyBounds.copy(this.backupDirtyBounds).transformWithMatrix(r.getInverse())}this.renderItem(t,e,{drawingCb:()=>{var i;o?t.forEachChildren((t=>{e.break||(t.isContainer?this.renderGroup(t,e,r):this.renderItem(t,e))})):qc(t,_o.zIndex,(t=>{e.break||(t.isContainer?this.renderGroup(t,e,r):this.renderItem(t,e))}),!1,!!(null===(i=e.context)||void 0===i?void 0:i.camera))}}),this.useDirtyBounds&&(this.dirtyBounds.copy(n),Bl.free(n),aa.free(r))}_increaseRender(t,e){const{layer:i,stage:o}=e,{subLayers:n}=i;let r=n.get(t._uid);r||(r={layer:this.layerService.createLayer(o),zIndex:n.size,group:t},n.set(t._uid,r));const s=r.layer.getNativeHandler().getContext(),a=r.drawContribution||sn.get(Ql);a.dirtyBounds.setValue(-1/0,-1/0,1/0,1/0),a.backupDirtyBounds.setValue(-1/0,-1/0,1/0,1/0),a.draw(this.currentRenderService,Object.assign(Object.assign({},e),{drawContribution:a,clear:"transparent",layer:r.layer,context:s,startAtId:t._uid,break:!1})),r.drawContribution=a;const l=this._findNextGraphic(t);if(l)if(l.isContainer&&l.incremental)this._increaseRender(l,e);else{let t=n.get(l._uid);t||(t={layer:this.layerService.createLayer(o),zIndex:n.size},n.set(l._uid,t));const i=t.layer.getNativeHandler().getContext();this.draw(this.currentRenderService,Object.assign(Object.assign({},e),{drawContribution:a,clear:"transparent",layer:t.layer,context:i,startAtId:l._uid,break:!1}))}}getRenderContribution(t){let e;return e||(e=this.selectRenderByNumberType(t.numberType,t)),e||(e=this.selectRenderByType(t.type)),e}renderItem(t,e,i){if(this.InterceptorContributions.length)for(let o=0;o<this.InterceptorContributions.length;o++){const n=this.InterceptorContributions[o];if(n.beforeDrawItem&&n.beforeDrawItem(t,this.currentRenderService,e,this,i))return}const o=this.getRenderContribution(t);if(!o)return;let n,r=this.scrollMatrix&&(0!==this.scrollMatrix.e||0!==this.scrollMatrix.f);if(t.parent){const{scrollX:e=0,scrollY:i=0}=t.parent.attribute;(e||i)&&(r=!0,this.scrollMatrix||(this.scrollMatrix=aa.allocate(1,0,0,1,0,0)),this.scrollMatrix.translate(-e,-i))}if(r&&(n=this.dirtyBounds.clone().transformWithMatrix(this.scrollMatrix)),this.useDirtyBounds&&!t.isContainer&&!Se(t.AABBBounds,null!=n?n:this.dirtyBounds,!1)){if(r&&t.parent){const{scrollX:e=0,scrollY:i=0}=t.parent.attribute;this.scrollMatrix&&this.scrollMatrix.translate(e,i)}return}const s=null!=e.startAtId&&t._uid!==e.startAtId;if(t._uid===e.startAtId&&(e.startAtId=null),i&&(i.skipDraw=s),s?t.isContainer&&o.draw(t,this.currentRenderService,e,i):o.draw(t,this.currentRenderService,e,i),r&&t.parent){const{scrollX:e=0,scrollY:i=0}=t.parent.attribute;this.scrollMatrix&&this.scrollMatrix.translate(e,i)}if(this.InterceptorContributions.length)for(let i=0;i<this.InterceptorContributions.length;i++){const o=this.InterceptorContributions[i];if(o.afterDrawItem&&o.afterDrawItem(t,this.currentRenderService,e,this))return}}selectRenderByType(t){return Vt.getInstance().warn("未知错误，不应该走到这里"),null}selectRenderByNumberType(t,e){let i;if(e.attribute.renderStyle){const o=this.styleRenderMap.get(e.attribute.renderStyle);i=o&&o.get(t)}return i||this.currentRenderMap.get(t)||this.defaultRenderMap.get(t)}clearScreen(t,e,i){var o,n;const{clear:r,viewBox:s}=i,a=s.width(),l=s.height();if(r){e.clearRect(0,0,a,l);const i=null===(o=t.drawParams)||void 0===o?void 0:o.stage;if(i&&(e.globalAlpha=null!==(n=i.attribute.opacity)&&void 0!==n?n:1),i&&i.backgroundImg&&i.resources){const t=i.resources.get(r);t&&"success"===t.state&&t.data&&e.drawImage(t.data,0,0,a,l)}else e.fillStyle=Go(e,r,{AABBBounds:{x1:0,y1:0,x2:0+a,y2:0+l}},0,0),e.fillRect(0,0,a,l)}}afterDraw(t,e){}};iu=Qc([C(),eu(0,y(ih)),eu(1,m(O)),eu(1,w(vh)),tu("design:paramtypes",[Array,Object])],iu);var ou=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let nu=class extends ol{constructor(){super(...arguments),this.numberType=ns}drawShape(t,e,i,o,n,r,s,a){if(t.incremental&&n.multiGraphicOptions){const{startAtIdx:e,length:r}=n.multiGraphicOptions,{segments:l=[]}=t.attribute;if(e>l.length)return;const h=kn(t).line,{fill:d=h.fill,stroke:c=h.stroke,opacity:u=h.opacity,fillOpacity:g=h.fillOpacity,strokeOpacity:p=h.strokeOpacity,lineWidth:f=h.lineWidth,visible:v=h.visible}=t.attribute,b=Ps(u,g,d),m=Hs(u,p),y=Ms(d),C=Ls(c,f);if(!t.valid||!v)return;if(!y&&!C)return;if(!(b||m||s||a))return;const{context:w}=n;for(let n=e;n<e+r;n++)this.drawIncreaseSegment(t,w,l[n-1],l[n],t.attribute.segments[n],[h,t.attribute],i,o)}else super.drawShape(t,e,i,o,n,r,s,a)}drawIncreaseSegment(t,e,i,o,n,r,s,a){o&&(e.beginPath(),function(t,e,i,o){const{offsetX:n=0,offsetY:r=0}=o||{},s=e?e.points[e.points.length-1]:i.points[0];t.moveTo(s.x+n,s.y+r),i.points.forEach((e=>{!1!==e.defined?t.lineTo(e.x+n,e.y+r):t.moveTo(e.x+n,e.y+r)}))}(e.nativeContext,i,o,{offsetX:s,offsetY:a}),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,n,r),e.setStrokeStyle(t,n,s,a,r),e.stroke())}};nu=ou([C()],nu);var ru=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let su=class extends cl{constructor(){super(...arguments),this.numberType=ts}drawShape(t,e,i,o,n,r,s){if(t.incremental&&n.multiGraphicOptions){const{startAtIdx:r,length:a}=n.multiGraphicOptions,{segments:l=[]}=t.attribute;if(r>l.length)return;const h=kn(t).area,{fill:d=h.fill,fillOpacity:c=h.fillOpacity,opacity:u=h.opacity,visible:g=h.visible}=t.attribute,p=Ps(u,c,d),f=Ms(d);if(!t.valid||!g)return;if(!f)return;if(!p&&!s)return;for(let n=r;n<r+a;n++)this.drawIncreaseSegment(t,e,l[n-1],l[n],t.attribute.segments[n],[h,t.attribute],i,o)}else super.drawShape(t,e,i,o,n,r,s)}drawIncreaseSegment(t,e,i,o,n,r,s,a){o&&(e.beginPath(),function(t,e,i,o){const{offsetX:n=0,offsetY:r=0}=o||{},{points:s}=i,a=[];for(let t=0;t<s.length;t++)s[t].defined;a.push(s),a.forEach(((i,o)=>{var s,a,l,h;const d=e&&0===o?e.points[e.points.length-1]:i[0];t.moveTo(d.x+n,d.y+r),i.forEach((e=>{!1!==e.defined?t.lineTo(e.x+n,e.y+r):t.moveTo(e.x+n,e.y+r)}));for(let e=i.length-1;e>=0;e--){const o=i[e];t.lineTo(null!==(s=o.x1)&&void 0!==s?s:o.x,null!==(a=o.y1)&&void 0!==a?a:o.y)}t.lineTo(null!==(l=d.x1)&&void 0!==l?l:d.x,null!==(h=d.y1)&&void 0!==h?h:d.y),t.closePath()}))}(e.camera?e:e.nativeContext,i,o,{offsetX:s,offsetY:a}),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,n,r),e.setCommonStyle(t,n,s,a,r),e.fill())}};su=ru([C()],su);var au,lu=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},hu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},du=function(t,e){return function(i,o){e(i,o,t)}},cu=function(t,e,i,o){return new(i||(i=Promise))((function(n,r){function s(t){try{l(o.next(t))}catch(t){r(t)}}function a(t){try{l(o.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((o=o.apply(t,e||[])).next())}))};!function(t){t[t.NORMAL=0]="NORMAL",t[t.STOP=1]="STOP"}(au||(au={}));let uu=class extends iu{constructor(t,e,i,o){super(t,o),this.contributions=t,this.lineRender=e,this.areaRender=i,this.drawItemInterceptorContributions=o,this.rendering=!1,this.currFrameStartAt=0,this.currentIdx=0,this.status=au.NORMAL,this.checkingForDrawPromise=null,this.hooks={completeDraw:new W([])},this.defaultRenderMap.set(this.lineRender.numberType,this.lineRender),this.defaultRenderMap.set(this.areaRender.numberType,this.areaRender)}draw(t,e){return cu(this,void 0,void 0,(function*(){if(this.checkingForDrawPromise)return;this.lastRenderService=t,this.lastDrawContext=e,this.checkingForDrawPromise=this.checkForDraw(e);const i=yield this.checkingForDrawPromise;if(this.checkingForDrawPromise=null,i)return;this.currentRenderService=t;const{context:o,viewBox:n}=e;o&&(o.inuse=!0,o.clearMatrix(),o.setTransformForCurrent(!0),o.save(),e.restartIncremental&&this.clearScreen(this.currentRenderService,o,e),o.translate(n.x1,n.y1,!0),o.save(),t.renderTreeRoots.sort(((t,e)=>{var i,o;return(null!==(i=t.attribute.zIndex)&&void 0!==i?i:_o.zIndex)-(null!==(o=e.attribute.zIndex)&&void 0!==o?o:_o.zIndex)})).forEach((t=>{this.renderGroup(t,e)})),this.hooks.completeDraw.tap("top-draw",(()=>{o.restore(),o.restore(),o.draw(),o.inuse=!1,this.rendering=!1})))}))}_increaseRender(t,e){return cu(this,void 0,void 0,(function*(){this.rendering=!0,yield this._renderIncrementalGroup(t,e)}))}_renderIncrementalGroup(t,e){return cu(this,void 0,void 0,(function*(){this.count=t.count,yield new Promise((i=>{this.renderItem(t,e,{drawingCb:()=>cu(this,void 0,void 0,(function*(){if(2!==t.count)yield Zc(t,_o.zIndex,((i,o)=>{if(this.status===au.STOP)return!0;if(i.isContainer)return!1;if(o<this.currentIdx)return!1;const n=this.currFrameStartAt+t.incremental;return o<n&&(this.currentIdx=o+1,this.renderItem(i,e)),o===n-1&&(this.currFrameStartAt=this.currentIdx,this.waitToNextFrame())})),i(!1);else{const o=t.getChildAt(0);if(o.incremental&&o.attribute.segments)for(o.incrementalAt||(o.incrementalAt=0);o.incrementalAt<o.attribute.segments.length;)e.multiGraphicOptions={startAtIdx:o.incrementalAt,length:o.incremental},this.renderItem(o,e),o.incrementalAt+=o.incremental,yield this.waitToNextFrame();else this.renderItem(o,e);i(!1)}}))})})),this.hooks.completeDraw.call()}))}waitToNextFrame(){return cu(this,void 0,void 0,(function*(){return new Promise((t=>{this.global.getRequestAnimationFrame()((()=>{t(!1)}))}))}))}checkForDraw(t){return cu(this,void 0,void 0,(function*(){let e=this.rendering;return t.restartIncremental&&(e=!1,yield this.forceStop(),this.resetToInit()),e}))}forceStop(){return cu(this,void 0,void 0,(function*(){this.rendering&&(this.status=au.STOP,yield new Promise((t=>{this.hooks.completeDraw.tap("stopCb",(()=>{this.status=au.NORMAL,this.hooks.completeDraw.taps=this.hooks.completeDraw.taps.filter((t=>"stopCb"!==t.name)),t(!1)}))})))}))}resetToInit(){this.currFrameStartAt=0,this.currentIdx=0}renderGroup(t,e){return cu(this,void 0,void 0,(function*(){if(!e.break&&!1!==t.attribute.visibleAll)return t.incremental&&e.startAtId===t._uid?(yield this._increaseRender(t,e),void(e.break=!0)):void(yield new Promise((i=>{this.renderItem(t,e,{drawingCb:()=>cu(this,void 0,void 0,(function*(){yield Zc(t,_o.zIndex,(t=>cu(this,void 0,void 0,(function*(){e.break||t.isContainer&&(yield this.renderGroup(t,e))})))),i(!1)}))})})))}))}};uu=lu([C(),du(0,y(ih)),du(1,m(nu)),du(2,m(su)),du(3,m(O)),du(3,w(vh)),hu("design:paramtypes",[Array,Object,Object,Object])],uu);var gu=new a((t=>{t(ya).toSelf().inSingletonScope(),t(xa).toSelf().inSingletonScope(),t(uh).to(iu),t(Ql).to(uu),t(oh).to(Xl).inSingletonScope(),t(ih).toService(oh),z(t,Us),t(wa).toSelf().inSingletonScope(),z(t,Js),z(t,ih),t(wh).toSelf().inSingletonScope(),t(vh).toService(wh),z(t,vh)}));function pu(){pu.__loaded||(pu.__loaded=!0,sn.load(ks),sn.load(Hc),sn.load(kh),sn.load(Ec),sn.load(Nc),function(t){t.load(Gc),t.load(jc),t.load(Xc)}(sn),function(t){t.load(gu)}(sn))}pu.__loaded=!1,pu();const fu=sn.get(G);zo.global=fu;const vu=sn.get(Cs);zo.graphicUtil=vu;const bu=sn.get(ys);zo.transformUtil=bu;const mu=sn.get(cs);zo.graphicService=mu;const yu=sn.get(ws);zo.layerService=yu;class Cu{constructor(){this.name="AutoRenderPlugin",this.activeEvent="onRegister",this._uid=s.GenAutoIncrementId(),this.key=this.name+this._uid,this.handleChange=t=>{t.glyphHost&&(t=t.glyphHost),t.stage===this.pluginService.stage&&null!=t.stage&&t.stage.renderNextFrame()}}activate(t){this.pluginService=t,zo.graphicService.hooks.onAttributeUpdate.tap(this.key,this.handleChange),zo.graphicService.hooks.onSetStage.tap(this.key,this.handleChange),zo.graphicService.hooks.onRemove.tap(this.key,this.handleChange)}deactivate(t){const e=t=>t.filter((t=>t.name!==this.key));zo.graphicService.hooks.onAttributeUpdate.taps=e(zo.graphicService.hooks.onAttributeUpdate.taps),zo.graphicService.hooks.onSetStage.taps=e(zo.graphicService.hooks.onSetStage.taps),zo.graphicService.hooks.onRemove.taps=e(zo.graphicService.hooks.onRemove.taps)}}class wu{constructor(){this.name="AutoRefreshPlugin",this.activeEvent="onRegister",this._uid=s.GenAutoIncrementId(),this.key=this.name+this._uid,this.handleChange=t=>{t.glyphHost&&(t=t.glyphHost),t.stage===this.pluginService.stage&&null!=t.stage&&t.stage.renderNextFrame()}}activate(t){this.pluginService=t,this.dpr=zo.global.devicePixelRatio,this.refresh()}refresh(){this._refreshByMediaQuery()||this._refreshByRaf()}_refreshByRaf(){const t=zo.global.getRequestAnimationFrame();this.rafId=t((()=>{zo.global.devicePixelRatio!==this.dpr&&(this.dpr=zo.global.devicePixelRatio,this.pluginService.stage.setDpr(this.dpr,!0)),this.refresh()}))}_refreshByMediaQuery(){try{const t=`(resolution: ${window.devicePixelRatio}dppx)`,e=()=>{window.devicePixelRatio!==this.dpr&&(this.dpr=window.devicePixelRatio,this.pluginService.stage.setDpr(this.dpr,!0))};matchMedia(t).addEventListener("change",e)}catch(t){return!1}return!0}deactivate(t){const e=zo.global.getCancelAnimationFrame();e&&this.rafId&&e(this.rafId)}}class xu{constructor(){this.name="IncrementalAutoRenderPlugin",this.activeEvent="onRegister",this.nextFrameRenderGroupSet=new Set,this.willNextFrameRender=!1,this.nextUserParams={},this._uid=s.GenAutoIncrementId(),this.key=this.name+this._uid}activate(t){this.pluginService=t,zo.graphicService.hooks.onAddIncremental.tap(this.key,((e,i,o)=>{e.glyphHost&&(e=e.glyphHost),e.stage===t.stage&&null!=e.stage&&(this.nextUserParams.startAtId=i._uid,this.renderNextFrame(i))})),zo.graphicService.hooks.onClearIncremental.tap(this.key,((e,i)=>{e.stage===t.stage&&null!=e.stage&&(this.nextUserParams.startAtId=e._uid,this.nextUserParams.restartIncremental=!0,this.renderNextFrame(e))}))}deactivate(t){zo.graphicService.hooks.onAddIncremental.taps=zo.graphicService.hooks.onAddIncremental.taps.filter((t=>t.name!==this.key)),zo.graphicService.hooks.onClearIncremental.taps=zo.graphicService.hooks.onClearIncremental.taps.filter((t=>t.name!==this.key))}renderNextFrame(t){this.nextFrameRenderGroupSet.add(t),this.willNextFrameRender||(this.willNextFrameRender=!0,zo.global.getRequestAnimationFrame()((()=>{this._doRenderInThisFrame(),this.willNextFrameRender=!1})))}_doRenderInThisFrame(){const t=this.pluginService.stage;this.nextFrameRenderGroupSet.size&&(this.nextFrameRenderGroupSet.forEach((e=>{const i=e.layer;if(!i||!e.layer.subLayers)return;const o=e.layer.subLayers.get(e._uid);o&&o.drawContribution&&o.drawContribution.draw(t.renderService,Object.assign({stage:t,layer:i,viewBox:t.window.getViewBox(),transMatrix:t.window.getViewBoxTransform(),clear:"transparent",renderService:t.renderService,updateBounds:!1,startAtId:e._uid,context:o.layer.getNativeHandler().getContext()},this.nextUserParams))})),this.nextUserParams={},this.nextFrameRenderGroupSet.clear())}}const _u=new Fe;class Su{constructor(){this.name="DirtyBoundsPlugin",this.activeEvent="onRegister",this._uid=s.GenAutoIncrementId(),this.key=this.name+this._uid}activate(t){this.pluginService=t,t.stage.hooks.afterRender.tap(this.key,(t=>{t&&t===this.pluginService.stage&&t.dirtyBounds.clear()})),zo.graphicService.hooks.beforeUpdateAABBBounds.tap(this.key,((t,e,i,o)=>{t.glyphHost&&(t=t.glyphHost),e&&e===this.pluginService.stage&&e.renderCount&&(t.isContainer&&!t.shouldSelfChangeUpdateAABBBounds()||i&&(_u.setValue(o.x1,o.y1,o.x2,o.y2),e.dirty(_u,t.parent&&t.parent.globalTransMatrix)))})),zo.graphicService.hooks.afterUpdateAABBBounds.tap(this.key,((t,e,i,o,n)=>{e&&e===this.pluginService.stage&&e.renderCount&&(t.isContainer&&!n||e.dirty(o.globalAABBBounds))})),zo.graphicService.hooks.clearAABBBounds.tap(this.key,((t,e,i)=>{e&&e===this.pluginService.stage&&e.renderCount&&e&&e.dirty(i)})),zo.graphicService.hooks.onRemove.tap(this.key,(t=>{const e=t.stage;e&&e===this.pluginService.stage&&e.renderCount&&e&&e.dirty(t.globalAABBBounds)}))}deactivate(t){zo.graphicService.hooks.beforeUpdateAABBBounds.taps=zo.graphicService.hooks.beforeUpdateAABBBounds.taps.filter((t=>t.name!==this.key)),zo.graphicService.hooks.afterUpdateAABBBounds.taps=zo.graphicService.hooks.afterUpdateAABBBounds.taps.filter((t=>t.name!==this.key)),zo.graphicService.hooks.clearAABBBounds.taps=zo.graphicService.hooks.clearAABBBounds.taps.filter((t=>t.name!==this.key)),t.stage.hooks.afterRender.taps=t.stage.hooks.afterRender.taps.filter((t=>t.name!==this.key)),zo.graphicService.hooks.onRemove.taps=zo.graphicService.hooks.onRemove.taps.filter((t=>t.name!==this.key))}}const Au=new Un;let Bu;function Ru(){if(null==Bu)try{const t=document.createElement("canvas"),e=t.getContext("2d");Bu=!!(window&&t.getBoundingClientRect&&requestAnimationFrame&&window.devicePixelRatio&&e&&e.isPointInPath&&e.isPointInStroke),Bu&&(Bu=!!document.createElement)}catch(t){Bu=!1}}function Tu(){Ru();const t=zo.global&&zo.global.env;return t?"browser"===t:Bu}Au.addTimeline(Yn),Au.setFPS(60);let ku=class t{static registerPlugin(e,i){t._pluginClasses[e]=i}static getPlugin(e){return t._pluginClasses[e]}};ku._pluginClasses={};const Mu="white";class Lu extends vs{set viewBox(t){this.window.setViewBox(t)}get viewBox(){return this.window.getViewBox()}get x(){return this.window.getViewBox().x1}set x(t){const e=this.window.getViewBox();e.translate(t-e.x1,0),this.window.setViewBox(e)}get y(){return this.window.getViewBox().y1}set y(t){const e=this.window.getViewBox();e.translate(0,t-e.y1),this.window.setViewBox(e)}get width(){return this.window.width}set width(t){this.resize(t,this.height)}get viewWidth(){return this.window.getViewBox().width()}set viewWidth(t){this.resizeView(t,this.viewHeight)}get viewHeight(){return this.window.getViewBox().height()}set viewHeight(t){this.resizeView(this.viewWidth,t)}get height(){return this.window.height}set height(t){this.resize(this.width,t)}get dpr(){return this.window.dpr}set dpr(t){this.setDpr(t)}get background(){var t;return null!==(t=this._background)&&void 0!==t?t:Mu}set background(t){this._background=t}get defaultLayer(){return this.at(0)}get eventSystem(){return this._eventSystem}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var e;super({}),this.tickedBeforeRender=!0,this._onVisibleChange=t=>{if(!(this._skipRender<0))if(t){if(this.dirtyBounds){const t=this.window.getViewBox();this.dirtyBounds.setValue(t.x1,t.y1,t.width(),t.height())}this._skipRender>1&&this.renderNextFrame(),this._skipRender=0}else this._skipRender=1},this.beforeRender=t=>{this._beforeRender&&this._beforeRender(t)},this.afterRender=t=>{this.renderCount++,this._afterRender&&this._afterRender(t),this._afterNextRenderCbs&&this._afterNextRenderCbs.forEach((e=>e(t))),this._afterNextRenderCbs=null,this.tickedBeforeRender=!1},this.afterTickCb=()=>{var t;this.tickedBeforeRender=!0,"performance"===(null===(t=this.params.optimize)||void 0===t?void 0:t.tickRenderMode)||"rendering"!==this.state&&this.render()},this.params=t,this.theme=new Rn,this.hooks={beforeRender:new W(["stage"]),afterRender:new W(["stage"])},this.global=zo.global,!this.global.env&&Tu()&&this.global.setEnv("browser"),this.window=sn.get(gn),this.renderService=sn.get(Rh),this.pluginService=sn.get(Oc),this.layerService=sn.get(ws),this.pluginService.active(this,t),this.window.create({width:t.width,height:t.height,viewBox:t.viewBox,container:t.container,dpr:t.dpr||this.global.devicePixelRatio,canvasControled:!1!==t.canvasControled,title:t.title||"",canvas:t.canvas}),this.state="normal",this.renderCount=0,this.tryInitEventSystem(),this._background=null!==(e=t.background)&&void 0!==e?e:Mu,this.appendChild(this.layerService.createLayer(this,{main:!0})),this.nextFrameRenderLayerSet=new Set,this.willNextFrameRender=!1,this.stage=this,this.renderStyle=t.renderStyle,t.autoRender&&this.enableAutoRender(),t.autoRefresh&&this.enableAutoRefresh(),!1===t.disableDirtyBounds&&this.enableDirtyBounds(),t.enableHtmlAttribute&&this.enableHtmlAttribute(t.enableHtmlAttribute),t.ReactDOM&&this.enableReactAttribute(t.ReactDOM),t.enableLayout&&this.enableLayout(),this.hooks.beforeRender.tap("constructor",this.beforeRender),this.hooks.afterRender.tap("constructor",this.afterRender),this._beforeRender=t.beforeRender,this._afterRender=t.afterRender,this.ticker=t.ticker||Au,this.supportInteractiveLayer=!1!==t.interactiveLayer,this.timeline=new Xn,this.ticker.addTimeline(this.timeline),this.timeline.pause(),t.optimize||(t.optimize={}),this.optmize(t.optimize),t.background&&lt(this._background)&&this._background.includes("/")&&this.setAttributes({background:this._background}),this.ticker.on("afterTick",this.afterTickCb)}pauseRender(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this._skipRender=t}resumeRender(){this._skipRender=0}tryInitEventSystem(){this.global.supportEvent&&!this._eventSystem&&(this._eventSystem=new Nn(Object.assign({targetElement:this.window,resolution:this.window.dpr||this.global.devicePixelRatio,rootNode:this,global:this.global,supportsPointerEvents:this.params.supportsPointerEvents,supportsTouchEvents:this.params.supportsTouchEvents},this.params.event)))}preventRender(t){t?this._skipRender=-1/0:!1!==this.params.optimize.skipRenderWithOutRange?this._skipRender=this.window.isVisible()?0:1:this._skipRender=0}optmize(t){this.optmizeRender(t.skipRenderWithOutRange),this.params.optimize=t}optmizeRender(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&(this._skipRender=this._skipRender<0?this._skipRender:this.window.isVisible()?0:1,this.window.onVisibleChange(this._onVisibleChange))}getTimeline(){return this.timeline}get3dOptions(t){const{center:e={x:this.width/2,y:this.height/2,z:0,dx:0,dy:0,dz:0},light:i={},alpha:o=0,beta:n=0,camera:r,fieldRatio:s=1,fieldDepth:a}=t;return Object.assign(Object.assign({},t),{center:e,light:i,alpha:o,beta:n,camera:r,fieldRatio:s,fieldDepth:a})}set3dOptions(t){var e,i,o,n,r,s;this.option3d=t;const a=this.get3dOptions(t),{light:l,center:h,camera:d,alpha:c,beta:u,fieldRatio:g,fieldDepth:p}=a,{dir:f=[1,1,-1],color:v="white",ambient:b}=l,m=(null!==(e=h.x)&&void 0!==e?e:this.width/2)+(null!==(i=h.dx)&&void 0!==i?i:0),y=(null!==(o=h.y)&&void 0!==o?o:this.height/2)+(null!==(n=h.dy)&&void 0!==n?n:0),C=[m,y,(null!==(r=h.z)&&void 0!==r?r:0)+(null!==(s=h.dz)&&void 0!==s?s:0)];let w=0,x=0,_=0;d||(w=Math.sin(c)+m,x=Math.sin(u)+y,_=Math.cos(c)*Math.cos(u)*1);const S=ku.getPlugin("DirectionalLight");S&&(this.light=new S(f,v,b));const A={left:0,right:this.width,top:0,bottom:this.height,fieldRatio:g,fieldDepth:p,viewParams:{pos:[w,x,_],center:C,up:[0,1,0]}};if(this.camera)this.camera.params=A;else{const t=ku.getPlugin("OrthoCamera");t&&(this.camera=new t(A))}t.enableView3dTransform&&this.enableView3dTransform()}setBeforeRender(t){this._beforeRender=t}setAfterRender(t){this._afterRender=t}afterNextRender(t){this._afterNextRenderCbs||(this._afterNextRenderCbs=[]),this._afterNextRenderCbs.push(t)}enableView3dTransform(){if(this.view3dTranform)return;this.view3dTranform=!0;const t=ku.getPlugin("ViewTransform3dPlugin");t&&this.pluginService.register(new t)}disableView3dTranform(){this.view3dTranform&&(this.view3dTranform=!1,this.pluginService.findPluginsByName("ViewTransform3dPlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableAutoRender(){this.autoRender||(this.autoRender=!0,this.pluginService.register(new Cu))}disableAutoRender(){this.autoRender&&(this.autoRender=!1,this.pluginService.findPluginsByName("AutoRenderPlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableAutoRefresh(){this.autoRefresh||(this.autoRefresh=!0,this.pluginService.register(new wu))}disableAutoRefresh(){this.autoRefresh&&(this.autoRefresh=!1,this.pluginService.findPluginsByName("AutoRefreshPlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableIncrementalAutoRender(){this.increaseAutoRender||(this.increaseAutoRender=!0,this.pluginService.register(new xu))}disableIncrementalAutoRender(){this.increaseAutoRender&&(this.increaseAutoRender=!1,this.pluginService.findPluginsByName("IncrementalAutoRenderPlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableDirtyBounds(){if(this.dirtyBounds)return;this.dirtyBounds=new He;let t=this.pluginService.findPluginsByName("DirtyBoundsPlugin")[0];t?t.activate(this.pluginService):(t=new Su,this.pluginService.register(t))}disableDirtyBounds(){this.dirtyBounds&&(this.dirtyBounds=null,this.pluginService.findPluginsByName("DirtyBoundsPlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableLayout(){if(this._enableLayout)return;this._enableLayout=!0;const t=ku.getPlugin("FlexLayoutPlugin");t&&this.pluginService.register(new t)}disableLayout(){this._enableLayout&&(this._enableLayout=!1,this.pluginService.findPluginsByName("FlexLayoutPlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableHtmlAttribute(t){if(this.htmlAttribute)return;const e=ku.getPlugin("HtmlAttributePlugin");e&&(this.htmlAttribute=t,this.pluginService.register(new e))}disableHtmlAttribute(){this.htmlAttribute&&(this.htmlAttribute=!1,this.pluginService.findPluginsByName("HtmlAttributePlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableReactAttribute(t){if(this.reactAttribute)return;const e=ku.getPlugin("ReactAttributePlugin");e&&(this.reactAttribute=t,this.pluginService.register(new e))}disableReactAttribute(){this.reactAttribute&&(this.reactAttribute=!1,this.pluginService.findPluginsByName("ReactAttributePlugin").forEach((t=>{this.pluginService.unRegister(t)})))}getPluginsByName(t){return this.pluginService.findPluginsByName(t)}tryUpdateAABBBounds(){const t=this.window.getViewBox();return this._AABBBounds.setValue(t.x1,t.y1,t.x2,t.y2),this._AABBBounds}combineLayer(t,e){throw new Error("暂不支持")}createLayer(t,e){if("released"===this.releaseStatus)return;const i=this.layerService.createLayer(this,{main:!1,layerMode:e,canvasId:t});return this.appendChild(i),i}sortLayer(t){const e=this.children;e.sort(t),this.removeAllChild(),e.forEach((t=>{this.appendChild(t)}))}removeLayer(t){return this.removeChild(this.findChildByUid(t))}tryInitInteractiveLayer(){"released"!==this.releaseStatus&&this.supportInteractiveLayer&&!this.interactiveLayer&&(this.interactiveLayer=this.createLayer(),this.interactiveLayer.name="_builtin_interactive",this.interactiveLayer.attribute.pickable=!1,this.nextFrameRenderLayerSet.add(this.interactiveLayer))}clearViewBox(t){this.window.clearViewBox(t)}render(t,e){if("released"===this.releaseStatus)return;this.ticker.start(),this.timeline.resume();const i=this.state;this.state="rendering",this.tickedBeforeRender||this.ticker.trySyncTickStatus(),this.layerService.prepareStageLayer(this),this._skipRender||(this.lastRenderparams=e,this.hooks.beforeRender.call(this),this._skipRender||(this.renderLayerList(this.children),this.combineLayersToWindow(),this.nextFrameRenderLayerSet.clear()),this.hooks.afterRender.call(this)),this.state=i,this._skipRender&&this._skipRender++}combineLayersToWindow(){if("harmony"===this.global.env){const t=this.window.getContext().nativeContext;this.forEachChildren(((e,i)=>{if(i>0){const i=e.getNativeHandler().getContext().canvas.nativeCanvas.nativeCanvas._c.transferToImageBitmap();t.transferFromImageBitmap(i)}}))}}renderNextFrame(t,e){this.nextFrameRenderLayerSet.size!==this.childrenCount&&(t||this).forEach((t=>{this.nextFrameRenderLayerSet.add(t)})),this.willNextFrameRender||(this.willNextFrameRender=!0,this.global.getRequestAnimationFrame()((()=>{this._doRenderInThisFrame(),this.willNextFrameRender=!1})))}_doRenderInThisFrame(){if("released"===this.releaseStatus)return;this.timeline.resume(),this.ticker.start();const t=this.state;this.state="rendering",this.layerService.prepareStageLayer(this),this.nextFrameRenderLayerSet.size&&!this._skipRender&&(this.hooks.beforeRender.call(this),this._skipRender||(this.renderLayerList(Array.from(this.nextFrameRenderLayerSet.values()),this.lastRenderparams||{}),this.combineLayersToWindow(),this.nextFrameRenderLayerSet.clear()),this.hooks.afterRender.call(this)),this.state=t,this._skipRender&&this._skipRender++}renderLayerList(t,e){const i=[];for(let e=0;e<t.length;e++){let o=t[e];"virtual"===o.layerMode&&(o=o.getNativeHandler().mainHandler.layer),i.includes(o)||i.push(o)}i.forEach((t=>{t.renderCount>this.renderCount||(t.renderCount=this.renderCount+1,t===this.interactiveLayer&&this.dirtyBounds&&this.dirtyBounds.clear(),t.render({renderService:this.renderService,background:t===this.defaultLayer?this.background:void 0,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty()),viewBox:this.window.getViewBox(),transMatrix:this.window.getViewBoxTransform()},Object.assign({renderStyle:this.renderStyle},e)))})),this.interactiveLayer&&!t.includes(this.interactiveLayer)&&(this.dirtyBounds&&this.dirtyBounds.clear(),this.interactiveLayer.render({renderService:this.renderService,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty()),viewBox:this.window.getViewBox(),transMatrix:this.window.getViewBoxTransform()},Object.assign({renderStyle:this.renderStyle},e)))}resizeWindow(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.window.resize(t,e),i&&this.render()}resize(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];"released"!==this.releaseStatus&&(this.window.hasSubView()||this.viewBox.setValue(this.viewBox.x1,this.viewBox.y1,this.viewBox.x1+t,this.viewBox.y1+e),this.window.resize(t,e),this.forEachChildren((i=>{i.resize(t,e)})),this.camera&&this.option3d&&this.set3dOptions(this.option3d),i&&this.render())}resizeView(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];"released"!==this.releaseStatus&&(this.viewBox.setValue(this.viewBox.x1,this.viewBox.y1,this.viewBox.x1+t,this.viewBox.y1+e),this.forEachChildren((i=>{i.resizeView(t,e)})),this.camera&&(this.camera.params=Object.assign(Object.assign({},this.camera.params),{right:this.width,bottom:this.height})),i&&this.render())}setViewBox(t,e,i,o,n){let r=!0;"object"==typeof t?(this.viewBox.setValue(t.x1,t.y1,t.x2,t.y2),!1===e&&(r=!1)):(this.viewBox.setValue(t,e,t+i,e+o),!1===n&&(r=!1)),this.forEachChildren((t=>{t.resizeView(this.viewBox.width(),this.viewBox.height())})),r&&this.render()}setDpr(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.forEachChildren((e=>{e.setDpr(t)})),e&&this.render()}setOrigin(t,e){throw new Error("暂不支持")}export(t){throw new Error("暂不支持")}pick(t,e){if("released"===this.releaseStatus)return;const i=this.getPickerService().pick(this.children,new fe(t,e),{bounds:this.AABBBounds});return!(!(null==i?void 0:i.graphic)&&!(null==i?void 0:i.group))&&i}startAnimate(t){throw new Error("暂不支持")}setToFrame(t){throw new Error("暂不支持")}release(){super.release(),this.hooks.beforeRender.unTap("constructor",this.beforeRender),this.hooks.afterRender.unTap("constructor",this.afterRender),this.eventSystem&&this.eventSystem.release(),this.layerService.releaseStage(this),this.pluginService.release(),this.forEach((t=>{t.release()})),this.interactiveLayer&&(this.interactiveLayer.forEachChildren((t=>{t.setStage&&t.setStage(null,null),this.interactiveLayer.removeChild(t)})),this.interactiveLayer.release()),this.window.release(),this.ticker.remTimeline(this.timeline),this.ticker.removeListener("afterTick",this.afterTickCb),this.renderService.renderTreeRoots=[]}setStage(t){}dirty(t,e){"released"!==this.releaseStatus&&(e&&t.transformWithMatrix(e),this.dirtyBounds.empty()&&this.dirtyBounds.setValue(t.x1,t.y1,t.x2,t.y2),this.dirtyBounds.union(t))}getLayer(t){return this.children.filter((e=>e.name===t))[0]}renderTo(t){"released"!==this.releaseStatus&&this.forEachChildren(((e,i)=>{e.drawTo(t,{renderService:this.renderService,viewBox:t.getViewBox(),transMatrix:t.getViewBoxTransform(),background:e===this.defaultLayer?this.background:void 0,clear:0===i,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty())})}))}renderToNewWindow(){let t=arguments.length>1?arguments[1]:void 0;if("released"===this.releaseStatus)return;const e=sn.get(gn),i=t?-t.x1:0,o=t?-t.y1:0,n=t?t.x2:this.viewWidth,r=t?t.y2:this.viewHeight,s=t?t.width():this.viewWidth,a=t?t.height():this.viewHeight;return e.create({viewBox:{x1:i,y1:o,x2:n,y2:r},width:s,height:a,dpr:this.window.dpr,canvasControled:!0,offscreen:!0,title:""}),this.renderTo(e),e}toCanvas(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1?arguments[1]:void 0;if("released"===this.releaseStatus)return;const i=this.renderToNewWindow(t,e).getNativeHandler();return i.nativeCanvas?i.nativeCanvas:null}setCursor(t){this._cursor=t,this.eventSystem.setCursor(t,"ignore")}getCursor(){return this._cursor}eventPointTransform(t){const e=this.global.mapToCanvasPoint(t,this.window.getContext().canvas.nativeCanvas);return this.stage.window.pointTransform(e.x,e.y)}pauseTriggerEvent(){this._eventSystem&&this._eventSystem.pauseTriggerEvent()}resumeTriggerEvent(){this._eventSystem&&this._eventSystem.resumeTriggerEvent()}getPickerService(){return this.pickerService||(this.pickerService=sn.get(Mh)),this.pickerService}}function Pu(t){return new Lu(t)}const Eu={WIDTH:500,HEIGHT:500,DPR:1};class Hu{get displayWidth(){return this._pixelWidth/this._dpr}get displayHeight(){return this._pixelHeight/this._dpr}get id(){return this._id}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}get nativeCanvas(){return this._nativeCanvas}get width(){return this._pixelWidth}set width(t){this._pixelWidth=t,this._displayWidth=t/(this._dpr||1)}get height(){return this._pixelHeight}set height(t){this._pixelHeight=t,this._displayHeight=t/(this._dpr||1)}getContext(t){return this._context}get visiable(){return this._visiable}set visiable(t){this._visiable=t,t?this.show():this.hide()}get dpr(){return this._dpr}set dpr(t){this._dpr=t,this.resize(this._displayWidth,this._displayHeight)}constructor(t){var e;const{nativeCanvas:i,width:o=Eu.WIDTH,height:n=Eu.HEIGHT,dpr:r=Eu.DPR,x:s,y:a,id:l,canvasControled:h=!0}=t;this._x=null!=s?s:0,this._y=null!=a?a:0,this._pixelWidth=o*r,this._pixelHeight=n*r,this._visiable=!1!==t.visiable,this.controled=h,this._displayWidth=o,this._displayHeight=n,this._dpr=r,this._nativeCanvas=i,this._id=null!==(e=i.id)&&void 0!==e?e:l,l&&(i.id=l),this.init(t)}getNativeCanvas(){return this._nativeCanvas}hide(){}show(){}applyPosition(){}resetStyle(t){}resize(t,e){}toDataURL(t,e){return""}readPixels(t,e,i,o){return this._context.getImageData(t,e,i,o)}convertToBlob(t){throw new Error("暂未实现")}transferToImageBitmap(){throw new Error("暂未实现")}release(){this.controled&&this._nativeCanvas.parentElement&&this._nativeCanvas.parentElement.removeChild(this._nativeCanvas)}}Hu.env="browser";var Fu=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Ou=function(t,e,i,o){return new(i||(i=Promise))((function(n,r){function s(t){try{l(o.next(t))}catch(t){r(t)}}function a(t){try{l(o.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((o=o.apply(t,e||[])).next())}))};let Iu=class{configure(t){t.env===this.type&&t.setActiveEnvContribution(this)}getNativeAABBBounds(t){return new Fe}removeDom(t){return!1}createDom(t){return null}updateDom(t,e){return!1}getDynamicCanvasCount(){return 999}getStaticCanvasCount(){return 999}getElementById(t){return document.getElementById(t)}getRootElement(){return document.body}loadJson(t){const e=fetch(t).then((t=>t.json()));return e.then((t=>({data:t,state:"success"}))).catch((()=>({data:null,state:"fail"}))),e}loadArrayBuffer(t){return fetch(t).then((t=>t.arrayBuffer())).then((t=>({data:t,loadState:"success"}))).catch((()=>({data:null,loadState:"fail"})))}loadBlob(t){return fetch(t).then((t=>t.blob())).then((t=>({data:t,loadState:"success"}))).catch((()=>({data:null,loadState:"fail"})))}getElementTop(t,e){return 0}getElementLeft(t,e){return 0}getElementTopLeft(t,e){return{top:0,left:0}}loadFont(t,e,i){return Ou(this,void 0,void 0,(function*(){return{loadState:"fail"}}))}};Iu=Fu([C()],Iu);var zu=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Du=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let Wu=class{constructor(){this._uid=s.GenAutoIncrementId(),this.viewBox=new Fe,this.modelMatrix=new Ie(1,0,0,1,0,0)}onChange(t){this._onChangeCb=t}configure(t,e){e.env===this.type&&t.setWindowHandler(this)}release(){this.releaseWindow()}isVisible(t){return!0}onVisibleChange(t){}getTopLeft(t){return{top:0,left:0}}setViewBox(t){this.viewBox.setValue(t.x1,t.y1,t.x2,t.y2)}getViewBox(){return this.viewBox}setViewBoxTransform(t,e,i,o,n,r){this.modelMatrix.setValue(t,e,i,o,n,r)}getViewBoxTransform(){return this.modelMatrix}};Wu=zu([C(),Du("design:paramtypes",[])],Wu);var Nu=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Gu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ju=function(t,e){return function(i,o){e(i,o,t)}};let Vu=class{constructor(t){this.pickItemInterceptorContributions=t,this.type="default",this.global=zo.global}_init(){this.InterceptorContributions=this.pickItemInterceptorContributions.getContributions().sort(((t,e)=>t.order-e.order))}pick(t,e,i){let o={graphic:null,group:null};i.pickerService=this;const n=i.bounds.width(),r=i.bounds.height();if(!(new Fe).setValue(0,0,n,r).containsPoint(e))return o;this.pickContext&&(this.pickContext.inuse=!0),i.pickContext=this.pickContext,this.pickContext&&this.pickContext.clearMatrix(!0,1);const s=new Ie(1,0,0,1,0,0);let a;for(let n=t.length-1;n>=0&&(o=t[n].isContainer?this.pickGroup(t[n],e,s,i):this.pickItem(t[n],e,s,i),!o.graphic);n--)a||(a=o.group);if(o.graphic||(o.group=a),this.pickContext&&(this.pickContext.inuse=!1),o.graphic){let t=o.graphic;for(;t.parent;)t=t.parent;t.shadowHost&&(o.params={shadowTarget:o.graphic},o.graphic=t.shadowHost)}return o}containsPoint(t,e,i){var o;return!!(null===(o=this.pickItem(t,e,null,null!=i?i:{pickContext:this.pickContext,pickerService:this}))||void 0===o?void 0:o.graphic)}pickGroup(t,e,i,o){let n={group:null,graphic:null};if(!1===t.attribute.visibleAll)return n;const r=o.pickContext,s=r.modelMatrix;if(r.camera){const e=t.transMatrix,i=la.allocate();if(oa(i,e),s){if(i){const t=la.allocate();r.modelMatrix=na(t,s,i),la.free(i)}}else oa(i,t.globalTransMatrix),r.modelMatrix=i}if(this.InterceptorContributions.length)for(let n=0;n<this.InterceptorContributions.length;n++){const a=this.InterceptorContributions[n];if(a.beforePickItem){const n=a.beforePickItem(t,this,e,o,{parentMatrix:i});if(n)return r.modelMatrix!==s&&la.free(r.modelMatrix),r.modelMatrix=s,n}}const a=t.transMatrix,l=aa.allocateByObj(i),h=new fe(e.x,e.y);l.transformPoint(h,h);const d=t.AABBBounds.containsPoint(h);if(!d&&!t.stage.camera)return n;const c=this.pickItem(t,h.clone(),i,o);c&&c.graphic&&(n.graphic=c.graphic,n.params=c.params);const u=!1!==t.attribute.pickable&&d;return l.multiply(a.a,a.b,a.c,a.d,a.e,a.f),!1===t.attribute.childrenPickable||c&&c.graphic||qc(t,_o.zIndex,(r=>{if(r.isContainer){const i=new fe(e.x,e.y),s=kn(t).group,{scrollX:a=s.scrollX,scrollY:h=s.scrollY}=t.attribute;i.x-=a,i.y-=h,n=this.pickGroup(r,i,l,o)}else{const s=new fe(e.x,e.y);l.transformPoint(s,s);const a=kn(t).group,{scrollX:h=a.scrollX,scrollY:d=a.scrollY}=t.attribute;s.x-=h,s.y-=d;const c=this.pickItem(r,s,i,o);c&&c.graphic&&(n.graphic=c.graphic,n.params=c.params)}return!!n.graphic||!!n.group}),!0,!!r.camera),r.modelMatrix!==s&&la.free(r.modelMatrix),r.modelMatrix=s,n.graphic||n.group||!u||t.stage.camera||(n.group=t),aa.free(l),n}selectPicker(t){return this.pickerMap.get(t.numberType)||null}};Vu=Nu([C(),ju(0,m(O)),ju(0,w(kc)),Gu("design:paramtypes",[Object])],Vu);let Uu=!1;const $u=new a((t=>{Uu||(Uu=!0,t(Ya).toSelf().inSingletonScope(),t(th).to(Ya).inSingletonScope(),t(ih).toService(th),t(Gs).toService(wa),z(t,Gs))}));let Xu=!1;const Yu=new a((t=>{Xu||(Xu=!0,t(wl).toSelf().inSingletonScope(),t(ah).to(wl).inSingletonScope(),t(ih).toService(ah),t(Oa).toSelf(),t(Fa).toSelf(),t(Ks).toService(Oa),t(Ks).toService(Fa),t(Ks).toService(wa),z(t,Ks))}));let Ku=!1;const qu=new a((t=>{Ku||(Ku=!0,t(ol).toSelf().inSingletonScope(),t(nu).toSelf().inSingletonScope(),t(nh).to(ol).inSingletonScope(),t(ih).toService(nh))}));let Zu=!1;const Ju=new a((t=>{Zu||(Zu=!0,t(Al).toSelf().inSingletonScope(),t(lh).to(Al).inSingletonScope(),t(ih).toService(lh),t(qs).toService(wa),z(t,qs))}));let Qu=!1;const tg=new a((t=>{Qu||(Qu=!0,t(Ja).toSelf().inSingletonScope(),t(eh).to(Ja).inSingletonScope(),t(ih).toService(eh),t(Vs).toService(wa),z(t,Vs))}));let eg=!1;const ig=new a((t=>{eg||(eg=!0,t(hh).to(Hl).inSingletonScope(),t(ih).toService(hh),t(Zs).toService(wa),z(t,Zs))}));let og=!1;const ng=new a((t=>{og||(og=!0,t(bl).toSelf().inSingletonScope(),t(rh).to(bl).inSingletonScope(),t(ih).toService(rh),t(Xs).toService(wa),z(t,Xs))}));let rg=!1;const sg=new a((t=>{rg||(rg=!0,t(sh).to(jl).inSingletonScope(),t(ih).toService(sh),t(Ys).toService(wa),z(t,Ys))}));var ag=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},lg=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let hg=class extends fa{constructor(){super(),this.numberType=ls,this.builtinContributions=[Ml],this.init()}drawShape(t,e,i,o,n){const r=kn(t).richtext,{strokeOpacity:s=r.strokeOpacity,opacity:a=r.opacity,fillOpacity:l=r.fillOpacity,visible:h=r.visible}=t.attribute;if(!t.valid||!h)return;const d=Ps(a,l,!0),c=Ps(a,s,!0);d&&(e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,r),e.translate(i,o),this.beforeRenderStep(t,e,i,o,d,c,d,c,r,n),t.getFrameCache().draw(e,this.drawIcon),this.afterRenderStep(t,e,i,o,d,c,d,c,r,n))}drawIcon(t,e,i,o,n){var r;const s=kn(t).richtextIcon,{width:a=s.width,height:l=s.height,opacity:h=s.opacity,image:d,backgroundFill:c=s.backgroundFill,backgroundFillOpacity:u=s.backgroundFillOpacity,backgroundStroke:g=s.backgroundStroke,backgroundStrokeOpacity:p=s.backgroundStrokeOpacity,backgroundRadius:f=s.backgroundRadius,margin:v}=t.attribute,{backgroundWidth:b=a,backgroundHeight:m=l}=t.attribute;if(v&&(i+=t._marginArray[3],o+=t._marginArray[0]),t._hovered){const t=(b-a)/2,n=(m-l)/2;0===f?(e.beginPath(),e.rect(i-t,o-n,b,m)):(e.beginPath(),Pa(e,i-t,o-n,b,m,f)),c&&(e.globalAlpha=u,e.fillStyle=c,e.fill()),g&&(e.globalAlpha=p,e.strokeStyle=g,e.stroke())}const y=d&&(null===(r=null==t?void 0:t.resources)||void 0===r?void 0:r.get(d));y&&"success"===y.state&&(e.globalAlpha=h,e.drawImage(y.data,i,o,a,l))}draw(t,e,i){const o=kn(t).richtext;this._draw(t,o,!1,i)}};hg=ag([C(),lg("design:paramtypes",[])],hg);let dg=!1;const cg=new a((t=>{dg||(dg=!0,t(dh).to(hg).inSingletonScope(),t(ih).toService(dh))}));let ug=!1;const gg=new a((t=>{ug||(ug=!0,t(ch).to(Jl).inSingletonScope(),t(ih).toService(ch),t($s).toService(wa),z(t,$s))}));const pg=new Fe;class fg{constructor(){this.name="FlexLayoutPlugin",this.activeEvent="onRegister",this.id=s.GenAutoIncrementId(),this.key=this.name+this.id,this.tempBounds=new Fe}pauseLayout(t){this.pause=t}tryLayoutChildren(t){t.firstChild&&this.tryLayout(t.firstChild)}tryLayout(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.pause)return;const i=t.parent;if(!(e||i&&t.needUpdateLayout()))return;const o=kn(i).group,{display:n=o.display}=i.attribute;if("flex"!==n)return;const{flexDirection:r=o.flexDirection,flexWrap:s=o.flexWrap,alignItems:a=o.alignItems,clip:l=o.clip}=i.attribute,{alignContent:h=(null!=a?a:o.alignContent)}=i.attribute;let{width:d,height:c,justifyContent:u=o.justifyContent}=i.attribute;const g=i.getChildren();if(null==d||null==c){let t=0,e=0,i=0;if(g.forEach((o=>{const n=this.getAABBBounds(o);n.empty()||("column"===r||"column-reverse"===r?(e+=n.height(),t=Math.max(t,n.width())):(t+=n.width(),e=Math.max(e,n.height())),i+=n.x1,i+=n.y1,i+=n.x2,i+=n.y2)})),!isFinite(i))return;d=t,c=e}null==i.attribute.width?i.attribute.width=d:d=i.attribute.width,null==i.attribute.height?i.attribute.height=c:c=i.attribute.height,this.tempBounds.copy(i._AABBBounds);const p={main:{len:d,field:"x"},cross:{len:c,field:"y"}},f=p.main,v=p.cross;"column"!==r&&"column-reverse"!==r||(f.len=c,v.len=d,f.field="y",v.field="x"),"row-reverse"!==r&&"column-reverse"!==r||("flex-start"===u?u="flex-end":"flex-end"===u?u="flex-start":g.reverse());let b=0,m=0;const y=[];g.forEach((t=>{const e=this.getAABBBounds(t);if(e.empty())return;const i="x"===f.field?e.width():e.height(),o="x"===v.field?e.width():e.height();y.push({mainLen:i,crossLen:o}),b+=i,m=Math.max(m,o)}));const C=[];if(b>f.len&&"wrap"===s){let t=0,e=0;y.forEach(((i,o)=>{let{mainLen:n,crossLen:r}=i;t+n>f.len?0===t?(C.push({idx:o,mainLen:t+n,crossLen:r}),t=0,e=0):(C.push({idx:o-1,mainLen:t,crossLen:e}),t=n,e=r):(t+=n,e=Math.max(e,r))})),C.push({idx:y.length-1,mainLen:t,crossLen:e})}else C.push({idx:y.length-1,mainLen:b,crossLen:m});let w=0;if(C.forEach((t=>{this.layoutMain(i,g,u,f,y,w,t),w=t.idx+1})),m=C.reduce(((t,e)=>t+e.crossLen),0),1===C.length){const t={"flex-start":0,"flex-end":v.len,center:v.len/2};this.layoutCross(g,a,v,t,y,C[0],0)}else if("flex-start"===h){w=0;let t=0;C.forEach(((e,i)=>{const o={"flex-start":t,"flex-end":t+e.crossLen,center:t+e.crossLen/2};this.layoutCross(g,"flex-start",v,o,y,C[i],w),w=e.idx+1,t+=e.crossLen}))}else if("center"===h){w=0;let t=Math.max(0,(v.len-m)/2);C.forEach(((e,i)=>{const o={"flex-start":t,"flex-end":t+e.crossLen,center:t+e.crossLen/2};this.layoutCross(g,"center",v,o,y,C[i],w),w=e.idx+1,t+=e.crossLen}))}else if("space-around"===h){w=0;const t=Math.max(0,(v.len-m)/C.length/2);let e=t;C.forEach(((i,o)=>{const n={"flex-start":e,"flex-end":e+i.crossLen,center:e+i.crossLen/2};this.layoutCross(g,"flex-start",v,n,y,C[o],w),w=i.idx+1,e+=i.crossLen+2*t}))}else if("space-between"===h){w=0;const t=Math.max(0,(v.len-m)/(2*C.length-2));let e=0;C.forEach(((i,o)=>{const n={"flex-start":e,"flex-end":e+i.crossLen,center:e+i.crossLen/2};this.layoutCross(g,"flex-start",v,n,y,C[o],w),w=i.idx+1,e+=i.crossLen+2*t}))}g.forEach(((t,e)=>{t.addUpdateBoundTag(),t.addUpdatePositionTag(),t.clearUpdateLayoutTag()})),i.addUpdateLayoutTag();const x=this.getAABBBounds(i);l||this.tempBounds.equals(x)||this.tryLayout(i,!1)}getAABBBounds(t){this.skipBoundsTrigger=!0;const e=t.AABBBounds;return this.skipBoundsTrigger=!1,e}updateChildPos(t,e,i){return t+(null!=e?e:0)-i}layoutMain(t,e,i,o,n,r,s){if("flex-start"===i){let t=0;for(let i=r;i<=s.idx;i++){const r=t+(e[i],o.field,0),s=this.getAABBBounds(e[i]);!s.empty()&&(e[i].attribute[o.field]=this.updateChildPos(r,e[i].attribute[o.field],s[`${o.field}1`])),t+=n[i].mainLen}}else if("flex-end"===i){let t=o.len;for(let i=s.idx;i>=r;i--){t-=n[i].mainLen;const r=t+(e[i],o.field,0),s=this.getAABBBounds(e[i]);!s.empty()&&(e[i].attribute[o.field]=this.updateChildPos(r,e[i].attribute[o.field],s[`${o.field}1`]))}}else if("space-around"===i)if(s.mainLen>=o.len){let t=0;for(let i=r;i<=s.idx;i++){const r=t+(e[i],o.field,0),s=this.getAABBBounds(e[i]);!s.empty()&&(e[i].attribute[o.field]=this.updateChildPos(r,e[i].attribute[o.field],s[`${o.field}1`])),t+=n[i].mainLen}}else{const t=s.idx-r+1,i=(o.len-s.mainLen)/t/2;let a=i;for(let t=r;t<=s.idx;t++){const r=a+(e[t],o.field,0),s=this.getAABBBounds(e[t]);!s.empty()&&(e[t].attribute[o.field]=this.updateChildPos(r,e[t].attribute[o.field],s[`${o.field}1`])),a+=n[t].mainLen+2*i}}else if("space-between"===i)if(s.mainLen>=o.len){let t=0;for(let i=r;i<=s.idx;i++){const r=t+(e[i],o.field,0),s=this.getAABBBounds(e[i]);!s.empty()&&(e[i].attribute[o.field]=this.updateChildPos(r,e[i].attribute[o.field],s[`${o.field}1`])),t+=n[i].mainLen}}else{const t=s.idx-r+1,i=(o.len-s.mainLen)/(2*t-2);let a=0;for(let t=r;t<=s.idx;t++){const r=a+(e[t],o.field,0),s=this.getAABBBounds(e[t]);!s.empty()&&(e[t].attribute[o.field]=this.updateChildPos(r,e[t].attribute[o.field],s[`${o.field}1`])),a+=n[t].mainLen+2*i}}else if("center"===i){let t=(o.len-s.mainLen)/2;for(let i=r;i<=s.idx;i++){const r=t+(e[i],o.field,0),s=this.getAABBBounds(e[i]);!s.empty()&&(e[i].attribute[o.field]=this.updateChildPos(r,e[i].attribute[o.field],s[`${o.field}1`])),t+=n[i].mainLen}}}layoutCross(t,e,i,o,n,r,s){var a;for(let l=s;l<=r.idx;l++){const r=t[l];let{alignSelf:s}=r.attribute;s&&"auto"!==s||(s=e);const h=this.getAABBBounds(r),d=null!==(a=o[s])&&void 0!==a?a:o["flex-start"];"flex-end"===s?!h.empty()&&(r.attribute[i.field]=this.updateChildPos(d-n[l].crossLen+(i.field,0),r.attribute[i.field],h[`${i.field}1`])):"center"===s?!h.empty()&&(r.attribute[i.field]=this.updateChildPos(d-n[l].crossLen/2+(i.field,0),r.attribute[i.field],h[`${i.field}1`])):!h.empty()&&(r.attribute[i.field]=this.updateChildPos(d+(i.field,0),r.attribute[i.field],h[`${i.field}1`]))}}activate(t){this.pluginService=t,zo.graphicService.hooks.onAttributeUpdate.tap(this.key,(t=>{t.glyphHost&&(t=t.glyphHost),t.stage&&t.stage===this.pluginService.stage&&this.tryLayout(t,!1)})),zo.graphicService.hooks.beforeUpdateAABBBounds.tap(this.key,((t,e,i,o)=>{t.glyphHost&&(t=t.glyphHost),e&&e===this.pluginService.stage&&t.isContainer&&!this.skipBoundsTrigger&&pg.copy(o)})),zo.graphicService.hooks.afterUpdateAABBBounds.tap(this.key,((t,e,i,o,n)=>{e&&e===this.pluginService.stage&&t.isContainer&&!this.skipBoundsTrigger&&(pg.equals(i)||this.tryLayout(t,!1))})),zo.graphicService.hooks.onSetStage.tap(this.key,(t=>{t.glyphHost&&(t=t.glyphHost),this.tryLayout(t,!1)}))}deactivate(t){zo.graphicService.hooks.onAttributeUpdate.taps=zo.graphicService.hooks.onAttributeUpdate.taps.filter((t=>t.name!==this.key)),zo.graphicService.hooks.beforeUpdateAABBBounds.taps=zo.graphicService.hooks.beforeUpdateAABBBounds.taps.filter((t=>t.name!==this.key)),zo.graphicService.hooks.afterUpdateAABBBounds.taps=zo.graphicService.hooks.afterUpdateAABBBounds.taps.filter((t=>t.name!==this.key)),zo.graphicService.hooks.onSetStage.taps=zo.graphicService.hooks.onSetStage.taps.filter((t=>t.name!==this.key))}}const vg=()=>{ku.registerPlugin("FlexLayoutPlugin",fg)},bg=["x","y","dx","dy","scaleX","scaleY","angle","anchor","postMatrix","visible","clip","pickable","childrenPickable","zIndex","cursor"];class mg extends vs{constructor(t,e){super(t),(null==e?void 0:e.mode)&&(this.mode=e.mode,this.setMode(e.mode)),(null==e?void 0:e.skipDefault)&&(this.skipDefault=!0),this.setTheme({common:{strokeBoundsBuffer:0}}),this.attribute=t,this.onSetStage((()=>{this.render(),this.bindEvents()}))}setAttribute(t,e,i,o){const n=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({[t]:e},this.attribute,t,o);if(n)return this._setAttributes(n,i);st(this.attribute[t])&&st(e)&&!et(this.attribute[t])&&!et(e)?Tt(this.attribute[t],e):this.attribute[t]=e,bg.includes(t)||this.render(),this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!i&&!this.needUpdateTag(t)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.onAttributeUpdate()}setAttributes(t,e,i){return t=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,null,i)||t,this._setAttributes(t,e)}_setAttributes(t,e){const i=Object.keys(t);this._mergeAttributes(t,i),i.every((t=>bg.includes(t)))||this.render(),this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!e&&!this.needUpdateTags(i)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.onAttributeUpdate()}_mergeAttributes(t,e){it(e)&&(e=Object.keys(t));for(let i=0;i<e.length;i++){const o=e[i];!st(this.attribute[o])||et(this.attribute[o])||et(t[o])?this.attribute[o]=t[o]:Tt(this.attribute[o],t[o])}}bindEvents(){}_getNodeId(t){var e;return`${null!==(e=this.id)&&void 0!==e?e:this._uid}-${this.name}-${t}`}_dispatchEvent(t,e){var i;const o=new On(t,e);o.manager=null===(i=this.stage)||void 0===i?void 0:i.eventSystem.manager,this.dispatchEvent(o)}}const yg=Symbol.for("MathPickerContribution"),Cg=Symbol.for("MathArcPicker"),wg=Symbol.for("MathCirclePicker"),xg=Symbol.for("MathImagePicker"),_g=Symbol.for("MathLinePicker"),Sg=Symbol.for("MathPathPicker"),Ag=Symbol.for("MathRectPicker"),Bg=Symbol.for("MathSymbolPicker"),Rg=Symbol.for("MathTextPicker"),Tg=Symbol.for("MathPolygonPicker"),kg=Symbol.for("CanvasArcPicker"),Mg=Symbol.for("CanvasCirclePicker"),Lg=Symbol.for("CanvasImagePicker"),Pg=Symbol.for("CanvasLinePicker"),Eg=Symbol.for("CanvasPathPicker"),Hg=Symbol.for("CanvasRectPicker"),Fg=Symbol.for("CanvasSymbolPicker"),Og=Symbol.for("CanvasTextPicker"),Ig=Symbol.for("CanvasPolygonPicker"),zg=Symbol.for("CanvasRichTextPicker"),Dg=Symbol.for("CanvasGroupPicker"),Wg=Symbol.for("CanvasPickerContribution"),Ng={onPointerDown:"pointerdown",onPointerUp:"pointerup",onPointerUpOutside:"pointerupoutside",onPointerTap:"pointertap",onPointerOver:"pointerover",onPointerMove:"pointermove",onPointerEnter:"pointerenter",onPointerLeave:"pointerleave",onPointerOut:"pointerout",onMouseDown:"mousedown",onMouseUp:"mouseup",onMouseUpOutside:"mouseupoutside",onMouseMove:"mousemove",onMouseOver:"mouseover",onMouseOut:"mouseout",onMouseEnter:"mouseenter",onMouseLeave:"mouseleave",onPinch:"pinch",onPinchStart:"pinchstart",onPinchEnd:"pinchend",onPan:"pan",onPanStart:"panstart",onPanEnd:"panend",onDrag:"drag",onDragStart:"dragstart",onDragEnter:"dragenter",onDragLeave:"dragleave",onDragOver:"dragover",onDragEnd:"dragend",onRightDown:"rightdown",onRightUp:"rightup",onRightUpOutside:"rightupoutside",onTouchStart:"touchstart",onTouchEnd:"touchend",onTouchEndOutside:"touchendoutside",onTouchMove:"touchmove",onTouchCancel:"touchcancel",onPress:"press",onPressUp:"pressup",onPressEnd:"pressend",onSwipe:"swipe",onDrop:"drop",onWeel:"wheel",onClick:"click",onDblClick:"dblclick"},Gg=(t,e)=>{const i=e.x-t.x,o=e.y-t.y;return Math.abs(i)>Math.abs(o)?i>0?"right":"left":o>0?"down":"up"},jg=(t,e)=>{const i=Math.abs(e.x-t.x),o=Math.abs(e.y-t.y);return Math.sqrt(i*i+o*o)};class Vg extends J{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i,o,n,r,s,a,l,h,d,c;super(),this.cachedEvents=[],this.startPoints=[],this.processEvent={},this.throttleTimer=0,this.emitThrottles=[],this.lastTapTarget=null,this.onStart=t=>{this.cachedEvents=[],this.startPoints=[],this.reset(),this.startTime=In.now();const{cachedEvents:e,startPoints:i}=this;t&&e.push(t.clone()),i.length=e.length;for(let t=0;t<e.length;t++){const{x:o,y:n}=e[t],r={x:o,y:n};i[t]=r}if(1!==i.length)this.startDistance=jg(i[0],i[1]),this.center=(t=>{const e=t.length;if(1===e)return{x:Math.round(t[0].x),y:Math.round(t[0].y)};let i=0,o=0,n=0;for(;n<e;)i+=t[n].x,o+=t[n].y,n++;return{x:Math.round(i/e),y:Math.round(o/e)}})([i[0],i[1]]);else{const t=e[0];this.pressTimeout=setTimeout((()=>{t.direction="none",t.deltaX=0,t.deltaY=0,t.points=i,this.triggerStartEvent("press",t),this.triggerEvent("press",t),this.eventType="press",this.direction="none",this.pressTimeout=null}),this.config.press.time)}},this.onMove=t=>{this.clearPressTimeout();const{startPoints:e,cachedEvents:i}=this;if(!e.length)return;const o=t.clone(),{x:n,y:r,pointerId:s}=o;for(let t=0,e=i.length;t<e;t++)if(s===i[t].pointerId){i[t]=o;break}const a={x:n,y:r},l=i.map((t=>({x:t.x,y:t.y}))),h=In.now();if(this.prevMoveTime=this.lastMoveTime,this.prevMovePoint=this.lastMovePoint,this.lastMoveTime=h,this.lastMovePoint=a,1===e.length){const t=e[0],i=n-t.x,s=r-t.y,h=this.direction||Gg(t,a);this.direction=h;const d=this.getEventType(a);return o.direction=h,o.deltaX=i,o.deltaY=s,o.points=l,this.triggerStartEvent(d,o),void this.triggerEvent(d,o)}const{startDistance:d}=this,c=jg(l[0],l[1]);o.scale=c/d,o.center=this.center,o.points=l,this.triggerStartEvent("pinch",o),this.triggerEvent("pinch",o)},this.onEnd=t=>{const e=t.clone(),{cachedEvents:i,startPoints:o}=this,n=i.map((t=>({x:t.x,y:t.y})));if(e.points=n,this.triggerEndEvent(e),1===i.length){const i=In.now(),n=this.lastMoveTime;if(i-n<100){const t=n-(this.prevMoveTime||this.startTime);if(t>0){const i=this.prevMovePoint||o[0],n=this.lastMovePoint||o[0],r=jg(i,n),s=r/t;if(s>this.config.swipe.velocity&&r>this.config.swipe.threshold)return e.velocity=s,e.direction=Gg(i,n),this.triggerEvent("swipe",e),this.cachedEvents=[],this.startPoints=[],void this.reset()}}i-this.startTime<this.config.press.time&&(i-this.lastTapTime<this.config.tap.interval&&t.target===this.lastTapTarget?this.tapCount++:this.tapCount=1,this.lastTapTime=i,this.lastTapTarget=t.target,1===this.tapCount?this.triggerEvent("tap",e):2===this.tapCount&&(this.triggerEvent("doubletap",e),this.tapCount=0))}for(let t=0,n=i.length;t<n;t++)if(i[t].pointerId===e.pointerId){i.splice(t,1),o.splice(t,1);break}this.reset(),i.length>0&&this.onStart()},this.element=t,this.tapCount=0,this.lastTapTime=0,this.config={press:{time:null!==(o=null===(i=null==e?void 0:e.press)||void 0===i?void 0:i.time)&&void 0!==o?o:251,threshold:null!==(r=null===(n=null==e?void 0:e.press)||void 0===n?void 0:n.threshold)&&void 0!==r?r:9},swipe:{threshold:null!==(a=null===(s=null==e?void 0:e.swipe)||void 0===s?void 0:s.threshold)&&void 0!==a?a:10,velocity:null!==(h=null===(l=null==e?void 0:e.swipe)||void 0===l?void 0:l.velocity)&&void 0!==h?h:.3},tap:{interval:null!==(c=null===(d=null==e?void 0:e.tap)||void 0===d?void 0:d.interval)&&void 0!==c?c:300}},this.initEvents()}initEvents(){const{element:t}=this;t&&(t.addEventListener("pointerdown",this.onStart),t.addEventListener("pointermove",this.onMove),t.addEventListener("pointerup",this.onEnd),t.addEventListener("pointerupoutside",this.onEnd))}removeEvents(){const{element:t}=this;t&&(t.removeEventListener("pointerdown",this.onStart),t.removeEventListener("pointermove",this.onMove),t.removeEventListener("pointerup",this.onEnd),t.removeEventListener("pointerupoutside",this.onEnd))}release(){this.removeEvents(),this.element=null}getEventType(t){const{eventType:e,startTime:i,startPoints:o}=this;if("press"===e)return e;let n;return n=In.now()-i>this.config.press.time&&jg(o[0],t)<this.config.press.threshold?"press":"pan",this.eventType=n,n}enable(t){this.processEvent[t]=!0}isProcess(t){return this.processEvent[t]}pushEvent(t,e){const{emitThrottles:i}=this,o={type:t,ev:e};for(let e=0,n=i.length;e<n;e++)if(i[e].type===t)return void i.splice(e,1,o);i.push(o)}clearPressTimeout(){this.pressTimeout&&(clearTimeout(this.pressTimeout),this.pressTimeout=null)}reset(){this.clearPressTimeout(),this.startTime=0,this.startDistance=0,this.direction=null,this.eventType=null,this.prevMoveTime=0,this.prevMovePoint=null,this.lastMoveTime=0,this.lastMovePoint=null}triggerEvent(t,e){this.pushEvent(t,e);const{throttleTimer:i,emitThrottles:o}=this;i||(this.throttleTimer=zo.global.getRequestAnimationFrame()((()=>{zo.global.getCancelAnimationFrame()(this.throttleTimer),this.throttleTimer=null;for(let t=0,e=o.length;t<e;t++){const{type:e,ev:i}=o[t];this.emitEvent(e,i)}this.emitThrottles.length=0})))}triggerStartEvent(t,e){this.isProcess(t)||(this.enable(t),this.triggerEvent(`${t}start`,e))}triggerEndEvent(t){const e=this.processEvent;Object.keys(e).forEach((i=>{this.triggerEvent(`${i}end`,t),"press"===i&&this.triggerEvent(`${i}up`,t),delete e[i]}))}emitEvent(t,e){if(!this.element)return;const i=this.element._events["*"];if(i)if("fn"in i)i.fn.call(i.context,e,t);else for(let o=0,n=i.length;o<n&&!e.propagationImmediatelyStopped;o++)i[o].fn.call(i[o].context,e,t);this.emit(t,e)}}var Ug=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},$g=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};const Xg=[0,0,0];let Yg=class{set fillStyle(t){this.nativeContext.fillStyle=t}get fillStyle(){return this.nativeContext.fillStyle}set font(t){this.nativeContext.font=t}get font(){return this.nativeContext.font}set globalAlpha(t){this.nativeContext.globalAlpha=t*this.baseGlobalAlpha}get globalAlpha(){return this.nativeContext.globalAlpha}set lineCap(t){this.nativeContext.lineCap=t}get lineCap(){return this.nativeContext.lineCap}set lineDashOffset(t){this.nativeContext.lineDashOffset=t}get lineDashOffset(){return this.nativeContext.lineDashOffset}set lineJoin(t){this.nativeContext.lineJoin=t}get lineJoin(){return this.nativeContext.lineJoin}set lineWidth(t){this.nativeContext.lineWidth=t}get lineWidth(){return this.nativeContext.lineWidth}set miterLimit(t){this.nativeContext.miterLimit=t}get miterLimit(){return this.nativeContext.miterLimit}set shadowBlur(t){this.nativeContext.shadowBlur=t}get shadowBlur(){return this.nativeContext.shadowBlur}set shadowColor(t){this.nativeContext.shadowColor=t}get shadowColor(){return this.nativeContext.shadowColor}set shadowOffsetX(t){this.nativeContext.shadowOffsetX=t}get shadowOffsetX(){return this.nativeContext.shadowOffsetX}set shadowOffsetY(t){this.nativeContext.shadowOffsetY=t}get shadowOffsetY(){return this.nativeContext.shadowOffsetY}set strokeStyle(t){this.nativeContext.strokeStyle=t}get strokeStyle(){return this.nativeContext.strokeStyle}set textAlign(t){this.nativeContext.textAlign=t}get textAlign(){return this.nativeContext.textAlign}set textBaseline(t){this.nativeContext.textBaseline=t}get textBaseline(){return this.nativeContext.textBaseline}get inuse(){return!!this._inuse}set inuse(t){t!==!!this._inuse&&(this._inuse=t,t?(this.nativeContext.save(),this.reset()):this.nativeContext.restore())}constructor(t,e){this.fillAttributes=Object.assign(Object.assign({},bo),{opacity:1}),this.strokeAttributes=Object.assign(Object.assign({},yo),{opacity:1}),this.textAttributes=Object.assign(Object.assign({},Co),{opacity:1}),this._clearShadowStyle=!1,this._clearFilterStyle=!1,this._clearGlobalCompositeOperationStyle=!1;const i=t.nativeCanvas.getContext("2d");if(!i)throw new Error("发生错误，获取2d上下文失败");this.nativeContext=i,this.canvas=t,this.matrix=new Ie(1,0,0,1,0,0),this.stack=[],this.dpr=e,this.applyedMatrix=new Ie(1,0,0,1,0,0),this._clearMatrix=new Ie(1,0,0,1,0,0),this.baseGlobalAlpha=1}reset(){this.stack.length&&Vt.getInstance().warn("可能存在bug，matrix没有清空"),this.matrix.setValue(1,0,0,1,0,0),this.applyedMatrix=new Ie(1,0,0,1,0,0),this.stack.length=0,this.nativeContext.setTransform(1,0,0,1,0,0)}getCanvas(){return this.canvas}getContext(){return this.nativeContext}setTransformForCurrent(){!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this.applyedMatrix.equalToMatrix(this.matrix)||(this.applyedMatrix.setValue(this.matrix.a,this.matrix.b,this.matrix.c,this.matrix.d,this.matrix.e,this.matrix.f),this.nativeContext.setTransform(this.matrix.a,this.matrix.b,this.matrix.c,this.matrix.d,this.matrix.e,this.matrix.f))}get currentMatrix(){return this.matrix}cloneMatrix(t){return aa.allocateByObj(t)}clear(){this.save(),this.resetTransform(),this.nativeContext.clearRect(0,0,this.canvas.width,this.canvas.height),this.restore()}restore(){this.nativeContext.restore(),this.stack.length>0&&(aa.free(this.matrix),this.matrix=this.stack.pop(),this.setTransformForCurrent(!0))}highPerformanceRestore(){this.stack.length>0&&(aa.free(this.matrix),this.matrix=this.stack.pop())}rotate(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.matrix.rotate(t),e&&this.setTransformForCurrent()}save(){const t=this.cloneMatrix(this.matrix);this.stack.push(t),this.nativeContext.save()}highPerformanceSave(){const t=this.cloneMatrix(this.matrix);this.stack.push(t)}scale(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.matrix.scale(t,e),i&&this.setTransformForCurrent()}setScale(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.matrix.setScale(t,e),i&&this.setTransformForCurrent()}scalePoint(t,e,i,o){let n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];this.translate(i,o,!1),this.scale(t,e,!1),this.translate(-i,-o,!1),n&&this.setTransformForCurrent()}setTransform(t,e,i,o,n,r){let s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:this.dpr;this.matrix.setValue(a*t,a*e,a*i,a*o,a*n,a*r),s&&this.setTransformForCurrent()}setTransformFromMatrix(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.dpr;this.matrix.setValue(t.a*i,t.b*i,t.c*i,t.d*i,t.e*i,t.f*i),e&&this.setTransformForCurrent()}resetTransform(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.dpr;this.setTransform(e,0,0,e,0,0),t&&this.setTransformForCurrent()}transform(t,e,i,o,n,r){let s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];this.matrix.multiply(t,e,i,o,n,r),s&&this.setTransformForCurrent()}transformFromMatrix(t,e){this.matrix.multiply(t.a,t.b,t.c,t.d,t.e,t.f),e&&this.setTransformForCurrent()}translate(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.matrix.translate(t,e),i&&this.setTransformForCurrent()}rotateDegrees(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=t*Math.PI/180;this.rotate(i,e)}rotateAbout(t,e,i){let o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.translate(e,i,!1),this.rotate(t,!1),this.translate(-e,-i,!1),o&&this.setTransformForCurrent()}rotateDegreesAbout(t,e,i){let o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.translate(e,i,!1),this.rotateDegrees(t,!1),this.translate(-e,-i,!1),o&&this.setTransformForCurrent()}beginPath(){this.disableBeginPath||this.nativeContext.beginPath()}clip(t,e){t?"string"==typeof t?this.nativeContext.clip(t):this.nativeContext.clip(t,e):this.nativeContext.clip()}arc(t,e,i,o,n,r,s){if(s=s||0,this.camera){const a=[];((t,e,i,o,n,r,s,a)=>{if(a)for(;i>e;)i-=ne;else for(;i<e;)i+=ne;const l=ee/3*(i>e?1:-1);let h=e,d=h;for(;d!==i;){d=l>0?Math.min(d+l,i):Math.max(d+l,i);const e=Math.abs(d-h),a=4*Math.tan(e/4)/3,c=d<h?-1:1,u=Math.cos(h),g=Math.sin(h),p=Math.cos(d),f=Math.sin(d),v=u*r+o,b=g*s+n,m=p*r+o,y=f*s+n,C=r*a*c,w=s*a*c;t.push([v-C*g,b+w*u,m+C*f,y-w*p,m,y]),h=d}})(a,o,n,t,e,i,i,r);for(let t=0;t<a.length;++t){const e=a[t];this.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5],s)}}else this.nativeContext.arc(t,e,Math.max(0,i),o,n,r)}arcTo(t,e,i,o,n){this.nativeContext.arcTo(t,e,i,o,n)}bezierCurveTo(t,e,i,o,n,r,s){if(s=s||0,this.camera){let a=s,l=s;this.modelMatrix&&(ra(Xg,[t,e,s],this.modelMatrix),t=Xg[0],e=Xg[1],a=Xg[2],ra(Xg,[i,o,s],this.modelMatrix),i=Xg[0],o=Xg[1],l=Xg[2],ra(Xg,[n,r,s],this.modelMatrix),n=Xg[0],r=Xg[1],s=Xg[2]);let h=this.camera.vp(n,r,s);n=h.x,r=h.y,h=this.camera.vp(t,e,a),t=h.x,e=h.y,h=this.camera.vp(i,o,l),i=h.x,o=h.y}this.nativeContext.bezierCurveTo(t,e,i,o,n,r)}closePath(){this.nativeContext.closePath()}ellipse(t,e,i,o,n,r,s,a){null==a?this.nativeContext.ellipse(t,e,i,o,n,r,s):this.nativeContext.ellipse(t,e,i,o,n,r,s,a)}lineTo(t,e,i){if(i=i||0,this.camera){this.modelMatrix&&(ra(Xg,[t,e,i],this.modelMatrix),t=Xg[0],e=Xg[1],i=Xg[2]);const o=this.camera.vp(t,e,i);t=o.x,e=o.y}this.nativeContext.lineTo(t,e)}moveTo(t,e,i){if(i=i||0,this.camera){this.modelMatrix&&(ra(Xg,[t,e,i],this.modelMatrix),t=Xg[0],e=Xg[1],i=Xg[2]);const o=this.camera.vp(t,e,i);t=o.x,e=o.y}this.nativeContext.moveTo(t,e)}quadraticCurveTo(t,e,i,o,n){if(n=n||0,this.camera){let r=n;this.modelMatrix&&(ra(Xg,[t,e,n],this.modelMatrix),t=Xg[0],e=Xg[1],r=Xg[2],ra(Xg,[i,o,n],this.modelMatrix),i=Xg[0],o=Xg[1],n=Xg[2]);let s=this.camera.vp(i,o,n);i=s.x,o=s.y,s=this.camera.vp(t,e,r),t=s.x,e=s.y}this.nativeContext.quadraticCurveTo(t,e,i,o)}rect(t,e,i,o,n){n=n||0,this.camera?(this.moveTo(t,e,n),this.lineTo(t+i,e,n),this.lineTo(t+i,e+o,n),this.lineTo(t,e+o,n),this.closePath()):this.nativeContext.rect(t,e,i,o)}createImageData(){const t=arguments;return 2===t.length?this.nativeContext.createImageData(t[0],t[1]):1===t.length?this.nativeContext.createImageData(t[0]):null}createLinearGradient(t,e,i,o){return isFinite(t+e+i+o)||(t=0,e=0,i=0,o=0),this.nativeContext.createLinearGradient(t,e,i,o)}createPattern(t,e){return 0===t.width||0===t.height?null:this.nativeContext.createPattern(t,e)}createRadialGradient(t,e,i,o,n,r){return this.nativeContext.createRadialGradient(t,e,i,o,n,r)}createConicGradient(t,e,i,o){let n,r=!1;const s=this;return{stops:[],addColorStop(t,e){this.stops.push([t,e]),r=!0},GetPattern(a,l,h){return r&&(h||(h=o-i),n=function(t,e,i,o,n,r,s,a,l){const h=Math.floor(180*n/Math.PI),d=Ds.GetCanvas(),c=Ds.GetCtx();if(!c)return null;const u=Ns.GetSize(a),g=Ns.GetSize(l);let p=Ns.Get(e,i,o,r,s,u,g);if(p)return p;const f=Math.sqrt(Math.max(Math.max(Math.pow(i,2)+Math.pow(o,2),Math.pow(u-i,2)+Math.pow(o,2)),Math.max(Math.pow(u-i,2)+Math.pow(g-o,2),Math.pow(i,2)+Math.pow(g-o,2)))),v=h+1,b=n/Math.max(1,v-1),m=Ws.getInstance().GetOrCreate(i,o,u,g,e,v),y=2*Math.PI*f/360;d.width=u,d.height=g,c.setTransform(1,0,0,1,0,0),c.clearRect(0,0,u,g),c.translate(i,o),c.rotate(r);for(let t=0,e=v-1;t<e&&!(r+t*b>s);t++){const e=m.getColor(t);c.beginPath(),c.rotate(b),c.moveTo(0,0),c.lineTo(f,-2*y),c.lineTo(f,0),c.fillStyle=e,c.closePath(),c.fill()}const C=c.getImageData(0,0,u,g);return d.width=C.width,d.height=C.height,c.putImageData(C,0,0),p=t.createPattern(d,"no-repeat"),p&&Ns.Set(e,i,o,r,s,p,u,g),p}(s,this.stops,t,e,h,i,o,a,l),r=!1),n}}}fill(t,e){this.disableFill||(t?this.nativeContext.fill(t):this.nativeContext.fill())}fillRect(t,e,i,o){this.nativeContext.fillRect(t,e,i,o)}clearRect(t,e,i,o){this.nativeContext.clearRect(t,e,i,o)}project(t,e,i){if(i=i||0,this.camera){this.modelMatrix&&(ra(Xg,[t,e,i],this.modelMatrix),t=Xg[0],e=Xg[1],i=Xg[2]);const o=this.camera.vp(t,e,i);t=o.x,e=o.y}return{x:t,y:e}}view(t,e,i){return i=i||0,this.camera?(this.modelMatrix&&(ra(Xg,[t,e,i],this.modelMatrix),t=Xg[0],e=Xg[1],i=Xg[2]),this.camera.view(t,e,i)):[t,e,i]}fillText(t,e,i,o){if(o=o||0,this.camera){this.modelMatrix&&(ra(Xg,[e,i,o],this.modelMatrix),e=Xg[0],i=Xg[1],o=Xg[2]);const t=this.camera.vp(e,i,o);e=t.x,i=t.y}this.nativeContext.fillText(t,e,i)}getImageData(t,e,i,o){return this.nativeContext.getImageData(t,e,i,o)}getLineDash(){return this.nativeContext.getLineDash()}isPointInPath(t,e){return this.nativeContext.isPointInPath(t,e)}isPointInStroke(t,e){return this.nativeContext.isPointInStroke(t,e)}measureText(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:zo.global.measureTextMethod;var i,o;if(!e||"native"===e)return this.nativeContext.measureText(t);this.mathTextMeasure||(this.mathTextMeasure=zo.graphicUtil.createTextMeasureInstance({},{},(()=>this.canvas.nativeCanvas)));const n=null!==(i=this.fontFamily)&&void 0!==i?i:Co.fontFamily,r=null!==(o=this.fontSize)&&void 0!==o?o:Co.fontSize;return this.mathTextMeasure.textSpec.fontFamily===n&&this.mathTextMeasure.textSpec.fontSize===r||(this.mathTextMeasure.textSpec.fontFamily=n,this.mathTextMeasure.textSpec.fontSize=r,this.mathTextMeasure._numberCharSize=null,this.mathTextMeasure._fullCharSize=null,this.mathTextMeasure._letterCharSize=null,this.mathTextMeasure._specialCharSizeMap={}),this.mathTextMeasure.measure(t,e)}putImageData(t,e,i){this.nativeContext.putImageData(t,e,i)}setLineDash(t){const e=arguments,i=this.nativeContext;this.nativeContext.setLineDash?e[0]&&i.setLineDash(e[0]):"mozDash"in i?i.mozDash=e[0]:"webkitLineDash"in i&&(i.webkitLineDash=e[0])}stroke(t){this.disableStroke||(t?this.nativeContext.stroke(t):this.nativeContext.stroke())}strokeRect(t,e,i,o){this.nativeContext.strokeRect(t,e,i,o)}strokeText(t,e,i,o){if(o=o||0,this.camera){this.modelMatrix&&(ra(Xg,[e,i,o],this.modelMatrix),e=Xg[0],i=Xg[1],o=Xg[2]);const t=this.camera.vp(e,i,o);e=t.x,i=t.y}this.nativeContext.strokeText(t,e,i)}drawImage(){const t=this.nativeContext,e=arguments;3===e.length?t.drawImage(e[0],e[1],e[2]):5===e.length?t.drawImage(e[0],e[1],e[2],e[3],e[4]):9===e.length&&t.drawImage(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}setCommonStyle(t,e,i,o,n){if(Array.isArray(n)){if(n.length<=1)return this._setCommonStyle(t,e,i,o,n[0]);const r=Object.create(n[0]);return n.forEach(((t,e)=>{0!==e&&Object.assign(r,t)})),this._setCommonStyle(t,e,i,o,r)}return this._setCommonStyle(t,e,i,o,n)}_setCommonStyle(t,e,i,o,n){const r=this.nativeContext;n||(n=this.fillAttributes);const{fillOpacity:s=n.fillOpacity,opacity:a=n.opacity,fill:l=n.fill}=e;r.globalAlpha=s*a*this.baseGlobalAlpha,s>1e-12&&a>1e-12&&(r.fillStyle=Go(this,l,t,i,o))}setShadowBlendStyle(t,e,i){if(Array.isArray(i)){if(i.length<=1)return this._setShadowBlendStyle(t,i[0]);const o=Object.create(i[0]);return i.forEach(((t,e)=>{0!==e&&Object.assign(o,t)})),this._setShadowBlendStyle(t,e,o)}return this._setShadowBlendStyle(t,e,i)}_setShadowBlendStyle(t,e,i){const o=this.nativeContext;i||(i=this.fillAttributes);const{opacity:n=i.opacity,shadowBlur:r=i.shadowBlur,shadowColor:s=i.shadowColor,shadowOffsetX:a=i.shadowOffsetX,shadowOffsetY:l=i.shadowOffsetY,blur:h=i.blur,globalCompositeOperation:d=i.globalCompositeOperation}=e;n<=1e-12||(r||a||l?(o.shadowBlur=r*this.dpr,o.shadowColor=s,o.shadowOffsetX=a*this.dpr,o.shadowOffsetY=l*this.dpr,this._clearShadowStyle=!0):this._clearShadowStyle&&(o.shadowBlur=0,o.shadowOffsetX=0,o.shadowOffsetY=0),h?(o.filter=`blur(${h}px)`,this._clearFilterStyle=!0):this._clearFilterStyle&&(o.filter="blur(0px)",this._clearFilterStyle=!1),d?(o.globalCompositeOperation=d,this._clearGlobalCompositeOperationStyle=!0):this._clearGlobalCompositeOperationStyle&&(o.globalCompositeOperation="source-over",this._clearGlobalCompositeOperationStyle=!1))}setStrokeStyle(t,e,i,o,n){if(Array.isArray(n)){if(n.length<=1)return this._setStrokeStyle(t,e,i,o,n[0]);const r=Object.create(n[0]);return n.forEach(((t,e)=>{0!==e&&Object.assign(r,t)})),this._setStrokeStyle(t,e,i,o,r)}return this._setStrokeStyle(t,e,i,o,n)}_setStrokeStyle(t,e,i,o,n){const r=this.nativeContext;n||(n=this.strokeAttributes);const{strokeOpacity:s=n.strokeOpacity,opacity:a=n.opacity}=e;if(r.globalAlpha=s*a*this.baseGlobalAlpha,s>1e-12&&a>1e-12){const{lineWidth:s=n.lineWidth,stroke:a=n.stroke,lineJoin:l=n.lineJoin,lineDash:h=n.lineDash,lineCap:d=n.lineCap,miterLimit:c=n.miterLimit,keepStrokeScale:u=n.keepStrokeScale}=e;r.lineWidth=u?s:No(this,s,this.dpr),r.strokeStyle=Go(this,a,t,i,o),r.lineJoin=l,h&&r.setLineDash(h),r.lineCap=d,r.miterLimit=c}}setTextStyleWithoutAlignBaseline(t,e,i){const o=this.nativeContext;e||(e=this.textAttributes);const{scaleIn3d:n=e.scaleIn3d}=t;t.font?o.font=t.font:o.font=Le(t,e,n&&this.camera&&this.camera.getProjectionScale(i));const{fontFamily:r=e.fontFamily,fontSize:s=e.fontSize}=t;this.fontFamily=r,this.fontSize=s,o.textAlign="left",o.textBaseline="alphabetic"}setTextStyle(t,e,i){var o,n;const r=this.nativeContext;e||(e=this.textAttributes),t.font?r.font=t.font:r.font=Le(t,e,this.camera&&this.camera.getProjectionScale(i));const{fontFamily:s=e.fontFamily,fontSize:a=e.fontSize}=t;this.fontFamily=s,this.fontSize=a,r.textAlign=null!==(o=t.textAlign)&&void 0!==o?o:e.textAlign,r.textBaseline=null!==(n=t.textBaseline)&&void 0!==n?n:e.textBaseline}draw(){}clearMatrix(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.dpr;this.setTransformFromMatrix(this._clearMatrix,t,e)}setClearMatrix(t,e,i,o,n,r){this._clearMatrix.setValue(t,e,i,o,n,r)}onlyTranslate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.dpr;return this.matrix.a===t&&0===this.matrix.b&&0===this.matrix.c&&this.matrix.d===t}release(){this.stack.forEach((t=>aa.free(t))),this.stack.length=0}};Yg.env="browser",Yg=Ug([C(),$g("design:paramtypes",[Object,Number])],Yg);var Kg=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},qg=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let Zg=class extends Hu{constructor(t){super(t)}init(t){const{container:e}=t;if("string"==typeof e){const t=zo.global.getElementById(e);t&&(this._container=t)}else this._container=e;this._context=new Yg(this,this._dpr),this.initStyle()}initStyle(){if(!this.controled)return;const{nativeCanvas:t}=this;t.width=this._pixelWidth,t.height=this._pixelHeight,!t.style||this.setCanvasStyle(t,this._x,this._y,this._displayWidth,this._displayHeight),this._container&&this._container.appendChild(t),this.visiable||this.hide()}hide(){this._nativeCanvas&&(this._nativeCanvas.style.display="none")}show(){this._nativeCanvas&&(this._nativeCanvas.style.display="block")}applyPosition(){const t=this._nativeCanvas;t.style.position="absolute",t.style.top=`${this._y}px`,t.style.left=`${this._x}px`}resetStyle(t){if(!this.controled)return;const{width:e=this._displayWidth,height:i=this._displayHeight,dpr:o=this._dpr,x:n=this._x,y:r=this._y}=t,{nativeCanvas:s}=this;s.width=e*o,s.height=i*o,!s.style||this.setCanvasStyle(s,n,r,e,i),t.id&&(s.id=t.id),this.visiable||this.hide()}setCanvasStyle(t,e,i,o,n){this.controled&&(t.style.width=`${o}px`,t.style.height=`${n}px`)}toDataURL(t,e){return"image/jpeg"===t?this._nativeCanvas.toDataURL(t,e):"image/png"===t?this._nativeCanvas.toDataURL(t):this._nativeCanvas.toDataURL(t,e)}resize(t,e){this.controled&&(this._pixelWidth=t*this._dpr,this._pixelHeight=e*this._dpr,this._displayWidth=t,this._displayHeight=e,this._nativeCanvas.style&&(this._nativeCanvas.style.width=`${t}px`,this._nativeCanvas.style.height=`${e}px`),this._nativeCanvas.width=this._pixelWidth,this._nativeCanvas.height=this._pixelHeight,this._context.dpr=this._dpr)}};function Jg(t,e){return new a((i=>{i(an).toDynamicValue((()=>e=>new t(e))).whenTargetNamed(t.env),i(ln).toDynamicValue((()=>(t,i)=>new e(t,i))).whenTargetNamed(e.env)}))}Zg.env="browser",Zg=Kg([C(),qg("design:paramtypes",[Object])],Zg);const Qg=Jg(Zg,Yg);var tp=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},ep=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ip=function(t,e){return function(i,o){e(i,o,t)}};let op=class extends Vu{constructor(t,e,i){super(i),this.contributions=t,this.drawContribution=e,this.pickItemInterceptorContributions=i,this.global.hooks.onSetEnv.tap("canvas-picker-service",((t,e,i)=>{this.configure(i,e)})),this.configure(this.global,this.global.env),this.pickerMap=new Map,this.init()}init(){this.contributions.getContributions().forEach((t=>{this.pickerMap.set(t.numberType,t)})),super._init()}configure(t,e){this.pickCanvas=dn.shareCanvas(),this.pickContext=this.pickCanvas.getContext("2d")}pickItem(t,e,i,o){if(!1===t.attribute.pickable)return null;if(this.InterceptorContributions.length)for(let n=0;n<this.InterceptorContributions.length;n++){const r=this.InterceptorContributions[n];if(r.beforePickItem){const n=r.beforePickItem(t,this,e,o,{parentMatrix:i});if(n)return n}}const n=this.pickerMap.get(t.numberType);if(!n)return null;const r=n.contains(t,e,o),s=r?t:null,a={graphic:s,params:r};if(s)return a;if(this.InterceptorContributions.length)for(let n=0;n<this.InterceptorContributions.length;n++){const r=this.InterceptorContributions[n];if(r.afterPickItem){const n=r.afterPickItem(t,this,e,o,{parentMatrix:i});if(n)return n}}return a}};op=tp([C(),ip(0,m(O)),ip(0,w(Wg)),ip(1,m(uh)),ip(2,m(O)),ip(2,w(kc)),ep("design:paramtypes",[Object,Object,Object])],op);var np=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let rp=class{constructor(){this.type="group",this.numberType=is}contains(t,e,i){return!1}};rp=np([C()],rp);const sp=new a(((t,e,i,o)=>{sp.__vloaded||(sp.__vloaded=!0,t(Dg).to(rp).inSingletonScope(),t(Wg).toService(Dg),z(t,Wg))}));sp.__vloaded=!1;var ap=sp;const lp=new a(((t,e,i,o)=>{i(op)||t(op).toSelf().inSingletonScope(),i(Mh)?o(Mh).toService(op):t(Mh).toService(op)}));var hp,dp=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},cp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let up=hp=class extends Wu{get container(){return this.canvas.nativeCanvas.parentElement}static GenerateCanvasId(){return`${hp.idprefix}_${hp.prefix_count++}`}constructor(){super(),this.type="browser",this._canvasIsIntersecting=!0,this.global=zo.global,this.viewBox=new Fe,this.modelMatrix=new Ie(1,0,0,1,0,0)}getTitle(){return this.canvas.id&&this.canvas.id.toString()}getWH(){return{width:this.canvas.width/(this.canvas.dpr||1),height:this.canvas.height/(this.canvas.dpr||1)}}getXY(){return this.canvas.nativeCanvas.getBoundingClientRect()}createWindow(t){t.canvas?this.createWindowByCanvas(t):this.createWindowByConfig(t),this.postInit()}postInit(){if(this.global.optimizeVisible)try{this.observerCanvas()}catch(t){}}isElementVisible(t){const e=t.getBoundingClientRect(),i=window.innerWidth||document.documentElement.clientWidth,o=window.innerHeight||document.documentElement.clientHeight;return!(e.right<0||e.bottom<0||e.left>i||e.top>o)}observerCanvas(){this._canvasIsIntersecting=this.isElementVisible(this.canvas.nativeCanvas);const t=new IntersectionObserver(((t,e)=>{t.forEach((t=>{this._canvasIsIntersecting!==t.isIntersecting?(this._canvasIsIntersecting=t.isIntersecting,this._onVisibleChangeCb&&this._onVisibleChangeCb(t.isIntersecting)):this._canvasIsIntersecting=t.isIntersecting}))}));t&&t.observe(this.canvas.nativeCanvas)}createWindowByConfig(t){const e=this.global.createCanvas({width:t.width,height:t.height});let i;if(i="string"==typeof t.container?this.global.getElementById(t.container):t.container?t.container:this.global.getRootElement(),!i)throw new Error("发生错误，containerId可能传入有误");t.offscreen?i=null:i.appendChild(e);const o={width:t.width,height:t.height,dpr:t.dpr,nativeCanvas:e,container:i,id:hp.GenerateCanvasId(),canvasControled:!0};this.canvas=new Zg(o)}createWindowByCanvas(t){var e;let i;if("string"==typeof t.canvas){if(i=this.global.getElementById(t.canvas),!i)throw new Error("canvasId 参数不正确，请确认canvas存在并插入dom")}else i=t.canvas;if(!i)throw new Error("发生错误，传入的canvas不正确");let o=t.width,n=t.height;if(null==o||null==n||!t.canvasControled){const t=i.getBoundingClientRect();o=t.width,n=t.height}let r=t.dpr;null==r&&(r=null!==(e=i.getContext("2d").pixelRatio)&&void 0!==e?e:i.width/o),this.canvas=new Zg({width:o,height:n,dpr:r,nativeCanvas:i,canvasControled:t.canvasControled})}releaseWindow(){this.canvas.release()}resizeWindow(t,e){this.canvas.resize(t,e)}setDpr(t){this.canvas.dpr=t}getContext(){return this.canvas.getContext()}getNativeHandler(){return this.canvas}getDpr(){return this.canvas.dpr}addEventListener(t,e,i){return this.canvas.nativeCanvas.addEventListener(t,e,i)}removeEventListener(t,e,i){return this.canvas.nativeCanvas.removeEventListener(t,e,i)}dispatchEvent(t){return this.canvas.nativeCanvas.dispatchEvent(t)}getStyle(){var t;return null!==(t=this.canvas.nativeCanvas.style)&&void 0!==t?t:{}}setStyle(t){this.canvas.nativeCanvas.style=t}getBoundingClientRect(){const t=this.canvas.nativeCanvas,e=this.getWH();return t.parentElement?this.canvas.nativeCanvas.getBoundingClientRect():{x:0,y:0,width:e.width,height:e.height,left:0,top:0,right:0,bottom:0}}clearViewBox(t){const e=this.viewBox,i=this.getContext(),o=this.getDpr();i.nativeContext.save(),i.nativeContext.setTransform(o,0,0,o,0,0),i.clearRect(e.x1,e.y1,e.x2-e.x1,e.y2-e.y1),t&&(i.fillStyle=t,i.fillRect(e.x1,e.y1,e.x2-e.x1,e.y2-e.y1)),i.nativeContext.restore()}isVisible(t){return this._canvasIsIntersecting}onVisibleChange(t){this._onVisibleChangeCb=t}getTopLeft(t){return this.global.getElementTopLeft(this.canvas.nativeCanvas,t)}};up.env="browser",up.idprefix="visactor_window",up.prefix_count=0,up=hp=dp([C(),cp("design:paramtypes",[])],up);const gp=new a((t=>{t(up).toSelf(),t(pn).toDynamicValue((t=>t.container.get(up))).whenTargetNamed(up.env)}));var pp=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},fp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},vp=function(t,e,i,o){return new(i||(i=Promise))((function(n,r){function s(t){try{l(o.next(t))}catch(t){r(t)}}function a(t){try{l(o.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((o=o.apply(t,e||[])).next())}))};class bp{get x1(){return this.dom.getBoundingClientRect().left}get x2(){return this.dom.getBoundingClientRect().right}get y1(){return this.dom.getBoundingClientRect().top}get y2(){return this.dom.getBoundingClientRect().bottom}get width(){return this.dom.getBoundingClientRect().width}get height(){return this.dom.getBoundingClientRect().height}constructor(t){this.dom=t}}function mp(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=document.createElement("img");if(zo.global.isImageAnonymous&&(i.crossOrigin="anonymous"),e){const e=new Blob([t],{type:"image/svg+xml"});t=window.URL.createObjectURL(e)}return i.src=t,i.complete?Promise.resolve(i):new Promise(((t,e)=>{i.onload=()=>{t(i)},i.onerror=()=>{e(new Error("加载失败"))}}))}let yp=class extends Iu{constructor(){super(),this.type="browser",this.supportEvent=!0;try{this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.supportsMouseEvents=!!globalThis.MouseEvent}catch(t){this.supportsTouchEvents=!1,this.supportsPointerEvents=!1,this.supportsPointerEvents=!1}this.applyStyles=!0}mapToCanvasPoint(t,e){var i,o;let n=0,r=0,s=0,a=0;if(t.changedTouches){const e=null!==(i=t.changedTouches[0])&&void 0!==i?i:{};n=e.clientX||0,r=e.clientY||0,s=n,a=r}else n=t.clientX||0,r=t.clientY||0,s=t.offsetX||0,a=t.offsetY||0;if(e){const t=n,i=r,s=e.getBoundingClientRect(),a=null===(o=e.getNativeHandler)||void 0===o?void 0:o.call(e).nativeCanvas;let l,h;return a&&(l=s.width/a.offsetWidth,h=s.height/a.offsetHeight),{x:(t-s.left)/(gt(l)?l:1),y:(i-s.top)/(gt(h)?h:1)}}return{x:s,y:a}}getNativeAABBBounds(t){let e=t;if("string"==typeof t&&(e=(new DOMParser).parseFromString(t,"text/html").firstChild,e.lastChild&&(e=e.lastChild.firstChild)),e.getBoundingClientRect){const t=e.getBoundingClientRect();return new bp(t)}return new Fe}removeDom(t){return t.parentElement.removeChild(t),!0}updateDom(t,e){const{width:i,height:o,style:n}=e;return n&&(lt(n)?t.setAttribute("style",n):Object.keys(n).forEach((e=>{t.style[e]=n[e]}))),null!=i&&(t.style.width=`${i}px`),null!=o&&(t.style.height=`${o}px`),!0}createDom(t){const{tagName:e="div",parent:i}=t,o=document.createElement(e);if(this.updateDom(o,t),i){const t=lt(i)?this.getElementById(i):i;t&&t.appendChild&&t.appendChild(o)}return o}loadImage(t){return mp(t,!1).then((t=>({data:t,loadState:"success"}))).catch((()=>({data:null,loadState:"fail"})))}loadSvg(t){return mp(t,!0).then((t=>({data:t,loadState:"success"}))).catch((()=>({data:null,loadState:"fail"})))}createCanvas(t){var e,i;const o=document.createElement("canvas");t.id&&(o.id=null!==(e=t.id)&&void 0!==e?e:s.GenAutoIncrementId().toString());const n=null!==(i=t.dpr)&&void 0!==i?i:window.devicePixelRatio;return t.width&&t.height&&(o.style.width=`${t.width}px`,o.style.height=`${t.height}px`,o.width=t.width*n,o.height=t.height*n),o}createOffscreenCanvas(t){var e;const i=null!==(e=t.dpr)&&void 0!==e?e:window.devicePixelRatio;return new OffscreenCanvas(t.width*i,t.height*i)}releaseCanvas(t){let e;e="string"==typeof t?document.getElementById(t):t,e&&e.parentElement&&e.parentElement.removeChild(e)}getDevicePixelRatio(){return window.devicePixelRatio}getRequestAnimationFrame(){return window.requestAnimationFrame}getCancelAnimationFrame(){return window.cancelAnimationFrame}addEventListener(t,e,i){return document.addEventListener(t,e,i)}removeEventListener(t,e,i){return document.removeEventListener(t,e,i)}dispatchEvent(t){return document.dispatchEvent(t)}getElementById(t){return document.getElementById(t)}getRootElement(){return document.body}getDocument(){return document}release(){}getElementTop(t,e){let i=t.offsetTop,o=t.offsetParent;for(;null!==o;)i+=o.offsetTop,o=o.offsetParent;return i}getElementLeft(t,e){let i=t.offsetLeft,o=t.offsetParent;for(;null!==o;)i+=o.offsetLeft,o=o.offsetParent;return i}getElementTopLeft(t,e){let i=t.offsetTop,o=t.offsetLeft,n=t.offsetParent;for(;null!==n;)i+=n.offsetTop,o+=n.offsetLeft,n=n.offsetParent;return{top:i,left:o}}loadFont(t,e,i){return vp(this,void 0,void 0,(function*(){return new FontFace(t,lt(e)?`url(${e})`:e,i).load().then((function(t){return document.fonts.add(t),{loadState:"success"}})).catch((function(t){return{loadState:"fail"}}))}))}};yp=pp([C(),fp("design:paramtypes",[])],yp);const Cp=new a((t=>{Cp.isBrowserBound||(Cp.isBrowserBound=!0,t(yp).toSelf().inSingletonScope(),t(N).toService(yp))}));function wp(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];wp.__loaded||(wp.__loaded=!0,t.load(Cp),t.load(Qg),t.load(gp),e&&function(t){t.load(ap),t.load(lp)}(t))}Cp.isBrowserBound=!1,wp.__loaded=!1;class xp{contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if("imprecise"===t.attribute.pickMode)return!0;const{pickContext:o}=null!=i?i:{};if(!o)return!1;const n=t.getGraphicTheme();o.highPerformanceSave();let{x:r=n.x,y:s=n.y}=t.attribute;if(t.transMatrix.onlyTranslate()){const e=t.getOffsetXY(n);r+=e.x,s+=e.y,o.setTransformForCurrent()}else r=0,s=0,o.transformFromMatrix(t.transMatrix,!0);let a=!1;return this.canvasRenderer.drawShape(t,o,r,s,{},null,((t,i,o)=>!!a||(a=t.isPointInPath(e.x,e.y),a)),((t,i,n)=>{if(a)return!0;const r=i.lineWidth||n.lineWidth,s=i.pickStrokeBuffer||n.pickStrokeBuffer,l=i.keepStrokeScale||n.keepStrokeScale;return o.lineWidth=l?r+s:No(o,r+s,o.dpr),a=t.isPointInStroke(e.x,e.y),a})),o.highPerformanceRestore(),a}}var _p=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Sp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ap=function(t,e){return function(i,o){e(i,o,t)}};let Bp=class extends xp{constructor(t){super(),this.canvasRenderer=t,this.type="arc",this.numberType=Jr}};Bp=_p([C(),Ap(0,m(th)),Sp("design:paramtypes",[Object])],Bp);let Rp=!1;const Tp=new a(((t,e,i,o)=>{Rp||(Rp=!0,t(Cg).to(Bp).inSingletonScope(),t(yg).toService(Cg))}));var kp=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Mp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Lp=function(t,e){return function(i,o){e(i,o,t)}};let Pp=class extends xp{constructor(t){super(),this.canvasRenderer=t,this.type="circle",this.numberType=es}};Pp=kp([C(),Lp(0,m(eh)),Mp("design:paramtypes",[Object])],Pp);let Ep=!1;const Hp=new a(((t,e,i,o)=>{Ep||(Ep=!0,t(wg).to(Pp).inSingletonScope(),t(yg).toService(wg))}));var Fp=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let Op=class{constructor(){this.type="image",this.numberType=os}contains(t,e,i){const{pickContext:o}=null!=i?i:{};return!!o&&!!t.AABBBounds.containsPoint(e)}};Op=Fp([C()],Op);let Ip=!1;const zp=new a(((t,e,i,o)=>{Ip||(Ip=!0,t(xg).to(Op).inSingletonScope(),t(Op).toService(xg))}));var Dp=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Wp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Np=function(t,e){return function(i,o){e(i,o,t)}};let Gp=class extends xp{constructor(t){super(),this.canvasRenderer=t,this.type="line",this.numberType=ns}};Gp=Dp([C(),Np(0,m(nh)),Wp("design:paramtypes",[Object])],Gp);let jp=!1;const Vp=new a(((t,e,i,o)=>{jp||(jp=!0,t(_g).to(Gp).inSingletonScope(),t(yg).toService(_g))}));var Up=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},$p=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Xp=function(t,e){return function(i,o){e(i,o,t)}};let Yp=class extends xp{constructor(t){super(),this.canvasRenderer=t,this.type="polygon",this.numberType=ss}};Yp=Up([C(),Xp(0,m(sh)),$p("design:paramtypes",[Object])],Yp);let Kp=!1;const qp=new a(((t,e,i,o)=>{Kp||(Kp=!0,t(Tg).to(Yp).inSingletonScope(),t(yg).toService(Tg))}));var Zp=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Jp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Qp=function(t,e){return function(i,o){e(i,o,t)}};let tf=class extends xp{constructor(t){super(),this.canvasRenderer=t,this.type="path",this.numberType=rs}};tf=Zp([C(),Qp(0,m(rh)),Jp("design:paramtypes",[Object])],tf);let ef=!1;const of=new a(((t,e,i,o)=>{ef||(ef=!0,t(Sg).to(tf).inSingletonScope(),t(yg).toService(Sg))})),nf=new Fe;class rf{constructor(){this.type="rect",this.numberType=as}contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if("imprecise"===t.attribute.pickMode)return!0;const{pickContext:o}=null!=i?i:{};if(!o)return!1;const n=t.getGraphicTheme(),{cornerRadius:r=n.cornerRadius}=t.attribute;let{x:s=n.x,y:a=n.y}=t.attribute;o.highPerformanceSave();let l=!0;if(t.transMatrix.onlyTranslate()){const e=t.getOffsetXY(n);s+=e.x,a+=e.y,o.setTransformForCurrent()}else s=0,a=0,l=!1,o.transformFromMatrix(t.transMatrix,!0);let h=!0;if(!l||t.shadowRoot||ut(r,!0)&&0!==r||ht(r)&&r.some((t=>0!==t)))h=!1,this.canvasRenderer.drawShape(t,o,s,a,{},null,((t,i,o)=>!!h||(h=t.isPointInPath(e.x,e.y),h)),((t,i,n)=>{if(h)return!0;const r=i.lineWidth||n.lineWidth,s=i.pickStrokeBuffer||n.pickStrokeBuffer,a=i.keepStrokeScale||n.keepStrokeScale;return o.lineWidth=a?r+s:No(o,r+s,o.dpr),h=t.isPointInStroke(e.x,e.y),h}));else{const{fill:i=n.fill,stroke:o=n.stroke,lineWidth:r=n.lineWidth}=t.attribute;if(i)h=!0;else if(o){const i=t.AABBBounds;nf.setValue(i.x1,i.y1,i.x2,i.y2),nf.expand(-r/2),h=!nf.containsPoint(e)}}return o.highPerformanceRestore(),h}}var sf=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},af=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},lf=function(t,e){return function(i,o){e(i,o,t)}};let hf=class extends rf{constructor(t){super(),this.canvasRenderer=t}};hf=sf([C(),lf(0,m(ah)),af("design:paramtypes",[Object])],hf);let df=!1;const cf=new a(((t,e,i,o)=>{df||(df=!0,t(Ag).to(hf).inSingletonScope(),t(yg).toService(Ag))}));let uf=!1;const gf=new a(((t,e,i,o)=>{uf||(uf=!0,t(xg).to(Op).inSingletonScope(),t(Op).toService(xg))}));var pf=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},ff=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},vf=function(t,e){return function(i,o){e(i,o,t)}};let bf=class extends xp{constructor(t){super(),this.canvasRenderer=t,this.type="symbol",this.numberType=hs}};bf=pf([C(),vf(0,m(lh)),ff("design:paramtypes",[Object])],bf);let mf=!1;const yf=new a(((t,e,i,o)=>{mf||(mf=!0,t(Bg).to(bf).inSingletonScope(),t(yg).toService(Bg))}));var Cf=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let wf=class{constructor(){this.type="text",this.numberType=ds}contains(t,e,i){return!!t.AABBBounds.containsPoint(e)}};wf=Cf([C()],wf);let xf=!1;const _f=new a(((t,e,i,o)=>{xf||(xf=!0,t(Rg).to(wf).inSingletonScope(),t(yg).toService(Rg))}));var Sf=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Af=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let Bf=class extends Yg{constructor(t,e){super(t,e);const i=t.nativeCanvas.getContext("2d");if(!i)throw new Error("发生错误，获取2d上下文失败");this.nativeContext=i,this.canvas=t,this.matrix=new Ie(1,0,0,1,0,0),this.stack=[],this.dpr=null!=e?e:1}release(){}};Bf.env="node",Bf=Sf([C(),Af("design:paramtypes",[Object,Number])],Bf);var Rf=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Tf=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let kf=class extends Hu{constructor(t){super(t)}init(){this._context=new Bf(this,this._dpr),this.nativeCanvas.width=this._pixelWidth,this.nativeCanvas.height=this._pixelHeight}release(){this._nativeCanvas.release&&et(this._nativeCanvas.release)&&this._nativeCanvas.release()}};kf.env="node",kf=Rf([C(),Tf("design:paramtypes",[Object])],kf);const Mf=Jg(kf,Bf);var Lf=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Pf=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ef=function(t,e){return function(i,o){e(i,o,t)}};let Hf=class extends Wu{get container(){return null}constructor(t){super(),this.global=t,this.type="node"}getTitle(){return""}getWH(){return{width:this.canvas.displayWidth,height:this.canvas.displayHeight}}getXY(){return{x:0,y:0}}createWindow(t){t.canvas?this.createWindowByCanvas(t):this.createWindowByConfig(t)}createWindowByConfig(t){const e=this.global.createCanvas({width:t.width,height:t.height}),i={width:t.width,height:t.height,dpr:t.dpr,nativeCanvas:e,id:s.GenAutoIncrementId().toString(),canvasControled:!0};this.canvas=new kf(i)}createWindowByCanvas(t){const e=t.canvas;let i=t.width,o=t.height;null!=i&&null!=o&&t.canvasControled||(i=e.width,o=e.height),this.canvas=new kf({width:i,height:o,dpr:1,nativeCanvas:e,canvasControled:t.canvasControled})}releaseWindow(){this.canvas.release()}resizeWindow(t,e){this.canvas.resize(t,e)}setDpr(t){this.canvas.dpr=t}getContext(){return this.canvas.getContext()}getNativeHandler(){return this.canvas}getDpr(){return this.canvas.dpr}getImageBuffer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image/png";return this.canvas.nativeCanvas.toBuffer(t)}addEventListener(t,e,i){}dispatchEvent(t){return!0}removeEventListener(t,e,i){}getStyle(){}setStyle(t){}getBoundingClientRect(){return null}clearViewBox(t){}};Hf.env="node",Hf=Lf([C(),Ef(0,m(G)),Pf("design:paramtypes",[Object])],Hf);const Ff=new a((t=>{t(Hf).toSelf(),t(pn).toDynamicValue((t=>t.container.get(Hf))).whenTargetNamed(Hf.env)}));var Of=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let If=class extends Iu{constructor(){super(...arguments),this.type="node",this._lastTime=0,this.supportEvent=!1}configure(t,e){t.env===this.type&&(t.setActiveEnvContribution(this),this.pkg=e)}getDynamicCanvasCount(){return 0}getStaticCanvasCount(){return 999}loadJson(t){const e=fetch(t).then((t=>t.json()));return e.then((t=>({data:t,state:"success"}))).catch((()=>({data:null,state:"fail"}))),e}loadArrayBuffer(t){return fetch(t).then((t=>t.arrayBuffer())).then((t=>({data:t,loadState:"success"}))).catch((()=>({data:null,loadState:"fail"})))}loadImage(t){const{loadImage:e}=this.pkg;return e?e(t).then((t=>({loadState:t?"success":"fail",data:t}))).catch((()=>({loadState:"fail",data:null}))):Promise.reject(new Error("node-canvas loadImage could not be found!"))}loadSvg(t){const e=this.pkg.Resvg;if(!e)return Promise.reject(new Error("@resvg/resvg-js svgParser could not be found!"));const i=new e(t).render().asPng();return this.loadImage(i)}createCanvas(t){return this.pkg.createCanvas(t.width,t.height)}releaseCanvas(t){}getDevicePixelRatio(){return 1}getRequestAnimationFrame(){return function(t){return gr.call(t)}}getCancelAnimationFrame(){return t=>{gr.clear(t)}}addEventListener(t,e,i){}removeEventListener(t,e,i){}getElementById(t){return null}getRootElement(){return null}dispatchEvent(t){}release(){}createOffscreenCanvas(t){}};If=Of([C()],If);const zf=new a((t=>{zf.isNodeBound||(zf.isNodeBound=!0,t(If).toSelf().inSingletonScope(),t(N).toService(If))}));function Df(t){Df.__loaded||(Df.__loaded=!0,t.load(zf),t.load(Mf),t.load(Ff))}zf.isNodeBound=!1,Df.__loaded=!1;var Wf=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Nf=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Gf=function(t,e){return function(i,o){e(i,o,t)}};let jf=class extends xp{constructor(t){super(),this.canvasRenderer=t,this.type="arc",this.numberType=Jr}};jf=Wf([C(),Gf(0,m(th)),Nf("design:paramtypes",[Object])],jf);let Vf=!1;const Uf=new a(((t,e,i,o)=>{Vf||(Vf=!0,t(kg).to(jf).inSingletonScope(),t(Wg).toService(kg))}));var $f=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Xf=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Yf=function(t,e){return function(i,o){e(i,o,t)}};let Kf=class extends rf{constructor(t){super(),this.canvasRenderer=t}};Kf=$f([C(),Yf(0,m(ah)),Xf("design:paramtypes",[Object])],Kf);let qf=!1;const Zf=new a(((t,e,i,o)=>{qf||(qf=!0,t(Hg).to(Kf).inSingletonScope(),t(Wg).toService(Hg))}));class Jf extends fa{contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if("imprecise"===t.attribute.pickMode)return!0;const{pickContext:o}=null!=i?i:{};if(!o)return!1;o.highPerformanceSave();const n=t.getGraphicTheme(),r=this.transform(t,n,o),{x:s,y:a,z:l,lastModelMatrix:h}=r;let d=e;if(o.camera){d=e.clone();const i=t.parent.globalTransMatrix;d.x=i.a*e.x+i.c*e.y+i.e,d.y=i.b*e.x+i.d*e.y+i.f}this.canvasRenderer.z=l;let c=!1;return this.canvasRenderer.drawShape(t,o,s,a,{},null,(t=>!!c||(c=t.isPointInPath(d.x,d.y),c)),((t,e,i)=>{if(c)return!0;const n=e.lineWidth||i.lineWidth,r=e.pickStrokeBuffer||i.pickStrokeBuffer,s=e.keepStrokeScale||i.keepStrokeScale;return o.lineWidth=s?n+r:No(o,n+r,o.dpr),c=t.isPointInStroke(d.x,d.y),c})),this.canvasRenderer.z=0,o.modelMatrix!==h&&la.free(o.modelMatrix),o.modelMatrix=h,o.highPerformanceRestore(),c}}var Qf=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},tv=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ev=function(t,e){return function(i,o){e(i,o,t)}};let iv=class extends Jf{constructor(t){super(),this.canvasRenderer=t,this.type="line",this.numberType=ns}};iv=Qf([C(),ev(0,m(nh)),tv("design:paramtypes",[Object])],iv);let ov=!1;const nv=new a(((t,e,i,o)=>{ov||(ov=!0,t(Pg).to(iv).inSingletonScope(),t(Wg).toService(Pg))}));class rv extends fa{contains(t,e,i){const{pickContext:o}=null!=i?i:{};if(!o)return!1;const n=t.getGraphicTheme();o.highPerformanceSave();const r=this.transform(t,n,o),{x:s,y:a,z:l,lastModelMatrix:h}=r;let d=e;if(o.camera){d=e.clone();const i=t.parent.globalTransMatrix;d.x=i.a*e.x+i.c*e.y+i.e,d.y=i.b*e.x+i.d*e.y+i.f}this.canvasRenderer.z=l;let c=!1;return this.canvasRenderer.drawShape(t,o,s,a,i,null,((t,e,i)=>!!c||(c=t.isPointInPath(d.x,d.y),c))),this.canvasRenderer.z=0,o.modelMatrix!==h&&la.free(o.modelMatrix),o.modelMatrix=h,o.highPerformanceRestore(),c}}var sv=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},av=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},lv=function(t,e){return function(i,o){e(i,o,t)}};let hv=class extends rv{constructor(t){super(),this.canvasRenderer=t,this.type="symbol",this.numberType=hs}contains(t,e,i){const{pickContext:o}=null!=i?i:{};if(!o)return!1;const n=t.getParsedPath();if(!o.camera){if(!t.AABBBounds.containsPoint(e))return!1;if(n.isSvg||"imprecise"===t.attribute.pickMode)return!0}o.highPerformanceSave();const r=t.getGraphicTheme(),s=this.transform(t,r,o),{x:a,y:l,z:h,lastModelMatrix:d}=s;let c=e;if(o.camera){c=e.clone();const i=t.parent.globalTransMatrix;c.x=i.a*e.x+i.c*e.y+i.e,c.y=i.b*e.x+i.d*e.y+i.f}this.canvasRenderer.z=h;let u=!1;return this.canvasRenderer.drawShape(t,o,a,l,{},null,((t,e,i)=>!!u||(u=t.isPointInPath(c.x,c.y),u)),((t,e,i)=>{if(u)return!0;const n=e.lineWidth||i.lineWidth,r=e.pickStrokeBuffer||i.pickStrokeBuffer,s=e.keepStrokeScale||i.keepStrokeScale;return o.lineWidth=s?n+r:No(o,n+r,o.dpr),u=t.isPointInStroke(c.x,c.y),u})),this.canvasRenderer.z=0,o.modelMatrix!==d&&la.free(o.modelMatrix),o.modelMatrix=d,o.highPerformanceRestore(),u}};hv=sv([C(),lv(0,m(lh)),av("design:paramtypes",[Object])],hv);let dv=!1;const cv=new a(((t,e,i,o)=>{dv||(dv=!0,t(Fg).to(hv).inSingletonScope(),t(Wg).toService(Fg))}));var uv=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},gv=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},pv=function(t,e){return function(i,o){e(i,o,t)}};let fv=class extends xp{constructor(t){super(),this.canvasRenderer=t,this.type="circle",this.numberType=es}};fv=uv([C(),pv(0,m(eh)),gv("design:paramtypes",[Object])],fv);let vv=!1;const bv=new a(((t,e,i,o)=>{vv||(vv=!0,t(Mg).to(fv).inSingletonScope(),t(Wg).toService(Mg))}));var mv=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},yv=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Cv=function(t,e){return function(i,o){e(i,o,t)}};let wv=class extends rv{constructor(t){super(),this.canvasRenderer=t,this.type="text",this.numberType=ds}contains(t,e,i){const{pickContext:o}=null!=i?i:{};if(!o)return!1;const n=t.AABBBounds;if(!o.camera)return!!n.containsPoint(e);o.highPerformanceSave();const r=t.getGraphicTheme(),{keepDirIn3d:s=r.keepDirIn3d}=t.attribute,a=!s,l=this.transform(t,r,o,a),{x:h,y:d,z:c,lastModelMatrix:u}=l;this.canvasRenderer.z=c;let g=e;if(o.camera){g=e.clone();const i=t.parent.globalTransMatrix;g.x=i.a*e.x+i.c*e.y+i.e,g.y=i.b*e.x+i.d*e.y+i.f}let p=!1;return this.canvasRenderer.drawShape(t,o,h,d,{},null,((e,i,o)=>{if(p)return!0;const{fontSize:n=r.fontSize,textBaseline:s=r.textBaseline,textAlign:a=r.textAlign}=t.attribute,l=t.AABBBounds,u=l.height(),f=l.width(),v=ta(s,u,n),b=Qs(a,f);return e.rect(b+h,v+d,f,u,c),p=e.isPointInPath(g.x,g.y),p}),((t,e,i)=>p)),this.canvasRenderer.z=0,o.modelMatrix!==u&&la.free(o.modelMatrix),o.modelMatrix=u,o.highPerformanceRestore(),p}};wv=mv([C(),Cv(0,m(hh)),yv("design:paramtypes",[Object])],wv);let xv=!1;const _v=new a(((t,e,i,o)=>{xv||(xv=!0,t(Og).to(wv).inSingletonScope(),t(Wg).toService(Og))}));var Sv=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Av=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Bv=function(t,e){return function(i,o){e(i,o,t)}};let Rv=class extends Jf{constructor(t){super(),this.canvasRenderer=t,this.type="path",this.numberType=rs}};Rv=Sv([C(),Bv(0,m(rh)),Av("design:paramtypes",[Object])],Rv);let Tv=!1;const kv=new a(((t,e,i,o)=>{Tv||(Tv=!0,t(Eg).to(Rv).inSingletonScope(),t(Wg).toService(Eg))}));var Mv=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Lv=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Pv=function(t,e){return function(i,o){e(i,o,t)}};let Ev=class extends xp{constructor(t){super(),this.canvasRenderer=t,this.type="polygon",this.numberType=ss}};Ev=Mv([C(),Pv(0,m(sh)),Lv("design:paramtypes",[Object])],Ev);let Hv=!1;const Fv=new a(((t,e,i,o)=>{Hv||(Hv=!0,t(Ig).to(Ev).inSingletonScope(),t(Wg).toService(Ig))}));var Ov=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},Iv=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},zv=function(t,e){return function(i,o){e(i,o,t)}};let Dv=class{constructor(t){this.canvasRenderer=t,this.type="richtext",this.numberType=ls}contains(t,e,i){return!!t.AABBBounds.containsPoint(e)}};Dv=Ov([C(),zv(0,m(dh)),Iv("design:paramtypes",[Object])],Dv);let Wv=!1;const Nv=new a(((t,e,i,o)=>{Wv||(Wv=!0,t(zg).to(Dv).inSingletonScope(),t(Wg).toService(zg))}));var Gv=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let jv=class{constructor(){this.type="image",this.numberType=os}contains(t,e,i){const{pickContext:o}=null!=i?i:{};return!!o&&!!t.AABBBounds.containsPoint(e)}};jv=Gv([C()],jv);let Vv=!1;const Uv=new a(((t,e,i,o)=>{Vv||(Vv=!0,t(Lg).to(jv).inSingletonScope(),t(Wg).toService(Lg))}));var $v={},Xv={},Yv={};Object.defineProperty(Yv,"__esModule",{value:!0}),Yv.loop=Yv.conditional=Yv.parse=void 0;Yv.parse=function t(e,i){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o;if(Array.isArray(i))i.forEach((function(i){return t(e,i,o,n)}));else if("function"==typeof i)i(e,o,n,t);else{var r=Object.keys(i)[0];Array.isArray(i[r])?(n[r]={},t(e,i[r],o,n[r])):n[r]=i[r](e,o,n,t)}return o};Yv.conditional=function(t,e){return function(i,o,n,r){e(i,o,n)&&r(i,t,o,n)}};Yv.loop=function(t,e){return function(i,o,n,r){for(var s=[],a=i.pos;e(i,o,n);){var l={};if(r(i,t,o,l),i.pos===a)break;a=i.pos,s.push(l)}return s}};var Kv={};Object.defineProperty(Kv,"__esModule",{value:!0}),Kv.readBits=Kv.readArray=Kv.readUnsigned=Kv.readString=Kv.peekBytes=Kv.readBytes=Kv.peekByte=Kv.readByte=Kv.buildStream=void 0;Kv.buildStream=function(t){return{data:t,pos:0}};var qv=function(){return function(t){return t.data[t.pos++]}};Kv.readByte=qv;Kv.peekByte=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return function(e){return e.data[e.pos+t]}};var Zv=function(t){return function(e){return e.data.subarray(e.pos,e.pos+=t)}};Kv.readBytes=Zv;Kv.peekBytes=function(t){return function(e){return e.data.subarray(e.pos,e.pos+t)}};Kv.readString=function(t){return function(e){return Array.from(Zv(t)(e)).map((function(t){return String.fromCharCode(t)})).join("")}};Kv.readUnsigned=function(t){return function(e){var i=Zv(2)(e);return t?(i[1]<<8)+i[0]:(i[0]<<8)+i[1]}};Kv.readArray=function(t,e){return function(i,o,n){for(var r="function"==typeof e?e(i,o,n):e,s=Zv(t),a=new Array(r),l=0;l<r;l++)a[l]=s(i);return a}};Kv.readBits=function(t){return function(e){for(var i=function(t){return t.data[t.pos++]}(e),o=new Array(8),n=0;n<8;n++)o[7-n]=!!(i&1<<n);return Object.keys(t).reduce((function(e,i){var n=t[i];return n.length?e[i]=function(t,e,i){for(var o=0,n=0;n<i;n++)o+=t[e+n]&&Math.pow(2,i-n-1);return o}(o,n.index,n.length):e[i]=o[n.index],e}),{})}},function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var e=Yv,i=Kv,o={blocks:function(t){for(var e=[],o=t.data.length,n=0,r=(0,i.readByte)()(t);0!==r&&r;r=(0,i.readByte)()(t)){if(t.pos+r>=o){var s=o-t.pos;e.push((0,i.readBytes)(s)(t)),n+=s;break}e.push((0,i.readBytes)(r)(t)),n+=r}for(var a=new Uint8Array(n),l=0,h=0;h<e.length;h++)a.set(e[h],l),l+=e[h].length;return a}},n=(0,e.conditional)({gce:[{codes:(0,i.readBytes)(2)},{byteSize:(0,i.readByte)()},{extras:(0,i.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,i.readUnsigned)(!0)},{transparentColorIndex:(0,i.readByte)()},{terminator:(0,i.readByte)()}]},(function(t){var e=(0,i.peekBytes)(2)(t);return 33===e[0]&&249===e[1]})),r=(0,e.conditional)({image:[{code:(0,i.readByte)()},{descriptor:[{left:(0,i.readUnsigned)(!0)},{top:(0,i.readUnsigned)(!0)},{width:(0,i.readUnsigned)(!0)},{height:(0,i.readUnsigned)(!0)},{lct:(0,i.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,e.conditional)({lct:(0,i.readArray)(3,(function(t,e,i){return Math.pow(2,i.descriptor.lct.size+1)}))},(function(t,e,i){return i.descriptor.lct.exists})),{data:[{minCodeSize:(0,i.readByte)()},o]}]},(function(t){return 44===(0,i.peekByte)()(t)})),s=(0,e.conditional)({text:[{codes:(0,i.readBytes)(2)},{blockSize:(0,i.readByte)()},{preData:function(t,e,o){return(0,i.readBytes)(o.text.blockSize)(t)}},o]},(function(t){var e=(0,i.peekBytes)(2)(t);return 33===e[0]&&1===e[1]})),a=(0,e.conditional)({application:[{codes:(0,i.readBytes)(2)},{blockSize:(0,i.readByte)()},{id:function(t,e,o){return(0,i.readString)(o.blockSize)(t)}},o]},(function(t){var e=(0,i.peekBytes)(2)(t);return 33===e[0]&&255===e[1]})),l=(0,e.conditional)({comment:[{codes:(0,i.readBytes)(2)},o]},(function(t){var e=(0,i.peekBytes)(2)(t);return 33===e[0]&&254===e[1]})),h=[{header:[{signature:(0,i.readString)(3)},{version:(0,i.readString)(3)}]},{lsd:[{width:(0,i.readUnsigned)(!0)},{height:(0,i.readUnsigned)(!0)},{gct:(0,i.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,i.readByte)()},{pixelAspectRatio:(0,i.readByte)()}]},(0,e.conditional)({gct:(0,i.readArray)(3,(function(t,e){return Math.pow(2,e.lsd.gct.size+1)}))},(function(t,e){return e.lsd.gct.exists})),{frames:(0,e.loop)([n,a,l,r,s],(function(t){var e=(0,i.peekByte)()(t);return 33===e||44===e}))}],d=h;t.default=d}(Xv);var Jv={};Object.defineProperty(Jv,"__esModule",{value:!0}),Jv.deinterlace=void 0;Jv.deinterlace=function(t,e){for(var i=new Array(t.length),o=t.length/e,n=function(o,n){var r=t.slice(n*e,(n+1)*e);i.splice.apply(i,[o*e,e].concat(r))},r=[0,4,2,1],s=[8,8,4,2],a=0,l=0;l<4;l++)for(var h=r[l];h<o;h+=s[l])n(h,a),a++;return i};var Qv={};Object.defineProperty(Qv,"__esModule",{value:!0}),Qv.lzw=void 0;Qv.lzw=function(t,e,i){var o,n,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y=4096,C=i,w=new Array(i),x=new Array(y),_=new Array(y),S=new Array(4097);for(a=(n=1<<(u=t))+1,o=n+2,h=-1,r=(1<<(s=u+1))-1,d=0;d<n;d++)x[d]=0,_[d]=d;for(g=p=f=v=b=m=0,c=0;c<C;){if(0===v){if(p<s){g+=e[m]<<p,p+=8,m++;continue}if(d=g&r,g>>=s,p-=s,d>o||d==a)break;if(d==n){r=(1<<(s=u+1))-1,o=n+2,h=-1;continue}if(-1==h){S[v++]=_[d],h=d,f=d;continue}for(l=d,d==o&&(S[v++]=f,d=h);d>n;)S[v++]=_[d],d=x[d];f=255&_[d],S[v++]=f,o<y&&(x[o]=h,_[o]=f,0==(++o&r)&&o<y&&(s++,r+=o)),h=l}v--,w[b++]=S[v],c++}for(c=b;c<C;c++)w[c]=0;return w},Object.defineProperty($v,"__esModule",{value:!0});var tb=$v.decompressFrames=$v.decompressFrame=sb=$v.parseGIF=void 0,eb=function(t){return t&&t.__esModule?t:{default:t}}(Xv),ib=Yv,ob=Kv,nb=Jv,rb=Qv;var sb=$v.parseGIF=function(t){var e=new Uint8Array(t);return(0,ib.parse)((0,ob.buildStream)(e),eb.default)},ab=function(t,e,i){if(t.image){var o=t.image,n=o.descriptor.width*o.descriptor.height,r=(0,rb.lzw)(o.data.minCodeSize,o.data.blocks,n);o.descriptor.lct.interlaced&&(r=(0,nb.deinterlace)(r,o.descriptor.width));var s={pixels:r,dims:{top:t.image.descriptor.top,left:t.image.descriptor.left,width:t.image.descriptor.width,height:t.image.descriptor.height}};return o.descriptor.lct&&o.descriptor.lct.exists?s.colorTable=o.lct:s.colorTable=e,t.gce&&(s.delay=10*(t.gce.delay||10),s.disposalType=t.gce.extras.disposal,t.gce.extras.transparentColorGiven&&(s.transparentIndex=t.gce.transparentColorIndex)),i&&(s.patch=function(t){for(var e=t.pixels.length,i=new Uint8ClampedArray(4*e),o=0;o<e;o++){var n=4*o,r=t.pixels[o],s=t.colorTable[r]||[0,0,0];i[n]=s[0],i[n+1]=s[1],i[n+2]=s[2],i[n+3]=r!==t.transparentIndex?255:0}return i}(s)),s}};$v.decompressFrame=ab;tb=$v.decompressFrames=function(t,e){return t.frames.filter((function(t){return t.image})).map((function(i){return ab(i,t.gct,e)}))};const lb=Tu();function hb(){hb.__loaded||(hb.__loaded=!0,Rl.RegisterGraphicCreator("arc",xc),sn.load($u),sn.load(lb?Uf:Tp))}hb.__loaded=!1;const db=hb;function cb(){cb.__loaded||(cb.__loaded=!0,Rl.RegisterGraphicCreator("circle",Fh),sn.load(tg),sn.load(lb?bv:Hp))}cb.__loaded=!1;const ub=cb;function gb(){gb.__loaded||(gb.__loaded=!0,Rl.RegisterGraphicCreator("group",bs))}gb.__loaded=!1;const pb=gb;function fb(){fb.__loaded||(fb.__loaded=!0,Rl.RegisterGraphicCreator("image",lc),sn.load(gg),sn.load(lb?Uv:zp))}fb.__loaded=!1;const vb=fb;function bb(){bb.__loaded||(bb.__loaded=!0,Rl.RegisterGraphicCreator("line",tc),sn.load(qu),sn.load(lb?nv:Vp))}bb.__loaded=!1;const mb=bb;function yb(){yb.__loaded||(yb.__loaded=!0,Rl.RegisterGraphicCreator("path",bc),sn.load(ng),sn.load(lb?kv:of))}yb.__loaded=!1;const Cb=yb;function wb(){wb.__loaded||(wb.__loaded=!0,Rl.RegisterGraphicCreator("polygon",Ac),sn.load(sg),sn.load(lb?Fv:qp))}wb.__loaded=!1;const xb=wb;function _b(){_b.__loaded||(_b.__loaded=!0,Rl.RegisterGraphicCreator("rect",oc),sn.load(Yu),sn.load(lb?Zf:cf))}_b.__loaded=!1;const Sb=_b;function Ab(){Ab.__loaded||(Ab.__loaded=!0,Rl.RegisterGraphicCreator("richtext",pc),sn.load(cg),sn.load(lb?Nv:gf))}Ab.__loaded=!1;const Bb=Ab;function Rb(){Rb.__loaded||(Rb.__loaded=!0,Rl.RegisterGraphicCreator("shadowRoot",Rc))}Rb.__loaded=!1;const Tb=Rb;function kb(){kb.__loaded||(kb.__loaded=!0,Rl.RegisterGraphicCreator("symbol",Zd),sn.load(Ju),sn.load(lb?cv:yf))}kb.__loaded=!1;const Mb=kb;function Lb(){Lb.__loaded||(Lb.__loaded=!0,Rl.RegisterGraphicCreator("text",Dh),sn.load(ig),sn.load(lb?_v:_f))}Lb.__loaded=!1;const Pb=Lb;function Eb(){Eb.__loaded||(Eb.__loaded=!0,Rl.RegisterGraphicCreator("wrapText",Gh))}Eb.__loaded=!1;const Hb=Eb;function Fb(){pb(),Sb()}const Ob="PingFang SC,Helvetica Neue,Microsoft Yahei,system-ui,-apple-system,segoe ui,Roboto,Helvetica,Arial,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol";var Ib;!function(t){t.selected="selected",t.selectedReverse="selected_reverse",t.hover="hover",t.hoverReverse="hover_reverse"}(Ib||(Ib={}));const zb={[Ib.selectedReverse]:{},[Ib.selected]:{},[Ib.hover]:{},[Ib.hoverReverse]:{}},Db={container:"",width:30,height:30,style:{}},Wb={debounce:qt,throttle:Zt};Fb();class Nb extends mg{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Tt({},Nb.defaultAttributes,t)),this.name="scrollbar",this._onRailPointerDown=t=>{const{viewX:e,viewY:i}=t,{direction:o,width:n,height:r,range:s}=this.attribute,a=this._sliderSize,[l,h]=this._getScrollRange();let d;if("vertical"===o){const t=i-this._viewPosition.y,e=Xt(t-a/2,l,h);d=t/r,this._slider.setAttribute("y",e,!0)}else{const t=e-this._viewPosition.x,i=Xt(t-a/2,l,h);d=t/n,this._slider.setAttribute("x",i,!0)}this.setScrollRange([d-(s[1]-s[0])/2,d+(s[1]-s[0])/2],!1),this.stage&&!this.stage.autoRender&&this.stage.renderNextFrame()},this._onSliderPointerDown=t=>{const{stopSliderDownPropagation:e=!0}=this.attribute;e&&t.stopPropagation();const{direction:i}=this.attribute,{x:o,y:n}=this.stage.eventPointTransform(t);this._prePos="horizontal"===i?o:n,this._dispatchEvent("scrollDown",{pos:this._prePos,event:t}),"browser"===fu.env?(fu.addEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),fu.addEventListener("pointerup",this._onSliderPointerUp)):(this.stage.addEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),this.stage.addEventListener("pointerup",this._onSliderPointerUp),this.stage.addEventListener("pointerupoutside",this._onSliderPointerUp))},this._computeScrollValue=t=>{const{direction:e}=this.attribute,{x:i,y:o}=this.stage.eventPointTransform(t);let n,r,s=0;const{width:a,height:l}=this.getSliderRenderBounds();return"vertical"===e?(r=o,s=r-this._prePos,n=s/l):(r=i,s=r-this._prePos,n=s/a),[r,n]},this._onSliderPointerMove=t=>{const{stopSliderMovePropagation:e=!0}=this.attribute;e&&t.stopPropagation();const i=this.getScrollRange(),[o,n]=this._computeScrollValue(t);this.setScrollRange([i[0]+n,i[1]+n],!0),this._prePos=o},this._onSliderPointerMoveWithDelay=0===this.attribute.delayTime?this._onSliderPointerMove:Wb[this.attribute.delayType](this._onSliderPointerMove,this.attribute.delayTime),this._onSliderPointerUp=t=>{t.preventDefault();const{realTime:e=!0,range:i,limitRange:o=[0,1]}=this.attribute,n=this.getScrollRange(),[r,s]=this._computeScrollValue(t),a=[n[0]+s,n[1]+s];this._dispatchEvent("scrollUp",{pre:i,value:Yt(a,o[0],o[1])}),"browser"===fu.env?(fu.removeEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),fu.removeEventListener("pointerup",this._onSliderPointerUp)):(this.stage.removeEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),this.stage.removeEventListener("pointerup",this._onSliderPointerUp),this.stage.removeEventListener("pointerupoutside",this._onSliderPointerUp))}}setScrollRange(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{direction:i="horizontal",limitRange:o=[0,1],range:n,realTime:r=!0}=this.attribute,s=Yt(t,o[0],o[1]);if(e){const t=this._getSliderPos(s);if(this._slider){const e=t[1]-t[0];this._sliderSize=e,"horizontal"===i?this._slider.setAttributes({x:t[0],width:e},!0):this._slider.setAttributes({y:t[0],height:e},!0),this.stage&&!this.stage.autoRender&&this.stage.renderNextFrame()}}this.attribute.range=s,r&&this._dispatchEvent("scrollDrag",{pre:n,value:s})}getScrollRange(){return this.attribute.range}bindEvents(){if(this.attribute.disableTriggerEvent)return;const{delayType:t="throttle",delayTime:e=0}=this.attribute;this._rail&&this._rail.addEventListener("pointerdown",Wb[t](this._onRailPointerDown,e)),this._slider&&this._slider.addEventListener("pointerdown",this._onSliderPointerDown)}render(){this._reset();const{direction:t="horizontal",width:e,height:i,range:o,limitRange:n=[0,1],railStyle:r,sliderStyle:s,padding:a=2}=this.attribute,l=this.createOrUpdateChild("scrollbar-container",{},"group"),h=l.createOrUpdateChild("scrollbar-rail",Object.assign({x:0,y:0,width:e,height:i},r),"rect");this._rail=h;const d=this.getSliderRenderBounds(),c=this._getSliderPos(Yt(o,n[0],n[1])),u=c[1]-c[0];let g;this._sliderSize=u,g="horizontal"===t?{x:c[0],y:d.y1,width:u,height:d.height}:{x:d.x1,y:c[0],width:d.width,height:u};const p=l.createOrUpdateChild("slider",Object.assign(Object.assign(Object.assign(Object.assign({},g),{cornerRadius:this._getDefaultSliderCornerRadius()}),s),{boundsPadding:Je(a),pickMode:"imprecise"}),"rect");this._slider=p,this._container=l;const f=this._container.AABBBounds;this._viewPosition={x:f.x1,y:f.y1}}getSliderRenderBounds(){if(this._sliderRenderBounds)return this._sliderRenderBounds;const{width:t,height:e,padding:i=2}=this.attribute,[o,n,r,s]=Je(i),a={x1:s,y1:o,x2:t-n,y2:e-r,width:Math.max(0,t-(s+n)),height:Math.max(0,e-(o+r))};return this._sliderRenderBounds=a,a}_getDefaultSliderCornerRadius(){const{direction:t,round:e}=this.attribute;if(e){const{width:e,height:i}=this.getSliderRenderBounds();return"horizontal"===t?i:e}return 0}_getSliderPos(t){const{direction:e}=this.attribute,{width:i,height:o,x1:n,y1:r}=this.getSliderRenderBounds();return"horizontal"===e?[i*t[0]+n,i*t[1]+n]:[o*t[0]+r,o*t[1]+r]}_getScrollRange(){if(this._sliderLimitRange)return this._sliderLimitRange;const{limitRange:t=[0,1],direction:e}=this.attribute,[i,o]=Yt(t,0,1),{width:n,height:r,x1:s,y1:a}=this.getSliderRenderBounds(),l=this._sliderSize;return"horizontal"===e?Yt([s+i*n,s+o*n],s,n-l):Yt([a+i*r,a+o*r],a,r-l)}_reset(){this._sliderRenderBounds=null,this._sliderLimitRange=null}}function Gb(t,e){t.forEachChildren((t=>{const i=e(t);t.isContainer&&!i&&Gb(t,e)}))}function jb(t,e){return[t[0]*e,t[1]*e]}function Vb(t){const[e,i]=t;return Math.sqrt(e*e+i*i)}function Ub(t,e,i){const o=function(t,e){const[i,o]=t,[n,r]=e,s=Math.sqrt((i*i+o*o)*(n*n+r*r)),a=s&&(i*n+o*r)/s;return Math.acos(Math.min(Math.max(a,-1),1))}(t,e),n=(s=e,(r=t)[0]*s[1]-r[1]*s[0]>=0);var r,s;return i?n?2*Math.PI-o:o:n?o:2*Math.PI-o}Nb.defaultAttributes={direction:"horizontal",round:!0,sliderSize:20,sliderStyle:{fill:"rgba(0, 0, 0, .5)"},railStyle:{fill:"rgba(0, 0, 0, .0)"},padding:2,scrollRange:[0,1],delayType:"throttle",delayTime:0,realTime:!0};const $b=(t,e,i,o)=>new Pe(Object.assign({defaultFontParams:Object.assign({fontFamily:Ob,fontSize:14},o),getTextBounds:i?void 0:kl,specialCharSet:"-/: .,@%'\"~"+Pe.ALPHABET_CHAR_SET+Pe.ALPHABET_CHAR_SET.toUpperCase()},null!=e?e:{}),t);function Xb(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!t)return{width:0,height:0};const o=kl({text:t,fontFamily:e.fontFamily||i.fontFamily||Ob,fontSize:e.fontSize||i.fontSize||12,fontWeight:e.fontWeight||i.fontWeight,textAlign:e.textAlign||"center",textBaseline:e.textBaseline,ellipsis:!!e.ellipsis,maxLineWidth:e.maxLineWidth||1/0,lineHeight:e.fontSize||i.fontSize||12});return{width:o.width(),height:o.height()}}function Yb(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"type";var i,o;return nt(t.text)&&"type"in t.text?null!==(i=t.text.type)&&void 0!==i?i:"text":e in t&&null!==(o=t[e])&&void 0!==o?o:"text"}function Kb(t){var e,i;return ot(t.maxLineWidth)&&(t.maxWidth=t.maxLineWidth,delete t.maxLineWidth),t.width=null!==(e=t.width)&&void 0!==e?e:0,t.height=null!==(i=t.height)&&void 0!==i?i:0,t.textConfig=t.text.text||t.text,t}function qb(t){const e=Yb(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"type");return"rich"===e?Rl.richtext(Kb(t)):("html"===e?t=function(t){const{text:e,_originText:i}=t,{text:o}=e;return t.html=o,t.text=i,t.renderable=!1,t}(t):"react"===e&&(t=function(t){const{text:e,_originText:i}=t,{text:o}=e;return t.react=o,t.text=i,t.renderable=!1,t}(t)),Rl.text(t))}function Zb(){pb(),Sb(),Mb(),Bb(),Pb()}var Jb=function(t,e){var i={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(i[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(t);n<o.length;n++)e.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(t,o[n])&&(i[o[n]]=t[o[n]])}return i};Zb();let Qb=class t extends mg{getBgRect(){return this._bgRect}getTextShape(){return this._textShape}constructor(e,i){super((null==i?void 0:i.skipDefault)?e:Tt({},t.defaultAttributes,e)),this.name="tag",this._tagStates=[],this._rectStates=[],this._symbolStates=[],this._textStates=[]}render(){var t,e,i;this.cacheStates();const{text:o="",textStyle:n={},shape:r={},panel:s={},space:a=4,minWidth:l,maxWidth:h,padding:d=4,visible:c,state:u,type:g,textAlwaysCenter:p,containerTextAlign:f}=this.attribute,v=Je(d),b=this.createOrUpdateChild("tag-content",{x:0,y:0,zIndex:1},"group");let m,y=-v[3],C=-v[0],w=v[1]+v[3],x=v[0]+v[2],_=0,S=0;const{visible:A}=r,B=Jb(r,["visible"]);if(tt(A)){const t=(null==B?void 0:B.size)||10,e=ut(t)?t:Math.max(t[0],t[1]);m=b.createOrUpdateChild("tag-shape",Object.assign(Object.assign({symbolType:"circle",size:t,strokeBoundsBuffer:0},B),{visible:A,x:e/2,y:e/2}),"symbol"),Ct(null==u?void 0:u.shape)||(m.states=u.shape),A&&(S=e+a)}let R;if(w+=S,_+=S,function(t){return"rich"===Yb(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"type")}({text:o})||"rich"===g){const t=Object.assign(Object.assign(Object.assign({},Kb(Object.assign({type:g,text:o},n))),n),{visible:ot(o)&&!1!==c,x:_,y:0});R=b.createOrUpdateChild("tag-text",t,"richtext"),w+=R.AABBBounds.width(),x+=R.AABBBounds.height(),y+=R.AABBBounds.x1,C+=R.AABBBounds.y1}else{const s=Object.assign(Object.assign({text:nt(o)&&"type"in o&&"text"===o.type?o.text:o,visible:ot(o)&&!1!==c,lineHeight:null==n?void 0:n.fontSize},n),{x:_,y:0});it(s.lineHeight)&&(s.lineHeight=n.fontSize),R=b.createOrUpdateChild("tag-text",s,"text"),Ct(null==u?void 0:u.text)||(R.states=u.text);const a=Xb(s.text,n,null===(e=null===(t=this.stage)||void 0===t?void 0:t.getTheme())||void 0===e?void 0:e.text),d=a.width,g=a.height;w+=d;const A=null!==(i=r.size)&&void 0!==i?i:10,B=ut(A)?A:Math.max(A[0],A[1]);x+=Math.max(g,r.visible?B:0);const{textAlign:T,textBaseline:k}=n;(ot(l)||ot(h))&&(ot(l)&&w<l&&(w=l),ot(h)&&w>h&&(w=h,R.setAttribute("maxLineWidth",h-v[1]-v[2]))),y=0,C=0;let M=0;"left"===T||"start"===T?M=1:"right"===T||"end"===T?M=-1:"center"===T&&(M=0),M?M<0?(y-=w,m&&m.setAttribute("x",(m.attribute.x||0)-d),b.setAttribute("x",-v[1]-S)):M>0&&b.setAttribute("x",v[3]):(y-=w/2,m&&m.setAttribute("x",(m.attribute.x||0)-d/2),b.setAttribute("x",-S/2));const L="right"===f||"end"===f,P="left"===f||"start"===f;if((f?"center"===f:p)&&M){const t=w-v[1]-v[3],e=d+S,i=1===M?(t-e)/2+S+d/2:v[0]+S-(w/2+e/2-S)+d/2;if(R.setAttributes({x:i,textAlign:"center"}),m){const t=i-d/2-S+B/2;m.setAttributes({x:t})}}if(P&&1!==M){const t=w-v[1]-v[3],e=0===M?-t/2+S/2:-w+v[3]+v[1]+S,i=e+S;if(R.setAttributes({x:i,textAlign:"left"}),m){const t=e+B/2;m.setAttributes({x:t})}}if(L&&-1!==M){const t=w-v[1]-v[3],e=0===M?t/2+S/2:t;if(R.setAttributes({x:e,textAlign:"right"}),m){const t=e-d-S+B/2;m.setAttributes({x:t})}}"middle"===k?(C-=x/2,m&&m.setAttribute("y",0)):"bottom"===k?(C-=x,m&&m.setAttribute("y",-g/2),b.setAttribute("y",-v[2])):"top"===k&&(b.setAttribute("y",v[0]),m&&m.setAttribute("y",g/2))}const{visible:T}=s,k=Jb(s,["visible"]);if(c&&tt(T)){const t=this.createOrUpdateChild("tag-panel",Object.assign(Object.assign({},k),{visible:T&&!!o,width:w,height:x,x:y,y:C}),"rect");if(Ct(null==u?void 0:u.panel)||(t.states=u.panel),k.customShape){const e=k.customShape;t.pathProxy=t=>e(this,t,new go)}this._bgRect=t}this._textShape=R,this._symbol=m,this.resetStates()}initAttributes(e,i){e=(null==i?void 0:i.skipDefault)?e:Tt({},t.defaultAttributes,e),super.initAttributes(e),this.render()}addState(t,e,i){super.addState(t,e,i),this._textShape&&this._textShape.addState(t,e,i),this._bgRect&&this._bgRect.addState(t,e,i),this._symbol&&this._symbol.addState(t,e,i)}removeState(t,e){super.removeState(t,e),this._textShape&&this._textShape.removeState(t,e),this._bgRect&&this._bgRect.removeState(t,e),this._symbol&&this._symbol.removeState(t,e)}cacheStates(){var t,e,i,o,n,r,s,a,l,h,d,c,u,g;this._tagStates=null!==(e=null===(t=this.currentStates)||void 0===t?void 0:t.slice())&&void 0!==e?e:[],this._rectStates=null!==(n=null===(o=null===(i=this._bgRect)||void 0===i?void 0:i.currentStates)||void 0===o?void 0:o.slice())&&void 0!==n?n:[],this._symbolStates=null!==(a=null===(s=null===(r=this._symbol)||void 0===r?void 0:r.currentStates)||void 0===s?void 0:s.slice())&&void 0!==a?a:[],this._textStates=null!==(d=null===(h=null===(l=this._textShape)||void 0===l?void 0:l.currentStates)||void 0===h?void 0:h.slice())&&void 0!==d?d:[],this.clearStates(),null===(c=this._bgRect)||void 0===c||c.clearStates(),null===(u=this._symbol)||void 0===u||u.clearStates(),null===(g=this._textShape)||void 0===g||g.clearStates()}resetStates(){var t,e,i;this._tagStates.length&&this.useStates(this._tagStates),this._rectStates.length&&(null===(t=this._bgRect)||void 0===t||t.useStates(this._rectStates)),this._symbolStates.length&&(null===(e=this._symbol)||void 0===e||e.useStates(this._symbolStates)),this._textStates.length&&(null===(i=this._textShape)||void 0===i||i.useStates(this._textStates))}};Qb.defaultAttributes={visible:!0,textStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},space:4,padding:4,shape:{fill:"#000"}};const tm={visible:!0,position:"auto",titleStyle:{fontSize:16,fill:"#08979c"},contentStyle:{fontSize:12,fill:"green"},panel:{visible:!0,fill:"#e6fffb",size:12,space:0,stroke:"#87e8de",lineWidth:1,cornerRadius:4}},em={poptip:Tt({},tm)};var im=function(t,e){var i={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(i[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(t);n<o.length;n++)e.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(t,o[n])&&(i[o[n]]=t[o[n]])}return i};const om=new Fe;pb(),Pb(),Mb(),Sb();class nm extends mg{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Tt({},nm.defaultAttributes,t)),this.name="poptip",this.positionList=["top","tl","tr","bottom","bl","br","left","lt","lb","right","rt","rb"]}render(){var t,e,i,o,n,r,s,a;const{titleStyle:l={},position:h,contentStyle:d={},panel:c={},space:u=4,minWidth:g=0,maxWidth:p=1/0,padding:f=4,maxWidthPercent:v,visible:b,state:m,dx:y=0,dy:C=0}=this.attribute;let{title:w="",content:x=""}=this.attribute;w=this.attribute.titleFormatMethod?this.attribute.titleFormatMethod(w):w,x=this.attribute.contentFormatMethod?this.attribute.contentFormatMethod(x):x;const _=Je(f),S=this.createOrUpdateChild("poptip-content",{x:0,y:0,zIndex:1},"group"),A=p-_[1]-_[3],B=ot(w)&&!1!==b,R=Object.assign(Object.assign({text:ht(w)?w:[w],visible:B,wrap:!0},l),{x:_[3],y:_[0],maxLineWidth:A,textAlign:"left",textBaseline:"top"}),T=S.createOrUpdateChild("poptip-title",R,"text");Ct(null==m?void 0:m.title)||(T.states=m.title);const k=T.AABBBounds,M=k.height(),L=k.width();let P=M+u;B||(P=0);const E=ot(x)&&!1!==b,H=Object.assign(Object.assign({text:ht(x)?x:[x],visible:E,wrap:!0},d),{x:_[3],y:_[0]+P,maxLineWidth:A,textAlign:"left",textBaseline:"top"}),F=S.createOrUpdateChild("poptip-content",H,"text");Ct(null==m?void 0:m.content)||(F.states=m.content);const O=F.AABBBounds,I=O.height(),z=O.width();E&&(P+=I);let D=le(L+_[1]+_[3],z+_[1]+_[3]);D>p?D=p:D<g&&(D=g);let W=_[0]+_[2]+P;const{visible:N}=c,G=im(c,["visible"]),j=null!==(t=G.size)&&void 0!==t?t:12,V=ht(j)?[j[0]+(null!==(e=G.space)&&void 0!==e?e:0),j[1]+(null!==(i=G.space)&&void 0!==i?i:0)]:j+(null!==(o=G.space)&&void 0!==o?o:0),U=null!==(n=G.lineWidth)&&void 0!==n?n:1,$=this.stage?[null!==(r=this.stage.viewWidth)&&void 0!==r?r:this.stage.width,null!==(s=this.stage.viewHeight)&&void 0!==s?s:this.stage.height]:void 0;if($){const t=this.AABBBounds,e=null!==(a=this.attribute.x)&&void 0!==a?a:t.x1,i=$[0]-t.x1;let o=Math.max(e,i);const n=(ht(j)?j[0]:12)+3;if(o=Math.min(o-n,o*v),o<D){D=o;const t=_[1]+_[3];T.setAttribute("maxLineWidth",o-t),F.setAttribute("maxLineWidth",o-t),W=_[0]+_[2],B&&(W+=T.AABBBounds.height()+u),W+=F.AABBBounds.height()}}const X="auto"===h;let Y,K=-1/0;for(let t=0;t<this.positionList.length+1;t++){const e=X?this.positionList[t===this.positionList.length?Y:t]:h,{angle:i,offset:o,rectOffset:n}=this.getAngleAndOffset(e,D,W,ht(V)?V:[V,V-U]);if(tt(N)){const t=(ht(j)?j[0]:j)/4,e=S.createOrUpdateChild("poptip-symbol-panel",Object.assign(Object.assign({},G),{visible:N&&(E||B),x:t,y:0,strokeBoundsBuffer:-1,boundsPadding:-2,anchor:[0,0],symbolType:"arrow2Left",angle:i,dx:o[0],dy:o[1],size:j,zIndex:-9}),"symbol");Ct(null==m?void 0:m.panel)||(e.states=m.panel);const n=S.createOrUpdateChild("poptip-rect-panel",Object.assign(Object.assign({},G),{visible:N&&(E||B),x:0,y:0,width:D,height:W,zIndex:-8}),"rect");Ct(null==m?void 0:m.panel)||(n.states=m.panel)}if(S.setAttributes({x:-o[0]+y,y:-o[1]+C}),!X||!$)break;{om.setValue(0,0,D,W).transformWithMatrix(S.globalTransMatrix);const e=om,i=(new He).setValue(0,0,$[0],$[1]);if(_e(e,i,!1))break;{const o=Ce(e,i,!1),n=(o.x2-o.x1)*(o.y2-o.y1);n>K&&(K=n,Y=t)}}}}getAngleAndOffset(t,e,i,o){const n=o[1]/2;switch(t){case"tl":return{angle:ee/2*3,offset:[e/4,i+n],rectOffset:[-e/4,-i-o[1]]};case"top":return{angle:ee/2*3,offset:[e/2,i+n],rectOffset:[0,-i-o[1]]};case"tr":return{angle:ee/2*3,offset:[e/4*3,i+n],rectOffset:[e/4*3,-i-o[1]]};case"rt":return{angle:0,offset:[-n,i/5],rectOffset:[e/4*3,-i-o[1]]};case"right":return{angle:0,offset:[-n,i/2],rectOffset:[e/4*3,-i-o[1]]};case"rb":return{angle:0,offset:[-n,i/5*4],rectOffset:[e/4*3,-i-o[1]]};case"bl":return{angle:ee/2,offset:[e/4,-n],rectOffset:[-e/4,-i-o[1]]};case"bottom":return{angle:ee/2,offset:[e/2,-n],rectOffset:[0,-i-o[1]]};case"br":return{angle:ee/2,offset:[e/4*3,-n],rectOffset:[e/4*3,-i-o[1]]};case"lt":return{angle:ee,offset:[e+n,i/5],rectOffset:[-e/4,-i-o[1]]};case"left":return{angle:ee,offset:[e+n,i/2],rectOffset:[0,-i-o[1]]};case"lb":return{angle:ee,offset:[e+n,i/5*4],rectOffset:[e/4*3,-i-o[1]]}}}}nm.defaultAttributes={position:"rt",visible:!0,title:null,content:null,titleStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},contentStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},maxWidthPercent:.8,space:8,padding:10};var rm=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let sm=class{render(t,e,i,o,n,r,s,a,l,h,d,c,u){var g,p;if(1===t._showPoptip){const{visible:e,visibleCb:i}=t.attribute.poptip||{};if(!1===e||i&&!1===i(t))return;const o={};Tt(o,nm.defaultAttributes,t.attribute.poptip?t.attribute.poptip:{}),this.poptipComponent?this.poptipComponent.initAttributes(o):this.poptipComponent=new nm(o);let n=t.attribute.poptip||{};if("text"===t.type&&null==n.title&&null==n.content){const e={};Tt(e,em.poptip,n),n=e,n.content=null!==(g=n.content)&&void 0!==g?g:t.attribute.text}const r=t.globalTransMatrix;this.poptipComponent.setAttributes(Object.assign(Object.assign({visibleAll:!0,pickable:!1,childrenPickable:!1},n),{x:r.e,y:r.f})),h.stage.tryInitInteractiveLayer();const s=h.stage.getLayer("_builtin_interactive");s&&s.add(this.poptipComponent)}else 2===t._showPoptip&&(t._showPoptip=0,this.poptipComponent&&(this.poptipComponent.setAttributes({visibleAll:!1}),null===(p=this.poptipComponent.parent)||void 0===p||p.removeChild(this.poptipComponent),this.poptipComponent=null))}};sm=rm([C()],sm);var am=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};class lm{constructor(){this.activeEvent="onRegister",this._uid=s.GenAutoIncrementId(),this.poptip=t=>{const e=t.target;this.needHide(e)?this.unpoptip(t):e!==this.activeGraphic&&(this.needShow(e)&&(e.setAttributes({}),e._showPoptip=1),this.activeGraphic&&(this.activeGraphic.setAttributes({}),this.activeGraphic._showPoptip=2),this.setActiveGraphic(e,!0))},this.unpoptip=t=>{this.activeGraphic&&(this.activeGraphic.setAttributes({}),this.activeGraphic._showPoptip=2,this.setActiveGraphic(null,!0))}}activate(t){this.pluginService=t;const{stage:e}=this.pluginService;e.addEventListener("pointerover",this.poptip)}needHide(t){return t.isContainer||!t.attribute}needShow(t){return!!t.attribute.poptip}setActiveGraphic(t,e){this.activeGraphic=t,this.pluginService.stage.renderNextFrame()}deactivate(t){const{stage:e}=this.pluginService;e.removeEventListener("pointerover",this.poptip)}}let hm=class extends lm{constructor(){super(...arguments),this.name="poptip",this.key=this.name+this._uid}};hm=am([C()],hm);let dm=class extends lm{constructor(){super(...arguments),this.name="poptipForText",this.key=this.name+this._uid,this.pointerlave=t=>{const{stage:e}=this.pluginService;t.target===e&&this.unpoptip(t)}}activate(t){super.activate(t);const{stage:e}=this.pluginService;e.addEventListener("pointerleave",this.pointerlave)}needHide(t){return"text"!==t.type||!t.cliped||t.isContainer||!t.attribute||t.attribute.disableAutoClipedPoptip}needShow(t){return!0}deactivate(t){const{stage:e}=this.pluginService;super.deactivate(t),e.removeEventListener("pointerleave",this.pointerlave)}};dm=am([C()],dm);const cm=new a(((t,e,i,o)=>{i(sm)||(t(sm).toSelf().inSingletonScope(),t(Js).toService(sm)),i(hm)||(t(hm).toSelf(),t(Fc).toService(hm)),i(dm)||(t(dm).toSelf(),t(Fc).toService(dm))}));pb(),mb(),xb(),Mb();class um extends mg{getStartAngle(){return ye(this._startAngle)}getEndAngle(){return ye(this._endAngle)}getMainSegmentPoints(){return this._mainSegmentPoints}constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Tt({},um.defaultAttributes,t)),this.name="segment",this.key="segment",this.lines=[]}render(){this.removeAllChild(!0),this._reset();const{startSymbol:t,endSymbol:e,lineStyle:i,state:o,visible:n=!0,multiSegment:r,mainSegmentIndex:s}=this.attribute;if(!n)return;this._computeLineAngle();const a=this._getMainSegmentPoints(),l=this._renderSymbol(t,a,"start"),h=this._renderSymbol(e,a,"end");if(this.startSymbol=l,this.endSymbol=h,r){const t=[...this.attribute.points];if(gt(s))t[s]=this._clipPoints(t[s]);else{const e=this._clipPoints(zt(t));t[0][0]=e[0],t[t.length-1][t[t.length-1].length-1]=e[e.length-1]}t.forEach(((t,e)=>{var n,r;const s=Rl.line(Object.assign(Object.assign({points:t},ht(i)?null!==(n=i[e])&&void 0!==n?n:i[i.length-1]:i),{fill:!1}));s.name=`${this.name}-line`,s.id=this._getNodeId("line"+e),Ct(null==o?void 0:o.line)||(s.states=ht(o.line)?null!==(r=o.line[e])&&void 0!==r?r:o.line[o.line.length-1]:o.line),this.add(s),this.lines.push(s)}))}else{let t=Rl.line;Et(i)[0].cornerRadius&&(t=Rl.polygon);const e=t(Object.assign(Object.assign({points:this._clipPoints(this.attribute.points)},Et(i)[0]),{fill:!1,closePath:!1}));e.name=`${this.name}-line`,e.id=this._getNodeId("line"),Ct(null==o?void 0:o.line)||(e.states=[].concat(o.line)[0]),this.add(e),this.lines.push(e)}}_computeStartRotate(t){return t+Math.PI/2}_computeEndRotate(t){return t+Math.PI/2}_renderSymbol(t,e,i){if(!e.length)return;const{autoRotate:o=!0}=t;let n;if(t&&t.visible){const r=this.getStartAngle(),s=this.getEndAngle(),{state:a}=this.attribute,l=e[0],h=e[e.length-1],{refX:d=0,refY:c=0,refAngle:u=0,style:g,symbolType:p,size:f=12}=t;let v,b;"start"===i?(v={x:l.x+(gt(r)?d*Math.cos(r)+c*Math.cos(r-Math.PI/2):0),y:l.y+(gt(r)?d*Math.sin(r)+c*Math.sin(r-Math.PI/2):0)},b=this._computeStartRotate(this._startAngle)):(v={x:h.x+(gt(s)?d*Math.cos(s)+c*Math.cos(s-Math.PI/2):0),y:h.y+(gt(s)?d*Math.sin(s)+c*Math.sin(s-Math.PI/2):0)},b=this._computeEndRotate(this._endAngle)),n=Rl.symbol(Object.assign(Object.assign(Object.assign({},v),{symbolType:p,size:f,angle:o?b+u:0,strokeBoundsBuffer:0}),g)),n.name=`${this.name}-${i}-symbol`,n.id=this._getNodeId(`${i}-symbol`),Ct(null==a?void 0:a.symbol)||(n.states=a.symbol),"start"===i?Ct(null==a?void 0:a.startSymbol)||(n.states=a.startSymbol):Ct(null==a?void 0:a.endSymbol)||(n.states=a.endSymbol),this.add(n)}return n}_getMainSegmentPoints(){if(this._mainSegmentPoints)return this._mainSegmentPoints;const{points:t,multiSegment:e,mainSegmentIndex:i}=this.attribute;let o;return o=e?gt(i)?t[i]:zt(t):t,this._mainSegmentPoints=o,o}_clipPoints(t){const{startSymbol:e={},endSymbol:i={}}=this.attribute;let o=t;if(e.visible){const i=e.clip?e.size||10:0;o=[{x:t[0].x-i/2*(Math.cos(this._startAngle)||0),y:t[0].y-i/2*(Math.sin(this._startAngle)||0)},...o.slice(1)]}if(i.visible){const e=i.clip?i.size||10:0,n={x:t[t.length-1].x-e/2*(Math.cos(this._endAngle)||0),y:t[t.length-1].y-e/2*(Math.sin(this._endAngle)||0)};o=[...o.slice(0,o.length-1),n]}return o}_computeLineAngle(){const t=this._getMainSegmentPoints();if(t.length<=1)return;const e=t[0],i=t[1],o=t[t.length-2],n=t[t.length-1],r=[e.x-i.x,e.y-i.y],s=Math.atan2(r[1],r[0]),a=[n.x-o.x,n.y-o.y],l=Math.atan2(a[1],a[0]);this._startAngle=s,this._endAngle=l}_reset(){this.startSymbol=null,this.endSymbol=null,this._startAngle=null,this._endAngle=null,this._mainSegmentPoints=null}}var gm,pm;um.defaultAttributes={visible:!0,lineStyle:{lineWidth:1,stroke:"#000"},startSymbol:{visible:!1,autoRotate:!0,symbolType:"triangle",size:12,refX:0,refY:0,refAngle:0,style:{fill:"#000",zIndex:1}},endSymbol:{visible:!1,autoRotate:!0,symbolType:"triangle",size:12,refX:0,refY:0,refAngle:0,style:{fill:"#000",zIndex:1}}},function(t){t.innerView="inner-view",t.axisContainer="axis-container",t.labelContainer="axis-label-container",t.tickContainer="axis-tick-container",t.tick="axis-tick",t.subTick="axis-sub-tick",t.label="axis-label",t.title="axis-title",t.gridContainer="axis-grid-container",t.grid="axis-grid",t.gridRegion="axis-grid-region",t.line="axis-line",t.background="axis-background",t.axisLabelBackground="axis-label-background",t.axisBreak="axis-break",t.axisBreakSymbol="axis-break-symbol"}(gm||(gm={})),function(t){t.selected="selected",t.selectedReverse="selected_reverse",t.hover="hover",t.hoverReverse="hover_reverse"}(pm||(pm={}));const fm={[pm.selectedReverse]:{},[pm.selected]:{},[pm.hover]:{},[pm.hoverReverse]:{}},vm={title:{space:4,padding:0,textStyle:{fontSize:12,fill:"#333333",fontWeight:"normal",fillOpacity:1}},label:{visible:!0,inside:!1,space:4,padding:0,style:{fontSize:12,fill:"#333",fontWeight:"normal",fillOpacity:1}},tick:{visible:!0,inside:!1,alignWithLabel:!0,length:4,style:{lineWidth:1,stroke:"#000",strokeOpacity:1}},subTick:{visible:!1,inside:!1,count:4,length:2,style:{lineWidth:1,stroke:"#999",strokeOpacity:1}},line:{visible:!0,style:{lineWidth:1,stroke:"#000",strokeOpacity:1}}},bm={size:8,stroke:"#000",lineWidth:1,zIndex:1};const mm=Math.sin(Math.PI/10);function ym(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mm;const i=!it(t)&&0!==t,o=i?Math.cos(t):1;return i&&Math.abs(o)<=e}function Cm(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mm;const i=!it(t)&&0!==t,o=i?Math.sin(t):0;return!i||Math.abs(o)<=e}function wm(t,e){return{x:t.x+e[0],y:t.y+e[1]}}function xm(t,e,i){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const r=[e.x-i.x,e.y-i.y];return jb(r,(o?-1:1)*(n?-1:1)*t/Vb(r))}function _m(t,e,i,o,n){const r=function(t,e,i){return e?{x:t.x+e*Math.cos(i),y:t.y+e*Math.sin(i)}:{x:t.x,y:t.y}}({x:0,y:0},i,t),s=wm(r,xm(o,r,e,n));return a=s,l=xm(o||1,s,e,n),{x:a.x+l[0],y:a.y+l[1]};var a,l}function Sm(t,e,i){var o;let n,r;const s=(t,e,i)=>(n=t.AABBBounds,r=e.AABBBounds,i>Math.max(r.x1-n.x2,n.x1-r.x2,r.y1-n.y2,n.y1-r.y2));return Cm(null===(o=t.attribute)||void 0===o?void 0:o.angle,Number.EPSILON)?s(t,e,i):(n=t.OBBBounds,r=e.OBBBounds,!n||!r||n.empty()||r.empty()?s(t,e,i):n.intersects(r))}function Am(t,e){for(let i,o=1,n=t.length,r=t[0];o<n;r=i,++o)if(i=t[o],Sm(r,i,e))return!0;return!1}class Bm extends mg{constructor(){super(...arguments),this.name="axis",this.data=[],this.tickLineItems=[],this.subTickLineItems=[],this.axisLabelLayerSize={},this.axisLabelsContainer=null,this._onHover=t=>{this._lastHover=((t,e,i)=>{const o=t.target;return o!==i&&o.name&&!Ct(o.states)?(o.addState(Ib.hover,!0),Gb(e,(t=>{t!==o&&t.name&&!Ct(t.states)&&t.addState(Ib.hoverReverse,!0)})),o):i})(t,this.axisContainer,this._lastHover)},this._onUnHover=t=>{this._lastHover=((t,e,i)=>i?(Gb(e,(t=>{t.name&&!Ct(t.states)&&(t.removeState(Ib.hoverReverse),t.removeState(Ib.hover))})),null):i)(0,this.axisContainer,this._lastHover)},this._onClick=t=>{this._lastSelect=((t,e,i)=>{const o=t.target;return i===o&&o.hasState(Ib.selected)?(Gb(e,(t=>{t.name&&!Ct(t.states)&&(t.removeState(Ib.selectedReverse),t.removeState(Ib.selected))})),null):o.name&&!Ct(o.states)?(o.addState(Ib.selected,!0),Gb(e,(t=>{t!==o&&t.name&&!Ct(t.states)&&t.addState(Ib.selectedReverse,!0)})),o):i})(t,this.axisContainer,this._lastSelect)}}getInnerView(){return this._innerView}getPrevInnerView(){return this._prevInnerView}getBoundsWithoutRender(t){const e=St(this.attribute);Tt(this.attribute,t);const i=Rl.group({x:this.attribute.x,y:this.attribute.y});return this.add(i),this._renderInner(i),this.removeChild(i),this.attribute=e,i.AABBBounds}render(){this._prevInnerView=this._innerView&&function(t){const e={};return Gb(t,(t=>{"group"!==t.type&&t.id&&(e[t.id]=t)})),e}(this._innerView),this.removeAllChild(!0),this._innerView=Rl.group({x:0,y:0,pickable:!1}),this.add(this._innerView),this._renderInner(this._innerView),this._bindEvent()}_bindEvent(){if(this.attribute.disableTriggerEvent)return;const{hover:t,select:e}=this.attribute;t&&(this._innerView.addEventListener("pointermove",this._onHover),this._innerView.addEventListener("pointerout",this._onUnHover)),e&&this._innerView.addEventListener("pointerdown",this._onClick)}_renderInner(t){const{title:e,label:i,tick:o,line:n,items:r}=this.attribute,s=Rl.group({x:0,y:0,zIndex:1,pickable:!1});if(s.name=gm.axisContainer,s.id=this._getNodeId("container"),s.setMode(this.mode),this.axisContainer=s,t.add(s),n&&n.visible&&this.renderLine(s),r&&r.length&&(this.data=this._transformItems(r[0]),o&&o.visible&&this.renderTicks(s),i&&i.visible)){const t=Rl.group({x:0,y:0,pickable:!1});t.name=gm.labelContainer,t.id=this._getNodeId("label-container"),this.axisLabelsContainer=t,s.add(t),r.forEach(((e,i)=>{const o=this.renderLabels(t,e,i),n=o.getChildren();this.beforeLabelsOverlap(n,e,o,i,r.length),this.handleLabelsOverlap(n,e,o,i,r.length),this.afterLabelsOverlap(n,e,o,i,r.length);let s=0,a=0,l="center",h="middle",d=0;n.forEach(((t,e)=>{var i;const o=t.attribute,n=null!==(i=o.angle)&&void 0!==i?i:0,r=t.AABBBounds;let c=r.width(),u=r.height();n&&(c=Math.abs(c*Math.cos(n)),u=Math.abs(u*Math.sin(n))),s=Math.max(s,c),a=Math.max(a,u),l=o.textAlign,h=o.textBaseline,0===e&&(d=o.x)})),this.axisLabelLayerSize[i]={width:s,height:a,labelPos:d,textAlign:l,textBaseline:h}}))}e&&e.visible&&this.renderTitle(s)}renderTicks(t){const e=this.getTickLineItems(),i=Rl.group({x:0,y:0,pickable:!1});i.name=gm.tickContainer,i.id=this._getNodeId("tick-container"),t.add(i),e.forEach(((t,o)=>{var n;const r=Rl.line(Object.assign({},this._getTickLineAttribute("tick",t,o,e)));if(r.name=gm.tick,r.id=this._getNodeId(t.id),Ct(null===(n=this.attribute.tick)||void 0===n?void 0:n.state))r.states=zb;else{const t=this.data[o],e=Tt({},zb,this.attribute.tick.state);Object.keys(e).forEach((i=>{et(e[i])&&(e[i]=e[i](t.rawValue,o,t,this.data))})),r.states=e}i.add(r)})),this.tickLineItems=e;const{subTick:o}=this.attribute;if(o&&o.visible){const t=this.getSubTickLineItems();t.length&&t.forEach(((t,n)=>{const r=Rl.line(Object.assign({},this._getTickLineAttribute("subTick",t,n,e)));if(r.name=gm.subTick,r.id=this._getNodeId(`${n}`),Ct(o.state))r.states=zb;else{const i=Tt({},zb,o.state);Object.keys(i).forEach((o=>{et(i[o])&&(i[o]=i[o](t.value,n,t,e))})),r.states=i}i.add(r)})),this.subTickLineItems=t}}renderLabels(t,e,i){const{dataFilter:o}=this.attribute.label;o&&et(o)&&(e=o(e,i));const n=this._transformItems(e),r=Rl.group({x:0,y:0,pickable:!1});return r.name=`${gm.labelContainer}-layer-${i}`,r.id=this._getNodeId(`label-container-layer-${i}`),t.add(r),n.forEach(((t,e)=>{var o;const s=qb(this._getLabelAttribute(t,e,n,i));if(s.name=gm.label,s.id=this._getNodeId(`layer${i}-label-${t.id}`),Ct(null===(o=this.attribute.label)||void 0===o?void 0:o.state))s.states=zb;else{const o=Tt({},zb,this.attribute.label.state);Object.keys(o).forEach((r=>{et(o[r])&&(o[r]=o[r](t,e,n,i))})),s.states=o}s.data=Object.assign(Object.assign({},t),{index:e,layer:i}),r.add(s)})),r}renderTitle(t){const e=this.getTitleAttribute(),i=new Qb(Object.assign({},e));i.name=gm.title,i.id=this._getNodeId("title"),t.add(i)}getVerticalCoord(t,e,i){return wm(t,this.getVerticalVector(e,i,t))}getTickLineItems(){const{tick:t}=this.attribute,e=this.data,i=[],{alignWithLabel:o,inside:n=!1,length:r,dataFilter:s}=t;let a=1;return e.length>=2&&(a=e[1].value-e[0].value),(s&&et(s)?s(e):e).forEach((t=>{let e=t.point,s=t.value;if(!o){const i=t.value-a/2;if(this.isInValidValue(i))return;e=this.getTickCoord(i),s=i}const l=this.getVerticalCoord(e,r,n);if("3d"===this.mode){const o=this.getVerticalVector(r,n,e);let a=0,h=0;re(o[0])>re(o[1])?a=ee/2*(l.x>e.x?1:-1):h=ee/2*(l.y>e.y?-1:1),i.push({start:e,end:l,value:s,id:`tick-${t.id}`,anchor:[e.x,e.y],alpha:a,beta:h})}else i.push({start:e,end:l,value:s,id:`tick-${t.id}`})})),i}getSubTickLineItems(){const{subTick:t}=this.attribute,e=[],{count:i=4,inside:o=!1,length:n=2}=t,r=this.tickLineItems,s=r.length;if(s>=2)for(let t=0;t<s-1;t++){const s=r[t],a=r[t+1];for(let t=0;t<i;t++){const r=(t+1)/(i+1),l=(1-r)*s.value+r*a.value,h=this.getTickCoord(l),d=this.getVerticalCoord(h,n,o);e.push({start:h,end:d,value:l,id:`sub-tick-${l}`})}}return e}_getTickLineAttribute(t,e,i,o){let n=wt(this.attribute,`${t}.style`);const r=this.data[i];n=et(n)?Tt({},wt(vm,`${t}.style`),"tick"===t?n(r.rawValue,i,r,this.data):n(e.value,i,e,o)):n;const{start:s,end:a,anchor:l,alpha:h,beta:d}=e;return Object.assign({points:[s,a],anchor:l,alpha:h,beta:d},n)}_getLabelAttribute(t,e,i,o){var n,r;const{space:s=4,inside:a=!1,formatMethod:l,type:h="text",text:d}=this.attribute.label;let c=s,u=0;(null===(n=this.attribute.tick)||void 0===n?void 0:n.visible)&&this.attribute.tick.inside===a&&(u=this.attribute.tick.length||4),(null===(r=this.attribute.subTick)||void 0===r?void 0:r.visible)&&this.attribute.subTick.inside===a&&(u=Math.max(u,this.attribute.subTick.length||2)),c+=u;const g=this.getRelativeVector(t.point);o>0&&(0===g[1]?c+=(this.axisLabelLayerSize[o-1].height+wt(this.attribute,"label.space",4))*o:c+=(this.axisLabelLayerSize[o-1].width+wt(this.attribute,"label.space",4))*o);const p=this.getVerticalCoord(t.point,c,a),f=this.getVerticalVector(c||1,a,p),v=l?l(`${t.label}`,t,e,i,o):t.label;let{style:b}=this.attribute.label;b=et(b)?Tt({},vm.label.style,b(t,e,i,o)):b;return b=Tt(this.getLabelAlign(f,a,b.angle),b),et(b.text)&&(b.text=b.text({label:t.label,value:t.rawValue,index:t.index,layer:o})),Object.assign(Object.assign(Object.assign({},this.getLabelPosition(p,f,v,b)),{text:null!=d?d:v,_originText:t.label,lineHeight:null==b?void 0:b.fontSize,type:h}),b)}getLabelPosition(t,e,i,o){return t}_transformItems(t){const e=[];return t.forEach((t=>{var i;e.push(Object.assign(Object.assign({},t),{point:this.getTickCoord(t.value),id:null!==(i=t.id)&&void 0!==i?i:t.label}))})),e}release(){super.release(),this._prevInnerView=null,this._innerView=null}}const Rm={parity:function(t){return t.filter(((t,e)=>e%2?t.setAttribute("opacity",0):1))},greedy:function(t,e){let i;return t.filter(((t,o)=>o&&Sm(i,t,e)?t.setAttribute("opacity",0):(i=t,1)))}};function Tm(t){let e;return e=t.OBBBounds.empty()?t.AABBBounds:t.OBBBounds,e.width()>1&&e.height()>1}function km(t,e,i,o){let n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(i&&!t.attribute.opacity){const i=e.length;if(i>1){t.setAttribute("opacity",1);for(let t=0;t<i;t++){const r=n?e[i-1-t]:e[t];if(!o(r))break;r.setAttribute("opacity",0)}}}}function Mm(t){for(let r=1;r<t.length;r++)if(e=t[r-1],i=t[r],o=void 0,n=void 0,(null===(o=e.OBBBounds)||void 0===o?void 0:o.empty())||(null===(n=i.OBBBounds)||void 0===n?void 0:n.empty())?Se(e.AABBBounds,i.AABBBounds,!1)&&(!e.rotatedBounds||!i.rotatedBounds||ke(e.rotatedBounds,i.rotatedBounds,!0)):e.OBBBounds.intersects(i.OBBBounds))return!0;var e,i,o,n;return!1}function Lm(t,e){"bottom"!==t&&"top"!==t||function(t,e){e.forEach((e=>{e.attribute.angle&&e.setAttributes(Object.assign(Object.assign({},Em(t,e.attribute.angle)),{angle:Pm(e.attribute.angle)}))}))}(t,e),"left"!==t&&"right"!==t||function(t,e){e.forEach(((e,i)=>{e.attribute.angle&&e.setAttributes(Object.assign(Object.assign({},Hm(t,e.attribute.angle)),{angle:Pm(e.attribute.angle)}))}))}(t,e),function(t){t.forEach((t=>{if(t.rotatedBounds||!t.attribute.angle)return;const e=function(t){const e=t.AABBBounds;return{x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2,centerX:t.attribute.x,centerY:t.attribute.y,angle:t.attribute.angle}}(t),i=Be({x:t.attribute.x,y:t.attribute.y},e.angle,{x:e.centerX,y:e.centerY}),o=i.x-e.centerX,n=i.y-e.centerY;e.x1+=o,e.x2+=o,e.y1+=n,e.y2+=n,e.centerX+=o,e.centerY+=n,t.rotatedBounds=e}))}(e)}function Pm(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(t<0)for(;t<0;)t+=2*Math.PI;if(t>0)for(;t>=2*Math.PI;)t-=2*Math.PI;return t}function Em(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=["center","left","left","left","center","right","right","right","left"],o=["top","top","middle","bottom","bottom","bottom","middle","top","top"];"top"===t&&(i=["center","right","right","right","center","left","left","left","right"],o=["bottom","bottom","middle","top","top","top","middle","bottom","bottom"]);const n=(e=Pm(e))/(.5*Math.PI);let r;return r=n===Math.floor(n)?2*Math.floor(n):2*Math.floor(n)+1,{textAlign:i[r],textBaseline:o[r]}}function Hm(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=["right","right","center","left","left","left","center","right","right"],o=["middle","middle","top","top","middle","middle","bottom","bottom","middle"];"right"===t&&(i=["left","left","center","right","right","right","center","left","left"],o=["middle","middle","bottom","bottom","middle","middle","top","middle","middle"]);const n=(e=Pm(e))/(.5*Math.PI);let r;return r=n===Math.floor(n)?2*Math.floor(n):2*Math.floor(n)+1,{textAlign:i[r],textBaseline:o[r]}}function Fm(t,e){const{limitLength:i,verticalLimitLength:o,ellipsis:n="...",orient:r,axisLength:s}=e;if(Ct(t)||!gt(i))return;const a=function(t){return gt(t)?{left:t,right:t}:nt(t)?{left:t.left||0,right:t.right||0}:{left:0,right:0}}(e.overflowLimitLength),l=t[0],h=l.attribute.angle,d=!it(h),c=d?Math.cos(h):1,u=d?Math.sin(h):0,g=Cm(h),p=ym(h),f="top"===r||"bottom"===r,v=l.attribute.direction,b=!g&&!p&&f&&(t.length<2||t.some((t=>Math.abs(t.AABBBounds.width()-l.AABBBounds.width())>=2)))&&l.AABBBounds.width()>Math.abs(i/u);t.forEach((t=>{var e;if(f){if(p&&Math.floor(t.AABBBounds.height())<=i)return;if(g&&Math.floor(t.AABBBounds.width())<=o)return}if(!f){if("vertical"===v&&Math.floor(t.AABBBounds.height())<=o)return;if("vertical"!==v){if(g&&Math.floor(t.AABBBounds.width())<=i)return;if(p&&Math.floor(t.AABBBounds.height())<=o)return}}let r=null;if(g||p)r=f?g?o:i:"vertical"===v||p?o:i;else if(f){const{x1:e,x2:o}=t.AABBBounds,n=u/c,l=Math.abs(i/u);if(b&&n>0&&e<=s+a.right&&i/n+e>s+a.right){const t=(s-e+a.right)/Math.abs(c);r=Math.min(t,l)}else if(b&&n<0&&o>=-a.left&&i/n+o<-a.left){const t=(o+a.left)/Math.abs(c);r=Math.min(t,l)}else r=l}else r=Math.abs(i/c);gt(t.attribute.maxLineWidth)&&(r=gt(r)?Math.min(t.attribute.maxLineWidth,r):t.attribute.maxLineWidth),t.setAttributes({maxLineWidth:r,ellipsis:null!==(e=t.attribute.ellipsis)&&void 0!==e?e:n})}))}function Om(t,e,i){let o;return gt(e)&&(o=Math.abs(e-t)),gt(i)&&(o=gt(o)?Math.min(Math.abs(t-i),o):Math.abs(t-i)),o}var Im=function(t,e){var i={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(i[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(t);n<o.length;n++)e.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(t,o[n])&&(i[o[n]]=t[o[n]])}return i};pb(),mb(),Bb(),Pb(),Sb();class zm extends Bm{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Tt({},zm.defaultAttributes,t),e)}_renderInner(t){var e;if(this._breaks=null,this.attribute.breaks&&this.attribute.breaks.length){const t=[];for(let e=0;e<this.attribute.breaks.length;e++){const i=this.attribute.breaks[e],{range:o,breakSymbol:n,rawRange:r}=i;t.push({startPoint:this.getTickCoord(o[0]),endPoint:this.getTickCoord(o[1]),range:o,breakSymbol:n,rawRange:r})}this._breaks=t}super._renderInner(t),this._breaks&&this._breaks.length&&this._breaks.forEach(((e,i)=>{const{startPoint:o,endPoint:n,breakSymbol:r,rawRange:s}=e;if(!1!==(null==r?void 0:r.visible)){const e=Rl.group({zIndex:999});e.name=gm.axisBreak,e.id=this._getNodeId(`${gm.axisBreak}-${i}`),e.data=s;const a=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var e,i;const{style:o={},angle:n=.5*Math.PI}=t,r=Tt({},bm,o),s=null!==(e=r.size)&&void 0!==e?e:bm.size;return Object.assign(Object.assign({},r),{symbolType:null!==(i=r.symbolType)&&void 0!==i?i:`M ${-s/2} ${s*Math.sin(n)} L ${s/2} ${-s*Math.sin(n)}`,symbolSize:s})}(r),l=Rl.symbol(Object.assign({x:o.x,y:o.y},a));l.name=gm.axisBreakSymbol;const h=Rl.symbol(Object.assign({x:n.x,y:n.y},a));h.name=gm.axisBreakSymbol,e.add(l),e.add(h),t.add(e)}}));const{panel:i}=this.attribute;if(i&&i.visible){const t=this.axisContainer,o=t.AABBBounds,n=Rl.rect(Object.assign({x:o.x1,y:o.y1,width:o.width(),height:o.height()},i.style));n.name=gm.background,n.id=this._getNodeId("background"),n.states=Tt({},fm,null!==(e=i.state)&&void 0!==e?e:{}),t.insertBefore(n,t.firstChild)}}renderLine(t){const{start:e,end:i,line:o}=this.attribute,n=o,{startSymbol:r,endSymbol:s,style:a,state:l}=n,h=Im(n,["startSymbol","endSymbol","style","state"]),d=Object.assign({startSymbol:r,endSymbol:s,lineStyle:a},h);if(this._breaks&&this._breaks.length){const t=[];let o=e;this._breaks.forEach((e=>{const{startPoint:i,endPoint:n}=e;t.push([o,i]),o=n})),t.push([o,i]),d.points=t,d.multiSegment=!0}else d.points=[e,i];Ct(l)||(d.state={line:Tt({},fm,l),symbol:Tt({},fm,l)});const c=new um(d);c.name=gm.line,c.id=this._getNodeId("line"),t.add(c)}getTextAlign(t){let e="center";return Ut(t[0],0)?Ut(t[1],0)?Object.is(t[1],-0)?e="start":Object.is(t[0],-0)&&(e="end"):e="center":t[0]>0?e="start":t[0]<0&&(e="end"),e}getTitleAttribute(){var t,e,i;const o=this.attribute.title,{position:n="middle",space:r=4,textStyle:s={},autoRotate:a=!0,shape:l,background:h,state:d={},maxWidth:c}=o,u=Im(o,["position","space","textStyle","autoRotate","shape","background","state","maxWidth"]);let g=.5;"start"===n?g=0:"end"===n&&(g=1);const{verticalFactor:p=1}=this.attribute,f=-1*p,v=this.getTickCoord(g),b=this.getRelativeVector();let m=0;if((null===(t=this.attribute.label)||void 0===t?void 0:t.visible)&&!1===this.attribute.label.inside){const t=+wt(this.attribute,"label.space",4);m+=t;const e=Object.keys(this.axisLabelLayerSize).length;if(0===b[1]){const i=this.axisLabelsContainer?this.axisLabelsContainer.AABBBounds.height():0;isFinite(i)?m+=i+(e-1)*t:m=0}else if(0===b[0])if(this.axisLabelsContainer&&this.axisLabelsContainer.AABBBounds&&!this.axisLabelsContainer.AABBBounds.empty()){const i=this.axisLabelLayerSize[0].labelPos,o=this.axisLabelsContainer.AABBBounds;m+=(1===f?o.x2>i?Math.min(o.x2-i,o.width()):0:o.x1<i?Math.min(i-o.x1,o.width()):0)+(e-1)*t}else m=0;else Object.keys(this.axisLabelLayerSize).forEach(((e,i)=>{m+=this.axisLabelLayerSize[e].width+(i>0?t:0)}))}let y=0;(null===(e=this.attribute.tick)||void 0===e?void 0:e.visible)&&!1===this.attribute.tick.inside&&(y=this.attribute.tick.length||4),(null===(i=this.attribute.subTick)||void 0===i?void 0:i.visible)&&!1===this.attribute.subTick.inside&&(y=Math.max(y,this.attribute.subTick.length||2));const C=y+m+r,w=this.getVerticalCoord(v,C,!1),x=this.getVerticalVector(C,!1,{x:0,y:0});let _,S,{angle:A}=u;if(_="start"===n?"start":"end"===n?"end":"center",it(A)&&a){A=Ub(b,[1,0],!0);const{verticalFactor:t=1}=this.attribute;S=1==-1*t?"bottom":"top"}else _=this.getTextAlign(x),S=this.getTextBaseline(x,!1);let B=c;if(it(B)){const{verticalLimitSize:t,verticalMinSize:e,orient:i}=this.attribute,o=Math.min(t||1/0,e||1/0);if(gt(o))if("bottom"===i||"top"===i)if(A!==Math.PI/2){const t=Math.abs(Math.cos(null!=A?A:0));B=t<1e-6?1/0:this.attribute.end.x/t}else B=o-C;else if(A&&0!==A){const t=Math.abs(Math.sin(A));B=t<1e-6?1/0:this.attribute.end.y/t}else B=o-C}const R=Object.assign(Object.assign(Object.assign({},w),u),{maxWidth:B,textStyle:Object.assign({textAlign:_,textBaseline:S},s),state:{text:Tt({},fm,d.text),shape:Tt({},fm,d.shape),panel:Tt({},fm,d.background)}});return R.angle=A,l&&l.visible&&(R.shape=Object.assign({visible:!0},l.style),l.space&&(R.space=l.space)),h&&h.visible&&(R.panel=Object.assign({visible:!0},h.style)),R}getTextBaseline(t,e){let i="middle";const{verticalFactor:o=1}=this.attribute,n=(e?1:-1)*o;return Ut(t[1],0)?i=!Ut(t[0],0)||Object.is(t[0],-0)||Object.is(t[1],-0)?"middle":1===n?"bottom":"top":t[1]>0?i="top":t[1]<0&&(i="bottom"),i}getLabelAlign(t,e,i){const o=this.attribute.orient;if(["top","bottom","right","left"].includes(o)||0===t[0]&&0===t[1]){if("top"===o||"bottom"===o)return Em(e?"bottom"===o?"top":"bottom":o,i);if("left"===o||"right"===o)return Hm(e?"left"===o?"right":"left":o,i)}return{textAlign:this.getTextAlign(t),textBaseline:this.getTextBaseline(t,e)}}beforeLabelsOverlap(t,e,i,o,n){var r,s,a,l;const{flush:h=!1}=this.attribute.label||{};if(h&&t.length){const{orient:e,start:i,end:o}=this.attribute,n="bottom"===e||"top"===e,h=t[0],d=Ht(t),c=n?h.attribute.x>d.attribute.x:h.attribute.y<d.attribute.y;if(n){const t=c?d:h,e=c?h:d,n=i.x,a=o.x,l=t.AABBBounds.x1,u=e.AABBBounds.x2;l<n&&(t.attribute.angle?t.setAttributes({dx:(null!==(r=t.attribute.dx)&&void 0!==r?r:0)+n-l}):t.setAttributes({x:n,textAlign:"left"})),u>a&&(e.attribute.angle?e.setAttributes({dx:(null!==(s=e.attribute.dx)&&void 0!==s?s:0)+a-u}):e.setAttributes({x:a,textAlign:"right"}))}else{const t=c?d:h,e=c?h:d,n=t.AABBBounds.y2,r=e.AABBBounds.y1,s=i.y,u=o.y;r<s&&(e.attribute.angle?e.setAttributes({dy:(null!==(a=e.attribute.dy)&&void 0!==a?a:0)+s-r}):e.setAttributes({y:s,textBaseline:"top"})),n>u&&(t.attribute.angle?t.setAttributes({dy:(null!==(l=t.attribute.dy)&&void 0!==l?l:0)+u-n}):t.setAttributes({y:u,textBaseline:"bottom"}))}}}handleLabelsOverlap(t,e,i,o,n){if(Ct(t))return;const{verticalLimitSize:r,label:s,orient:a}=this.attribute,l=this._getAxisLabelLimitLength(r,n),{layoutFunc:h,autoRotate:d,autoRotateAngle:c,autoLimit:u,limitEllipsis:g,autoHide:p,autoHideMethod:f,autoHideSeparation:v,lastVisible:b,firstVisible:m,autoWrap:y,overflowLimitLength:C}=s;if(et(h))h(t,e,o,this);else{if(d)!function(t,e){if(Ct(t))return;const{orient:i,labelRotateAngle:o=[0,45,90]}=e;if(0===o.length||t.some((t=>!!t.attribute.angle)))return;let n=0,r=0;for(o&&o.length>0&&(r=o.length);n<r;){const e=o[n++];if(t.forEach((t=>{t.attribute.angle=be(e)})),Lm(i,t),!Mm(t))break}}(t,{labelRotateAngle:c,orient:a});else if(y){!function(t,e){const{limitLength:i,axisLength:o,ellipsis:n="...",orient:r}=e;if(Ct(t)||!gt(i))return;const s=t[0].attribute.angle,a=Cm(s),l=ym(s),h="top"===r||"bottom"===r;let d=o/t.length;t.forEach(((e,o)=>{var r,s,c,u,g;if(h){if(l&&Math.floor(e.AABBBounds.height())<=i)return;if(a){const i=Om(e.attribute.x,null===(r=t[o+1])||void 0===r?void 0:r.attribute.x,null===(s=t[o-1])||void 0===s?void 0:s.attribute.x);gt(i)&&(d=he(d,i))}}else{if(l){const i=Om(e.attribute.y,null===(c=t[o+1])||void 0===c?void 0:c.attribute.y,null===(u=t[o-1])||void 0===u?void 0:u.attribute.y);gt(i)&&(d=he(d,i))}if(a&&Math.floor(e.AABBBounds.width())<=i)return}let p=null,f=null;h?l?(p=i,f=d):(p=d,f=i):l?(p=d,f=i):(p=i,f=d),e.setAttributes({maxLineWidth:p,ellipsis:null!==(g=e.attribute.ellipsis)&&void 0!==g?g:n,whiteSpace:"normal",heightLimit:f})}))}(t,{orient:a,limitLength:l,axisLength:"left"===a||"right"===a?Math.abs(this.attribute.start.y-this.attribute.end.y):Math.abs(this.attribute.start.x-this.attribute.end.x),ellipsis:g})}if(!y&&u&&gt(l)&&l>0){const e="left"===a||"right"===a,i=e?Math.abs(this.attribute.start.y-this.attribute.end.y):Math.abs(this.attribute.start.x-this.attribute.end.x);Fm(t,{limitLength:l,verticalLimitLength:e?i/t.length:p||d?1/0:i/t.length,ellipsis:g,orient:a,axisLength:i,overflowLimitLength:C})}p&&function(t,e){if(Ct(t))return;const i=t.filter(Tm);if(Ct(i))return;let o;o=function(t){return t.forEach((t=>t.setAttribute("opacity",1))),t}(i);const{method:n="parity",separation:r=0}=e,s=et(n)?n:Rm[n]||Rm.parity;if(o.length>=3&&Am(o,r)){do{o=s(o,r)}while(o.length>=3&&Am(o,r));const t=function(t,e){return(!(arguments.length>2&&void 0!==arguments[2])||arguments[2])&&t<3||e},n=t(o.length,e.firstVisible,!1);let a=t(o.length,e.lastVisible);const l=i[0],h=Ht(i);Sm(l,h,r)&&n&&a&&(h.setAttribute("opacity",0),a=!1),km(l,o,n,(t=>Sm(t,l,r))),km(h,o,a,(t=>Sm(t,h,r)||!(!n||t===l)&&Sm(t,l,r)),!0)}i.forEach((t=>{t.setAttribute("visible",!!t.attribute.opacity)}))}(t,{orient:a,method:f,separation:v,lastVisible:b,firstVisible:m})}}afterLabelsOverlap(t,e,i,o,n){const{verticalLimitSize:r,orient:s}=this.attribute,a="bottom"===s||"top"===s,l=i.AABBBounds;let h=a?l.height():l.width();const{verticalMinSize:d}=this.attribute;if(gt(d)&&(!gt(r)||d<=r)){const t=this._getAxisLabelLimitLength(d,n);let e,o;h=Math.max(h,t),"left"===s?(e=l.x2-h,o=l.y1):"right"===s?(e=l.x1,o=l.y1):"top"===s?(e=l.x1,o=l.y2-h):"bottom"===s&&(e=l.x1,o=l.y1);const r=Rl.rect({x:e,y:o,width:a?l.width():h,height:a?h:l.height(),pickable:!1});r.name=gm.axisLabelBackground,r.id=this._getNodeId("axis-label-background"),i.insertBefore(r,i.firstChild)}if(ot(this.attribute.label.containerAlign)){let e;"left"===s?e=l.x2-h:"right"===s?e=l.x1:"top"===s?e=l.y2-h:"bottom"===s&&(e=l.y1),function(t,e,i,o,n){"left"===o||"right"===o?"left"===n?t.forEach((t=>{var i;t.setAttributes({dx:(null!==(i=t.attribute.dx)&&void 0!==i?i:0)+e-t.AABBBounds.x1})})):"right"===n?t.forEach((t=>{var o;t.setAttributes({dx:(null!==(o=t.attribute.dx)&&void 0!==o?o:0)+e+i-t.AABBBounds.x2})})):"center"===n&&t.forEach((t=>{var o;t.setAttributes({dx:(null!==(o=t.attribute.dx)&&void 0!==o?o:0)+e+i/2-(t.AABBBounds.x1+t.AABBBounds.x2)/2})})):"bottom"!==o&&"top"!==o||("top"===n?t.forEach((t=>{var i;t.setAttributes({dy:(null!==(i=t.attribute.dy)&&void 0!==i?i:0)+e-t.AABBBounds.y1})})):"bottom"===n?t.forEach((t=>{var o;t.setAttributes({dy:(null!==(o=t.attribute.dy)&&void 0!==o?o:0)+e+i-t.AABBBounds.y2})})):"middle"===n&&t.forEach((t=>{var o;t.setAttributes({dy:(null!==(o=t.attribute.dy)&&void 0!==o?o:0)+e+i/2-(t.AABBBounds.y1+t.AABBBounds.y2)/2})})))}(t,e,h,s,this.attribute.label.containerAlign)}}_getAxisLabelLimitLength(t,e){var i,o,n,r,s;const{label:a,title:l,line:h,tick:d}=this.attribute,c=null!==(i=a.space)&&void 0!==i?i:4;let u=t,g=0,p=0;const f=h&&h.visible?null!==(o=h.style.lineWidth)&&void 0!==o?o:1:0,v=d&&d.visible?null!==(n=d.length)&&void 0!==n?n:4:0;if(l&&l.visible&&"string"==typeof l.text){g=Xb(l.text,l.textStyle,null===(s=null===(r=this.stage)||void 0===r?void 0:r.getTheme())||void 0===s?void 0:s.text).height;const t=Je(l.padding);p=l.space+t[0]+t[2]}return u&&(u=(u-c-p-g-f-v)/e),u}release(){super.release(),this._breaks=null}}zm.defaultAttributes=vm,function(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t="prototype"in t?t.prototype:t,e="prototype"in e?e.prototype:e,Object.getOwnPropertyNames){const o=Object.getOwnPropertyNames(e);for(let n=0;n<o.length;n++){const r=o[n];"constructor"!==r&&(i?null!=e[r]:null==t[r])&&(t[r]=e[r])}}else Pt(t,e,i)}(zm,class{isInValidValue(t){return t<0||t>1}getTickCoord(t){const{start:e}=this.attribute,i=this.getRelativeVector();return{x:e.x+i[0]*t,y:e.y+i[1]*t}}getRelativeVector(t){const{start:e,end:i}=this.attribute;return[i.x-e.x,i.y-e.y]}getVerticalVector(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{verticalFactor:i=1}=this.attribute,o=function(t){let e=Vb(t);return e>0&&(e=1/e),[t[0]*e,t[1]*e]}(this.getRelativeVector());return jb([o[1],-1*o[0]],t*(e?1:-1)*i)}});const Dm=t=>t.map(((t,e)=>({index:e,value:t}))),Wm=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const o=new Fe(t).expand(i/2),n=new Fe(e).expand(i/2);return o.intersects(n)},Nm=(t,e,i,o)=>i<t?Math.max(t-e/2,i):i>t?Math.min(t-e/2,i-e):i<o?i:i-e,Gm=(t,e,i)=>{var o;const{labelStyle:n,axisOrientType:r,labelFlush:s,labelFormatter:a,startAngle:l=0}=i;let h=null!==(o=n.angle)&&void 0!==o?o:0;"vertical"===n.direction&&(h+=be(90));const d=["bottom","top"].includes(r),c=["left","right"].includes(r);let u=1,g=0;d||(c?(u=0,g=1):l&&(u=Math.cos(l),g=-Math.sin(l)));const p=$b(n),f=t.range(),v=e.map(((i,o)=>{var r,l;const v=a?a(i):`${i}`,{width:b,height:m}=p.quickMeasure(v),y=Math.max(b,12),C=Math.max(m,12),w=t.scale(i),x=u*w,_=g*w;let S,A,B=x,R=_;s&&d&&0===o?B=Nm(x,y,f[0],f[f.length-1]):s&&d&&o===e.length-1?B=Nm(x,y,f[f.length-1],f[0]):S=null!==(r=n.textAlign)&&void 0!==r?r:"center","right"===S?B-=y:"center"===S&&(B-=y/2),s&&c&&0===o?R=Nm(_,C,f[0],f[f.length-1]):s&&c&&o===e.length-1?R=Nm(_,C,f[f.length-1],f[0]):A=null!==(l=n.textBaseline)&&void 0!==l?l:"middle","bottom"===A?R-=C:"middle"===A&&(R-=C/2);const T=(new Fe).set(B,R,B+y,R+C);return h&&T.rotate(h,x,_),T}));return v};var jm;function Vm(t){switch(t){case jm.Linear:case jm.Log:case jm.Pow:case jm.Sqrt:case jm.Symlog:case jm.Time:return!0;default:return!1}}function Um(t){return t}function $m(t,e){if(t=Number(t),e=Number(e),e-=t)return i=>(i-t)/e;const i=Number.isNaN(e)?NaN:.5;return()=>i}function Xm(t,e,i){const o=t[0],n=t[1],r=e[0],s=e[1];let a,l;return n<o?(a=$m(n,o),l=i(s,r)):(a=$m(o,n),l=i(r,s)),t=>l(a(t))}function Ym(t,e,i){const o=Math.min(t.length,e.length)-1,n=new Array(o),r=new Array(o);let s=-1;for(t[o]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++s<o;)n[s]=$m(t[s],t[s+1]),r[s]=i(e[s],e[s+1]);return function(e){const i=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0;for(it(o)&&(o=t.length);i<o;){const n=i+o>>>1;Dt(t[n],e)>0?o=n:i=n+1}return i}(t,e,1,o)-1;return r[i](n[i](e))}}!function(t){t.Identity="identity",t.Linear="linear",t.Log="log",t.Pow="pow",t.Sqrt="sqrt",t.Symlog="symlog",t.Time="time",t.Quantile="quantile",t.Quantize="quantize",t.Threshold="threshold",t.Ordinal="ordinal",t.Point="point",t.Band="band"}(jm||(jm={})),Object.values(jm).forEach((t=>{}));let Km=class{constructor(){this._rangeFactorStart=null,this._rangeFactorEnd=null}_calculateWholeRange(t){return this._wholeRange?this._wholeRange:ot(this._rangeFactorStart)&&ot(this._rangeFactorEnd)&&2===t.length?(this._wholeRange=function(t,e){const i=(t[1]-t[0])/(e[1]-e[0]),o=t[0]-i*e[0];return[o,i+o]}(t,[this._rangeFactorStart,this._rangeFactorEnd]),this._wholeRange):t}rangeFactor(t,e,i){return t?(2===t.length&&t.every((t=>t>=0&&t<=1))&&(this._wholeRange=null,0===t[0]&&1===t[1]?(this._rangeFactorStart=null,this._rangeFactorEnd=null):(this._rangeFactorStart=t[0],this._rangeFactorEnd=t[1])),this):i?(this._wholeRange=null,this._rangeFactorStart=null,this._rangeFactorEnd=null,this):ot(this._rangeFactorStart)&&ot(this._rangeFactorEnd)?[this._rangeFactorStart,this._rangeFactorEnd]:null}rangeFactorStart(t,e){var i;return it(t)?this._rangeFactorStart:(t>=0&&t<=1&&(this._wholeRange=null,0!==t||!it(this._rangeFactorEnd)&&1!==this._rangeFactorEnd?(this._rangeFactorStart=t,this._rangeFactorEnd=null!==(i=this._rangeFactorEnd)&&void 0!==i?i:1):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}rangeFactorEnd(t,e){var i;return it(t)?this._rangeFactorEnd:(t>=0&&t<=1&&(this._wholeRange=null,0!==t||!it(this._rangeFactorStart)&&0!==this._rangeFactorStart?(this._rangeFactorEnd=t,this._rangeFactorStart=null!==(i=this._rangeFactorStart)&&void 0!==i?i:0):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}generateFishEyeTransform(){var t;if(!this._fishEyeOptions)return void(this._fishEyeTransform=null);const{distortion:e=2,radiusRatio:i=.1,radius:o}=this._fishEyeOptions,n=this.range(),r=n[0],s=n[n.length-1],a=Math.min(r,s),l=Math.max(r,s),h=Xt(null!==(t=this._fishEyeOptions.focus)&&void 0!==t?t:0,a,l),d=it(o)?(l-a)*i:o;let c=Math.exp(e);c=c/(c-1)*d;const u=e/d;this._fishEyeTransform=t=>{const e=Math.abs(t-h);if(e>=d)return t;if(e<=1e-6)return h;const i=c*(1-Math.exp(-e*u))/e*.75+.25;return h+(t-h)*i}}unknown(t){return arguments.length?(this._unknown=t,this):this._unknown}get(t,e){var i;return null!==(i=null==this?void 0:this[t])&&void 0!==i?i:e}};const{interpolateRgb:qm}=Ze;function Zm(t,e){const i=typeof e;let o;if(it(e)||"boolean"===i)return()=>e;if("number"===i)return Jt(t,e);if("string"===i){if(o=Ke.parseColorString(e)){const e=qm(Ke.parseColorString(t),o);return t=>e(t).formatRgb()}return Jt(Number(t),Number(e))}return e instanceof qe?qm(t,e):e instanceof Ke?qm(t.color,e.color):e instanceof Date?function(t,e){const i=t.valueOf(),o=e.valueOf(),n=new Date;return t=>(n.setTime(i*(1-t)+o*t),n)}(t,e):Jt(Number(t),Number(e))}let Jm=class extends Km{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Um,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Um;super(),this._unknown=void 0,this.transformer=t,this.untransformer=e,this._forceAlign=!0,this._domain=[0,1],this._range=[0,1],this._clamp=Um,this._piecewise=Xm,this._interpolate=Zm}calculateVisibleDomain(t){var e;return ot(this._rangeFactorStart)&&ot(this._rangeFactorEnd)&&2===t.length?[this.invert(t[0]),this.invert(t[1])]:null!==(e=this._niceDomain)&&void 0!==e?e:this._domain}fishEye(t,e,i){return t||i?(this._fishEyeOptions=t,this._fishEyeTransform=null,this.rescale(e)):this._fishEyeOptions}scale(t){var e;if(t=Number(t),Number.isNaN(t)||this._domainValidator&&!this._domainValidator(t))return this._unknown;this._output||(this._output=this._piecewise((null!==(e=this._niceDomain)&&void 0!==e?e:this._domain).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const i=this._output(this.transformer(this._clamp(t)));return this._fishEyeTransform?this._fishEyeTransform(i):i}invert(t){var e;return this._input||(this._input=this._piecewise(this._calculateWholeRange(this._range),(null!==(e=this._niceDomain)&&void 0!==e?e:this._domain).map(this.transformer),Jt)),this._clamp(this.untransformer(this._input(t)))}domain(t,e){var i;if(!t)return(null!==(i=this._niceDomain)&&void 0!==i?i:this._domain).slice();this._domainValidator=null,this._niceType=null,this._niceDomain=null;const o=Array.from(t,Wt);return this._domain=o,this.rescale(e)}range(t,e){if(!t)return this._range.slice();const i=Array.from(t);return this._range=i,this.rescale(e)}rangeRound(t,e){const i=Array.from(t);return this._range=i,this._interpolate=Qt,this.rescale(e)}rescale(t){var e;if(t)return this;const i=null!==(e=this._niceDomain)&&void 0!==e?e:this._domain,o=i.length,n=this._range.length;let r=Math.min(o,n);if(o&&o<n&&this._forceAlign){const t=n-o+1,e=i[o-1],s=o>=2?(e-i[o-2])/t:0;for(let n=1;n<=t;n++)i[o-2+n]=e-s*(t-n);r=n}return this._autoClamp&&(this._clamp=function(t,e){let i;return t>e&&(i=t,t=e,e=i),i=>Math.max(t,Math.min(e,i))}(i[0],i[r-1])),this._piecewise=r>2?Ym:Xm,this._output=this._input=null,this._wholeRange=null,this.generateFishEyeTransform(),this}clamp(t,e,i){return arguments.length?(e?(this._autoClamp=!1,this._clamp=e):(this._autoClamp=!!t,this._clamp=t?void 0:Um),this.rescale(i)):this._clamp!==Um}interpolate(t,e){return arguments.length?(this._interpolate=t,this.rescale(e)):this._interpolate}ticks(){return[]}tickData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.ticks(t);return(null!=e?e:[]).map(((t,e)=>({index:e,tick:t,value:(this.scale(t)-this._range[0])/(this._range[1]-this._range[0])})))}rangeFactor(t,e){return t?(super.rangeFactor(t),this._output=this._input=null,this):super.rangeFactor()}rangeFactorStart(t,e){return it(t)?super.rangeFactorStart():(super.rangeFactorStart(t),this._output=this._input=null,this)}rangeFactorEnd(t,e){return it(t)?super.rangeFactorEnd():(super.rangeFactorEnd(t),this._output=this._input=null,this)}forceAlignDomainRange(t){return arguments.length?(this._forceAlign=t,this):this._forceAlign}};const Qm=Math.sqrt(50),ty=Math.sqrt(10),ey=Math.sqrt(2),iy=[1,2,5,10],oy=(t,e,i)=>{let o=1,n=t;const r=Math.floor((e-1)/2),s=Math.abs(t);return t>=0&&t<=Number.MIN_VALUE?n=0:t<0&&t>=-Number.MIN_VALUE?n=-(e-1):!i&&s<1?o=ay(s).step:(i||s>1)&&(n=Math.floor(t)-r*o),o>0?(t>0?n=Math.max(n,0):t<0&&(n=Math.min(n,-(e-1)*o)),function(t,e,i){ot(e)||(e=t,t=0),ot(i)||(i=1);let o=-1;const n=0|Math.max(0,Math.ceil((e-t)/i)),r=new Array(n);for(;++o<n;)r[o]=t+o*i;return r}(0,e).map((t=>n+t*o))):t>0?ry(0,-(e-1)/o,o):ry((e-1)/o,0,o)},ny=$t(((t,e,i,o)=>{let n,r,s,a,l=-1;if(i=+i,(t=+t)==(e=+e))return[t];if(Math.abs(t-e)<=Number.MIN_VALUE&&i>0)return[t];if((n=e<t)&&(r=t,t=e,e=r),a=ly(t,e,i).step,!isFinite(a))return[];if(a>0){let i=Math.round(t/a),o=Math.round(e/a);for(i*a<t&&++i,o*a>e&&--o,s=new Array(r=o-i+1);++l<r;)s[l]=(i+l)*a}else if(a<0&&(null==o?void 0:o.noDecimals)){a=1;const i=Math.ceil(t),o=Math.floor(e);if(!(i<=o))return[];for(s=new Array(r=o-i+1);++l<r;)s[l]=i+l}else{a=-a;let i=Math.round(t*a),o=Math.round(e*a);for(i/a<t&&++i,o/a>e&&--o,s=new Array(r=o-i+1);++l<r;)s[l]=(i+l)/a}return n&&s.reverse(),s})),ry=(t,e,i)=>{let o,n,r=-1;if(i>0){let s=Math.floor(t/i),a=Math.ceil(e/i);for((s+1)*i<t&&++s,(a-1)*i>e&&--a,n=new Array(o=a-s+1);++r<o;)n[r]=(s+r)*i}else{i=-i;let s=Math.floor(t*i),a=Math.ceil(e*i);for((s+1)/i<t&&++s,(a-1)/i>e&&--a,n=new Array(o=a-s+1);++r<o;)n[r]=(s+r)/i}return n},sy=$t(((t,e,i,o)=>{let n,r,s;if(i=+i,(t=+t)==(e=+e))return oy(t,i,null==o?void 0:o.noDecimals);if(Math.abs(t-e)<=Number.MIN_VALUE&&i>0)return oy(t,i,null==o?void 0:o.noDecimals);(n=e<t)&&(s=t,t=e,e=s);const a=ly(t,e,i);let l=a.step;if(!isFinite(l))return[];if(l>0){let o=1;const{power:n,gap:s}=a,h=10===s?2*10**n:1*10**n;for(;o<=5&&(r=ry(t,e,l),r.length>i+1)&&i>2;)l+=h,o+=1;i>2&&r.length<i-1&&(r=((t,e,i)=>{let o;const n=t[0],r=t[t.length-1],s=e-t.length;if(r<=0){const e=[];for(o=s;o>=1;o--)e.push(n-o*i);return e.concat(t)}if(n>=0){for(o=1;o<=s;o++)t.push(r+o*i);return t}let a=[];const l=[];for(o=1;o<=s;o++)o%2==0?a=[n-Math.floor(o/2)*i].concat(a):l.push(r+Math.ceil(o/2)*i);return a.concat(t).concat(l)})(r,i,l))}else(null==o?void 0:o.noDecimals)&&l<0&&(l=1),r=ry(t,e,l);return n&&r.reverse(),r})),ay=t=>{const e=Math.floor(Math.log(t)/Math.LN10),i=t/10**e;let o=iy[0];return i>=Qm?o=iy[3]:i>=ty?o=iy[2]:i>=ey&&(o=iy[1]),e>=0?{step:o*10**e,gap:o,power:e}:{step:-(10**-e)/o,gap:o,power:e}};function ly(t,e,i){const o=(e-t)/Math.max(0,i);return ay(o)}function hy(t,e,i){let o;if(i=+i,(t=+t)==(e=+e)&&i>0)return[t];if(i<=0||0===(o=function(t,e,i){return(e-t)/Math.max(1,i-1)}(t,e,i))||!isFinite(o))return[];const n=new Array(i);for(let e=0;e<i;e++)n[e]=t+e*o;return n}function dy(t){let e,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=0,r=t.length-1,s=t[n],a=t[r],l=10;for(a<s&&(i=s,s=a,a=i,i=n,n=r,r=i);l-- >0;){if(i=ly(s,a,o).step,i===e)return t[n]=s,t[r]=a,t;if(i>0)s=Math.floor(s/i)*i,a=Math.ceil(a/i)*i;else{if(!(i<0))break;s=Math.ceil(s*i)/i,a=Math.floor(a*i)/i}e=i}}let cy=class t extends Jm{constructor(){super(...arguments),this.type=jm.Linear}clone(){return(new t).domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate)}tickFormat(){return()=>{}}d3Ticks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;const i=this.calculateVisibleDomain(this._range);return ny(i[0],i[i.length-1],t,e)}ticks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;var i;if(et(null==e?void 0:e.customTicks))return e.customTicks(this,t);if(ot(this._rangeFactorStart)&&ot(this._rangeFactorEnd)&&(this._rangeFactorStart>0||this._rangeFactorEnd<1)&&2===this._range.length||!this._niceType)return this.d3Ticks(t,e);const o=null!==(i=this._niceDomain)&&void 0!==i?i:this._domain,n=this._domain,r=o[0],s=o[o.length-1];let a=sy(n[0],n[n.length-1],t,e);if(!a.length)return a;if(this._domainValidator)a=a.filter(this._domainValidator);else if((a[0]!==r||a[a.length-1]!==s)&&this._niceType){const t=o.slice();if("all"===this._niceType?(t[0]=a[0],t[t.length-1]=a[a.length-1],this._niceDomain=t,this.rescale()):"min"===this._niceType&&a[0]!==r?(t[0]=a[0],this._niceDomain=t,this.rescale()):"max"===this._niceType&&a[a.length-1]!==s&&(t[t.length-1]=a[a.length-1],this._niceDomain=t,this.rescale()),"all"!==this._niceType){const e=Math.min(t[0],t[t.length-1]),i=Math.max(t[0],t[t.length-1]);a=a.filter((t=>t>=e&&t<=i))}}return a}forceTicks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return hy(e[0],e[e.length-1],t)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return function(t,e,i){let o,n,r=-1;if(i=+i,(n=(e=+e)<(t=+t))&&(o=t,t=e,e=o),!isFinite(i)||e-t<=i)return[t];const s=Math.floor((e-t)/i+1),a=new Array(s);for(;++r<s;)a[r]=t+r*i;return n&&a.reverse(),a}(e[0],e[e.length-1],t)}nice(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;var i,o;const n=this._domain;let r=[];if(e){const t=function(t,e){const i=ut(e.forceMin),o=ut(e.forceMax);let n=null;const r=[];let s=null;const a=i&&o?t=>t>=e.forceMin&&t<=e.forceMax:i?t=>t>=e.forceMin:o?t=>t<=e.forceMax:null;return i?r[0]=e.forceMin:ut(e.min)&&e.min<=Math.min(t[0],t[t.length-1])&&(r[0]=e.min),o?r[1]=e.forceMax:ut(e.max)&&e.max>=Math.max(t[0],t[t.length-1])&&(r[1]=e.max),ut(r[0])&&ut(r[1])?(s=t.slice(),s[0]=r[0],s[s.length-1]=r[1]):n=ut(r[0])||ut(r[1])?ut(r[0])?"max":"min":"all",{niceType:n,niceDomain:s,niceMinMax:r,domainValidator:a}}(n,e);if(r=t.niceMinMax,this._domainValidator=t.domainValidator,this._niceType=t.niceType,t.niceDomain)return this._niceDomain=t.niceDomain,this.rescale(),this}else this._niceType="all";if(this._niceType){const e=dy(n.slice(),t);"min"===this._niceType?e[e.length-1]=null!==(i=r[1])&&void 0!==i?i:e[e.length-1]:"max"===this._niceType&&(e[0]=null!==(o=r[0])&&void 0!==o?o:e[0]),this._niceDomain=e,this.rescale()}return this}niceMin(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;this._niceType="min";const e=this._domain[this._domain.length-1],i=dy(this.domain(),t);return i&&(i[i.length-1]=e,this._niceDomain=i,this.rescale()),this}niceMax(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;this._niceType="max";const e=this._domain[0],i=dy(this._domain.slice(),t);return i&&(i[0]=e,this._niceDomain=i,this.rescale()),this}};function uy(t,e,i,o){let n;const{breakData:r}=t;if(r&&r()){const{breakDomains:t}=r(),s=e.domain();n=[];for(let e=0;e<s.length-1;e++)o(i,[s[e],s[e+1]]).forEach((e=>{t.some((t=>e>=t[0]&&e<=t[1]))||n.push(e)}));e.domain(s)}else n=o(i);return n}function gy(t,e,i,o){let n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(i&&!e.includes(t)){let i=e.length;if(i>1){n?e.push(t):e.unshift(t);for(let t=0;t<i;t++){const r=n?i-1-t:t;if(!o(e[r]))break;e.splice(r,1),t--,i--}}}}const py={parity:function(t){return t.filter(((t,e)=>e%2==0))},greedy:function(t,e){let i;return t.filter(((t,o)=>!(o&&Sm(i,t,e)||(i=t,0))))}},fy=(t,e,i,o)=>Gm(t,e,i).map((t=>o?[t.x1,t.x2,t.width()]:[t.y1,t.y2,t.height()])),vy=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Math.max(t[0],e[0])-i/2<=Math.min(t[1],e[1])+i/2},by=(t,e)=>t[1]<e[0]?e[0]-t[1]:e[1]<t[0]?t[0]-e[1]:0,my=(t,e,i,o,n,r)=>{let s=0,a=0,l=-1,h=Number.MAX_VALUE;const d=o=>{let n=!0,r=0;do{r+o<t.length&&vy(e[r],e[r+o],i)&&(n=!1),r+=o}while(n&&r<t.length);return n},c=((t,e,i)=>{let o=t,n=e;for(;o<n;){const t=Math.floor((o+n)/2);i(t)>=0?n=t:o=t+1}return o})(n,t.length,(t=>d(t)?1:-1));let u=c;do{if(u>c&&!r&&!d(u))u++;else{if(!o){a=u;break}{const o=t.length-1;let n,r=0;n=t.length%u>0?t.length-t.length%u+u:t.length;do{if(n-=u,n!==o&&!vy(e[n],e[o],i))break;r++}while(n>0);if(n===o){a=u,s=r;break}{const i=Math.floor(t.length/u)-r+1;if(i<l)break;{l=i;const t=by(e[n],e[o]),d=n-u>=0?by(e[n-u],e[n]):t,c=Math.abs(t-d);if(c<h&&(h=c,a=u,s=r),t<=d)break}}}u++}}while(u<=t.length);return{step:a,delCount:s}},yy=(t,e)=>{const{tickCount:i,forceTickCount:o,tickStep:n,getRadius:r,labelOffset:s,labelGap:a=0,labelStyle:l}=e,h=null==r?void 0:r();if(!h)return Dm(t.domain());let d;if(ot(n))d=t.stepTicks(n);else if(ot(o))d=t.forceTicks(o);else if(ot(i)){const e=t.range(),o=Math.abs(e[e.length-1]-e[0]),n=et(i)?i({axisLength:o,labelStyle:l}):i;d=t.ticks(n)}else if(e.sampling){const i=t.domain(),o=t.range(),n=((t,e,i)=>{var o;const{labelStyle:n,getRadius:r,labelOffset:s,labelFormatter:a,inside:l}=i,h=null==r?void 0:r(),d=null!==(o=n.angle)&&void 0!==o?o:0,c=$b(n);return e.map((e=>{const i=a?a(e):`${e}`,{width:o,height:r}=c.quickMeasure(i),u=Math.max(o,12),g=Math.max(r,12),p=t.scale(e),f={x:0,y:0};let v=0,b=0;const m={align:n.textAlign,baseline:n.textBaseline},{x:y,y:C}=_m(p,f,h,s,l);return m.align||(Ut(y,f.x)?m.baseline||(m.baseline=C>f.y?"top":"bottom"):y>f.x?m.align="left":y<f.x&&(m.align="right")),v=y+("right"===m.align?-u:"left"===m.align?0:-u/2),b=C+("bottom"===m.baseline?-g:"top"===m.baseline?0:-g/2),(new Fe).set(v,b,v+u,b+g).rotate(d,v+u/2,b+g/2)}))})(t,i,e),r=Ot(o),l=Ft(o),c=Math.abs(l-r)*(h+s)/i.length,{step:u,delCount:g}=Cy(i,n,a,Math.floor(n.reduce(((t,e)=>Math.min(t,e.width(),e.height())),Number.MAX_VALUE)/c));d=t.stepTicks(u),d=d.slice(0,d.length-g)}else d=t.domain();return Dm(d)},Cy=(t,e,i,o)=>{let n=o;do{let o=!0;n++;let r=0;do{r+n<t.length&&Wm(e[r],e[r+n],i)&&(o=!1),r+=n}while(o&&r<t.length);if(o)break}while(n<=t.length);let r=0;if(t.length>2){let i=t.length-t.length%n;for(i>=t.length&&(i-=n);i>0&&Wm(e[0],e[i]);)r++,i-=n}return{step:n,delCount:r}},wy=(t,e)=>{if(Vm(t.type))return((t,e)=>{var i,o;if(!Vm(t.type))return Dm(t.domain());const n=t.range(),r=Math.abs(n[n.length-1]-n[0]);if(r<2)return Dm([t.domain()[0]]);const{tickCount:s,forceTickCount:a,tickStep:l,noDecimals:h=!1,labelStyle:d,breakData:c}=e;let u;if(ot(l))g=t.stepTicks(l),p=c&&c()?c().breakDomains:null,u=p&&p.length?g.filter((t=>p.every((e=>t<e[0]||t>e[1])))):g;else if(ot(a))u=uy(e,t,a,((e,i)=>i&&i.length?t.domain(i,!0).forceTicks(e):t.forceTicks(e)));else if("d3"===e.tickMode){const o=null!==(i=et(s)?s({axisLength:r,labelStyle:d}):s)&&void 0!==i?i:5;u=uy(e,t,o,((e,i)=>i&&i.length?t.domain(i,!0).d3Ticks(e,{noDecimals:h}):t.d3Ticks(e,{noDecimals:h})))}else{const i=null!==(o=et(s)?s({axisLength:r,labelStyle:d}):s)&&void 0!==o?o:5,n=et(e.tickMode)?e.tickMode:void 0;u=uy(e,t,i,((e,i)=>i&&i.length?t.domain(i,!0).ticks(e,{noDecimals:h,customTicks:n}):t.ticks(e,{noDecimals:h,customTicks:n})))}var g,p;const f=t.domain();if(e.labelFirstVisible&&f[0]!==u[0]&&!u.includes(f[0])&&u.unshift(f[0]),e.labelLastVisible&&f[f.length-1]!==u[u.length-1]&&!u.includes(f[f.length-1])&&u.push(f[f.length-1]),e.sampling&&u.length>1&&("cartesian"===e.coordinateType||"polar"===e.coordinateType&&"radius"===e.axisOrientType)){const{labelGap:i=4,labelFlush:o}=e,n=6;let s;if(u.length*n>r){const i=[],o=Math.floor(u.length*n/r);u.forEach(((t,e)=>{e%o!=0&&e!==u.length-1||i.push(t)})),s=Gm(t,i,e).map(((t,e)=>({AABBBounds:t,value:i[e]})))}else s=Gm(t,u,e).map(((t,e)=>({AABBBounds:t,value:u[e]})));const a=s[0],l=Ht(s),h=c&&c()?py.greedy:py.parity;for(;s.length>=3&&Am(s,i);)s=h(s,i);const d=e.labelFirstVisible;let g=e.labelLastVisible;Sm(a,l,i)&&s.includes(l)&&s.length>1&&d&&g&&(s.splice(s.indexOf(l),1),g=!1),gy(a,s,d,(t=>Sm(t,a,i))),gy(l,s,g,(t=>Sm(t,l,i)||!(!d||t===a)&&Sm(t,a,i)),!0);const p=s.map((t=>t.value));p.length<3&&o&&(p.length>1&&p.pop(),Ht(p)!==Ht(u)&&p.push(Ht(u))),u=p}return Dm(u)})(t,e);if(function(t){switch(t){case jm.Ordinal:case jm.Point:case jm.Band:return!0;default:return!1}}(t.type)){if("cartesian"===e.coordinateType)return((t,e)=>{var i;const o=t.domain();if(!o.length)return[];const{tickCount:n,forceTickCount:r,tickStep:s,labelGap:a=4,axisOrientType:l,labelStyle:h}=e,d=(t=>["bottom","top","z"].includes(t))(l),c=t.range(),u=t.calculateWholeRangeSize();if(u<2)return e.labelLastVisible?Dm([o[o.length-1]]):Dm([o[0]]);let g;if(ot(s))g=t.stepTicks(s);else if(ot(r))g=t.forceTicks(r);else if(ot(n)){const e=et(n)?n({axisLength:u,labelStyle:h}):n;g=t.ticks(e)}else if(e.sampling){const n=(null!==(i=e.labelStyle.fontSize)&&void 0!==i?i:12)+2,r=Ot(c),s=Ft(c);if(o.length<=u/n){const i=(s-r)/o.length,n=fy(t,o,e,d),l=Math.min(...n.map((t=>t[2]))),h=my(o,n,a,e.labelLastVisible,Math.floor(l/i),!1);g=t.stepTicks(h.step),e.labelLastVisible&&(h.delCount&&(g=g.slice(0,g.length-h.delCount)),g.push(o[o.length-1]))}else{const i=[o[0],o[Math.floor(o.length/2)],o[o.length-1]],n=fy(t,i,e,d);let l=null;n.forEach((t=>{l?l[2]<t[2]&&(l=t):l=t}));const h=s-r-a>0?Math.ceil(o.length*(a+l[2])/(s-r-a)):o.length-1;g=t.stepTicks(h),!e.labelLastVisible||g.length&&g[g.length-1]===o[o.length-1]||(g.length&&Math.abs(t.scale(g[g.length-1])-t.scale(o[o.length-1]))<l[2]&&(g=g.slice(0,-1)),g.push(o[o.length-1]))}}else g=t.domain();return Dm(g)})(t,e);if("polar"===e.coordinateType&&"angle"===e.axisOrientType)return yy(t,e)}return Dm(t.domain())};function xy(){pb(),Mb(),Pb()}const _y={space:8,style:{fill:"rgb(47, 69, 84)",cursor:"pointer",size:15},state:{disable:{fill:"rgb(170, 170, 170)",cursor:"not-allowed"},hover:{}}};xy();class Sy extends mg{getCurrent(){return this._current}constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Tt({},Sy.defaultAttributes,t)),this.name="pager",this._current=1,this._onHover=t=>{const e=t.target;e.hasState("disable")||e.addState("hover")},this._onUnHover=t=>{t.target.removeState("hover")},this._onClick=t=>{const e=t.target;if("preHandler"===e.name){if(1===this._current)return;this._current-=1,1===this._current?e.addState("disable"):e.removeState("disable"),this._dispatchEvent("toPrev",{current:this._current,total:this._total,direction:"pre",event:t})}if("nextHandler"===e.name){if(this._current===this._total)return;this._current+=1,this._current===this._total?e.addState("disable"):e.removeState("disable"),this._dispatchEvent("toNext",{current:this._current,total:this._total,direction:"next",event:t})}this._current>1&&this.preHandler.removeState("disable"),this._current<this._total&&this.nextHandler.removeState("disable"),this.text.setAttribute("text",this._getPageText(this._current))}}render(){var t,e,i;this._reset();const{layout:o="horizontal",handler:n=_y,total:r,defaultCurrent:s=1,textStyle:a,padding:l=0}=this.attribute;this._current=s;const h=Je(l),d="horizontal"===o,c=Rl.group({x:0,y:0}),u=n.style||{},g=u.size||15,p=null!==(t=n.space)&&void 0!==t?t:8,f=n.state||{};let{preShape:v,nextShape:b}=n;v||(v=d?"triangleLeft":"triangleUp"),b||(b=d?"triangleRight":"triangleDown");const m=Rl.symbol(Object.assign(Object.assign({strokeBoundsBuffer:0,pickMode:"imprecise"},u),{x:0,y:0,symbolType:v,size:g}));m.states=f,m.name="preHandler",this.preHandler=m,c.add(m);const{width:y,height:C}=Xb(this._getPageText(r),Object.assign({textAlign:"center",textBaseline:"middle"},a),null===(i=null===(e=this.stage)||void 0===e?void 0:e.getTheme())||void 0===i?void 0:i.text),w=ut(g)?g:g[0],x=ut(g)?g:g[1],_=Rl.text(Object.assign({x:d?w/2+p+y/2:0,y:d?0:x/2+p+C/2,text:this._getPageText(s),textAlign:"center",textBaseline:"middle",lineHeight:null==a?void 0:a.fontSize},a));this.text=_,c.add(_);const S=Rl.symbol(Object.assign(Object.assign({strokeBoundsBuffer:0,pickMode:"imprecise"},u),{x:d?w+2*p+y:0,y:d?0:x+2*p+C,symbolType:b,size:g}));S.name="nextHandler",S.states=f,this.nextHandler=S,c.add(S),1===this._total?(m.addState("disable"),S.addState("disable")):1===this._current?m.addState("disable"):this._current===r&&S.addState("disable");const A=c.AABBBounds,B=A.width(),R=A.height();c.translateTo(0-A.x1+h[3],0-A.y1+h[0]),this.add(c),this.attribute.width=B+h[1]+h[3],this.attribute.height=R+h[0]+h[2],this._bindEvents()}_bindEvents(){this.attribute.disableTriggerEvent||(this.preHandler&&(this.preHandler.addEventListener("pointerenter",this._onHover),this.preHandler.addEventListener("pointerleave",this._onUnHover),this.preHandler.addEventListener("pointerdown",this._onClick)),this.nextHandler&&(this.nextHandler.addEventListener("pointerenter",this._onHover),this.nextHandler.addEventListener("pointerleave",this._onUnHover),this.nextHandler.addEventListener("pointerdown",this._onClick)))}_reset(){this.removeAllChild(!0),this._current=1,this._total=this.attribute.total,this.preHandler=this.nextHandler=this.text=null}_getPageText(t){const{pageFormatter:e}=this.attribute;return e?et(e)?e(t,this._total):`${e}`.replace("{current}",`${t}`).replace("{total}",`${this._total}`):`${t}/${this._total}`}setTotal(t){t!==this.attribute.total&&(this._total=t,1!==this._current&&this._current<=t?this.setAttributes({total:t,defaultCurrent:this._current}):this.setAttribute("total",t))}}Sy.defaultAttributes={handler:_y,textStyle:{fill:"rgb(51, 51, 51)",fontSize:12}};const Ay=16,By=8,Ry=12;var Ty,ky,My;!function(t){t.selected="selected",t.unSelected="unSelected",t.selectedHover="selectedHover",t.unSelectedHover="unSelectedHover",t.focus="focus"}(Ty||(Ty={})),function(t){t.legendItemHover="legendItemHover",t.legendItemUnHover="legendItemUnHover",t.legendItemClick="legendItemClick",t.legendItemAttributeUpdate="legendItemAttributeUpdate"}(ky||(ky={})),function(t){t.innerView="innerView",t.title="legendTitle",t.item="legendItem",t.itemShape="legendItemShape",t.itemLabel="legendItemLabel",t.itemValue="legendItemValue",t.focus="legendItemFocus"}(My||(My={}));class Ly extends mg{constructor(){super(...arguments),this.name="legend",this._title=null}render(){this.removeAllChild(!0);const{interactive:t=!0,title:e,padding:i=0}=this.attribute;this._parsedPadding=Je(i);const o=Rl.group({x:this._parsedPadding[3],y:this._parsedPadding[0],pickable:t,childrenPickable:t});o.name=My.innerView,this.add(o),this._innerView=o,(null==e?void 0:e.visible)&&this._renderTitle(e),this._renderContent(),this._adjustLayout(),t&&this._bindEvents();const n=this._innerView.AABBBounds;this.attribute.width=n.width()+this._parsedPadding[1]+this._parsedPadding[3],this.attribute.height=n.height()+this._parsedPadding[0]+this._parsedPadding[2]}_renderTitle(t){const{text:e="",textStyle:i,padding:o=0,background:n,minWidth:r,maxWidth:s,shape:a}=t,l={x:0,y:0,text:e,textStyle:i,padding:Je(o),minWidth:r,maxWidth:s};a&&a.visible&&(l.shape=Object.assign({visible:!0},a.style),ot(a.space)&&(l.space=a.space)),n&&n.visible&&(l.panel=Object.assign({visible:!0},n.style));const h=new Qb(l);h.name=My.title,this._title=h,this._innerView.add(h)}_adjustLayout(){var t;if(this._title){const e=this._innerView.AABBBounds.width(),i=this._title.AABBBounds.width(),o=null===(t=this.attribute.title)||void 0===t?void 0:t.align;"center"===o?this._title.setAttribute("x",(e-i)/2):"end"===o&&this._title.setAttribute("x",e-i)}}}function Py(){pb(),Pb(),Sb(),Mb()}function Ey(){pb(),Zb()}var Hy=function(t,e){var i={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(i[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(t);n<o.length;n++)e.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(t,o[n])&&(i[o[n]]=t[o[n]])}return i};const Fy={[Ty.focus]:{},[Ty.selected]:{},[Ty.selectedHover]:{},[Ty.unSelected]:{},[Ty.unSelectedHover]:{}};Ey(),xy(),Fb();class Oy extends Ly{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Tt({},Oy.defaultAttributes,t)),this.name="discreteLegend",this._itemsContainer=null,this._itemHeightByUser=void 0,this._itemHeight=0,this._itemMaxWidth=0,this._contentMaxHeight=0,this._onHover=t=>{const e=t.target;if(e&&e.name&&e.name.startsWith(My.item)){const i=e.delegate;if(this._lastActiveItem){if(this._lastActiveItem.id===i.id)return;this._unHover(this._lastActiveItem,t)}this._hover(i,t)}else this._lastActiveItem&&(this._unHover(this._lastActiveItem,t),this._lastActiveItem=null)},this._onUnHover=t=>{this._lastActiveItem&&(this._unHover(this._lastActiveItem,t),this._lastActiveItem=null)},this._onClick=t=>{var e,i,o,n;const r=t.target;if(r&&r.name&&r.name.startsWith(My.item)){const s=r.delegate,{selectMode:a="multiple"}=this.attribute;if(r.name===My.focus||"focus"===a){const o=s.hasState(Ty.focus);s.toggleState(Ty.focus),o?null===(e=this._itemsContainer)||void 0===e||e.getChildren().forEach((e=>{this._removeLegendItemState(e,[Ty.unSelected,Ty.unSelectedHover,Ty.focus],t),this._setLegendItemState(e,Ty.selected,t)})):(this._setLegendItemState(s,Ty.selected,t),this._removeLegendItemState(s,[Ty.unSelected,Ty.unSelectedHover],t),null===(i=this._itemsContainer)||void 0===i||i.getChildren().forEach((e=>{s!==e&&(this._removeLegendItemState(e,[Ty.selected,Ty.selectedHover,Ty.focus],t),this._setLegendItemState(e,Ty.unSelected,t))})))}else{null===(o=this._itemsContainer)||void 0===o||o.getChildren().forEach((t=>{t.removeState(Ty.focus)}));const{allowAllCanceled:e=!0}=this.attribute,i=s.hasState(Ty.selected),r=this._getSelectedLegends();if("multiple"===a){if(!1===e&&i&&1===r.length)return void this._dispatchLegendEvent(ky.legendItemClick,s,t);i?(this._removeLegendItemState(s,[Ty.selected,Ty.selectedHover],t),this._setLegendItemState(s,Ty.unSelected,t)):(this._setLegendItemState(s,Ty.selected,t),this._removeLegendItemState(s,[Ty.unSelected,Ty.unSelectedHover],t))}else this._setLegendItemState(s,Ty.selected,t),this._removeLegendItemState(s,[Ty.unSelected,Ty.unSelectedHover],t),null===(n=this._itemsContainer)||void 0===n||n.getChildren().forEach((e=>{s!==e&&(this._removeLegendItemState(e,[Ty.selected,Ty.selectedHover],t),this._setLegendItemState(e,Ty.unSelected,t))}))}this._dispatchLegendEvent(ky.legendItemClick,s,t)}}}render(){super.render(),this._lastActiveItem=null}setSelected(t){var e;(null===(e=this._itemsContainer)||void 0===e?void 0:e.getChildren()).forEach((e=>{const i=e.data;t.includes(i.label)?(this._setLegendItemState(e,Ty.selected),this._removeLegendItemState(e,[Ty.unSelected,Ty.unSelectedHover])):(this._removeLegendItemState(e,[Ty.selected,Ty.selectedHover]),this._setLegendItemState(e,Ty.unSelected))}))}_renderItems(){const{item:t={},maxCol:e=1,maxRow:i=2,maxWidth:o,defaultSelected:n,lazyload:r,autoPage:s}=this.attribute,{spaceCol:a=Ay,spaceRow:l=By,verticalAlign:h="middle"}=t,d=this._itemsContainer,{items:c,isHorizontal:u,startIndex:g,isScrollbar:p}=this._itemContext,f=p?1:u?i:e,v=this._contentMaxHeight;let b,{doWrap:m,maxWidthInCol:y,startX:C,startY:w,pages:x}=this._itemContext,_=0,S=0;const A=[];for(let t=g,e=c.length;t<e&&!(r&&x>this._itemContext.currentPage*f);t++){r&&(this._itemContext.startIndex=t+1),b=c[t],b.id||(b.id=b.label),b.index=t;let e=!0;ht(n)&&(e=n.includes(b.label));const i=this._renderEachItem(b,e,t,c),g=i.attribute.width,f=i.attribute.height;this._itemHeight=Math.max(this._itemHeight,f),y=Math.max(g,y),this._itemMaxWidth=Math.max(g,this._itemMaxWidth),u?(ot(o)&&(p&&s?(x=Math.ceil((C+g)/o),m=x>1):C+g>o&&(m=!0,C>0&&("middle"!==h&&"bottom"!==h||A.forEach((t=>{t.setAttributes({y:t.attribute.y+(S-t.attribute.height)/("middle"===h?2:1)})})),x+=1,C=0,w+=S+l,S=0,A.length=0))),0===C&&0===w||i.setAttributes({x:C,y:w}),C+=a+g,S=Math.max(S,f),A.push(i)):(ot(v)&&(p&&s?(x=Math.ceil((w+f)/v),m=x>1):v<=f?(x+=1,m=!0,w=0,t>0&&(C+=_+a)):v<w+f&&(x+=1,m=!0,w=0,C+=y+a,y=0)),0===C&&0===w||i.setAttributes({x:C,y:w}),w+=l+f),d.add(i),_=g}return!u||"middle"!==h&&"bottom"!==h||A.forEach((t=>{t.setAttributes({y:t.attribute.y+(S-t.attribute.height)/("middle"===h?2:1)})})),this._itemContext.doWrap=m,this._itemContext.startX=C,this._itemContext.startY=w,this._itemContext.maxWidthInCol=y,this._itemContext.pages=x,this._itemContext.maxPages=f,p&&(this._itemContext.totalPage=x),r||(this._itemContext.startIndex=c.length),this._itemContext}_renderContent(){const{item:t={},items:e,reversed:i,maxWidth:o,maxHeight:n}=this.attribute;if(!1===t.visible||Ct(e))return;let r=e;i&&(r=null==e?void 0:e.reverse()),this._contentMaxHeight=Math.max(0,n-this._parsedPadding[0]-this._parsedPadding[2]);const s=Rl.group({x:0,y:0});this._itemsContainer=s;const{layout:a,autoPage:l}=this.attribute,h="horizontal"===a,{maxWidth:d,width:c,height:u}=t,g=[];ot(d)&&g.push(d),ot(c)&&g.push(c),g.length&&(ot(o)&&g.push(o),this._itemWidthByUser=Ot(g)),ot(u)&&(this._itemHeightByUser=u);const p=this.attribute.pager;this._itemContext={currentPage:p&&p.defaultCurrent||1,doWrap:!1,maxWidthInCol:0,maxPages:1,pages:1,startX:0,startY:0,startIndex:0,items:r,isHorizontal:h,totalPage:1/0,isScrollbar:p&&"scrollbar"===p.type,clipContainer:void 0},this._itemContext=this._renderItems();let f=!1;this._itemContext.doWrap&&l&&this._itemContext.pages>this._itemContext.maxPages&&(f=this._renderPagerComponent()),f||(s.setAttribute("y",this._title?this._title.AABBBounds.height()+wt(this.attribute,"title.space",8):0),this._innerView.add(s))}_bindEvents(){if(this.attribute.disableTriggerEvent)return;if(!this._itemsContainer)return;const{hover:t=!0,select:e=!0}=this.attribute;if(t){let e="pointermove",i="pointerleave";nt(t)&&(t.trigger&&(e=t.trigger),t.triggerOff&&(i=t.triggerOff)),this._itemsContainer.addEventListener(e,this._onHover),this._itemsContainer.addEventListener(i,this._onUnHover)}if(e){let t="pointerdown";nt(e)&&e.trigger&&(t=e.trigger),this._itemsContainer.addEventListener(t,this._onClick)}}_autoEllipsis(t,e,i,o){var n,r;const{label:s,value:a}=this.attribute.item,l=o.AABBBounds,h=i.AABBBounds,d=l.width(),c=h.width();let u=!1;"labelFirst"===t?c>e?u=!0:o.setAttribute("maxLineWidth",e-c):"valueFirst"===t?d>e?u=!0:i.setAttribute("maxLineWidth",e-d):d+c>e&&(u=!0),u&&(o.setAttribute("maxLineWidth",Math.max(e*(null!==(n=s.widthRatio)&&void 0!==n?n:.5),e-c)),i.setAttribute("maxLineWidth",Math.max(e*(null!==(r=a.widthRatio)&&void 0!==r?r:.5),e-d)))}_renderEachItem(t,e,i,o){var n,r;const{id:s,label:a,value:l,shape:h}=t,{padding:d=0,focus:c,focusIconStyle:u,align:g,autoEllipsisStrategy:p}=this.attribute.item,{shape:f,label:v,value:b,background:m}=this.attribute.item,y=this._handleStyle(f,t,e,i,o),C=this._handleStyle(v,t,e,i,o),w=this._handleStyle(b,t,e,i,o),x=this._handleStyle(m,t,e,i,o),_=Je(d);let S;!1===m.visible?(S=Rl.group({x:0,y:0,cursor:null===(n=x.style)||void 0===n?void 0:n.cursor}),this._appendDataToShape(S,My.item,t,S)):(S=Rl.group(Object.assign({x:0,y:0},x.style)),this._appendDataToShape(S,My.item,t,S,x.state)),S.id=`${null!=s?s:a}-${i}`,S.addState(e?Ty.selected:Ty.unSelected);const A=Rl.group({x:0,y:0,pickable:!1});S.add(A);let B,R=0,T=0,k=0;if(f&&!1!==f.visible){const i=wt(y,"style.size",10);T=ht(i)?i[0]||0:i,k=wt(f,"space",8);const o=Rl.symbol(Object.assign(Object.assign({x:0,y:0,symbolType:"circle",strokeBoundsBuffer:0},h),y.style));Object.keys(y.state||{}).forEach((t=>{const e=y.state[t].fill||y.state[t].stroke;h.fill&&it(y.state[t].fill)&&e&&(y.state[t].fill=e),h.stroke&&it(y.state[t].stroke)&&e&&(y.state[t].stroke=e)})),this._appendDataToShape(o,My.itemShape,t,S,y.state),o.addState(e?Ty.selected:Ty.unSelected),A.add(o)}let M=0;if(c){const e=wt(u,"size",10);B=Rl.symbol(Object.assign(Object.assign({x:0,y:-e/2-1,strokeBoundsBuffer:0,boundsPadding:_},u),{visible:!0,pickMode:"imprecise"})),this._appendDataToShape(B,My.focus,t,S),M=e}const L=v.formatMethod?v.formatMethod(a,t,i):a,P=qb(Object.assign(Object.assign({x:T/2+k,y:0,textAlign:"start",textBaseline:"middle",lineHeight:null===(r=C.style)||void 0===r?void 0:r.fontSize},C.style),{text:L,_originText:v.formatMethod?a:void 0}));this._appendDataToShape(P,My.itemLabel,t,S,C.state),P.addState(e?Ty.selected:Ty.unSelected),A.add(P);const E=wt(v,"space",8);if(ot(l)){const o=wt(b,"space",c?8:0),n=b.formatMethod?b.formatMethod(l,t,i):l,r=qb(Object.assign(Object.assign({x:0,y:0,textAlign:"start",textBaseline:"middle",lineHeight:w.style.fontSize},w.style),{text:n,_originText:b.formatMethod?l:void 0}));if(this._appendDataToShape(r,My.itemValue,t,S,w.state),r.addState(e?Ty.selected:Ty.unSelected),this._itemWidthByUser){const t=this._itemWidthByUser-_[1]-_[3]-T-k-E-M-o;this._autoEllipsis(p,t,P,r),b.alignRight?r.setAttributes({textAlign:"right",x:this._itemWidthByUser-T/2-_[1]-_[3]-M-o}):r.setAttribute("x",E+(P.AABBBounds.empty()?0:P.AABBBounds.x2))}else r.setAttribute("x",E+(P.AABBBounds.empty()?0:P.AABBBounds.x2));R=o+(r.AABBBounds.empty()?0:r.AABBBounds.x2),A.add(r)}else this._itemWidthByUser?(P.setAttribute("maxLineWidth",this._itemWidthByUser-_[1]-_[3]-T-k-M),R=E+(P.AABBBounds.empty()?0:P.AABBBounds.x2)):R=E+(P.AABBBounds.empty()?0:P.AABBBounds.x2);B&&(B.setAttribute("x",R),A.add(B));const H=A.AABBBounds,F=H.width();if("right"===g){const t=H.x2,e=H.x1;A.forEachChildren(((i,o)=>{"symbol"!==i.type&&"right"!==i.attribute.textAlign||i===B?i.setAttribute("x",e+t-i.attribute.x-i.AABBBounds.width()):"symbol"!==i.type?i.setAttributes({x:e+t-i.attribute.x,textAlign:"left"}):i.setAttribute("x",e+t-i.attribute.x)}))}const O=H.height(),I=ot(this.attribute.item.width)?this.attribute.item.width:F+_[1]+_[3],z=this._itemHeightByUser||O+_[0]+_[2];return S.attribute.width=I,S.attribute.height=z,B&&B.setAttribute("visible",!1),A.translateTo(-H.x1+_[3],-H.y1+_[0]),S}_createPager(t){var e,i;const{disableTriggerEvent:o,maxRow:n}=this.attribute,r=t=>t<=99?99:t<=999?999:9999;return this._itemContext.isHorizontal?new Sy(Object.assign(Object.assign({layout:1===n?"horizontal":"vertical",total:r(this._itemContext.pages)},Tt({handler:{preShape:"triangleUp",nextShape:"triangleDown"}},t)),{defaultCurrent:null===(e=this.attribute.pager)||void 0===e?void 0:e.defaultCurrent,disableTriggerEvent:o})):new Sy(Object.assign({layout:"horizontal",total:r(this._itemContext.pages),disableTriggerEvent:o,defaultCurrent:null===(i=this.attribute.pager)||void 0===i?void 0:i.defaultCurrent},t))}_createScrollbar(t,e){const{disableTriggerEvent:i}=this.attribute;return this._itemContext.isHorizontal?new Nb(Object.assign(Object.assign({direction:"horizontal",disableTriggerEvent:i,range:[0,.5],height:!1===t.visible?0:12},t),{width:e})):new Nb(Object.assign(Object.assign({direction:"vertical",width:!1===t.visible?0:12,range:[0,.5]},t),{height:e,disableTriggerEvent:i}))}_updatePositionOfPager(t,e,i){const{pager:o}=this.attribute,{totalPage:n,isHorizontal:r}=this._itemContext,s=o&&o.position||"middle";if(this._pagerComponent.setTotal(n),r){let o;o="start"===s?t:"end"===s?t+i-this._pagerComponent.AABBBounds.height()/2:t+i/2-this._pagerComponent.AABBBounds.height()/2,this._pagerComponent.setAttributes({x:e-this._pagerComponent.AABBBounds.width(),y:o})}else{let t;t="start"===s?0:"end"===s?e-this._pagerComponent.AABBBounds.width():(e-this._pagerComponent.AABBBounds.width())/2,this._pagerComponent.setAttributes({x:t,y:i-this._pagerComponent.AABBBounds.height()})}}_computeScrollbarDelta(){const{isHorizontal:t,clipContainer:e}=this._itemContext,i=this._itemsContainer.AABBBounds,o=e.AABBBounds;let n,r;return t?(r=o.width(),n=r/i.width()):(r=o.height(),n=r/i.height()),n}_updatePositionOfScrollbar(t,e,i){const{isHorizontal:o,currentPage:n,totalPage:r}=this._itemContext,s=(n-1)/r;this._pagerComponent.setScrollRange([s,s+this._computeScrollbarDelta()]),o?this._pagerComponent.setAttributes({x:0,y:i+e}):this._pagerComponent.setAttributes({x:t,y:i})}_bindEventsOfPager(t,e){const i=this.attribute.pager||{},{animation:o=!0,animationDuration:n=450,animationEasing:r="quadIn"}=i,s=this._itemContext.isScrollbar?t=>{const{value:e}=t.detail;let i;return i=0===e[0]?1:1===e[1]?this._itemContext.totalPage:e[0]*this._itemContext.totalPage+1,i}:t=>t.detail.current,a=t=>{const e=this._pagerComponent,i=e.getScrollRange(),{direction:o}=e.attribute,{width:n,height:r}=e.getSliderRenderBounds(),s="vertical"===o?t.deltaY/r:t.deltaX/n;e.setScrollRange([i[0]+s,i[1]+s],!0),this.updateScrollMask()},l=i=>{const a=s(i);if(a!==this._itemContext.currentPage){if(this._itemContext.currentPage=a,this._itemContext&&this._itemContext.startIndex<this._itemContext.items.length){this._renderItems();const t=Math.ceil(this._itemContext.pages/this._itemContext.maxPages);if(this._itemContext.totalPage=t,this._itemContext.isScrollbar&&this._pagerComponent){const t=this._computeScrollbarDelta(),[e]=this._pagerComponent.getScrollRange();this._pagerComponent.setScrollRange([e,e+t])}}if(this._itemContext.isScrollbar){const[t]=this._pagerComponent.getScrollRange();let i;i=this._itemContext.isHorizontal?this._itemsContainer.AABBBounds.width():this._itemsContainer.AABBBounds.height();const s=i*t;this.updateScrollMask(),o?this._itemsContainer.animate().to({[e]:-s},n,r):this._itemsContainer.setAttribute(e,-s)}else o?this._itemsContainer.animate().to({[e]:-(a-1)*t},n,r):this._itemsContainer.setAttribute(e,-(a-1)*t)}};if(this._itemContext.isScrollbar){if(this._pagerComponent.addEventListener("scrollDrag",l),this._pagerComponent.addEventListener("scrollUp",l),this.attribute.pager.roamScroll){const t=50;this.addEventListener("wheel",(t=>t.nativeEvent.preventDefault())),this.addEventListener("wheel",Zt(a,t))}}else this._pagerComponent.addEventListener("toPrev",l),this._pagerComponent.addEventListener("toNext",l)}_renderPager(){const t=this._title?this._title.AABBBounds.height()+wt(this.attribute,"title.space",8):0,{maxWidth:e,maxCol:i=1,maxRow:o=2,item:n={},pager:r={}}=this.attribute,{spaceCol:s=Ay,spaceRow:a=By}=n,l=this._itemsContainer,{space:h=Ry,defaultCurrent:d=1}=r,c=Hy(r,["space","defaultCurrent"]),{isHorizontal:u}=this._itemContext,g=this._contentMaxHeight;let p,f=0,v=0,b=0,m=0,y=0,C=0,w=1;if(u){if(v=(o-1)*a+this._itemHeight*o,f=e,p=this._createPager(c),this._pagerComponent=p,this._innerView.add(p),b=e-p.AABBBounds.width()-h,b<=0)return this._innerView.removeChild(p),!1;l.getChildren().forEach(((t,e)=>{const{width:i,height:o}=t.attribute;b<y+i&&(y=0,C+=o+a,w+=1),e>0&&t.setAttributes({x:y,y:C}),y+=s+i})),this._itemContext.startX=y,this._itemContext.startY=C,this._itemContext.pages=w;const i=Math.ceil(w/o);this._itemContext.totalPage=i,this._updatePositionOfPager(t,f,v)}else{if(f=this._itemMaxWidth*i+(i-1)*s,v=g,b=f,p=this._createPager(c),this._pagerComponent=p,this._innerView.add(p),m=g-p.AABBBounds.height()-h-t,m<=0)return this._innerView.removeChild(p),!1;l.getChildren().forEach(((t,e)=>{const{height:i}=t.attribute;m<C+i&&(C=0,y+=this._itemMaxWidth+s,w+=1),e>0&&t.setAttributes({x:y,y:C}),C+=a+i}));const e=Math.ceil(w/i);this._itemContext.totalPage=e,this._updatePositionOfPager(t,f,v)}d>1&&(u?l.setAttribute("y",-(d-1)*(v+a)):l.setAttribute("x",-(d-1)*(f+s)));const x=Rl.group({x:0,y:t,width:u?b:f,height:u?v:m,clip:!0,pickable:!1});return x.add(l),this._innerView.add(x),this._itemContext.clipContainer=x,this._bindEventsOfPager(u?v+a:f+s,u?"y":"x"),!0}_renderScrollbar(){var t;const e=this._title?this._title.AABBBounds.height()+wt(this.attribute,"title.space",8):0,{maxWidth:i,item:o={},pager:n={}}=this.attribute,{spaceCol:r=Ay,spaceRow:s=By}=o,a=this._itemsContainer,{space:l=Ry,defaultCurrent:h=1}=n,d=Hy(n,["space","defaultCurrent"]),{isHorizontal:c}=this._itemContext,u=this._contentMaxHeight;let g,p=0,f=0,v=0,b=1;if(c)p=i,f=this._itemHeight,g=this._createScrollbar(d,p),this._pagerComponent=g,this._innerView.add(g);else{if(f=u-e,p=this._itemMaxWidth,g=this._createScrollbar(d,f),this._pagerComponent=g,this._innerView.add(g),f<=0)return this._innerView.removeChild(g),!1;const t=a.getChildren(),i=t.map((t=>t.attribute.height));if(1===i.length||i.every((t=>t===i[0]))){const e=i[0],o=f,n=Math.floor(o/(s+e));f=n*(s+e),b=Math.ceil(t.length/n)}else t.forEach(((t,e)=>{const{height:i}=t.attribute,o=b,n=v;b=Math.floor((v+i)/f)+1,v+=s+i,o!==b&&e===a.getChildren().length-1&&v-f>=1/3*i&&(f=n+i,b-=1)}));this._itemContext.totalPage=b,this._itemContext.pages=b}if(h>1)if(c){const t=this._itemsContainer.AABBBounds.width()-p;a.setAttribute("x",-Math.min((h-1)*(p+r),t))}else{const t=this._itemsContainer.AABBBounds.height()-f;a.setAttribute("y",-Math.min((h-1)*(f+s),t))}const m=Rl.group({x:0,y:e,width:p,height:f,clip:!0,pickable:!1});return m.add(a),this._innerView.add(m),this._itemContext.clipContainer=m,this._updatePositionOfScrollbar(p,f,e),(null===(t=n.scrollMask)||void 0===t?void 0:t.visible)&&this.renderScrollMask(m),this._bindEventsOfPager(c?p:f,c?"x":"y"),!0}renderScrollMask(t){const{scrollMask:e={}}=this.attribute.pager,{visible:i=!0,gradientLength:o=16,gradientStops:n}=e;if(!i||!n)return;const r=t.AABBBounds.width(),s=t.AABBBounds.height(),a=this._itemContext.isHorizontal?r:s,l=n.map((t=>({offset:o*t.offset/a,color:t.color}))),h=n.map((t=>({offset:(a-o*t.offset)/a,color:t.color}))),d=Rl.rect({x:0,y:0,width:r,height:s});this._scrollMask=d,this._scrollMaskContext={startStops:l,endStops:h},this.updateScrollMask(),t.add(d)}updateScrollMask(){if(!this._scrollMask||!this._pagerComponent)return;if(!this._itemContext.isScrollbar)return;const[t,e]=this._pagerComponent.getScrollRange(),i=[];Ut(Xt(e,0,1),1)||i.push(...this._scrollMaskContext.endStops),Ut(Xt(t,0,1),0)||i.push(...this._scrollMaskContext.startStops),i.length&&(this._itemContext.isHorizontal?this._scrollMask.setAttributes({fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:i}}):this._scrollMask.setAttributes({fill:{gradient:"linear",x0:0,y0:0,x1:0,y1:1,stops:i}}))}_renderPagerComponent(){return this._itemContext.isScrollbar?this._renderScrollbar():this._renderPager(),!0}_hover(t,e){this._lastActiveItem=t,t.hasState(Ty.selected)?this._setLegendItemState(t,Ty.selectedHover,e):this._setLegendItemState(t,Ty.unSelectedHover,e);const i=t.getChildren()[0].find((t=>t.name===My.focus),!1);i&&i.setAttribute("visible",!0),this._dispatchLegendEvent(ky.legendItemHover,t,e)}_unHover(t,e){let i=!1;(t.hasState(Ty.unSelectedHover)||t.hasState(Ty.selectedHover))&&(i=!0),t.removeState(Ty.unSelectedHover),t.removeState(Ty.selectedHover),t.getChildren()[0].getChildren().forEach((t=>{i||!t.hasState(Ty.unSelectedHover)&&!t.hasState(Ty.selectedHover)||(i=!0),t.removeState(Ty.unSelectedHover),t.removeState(Ty.selectedHover)}));const o=t.getChildren()[0].find((t=>t.name===My.focus),!1);o&&o.setAttribute("visible",!1),i&&this._dispatchLegendEvent(ky.legendItemAttributeUpdate,t,e),this._dispatchLegendEvent(ky.legendItemUnHover,t,e)}_setLegendItemState(t,e,i){let o=!1;t.hasState(e)||(o=!0),t.addState(e,!0),t.getChildren()[0].getChildren().forEach((t=>{t.name!==My.focus&&(o||t.hasState(e)||(o=!0),t.addState(e,!0))})),o&&this._dispatchLegendEvent(ky.legendItemAttributeUpdate,t,i)}_removeLegendItemState(t,e,i){let o=!1;e.forEach((e=>{!o&&t.hasState(e)&&(o=!0),t.removeState(e)})),t.getChildren()[0].getChildren().forEach((t=>{t.name!==My.focus&&e.forEach((e=>{!o&&t.hasState(e)&&(o=!0),t.removeState(e)}))})),o&&this._dispatchLegendEvent(ky.legendItemAttributeUpdate,t,i)}_getSelectedLegends(){var t;const e=[];return null===(t=this._itemsContainer)||void 0===t||t.getChildren().forEach((t=>{t.hasState(Ty.selected)&&e.push(t.data)})),e}_appendDataToShape(t,e,i,o){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};t.name=e,t.data=i,t.delegate=o,t.states=Tt({},Fy,n)}_dispatchLegendEvent(t,e,i){const o=this._getSelectedLegends();o.sort(((t,e)=>t.index-e.index));const n=o.map((t=>t.label));this._dispatchEvent(t,{item:e,data:e.data,selected:e.hasState(Ty.selected),currentSelectedItems:o,currentSelected:n,event:i})}_handleStyle(t,e,i,o,n){const r={};return t.style&&(et(t.style)?r.style=t.style(e,i,o,n):r.style=t.style),t.state&&(r.state={},Object.keys(t.state).forEach((s=>{t.state[s]&&(et(t.state[s])?r.state[s]=t.state[s](e,i,o,n):r.state[s]=t.state[s])}))),r}release(){super.release(),this.removeAllEventListeners()}}var Iy;function zy(t){return ht(t)?t:[t,t]}function Dy(t){return t?"ew-resize":"ns-resize"}Oy.defaultAttributes={layout:"horizontal",title:{align:"start",space:12,textStyle:{fontSize:12,fontWeight:"bold",fill:"#2C3542"}},item:{spaceCol:Ay,spaceRow:By,shape:{space:8,style:{size:10,cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{opacity:.5}}},label:{space:8,style:{fontSize:12,fill:"#2C3542",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8"}}},value:{alignRight:!1,style:{fontSize:12,fill:"#ccc",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8"}}},background:{style:{cursor:"pointer"}},focus:!1,focusIconStyle:{size:10,symbolType:"M8 1C11.866 1 15 4.13401 15 8C15 11.866 11.866 15 8 15C4.13401 15 1 11.866 1 8C1 4.13401 4.13401 1 8 1ZM8.75044 2.55077L8.75 3.75H7.25L7.25006 2.5507C4.81247 2.88304 2.88304 4.81247 2.5507 7.25006L3.75 7.25V8.75L2.55077 8.75044C2.8833 11.1878 4.81264 13.117 7.25006 13.4493L7.25 12.25H8.75L8.75044 13.4492C11.1876 13.1167 13.1167 11.1876 13.4492 8.75044L12.25 8.75V7.25L13.4493 7.25006C13.117 4.81264 11.1878 2.8833 8.75044 2.55077ZM8 5.5C9.38071 5.5 10.5 6.61929 10.5 8C10.5 9.38071 9.38071 10.5 8 10.5C6.61929 10.5 5.5 9.38071 5.5 8C5.5 6.61929 6.61929 5.5 8 5.5ZM8 7C7.44772 7 7 7.44772 7 8C7 8.55228 7.44772 9 8 9C8.55228 9 9 8.55228 9 8C9 7.44772 8.55228 7 8 7Z",fill:"#333",cursor:"pointer"}},autoPage:!0,pager:{space:Ry,handler:{style:{size:10},space:4}},hover:!0,select:!0,selectMode:"multiple",allowAllCanceled:!0},function(t){t.innerView="innerView",t.railContainer="sliderRailContainer",t.rail="sliderRail",t.startText="sliderStartText",t.endText="sliderEndText",t.startHandler="sliderStartHandler",t.startHandlerText="startHandlerText",t.endHandler="sliderEndHandler",t.endHandlerText="sliderEndHandlerText",t.track="sliderTrack",t.trackContainer="sliderTrackContainer"}(Iy||(Iy={})),Py();class Wy extends mg{get track(){return this._track}get currentValue(){return this._currentValue}get startHandler(){return this._startHandler}get endHandler(){return this._endHandler}get tooltipShape(){return this._tooltipShape}constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Tt({},Wy.defaultAttributes,t)),this.name="slider",this._isHorizontal=!0,this._startHandler=null,this._endHandler=null,this._startHandlerText=null,this._endHandlerText=null,this._currentHandler=null,this._currentValue={},this._onTooltipShow=t=>{this._isChanging||this._tooltipState&&this._tooltipState.isActive||(this._tooltipState?this._tooltipState.isActive=!0:this._tooltipState={isActive:!0},this._onTooltipUpdate(t),this._dispatchTooltipEvent("sliderTooltipShow"))},this._onTooltipUpdate=t=>{if(this._isChanging||!this._tooltipState||!this._tooltipState.isActive)return;const e=this._isHorizontal?this._rail.globalAABBBounds.width():this._rail.globalAABBBounds.height(),i=Xt(this._isHorizontal?(t.viewX-this._rail.globalAABBBounds.x1)/e:(t.viewY-this._rail.globalAABBBounds.y1)/e,0,1);i!==this._tooltipState.pos&&(this._tooltipState.pos=i,this._tooltipState.value=this.calculateValueByPos(i*e),this._updateTooltip(),this._dispatchTooltipEvent("sliderTooltipUpdate"))},this._onTooltipHide=()=>{const{tooltip:t}=this.attribute;t&&t.alwaysShow||(this._tooltipState=null,this._tooltipShape&&this._tooltipShape.setAttribute("visible",!1),this._tooltipText&&this._tooltipText.setAttribute("visible",!1),this._dispatchTooltipEvent("sliderTooltipHide"))},this._onHandlerPointerdown=t=>{t.stopPropagation(),this._isChanging=!0;const{x:e,y:i}=this.stage.eventPointTransform(t);this._currentHandler=t.target,this._prePos=this._isHorizontal?e:i,"browser"===fu.env?(fu.addEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),fu.addEventListener("pointerup",this._onHandlerPointerUp)):(this.stage.addEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),this.stage.addEventListener("pointerup",this._onHandlerPointerUp),this.stage.addEventListener("pointerupoutside",this._onHandlerPointerUp))},this._onHandlerPointerMove=t=>{var e,i;t.stopPropagation(),this._isChanging=!0;const{railWidth:o,railHeight:n,min:r,max:s}=this.attribute;if(s===r)return;const{x:a,y:l}=this.stage.eventPointTransform(t);let h,d,c,u=0;this._isHorizontal?(h=a,u=h-this._prePos,d=null===(i=this._currentHandler)||void 0===i?void 0:i.attribute.x,c=o):(h=l,u=h-this._prePos,d=null===(e=this._currentHandler)||void 0===e?void 0:e.attribute.y,c=n);const g=Xt(d+u,0,c),p=this.calculateValueByPos(g);"text"===this._currentHandler.type?this._updateHandlerText(this._currentHandler,g,p):this._updateHandler(this._currentHandler,g,p),this._updateTrack(),this._prePos=h,this._dispatchChangeEvent()},this._onHandlerPointerUp=t=>{t.preventDefault(),this._isChanging=!1,this._currentHandler=null,"browser"===fu.env?(fu.removeEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),fu.removeEventListener("pointerup",this._onHandlerPointerUp)):(this.stage.removeEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),this.stage.removeEventListener("pointerup",this._onHandlerPointerUp),this.stage.removeEventListener("pointerupoutside",this._onHandlerPointerUp))},this._onTrackPointerdown=t=>{t.stopPropagation(),this._isChanging=!0;const{x:e,y:i}=this.stage.eventPointTransform(t);this._prePos=this._isHorizontal?e:i,"browser"===fu.env?(fu.addEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),fu.addEventListener("pointerup",this._onTrackPointerUp)):(this.stage.addEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),this.stage.addEventListener("pointerup",this._onTrackPointerUp),this.stage.addEventListener("pointerupoutside",this._onTrackPointerUp))},this._onTrackPointerMove=t=>{t.stopPropagation(),this._isChanging=!0;const{railWidth:e,railHeight:i,min:o,max:n,inverse:r}=this.attribute;if(n===o)return;const{startHandler:s,endHandler:a}=this._getHandlers();let l,h,d;const{x:c,y:u}=this.stage.eventPointTransform(t);this._isHorizontal?(l=c,h=this._track.attribute.width,d=e):(l=u,h=this._track.attribute.height,d=i);const g=l-this._prePos;if(s){const t=this._isHorizontal?s.attribute.x:s.attribute.y,e=r?Xt(t+g,h,d):Xt(t+g,0,d-h),i=this.calculateValueByPos(e);this._updateHandler(s,e,i)}if(a){const t=this._isHorizontal?a.attribute.x:a.attribute.y,e=r?Xt(t+g,0,d-h):Xt(t+g,h,d),i=this.calculateValueByPos(e),o=null==s?void 0:s.attribute;this._updateHandler(a,e,i),this._track.setAttributes(this._isHorizontal?{x:Math.min(o.x,a.attribute.x),width:Math.abs(o.x-a.attribute.x)}:{y:Math.min(o.y,a.attribute.y),height:Math.abs(o.y-a.attribute.y)})}this._prePos=l,this._dispatchChangeEvent()},this._onTrackPointerUp=t=>{t.preventDefault(),this._isChanging=!1,"browser"===fu.env?(fu.removeEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),fu.removeEventListener("pointerup",this._onTrackPointerUp)):(this.stage.removeEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),this.stage.removeEventListener("pointerup",this._onTrackPointerUp),this.stage.removeEventListener("pointerupoutside",this._onTrackPointerUp))},this._onRailPointerDown=t=>{t.stopPropagation(),this._isChanging=!0;const{railWidth:e,railHeight:i,min:o,max:n}=this.attribute;if(n===o)return;const r=this._startHandler,s=this._endHandler;let a,l,h;this._isHorizontal?(a=t.viewX-this._rail.globalAABBBounds.x1,l=null==r?void 0:r.attribute.x,h=null==s?void 0:s.attribute.x):(a=t.viewY-this._rail.globalAABBBounds.y1,l=null==r?void 0:r.attribute.y,h=null==s?void 0:s.attribute.y);const d=this.calculateValueByPos(a);if(ot(h)){const t=Math.abs(a-l)>Math.abs(a-h)?s:r;this._updateHandler(t,a,d)}else this._updateHandler(r,a,d);this._updateTrack(),this._dispatchChangeEvent()}}calculatePosByValue(t,e){const{layout:i,railWidth:o,railHeight:n,min:r,max:s,inverse:a}=this.attribute;let l=0;return l=r===s?"start"===e?0:"end"===e?1:0:(t-r)/(s-r),(a?1-l:l)*("vertical"===i?n:o)}calculateValueByPos(t){const{layout:e,railWidth:i,railHeight:o,min:n,max:r,inverse:s}=this.attribute,a="vertical"===e?o:i;return n+(r-n)*(s?1-t/a:t/a)}setValue(t){const{min:e,max:i}=this.attribute;if(i===e)return;const[o,n]=Et(t),{startHandler:r,endHandler:s}=this._getHandlers();r&&this._updateHandler(r,this.calculatePosByValue(o),o),s&&this._updateHandler(s,this.calculatePosByValue(n),n),this._updateTrack()}render(){var t,e;this.removeAllChild(!0);const{layout:i="horizontal",railWidth:o,railHeight:n,startText:r,endText:s,min:a,max:l,showHandler:h=!0,showTooltip:d}=this.attribute;let{value:c}=this.attribute;it(c)&&(c=[a,l]),this._currentValue={startValue:zy(c)[0],endValue:zy(c)[1]};const u="horizontal"===i;this._isHorizontal=u;const g=Rl.group({x:0,y:0});g.name=Iy.innerView,this.add(g),this._innerView=g;let p,f=0;if(r&&r.visible){p=Rl.text(Object.assign({x:u?0:o/2,y:u?n/2:0,textAlign:u?"start":"center",textBaseline:u?"middle":"top",text:r.text,lineHeight:null===(t=r.style)||void 0===t?void 0:t.fontSize},r.style)),p.name=Iy.startText,g.add(p);const e=ot(r.space)?r.space:0;f+=(u?p.AABBBounds.width():p.AABBBounds.height())+e}const v=Rl.group({x:u?f:0,y:u?0:f});g.add(v);const b=Rl.group({x:0,y:0});let m;if(b.name=Iy.railContainer,this._railContainer=b,v.add(b),this._mainContainer=v,this._renderRail(b),f+=u?o:n,s&&s.visible){const t=ot(s.space)?s.space:0;m=Rl.text(Object.assign({x:u?f+t:o/2,y:u?n/2:f+t,textAlign:u?"start":"center",textBaseline:u?"middle":"top",text:s.text,lineHeight:null===(e=s.style)||void 0===e?void 0:e.fontSize},s.style)),m.name=Iy.endText,g.add(m)}this._renderTrack(b),h&&(this._renderHandlers(v),this._bindEvents()),d&&(this._renderTooltip(),this._bindTooltipEvents())}_renderRail(t){const{railWidth:e,railHeight:i,railStyle:o,slidable:n}=this.attribute;let r="default";!1!==n&&(r="pointer");const s=Rl.rect(Object.assign({x:0,y:0,width:e,height:i,cursor:r},o));return s.name=Iy.rail,t.add(s),this._rail=s,s}_renderHandlers(t){const{range:e,min:i,max:o,handlerSize:n=14,handlerStyle:r,handlerText:s,railHeight:a,railWidth:l,slidable:h}=this.attribute;let{value:d}=this.attribute;it(d)&&(d=[i,o]);const c=s&&s.visible,u=this._isHorizontal,[g,p]=zy(d),f=this.calculatePosByValue(g,e?"start":"end"),v=this._renderHandler(Object.assign({x:u?f:l/2,y:u?a/2:f,size:n,strokeBoundsBuffer:0,cursor:!1===h?"default":Dy(u)},r));if(v.name=Iy.startHandler,this._startHandler=v,t.add(v),this._currentValue.startPos=f,c){const i=this._renderHandlerText(g,e?"start":"end");i.name=Iy.startHandlerText,t.add(i),this._startHandlerText=i}if(e){const e=this.calculatePosByValue(p,"end"),i=this._renderHandler(Object.assign({x:u?e:l/2,y:u?a/2:e,size:n,strokeBoundsBuffer:0,cursor:!1===h?"default":Dy(u)},r));if(i.name=Iy.endHandler,this._endHandler=i,t.add(i),this._currentValue.endPos=e,c){const e=this._renderHandlerText(p,"end");e.name=Iy.endHandlerText,t.add(e),this._endHandlerText=e}}}_renderTrack(t){const{range:e,min:i,max:o,railHeight:n,railWidth:r,trackStyle:s,railStyle:a,slidable:l,value:h}=this.attribute;let d,c;if(it(h))e?(d=i,c=o):d=c=i;else if(e){const t=Yt(h,i,o);d=t[0],c=t[1]}else d=i,c=Xt(h,i,o);const u=this._isHorizontal;e||(d=i);const g=Rl.group({x:0,y:0,width:r,height:n,cornerRadius:null==a?void 0:a.cornerRadius,clip:!0,pickable:!1});g.name=Iy.trackContainer;const p=nt(e)&&!0===e.draggableTrack;let f;f=!1===l?"default":!1===e||!1===p?"pointer":Dy(u);const v=this.calculatePosByValue(d,"start"),b=this.calculatePosByValue(c,e?"end":"start"),m=Rl.rect(Object.assign({x:u?Math.min(v,b):0,y:u?0:Math.min(v,b),width:u?Math.abs(b-v):r,height:u?n:Math.abs(b-v),cursor:f},s));m.name=Iy.track,this._track=m,g.add(m),t.add(g)}_renderHandler(t){return Rl.symbol(t)}_renderHandlerText(t,e){var i,o,n;const{align:r,handlerSize:s=14,handlerText:a={},railHeight:l,railWidth:h,slidable:d}=this.attribute,c=this._isHorizontal,u=this.calculatePosByValue(t,e),g=null!==(i=a.space)&&void 0!==i?i:4,p={text:a.formatter?a.formatter(t):t.toFixed(null!==(o=a.precision)&&void 0!==o?o:0),lineHeight:null===(n=a.style)||void 0===n?void 0:n.lineHeight,cursor:!1===d?"default":Dy(c)};return c?"top"===r?(p.textBaseline="bottom",p.textAlign="center",p.x=u,p.y=(l-s)/2-g):(p.textBaseline="top",p.textAlign="center",p.x=u,p.y=(l+s)/2+g):"left"===r?(p.textBaseline="middle",p.textAlign="end",p.x=(h-s)/2-g,p.y=u):(p.textBaseline="middle",p.textAlign="start",p.x=(h+s)/2+g,p.y=u),Rl.text(Object.assign(Object.assign({},p),a.style))}_renderTooltip(){var t;const{tooltip:e,railHeight:i,railWidth:o,align:n}=this.attribute;e&&e.alwaysShow?this._tooltipState={value:this._currentValue.startValue,pos:this._currentValue.startPos}:this._tooltipState=null;const r=this._isHorizontal?0:o/2,s=this._isHorizontal?i/2:0;if(e&&e.shape){const t=Rl.symbol(Object.assign({pickable:!1,visible:!!this._tooltipState,x:r,y:s,symbolType:"circle"},e.shapeStyle));this._tooltipShape=t,this._mainContainer.add(t)}const a=e&&e.text||{},l=null!==(t=a.space)&&void 0!==t?t:6,h={pickable:!1,visible:!!this._tooltipState,text:""};this._isHorizontal?(h.x=r,h.y="top"===n?s-i/2-l:s+i/2+l,h.textAlign="center",h.textBaseline="top"===n?"bottom":"top"):(h.y=s,h.x="left"===n?r-o/2-l:s+o/2+l,h.textAlign="left"===n?"end":"start",h.textBaseline="middle");const d=Rl.text(Object.assign(Object.assign({},h),a.style));this._mainContainer.add(d),this._tooltipText=d,this._tooltipState&&this._updateTooltip()}_updateTooltip(){var t,e;if(!this._tooltipShape&&!this._tooltipText||!this._tooltipState)return;const{railWidth:i,railHeight:o}=this.attribute,n=this._isHorizontal?i:o,r=this._tooltipState.pos*n,s=this._isHorizontal?"x":"y";this._tooltipShape&&this._tooltipShape.setAttributes({visible:!0,[s]:r});const{align:a}=this.attribute;if(this._tooltipText){const i=this.attribute.tooltip&&this.attribute.tooltip.text||{};this._tooltipText.setAttributes({visible:!0,[s]:r,text:i.formatter?i.formatter(this._tooltipState.value):this._isHorizontal||"left"!==a?`≈ ${this._tooltipState.value.toFixed(null!==(e=i.precision)&&void 0!==e?e:0)}`:`${this._tooltipState.value.toFixed(null!==(t=i.precision)&&void 0!==t?t:0)} ≈`})}}_bindEvents(){if(this.attribute.disableTriggerEvent)return;const{slidable:t,range:e}=this.attribute;t&&(this._startHandler&&this._startHandler.addEventListener("pointerdown",this._onHandlerPointerdown),this._startHandlerText&&this._startHandlerText.addEventListener("pointerdown",this._onHandlerPointerdown),this._endHandler&&this._endHandler.addEventListener("pointerdown",this._onHandlerPointerdown),this._endHandlerText&&this._endHandlerText.addEventListener("pointerdown",this._onHandlerPointerdown),nt(e)&&e.draggableTrack&&this._track.addEventListener("pointerdown",this._onTrackPointerdown),this._railContainer.addEventListener("pointerdown",this._onRailPointerDown))}_bindTooltipEvents(){this.attribute.disableTriggerEvent||(this._mainContainer.addEventListener("pointerenter",this._onTooltipShow),this._mainContainer.addEventListener("pointermove",this._onTooltipUpdate),this._mainContainer.addEventListener("pointerleave",this._onTooltipHide))}_updateTrack(){const{inverse:t,railWidth:e,railHeight:i}=this.attribute,o=this._startHandler,n=this._endHandler;if(this._isHorizontal){const i=null==o?void 0:o.attribute.x;if(n){const t=null==n?void 0:n.attribute.x;this._track.setAttributes({x:Math.min(i,t),width:Math.abs(i-t)})}else t?this._track.setAttributes({x:i,width:e-i}):this._track.setAttributes({width:i})}else{const e=null==o?void 0:o.attribute.y;if(n){const t=null==n?void 0:n.attribute.y;this._track.setAttributes({y:Math.min(e,t),height:Math.abs(e-t)})}else t?this._track.setAttributes({y:e,height:i-e}):this._track.setAttributes({height:e})}}_updateHandler(t,e,i){var o;const n=this._isHorizontal;t.setAttribute(n?"x":"y",e);const r=t.name===Iy.startHandler?this._startHandlerText:this._endHandlerText;if(r){const{handlerText:t={}}=this.attribute;r.setAttributes({text:t.formatter?t.formatter(i):i.toFixed(null!==(o=t.precision)&&void 0!==o?o:0),[n?"x":"y"]:e})}t.name===Iy.startHandler?(this._currentValue.startValue=i,this._currentValue.startPos=e):(this._currentValue.endValue=i,this._currentValue.endPos=e)}_updateHandlerText(t,e,i){var o;const n=this._isHorizontal,{handlerText:r={}}=this.attribute;t.setAttributes({[n?"x":"y"]:e,text:r.formatter?r.formatter(i):i.toFixed(null!==(o=r.precision)&&void 0!==o?o:0)});const s=t.name===Iy.startHandlerText?this._startHandler:this._endHandler;s&&s.setAttributes({[n?"x":"y"]:e}),t.name===Iy.startHandlerText?(this._currentValue.startValue=i,this._currentValue.startPos=e):(this._currentValue.endValue=i,this._currentValue.endPos=e)}_dispatchChangeEvent(){const t=!!this.attribute.range,e=this._currentValue;this._dispatchEvent("change",{value:t?[Math.min(e.endValue,e.startValue),Math.max(e.endValue,e.startValue)]:e.startValue,position:t?[Math.min(e.endPos,e.startPos),Math.max(e.endPos,e.startPos)]:e.startPos})}_dispatchTooltipEvent(t){this._dispatchEvent("sliderTooltip",{type:t,position:this._tooltipState&&this._tooltipState.pos,value:this._tooltipState&&this._tooltipState.value})}_getHandlers(){const{inverse:t}=this.attribute;let e=this._startHandler,i=this._endHandler;return i?(this._isHorizontal?(!t&&i.attribute.x<(null==e?void 0:e.attribute.x)||t&&i.attribute.x>(null==e?void 0:e.attribute.x))&&([e,i]=[i,e]):(!t&&i.attribute.y<(null==e?void 0:e.attribute.y)||t&&i.attribute.y>(null==e?void 0:e.attribute.y))&&([e,i]=[i,e]),{startHandler:e,endHandler:i}):{startHandler:e,endHandler:i}}}Wy.defaultAttributes={slidable:!0,layout:"horizontal",align:"bottom",height:8,showHandler:!0,handlerSize:14,handlerStyle:{symbolType:"circle",fill:"#fff",stroke:"#91caff",lineWidth:2},tooltip:{shapeStyle:{symbolType:"circle",fill:"#fff",stroke:"#91caff",lineWidth:2},text:{style:{fill:"#2C3542",fontSize:12}}},railStyle:{fill:"rgba(0,0,0,.04)"},trackStyle:{fill:"#91caff"},showValue:!0,valueStyle:{fill:"#2C3542",fontSize:12},startText:{style:{fill:"#2C3542",fontSize:12}},endText:{style:{fill:"#2C3542",fontSize:12}},handlerText:{visible:!0,space:4,precision:0,style:{fill:"#2C3542",fontSize:12}}},Ey(),Py();class Ny extends Ly{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Tt({},Ny.defaultAttributes,t)),this.name="colorLegend",this._onSliderToolipChange=t=>{const e=this._slider.tooltipShape;if(e&&t.detail&&!it(t.detail.value)){const i=this._colorScale.scale(t.detail.value);e.setAttribute("fill",i)}this.dispatchEvent(t)},this._onSliderChange=t=>{this._updateColor(),this.dispatchEvent(t)}}setSelected(t){this._slider&&(this._slider.setValue(t),this._updateColor())}_renderContent(){const{colors:t,slidable:e,layout:i,align:o,min:n,max:r,value:s,railWidth:a,railHeight:l,showHandler:h=!0,handlerSize:d,handlerStyle:c,railStyle:u,trackStyle:g,startText:p,endText:f,handlerText:v,showTooltip:b,tooltip:m,inverse:y,disableTriggerEvent:C}=this.attribute,w=[],x=(r-n)/(t.length-1);for(let e=0;e<t.length;e++)w.push(n+x*e);this._colorScale=(new cy).domain(w,!0).range(t),this._color=this._getTrackColor();const _=new Wy({x:0,y:0,range:{draggableTrack:!0},slidable:e,layout:i,align:o,min:n,max:r,value:s,railWidth:a,railHeight:l,showHandler:h,handlerSize:d,handlerStyle:c,railStyle:u,trackStyle:Object.assign({fill:this._color},g),startText:p,endText:f,handlerText:v,showTooltip:b,tooltip:m,disableTriggerEvent:C,inverse:y});this._innerView.add(_),this._slider=_,_.translateTo(0-_.AABBBounds.x1,(this._title?this._title.AABBBounds.height()+wt(this.attribute,"title.space",12):0)-_.AABBBounds.y1),this._updateColor()}_bindEvents(){this.attribute.disableTriggerEvent||this._slider&&(this._slider.addEventListener("change",this._onSliderChange),this._slider.addEventListener("sliderTooltip",this._onSliderToolipChange))}_getTrackColor(){const{colors:t,layout:e,inverse:i}=this.attribute;if(Ct(t))return;const o=t.length;if(1===o)return t[0];const n=[];for(let e=0;e<o;e++){const i=e/(o-1);n.push({offset:i,color:t[e]})}const r="horizontal"===e,s={gradient:"linear",stops:n,x0:0,y0:0,x1:r?1:0,y1:r?0:1};return i&&(r?(s.x0=1,s.x1=0):(s.y0=1,s.y1=0)),s}_updateColor(){var t;const{layout:e="horizontal",colors:i,railWidth:o,railHeight:n}=this.attribute,{startHandler:r,endHandler:s,track:a,attribute:l}=this._slider,{startValue:h,endValue:d,startPos:c,endPos:u}=this._slider.currentValue,g=null===(t=l.handlerStyle)||void 0===t?void 0:t.fill;if(r&&!g){const t=this._colorScale.scale(h);r.setAttribute("fill",t)}if(s&&!g){const t=this._colorScale.scale(d);s.setAttribute("fill",t)}const p="horizontal"===e?o:n;if(Math.abs(c-u)!==p&&i&&i.length>1){const t=this._color.stops,e=Math.min(c,u),i=Math.max(c,u),o=e/p,n=i/p,r=n-o,s=t.filter((t=>t.offset>o&&t.offset<n)),l=Math.min(h,d),g=Math.max(h,d),f=this._colorScale.scale(l),v=this._colorScale.scale(g),b=[{offset:0,color:f}];s.forEach((t=>{b.push({offset:(t.offset-o)/r,color:t.color})})),b.push({offset:1,color:v}),a.setAttribute("fill",Object.assign(Object.assign({},this._color),{stops:b}))}}}function Gy(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"bottom",e=0;return"top"===t?`\n    M${e},-6L${e-3.5},-2.5\n    v5\n    h7\n    v-5\n    Z\n`:"left"===t?(e=1,`\n    M${e-6},0L${e-6+2.5},-3.5\n    h5\n    v7\n    h-5\n    Z\n`):"right"===t?(e=-1,`\n    M${e+6},0L${e+6-2.5},-3.5\n    h-5\n    v7\n    h5\n    Z\n  `):`\n    M${e},6L${e-3.5},2.5\n    v-5\n    h7\n    v5\n    Z\n`}Ny.defaultAttributes={layout:"horizontal",title:{align:"start",space:12,textStyle:{fontSize:12,fontWeight:"bold",fill:"rgba(46, 47, 50, 1)"}},handlerSize:10,handlerStyle:{fill:null,lineWidth:4,stroke:"#fff",outerBorder:{distance:2,lineWidth:1,stroke:"#ccc"}},tooltip:{shapeStyle:{lineWidth:4,stroke:"#fff"}}},Ey(),Py(),Cb();class jy extends Ly{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Tt({},jy.defaultAttributes,t)),this.name="sizeLegend",this._onSliderChange=t=>{this.dispatchEvent(t)},this._onSliderToolipChange=t=>{this.dispatchEvent(t)}}setSelected(t){this._slider&&this._slider.setValue(t)}_renderContent(){const{slidable:t,layout:e,align:i,min:o,max:n,value:r,railWidth:s,railHeight:a,showHandler:l=!0,handlerSize:h,handlerStyle:d,railStyle:c,trackStyle:u,startText:g,endText:p,handlerText:f,showTooltip:v,tooltip:b,sizeBackground:m,disableTriggerEvent:y,inverse:C}=this.attribute,w=Rl.group({x:0,y:0});this._innerView.add(w);const x=new Wy({x:0,y:0,zIndex:1,range:{draggableTrack:!0},slidable:t,layout:e,align:i,min:o,max:n,value:r,railWidth:s,railHeight:a,showHandler:l,handlerSize:h,handlerStyle:Object.assign({symbolType:Gy(i)},d),railStyle:c,trackStyle:u,startText:g,endText:p,handlerText:f,showTooltip:v,tooltip:b,disableTriggerEvent:y,inverse:C});w.add(x);let _,S=0;"horizontal"===e?"top"===i?(_=`M0,0L${s},0L${C?0:s},12Z`,S=a):(_=`M0,12L${s},12L${C?0:s},0Z`,x.setAttribute("y",12)):"left"===i?_=`M${s},0L${s+12},${C?0:a}L${s},${a}Z`:(_=`M0,${C?0:a}L12,${a}L12,0Z`,x.setAttribute("x",12));const A=Rl.path(Object.assign(Object.assign({x:0,y:S,path:_},m),{zIndex:0}));w.add(A);const B=this._title?this._title.AABBBounds.height()+wt(this.attribute,"title.space",12):0;w.translate(0-w.AABBBounds.x1,B-w.AABBBounds.y1),this._slider=x}_bindEvents(){this.attribute.disableTriggerEvent||this._slider&&(this._slider.addEventListener("change",this._onSliderChange),this._slider.addEventListener("sliderTooltip",this._onSliderToolipChange))}}jy.defaultAttributes={layout:"horizontal",title:{align:"start",space:12,textStyle:{fontSize:12,fontWeight:"bold",fill:"rgba(46, 47, 50, 1)"}},handlerSize:10,handlerStyle:{lineWidth:1,stroke:"#ccc",fill:"#fff"},sizeBackground:{fill:"rgba(20,20,20,0.1)"}},pb(),Pb(),Bb();let Vy=class t extends mg{constructor(e,i){super((null==i?void 0:i.skipDefault)?e:Tt({},t.defaultAttributes,e)),this.name="title"}render(){var t,e,i,o,n,r,s,a,l,h,d,c,u,g,p,f,v,b,m;const{textType:y,text:C,subtextType:w,textStyle:x={},subtext:_,subtextStyle:S={},width:A,height:B,minWidth:R,maxWidth:T,minHeight:k,maxHeight:M,align:L,verticalAlign:P,padding:E=0}=this.attribute,H=Je(E),F=this.createOrUpdateChild("title-container",{x:H[3],y:H[0],zIndex:1},"group"),O=null!==(t=x.height)&&void 0!==t?t:B;if(!1!==this.attribute.visible&&!1!==x.visible){const{width:t,maxHeight:a,maxWidth:l,x:h=0,y:d=0,ellipsis:c=!0,wordBreak:u="break-word",maxWidth:g,lineClamp:p}=x;if("rich"===y||ot(x.character)){const o=Object.assign({x:h,y:d,width:null!==(e=null!=t?t:A)&&void 0!==e?e:0,height:null!=O?O:0,ellipsis:null==c||c,wordBreak:null!=u?u:"break-word",maxHeight:null!=a?a:M,maxWidth:null!=l?l:g,textConfig:null!==(i=x.character)&&void 0!==i?i:C},x);this._mainTitle=F.createOrUpdateChild("mainTitle",o,"richtext")}else if("html"===y){const e=Object.assign({html:Object.assign(Object.assign({dom:C},Db),x),x:h,y:d,width:null!==(o=null!=t?t:A)&&void 0!==o?o:0,height:null!=O?O:0,ellipsis:c,wordBreak:u,maxHeight:null!=a?a:M,maxWidth:null!=l?l:g,textConfig:[]},x);this._mainTitle=F.createOrUpdateChild("mainTitle",e,"richtext")}else ot(C)&&(this._mainTitle=F.createOrUpdateChild("mainTitle",Object.assign(Object.assign({text:ht(C)?C:[C],whiteSpace:"normal"},x),{maxLineWidth:null!==(r=null!==(n=x.maxLineWidth)&&void 0!==n?n:t)&&void 0!==r?r:A,heightLimit:null!==(s=x.height)&&void 0!==s?s:M,lineClamp:p,ellipsis:c,x:h,y:d}),"text"))}const I=this._mainTitle?this._mainTitle.AABBBounds.height():0,z=this._mainTitle?this._mainTitle.AABBBounds.width():0;if(!1!==this.attribute.visible&&!1!==S.visible){const{width:t,height:e,maxWidth:i,maxHeight:o,x:n=0,y:r=0,ellipsis:s=!0,wordBreak:p="break-word",lineClamp:f}=S,v=Math.max(Number.MIN_VALUE,M-I);if("rich"===w||ot(S.character)){const d=Object.assign({x:n,y:r,width:null!==(a=null!=t?t:A)&&void 0!==a?a:0,height:null!==(l=null!=e?e:B)&&void 0!==l?l:0,ellipsis:s,wordBreak:p,maxHeight:null!=o?o:v,maxWidth:null!=i?i:T,textConfig:null!==(h=S.character)&&void 0!==h?h:_},S);this._subTitle=F.createOrUpdateChild("subTitle",d,"richtext")}else if("html"===w){const a=Object.assign({html:Object.assign(Object.assign({dom:_},Db),S),x:n,y:r,width:null!==(d=null!=t?t:A)&&void 0!==d?d:0,height:null!==(c=null!=e?e:B)&&void 0!==c?c:0,ellipsis:s,wordBreak:p,maxHeight:null!=o?o:v,maxWidth:null!=i?i:T,textConfig:[]},S);this._subTitle=F.createOrUpdateChild("subTitle",a,"richtext")}else ot(_)&&(this._subTitle=F.createOrUpdateChild("subTitle",Object.assign(Object.assign({text:ht(_)?_:[_],whiteSpace:"normal"},S),{maxLineWidth:null!==(u=S.maxLineWidth)&&void 0!==u?u:A,heightLimit:null!==(g=S.heightLimit)&&void 0!==g?g:v,lineClamp:f,ellipsis:s,x:0,y:I}),"text"))}const D=this._subTitle?this._subTitle.AABBBounds.height():0,W=this._subTitle?this._subTitle.AABBBounds.width():0;let N=Math.max(z,W),G=I+(null!==(p=S.height)&&void 0!==p?p:D);if(ot(A)&&(N=A),ot(B)&&(G=B),ot(R)&&N<R&&(N=R),ot(T)&&N>T&&(N=T),ot(k)&&G<k&&(G=k),ot(M)&&G>M&&(G=M),F.attribute.width=N,F.attribute.height=G,F.attribute.boundsPadding=H,this._mainTitle){if(ot(L)||ot(x.align)){const t=x.align?x.align:L,e=null!==(f=x.width)&&void 0!==f?f:N;"center"===t?(this._mainTitle.setAttribute("x",e/2),this._mainTitle.setAttribute("textAlign","center")):"right"===t?(this._mainTitle.setAttribute("x",e),this._mainTitle.setAttribute("textAlign","right")):(this._mainTitle.setAttribute("x",0),this._mainTitle.setAttribute("textAlign","left"))}if(ot(P)||ot(x.verticalAlign)){const t=x.verticalAlign?x.verticalAlign:P;"middle"===t&&ot(O)?(this._mainTitle.setAttribute("y",O/2),this._mainTitle.setAttribute("textBaseline","middle")):"bottom"===t&&ot(O)?(this._mainTitle.setAttribute("y",O),this._mainTitle.setAttribute("textBaseline","bottom")):(this._mainTitle.setAttribute("y",0),this._mainTitle.setAttribute("textBaseline","top"))}}if(this._subTitle){if(ot(L)||ot(S.align)){const t=S.align?S.align:L,e=null!==(b=null!==(v=S.width)&&void 0!==v?v:x.width)&&void 0!==b?b:N;"center"===t?(this._subTitle.setAttribute("x",e/2),this._subTitle.setAttribute("textAlign","center")):"right"===t?(this._subTitle.setAttribute("x",e),this._subTitle.setAttribute("textAlign","right")):(this._subTitle.setAttribute("x",0),this._subTitle.setAttribute("textAlign","left"))}if(ot(P)||ot(x.verticalAlign)){const t=S.verticalAlign?S.verticalAlign:P,e=this._mainTitle?ot(O)?this._mainTitle.AABBBounds.y1+Math.max(this._mainTitle.AABBBounds.height(),O):this._mainTitle.AABBBounds.y2:0,i=null!==(m=S.height)&&void 0!==m?m:B;"middle"===t&&ot(i)?(this._subTitle.setAttribute("y",e+i/2),this._subTitle.setAttribute("textBaseline","middle")):"bottom"===t&&ot(i)?(this._subTitle.setAttribute("y",e+i),this._subTitle.setAttribute("textBaseline","bottom")):(this._subTitle.setAttribute("y",e),this._subTitle.setAttribute("textBaseline","top"))}}}};Vy.defaultAttributes={textStyle:{ellipsis:"...",fill:"#333",fontSize:20,fontWeight:"bold",textAlign:"left",textBaseline:"top"},subtextStyle:{ellipsis:"...",fill:"#6F6F6F",fontSize:16,fontWeight:"normal",textAlign:"left",textBaseline:"top"}};pb(),Sb(),Pb(),vb();class Uy extends mg{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Tt({},Uy.defaultAttributes,t)),this._handlePointerUp=()=>{this.attribute.disabled||(this.attribute.checked?(this.setAttribute("checked",!1),this.setAttribute("indeterminate",!1)):(this.setAttribute("checked",!0),this.setAttribute("indeterminate",!1)),this._dispatchEvent("checkbox_state_change",{eventType:"checkbox_state_change",checked:this.attribute.checked}),this.stage.renderNextFrame())},this.renderGroup(),this.onBeforeAttributeUpdate=(t,e,i)=>{"interactive"in t&&this.setAttribute("pickable",t.interactive),"disabled"in t&&this.setAttribute("cursor",t.disable?this.attribute.disableCursor:this.attribute.cursor)},this.addEventListener("pointerup",this._handlePointerUp)}render(){this.removeAllChild(!0),this.renderBox(),this.renderIcon(),this.renderText(),this.layout()}renderBox(){this._box=new ic(Tt({},this.attribute.box));const t=this.attribute.checked||this.attribute.indeterminate;t&&this.attribute.disabled?this._box.setAttributes({fill:this.attribute.box.disableCheckedFill,stroke:this.attribute.box.disableCheckedStroke}):t?this._box.setAttributes({fill:this.attribute.box.checkedFill,stroke:this.attribute.box.checkedStroke}):this.attribute.disabled&&this._box.setAttributes({fill:this.attribute.box.disableFill}),this.appendChild(this._box)}renderIcon(){this._checkIcon=new ac(Tt({image:this.attribute.icon.checkIconImage},this.attribute.icon)),this.appendChild(this._checkIcon),this._indeterminateIcon=new ac(Tt({image:this.attribute.icon.indeterminateIconImage},this.attribute.icon)),this.appendChild(this._indeterminateIcon),this.attribute.checked?(this._checkIcon.setAttribute("visible",!0),this._indeterminateIcon.setAttribute("visible",!1)):this.attribute.indeterminate?(this._checkIcon.setAttribute("visible",!1),this._indeterminateIcon.setAttribute("visible",!0)):(this._checkIcon.setAttribute("visible",!1),this._indeterminateIcon.setAttribute("visible",!1))}renderText(){this._text=new zh(Tt({wrap:!0},this.attribute.text)),this.attribute.disabled&&this._text.setAttribute("fill",this.attribute.text.disableFill),this.appendChild(this._text)}renderGroup(){this.attribute.interactive||this.setAttribute("pickable",!1),this.attribute.disabled&&this.setAttribute("cursor",this.attribute.disableCursor)}layout(){const t=this.attribute.box.height,e=this.attribute.icon.height,i=this._text.AABBBounds.height(),o=Math.max(t,e,i),n=o/2-t/2,r=o/2-e/2,s=o/2-i/2,a=this.attribute.box.width,l=this.attribute.icon.width,h=Math.max(a,l),d=h/2-a/2,c=h/2-l/2,u=h+this.attribute.spaceBetweenTextAndIcon;this._box.setAttributes({x:d,y:n}),this._checkIcon.setAttributes({x:c,y:r}),this._indeterminateIcon.setAttributes({x:c,y:r}),this._text.setAttributes({x:u,y:s})}initAttributes(t,e){t=(null==e?void 0:e.skipDefault)?t:Tt({},Uy.defaultAttributes,t),super.initAttributes(t),this.renderGroup(),this.render()}}Uy.defaultAttributes={interactive:!0,disabled:!1,checked:!1,indeterminate:!1,cursor:"pointer",disableCursor:"not-allowed",spaceBetweenTextAndIcon:8,text:{text:"text",fontSize:14,fill:"#000",disableFill:"rgb(201,205,212)",textBaseline:"top",pickable:!1},icon:{checkIconImage:'<svg width="200" height="200" viewBox="0 0 1024 1024" fill="#fff" xmlns="http://www.w3.org/2000/svg"><path d="M877.44815445 206.10060629a64.72691371 64.72691371 0 0 0-95.14856334 4.01306852L380.73381888 685.46812814 235.22771741 533.48933518a64.72691371 64.72691371 0 0 0-92.43003222-1.03563036l-45.82665557 45.82665443a64.72691371 64.72691371 0 0 0-0.90617629 90.61767965l239.61903446 250.10479331a64.72691371 64.72691371 0 0 0 71.19960405 15.14609778 64.33855261 64.33855261 0 0 0 35.08198741-21.23042702l36.24707186-42.71976334 40.5190474-40.77795556-3.36579926-3.49525333 411.40426297-486.74638962a64.72691371 64.72691371 0 0 0-3.88361443-87.64024149l-45.3088404-45.43829334z"></path></svg>',indeterminateIconImage:'<svg width="200" height="200" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none"><path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="5" d="M5 12h14"/></svg>',width:10,height:10,pickable:!1},box:{width:14,height:14,cornerRadius:2,fill:"#fff",stroke:"rgb(229,230,235)",disableFill:"rgb(242,243,245)",checkedFill:"rgb(22, 93, 255)",checkedStroke:"rgb(22, 93, 255)",disableCheckedFill:"rgb(148, 191, 255)",disableCheckedStroke:"rgb(148, 191, 255)",pickable:!1}},pb(),Sb(),Hb(),vb();class $y extends mg{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Tt({},$y.defaultAttributes,t)),this._handlePointerUp=()=>{this.attribute.disabled||this.attribute.checked||(this.setAttribute("checked",!0),this._dispatchEvent("radio_checked",{eventType:"radio_checked",target:this}),this.stage.renderNextFrame())},this.renderGroup(),this.onBeforeAttributeUpdate=(t,e,i)=>{"interactive"in t&&this.setAttribute("pickable",t.interactive),"disabled"in t&&this.setAttribute("cursor",t.disable?this.attribute.disableCursor:this.attribute.cursor)},this.addEventListener("pointerup",this._handlePointerUp)}render(){this.removeAllChild(!0),this.renderCircle(),this.renderText(),this.layout()}renderCircle(){this._circle=new wc(Tt({},this.attribute.circle));const t=this.attribute.checked;t&&this.attribute.disabled?this._circle.setAttributes({fill:this.attribute.circle.disableCheckedFill,stroke:this.attribute.circle.disableCheckedStroke}):t?this._circle.setAttributes({fill:this.attribute.circle.checkedFill,stroke:this.attribute.circle.checkedStroke}):this.attribute.disabled&&this._circle.setAttributes({fill:this.attribute.circle.disableFill}),this.appendChild(this._circle)}renderText(){this._text=new zh(Tt({},this.attribute.text)),this.attribute.disabled&&this._text.setAttribute("fill",this.attribute.text.disableFill),this.appendChild(this._text)}renderGroup(){this.attribute.interactive||this.setAttribute("pickable",!1),this.attribute.disabled&&this.setAttribute("cursor",this.attribute.disableCursor)}layout(){const t=2*(this.attribute.circle.outerRadius+this.attribute.circle.lineWidth),e=this._text.AABBBounds.height(),i=Math.max(t,e),o=i/2-t/2+this.attribute.circle.outerRadius+this.attribute.circle.lineWidth,n=i/2-e/2,r=2*(this.attribute.circle.outerRadius+this.attribute.circle.lineWidth),s=this.attribute.circle.outerRadius+this.attribute.circle.lineWidth,a=r+this.attribute.spaceBetweenTextAndIcon;this._circle.setAttributes({x:s,y:o}),this._text.setAttributes({x:a,y:n})}initAttributes(t,e){t=(null==e?void 0:e.skipDefault)?t:Tt({},$y.defaultAttributes,t),super.initAttributes(t),this.renderGroup(),this.render()}}$y.defaultAttributes={interactive:!0,disabled:!1,checked:!1,cursor:"pointer",disableCursor:"not-allowed",spaceBetweenTextAndIcon:8,text:{text:"text",fontSize:14,fill:"#000",disableFill:"rgb(201,205,212)",textBaseline:"top",pickable:!1},circle:{outerRadius:7,innerRadius:3,startAngle:0,endAngle:2*Math.PI,lineWidth:1,fill:"#fff",stroke:"rgb(229,230,235)",disableFill:"rgb(242,243,245)",checkedFill:"rgb(22, 93, 255)",checkedStroke:"rgb(22, 93, 255)",disableCheckedFill:"rgb(148, 191, 255)",disableCheckedStroke:"rgb(148, 191, 255)",pickable:!1}};pb(),Pb(),vb();let Xy=class t extends mg{constructor(e,i){super((null==i?void 0:i.skipDefault)?e:Tt({},t.defaultAttributes,e))}render(){this.removeAllChild(!0),this.renderIcon(),this.renderText(),this.layout()}renderIcon(){this._emptyTipIcon=new ac(Tt({image:this.attribute.icon.image},this.attribute.icon)),this.appendChild(this._emptyTipIcon)}renderText(){this._text=new zh(Tt({wrap:!0},this.attribute.text)),this.appendChild(this._text)}layout(){const t=this.attribute.icon.height,e=this._text.AABBBounds.height(),i=this.attribute.icon.width,{width:o,height:n,spaceBetweenTextAndIcon:r}=this.attribute;this._emptyTipIcon.setAttribute("x",o/2-i/2),this._emptyTipIcon.setAttribute("y",n/2-t/2-e/2-r/2),this._text.setAttribute("x",o/2),this._text.setAttribute("textAlign","center"),this._text.setAttribute("y",n/2+t/2+r/2),this._text.setAttribute("textBaseline","middle")}};Xy.defaultAttributes={spaceBetweenTextAndIcon:20,text:{text:"no data",fontSize:14,fill:"#000",disableFill:"rgb(201,205,212)",pickable:!1},icon:{image:'<svg t="1716726614852" class="icon" viewBox="0 0 1194 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2621" width="200" height="200"><path d="M1038.694079 367.237067c13.265507 23.342857-16.633865-40.004445-63.05621-40.004446H219.018794c-26.558738 0-46.46393 13.334815-63.05621 40.004446S0.006238 607.277601 0.006238 650.608819V940.647979a82.351494 82.351494 0 0 0 82.961402 83.349526H1111.702885a82.337632 82.337632 0 0 0 82.975264-83.349526V650.608819c0-43.331218-155.970208-283.371753-155.970208-283.371752zM730.066575 667.284269a136.328386 136.328386 0 0 1-132.738243 133.33429 133.417459 133.417459 0 0 1-132.738243-133.33429v-6.681269a40.6698 40.6698 0 0 0-36.497473-26.66963H73.015044l119.458874-220.02445s23.231965-40.004445 53.103614-40.004446h713.481918c26.544876 0 29.871649 10.008042 46.436207 40.004446L1128.33675 633.947231H769.904682c-26.184476 0-39.838107 7.623855-39.838107 33.337038zM338.505391 210.559919l-89.601086-86.69016a22.178487 22.178487 0 0 1 0-33.26773 21.984425 21.984425 0 0 1 33.170699 0l89.601087 86.676299a22.317102 22.317102 0 0 1 0 33.26773 24.950798 24.950798 0 0 1-33.1707 0z m252.197118-40.059891a25.532983 25.532983 0 0 1-6.639685-16.633865l-3.326773-126.694606A28.263709 28.263709 0 0 1 603.995739 0.515788c13.251646-3.326773 23.204242 10.021904 26.544877 23.342858V153.866163a28.249847 28.249847 0 0 1-23.259688 26.66963c-6.611961-3.312911-13.279369-3.312911-16.578419-10.035765z m235.646421 33.337038a22.372548 22.372548 0 0 1 0-33.337038l86.288175-90.030795a22.039871 22.039871 0 0 1 33.170699 0 22.289379 22.289379 0 0 1 0 33.364761l-82.961401 90.003072a25.962691 25.962691 0 0 1-36.483611 0z" fill="#8a8a8a" p-id="2622"></path></svg>',width:100,height:100,pickable:!1}},pb(),Sb(),Pb(),ub();class Yy extends mg{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Tt({},Yy.defaultAttributes,t)),this._handlePointerUp=()=>{this.attribute.disabled||(this.attribute.checked?this.setAttribute("checked",!1):this.setAttribute("checked",!0),this._dispatchEvent("switch_state_change",{eventType:"switch_state_change",checked:this.attribute.checked}),this.stage.renderNextFrame())},this.renderGroup(),this.onBeforeAttributeUpdate=(t,e,i)=>{"interactive"in t&&this.setAttribute("pickable",t.interactive),"disabled"in t&&this.setAttribute("cursor",t.disable?this.attribute.disableCursor:this.attribute.cursor)},this.addEventListener("pointerup",this._handlePointerUp)}render(){this.removeAllChild(!0),this.renderBox(),this.renderCircle(),this.renderText(),this.layout()}renderBox(){this._box=new ic(Tt({},this.attribute.box)),this.attribute.disabled&&this.attribute.checked?this._box.setAttributes({fill:this.attribute.box.disableCheckedFill}):this.attribute.disabled&&!this.attribute.checked?this._box.setAttributes({fill:this.attribute.box.disableUncheckedFill}):this.attribute.checked?this._box.setAttributes({fill:this.attribute.box.checkedFill}):this._box.setAttributes({fill:this.attribute.box.uncheckedFill}),this.appendChild(this._box)}renderCircle(){this._circle=new Hh(Tt({},this.attribute.circle)),this.appendChild(this._circle)}renderText(){var t,e,i;this._text=new zh(Tt({},null!==(t=this.attribute.text)&&void 0!==t?t:{})),this.attribute.checked&&(null===(e=this.attribute.text)||void 0===e?void 0:e.checkedText)?this._text.setAttributes({text:this.attribute.text.checkedText}):(null===(i=this.attribute.text)||void 0===i?void 0:i.uncheckedText)&&this._text.setAttributes({text:this.attribute.text.uncheckedText}),this.appendChild(this._text)}renderGroup(){this.attribute.interactive||this.setAttribute("pickable",!1),this.attribute.disabled&&this.setAttribute("cursor",this.attribute.disableCursor)}layout(){var t,e,i,o,n,r,s,a,l,h;const d=this.attribute.spaceBetweenTextAndCircle,c=this.attribute.circle.radius,u=this.attribute.box.height,g=2*c,p=this._text.AABBBounds.height(),f=Math.max(u,g,p),v=f/2-g/2+c,b=f/2-p/2,m=this.attribute.box.width,y=2*c,C=Xb((null!==(i=null===(e=null===(t=this.attribute.text)||void 0===t?void 0:t.checkedText)||void 0===e?void 0:e.length)&&void 0!==i?i:0)>(null!==(r=null===(n=null===(o=this.attribute.text)||void 0===o?void 0:o.uncheckedText)||void 0===n?void 0:n.length)&&void 0!==r?r:0)?null!==(a=null===(s=this.attribute.text)||void 0===s?void 0:s.checkedText)&&void 0!==a?a:"":null!==(h=null===(l=this.attribute.text)||void 0===l?void 0:l.uncheckedText)&&void 0!==h?h:"",this._text.attribute).width,w=Math.max(m,y+C+3*d),x=u/2-y/2+c,_=x+c+d;this._box.setAttributes({width:w,height:f}),this._circle.setAttributes({y:v,x:this.attribute.checked?x:w-x}),this._text.setAttributes({x:this.attribute.checked?_:w-_-C,y:b})}initAttributes(t,e){t=(null==e?void 0:e.skipDefault)?t:Tt({},Yy.defaultAttributes,t),super.initAttributes(t),this.renderGroup(),this.render()}}Yy.defaultAttributes={interactive:!0,disabled:!1,checked:!1,cursor:"pointer",disableCursor:"not-allowed",circle:{radius:8,fill:"#FFF",pickable:!1},box:{width:40,height:24,cornerRadius:12,uncheckedFill:"rgb(201,205,212)",checkedFill:"#165DFF",disableUncheckedFill:"rgb(242,243,245)",disableCheckedFill:"rgb(148,191,255)",pickable:!1},text:{textAlign:"left",textBaseline:"top",pickable:!1},spaceBetweenTextAndCircle:6};let Ky=!1;function qy(){Ky||(Ky=!0,pu(),Tu()?wp(sn):function(){Ru();const t=zo.global&&zo.global.env;return t?"node"===t:!Bu}()&&Df(sn),db(),ub(),pb(),vb(),mb(),Sb(),Bb(),Tb(),Mb(),Pb(),vg(),sn.load(cm),vg())}function Zy(t,e){let i=null;return function(...o){i||(t.apply(this,o),i=setTimeout((()=>{i=null}),e))}}function Jy(t,e){const i=t.getFullYear().toString(),o=(t.getMonth()+1).toString().padStart(2,"0"),n=t.getDate().toString().padStart(2,"0");if((e=(e=(e=e.replace("yyyy",i)).replace("mm",o)).replace("dd",n)).length>10){const i=t.getHours().toString().padStart(2,"0"),o=t.getMinutes().toString().padStart(2,"0"),n=t.getSeconds().toString().padStart(2,"0");e=(e=(e=e.replace("hh",i)).replace("mm",o)).replace("ss",n)}return e}function Qy(t,e){const i=e.indexOf("yyyy"),o=e.indexOf("mm"),n=e.indexOf("dd"),r=o<i?o<n?0:1:o<n?1:2,s=n<i?n<o?0:1:n<o?1:2,a=parseInt(t[i<o?i<n?0:1:o<n?1:2],10),l=parseInt(t[r],10)-1,h=parseInt(t[s],10);if(isNaN(a)||a<1)return!1;if(isNaN(l)||l<0||l>11)return!1;const d=[31,eC(a)?29:28,31,30,31,30,31,31,30,31,30,31];return!(isNaN(h)||h<1||h>d[l])}function tC(t,e){if(e.includes("hh")||e.includes("mm")||e.includes("ss")){const i=e.indexOf("hh")>-1?e.indexOf("hh"):e.indexOf("HH"),o=parseInt(t[i],10),n=parseInt(t[i+1],10),r=t.length>i+2?parseInt(t[i+2],10):0;if(isNaN(o)||o<0||o>23)return!1;if(isNaN(n)||n<0||n>59)return!1;if(isNaN(r)||r<0||r>59)return!1}return!0}function eC(t){return t%4==0&&t%100!=0||t%400==0}function iC(t){const e=["yyyy-mm-dd","dd-mm-yyyy","mm/dd/yyyy","yyyy/mm/dd","dd/mm/yyyy","yyyy.mm.dd","mm.dd.yyyy","dd.mm.yyyy"],i=["hh:mm:ss","hh:mm"],o=(t=t.trim()).split(" "),n=o[0],r=o[1];let s,a;if(n)for(let t=0;t<e.length;t++){const i=e[t],o=n.split(oC(i)),r=Qy(o,i);if(3===o.length&&r){s=i;break}}if(s&&r)for(let t=0;t<i.length;t++){const e=i[t],o=r.split(oC(e)),n=e.split(oC(e));if(tC(o,e)&&o.length===n.length){a=e;break}}return n&&r&&s&&a?s+" "+a:n&&!r?s:"yyyy-mm-dd hh:mm:ss"}function oC(t){const e=t.match(/[^\w]/g);if(e){const t=e.map((t=>"\\"+t)).join("|");return new RegExp(t,"g")}return/[^\w]/}function nC(t,e){const i=t.replace(/\{([^}]+)\}/g,((t,i)=>{const o=i.split(".");let n=e;for(const e of o){if(!n.hasOwnProperty(e)){n=t;break}n=n[e]}return n}));return i}function rC(t){return Array.isArray(t)?3===t.length?[t[0],t[1],t[2],t[1]]:2===t.length?[t[0],t[1],t[0],t[1]]:1===t.length?[t[0],t[0],t[0],t[0]]:[t[0],t[1],t[2],t[3]]:[t,t,t,t]}function sC(t){const e=new Date(t.getFullYear(),0,1);return Math.ceil(((t.getTime()+1-e.getTime())/864e5+1)/7)}function aC(t,e=!1){let i;if(t){if(i=new Date(t),"string"==typeof t){if(t.length>10)return e&&i.setHours(0,0,0,0),i;i.setHours(0,0,0,0)}}else i=new Date;return e&&i.setHours(0,0,0,0),i}function lC(t,e=!1){let i;if(t){if(i=new Date(t),"string"==typeof t){if(t.length>10)return e&&i.setMinutes(59,59,999),i;i.setMinutes(59,59,999)}}else i=new Date;return e&&i.setMinutes(59,59,999),i}function hC(t,e=!1){let i;if(t){if(i=new Date(t),"string"==typeof t){if(t.length>10)return e&&i.setSeconds(59,999),i;i.setSeconds(59,999)}}else i=new Date;return e&&i.setSeconds(59,999),i}function dC(t,e=!1){let i;if(t){if(i=new Date(t),"string"==typeof t){if(t.length>10)return e&&i.setMilliseconds(999),i;i.setMilliseconds(999)}}else i=new Date;return e&&i.setMilliseconds(999),i}function cC(t,e=!1){let i;if(t){if(i=new Date(t),"string"==typeof t){if(t.length>10)return e&&i.setHours(23,59,59,999),i;i.setHours(23,59,59,999)}}else i=new Date;return e&&i.setHours(23,59,59,999),i}function uC(t,e,i,o){let n=new Date(e);switch(i){case"second":n.setMilliseconds(999);break;case"minute":n.setSeconds(59,999);break;case"hour":n.setMinutes(59,59,999);break;case"day":n.setHours(23,59,59,999);break;case"week":const t=6-n.getDay();n.setDate(n.getDate()+t),n.setHours(23,59,59,999);break;case"month":const e=new Date(n.getFullYear(),n.getMonth()+1,0).getDate();n.setDate(e),n.setHours(23,59,59,999);break;case"quarter":const i=n.getMonth(),o=i-i%3+2,r=new Date(n.getFullYear(),o+1,0).getDate();n.setMonth(o,r),n.setHours(23,59,59,999);break;case"year":n.setMonth(11,31),n.setHours(23,59,59,999);break;default:throw new Error("Invalid time scale")}const r=pC(n,t,i,o,1),s=Math.ceil(r);if(s>r){const t=(s-r)*o,e=1e3,a=60*e,l=60*a,h=24*l,d=7*h;switch(new Date(n.getTime()+1),i){case"second":n.setTime(n.getTime()+t*e);break;case"minute":n.setTime(n.getTime()+t*a);break;case"hour":n.setTime(n.getTime()+t*l);break;case"day":n.setTime(n.getTime()+t*h);break;case"week":n.setTime(n.getTime()+t*d);break;case"month":n=new Date(n.getFullYear(),n.getMonth()+1+Math.round(t),0),n.setHours(23,59,59,999);break;case"quarter":const i=n.getMonth(),o=i-i%3+2;n=new Date(n.getFullYear(),o+Math.round(3*t)+1,0),n.setHours(23,59,59,999);break;case"year":n.setFullYear(n.getFullYear()+Math.floor(t)),n.setHours(23,59,59,999);break;default:throw new Error("Invalid time scale")}}return n}function gC(t,e,i="monday"){const o=new Date(t);switch(e){case"second":o.setMilliseconds(0);break;case"minute":o.setSeconds(0,0);break;case"hour":o.setMinutes(0,0,0);break;case"day":o.setHours(0,0,0,0);break;case"week":const t=o.getDay();let e=t;e="monday"===i?0===t?-6:1-t:-t,o.setDate(o.getDate()+e),o.setHours(0,0,0,0);break;case"month":o.setDate(1),o.setHours(0,0,0,0);break;case"quarter":const n=o.getMonth(),r=n-n%3;o.setMonth(r,1),o.setHours(0,0,0,0);break;case"year":o.setMonth(0,1),o.setHours(0,0,0,0);break;default:throw new Error("Invalid time scale")}return o}function pC(t,e,i,o,n=0){const r=36e5,s=864e5;let a;const l=new Date(t.getTime()+n);switch(i){case"second":a=(l.getTime()-e.getTime())/1e3;break;case"minute":a=(l.getTime()-e.getTime())/6e4;break;case"hour":a=(l.getTime()-e.getTime())/r;break;case"day":a=(l.getTime()-e.getTime())/s;break;case"week":a=(l.getTime()-e.getTime())/6048e5;break;case"month":a=12*(l.getFullYear()-e.getFullYear())+(l.getMonth()-e.getMonth()),a+=(l.getDate()-e.getDate())/new Date(l.getFullYear(),l.getMonth()+1,0).getDate();break;case"quarter":a=4*(l.getFullYear()-e.getFullYear())+(l.getMonth()-e.getMonth())/3,a+=(l.getDate()-e.getDate())/(3*new Date(l.getFullYear(),l.getMonth()+1,0).getDate());break;case"year":a=l.getFullYear()-e.getFullYear(),a+=(l.getMonth()-e.getMonth())/12;break;default:throw new Error("Invalid time scale")}return a/o}class fC{gridStyle;scrollLeft;scrollTop;x;y;width;height;rowHeight;rowCount;group;verticalLineGroup;horizontalLineGroup;verticalBackgroundRectsGroup;horizontalBackgroundRectsGroup;allGridHeight;allGridWidth;_scene;constructor(t){this._scene=t,this.scrollLeft=0,this.scrollTop=0,this.x=0,this.y=t._gantt.getAllHeaderRowsHeight(),this.width=t.ganttGroup.attribute.width,this.height=t.ganttGroup.attribute.height-t.timelineHeader.group.attribute.height,this.rowHeight=t._gantt.parsedOptions.rowHeight,this.rowCount=t._gantt.itemCount,this.allGridWidth=t._gantt.getAllDateColsWidth(),this.allGridHeight=t._gantt.getAllTaskBarsHeight(),this.group=new vs({x:this.x,y:this.y,width:this.width,height:this.height,clip:!0,fill:t._gantt.parsedOptions.grid?.backgroundColor}),this.group.name="grid-container",t.ganttGroup.addChild(this.group),this.createVerticalBackgroundRects(),this.createHorizontalBackgroundRects(),this.createVerticalLines(),this.createHorizontalLines(),this.createTimeLineHeaderBottomLine()}createTimeLineHeaderBottomLine(){const t=this._scene._gantt.parsedOptions,e=t.horizontalSplitLine?.lineWidth??t.timelineHeaderHorizontalLineStyle?.lineWidth,i=(1&e?-.5:0)+e/2,o=tc({pickable:!1,stroke:t.horizontalSplitLine?.lineColor??t.timelineHeaderHorizontalLineStyle?.lineColor,lineWidth:e+(1&e?1:0),points:[{x:0,y:i},{x:this._scene._gantt.getAllDateColsWidth(),y:i}]});o.name="timeLine-header-bottom-line",this.group.addChild(o)}createVerticalLines(){const t=this._scene._gantt.parsedOptions.grid,e=t.verticalLineDependenceOnTimeScale??this._scene._gantt.parsedOptions.reverseSortedTimelineScales[0].unit;if(t.verticalLine){this.verticalLineGroup=new vs({x:0,y:0,width:this.allGridWidth,height:this.allGridHeight}),this.verticalLineGroup.name="grid-vertical",this.group.appendChild(this.verticalLineGroup);const i=this._scene._gantt.parsedOptions.reverseSortedTimelineScales.find((t=>t.unit===e))??this._scene._gantt.parsedOptions.reverseSortedTimelineScales[0],{unit:o,step:n}=this._scene._gantt.parsedOptions.reverseSortedTimelineScales[0],{timelineDates:r}=i,s=this._scene._gantt.parsedOptions.timelineColWidth;if("function"==typeof t.verticalLine)for(let e=0;e<r?.length-1;e++){const{endDate:i}=r[e],a=t.verticalLine({index:e,dateIndex:r[e].dateIndex,date:r[e].endDate,ganttInstance:this._scene._gantt}),l=Math.ceil(pC(i,this._scene._gantt.parsedOptions.minDate,o,n,1)*s)+(1&a.lineWidth?.5:0),h=tc({pickable:!1,stroke:a.lineColor,lineWidth:a.lineWidth,points:[{x:l,y:0},{x:l,y:this.allGridHeight}]});this.verticalLineGroup.appendChild(h)}else{const e=t.verticalLine;for(let t=0;t<r?.length-1;t++){const{endDate:i}=r[t],a=Math.ceil(pC(i,this._scene._gantt.parsedOptions.minDate,o,n,1)*s)+(1&e.lineWidth?.5:0),l=tc({pickable:!1,stroke:e.lineColor,lineWidth:e.lineWidth,points:[{x:a,y:0},{x:a,y:this.allGridHeight}]});this.verticalLineGroup.appendChild(l)}}}}createHorizontalLines(){const t=this._scene._gantt.parsedOptions.grid;if(t.horizontalLine)if(this.horizontalLineGroup=new vs({x:0,y:0,width:this.allGridWidth,height:this.allGridHeight}),this.horizontalLineGroup.name="grid-horizontal",this.group.appendChild(this.horizontalLineGroup),"function"==typeof t.horizontalLine){let e=.5;for(let i=0;i<this.rowCount-1;i++){const o=t.horizontalLine({index:i,ganttInstance:this._scene._gantt});e+=this._scene._gantt.getRowHeightByIndex(i);const n=tc({pickable:!1,stroke:o.lineColor,lineWidth:o.lineWidth,points:[{x:0,y:e},{x:this.allGridWidth,y:e}]});this.horizontalLineGroup.appendChild(n)}}else{const e=t.horizontalLine;let i=0;1&e.lineWidth&&(i+=.5);for(let t=0;t<this.rowCount-1;t++){i+=this._scene._gantt.getRowHeightByIndex(t);const o=tc({pickable:!1,stroke:e.lineColor,lineWidth:e.lineWidth,points:[{x:0,y:i},{x:this.allGridWidth,y:i}]});this.horizontalLineGroup.appendChild(o)}}}createVerticalBackgroundRects(){const t=this._scene._gantt.parsedOptions.grid.verticalBackgroundColor,e=this._scene._gantt.parsedOptions.grid.weekendBackgroundColor;if(t||e){this.verticalBackgroundRectsGroup=new vs({x:0,y:0,width:this.allGridWidth,height:this.allGridHeight}),this.verticalBackgroundRectsGroup.name="grid-vertical-background",this.group.appendChild(this.verticalBackgroundRectsGroup);const{timelineDates:i,unit:o,step:n}=this._scene._gantt.parsedOptions.reverseSortedTimelineScales[0],r=this._scene._gantt.parsedOptions.timelineColWidth;if(t||e)for(let s=0;s<=i?.length-1;s++){let a;if(!e||"day"!==o||1!==n||0!==i[s].startDate.getDay()&&6!==i[s].startDate.getDay()?"function"==typeof t?a=t({index:s,dateIndex:i[s].dateIndex,date:i[s].endDate,ganttInstance:this._scene._gantt}):t&&(a=t[s%t.length]):a=e,a){const t=oc({pickable:!1,fill:a,x:Math.ceil(r*s),y:0,width:r,height:this.allGridHeight});this.verticalBackgroundRectsGroup.appendChild(t)}}}}createHorizontalBackgroundRects(){const t=this._scene._gantt.parsedOptions.grid.horizontalBackgroundColor;if(t){this.horizontalBackgroundRectsGroup=new vs({x:0,y:0,width:this.allGridWidth,height:this.allGridHeight}),this.horizontalBackgroundRectsGroup.name="grid-horizontal-background",this.group.appendChild(this.horizontalBackgroundRectsGroup);let e=0;for(let i=0;i<=this.rowCount-1;i++){let o;o="function"==typeof t?t({index:i,ganttInstance:this._scene._gantt}):t[i%t.length];const n=oc({pickable:!1,fill:o,x:0,y:e,width:this.allGridWidth,height:this._scene._gantt.getRowHeightByIndex(i)});this.horizontalBackgroundRectsGroup.appendChild(n),e+=this._scene._gantt.getRowHeightByIndex(i)}}}refresh(){this.width=this._scene.ganttGroup.attribute.width,this.height=this._scene.ganttGroup.attribute.height-this._scene.timelineHeader.group.attribute.height,this.group.setAttributes({width:this.width,height:this.height,y:this._scene._gantt.getAllHeaderRowsHeight()}),this.rowCount=this._scene._gantt.itemCount,this.allGridWidth=this._scene._gantt.getAllDateColsWidth(),this.allGridHeight=this._scene._gantt.getAllTaskBarsHeight(),this.group.removeAllChild(),this.createVerticalBackgroundRects(),this.createHorizontalBackgroundRects(),this.createVerticalLines(),this.createHorizontalLines(),this.createTimeLineHeaderBottomLine()}setX(t){this.verticalLineGroup?.setAttribute("x",t),this.horizontalLineGroup?.setAttribute("x",t),this.verticalBackgroundRectsGroup?.setAttribute("x",t),this.horizontalBackgroundRectsGroup?.setAttribute("x",t)}setY(t){this.verticalLineGroup?.setAttribute("y",t),this.horizontalLineGroup?.setAttribute("y",t),this.verticalBackgroundRectsGroup?.setAttribute("y",t),this.horizontalBackgroundRectsGroup?.setAttribute("y",t)}resize(){this.width=this._scene.ganttGroup.attribute.width,this.height=this._scene.ganttGroup.attribute.height-this._scene.timelineHeader.group.attribute.height,this.group.setAttribute("width",this.width),this.group.setAttribute("height",this.height)}}let vC=class t{static _mode;static get mode(){return t._mode||(t._mode=function(){let t="browser";try{"node"===window.type?t="node":"undefined"==typeof window||window.performance?"undefined"==typeof window&&(t="node"):t="miniApp"}catch(e){t="node"}return t}()),t._mode}static set mode(e){t._mode=e}static dpr=0;static CreateCanvas;static LoadImage;static RequestAnimationFrame;static CancelAnimationFrame;static RegisterCreateCanvas(e){t.CreateCanvas=e}static RegisterLoadImage(e){t.LoadImage=e}static GetCreateCanvasFunc(){return t.CreateCanvas?t.CreateCanvas:"worker"===t.mode?(t=200,e=200)=>new OffscreenCanvas(t,e):void 0}static RegisterRequestAnimationFrame(e){t.RequestAnimationFrame=e()}static GetRequestAnimationFrame(){if(t.RequestAnimationFrame)return t.RequestAnimationFrame}static RegisterCancelAnimationFrame(e){t.CancelAnimationFrame=e()}static GetCancelAnimationFrame(){if(t.CancelAnimationFrame)return t.CancelAnimationFrame}};class bC{hScrollBar;vScrollBar;_gantt;_clearHorizontalScrollBar;_clearVerticalScrollBar;constructor(t){this._gantt=t,this.createScrollBar(t.tableNoFrameWidth,t.tableNoFrameHeight-t.getAllHeaderRowsHeight())}createScrollBar(t,e){const i=this._gantt.parsedOptions.scrollStyle.scrollRailColor,o=this._gantt.parsedOptions.scrollStyle.scrollSliderColor,n=this._gantt.parsedOptions.scrollStyle.scrollSliderCornerRadius,r=this._gantt.parsedOptions.scrollStyle.width;let s;s=ot(n)?{cornerRadius:n,fill:o}:{fill:o},this._gantt.parsedOptions.scrollStyle?.visible,this._gantt.parsedOptions.scrollStyle?.hoverOn,this.hScrollBar=new Nb({direction:"horizontal",x:2*-t,y:2*-e,width:t,height:r,padding:0,railStyle:{fill:i},sliderStyle:s,range:[0,.1],visible:!1}),this.hScrollBar.render(),this.hScrollBar.hideAll(),this.vScrollBar=new Nb({direction:"vertical",x:2*-t,y:2*-e,width:r,height:e,padding:0,railStyle:{fill:i},sliderStyle:s,range:[0,.1],visible:!1}),this.vScrollBar.render(),this.vScrollBar.hideAll()}refresh(){}hideVerticalScrollBar(){const t=this._gantt.parsedOptions.scrollStyle.visible;"focus"!==t&&"scrolling"!==t||(this.vScrollBar.setAttribute("visible",!1),this.vScrollBar.hideAll(),this._gantt.scenegraph.updateNextFrame())}showVerticalScrollBar(t){const e=this._gantt.parsedOptions.scrollStyle.visible;"focus"!==e&&"scrolling"!==e||(this.vScrollBar.setAttribute("visible",!0),this.vScrollBar.showAll(),this._gantt.scenegraph.updateNextFrame(),t&&(clearTimeout(this._clearVerticalScrollBar),this._clearVerticalScrollBar=setTimeout((()=>{this.hideVerticalScrollBar()}),1e3)))}hideHorizontalScrollBar(){const t=this._gantt.parsedOptions.scrollStyle.visible;"focus"!==t&&"scrolling"!==t||(this.hScrollBar.setAttribute("visible",!1),this.hScrollBar.hideAll(),this._gantt.scenegraph.updateNextFrame())}showHorizontalScrollBar(t){const e=this._gantt.parsedOptions.scrollStyle.visible;"focus"!==e&&"scrolling"!==e||(this.hScrollBar.setAttribute("visible",!0),this.hScrollBar.showAll(),this._gantt.scenegraph.updateNextFrame(),t&&(clearTimeout(this._clearHorizontalScrollBar),this._clearHorizontalScrollBar=setTimeout((()=>{this.hideHorizontalScrollBar()}),1e3)))}updateVerticalScrollBarPos(t){const e=this.vScrollBar.attribute.range,i=e[1]-e[0],o=t*(1-i);this.vScrollBar.setAttribute("range",[o,o+i]);const n=this.vScrollBar.AABBBounds&&this.vScrollBar.globalAABBBounds;this.vScrollBar._viewPosition={x:n.x1,y:n.y1}}updateHorizontalScrollBarPos(t){const e=this.hScrollBar.attribute.range,i=e[1]-e[0],o=t*(1-i);this.hScrollBar.setAttribute("range",[o,o+i]);const n=this.hScrollBar.AABBBounds&&this.hScrollBar.globalAABBBounds;this.hScrollBar._viewPosition={x:n.x1,y:n.y1}}updateScrollBar(){const t=this._gantt.stateManager.scroll.horizontalBarPos,e=this._gantt.stateManager.scroll.verticalBarPos,i=this._gantt.parsedOptions.scrollStyle,o=i?.width,n=i?.visible,r=Math.ceil(this._gantt.scenegraph.ganttGroup.attribute.width),s=Math.ceil(this._gantt.scenegraph.ganttGroup.attribute.height),a=this._gantt.getAllRowsHeight(),l=this._gantt.getAllDateColsWidth(),h=this._gantt.getAllHeaderRowsHeight();if(l>r){const t=Math.min(s,a),e=Math.max(.05,r/l),h=i.hoverOn;let d=0;d=i.barToSide?this._gantt.tableNoFrameHeight-(h?o:-this._gantt.scenegraph.ganttGroup.attribute.y)+this._gantt.tableY:t-(h?o:-this._gantt.scenegraph.ganttGroup.attribute.y)+this._gantt.tableY,this.hScrollBar.setAttributes({x:this._gantt.scenegraph.ganttGroup.attribute.x,y:d,width:r,range:[0,e],visible:"always"===n});const c=this.hScrollBar.AABBBounds&&this.hScrollBar.globalAABBBounds;this.hScrollBar._viewPosition={x:c.x1,y:c.y1},"always"===n&&this.hScrollBar.showAll()}else this.hScrollBar.setAttributes({x:2*-this._gantt.tableNoFrameWidth,y:2*-this._gantt.tableNoFrameHeight,width:0,visible:!1});if(a>s){const t=Math.min(r,l)+this._gantt.scenegraph.ganttGroup.attribute.x,e=Math.max(.05,(s-h)/(a-h));let i=0;const d=this._gantt.parsedOptions.scrollStyle.hoverOn;i=this._gantt.parsedOptions.scrollStyle.barToSide?this._gantt.tableNoFrameWidth-(d?o:-this._gantt.scenegraph.ganttGroup.attribute.x):t-(d?o:-this._gantt.scenegraph.ganttGroup.attribute.x),this.vScrollBar.setAttributes({x:i,y:h+(d?0:this._gantt.scenegraph.ganttGroup.attribute.y)+this._gantt.tableY,height:s-h,range:[0,e],visible:"always"===n});const c=this.vScrollBar.AABBBounds&&this.vScrollBar.globalAABBBounds;this.vScrollBar._viewPosition={x:c.x1,y:c.y1},"always"===n&&this.vScrollBar.showAll()}else this.vScrollBar.setAttributes({x:2*-this._gantt.tableNoFrameWidth,y:2*-this._gantt.tableNoFrameHeight,height:0,visible:!1});this._gantt.stateManager.setScrollLeft(t),this._gantt.stateManager.setScrollTop(e)}}function mC(t,e,i,o=!0){let{deltaX:n,deltaY:r}=t;t.shiftKey&&t.deltaY&&(n=r,r=0);const[s,a]=function(t,e,i){const o=2,n=Math.abs(t/e),r=n<=1/o?0:t,s=n>o?0:e;return[Math.ceil(r*(i.horizontal??0)),Math.ceil(s*(i.vertical??0))]}(n,r,{horizontal:1,vertical:1});s&&(e.setScrollLeft(e.scroll.horizontalBarPos+s),i.scenegraph.scrollbarComponent.showHorizontalScrollBar(!0)),a&&(e.setScrollTop(e.scroll.verticalBarPos+a),i.scenegraph.scrollbarComponent.showVerticalScrollBar(!0)),o&&e.resetInteractionState(),t.nativeEvent?.cancelable&&("none"===e._gantt.parsedOptions.overscrollBehavior||Math.abs(r)>=Math.abs(n)&&0!==r&&function(t,e){const i=e._gantt.getAllRowsHeight()-e._gantt.scenegraph.height;if(0===i)return!1;return!function(t,e){const i=e._gantt.getAllRowsHeight()-e._gantt.scenegraph.height;return 0!==i&&t<=0&&e.scroll.verticalBarPos<1}(t,e)&&!function(t,e){const i=e._gantt.getAllRowsHeight()-e._gantt.scenegraph.height;return 0!==i&&t>=0&&Math.abs(e.scroll.verticalBarPos-i)<1}(t,e)}(r,e)||Math.abs(r)<=Math.abs(n)&&0!==n&&function(t,e){const i=e._gantt.getAllDateColsWidth()-e._gantt.scenegraph.width;if(0===i)return!1;return!function(t,e){const i=e._gantt.getAllDateColsWidth()-e._gantt.scenegraph.width;return 0!==i&&t<=0&&e.scroll.horizontalBarPos<1}(t,e)&&!function(t,e){const i=e._gantt.getAllDateColsWidth()-e._gantt.scenegraph.width;return 0!==i&&t>=0&&Math.abs(e.scroll.horizontalBarPos-i)<1}(t,e)}(n,e))&&t.preventDefault()}const yC={barColor:"blue",completedBarColor:"gray",width:30,cornerRadius:3,borderWidth:0,fontFamily:"Arial",fontSize:14};const CC="undefined"==typeof window||void 0===window.window,wC=864e5;function xC(t,e){const i=t+e.stateManager.scroll.horizontalBarPos,o=e.getDateColWidth(0);return Math.floor((i-o)/e.parsedOptions.timelineColWidth)+1}function _C(t){return t?!0===t?[{date:aC().toLocaleDateString(),scrollToMarkLine:!0,position:"left",style:{lineColor:"red",lineWidth:1}}]:Array.isArray(t)?t.map(((t,e)=>({...t,date:t.date,scrollToMarkLine:t.scrollToMarkLine,position:t.position??"left",style:{lineColor:t.style?.lineColor||"red",lineWidth:t.style?.lineWidth||1,lineDash:t.style?.lineDash}}))):[{...t,date:t.date,scrollToMarkLine:t.scrollToMarkLine??!0,position:t.position??"left",style:{lineColor:t.style?.lineColor||"red",lineWidth:t.style?.lineWidth||1,lineDash:t.style?.lineDash}}]:[]}function SC(t){const e=t.options;t.parsedOptions.tasksShowMode=e?.tasksShowMode??o.Tasks_Separate,t.parsedOptions.pixelRatio=e?.pixelRatio??1,t.parsedOptions.rowHeight=e?.rowHeight??40,t.parsedOptions.timelineColWidth=e?.timelineHeader?.colWidth??60,t.parsedOptions.startDateField=e.taskBar?.startDateField??"startDate",t.parsedOptions.endDateField=e.taskBar?.endDateField??"endDate",t.parsedOptions.progressField=e.taskBar?.progressField??"progress";const{unit:i,startOfWeek:n,step:r}=t.parsedOptions.reverseSortedTimelineScales[0];t.parsedOptions.minDate=e?.minDate?gC(new Date(e.minDate),i,n):void 0,t.parsedOptions.maxDate=e?.maxDate?uC(t.parsedOptions.minDate,new Date(e.maxDate),i,r):void 0,t.parsedOptions._minDateTime=t.parsedOptions.minDate?.getTime(),t.parsedOptions._maxDateTime=t.parsedOptions.maxDate?.getTime(),t.parsedOptions.overscrollBehavior=e?.overscrollBehavior??"auto",t.parsedOptions.underlayBackgroundColor=e?.underlayBackgroundColor??"#FFF",t.parsedOptions.scrollStyle=Object.assign({},{scrollRailColor:"rgba(100, 100, 100, 0.2)",scrollSliderColor:"rgba(100, 100, 100, 0.5)",scrollSliderCornerRadius:4,width:10,visible:"always",hoverOn:!0,barToSide:!1},e?.scrollStyle),t.parsedOptions.timelineHeaderHorizontalLineStyle=e?.timelineHeader?.horizontalLine,t.parsedOptions.timelineHeaderVerticalLineStyle=e?.timelineHeader?.verticalLine,t.parsedOptions.timelineHeaderBackgroundColor=e?.timelineHeader?.backgroundColor,t.parsedOptions.timeLineHeaderRowHeights=[],t.parsedOptions.timelineHeaderStyles=[];for(let i=0;i<t.parsedOptions.sortedTimelineScales.length;i++){const o=t.parsedOptions.sortedTimelineScales[i].style;t.parsedOptions.timelineHeaderStyles.push(Object.assign({fontSize:20,fontWeight:"bold",textAlign:"center",textBaseline:"middle",color:"#000",backgroundColor:"#fff"},o)),t.parsedOptions.timeLineHeaderRowHeights.push(t.parsedOptions.sortedTimelineScales[i].rowHeight??e?.headerRowHeight??40)}var s;t.parsedOptions.grid=Object.assign({},e?.grid),s=3*t.parsedOptions.rowHeight/4,yC.width=s,t.parsedOptions.taskBarStyle=e?.taskBar?.barStyle&&"function"==typeof e?.taskBar?.barStyle?e.taskBar.barStyle:Object.assign({},yC,e?.taskBar?.barStyle),t.parsedOptions.taskBarMilestoneStyle=Object.assign("function"==typeof t.parsedOptions.taskBarStyle?{}:{width:t.parsedOptions.taskBarStyle.width,borderColor:t.parsedOptions.taskBarStyle.borderColor,borderLineWidth:t.parsedOptions.taskBarStyle.borderLineWidth??1,fillColor:t.parsedOptions.taskBarStyle.barColor,cornerRadius:0},e?.taskBar?.milestoneStyle),t.parsedOptions.taskBarMilestoneHypotenuse=t.parsedOptions.taskBarMilestoneStyle.width*Math.sqrt(2),t.parsedOptions.dateFormat=e?.dateFormat,t.parsedOptions.taskBarHoverStyle=Object.assign({barOverlayColor:"rgba(99, 144, 0, 0.4)"},e?.taskBar?.hoverBarStyle),t.parsedOptions.taskBarSelectable=e?.taskBar?.selectable??!0,t.parsedOptions.taskBarSelectedStyle=Object.assign("function"==typeof t.parsedOptions.taskBarStyle?{shadowBlur:6,shadowOffsetX:0,shadowOffsetY:0,borderLineWidth:1}:{shadowBlur:6,shadowOffsetX:0,shadowOffsetY:0,shadowColor:t.parsedOptions.taskBarStyle.barColor,borderColor:t.parsedOptions.taskBarStyle.barColor,borderLineWidth:1},e?.taskBar?.selectedBarStyle),t.parsedOptions.taskBarLabelText=e?.taskBar?.labelText??"",t.parsedOptions.taskBarMoveable=e?.taskBar?.moveable??!0,t.parsedOptions.moveTaskBarToExtendDateRange=e?.taskBar?.moveToExtendDateRange??!0,t.parsedOptions.taskBarResizable=e?.taskBar?.resizable??!0,t.parsedOptions.taskBarDragOrder=e?.taskBar?.dragOrder??!0,t.parsedOptions.taskBarLabelStyle={fontFamily:e?.taskBar?.labelTextStyle?.fontFamily??"Arial",fontSize:e?.taskBar?.labelTextStyle?.fontSize??20,color:e?.taskBar?.labelTextStyle?.color??"#F01",textAlign:e?.taskBar?.labelTextStyle?.textAlign??"left",textBaseline:e?.taskBar?.labelTextStyle?.textBaseline??"middle",padding:e?.taskBar?.labelTextStyle?.padding??[0,0,0,10],textOverflow:e?.taskBar?.labelTextStyle?.textOverflow},t.parsedOptions.taskBarCustomLayout=e?.taskBar?.customLayout,t.parsedOptions.taskBarCreatable=e?.taskBar?.scheduleCreatable??!(t.parsedOptions.tasksShowMode!==o.Sub_Tasks_Separate&&t.parsedOptions.tasksShowMode!==o.Tasks_Separate),t.parsedOptions.taskBarCreationButtonStyle=Object.assign({lineColor:"rgb(99, 144, 0)",lineWidth:1,lineDash:[5,5],cornerRadius:4,backgroundColor:"#FFF"},e?.taskBar?.scheduleCreation?.buttonStyle),t.parsedOptions.taskBarCreationCustomLayout=e?.taskBar?.scheduleCreation?.customLayout,t.parsedOptions.taskBarCreationMaxWidth=e?.taskBar?.scheduleCreation?.maxWidth,t.parsedOptions.taskBarCreationMinWidth=e?.taskBar?.scheduleCreation?.minWidth,t.parsedOptions.outerFrameStyle=Object.assign({borderColor:"#e1e4e8",borderLineWidth:1,cornerRadius:4},e.frame?.outerFrameStyle),t.parsedOptions.markLine=_C(e?.markLine),t.parsedOptions.markLine?.length&&(t.parsedOptions.markLine?.every((t=>void 0===t.scrollToMarkLine))&&(t.parsedOptions.markLine[0].scrollToMarkLine=!0),t.parsedOptions.markLine?.find((t=>t.scrollToMarkLine))&&(t.parsedOptions.scrollToMarkLineDate=gC(new Date(t.parsedOptions.markLine?.find((t=>t.scrollToMarkLine)).date),i,n))),t.parsedOptions.verticalSplitLineHighlight=e.frame?.verticalSplitLineHighlight,t.parsedOptions.verticalSplitLine=Object.assign({lineColor:t.parsedOptions.outerFrameStyle?.borderColor,lineWidth:t.parsedOptions.outerFrameStyle?.borderLineWidth},e.frame?.verticalSplitLine),t.parsedOptions.horizontalSplitLine=e.frame?.horizontalSplitLine,t.parsedOptions.verticalSplitLineMoveable=e.frame?.verticalSplitLineMoveable,t.parsedOptions.taskKeyField=e.taskKeyField??"id",t.parsedOptions.dependencyLinks=e.dependency?.links??[],t.parsedOptions.dependencyLinkCreatable=e.dependency?.linkCreatable??!1,t.parsedOptions.dependencyLinkSelectable=e.dependency?.linkSelectable??!0,t.parsedOptions.dependencyLinkDeletable=e.dependency?.linkDeletable??!1,t.parsedOptions.dependencyLinkLineStyle=Object.assign({lineColor:"red",lineWidth:1},e.dependency?.linkLineStyle),t.parsedOptions.dependencyLinkSelectedLineStyle=Object.assign({shadowBlur:4,shadowOffset:0,shadowColor:t.parsedOptions.dependencyLinkLineStyle.lineColor,lineColor:t.parsedOptions.dependencyLinkLineStyle.lineColor,lineWidth:t.parsedOptions.dependencyLinkLineStyle.lineWidth},e?.dependency?.linkSelectedLineStyle),t.parsedOptions.dependencyLinkLineCreatePointStyle=Object.assign({strokeColor:"red",fillColor:"white",radius:5,strokeWidth:1},e?.dependency?.linkCreatePointStyle),t.parsedOptions.dependencyLinkLineCreatingPointStyle=Object.assign({strokeColor:"red",fillColor:"red",radius:5,strokeWidth:1},e?.dependency?.linkCreatingPointStyle),t.parsedOptions.dependencyLinkLineCreatingStyle=Object.assign({lineColor:"red",lineWidth:1,lineDash:[5,5]},e?.dependency?.linkCreatingLineStyle),t.parsedOptions.eventOptions=e?.eventOptions,t.parsedOptions.keyboardOptions=e?.keyboardOptions,t.parsedOptions.markLineCreateOptions=e?.markLineCreateOptions}function AC(t,e,i){const{unit:o,step:n,format:r}=i,s=[];for(;t<e;)if("day"===o){const i=t.getFullYear(),o=t.getMonth(),a=t.getDate(),l=cC(new Date(i,o,a+n-1),!0);l.getTime()>e.getTime()&&l.setTime(e.getTime());const h=t,d=r?.({dateIndex:a,startDate:h,endDate:l}),c=d||a.toString(),u={days:Math.abs(l.getTime()-t.getTime()+1)/wC,startDate:h,endDate:l,step:n,unit:"day",title:c,dateIndex:a};s.push(u),t=new Date(i,o,a+n)}else if("month"===o){const i=t.getFullYear(),o=t.getMonth(),a=cC(new Date(i,o+n,0),!0);a.getTime()>e.getTime()&&a.setTime(e.getTime());const l=t,h=r?.({dateIndex:o+1,startDate:l,endDate:a}),d=h||(o+1).toString(),c={days:Math.abs(a.getTime()-t.getTime()+1)/wC,startDate:l,step:n,unit:"month",endDate:a,title:d,dateIndex:o+1};s.push(c),t=new Date(i,o+n,1)}else if("quarter"===o){const i=t.getFullYear(),o=Math.floor(t.getMonth()/3),a=cC(new Date(i,3*(o+n),0),!0);a.getTime()>e.getTime()&&a.setTime(e.getTime());const l=t,h=r?.({dateIndex:o+1,startDate:l,endDate:a}),d=h||(o+1).toString(),c={days:Math.abs(a.getTime()-t.getTime()+1)/864e5,startDate:l,step:n,unit:"quarter",endDate:a,title:d,dateIndex:o+1};s.push(c),t=new Date(i,3*(o+n),1)}else if("year"===o){const i=t.getFullYear(),o=cC(new Date(i+n-1,11,31),!0);o.getTime()>e.getTime()&&o.setTime(e.getTime());const a=t,l=r?.({dateIndex:i,startDate:a,endDate:o}),h=l||i.toString(),d={days:Math.abs(o.getTime()-t.getTime()+1)/wC,startDate:a,endDate:o,step:n,unit:"year",title:h,dateIndex:i};s.push(d),t=new Date(i+n,0,1)}else if("week"===o){const o=i.startOfWeek??"monday";let a=t.getDay();"monday"===o&&(a=0===a?6:a-1);const l=aC(t),h=cC(t.getTime()+24*(7*n-a)*60*60*1e3-1,!0);h>e&&h.setTime(e.getTime());const d=sC(l),c=r?.({dateIndex:d,startDate:l,endDate:h})||d.toString(),u={days:(h.getTime()-l.getTime()+1)/wC,startDate:l,endDate:h,step:n,unit:"week",title:c,dateIndex:d};s.push(u),t.setTime(aC(t.getTime()+24*(7*n-a)*60*60*1e3,!0).getTime())}else if("hour"===o){const i=t.getFullYear(),o=t.getMonth(),a=t.getDate(),l=t.getHours(),h=lC(new Date(i,o,a,l+n-1),!0);h.getTime()>e.getTime()&&h.setTime(e.getTime());const d=t,c=r?.({dateIndex:l,startDate:d,endDate:h}),u=c||l.toString(),g={days:Math.abs(h.getTime()-t.getTime()+1)/wC,startDate:d,endDate:h,step:n,unit:"hour",title:u,dateIndex:t.getHours()};s.push(g),t=new Date(i,o,a,l+n)}else if("minute"===o){const i=t.getFullYear(),o=t.getMonth(),a=t.getDate(),l=t.getHours(),h=t.getMinutes(),d=hC(new Date(i,o,a,l,h+n-1),!0);d.getTime()>e.getTime()&&d.setTime(e.getTime());const c=t,u=r?.({dateIndex:h,startDate:c,endDate:d}),g=u||h.toString(),p={days:Math.abs(d.getTime()-t.getTime()+1)/wC,startDate:c,endDate:d,step:n,unit:"minute",title:g,dateIndex:t.getMinutes()};s.push(p),t=new Date(i,o,a,l,h+n)}else if("second"===o){const i=t.getFullYear(),o=t.getMonth(),a=t.getDate(),l=t.getHours(),h=t.getMinutes(),d=t.getSeconds(),c=dC(new Date(i,o,a,l,h,d+n-1),!0);c.getTime()>e.getTime()&&c.setTime(e.getTime());const u=t,g=r?.({dateIndex:d,startDate:u,endDate:c}),p=g||d.toString(),f={days:Math.abs(c.getTime()-t.getTime()+1)/wC,startDate:u,endDate:c,step:n,unit:"second",title:p,dateIndex:t.getSeconds()};s.push(f),t=new Date(i,o,a,l,h,d+n)}return s}function BC(t,e,i,o,n){let r=t[3]??10;"right"===e||"end"===e?r=o-0-(t[1]??10):"center"===e&&(r=0+(o-0+(t[3]??10)-(t[1]??10))/2);let s=0+(t[0]??10);return"bottom"===i||"alphabetic"===i||"ideographic"===i?s=n-0-(t[2]??10):"middle"===i&&(s=0+(n-0-(t[0]??10)-(t[2]??10))/2+(t[0]??10)),{x:r,y:s}}function RC(t){if(t.verticalSplitResizeLine){t.verticalSplitResizeLine.style.position="absolute",t.verticalSplitResizeLine.style.top=t.tableY+"px",t.verticalSplitResizeLine.style.left=t.taskTableWidth?t.taskTableWidth-7+t.parsedOptions.verticalSplitLine.lineWidth/2+"px":"0px",t.verticalSplitResizeLine.style.width="14px",t.verticalSplitResizeLine.style.height=t.drawHeight+"px",t.verticalSplitResizeLine.style.backgroundColor="rgba(0,0,0,0)",t.verticalSplitResizeLine.style.zIndex="100",t.parsedOptions.verticalSplitLineMoveable&&(t.verticalSplitResizeLine.style.cursor="col-resize"),t.verticalSplitResizeLine.style.userSelect="none",t.verticalSplitResizeLine.style.opacity="1";const e=t.verticalSplitResizeLine.childNodes[0];if(e.style.position="absolute",e.style.top="0px",e.style.left=(14-t.parsedOptions.verticalSplitLine.lineWidth)/2+"px",e.style.width=t.parsedOptions.verticalSplitLine.lineWidth+"px",e.style.height="100%",e.style.backgroundColor=t.parsedOptions.verticalSplitLine.lineColor,e.style.zIndex="100",e.style.userSelect="none",e.style.pointerEvents="none",e.style.transition="background-color 0.3s",t.verticalSplitResizeLine.childNodes[1]){const e=t.verticalSplitResizeLine.childNodes[1];e.style.position="absolute",e.style.top="0px",e.style.left=(14-t.parsedOptions.verticalSplitLineHighlight.lineWidth??2)/2+"px",e.style.width=(t.parsedOptions.verticalSplitLineHighlight.lineWidth??2)+"px",e.style.height="100%",e.style.backgroundColor=t.parsedOptions.verticalSplitLineHighlight.lineColor,e.style.zIndex="100",e.style.cursor="col-resize",e.style.userSelect="none",e.style.pointerEvents="none",e.style.opacity="0",e.style.transition="background-color 0.3s"}}}function TC(t,e,i,o="children"){for(let n=0;n<t.length;n++){if(Array.isArray(i)&&1===i.length&&t[n][e]===i[0]||t[n][e]===i)return{record:t[n],index:[n]};if(t[n][o]?.length)if(Array.isArray(i)&&i[0]===t[n][e]){const r=TC(t[n][o],e,i.slice(1));if(r)return r.index.unshift(n),r}else if(!Array.isArray(i)){const r=TC(t[n][o],e,i);if(r)return r.index.unshift(n),r}}}function kC(t,e="children"){for(let i=0;i<t.length;i++)t[i][e]?.length?kC(t[i][e],e):(delete t[i].vtable_gantt_linkedTo,delete t[i].vtable_gantt_linkedFrom)}function MC(t,e="children"){for(let i=0;i<t.length;i++)t[i][e]?.length?MC(t[i][e],e):delete t[i].vtable_gantt_showIndex}function LC(t,e){let i,n;if(e.taskListTableInstance){const r=e.taskListTableInstance.getTargetRowAt(t+e.headerHeight);if(r){const{row:s}=r;i=s-e.taskListTableInstance.columnHeaderLevelCount;const a=e.getRowsHeightByIndex(0,i-1);e.parsedOptions.tasksShowMode!==o.Sub_Tasks_Inline&&e.parsedOptions.tasksShowMode!==o.Sub_Tasks_Arrange&&e.parsedOptions.tasksShowMode!==o.Sub_Tasks_Compact&&e.parsedOptions.tasksShowMode!==o.Sub_Tasks_Separate||(n=Math.floor((t-a)/e.parsedOptions.rowHeight))}}else i=Math.floor(t/e.parsedOptions.rowHeight);return{task_index:i,sub_task_index:n}}function PC(t,e){if(!e.children||1===e.children.length)return 1===e.children?.length?e.children[0].vtable_gantt_showIndex=0:e.vtable_gantt_showIndex=0,1;const i=e.children.slice().sort(((e,i)=>{const{startDate:o}=FC(t,e),{startDate:n}=FC(t,i);return o.getTime()-n.getTime()})),o=[];for(let e=0;e<=i.length-1;e++){const n=i[e],{startDate:r,endDate:s}=FC(t,n);let a=!1;for(let t=0;t<o.length;t++)if(r.getTime()>o[t]){o[t]=s.getTime(),a=!0,n.vtable_gantt_showIndex=t;break}a||(o.push(s.getTime()),n.vtable_gantt_showIndex=o.length-1)}return o.length}function EC(t,e,i,o){return i.some((i=>{const{startDate:n,endDate:r}=FC(o,i);return t<=r&&n<=e}))}function HC(t,e){if(!e.children||1===e.children.length)return 1===e.children?.length?e.children[0].vtable_gantt_showIndex=0:e.vtable_gantt_showIndex=0,1;const i=[];for(let o=0;o<=e.children.length-1;o++){const n=e.children[o],{startDate:r,endDate:s}=FC(t,n);let a=!1;for(let o=0;o<i.length;o++){if(!EC(r,s,e.children.filter((t=>t!==n&&t.vtable_gantt_showIndex===o)),t)){i[o]=s.getTime(),a=!0,n.vtable_gantt_showIndex=o;break}}a||(i.push(s.getTime()),n.vtable_gantt_showIndex=i.length-1)}return i.length}function FC(t,e){const{timeScaleIncludeHour:i,startDateField:o,endDateField:n}=t.parsedOptions,r=e[o],s=e[n];return i?{startDate:aC(r),endDate:cC(s)}:{startDate:aC(r,!0),endDate:cC(s,!0)}}function OC(t){const e=t.options;t.parsedOptions.markLine=_C(e?.markLine)}function IC(t,e){return{left:t.globalTransMatrix.e+e.taskListTableInstance.tableNoFrameWidth+e.taskListTableInstance.tableX+e.tableX,top:t.globalTransMatrix.f,width:t.attribute.width,height:t.attribute.height}}class zC{group;_scene;constructor(t){this._scene=t,this.initNodes()}initNodes(){const{_scene:t}=this,e=new vs({x:0,y:0,width:t._gantt.getAllDateColsWidth(),height:t._gantt.getAllHeaderRowsHeight(),clip:!0,pickable:!1});this.group=e,e.name="date-header-container",t.ganttGroup.addChild(this.group);const{unit:i,step:o}=t._gantt.parsedOptions.reverseSortedTimelineScales[0];let n=0;for(let r=0;r<t._gantt.timeLineHeaderLevel;r++){const{timelineDates:s,customLayout:a,visible:l}=t._gantt.parsedOptions.sortedTimelineScales[r];if(!1===l)continue;const h=new vs({x:0,y:n,width:t._gantt.getAllDateColsWidth(),height:t._gantt.parsedOptions.timeLineHeaderRowHeights[r],clip:!1});n+=h.attribute.height,h.name="row-header",e.addChild(h);for(let e=0;e<s?.length;e++){const{days:n,endDate:l,startDate:d,title:c,dateIndex:u,unit:g}=s[e],p=Math.ceil(pC(d,t._gantt.parsedOptions.minDate,i,o)*t._gantt.parsedOptions.timelineColWidth),f=Math.ceil(pC(l,t._gantt.parsedOptions.minDate,i,o,1)*t._gantt.parsedOptions.timelineColWidth)-p,v=new vs({x:p,y:0,width:f,height:h.attribute.height,clip:!1,fill:t._gantt.parsedOptions.timelineHeaderBackgroundColor});let b;v.name="date-header-cell";let m=!0;const y=h.attribute.height;if(a){let t;if("function"==typeof a){t=a({width:f,height:y,index:e,startDate:d,endDate:l,days:n,dateIndex:u,title:c,ganttInstance:this._scene._gantt})}else t=a;t&&(b=t.rootContainer,m=t.renderDefaultText??!1,b.name="task-bar-custom-render"),b&&v.appendChild(b)}if(m){const{padding:e,textAlign:i,textBaseline:o,textOverflow:n,fontSize:s,fontWeight:a,color:l,strokeColor:h,textStick:d}=t._gantt.parsedOptions.timelineHeaderStyles[r],u=BC(rC(e),i,o,f,y),g=new zh({x:u.x,y:u.y,maxLineWidth:f,heightLimit:y,pickable:!0,text:c.toLocaleString(),fontSize:s,fontWeight:a,fill:l,stroke:h,lineWidth:2,textAlign:i,textBaseline:o,ellipsis:"clip"===n?"":"ellipsis"===n?"...":ot(n)?n:void 0});g.attribute.textStick=d,v.appendChild(g),g.name="date-header-cell-text"}if(r===t._gantt.timeLineHeaderLevel-1&&t._gantt.parsedOptions.markLineCreateOptions&&t._gantt.parsedOptions.markLineCreateOptions.markLineCreatable){const i=t._gantt.parsedOptions.markLineCreateOptions.markLineCreationStyle||{},o=i.size||24,n=i.iconSize||18,r=i.svg||'<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1471" width="24" height="24"> <path d="M840.05 153.35a27.61875 27.61875 0 0 0-22.95-4.95c-56.25 13.05-218.25 39.6-289.8 2.25-115.65-60.75-241.65-31.95-299.7-13.05V95.75a27.05625 27.05625 0 0 0-27-27 27.05625 27.05625 0 0 0-27 27v834.75c0 14.85 12.15 27 27 27s27-12.15 27-27V611.9c44.1-13.95 199.35-56.25 293.85 1.8 45.9 28.35 96.75 37.8 143.55 37.8 89.1 0 164.7-34.2 169.65-36.45a27.9 27.9 0 0 0 15.75-24.75V174.5a27.5625 27.5625 0 0 0-10.35-21.15z" fill="#f54319" p-id="1472"></path></svg>',a=new vs({x:f/2-o/2,y:y/2-o/2,width:o,height:o,visiable:!0});a.name="markline-hover-group",a.data=s[e];const l=new vs({x:0,y:0,width:o,height:o,cornerRadius:o/2,fill:i.fill||"#ccc",cursor:"pointer",display:"flex",justifyContent:"center",alignItems:"center",visibleAll:!1});l.name="markline-hover-inner-group",a.add(l);const h=new ac({width:n,height:n,image:r,cursor:"pointer",pickable:!0});h.name="markline-hover-icon",l.appendChild(h),v.add(a)}if(h.addChild(v),e>0){const e=tc({pickable:!1,stroke:t._gantt.parsedOptions.timelineHeaderVerticalLineStyle?.lineColor,lineWidth:t._gantt.parsedOptions.timelineHeaderVerticalLineStyle?.lineWidth,points:[{x:1&t._gantt.parsedOptions.timelineHeaderVerticalLineStyle?.lineWidth?.5:0,y:0},{x:1&t._gantt.parsedOptions.timelineHeaderVerticalLineStyle?.lineWidth?.5:0,y:h.attribute.height}]});v.appendChild(e)}}if(r>0){const e=tc({pickable:!1,stroke:t._gantt.parsedOptions.timelineHeaderHorizontalLineStyle?.lineColor,lineWidth:t._gantt.parsedOptions.timelineHeaderHorizontalLineStyle?.lineWidth,points:[{x:0,y:1&t._gantt.parsedOptions.timelineHeaderHorizontalLineStyle?.lineWidth?.5:0},{x:t._gantt.getAllDateColsWidth(),y:1&t._gantt.parsedOptions.timelineHeaderHorizontalLineStyle?.lineWidth?.5:0}]});h.addChild(e)}}}setX(t){this.group.setAttribute("x",t)}setY(t){this.group.setAttribute("y",t)}resize(){this.group.setAttribute("width",this.group.attribute?.width??0),this.group.setAttribute("height",this.group.attribute?.height??0)}refresh(){this.group?.parent.removeChild(this.group),this.initNodes()}showMarklineIcon(t){let e;return t.children.forEach((t=>{"date-header-cell-text"===t.name&&t.setAttribute("visible",!1),"markline-hover-group"===t.name&&(e=t.firstChild,e.setAttribute("visibleAll",!0))})),e}hideMarklineIconHover(t){let e;return t.children.forEach((t=>{"date-header-cell-text"===t.name&&t.setAttribute("visible",!0),"markline-hover-group"===t.name&&(e=t.firstChild,e.setAttribute("visibleAll",!1))})),e}}class DC extends vs{clipGroupBox;barRect;progressRect;textLabel;name;task_index;sub_task_index;record;constructor(t){super(t)}}const WC='<svg width="100" height="200" xmlns="http://www.w3.org/2000/svg">\n  <line x1="30" y1="10" x2="30" y2="190" stroke="black" stroke-width="4"/>\n  <line x1="70" y1="10" x2="70" y2="190" stroke="black" stroke-width="4"/>\n</svg>',NC=10;class GC{group;barContainer;hoverBarGroup;creatingDependencyLine;hoverBarLeftIcon;hoverBarRightIcon;_scene;width;height;selectedBorders=[];constructor(t){this._scene=t,this.width=t._gantt.tableNoFrameWidth,this.height=t._gantt.gridHeight,this.group=new vs({x:0,y:t._gantt.getAllHeaderRowsHeight(),width:this.width,height:this.height,pickable:!1,clip:!0}),this.group.name="task-bar-container",t.ganttGroup.addChild(this.group),this.initBars(),this.initHoverBarIcons()}initBars(){this.barContainer=new vs({x:0,y:0,width:this._scene._gantt.getAllDateColsWidth(),height:this._scene._gantt.getAllTaskBarsHeight(),pickable:!1,clip:!0}),this.group.appendChild(this.barContainer);for(let t=0;t<this._scene._gantt.itemCount;t++)if(this._scene._gantt.parsedOptions.tasksShowMode!==o.Sub_Tasks_Inline&&this._scene._gantt.parsedOptions.tasksShowMode!==o.Sub_Tasks_Separate&&this._scene._gantt.parsedOptions.tasksShowMode!==o.Sub_Tasks_Arrange&&this._scene._gantt.parsedOptions.tasksShowMode!==o.Sub_Tasks_Compact){const e=this.initBar(t);e&&this.barContainer.appendChild(e)}else{const e=this._scene._gantt.getRecordByIndex(t);if(e.children?.length>0)for(let i=0;i<e.children?.length;i++){const o=this.initBar(t,i,e.children.length);o&&this.barContainer.appendChild(o)}else{const e=this.initBar(t);e&&this.barContainer.appendChild(e)}}}initBar(t,e,i){const n=this._scene._gantt.parsedOptions.taskBarCustomLayout,{startDate:r,endDate:s,taskDays:a,progress:l,taskRecord:h}=this._scene._gantt.getTaskInfoByTaskListIndex(t,e),d="milestone"===h.type;if(d&&!r||!d&&(a<=0||!r||!s||r.getTime()>s.getTime()))return null;const{unit:c,step:u}=this._scene._gantt.parsedOptions.reverseSortedTimelineScales[0],g=pC(s,r,c,u,1)*this._scene._gantt.parsedOptions.timelineColWidth,p=this._scene._gantt.getTaskBarStyle(t,e),f=p.width;aC(this._scene._gantt.parsedOptions.minDate),this._scene._gantt.parsedOptions.tasksShowMode===o.Sub_Tasks_Separate||(this._scene._gantt.parsedOptions.tasksShowMode===o.Sub_Tasks_Arrange?HC(this._scene._gantt,this._scene._gantt.records[t]):this._scene._gantt.parsedOptions.tasksShowMode!==o.Sub_Tasks_Compact||PC(this._scene._gantt,this._scene._gantt.records[t]));const v=this._scene._gantt.parsedOptions.rowHeight,b=this._scene._gantt.parsedOptions.taskBarMilestoneStyle.width,m=pC(r,this._scene._gantt.parsedOptions.minDate,c,u)*this._scene._gantt.parsedOptions.timelineColWidth-(d?b/2:0),y=this._scene._gantt.getRowsHeightByIndex(0,t-1)+(this._scene._gantt.parsedOptions.tasksShowMode===o.Sub_Tasks_Separate?(e??0)*v:this._scene._gantt.parsedOptions.tasksShowMode===o.Sub_Tasks_Arrange||this._scene._gantt.parsedOptions.tasksShowMode===o.Sub_Tasks_Compact?h.vtable_gantt_showIndex*v:0)+(v-(d?b:f))/2,C=new DC({x:m,y:y,width:d?b:g,height:d?b:f,cornerRadius:d?this._scene._gantt.parsedOptions.taskBarMilestoneStyle.cornerRadius:p.cornerRadius,lineWidth:d?2*this._scene._gantt.parsedOptions.taskBarMilestoneStyle.borderLineWidth:2*(p.borderLineWidth??p.borderWidth),stroke:d?this._scene._gantt.parsedOptions.taskBarMilestoneStyle.borderColor:p.borderColor,angle:d?.25*Math.PI:0,anchor:d?[m+b/2,y+b/2]:void 0});C.name="task-bar",C.task_index=t,C.sub_task_index=e,C.record=h;const w=new vs({x:0,y:0,width:C.attribute.width,height:C.attribute.height,cornerRadius:d?this._scene._gantt.parsedOptions.taskBarMilestoneStyle.cornerRadius:p.cornerRadius,clip:!0});let x;w.name="task-bar-group",C.appendChild(w),C.clipGroupBox=w;let _=!0,S=!0;if(n){let e;if("function"==typeof n){e=n({width:g,height:f,index:t,startDate:r,endDate:s,taskDays:a,progress:l,taskRecord:h,ganttInstance:this._scene._gantt})}else e=n;e&&(x=e.rootContainer,_=e.renderDefaultBar??!1,S=e.renderDefaultText??!1,x&&(x.name="task-bar-custom-render"))}if(_){const t=oc({x:0,y:0,width:C.attribute.width,height:C.attribute.height,fill:d?this._scene._gantt.parsedOptions.taskBarMilestoneStyle.fillColor:p.barColor,pickable:!1});if(t.name="task-bar-rect",w.appendChild(t),C.barRect=t,"milestone"!==h.type){const t=oc({x:0,y:0,width:g*l/100,height:f,fill:p.completedBarColor,pickable:!1});t.name="task-bar-progress-rect",w.appendChild(t),C.progressRect=t}}if(x&&w.appendChild(x),S&&"milestone"!==h.type){const{textAlign:t,textBaseline:e,fontSize:i,fontFamily:o,textOverflow:n,color:r,padding:s}=this._scene._gantt.parsedOptions.taskBarLabelStyle,a=BC(rC(s),t,e,g,f),l=Dh({x:a.x,y:a.y,fontSize:i,fill:r,fontFamily:o,text:nC(this._scene._gantt.parsedOptions.taskBarLabelText,h),maxLineWidth:g-NC,textBaseline:e,textAlign:t,ellipsis:"clip"===n?"":"ellipsis"===n?"...":ot(n)?n:void 0,poptip:{position:"bottom",dx:(g-NC)/4}});w.appendChild(l),C.textLabel=l}return C}updateTaskBarNode(t,e){const i=this.getTaskBarNodeByIndex(t,e);i&&this.barContainer.removeChild(i);const o=this.initBar(t,e);o&&this.barContainer.insertInto(o,t)}initHoverBarIcons(){const t=new vs({x:0,y:0,width:100,height:100,clip:!0,pickable:!1,cornerRadius:this._scene._gantt.parsedOptions.taskBarHoverStyle.cornerRadius??yC.cornerRadius??0,fill:this._scene._gantt.parsedOptions.taskBarHoverStyle.barOverlayColor,visibleAll:!1});if(this.hoverBarGroup=t,t.name="task-bar-hover-shadow",this._scene._gantt.parsedOptions.taskBarResizable){const e=new ac({x:0,y:0,width:NC,height:20,image:WC,pickable:!0,cursor:"col-resize"});e.name="task-bar-hover-shadow-left-icon",this.hoverBarLeftIcon=e,t.appendChild(e);const i=new ac({x:0,y:0,width:NC,height:20,image:WC,pickable:!0,cursor:"col-resize"});i.name="task-bar-hover-shadow-right-icon",this.hoverBarRightIcon=i,t.appendChild(i)}}setX(t){this.barContainer.setAttribute("x",t)}setY(t){this.barContainer.setAttribute("y",t)}refresh(){this.width=this._scene._gantt.tableNoFrameWidth,this.height=this._scene._gantt.gridHeight,this.group.setAttributes({height:this.height,width:this.width,y:this._scene._gantt.getAllHeaderRowsHeight()});const t=this.barContainer.attribute.x,e=this.barContainer.attribute.y;this.barContainer.removeAllChild(),this.group.removeChild(this.barContainer),this.initBars(),this.setX(t),this.setY(e)}resize(){this.width=this._scene._gantt.tableNoFrameWidth,this.height=this._scene._gantt.gridHeight,this.group.setAttribute("width",this.width),this.group.setAttribute("height",this.height)}showHoverBar(t,e,i,o,n){const{startDate:r,endDate:s,taskRecord:a}=this._scene._gantt.getTaskInfoByTaskListIndex(n.task_index,n.sub_task_index);n&&"task-bar"===n.name&&n.appendChild(this.hoverBarGroup),this.hoverBarGroup.setAttribute("x",0),this.hoverBarGroup.setAttribute("y",0),this.hoverBarGroup.setAttribute("width",i),this.hoverBarGroup.setAttribute("height",o),this.hoverBarGroup.setAttribute("visibleAll",!0);const l=this._scene._gantt.getTaskBarStyle(n.task_index,n.sub_task_index);if("milestone"===a.type)this.hoverBarGroup.setAttribute("cornerRadius",n.attribute.cornerRadius);else{const t=this._scene._gantt.parsedOptions.taskBarHoverStyle.cornerRadius??l.cornerRadius??0;this.hoverBarGroup.setAttribute("cornerRadius",t)}this.hoverBarLeftIcon?.setAttribute("visible",!1),this.hoverBarRightIcon?.setAttribute("visible",!1);let h=!0,d=!0;if("milestone"===a.type)h=!1,d=!1;else if("function"==typeof this._scene._gantt.parsedOptions.taskBarResizable){const t={index:n.task_index,startDate:r,endDate:s,taskRecord:a,ganttInstance:this._scene._gantt},e=this._scene._gantt.parsedOptions.taskBarResizable(t);Array.isArray(e)?[h,d]=e:(h=e,d=e)}else Array.isArray(this._scene._gantt.parsedOptions.taskBarResizable)?[h,d]=this._scene._gantt.parsedOptions.taskBarResizable:(h=this._scene._gantt.parsedOptions.taskBarResizable,d=this._scene._gantt.parsedOptions.taskBarResizable);h&&this.hoverBarLeftIcon.setAttribute("visible",!0),d&&this.hoverBarRightIcon.setAttribute("visible",!0),this.hoverBarLeftIcon&&(this.hoverBarLeftIcon.setAttribute("x",0),this.hoverBarLeftIcon.setAttribute("y",Math.ceil(o/10)),this.hoverBarLeftIcon.setAttribute("width",NC),this.hoverBarLeftIcon.setAttribute("height",o-2*Math.ceil(o/10)),this.hoverBarRightIcon.setAttribute("x",i-NC),this.hoverBarRightIcon.setAttribute("y",Math.ceil(o/10)),this.hoverBarRightIcon.setAttribute("width",NC),this.hoverBarRightIcon.setAttribute("height",o-2*Math.ceil(o/10)))}hideHoverBar(){this.hoverBarGroup.setAttribute("visibleAll",!1)}createSelectedBorder(t,e,i,o,n,r=!1){const s=n.record,a=new vs({x:t,y:e,width:i,height:o,pickable:!1,attachedToTaskBarNode:n,zIndex:1e4});a.name="task-bar-select-border",this.barContainer.appendChild(a),this.selectedBorders.push(a);const l=new vs({x:0,y:0,width:i,height:o,lineWidth:this._scene._gantt.parsedOptions.taskBarSelectedStyle.borderLineWidth,pickable:!1,cornerRadius:n.attribute.cornerRadius,fill:!1,stroke:this._scene._gantt.parsedOptions.taskBarSelectedStyle.borderColor,shadowColor:this._scene._gantt.parsedOptions.taskBarSelectedStyle.shadowColor,shadowOffsetX:this._scene._gantt.parsedOptions.taskBarSelectedStyle.shadowOffsetX,shadowOffsetY:this._scene._gantt.parsedOptions.taskBarSelectedStyle.shadowOffsetY,shadowBlur:this._scene._gantt.parsedOptions.taskBarSelectedStyle.shadowBlur,angle:n.attribute.angle,anchor:[i/2,o/2]});if(a.appendChild(l),r){const t="milestone"===s.type?15:10,e=new vs({x:-t,y:0,width:10,height:o,pickable:!0}),n=new Hh({x:5,y:o/2,radius:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.radius,fill:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.fillColor,stroke:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.strokeColor,lineWidth:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.strokeWidth,pickable:!1});e.appendChild(n),e.name="task-bar-link-point-left",a.appendChild(e);const r=new vs({x:i+(t-10),y:0,width:10,height:o,pickable:!0}),l=new Hh({x:5,y:o/2,radius:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.radius,fill:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.fillColor,stroke:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.strokeColor,lineWidth:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.strokeWidth,pickable:!1,pickStrokeBuffer:10});r.appendChild(l),r.name="task-bar-link-point-right",a.appendChild(r)}}removeSelectedBorder(){this.selectedBorders.forEach((t=>{t.delete()})),this.selectedBorders=[]}removeSecondSelectedBorder(){if(2===this.selectedBorders.length){this.selectedBorders.pop().delete()}}updateCreatingDependencyLine(t,e,i,o){this.creatingDependencyLine&&(this.creatingDependencyLine.delete(),this.creatingDependencyLine=void 0);const n=new Qd({points:[{x:t,y:e},{x:i,y:o}],stroke:this._scene._gantt.parsedOptions.dependencyLinkLineCreatingStyle.lineColor,lineWidth:this._scene._gantt.parsedOptions.dependencyLinkLineCreatingStyle.lineWidth,lineDash:this._scene._gantt.parsedOptions.dependencyLinkLineCreatingStyle.lineDash,pickable:!1});this.creatingDependencyLine=n,this.selectedBorders[0].appendChild(n)}getTaskBarNodeByIndex(t,e){let i=this.barContainer.firstChild;if(!i)return null;for(let o=0;o<this.barContainer.childrenCount;o++){if(i.task_index===t&&(!ot(e)||ot(e)&&i.sub_task_index===e))return i;i=i._next}return null}}class jC{_scene;group;markLIneContainer;markLineContainerWidth=20;height;constructor(t){this._scene=t,this.height=Math.min(t._gantt.tableNoFrameHeight,t._gantt.drawHeight)-t._gantt.getAllHeaderRowsHeight(),this.group=new vs({x:0,y:t._gantt.getAllHeaderRowsHeight(),width:t._gantt.tableNoFrameWidth,height:this.height,pickable:!1,clip:!0}),this.group.name="mark-line-container",t.ganttGroup.addChild(this.group),this.markLIneContainer=new vs({x:0,y:0,width:this._scene._gantt.getAllDateColsWidth(),height:this.height,pickable:!1,clip:!0}),this.group.appendChild(this.markLIneContainer),this.initMarkLines()}initMarkLines(){this._scene._gantt.parsedOptions.markLine.forEach((t=>{const e=t.style,i=t.contentStyle||{},o=this._scene._gantt.parsedOptions.timeScaleIncludeHour?aC(t.date):aC(t.date,!0),n=this._scene._gantt.parsedOptions.minDate,{unit:r,step:s}=this._scene._gantt.parsedOptions.reverseSortedTimelineScales[0],a=pC(o,n,r,s),l=this._scene._gantt.parsedOptions.timelineColWidth*(Math.floor(a)+("right"===t.position?1:"middle"===t.position?.5:0)),h=new vs({pickable:!1,x:l-this.markLineContainerWidth/2,y:0,width:this.markLineContainerWidth,height:this.height});h.name="mark-line",this.markLIneContainer.appendChild(h);const d=tc({pickable:!1,stroke:e.lineColor,lineWidth:e.lineWidth,lineDash:e.lineDash,points:[{x:this.markLineContainerWidth/2,y:0},{x:this.markLineContainerWidth/2,y:this.height}]});if(h.appendChild(d),t.content){const o=this._scene._gantt.parsedOptions.timelineColWidth,n=i.lineHeight||18,r=new vs({x:this.markLineContainerWidth/2,y:0,cursor:"pointer",height:n,clip:!1,fill:i.backgroundColor||e.lineColor,display:"flex",cornerRadius:i.cornerRadius||[0,2,2,0]});r.name="mark-line-content",r.data=t,h.appendChild(r);const s=new zh({maxLineWidth:o,text:t.content,cursor:"pointer",lineHeight:n,fontWeight:i.fontWeight||"normal",fill:i.color||e.lineColor,fontSize:i.fontSize||12,poptip:{position:"top",dx:o/4,dy:-n/4}});r.appendChild(s)}}))}refresh(){this.height=Math.min(this._scene._gantt.tableNoFrameHeight,this._scene._gantt.drawHeight)-this._scene._gantt.getAllHeaderRowsHeight(),this.markLIneContainer.removeAllChild(),this.group.setAttribute("height",this.height),this.markLIneContainer.setAttribute("height",this.height),this.initMarkLines()}setX(t){this.markLIneContainer.setAttribute("x",t)}}class VC{_scene;border;constructor(t){this._scene=t,this.createFrameBorder()}createFrameBorder(){const t=this._scene.ganttGroup,e=this._scene._gantt.parsedOptions.outerFrameStyle;if(!e)return;const{cornerRadius:i,borderColor:o,borderLineWidth:n,borderLineDash:r}=e,s={},a={pickable:!1};if(n&&(a.stroke=!0,a.fill=!1,a.stroke=o,a.lineWidth=n,r&&(a.lineDash=r),a.lineCap="butt"),i&&(this._scene._gantt.taskListTableInstance?(a.cornerRadius=[0,this._scene._gantt.parsedOptions.outerFrameStyle.cornerRadius??0,this._scene._gantt.parsedOptions.outerFrameStyle.cornerRadius??0,0],s.cornerRadius=[0,this._scene._gantt.parsedOptions.outerFrameStyle.cornerRadius??0,this._scene._gantt.parsedOptions.outerFrameStyle.cornerRadius??0,0]):(a.cornerRadius=this._scene._gantt.parsedOptions.outerFrameStyle.cornerRadius??0,s.cornerRadius=this._scene._gantt.parsedOptions.outerFrameStyle.cornerRadius??0)),t.setAttributes(s),a.stroke){a.x=this._scene._gantt.taskListTableInstance?-n/2:n/2,a.y=n/2,a.pickable=!1,a.width=t.attribute.width+n+(this._scene._gantt.taskListTableInstance?this._scene._gantt.parsedOptions.verticalSplitLine.lineWidth:0),a.height=t.attribute.height+n/2+n/2;const e=oc(a);e.name="border-rect",t.parent.insertAfter(e,t),t.border=e,this.border=e}}refresh(){this.border&&this.border.parent&&this.border.parent.removeChild(this.border),this.createFrameBorder()}resize(){const{cornerRadius:t,borderColor:e,borderLineWidth:i,borderLineDash:o}=this._scene._gantt.parsedOptions.outerFrameStyle;this.border?.setAttributes({width:this._scene.ganttGroup.attribute.width+i+(this._scene._gantt.taskListTableInstance?this._scene._gantt.parsedOptions.verticalSplitLine.lineWidth:0),height:this._scene._gantt.drawHeight+i})}}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */let UC=class{time=Ri.beforeFillStroke;useStyle=!0;order=0;supportedAppName="vtable";drawShape(t,e,i,o,n,r,s,a,l,h,d,c,u){"date-header-cell"===t.name&&t.forEachChildren((t=>{if("date-header-cell-text"===t.name&&!0===t.attribute.textStick){const e=t;e.setAttribute("dx",0);const i=e.globalAABBBounds,o=e.stage.globalAABBBounds,n=e.parent.globalAABBBounds,r=o.intersect(n);o.intersect(n)&&(i.width()>=r.width()&&e.attribute.last_dx?e.setAttribute("dx",e.attribute.last_dx??0):o.x1>=i.x1?(e.setAttribute("dx",o.x1-i.x1),e.setAttribute("last_dx",o.x1-i.x1)):o.x2<=i.x2&&(e.setAttribute("dx",o.x2-i.x2),e.setAttribute("last_dx",o.x1-i.x1)))}}))}};UC=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s}([C()],UC);var $C=new a(((t,e,i,o)=>{t(UC).toSelf().inSingletonScope(),t(Us).toService(UC)}));class XC{_scene;group;lineVertical;lineHorizontal;constructor(t){this._scene=t,this.createAddButton()}createAddButton(){this._scene._gantt.parsedOptions.taskBarCreationCustomLayout?this.group=new vs({x:0,y:0,width:100,height:100}):(this.group=new vs({x:0,y:0,width:100,height:100,lineDash:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.lineDash,cursor:"pointer",lineWidth:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.lineWidth,stroke:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.lineColor,cornerRadius:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.cornerRadius??0,fill:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.backgroundColor}),this.lineVertical=tc({pickable:!1,stroke:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.lineColor,lineWidth:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.lineWidth,points:[{x:50,y:0},{x:50,y:100}]}),this.group.appendChild(this.lineVertical),this.lineHorizontal=tc({pickable:!1,stroke:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.lineColor,lineWidth:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.lineWidth,points:[{x:0,y:50},{x:100,y:50}]}),this.group.appendChild(this.lineHorizontal)),this.group.name="task-creation-button",this._scene.taskBar.group.addChild(this.group)}show(t,e,i,o){if(this._scene._gantt.parsedOptions.taskBarCreationCustomLayout)this.group.appendChild(this._scene._gantt.parsedOptions.taskBarCreationCustomLayout({width:i,height:o,ganttInstance:this._scene._gantt}).rootContainer);else{const t=Math.min(i,o)/6;this.lineHorizontal.setAttribute("points",[{x:(i-4*t)/2,y:o/2},{x:(i-4*t)/2+4*t,y:o/2}]),this.lineVertical.setAttribute("points",[{x:i/2,y:(o-4*t)/2},{x:i/2,y:(o-4*t)/2+4*t}])}this.group.setAttribute("x",t),this.group.setAttribute("y",e),this.group.setAttribute("width",i),this.group.setAttribute("height",o),this.group.setAttribute("visibleAll",!0)}hide(){this.group.setAttribute("visibleAll",!1),this._scene._gantt.parsedOptions.taskBarCreationCustomLayout&&this.group.removeAllChild()}}class YC{_scene;group;constructor(t){this._scene=t,this.group=new nm({position:"top",content:"",contentStyle:{fill:"#fff"},visible:!1,panel:{background:"#14161c",cornerRadius:4}}),t.ganttGroup.addChild(this.group)}show(t){const e=this._scene._gantt.parsedOptions.markLineCreateOptions?.markLineCreationHoverToolTip||{},i=t.globalTransMatrix,o=t.attribute.width,n=t.attribute.height;let r,s;const a=e.position||"top";"top"===a?(r=i.e+o/2-2,s=i.f):"bottom"===a&&(r=i.e+o/2-2,s=i.f+n);const l=e.style?.contentStyle||{fill:"#fff"},h=e.style?.panelStyle||{background:"#14161c",cornerRadius:4};this.group.setAttributes({content:e.tipContent,position:a,visibleAll:!0,visible:!0,contentStyle:l,panel:{...h,visible:!0},x:r,y:s})}hide(){this.group.setAttributes({visibleAll:!1,visible:!1})}}class KC{group;linkLinesContainer;_scene;width;height;selectedEffectNodes;constructor(t){this._scene=t,this.width=t._gantt.tableNoFrameWidth,this.height=t._gantt.gridHeight,this.group=new vs({x:0,y:t._gantt.getAllHeaderRowsHeight(),width:this.width,height:this.height,pickable:!1,clip:!0}),this.group.name="dependency-link-container",t.ganttGroup.addChild(this.group),this.initLinkLines()}initLinkLines(){if(kC(this._scene._gantt.records),this.linkLinesContainer=new vs({x:0,y:0,width:this._scene._gantt.getAllDateColsWidth(),height:this._scene._gantt.getAllTaskBarsHeight(),pickable:!1,clip:!0}),this.group.appendChild(this.linkLinesContainer),this._scene._gantt.records?.length)for(let t=0;t<this._scene._gantt.parsedOptions.dependencyLinks?.length;t++)this.initLinkLine(t)}initLinkLine(t){const{taskKeyField:e,dependencyLinks:n}=this._scene._gantt.parsedOptions,r=n[t],{linkedToTaskKey:s,linkedFromTaskKey:a,type:l}=r,h=TC(this._scene._gantt.records,e,s),d=TC(this._scene._gantt.records,e,a);if(!h||!d)return;let c,u,g,p,f,v,b,m;if(h.record.vtable_gantt_linkedTo||(h.record.vtable_gantt_linkedTo=[]),h.record.vtable_gantt_linkedTo.push(r),d.record.vtable_gantt_linkedFrom||(d.record.vtable_gantt_linkedFrom=[]),d.record.vtable_gantt_linkedFrom.push(r),this._scene._gantt.parsedOptions.tasksShowMode===o.Sub_Tasks_Inline)m=d.index[0],b=h.index[0],({startDate:c,endDate:u,taskDays:g}=this._scene._gantt.getTaskInfoByTaskListIndex(h.index[0],h.index[1])),({startDate:p,endDate:f,taskDays:v}=this._scene._gantt.getTaskInfoByTaskListIndex(d.index[0],d.index[1]));else if(this._scene._gantt.parsedOptions.tasksShowMode===o.Sub_Tasks_Separate||this._scene._gantt.parsedOptions.tasksShowMode===o.Sub_Tasks_Arrange||this._scene._gantt.parsedOptions.tasksShowMode===o.Sub_Tasks_Compact){m=this._scene._gantt.getRowsHeightByIndex(0,d.index[0]-1)/this._scene._gantt.parsedOptions.rowHeight+(this._scene._gantt.parsedOptions.tasksShowMode===o.Sub_Tasks_Arrange||this._scene._gantt.parsedOptions.tasksShowMode===o.Sub_Tasks_Compact?d.record.vtable_gantt_showIndex:d.index[1]??0);b=this._scene._gantt.getRowsHeightByIndex(0,h.index[0]-1)/this._scene._gantt.parsedOptions.rowHeight+(this._scene._gantt.parsedOptions.tasksShowMode===o.Sub_Tasks_Arrange||this._scene._gantt.parsedOptions.tasksShowMode===o.Sub_Tasks_Compact?h.record.vtable_gantt_showIndex:h.index[1]??0),({startDate:c,endDate:u,taskDays:g}=this._scene._gantt.getTaskInfoByTaskListIndex(h.index[0],h.index[1])),({startDate:p,endDate:f,taskDays:v}=this._scene._gantt.getTaskInfoByTaskListIndex(d.index[0],d.index[1]))}else m=this._scene._gantt.getTaskShowIndexByRecordIndex(d.index),b=this._scene._gantt.getTaskShowIndexByRecordIndex(h.index),({startDate:c,endDate:u,taskDays:g}=this._scene._gantt.getTaskInfoByTaskListIndex(b)),({startDate:p,endDate:f,taskDays:v}=this._scene._gantt.getTaskInfoByTaskListIndex(m));if(!v||!g)return;aC(this._scene._gantt.parsedOptions.minDate);const{arrowPoints:y,linePoints:C}=function(t,e,o,n,r,s,a,l,h,d,c,u){const{unit:g,step:p}=u.parsedOptions.reverseSortedTimelineScales[0],{minDate:f,rowHeight:v,timelineColWidth:b}=u.parsedOptions,m=u.parsedOptions.taskBarMilestoneHypotenuse,y=20,C=10,w=5;let x=[],_=[];if(t===i.FinishToStart){let t=pC(o,f,g,p,1)*b;s&&(t=pC(e,f,g,p,1)*b+m/2);let i=pC(a,f,g,p)*b;c&&(i-=m/2),x=[{x:t,y:v*(n+.5)},{x:t+y,y:v*(n+.5)},{x:t+y,y:v*(n+(n>h?0:1))},{x:i-y,y:v*(n+(n>h?0:1))},{x:i-y,y:v*(h+.5)},{x:i,y:v*(h+.5)}],t+y<=i-y&&x.splice(2,3,{x:t+y,y:v*(h+.5)});const r=x[x.length-1];_=[{x:r.x,y:r.y},{x:r.x-C,y:r.y-w},{x:r.x-C,y:r.y+w},{x:r.x,y:r.y}]}else if(t===i.StartToFinish){let t=pC(e,f,g,p)*b;s&&(t-=m/2);let i=pC(l,f,g,p,1)*b;c&&(i=pC(a,f,g,p,1)*b+m/2),x=[{x:t,y:v*(n+.5)},{x:t-y,y:v*(n+.5)},{x:t-y,y:v*(n+(n>h?0:1))},{x:i+y,y:v*(n+(n>h?0:1))},{x:i+y,y:v*(h+.5)},{x:i,y:v*(h+.5)}],t-y>=i+y&&x.splice(2,3,{x:t-y,y:v*(h+.5)});const o=x[x.length-1];_=[{x:o.x,y:o.y},{x:o.x+C,y:o.y-w},{x:o.x+C,y:o.y+w},{x:o.x,y:o.y}]}else if(t===i.StartToStart){let t=pC(e,f,g,p)*b;s&&(t-=m/2);let i=pC(a,f,g,p)*b;c&&(i-=m/2),x=[{x:t,y:v*(n+.5)},{x:(n===h?t:Math.min(t,i))-y,y:v*(n+.5)},{x:(n===h?t:Math.min(t,i))-y,y:v*(h+(n===h?1:.5))},{x:i-y,y:v*(h+(n===h?1:.5))},{x:(n===h?i:Math.min(t,i))-y,y:v*(h+.5)},{x:i,y:v*(h+.5)}];const o=x[x.length-1];_=[{x:o.x,y:o.y},{x:o.x-C,y:o.y-w},{x:o.x-C,y:o.y+w},{x:o.x,y:o.y}]}else if(t===i.FinishToFinish){let t=pC(o,f,g,p,1)*b;s&&(t=pC(e,f,g,p,1)*b+m/2);let i=pC(l,f,g,p,1)*b;c&&(i=pC(a,f,g,p,1)*b+m/2),x=[{x:t,y:v*(n+.5)},{x:(n===h?t:Math.max(t,i))+y,y:v*(n+.5)},{x:(n===h?t:Math.max(t,i))+y,y:v*(h+(n===h?1:.5))},{x:i+y,y:v*(h+(n===h?1:.5))},{x:i+y,y:v*(h+.5)},{x:i,y:v*(h+.5)}];const r=x[x.length-1];_=[{x:r.x,y:r.y},{x:r.x+C,y:r.y-w},{x:r.x+C,y:r.y+w},{x:r.x,y:r.y}]}return{linePoints:x,arrowPoints:_}}(l,p,f,m,0,"milestone"===d.record.type,c,u,b,0,"milestone"===h.record.type,this._scene._gantt),w=this._scene._gantt.parsedOptions.dependencyLinkLineStyle,x=tc({pickable:!0,stroke:w.lineColor,lineWidth:w.lineWidth,lineDash:w.lineDash,points:C,pickStrokeBuffer:3,vtable_link:r});this.linkLinesContainer.appendChild(x),r.vtable_gantt_linkLineNode=x;const _=new Sc({fill:w.lineColor,points:y});this.linkLinesContainer.appendChild(_),r.vtable_gantt_linkArrowNode=_}setX(t){this.linkLinesContainer.setAttribute("x",t)}setY(t){this.linkLinesContainer.setAttribute("y",t)}refresh(){this.width=this._scene._gantt.tableNoFrameWidth,this.height=this._scene._gantt.gridHeight,this.group.setAttributes({height:this.height,width:this.width,y:this._scene._gantt.getAllHeaderRowsHeight()});const t=this.linkLinesContainer.attribute.x,e=this.linkLinesContainer.attribute.y;this.linkLinesContainer.removeAllChild(),this.group.removeChild(this.linkLinesContainer),this.initLinkLines(),this.setX(t),this.setY(e)}resize(){this.width=this._scene._gantt.tableNoFrameWidth,this.height=this._scene._gantt.gridHeight,this.group.setAttribute("width",this.width),this.group.setAttribute("height",this.height)}createSelectedLinkLine(t){const e=t.vtable_gantt_linkLineNode,i=t.vtable_gantt_linkArrowNode,o=e.clone(),n=i.clone();o.setAttribute("stroke",this._scene._gantt.parsedOptions.dependencyLinkSelectedLineStyle.lineColor),o.setAttribute("lineWidth",this._scene._gantt.parsedOptions.dependencyLinkSelectedLineStyle.lineWidth),o.setAttribute("shadowColor",this._scene._gantt.parsedOptions.dependencyLinkSelectedLineStyle.shadowColor),o.setAttribute("shadowOffsetX",this._scene._gantt.parsedOptions.dependencyLinkSelectedLineStyle.shadowOffset),o.setAttribute("shadowOffsetY",this._scene._gantt.parsedOptions.dependencyLinkSelectedLineStyle.shadowOffset),o.setAttribute("shadowBlur",this._scene._gantt.parsedOptions.dependencyLinkSelectedLineStyle.shadowBlur),this.linkLinesContainer.appendChild(o),n.setAttribute("fill",this._scene._gantt.parsedOptions.dependencyLinkSelectedLineStyle.lineColor),this.linkLinesContainer.appendChild(n),this.selectedEffectNodes=[o,n]}removeSelectedLinkLine(){this.selectedEffectNodes?.forEach((t=>{t.delete()})),this.selectedEffectNodes=[]}deleteLink(t){const e=t.vtable_gantt_linkLineNode,i=t.vtable_gantt_linkArrowNode;e.delete(),i.delete()}}function qC(t,e,o,n,r,s,a,l,h,d,c,u,g,p,f,v){const{unit:b,step:m}=v.parsedOptions.reverseSortedTimelineScales[0],{minDate:y,rowHeight:C,timelineColWidth:w}=v.parsedOptions,x=v.parsedOptions.taskBarMilestoneHypotenuse,_=v.parsedOptions.taskBarMilestoneStyle.width,S=20,A=10;let B=[],R=[];if(t===i.FinishToStart){let t=a?a.attribute.x+a.attribute.width:pC(o,y,b,m,1)*w;s&&(t=a?a.attribute.x+a.attribute.width+(x-_)/2:pC(e,y,b,m,1)*w+x/2);let i=p?p.attribute.x:pC(h,y,b,m)*w;g&&(i-=(x-_)/2),B=[{x:t,y:C*(n+.5)+l},{x:t+S,y:C*(n+.5)+l},{x:t+S,y:C*(n+(n>c?0:1))+l},{x:i-S,y:C*(n+(n>c?0:1))+l},{x:i-S,y:C*(c+.5)+f},{x:i,y:C*(c+.5)+f}],t+S<=i-S&&B.splice(2,3,{x:t+S,y:C*(c+.5)+f});const r=B[B.length-1];R=[{x:r.x,y:r.y},{x:r.x-A,y:r.y-5},{x:r.x-A,y:r.y+5},{x:r.x,y:r.y}]}else if(t===i.StartToFinish){let t=a?a.attribute.x:pC(e,y,b,m)*w;s&&(t-=(x-_)/2);let i=p?p.attribute.x+p.attribute.width:pC(d,y,b,m,1)*w;g&&(i=p?p.attribute.x+p.attribute.width+(x-_)/2:pC(h,y,b,m,1)*w+x/2),B=[{x:t,y:C*(n+.5)+l},{x:t-S,y:C*(n+.5)+l},{x:t-S,y:C*(n+(n>c?0:1))+l},{x:i+S,y:C*(n+(n>c?0:1))+l},{x:i+S,y:C*(c+.5)+f},{x:i,y:C*(c+.5)+f}],t-S>=i+S&&B.splice(2,3,{x:t-S,y:C*(c+.5)+f});const o=B[B.length-1];R=[{x:o.x,y:o.y},{x:o.x+A,y:o.y-5},{x:o.x+A,y:o.y+5},{x:o.x,y:o.y}]}else if(t===i.StartToStart){let t=a?a.attribute.x:pC(e,y,b,m)*w;s&&(t-=(x-_)/2);let i=p?p.attribute.x:pC(h,y,b,m)*w;g&&(i-=(x-_)/2),B=[{x:t,y:C*(n+.5)+l},{x:(n===c?t:Math.min(t,i))-S,y:C*(n+.5)+l},{x:(n===c?t:Math.min(t,i))-S,y:C*(c+(n===c?1:.5))+f},{x:i-S,y:C*(c+(n===c?1:.5))+f},{x:(n===c?i:Math.min(t,i))-S,y:C*(c+.5)+f},{x:i,y:C*(c+.5)+f}];const o=B[B.length-1];R=[{x:o.x,y:o.y},{x:o.x-A,y:o.y-5},{x:o.x-A,y:o.y+5},{x:o.x,y:o.y}]}else if(t===i.FinishToFinish){let t=a?a.attribute.x+a.attribute.width:pC(o,y,b,m,1)*w;s&&(t=a?a.attribute.x+a.attribute.width+(x-_)/2:pC(e,y,b,m,1)*w+x/2);let i=p?p.attribute.x+p.attribute.width:pC(d,y,b,m,1)*w;g&&(i=p?p.attribute.x+p.attribute.width+(x-_)/2:pC(h,y,b,m,1)*w+x/2),B=[{x:t,y:C*(n+.5)+l},{x:(n===c?t:Math.max(t,i))+S,y:C*(n+.5)+l},{x:(n===c?t:Math.max(t,i))+S,y:C*(c+(n===c?1:.5))+f},{x:i+S,y:C*(c+(n===c?1:.5))+f},{x:i+S,y:C*(c+.5)+f},{x:i,y:C*(c+.5)+f}];const r=B[B.length-1];R=[{x:r.x,y:r.y},{x:r.x+A,y:r.y-5},{x:r.x+A,y:r.y+5},{x:r.x,y:r.y}]}return{linePoints:B,arrowPoints:R}}class ZC{_scene;dragLineContainer;dragLine;constructor(t){this._scene=t,this.dragLineContainer=new vs({x:0,y:0,width:t._gantt.tableNoFrameWidth,height:Math.min(t._gantt.tableNoFrameHeight,t._gantt.drawHeight),pickable:!1,clip:!0,visible:!1}),this.dragLineContainer.name="drag-order-line-container",t.ganttGroup.addChild(this.dragLineContainer),this.initDragLine()}initDragLine(){if(this._scene._gantt.taskListTableInstance){const t=this._scene._gantt.taskListTableInstance.theme.dragHeaderSplitLine,e=tc({pickable:!1,stroke:t.lineColor,lineWidth:t.lineWidth,points:[]});this.dragLine=e,this.dragLineContainer.appendChild(e)}}showDragLine(t){this.dragLineContainer.showAll(),this.dragLine.setAttribute("points",[{x:0,y:t},{x:this._scene._gantt.tableNoFrameWidth,y:t}])}hideDragLine(){this.dragLineContainer.hideAll()}}sn.load($C);var JC,QC;!function(t){t.default="default",t.grabing="grabing",t.scrolling="scrolling"}(JC||(JC={})),function(t){t.single="single",t.column="column",t.row="row",t.cross="cross",t.none="none"}(QC||(QC={}));const tw=["bgColor","color","strokeColor","borderColor","linkColor"];var ew,iw,ow,nw,rw,sw,aw;!function(t){t.RECORD="RECORD",t.NONE="NONE",t.SUM="SUM",t.MIN="MIN",t.MAX="MAX",t.AVG="AVG",t.COUNT="COUNT",t.CUSTOM="CUSTOM",t.RECALCULATE="RECALCULATE"}(ew||(ew={})),function(t){t.ASC="ASC",t.DESC="DESC",t.NORMAL="NORMAL",t.desc="desc",t.asc="asc",t.normal="normal"}(iw||(iw={})),function(t){t.top="top",t.bottom="bottom",t.left="left",t.right="right"}(ow||(ow={})),function(t){t.expand="expand",t.collapse="collapse",t.none="none",t.loading="loading"}(nw||(nw={})),function(t){t.inlineFront="inlineFront",t.inlineEnd="inlineEnd",t.left="left",t.right="right",t.absoluteRight="absoluteRight",t.contentLeft="contentLeft",t.contentRight="contentRight",t.absolute="absolute"}(rw||(rw={})),function(t){t.frozen="frozen",t.sort="sort",t.dropDown="dropDown",t.dropDownState="dropDownState",t.play="play",t.damagePic="damagePic",t.expand="expand",t.collapse="collapse",t.drillDown="drillDown",t.drillUp="drillUp",t.dragReorder="dragReorder"}(sw||(sw={})),function(t){t.upwardIconName="sort_upward",t.downwardIconName="sort_downward",t.normalIconName="sort_normal",t.freezeIconName="freeze",t.frozenIconName="frozen",t.frozenCurrentIconName="frozenCurrent",t.dropdownIconName="dropdownIcon",t.expandIconName="expand",t.collapseIconName="collapse",t.dragReorderIconName="dragReorder",t.loadingIconName="loading"}(aw||(aw={}));const lw={};class hw{constructor(t){var e;this.isAggregator=!0,this.isRecord=!0,this.records=[],this.key=t.key,this.field=t.field,this.formatFun=t.formatFun,this.isRecord=null!==(e=t.isRecord)&&void 0!==e?e:this.isRecord}clearCacheValue(){this._formatedValue=void 0}formatValue(t,e,i){return this._formatedValue||(this.formatFun?this._formatedValue=this.formatFun(this.value(),t,e,i):this._formatedValue=this.value()),this._formatedValue}reset(){this.records=[],this.clearCacheValue()}}class dw extends hw{constructor(){super(...arguments),this.type=ew.RECORD,this.isRecord=!0}push(t){t&&this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),this.clearCacheValue()}deleteRecord(t){t&&this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),this.clearCacheValue()}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),this.clearCacheValue())}value(){return this.records}reset(){this.records=[]}recalculate(){}}class cw extends hw{constructor(){super(...arguments),this.type=ew.NONE,this.isRecord=!0}push(t){t&&(this.isRecord&&(this.records=[t]),this.field&&(this.fieldValue=t[this.field])),this.clearCacheValue()}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),this.field&&this.records.length&&(this.fieldValue=this.records[this.records.length-1][this.field])),this.clearCacheValue()}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),this.field&&this.records.length&&(this.fieldValue=this.records[this.records.length-1][this.field]),this.clearCacheValue())}value(){return this.fieldValue}reset(){this.records=[],this.fieldValue=void 0}recalculate(){}}class uw extends hw{constructor(t){super(t),this.type=ew.CUSTOM,this.isRecord=!0,this.values=[],this.aggregationFun=t.aggregationFun}push(t){t&&(this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),this.field&&this.values.push(t[this.field])),this.clearCacheValue()}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),this.field&&this.records.length&&(this.values=this.records.map((t=>t[this.field]))),this.clearCacheValue())}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),this.field&&this.records.length&&(this.values=this.records.map((t=>t[this.field])))),this.clearCacheValue()}value(){var t;return this.fieldValue||(this.fieldValue=null===(t=this.aggregationFun)||void 0===t?void 0:t.call(this,this.values,this.records,this.field)),this.fieldValue}reset(){this.records=[],this.fieldValue=void 0}recalculate(){this.fieldValue=void 0,this._formatedValue=void 0}}class gw extends hw{constructor(t){var e;super(t),this.type=ew.SUM,this.sum=0,this.positiveSum=0,this.nagetiveSum=0,this.needSplitPositiveAndNegativeForSum=!1,this.needSplitPositiveAndNegativeForSum=null!==(e=t.needSplitPositiveAndNegative)&&void 0!==e&&e}push(t){if(t)if(this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),t.isAggregator){const e=t.value();this.sum+=null!=e?e:0,this.needSplitPositiveAndNegativeForSum&&(e>0?this.positiveSum+=e:e<0&&(this.nagetiveSum+=e))}else if(this.field&&!isNaN(parseFloat(t[this.field]))){const e=parseFloat(t[this.field]);this.sum+=e,this.needSplitPositiveAndNegativeForSum&&(e>0?this.positiveSum+=e:e<0&&(this.nagetiveSum+=e))}this.clearCacheValue()}deleteRecord(t){if(t)if(this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),t.isAggregator){const e=t.value();this.sum-=null!=e?e:0,this.needSplitPositiveAndNegativeForSum&&(e>0?this.positiveSum-=e:e<0&&(this.nagetiveSum-=e))}else if(this.field&&!isNaN(parseFloat(t[this.field]))){const e=parseFloat(t[this.field]);this.sum-=e,this.needSplitPositiveAndNegativeForSum&&(e>0?this.positiveSum-=e:e<0&&(this.nagetiveSum-=e))}this.clearCacheValue()}updateRecord(t,e){if(t&&e){if(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),t.isAggregator){const i=t.value(),o=e.value();this.sum+=o-i,this.needSplitPositiveAndNegativeForSum&&(i>0?this.positiveSum-=i:i<0&&(this.nagetiveSum-=i),o>0?this.positiveSum+=o:o<0&&(this.nagetiveSum+=o))}else if(this.field&&!isNaN(parseFloat(t[this.field]))){const i=parseFloat(t[this.field]),o=parseFloat(e[this.field]);this.sum+=o-i,this.needSplitPositiveAndNegativeForSum&&(i>0?this.positiveSum-=i:i<0&&(this.nagetiveSum-=i),o>0?this.positiveSum+=o:o<0&&(this.nagetiveSum+=o))}this.clearCacheValue()}}value(){var t;return(null===(t=this.records)||void 0===t?void 0:t.length)>=1?this.sum:void 0}positiveValue(){return this.positiveSum}negativeValue(){return this.nagetiveSum}reset(){super.reset(),this.records=[],this.sum=0}recalculate(){if(this.sum=0,this._formatedValue=void 0,this.records)for(let t=0;t<this.records.length;t++){const e=this.records[t];if(e.isAggregator){const t=e.value();this.sum+=null!=t?t:0,this.needSplitPositiveAndNegativeForSum&&(t>0?this.positiveSum+=t:t<0&&(this.nagetiveSum+=t))}else if(this.field&&!isNaN(parseFloat(e[this.field]))){const t=parseFloat(e[this.field]);this.sum+=t,this.needSplitPositiveAndNegativeForSum&&(t>0?this.positiveSum+=t:t<0&&(this.nagetiveSum+=t))}}}}class pw extends hw{constructor(){super(...arguments),this.type=ew.COUNT,this.count=0}push(t){t&&(this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),t.isAggregator?this.count+=t.value():this.count++),this.clearCacheValue()}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),t.isAggregator?this.count-=t.value():this.count--),this.clearCacheValue()}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),t.isAggregator&&(this.count+=e.value()-t.value()))}value(){return this.count}reset(){this.records=[],this.count=0}recalculate(){if(this.count=0,this._formatedValue=void 0,this.records)for(let t=0;t<this.records.length;t++){const e=this.records[t];e.isAggregator?this.count+=e.value():this.count++}}}class fw extends hw{constructor(){super(...arguments),this.type=ew.AVG,this.sum=0,this.count=0}push(t){t&&(this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),t.isAggregator&&t.type===ew.AVG?(this.sum+=t.sum,this.count+=t.count):this.field&&!isNaN(parseFloat(t[this.field]))&&(this.sum+=parseFloat(t[this.field]),this.count++)),this.clearCacheValue()}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),t.isAggregator&&t.type===ew.AVG?(this.sum-=t.sum,this.count-=t.count):this.field&&!isNaN(parseFloat(t[this.field]))&&(this.sum-=parseFloat(t[this.field]),this.count--)),this.clearCacheValue()}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),t.isAggregator&&t.type===ew.AVG?(this.sum+=e.sum-t.sum,this.count+=e.count-t.count):this.field&&!isNaN(parseFloat(t[this.field]))&&(this.sum+=parseFloat(e[this.field])-parseFloat(t[this.field])),this.clearCacheValue())}value(){var t;return(null===(t=this.records)||void 0===t?void 0:t.length)>=1?this.sum/this.count:void 0}reset(){this.records=[],this.sum=0,this.count=0}recalculate(){if(this.sum=0,this.count=0,this._formatedValue=void 0,this.records)for(let t=0;t<this.records.length;t++){const e=this.records[t];e.isAggregator&&e.type===ew.AVG?(this.sum+=e.sum,this.count+=e.count):this.field&&!isNaN(parseFloat(e[this.field]))&&(this.sum+=parseFloat(e[this.field]),this.count++)}}}class vw extends hw{constructor(){super(...arguments),this.type=ew.MAX,this.max=Number.MIN_SAFE_INTEGER}push(t){t&&(this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),t.isAggregator?this.max=t.max>this.max?t.max:this.max:"number"==typeof t?this.max=t>this.max?t:this.max:this.field&&"number"==typeof t[this.field]?this.max=t[this.field]>this.max?t[this.field]:this.max:this.field&&!isNaN(t[this.field])&&(this.max=parseFloat(t[this.field])>this.max?parseFloat(t[this.field]):this.max)),this.clearCacheValue()}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),this.recalculate())}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),this.recalculate())}value(){var t;return(null===(t=this.records)||void 0===t?void 0:t.length)>=1?this.max:void 0}reset(){this.records=[],this.max=Number.MIN_SAFE_INTEGER}recalculate(){if(this.max=Number.MIN_SAFE_INTEGER,this._formatedValue=void 0,this.records)for(let t=0;t<this.records.length;t++){const e=this.records[t];e.isAggregator?this.max=e.max>this.max?e.max:this.max:"number"==typeof e?this.max=e>this.max?e:this.max:this.field&&"number"==typeof e[this.field]?this.max=e[this.field]>this.max?e[this.field]:this.max:this.field&&!isNaN(e[this.field])&&(this.max=parseFloat(e[this.field])>this.max?parseFloat(e[this.field]):this.max)}}}class bw extends hw{constructor(){super(...arguments),this.type=ew.MIN,this.min=Number.MAX_SAFE_INTEGER}push(t){t&&(this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),t.isAggregator?this.min=t.min<this.min?t.min:this.min:"number"==typeof t?this.min=t<this.min?t:this.min:this.field&&"number"==typeof t[this.field]?this.min=t[this.field]<this.min?t[this.field]:this.min:this.field&&!isNaN(t[this.field])&&(this.min=parseFloat(t[this.field])<this.min?parseFloat(t[this.field]):this.min)),this.clearCacheValue()}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),this.recalculate())}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),this.recalculate())}value(){var t;return(null===(t=this.records)||void 0===t?void 0:t.length)>=1?this.min:void 0}reset(){this.records=[],this.min=Number.MAX_SAFE_INTEGER}recalculate(){if(this.min=Number.MAX_SAFE_INTEGER,this._formatedValue=void 0,this.records)for(let t=0;t<this.records.length;t++){const e=this.records[t];e.isAggregator?this.min=e.min<this.min?e.min:this.min:"number"==typeof e?this.min=e<this.min?e:this.min:this.field&&"number"==typeof e[this.field]?this.min=e[this.field]<this.min?e[this.field]:this.min:this.field&&!isNaN(e[this.field])&&(this.min=parseFloat(e[this.field])<this.min?parseFloat(e[this.field]):this.min)}}}function mw(t,e,i){if(i===iw.NORMAL||i===iw.normal)return 0;const o=/(\d+)|(\D+)/g,n=/\d/,r=/^0/;let s,a,l,h,d=0,c=0;const u=i===iw.DESC||i===iw.desc?-1:1;if(null!==e&&null===t)return-1*u;if(null!==t&&null===e)return 1*u;if("number"==typeof t&&isNaN(t))return-1*u;if("number"==typeof e&&isNaN(e))return 1*u;if(d=+t,c=+e,d<c)return-1*u;if(d>c)return 1*u;if("number"==typeof t&&"number"!=typeof e)return-1*u;if("number"==typeof e&&"number"!=typeof t)return 1*u;if("number"==typeof t&&"number"==typeof e)return 0;if(isNaN(c)&&!isNaN(d))return-1*u;if(isNaN(d)&&!isNaN(c))return 1*u;if(s=String(t),l=String(e),s===l)return 0;if(!n.test(s)||!n.test(l))return(s>l?1:-1)*u;for(s=s.match(o),l=l.match(o);s.length&&l.length;)if(a=s.shift(),h=l.shift(),a!==h)return n.test(a)&&n.test(h)?(a.replace(r,".0")-h.replace(r,".0"))*u:(a>h?1:-1)*u;return(s.length-l.length)*u}var yw=Object.freeze({__proto__:null,get AggregationType(){return ew},Aggregator:hw,AvgAggregator:fw,CountAggregator:pw,CustomAggregator:uw,get HierarchyState(){return nw},get HighlightScope(){return QC},get IconFuncTypeEnum(){return sw},get IconPosition(){return rw},get InteractionState(){return JC},get InternalIconName(){return aw},MaxAggregator:vw,MinAggregator:bw,NoneAggregator:cw,get Placement(){return ow},RecalculateAggregator:class extends hw{constructor(t){super(t),this.type=ew.RECALCULATE,this.isRecord=!0,this.calculateFun=t.calculateFun,this.dependAggregators=t.dependAggregators,this.dependIndicatorKeys=t.dependIndicatorKeys}push(t){t&&this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),this.clearCacheValue()}deleteRecord(t){t&&this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),this.clearCacheValue()}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),this.clearCacheValue())}value(){var t;if(!this.fieldValue){const e=function(t,e){const i={};for(let o=0;o<(null==e?void 0:e.length);o++){const n=t.find((t=>(null==t?void 0:t.key)===e[o]));n&&(i[n.key]=null==n?void 0:n.value())}return i}(this.dependAggregators,this.dependIndicatorKeys);this.fieldValue=null===(t=this.calculateFun)||void 0===t?void 0:t.call(this,e,this.records,this.field)}return this.fieldValue}reset(){this.records=[],this.fieldValue=void 0}recalculate(){}},RecordAggregator:dw,get SortType(){return iw},SumAggregator:gw,cellStyleKeys:tw,indicatorSort:function(t,e){return t&&e?t.toString().localeCompare(e.toString(),"zh"):t?1:-1},naturalSort:mw,registeredAggregators:lw,sortBy:function(t){let e;const i={},o={};for(let n=0;n<t.length;n++)e=t[n],i[e]=n,"string"==typeof e&&(o[e.toLowerCase()]=n);return function(t,e,n){if(n===iw.NORMAL||n===iw.normal)return 0;const r=n===iw.DESC||n===iw.desc?-1:1;let s;return null!==i[t]&&void 0!==i[t]&&null!==i[e]&&void 0!==i[e]?s=i[t]-i[e]:null!==i[t]&&void 0!==i[t]?s=-1:null!==i[e]&&void 0!==i[e]?s=1:null!==o[t]&&void 0!==i[t]&&null!==o[e]&&void 0!==i[e]?s=o[t]-o[e]:null===o[t]||void 0===i[t]||null===o[e]||void 0===i[e]?s=0:null!==o[t]&&void 0!==i[t]?s=-1:null!==o[e]&&void 0!==i[e]&&(s=1),ot(s)?s*r:mw(t,e,n)}},typeSort:function(t,e,i){if(i===iw.NORMAL||i===iw.normal)return 0;const o=i===iw.DESC||i===iw.desc?-1:1;return t&&e?t.toString().localeCompare(e.toString(),"zh")*o:t?1*o:-1*o}});let Cw,ww=1,xw=class{constructor(){this.listenersData={listeners:{},listenerData:{}}}on(t,e){const i=this.listenersData.listeners[t]||(this.listenersData.listeners[t]=[]);i.push(e);const o=ww++;return this.listenersData.listenerData[o]={type:t,listener:e,remove:()=>{delete this.listenersData.listenerData[o];const n=i.indexOf(e);i.splice(n,1),this.listenersData.listeners[t].length||delete this.listenersData.listeners[t]}},o}off(t,e){var i;if(e){const i=t;this.removeEventListener(i,e)}else{const e=t;if(!this.listenersData)return;null===(i=this.listenersData.listenerData[e])||void 0===i||i.remove()}}addEventListener(t,e,i){this.on(t,e)}removeEventListener(t,e){if(this.listenersData)for(const i in this.listenersData.listenerData){const o=this.listenersData.listenerData[i];o.type===t&&o.listener===e&&this.off(i)}}hasListeners(t){return!!this.listenersData&&!!this.listenersData.listeners[t]}fireListeners(t,e){if(!this.listenersData)return[];const i=this.listenersData.listeners[t];return i?i.map((t=>t.call(this,e))).filter((t=>ot(t))):[]}release(){delete this.listenersData}};const _w={CHANGE_STYLE:"change_style"};let Sw,Aw,Bw,Rw=class t extends xw{static get EVENT_TYPE(){return _w}static get DEFAULT(){return Cw||(Cw=new t)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i,o,n,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x,_,S,A,B,R,T,k,M,L,P;super(),this._defaultPadding=[10,16,10,16],this._textAlign=null!==(i=null==t?void 0:t.textAlign)&&void 0!==i?i:null==e?void 0:e.textAlign,this._textBaseline=null!==(o=null==t?void 0:t.textBaseline)&&void 0!==o?o:null==e?void 0:e.textBaseline,this._color=null!==(n=null==t?void 0:t.color)&&void 0!==n?n:null==e?void 0:e.color,this._strokeColor=null!==(r=null==t?void 0:t.strokeColor)&&void 0!==r?r:null==e?void 0:e.strokeColor,this._fontSize=null!==(s=t.fontSize)&&void 0!==s?s:null==e?void 0:e.fontSize,this._fontFamily=null!==(a=t.fontFamily)&&void 0!==a?a:null==e?void 0:e.fontFamily,this._fontWeight=null!==(l=t.fontWeight)&&void 0!==l?l:null==e?void 0:e.fontWeight,this._fontVariant=null!==(h=t.fontVariant)&&void 0!==h?h:null==e?void 0:e.fontVariant,this._fontStyle=null!==(d=t.fontStyle)&&void 0!==d?d:null==e?void 0:e.fontStyle,this._padding=null!==(u=null!==(c=null==t?void 0:t.padding)&&void 0!==c?c:null==e?void 0:e.padding)&&void 0!==u?u:this._defaultPadding,this._borderColor=null!==(g=null==t?void 0:t.borderColor)&&void 0!==g?g:null==e?void 0:e.borderColor,this._textOverflow=null!==(p=null==t?void 0:t.textOverflow)&&void 0!==p?p:null==e?void 0:e.textOverflow,this._textStick=null!==(v=null!==(f=t.textStick)&&void 0!==f?f:null==e?void 0:e.textStick)&&void 0!==v&&v,this._textStickBaseOnAlign=null!==(m=null!==(b=t.textStickBaseOnAlign)&&void 0!==b?b:null==e?void 0:e.textStickBaseOnAlign)&&void 0!==m&&m,this._bgColor=null!==(y=null==t?void 0:t.bgColor)&&void 0!==y?y:null==e?void 0:e.bgColor,this._lineHeight=null!==(C=null==t?void 0:t.lineHeight)&&void 0!==C?C:null==e?void 0:e.lineHeight,this._underline=null!==(w=null==t?void 0:t.underline)&&void 0!==w?w:null==e?void 0:e.underline,this._underlineColor=null!==(x=null==t?void 0:t.underlineColor)&&void 0!==x?x:null==e?void 0:e.underlineColor,this._underlineDash=null!==(_=null==t?void 0:t.underlineDash)&&void 0!==_?_:null==e?void 0:e.underlineDash,this._underlineOffset=null!==(S=null==t?void 0:t.underlineOffset)&&void 0!==S?S:null==e?void 0:e.underlineOffset,this._lineThrough=null!==(A=null==t?void 0:t.lineThrough)&&void 0!==A?A:null==e?void 0:e.lineThrough,this._lineThroughColor=null!==(B=null==t?void 0:t.lineThroughColor)&&void 0!==B?B:null==e?void 0:e.lineThroughColor,this._lineThroughDash=null!==(R=null==t?void 0:t.lineThroughDash)&&void 0!==R?R:null==e?void 0:e.lineThroughDash,this._linkColor=null!==(T=null==t?void 0:t.linkColor)&&void 0!==T?T:null==e?void 0:e.linkColor,this._cursor=null!==(k=t.cursor)&&void 0!==k?k:null==e?void 0:e.cursor,this._borderLineWidth=null!==(M=t.borderLineWidth)&&void 0!==M?M:null==e?void 0:e.borderLineWidth,this._borderLineDash=null!==(L=t.borderLineDash)&&void 0!==L?L:null==e?void 0:e.borderLineDash,this._marked=null!==(P=t.marked)&&void 0!==P?P:null==e?void 0:e.marked}get color(){return this._color}set color(t){this._color=t}get strokeColor(){return this._strokeColor}set strokeColor(t){this._strokeColor=t}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize=t}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t}get padding(){return this._padding}set padding(t){this._padding=t}get textOverflow(){return this._textOverflow}set textOverflow(t){this._textOverflow=t}get bgColor(){return this._bgColor}set bgColor(t){this._bgColor=t}get borderColor(){return this._borderColor}set borderColor(t){this._borderColor=t}get textStick(){return this._textStick}set textStick(t){this._textStick=t}get textStickBaseOnAlign(){return this._textStickBaseOnAlign}set textStickBaseOnAlign(t){this._textStickBaseOnAlign=t}get textAlign(){return this._textAlign}set textAlign(t){this._textAlign=t}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t}get underline(){return this._underline}set underline(t){this._underline=t}get underlineColor(){return this._underlineColor}set underlineColor(t){this._underlineColor=t}get underlineDash(){return this._underlineDash}set underlineDash(t){this._underlineDash=t}get underlineOffset(){return this._underlineOffset}set underlineOffset(t){this._underlineOffset=t}get lineThrough(){return this._lineThrough}set lineThrough(t){this._lineThrough=t}get lineThroughColor(){return this._lineThroughColor}set lineThroughColor(t){this._lineThroughColor=t}get lineThroughDash(){return this._lineThroughDash}set lineThroughDash(t){this._lineThroughDash=t}get linkColor(){return this._linkColor}set linkColor(t){this._linkColor=t}get cursor(){return this._cursor}set cursor(t){this._cursor=t}get borderLineWidth(){return this._borderLineWidth}set borderLineWidth(t){this._borderLineWidth=t}get borderLineDash(){return this._borderLineDash}set borderLineDash(t){this._borderLineDash=t}get marked(){return this._marked}set marked(t){this._marked=t}clone(){return new t(this,null)}},Tw=class t extends Rw{static get DEFAULT(){return Sw||(Sw=new t)}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}clone(){return new t(this,null)}};class kw extends Rw{static get DEFAULT(){return Aw||(Aw=new kw)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i,o;super(t,e),this._autoWrapText=null!==(i=null==t?void 0:t.autoWrapText)&&void 0!==i?i:null==e?void 0:e.autoWrapText,this._lineClamp=null!==(o=null==t?void 0:t.lineClamp)&&void 0!==o?o:null==e?void 0:e.lineClamp}clone(){return new kw(this,null)}get lineClamp(){return this._lineClamp}set lineClamp(t){this._lineClamp=t}get autoWrapText(){return this._autoWrapText}set autoWrapText(t){this._autoWrapText=t}}let Mw,Lw,Pw,Ew=class t extends Rw{static get DEFAULT(){return Bw||(Bw=new t)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var o,n,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x,_,S;super(t,e),this._size=(null!==(n=null!==(o=null==t?void 0:t.size)&&void 0!==o?o:null==e?void 0:e.size)&&void 0!==n?n:null==i?void 0:i.size)||14,this._spaceBetweenTextAndIcon=(null!==(s=null!==(r=null==t?void 0:t.spaceBetweenTextAndIcon)&&void 0!==r?r:null==e?void 0:e.spaceBetweenTextAndIcon)&&void 0!==s?s:null==i?void 0:i.spaceBetweenTextAndIcon)||8,this._defaultFill=null!==(l=null===(a=null==t?void 0:t.checkboxStyle)||void 0===a?void 0:a.defaultFill)&&void 0!==l?l:null==i?void 0:i.defaultFill,this._defaultStroke=null!==(d=null===(h=null==t?void 0:t.checkboxStyle)||void 0===h?void 0:h.defaultStroke)&&void 0!==d?d:null==i?void 0:i.defaultStroke,this._disableFill=null!==(u=null===(c=null==t?void 0:t.checkboxStyle)||void 0===c?void 0:c.disableFill)&&void 0!==u?u:null==i?void 0:i.disableFill,this._checkedFill=null!==(p=null===(g=null==t?void 0:t.checkboxStyle)||void 0===g?void 0:g.checkedFill)&&void 0!==p?p:null==i?void 0:i.checkedFill,this._checkedStroke=null!==(v=null===(f=null==t?void 0:t.checkboxStyle)||void 0===f?void 0:f.checkedStroke)&&void 0!==v?v:null==i?void 0:i.checkedStroke,this._disableCheckedFill=null!==(m=null===(b=null==t?void 0:t.checkboxStyle)||void 0===b?void 0:b.disableCheckedFill)&&void 0!==m?m:null==i?void 0:i.disableCheckedFill,this._disableCheckedStroke=null!==(C=null===(y=null==t?void 0:t.checkboxStyle)||void 0===y?void 0:y.disableCheckedStroke)&&void 0!==C?C:null==i?void 0:i.disableCheckedStroke,this._checkIconImage=null!==(x=null===(w=null==t?void 0:t.checkboxStyle)||void 0===w?void 0:w.checkIconImage)&&void 0!==x?x:null==i?void 0:i.checkIconImage,this._indeterminateIconImage=null!==(S=null===(_=null==t?void 0:t.checkboxStyle)||void 0===_?void 0:_.indeterminateIconImage)&&void 0!==S?S:null==i?void 0:i.indeterminateIconImage}get size(){return this._size}set size(t){this._size=t}get spaceBetweenTextAndIcon(){return this._spaceBetweenTextAndIcon}set spaceBetweenTextAndIcon(t){this._spaceBetweenTextAndIcon=t}get defaultFill(){return this._defaultFill}set defaultFill(t){this._defaultFill=t}get defaultStroke(){return this._defaultStroke}set defaultStroke(t){this._defaultStroke=t}get disableFill(){return this._disableFill}set disableFill(t){this._disableFill=t}get checkedFill(){return this._checkedFill}set checkedFill(t){this._checkedFill=t}get checkedStroke(){return this._checkedStroke}set checkedStroke(t){this._checkedStroke=t}get disableCheckedFill(){return this._disableCheckedFill}set disableCheckedFill(t){this._disableCheckedFill=t}get disableCheckedStroke(){return this._disableCheckedStroke}set disableCheckedStroke(t){this._disableCheckedStroke=t}get checkIconImage(){return this._checkIconImage}set checkIconImage(t){this._checkIconImage=t}get indeterminateIconImage(){return this._indeterminateIconImage}set indeterminateIconImage(t){this._indeterminateIconImage=t}getStyle(e){return new t(e,this)}clone(){return new t(this)}};class Hw extends Rw{static get DEFAULT(){return Mw||(Mw=new Hw)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var o,n,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x,_,S,A,B;super(t,e),this._size=(null!==(n=null!==(o=null==t?void 0:t.size)&&void 0!==o?o:null==e?void 0:e.size)&&void 0!==n?n:null==i?void 0:i.size)||14,this._spaceBetweenTextAndIcon=(null!==(s=null!==(r=null==t?void 0:t.spaceBetweenTextAndIcon)&&void 0!==r?r:null==e?void 0:e.spaceBetweenTextAndIcon)&&void 0!==s?s:null==i?void 0:i.spaceBetweenTextAndIcon)||8,this._spaceBetweenRadio=(null!==(l=null!==(a=null==t?void 0:t.spaceBetweenRadio)&&void 0!==a?a:null==e?void 0:e.spaceBetweenRadio)&&void 0!==l?l:null==i?void 0:i.spaceBetweenRadio)||2,this._innerRadius=null!==(d=null===(h=null==t?void 0:t.radioStyle)||void 0===h?void 0:h.innerRadius)&&void 0!==d?d:null==i?void 0:i.innerRadius,this._outerRadius=null!==(u=null===(c=null==t?void 0:t.radioStyle)||void 0===c?void 0:c.outerRadius)&&void 0!==u?u:null==i?void 0:i.outerRadius,this._defaultFill=null!==(p=null===(g=null==t?void 0:t.radioStyle)||void 0===g?void 0:g.defaultFill)&&void 0!==p?p:null==i?void 0:i.defaultFill,this._defaultStroke=null!==(v=null===(f=null==t?void 0:t.radioStyle)||void 0===f?void 0:f.defaultStroke)&&void 0!==v?v:null==i?void 0:i.defaultStroke,this._disableFill=null!==(m=null===(b=null==t?void 0:t.radioStyle)||void 0===b?void 0:b.disableFill)&&void 0!==m?m:null==i?void 0:i.disableFill,this._checkedFill=null!==(C=null===(y=null==t?void 0:t.radioStyle)||void 0===y?void 0:y.checkedFill)&&void 0!==C?C:null==i?void 0:i.checkedFill,this._checkedStroke=null!==(x=null===(w=null==t?void 0:t.radioStyle)||void 0===w?void 0:w.checkedStroke)&&void 0!==x?x:null==i?void 0:i.checkedStroke,this._disableCheckedFill=null!==(S=null===(_=null==t?void 0:t.radioStyle)||void 0===_?void 0:_.disableCheckedFill)&&void 0!==S?S:null==i?void 0:i.disableCheckedFill,this._disableCheckedStroke=null!==(B=null===(A=null==t?void 0:t.radioStyle)||void 0===A?void 0:A.disableCheckedStroke)&&void 0!==B?B:null==i?void 0:i.disableCheckedStroke}get size(){return this._size}set size(t){this._size=t}get spaceBetweenTextAndIcon(){return this._spaceBetweenTextAndIcon}set spaceBetweenTextAndIcon(t){this._spaceBetweenTextAndIcon=t}get spaceBetweenRadio(){return this._spaceBetweenRadio}set spaceBetweenRadio(t){this._spaceBetweenRadio=t}get innerRadius(){return this._innerRadius}set innerRadius(t){this._innerRadius=t}get outerRadius(){return this._outerRadius}set outerRadius(t){this._outerRadius=t}get defaultFill(){return this._defaultFill}set defaultFill(t){this._defaultFill=t}get defaultStroke(){return this._defaultStroke}set defaultStroke(t){this._defaultStroke=t}get disableFill(){return this._disableFill}set disableFill(t){this._disableFill=t}get checkedFill(){return this._checkedFill}set checkedFill(t){this._checkedFill=t}get checkedStroke(){return this._checkedStroke}set checkedStroke(t){this._checkedStroke=t}get disableCheckedFill(){return this._disableCheckedFill}set disableCheckedFill(t){this._disableCheckedFill=t}get disableCheckedStroke(){return this._disableCheckedStroke}set disableCheckedStroke(t){this._disableCheckedStroke=t}getStyle(t){return new Hw(t,this)}clone(){return new Hw(this)}}class Fw extends Rw{static get DEFAULT(){return Lw||(Lw=new Fw)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var o,n,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C;super(t,e),this._spaceBetweenTextAndCircle=(null!==(n=null!==(o=null==t?void 0:t.spaceBetweenTextAndCircle)&&void 0!==o?o:null==e?void 0:e.spaceBetweenTextAndCircle)&&void 0!==n?n:null==i?void 0:i.spaceBetweenTextAndCircle)||6,this._circleRadius=(null!==(s=null===(r=null==t?void 0:t.switchStyle)||void 0===r?void 0:r.circleRadius)&&void 0!==s?s:null==i?void 0:i.circleRadius)||8,this._boxWidth=(null!==(l=null===(a=null==t?void 0:t.switchStyle)||void 0===a?void 0:a.boxWidth)&&void 0!==l?l:null==i?void 0:i.boxWidth)||40,this._boxHeight=(null!==(d=null===(h=null==t?void 0:t.switchStyle)||void 0===h?void 0:h.boxHeight)&&void 0!==d?d:null==i?void 0:i.boxHeight)||24,this._checkedFill=(null!==(u=null===(c=null==t?void 0:t.switchStyle)||void 0===c?void 0:c.checkedFill)&&void 0!==u?u:null==i?void 0:i.checkedFill)||"#165DFF",this._uncheckedFill=(null!==(p=null===(g=null==t?void 0:t.switchStyle)||void 0===g?void 0:g.uncheckedFill)&&void 0!==p?p:null==i?void 0:i.uncheckedFill)||"#c9cdd4",this._disableCheckedFill=(null!==(v=null===(f=null==t?void 0:t.switchStyle)||void 0===f?void 0:f.disableCheckedFill)&&void 0!==v?v:null==i?void 0:i.disableCheckedFill)||"#94bfff",this._disableUncheckedFill=(null!==(m=null===(b=null==t?void 0:t.switchStyle)||void 0===b?void 0:b.disableUncheckedFill)&&void 0!==m?m:null==i?void 0:i.disableUncheckedFill)||"#f2f3f5",this._circleFill=(null!==(C=null===(y=null==t?void 0:t.switchStyle)||void 0===y?void 0:y.circleFill)&&void 0!==C?C:null==i?void 0:i.circleFill)||"#FFF"}get spaceBetweenTextAndCircle(){return this._spaceBetweenTextAndCircle}set spaceBetweenTextAndCircle(t){this._spaceBetweenTextAndCircle=t}get circleRadius(){return this._circleRadius}set circleRadius(t){this._circleRadius=t}get boxWidth(){return this._boxWidth}set boxWidth(t){this._boxWidth=t}get boxHeight(){return this._boxHeight}set boxHeight(t){this._boxHeight=t}get checkedFill(){return this._checkedFill}set checkedFill(t){this._checkedFill=t}get uncheckedFill(){return this._uncheckedFill}set uncheckedFill(t){this._uncheckedFill=t}get disableCheckedFill(){return this._disableCheckedFill}set disableCheckedFill(t){this._disableCheckedFill=t}get disableUncheckedFill(){return this._disableUncheckedFill}set disableUncheckedFill(t){this._disableUncheckedFill=t}get circleFill(){return this._circleFill}set circleFill(t){this._circleFill=t}getStyle(t){return new Fw(t,this)}clone(){return new Fw(this)}}class Ow extends Rw{static get DEFAULT(){return Pw||(Pw=new Ow)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var i,o,n,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x,_;super(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this._buttonColor=(null!==(o=null===(i=null==t?void 0:t.buttonStyle)||void 0===i?void 0:i.buttonColor)&&void 0!==o?o:null==e?void 0:e.buttonColor)||"#165DFF",this._buttonBorderColor=(null!==(r=null===(n=null==t?void 0:t.buttonStyle)||void 0===n?void 0:n.buttonBorderColor)&&void 0!==r?r:null==e?void 0:e.buttonBorderColor)||"#165DFF",this._buttonLineWidth=(null!==(a=null===(s=null==t?void 0:t.buttonStyle)||void 0===s?void 0:s.buttonLineWidth)&&void 0!==a?a:null==e?void 0:e.buttonLineWidth)||1,this._buttonBorderRadius=(null!==(h=null===(l=null==t?void 0:t.buttonStyle)||void 0===l?void 0:l.buttonBorderRadius)&&void 0!==h?h:null==e?void 0:e.buttonBorderRadius)||2,this._buttonHoverColor=(null!==(c=null===(d=null==t?void 0:t.buttonStyle)||void 0===d?void 0:d.buttonHoverColor)&&void 0!==c?c:null==e?void 0:e.buttonHoverColor)||"#4080FF",this._buttonHoverBorderColor=(null!==(g=null===(u=null==t?void 0:t.buttonStyle)||void 0===u?void 0:u.buttonHoverBorderColor)&&void 0!==g?g:null==e?void 0:e.buttonHoverBorderColor)||"#4080FF",this._buttonTextHoverColor=null!==(f=null===(p=null==t?void 0:t.buttonStyle)||void 0===p?void 0:p.buttonTextHoverColor)&&void 0!==f?f:null==e?void 0:e.buttonTextHoverColor,this._buttonDisableColor=(null!==(b=null===(v=null==t?void 0:t.buttonStyle)||void 0===v?void 0:v.buttonDisableColor)&&void 0!==b?b:null==e?void 0:e.buttonDisableColor)||"#94bfff",this._buttonDisableBorderColor=(null!==(y=null===(m=null==t?void 0:t.buttonStyle)||void 0===m?void 0:m.buttonDisableBorderColor)&&void 0!==y?y:null==e?void 0:e.buttonDisableBorderColor)||"#94bfff",this._buttonTextDisableColor=null!==(w=null===(C=null==t?void 0:t.buttonStyle)||void 0===C?void 0:C.buttonTextDisableColor)&&void 0!==w?w:null==e?void 0:e.buttonTextDisableColor,this._buttonPadding=(null!==(_=null===(x=null==t?void 0:t.buttonStyle)||void 0===x?void 0:x.buttonPadding)&&void 0!==_?_:null==e?void 0:e.buttonPadding)||10}get buttonColor(){return this._buttonColor}set buttonColor(t){this._buttonColor=t}get buttonBorderColor(){return this._buttonBorderColor}set buttonBorderColor(t){this._buttonBorderColor=t}get buttonLineWidth(){return this._buttonLineWidth}set buttonLineWidth(t){this._buttonLineWidth=t}get buttonBorderRadius(){return this._buttonBorderRadius}set buttonBorderRadius(t){this._buttonBorderRadius=t}get buttonHoverColor(){return this._buttonHoverColor}set buttonHoverColor(t){this._buttonHoverColor=t}get buttonHoverBorderColor(){return this._buttonHoverBorderColor}set buttonHoverBorderColor(t){this._buttonHoverBorderColor=t}get buttonTextHoverColor(){return this._buttonTextHoverColor}set buttonTextHoverColor(t){this._buttonTextHoverColor=t}get buttonDisableColor(){return this._buttonDisableColor}set buttonDisableColor(t){this._buttonDisableColor=t}get buttonDisableBorderColor(){return this._buttonDisableBorderColor}set buttonDisableBorderColor(t){this._buttonDisableBorderColor=t}get buttonTextDisableColor(){return this._buttonTextDisableColor}set buttonTextDisableColor(t){this._buttonTextDisableColor=t}get buttonTextHoverBorderColor(){return this._buttonTextHoverBorderColor}set buttonTextHoverBorderColor(t){this._buttonTextHoverBorderColor=t}get buttonPadding(){return this._buttonPadding}set buttonPadding(t){this._buttonPadding=t}getStyle(t){return new Ow(t,this)}clone(){return new Ow(this)}}function Iw(t,e,i){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Rw,n=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0;var s,a,l,h;return t||e?t instanceof Rw?t:"function"==typeof t?Iw(t(i),e,i,o,n,r):(t||(t={}),n&&!ot(t.autoWrapText)&&(t.autoWrapText=!0),o===Ew?new Ew(null!=t?t:{},null!=e?e:{},null!==(s=r.checkboxStyle)&&void 0!==s?s:{}):o===Hw?new Hw(null!=t?t:{},null!=e?e:{},null!==(a=r.radioStyle)&&void 0!==a?a:{}):o===Fw?new Fw(null!=t?t:{},null!=e?e:{},null!==(l=r.switchStyle)&&void 0!==l?l:{}):o===Ow?new Ow(null!=t?t:{},null!=e?e:{},null!==(h=r.buttonStyle)&&void 0!==h?h:{}):new o(null!=t?t:{},null!=e?e:{})):o.DEFAULT}class zw{static get mode(){return zw._mode||(zw._mode=function(){let t="browser";try{"node"===window.type?t="node":"undefined"==typeof window||window.performance?"undefined"==typeof window&&(t="node"):t="miniApp"}catch(e){t="node"}return t}()),zw._mode}static set mode(t){zw._mode=t}static RegisterCreateCanvas(t){zw.CreateCanvas=t}static RegisterLoadImage(t){zw.LoadImage=t}static GetCreateCanvasFunc(){return zw.CreateCanvas?zw.CreateCanvas:"worker"===zw.mode?function(){return new OffscreenCanvas(arguments.length>0&&void 0!==arguments[0]?arguments[0]:200,arguments.length>1&&void 0!==arguments[1]?arguments[1]:200)}:void 0}static RegisterRequestAnimationFrame(t){zw.RequestAnimationFrame=t()}static GetRequestAnimationFrame(){if(zw.RequestAnimationFrame)return zw.RequestAnimationFrame}static RegisterCancelAnimationFrame(t){zw.CancelAnimationFrame=t()}static GetCancelAnimationFrame(){if(zw.CancelAnimationFrame)return zw.CancelAnimationFrame}}zw.dpr=0;const Dw=(t,e)=>(t=>{switch(Object.prototype.toString.call(t)){case"[object Object]":return"object";case"[object Function]":return"function";case"[object Array]":return"array";case"[object String]":return"string";case"[object Number]":return"number";case"[object RegExp]":return"regExp";case"[object Boolean]":return"boolean";case"[object Symbol]":return"symbol";case"[object Date]":return"date";case"[object Undefined]":return"undefined";case"[object Null]":return"null";case"[object Error]":return"error";case"[object HTMLDocument]":return"document";case"[object global]":return"global";default:return null}})(t)===e,Ww=t=>Dw(t,"object"),Nw=t=>Dw(t,"string"),Gw=t=>Dw(t,"number"),jw=t=>Dw(t,"boolean");function Vw(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),o=1;o<e;o++)i[o-1]=arguments[o];if(!i.length)return t||{};const n=i.shift();if(Ww(t)&&Ww(n))for(const e in n)Ww(n[e])?(t[e]||Object.assign(t,{[e]:{}}),Ww(t[e])||Object.assign(t,{[e]:n[e]}),Vw(t[e],n[e])):null!==n[e]&&void 0!==n[e]&&Object.assign(t,{[e]:n[e]});return Vw(t,...i)}function Uw(t){return"function"==typeof t&&(t=t()),ot(t)?`${t}`:""}function $w(t,e){let i=null;return function(){for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];i||(t.apply(this,n),i=setTimeout((()=>{i=null}),e))}}function Xw(t,e){for(t=`${t}`;t.length<e;)t="0"+t;return t}function Yw(t,e,i){t=(t=t.replace(/^\s*|\s*$/,"")).replace(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i,"#$1$1$2$2$3$3");const o=Math.round(256*e)*(i?-1:1),n=t.match(new RegExp("^rgba?\\(\\s*(\\d|[1-9]\\d|1\\d{2}|2[0-4][0-9]|25[0-5])\\s*,\\s*(\\d|[1-9]\\d|1\\d{2}|2[0-4][0-9]|25[0-5])\\s*,\\s*(\\d|[1-9]\\d|1\\d{2}|2[0-4][0-9]|25[0-5])(?:\\s*,\\s*(0|1|0?\\.\\d+))?\\s*\\)$","i")),r=n&&ot(n[4])?n[4]:null,s=n?[n[1],n[2],n[3]]:t.replace(/^#?([a-f0-9][a-f0-9])([a-f0-9][a-f0-9])([a-f0-9][a-f0-9])/i,(function(){return`${parseInt(arguments[1],16)},${parseInt(arguments[2],16)},${parseInt(arguments[3],16)}`})).split(/,/);return n?`rgb${null!==r?"a":""}(${Math[i?"max":"min"](parseInt(s[0],10)+o,i?0:255)}, ${Math[i?"max":"min"](parseInt(s[1],10)+o,i?0:255)}, ${Math[i?"max":"min"](parseInt(s[2],10)+o,i?0:255)}${null!==r?`, ${r}`:""})`:["#",Xw(Math[i?"max":"min"](parseInt(s[0],10)+o,i?0:255).toString(16),2),Xw(Math[i?"max":"min"](parseInt(s[1],10)+o,i?0:255).toString(16),2),Xw(Math[i?"max":"min"](parseInt(s[2],10)+o,i?0:255).toString(16),2)].join("")}function Kw(t){return Nw(t)||Gw(t)||jw(t)?t.toString():""}function qw(){return navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)}function Zw(t,e,i){return"desc"!==i?t===e?0:t>e?1:-1:t===e?0:t<e?1:-1}function Jw(t){const e=[];for(let i=0;i<t.length;i++)-1===e.indexOf(t[i])&&e.push(t[i]);return e}function Qw(t,e,i){i(t),(null==t?void 0:t[e])&&Array.isArray(null==t?void 0:t[e])&&t[e].forEach((t=>Qw(t,e,i)))}const tx="undefined"==typeof window||void 0===window.window;let ex,ix;const ox={get find(){return ex||(ex=Array.prototype.find?(t,e)=>Array.prototype.find.call(t,e):(t,e)=>{const i=ox.findIndex(t,e);return i>=0?t[i]:void 0},ex)},get findIndex(){return ix||(ix=Array.prototype.findIndex?(t,e)=>Array.prototype.findIndex.call(t,e):(t,e)=>{const{length:i}=t;for(let o=0;o<i;o++)if(e(t[o],o,t))return o;return-1},ix)}};const{IE:nx,Chrome:rx,Firefox:sx,Edge:ax,Safari:lx}=function(){if(tx)return{IE:!1,Edge:!1,Chrome:!1,Firefox:!1,Safari:!1};const t=window.navigator.userAgent.toLowerCase();return{IE:!!/(msie|trident)/.exec(t),Edge:t.indexOf("edge")>-1,Chrome:t.indexOf("chrome")>-1&&-1===t.indexOf("edge"),Firefox:t.indexOf("firefox")>-1,Safari:t.indexOf("safari")>-1&&-1===t.indexOf("edge")}}();function hx(){const t={};for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return i.forEach((e=>{for(const i in e)Object.defineProperty(t,i,{get:()=>e[i],set(t){e[i]=t},configurable:!0,enumerable:!0})})),t}function dx(t,e){let i=t;for(let t=0;t<(arguments.length<=2?0:arguments.length-2)&&null!=i;t++)i=e(i,t+2<2||arguments.length<=t+2?void 0:arguments[t+2]);return i}function cx(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),o=1;o<e;o++)i[o-1]=arguments[o];return dx(t,((t,e)=>t[e]),...i)}function ux(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),o=1;o<e;o++)i[o-1]=arguments[o];return"function"==typeof t?t(...i):t}function gx(t){return Boolean(t&&"function"==typeof t.then)}function px(t,e){gx(t)?t.then((t=>{e(t)})).catch((t=>{})):e(t)}function fx(t){return Array.isArray(t)?3===t.length?[t[0],t[1],t[2],t[1]]:2===t.length?[t[0],t[1],t[0],t[1]]:1===t.length?[t[0],t[0],t[0],t[0]]:[t[0],t[1],t[2],t[3]]:[t,t,t,t]}function vx(t,e,i){return t.start.col<=e&&e<=t.end.col&&t.start.row<=i&&i<=t.end.row||t.end.col<=e&&e<=t.start.col&&t.end.row<=i&&i<=t.start.row||t.end.col<=e&&e<=t.start.col&&t.start.row<=i&&i<=t.end.row||t.start.col<=e&&e<=t.end.col&&t.end.row<=i&&i<=t.start.row}function bx(t){return{start:{col:Math.min(t.start.col,t.end.col),row:Math.min(t.start.row,t.end.row)},end:{col:Math.max(t.start.col,t.end.col),row:Math.max(t.start.row,t.end.row)}}}function mx(t,e){const i=bx(t),o=bx(e);return Math.max(i.start.col,o.start.col)<=Math.min(i.end.col,o.end.col)&&Math.max(i.start.row,o.start.row)<=Math.min(i.end.row,o.end.row)}const yx=nx,Cx={isObject:function(t){return t===Object(t)}},wx={endsWith:function(t,e,i){const o=Kw(t);("number"!=typeof i||!isFinite(i)||Math.floor(i)!==i||i>o.length)&&(i=o.length),i-=e.length;const n=o.lastIndexOf(e,i);return-1!==n&&n===i}},xx={isTouchEvent:function(t){return!!t.changedTouches}},_x={toBoxArray:fx},Sx=Function.prototype,Ax={CLICK_CELL:"click_cell",DBLCLICK_CELL:"dblclick_cell",MOUSEDOWN_CELL:"mousedown_cell",MOUSEUP_CELL:"mouseup_cell",SELECTED_CELL:"selected_cell",SELECTED_CLEAR:"selected_clear",KEYDOWN:"keydown",MOUSEENTER_TABLE:"mouseenter_table",MOUSELEAVE_TABLE:"mouseleave_table",MOUSEDOWN_TABLE:"mousedown_table",MOUSEMOVE_TABLE:"mousemove_table",MOUSEMOVE_CELL:"mousemove_cell",MOUSEENTER_CELL:"mouseenter_cell",MOUSELEAVE_CELL:"mouseleave_cell",CONTEXTMENU_CELL:"contextmenu_cell",RESIZE_COLUMN:"resize_column",RESIZE_COLUMN_END:"resize_column_end",RESIZE_ROW:"resize_row",RESIZE_ROW_END:"resize_row_end",CHANGE_HEADER_POSITION_START:"change_header_position_start",CHANGE_HEADER_POSITION:"change_header_position",CHANGING_HEADER_POSITION:"changing_header_position",CHANGE_HEADER_POSITION_FAIL:"change_header_position_fail",SORT_CLICK:"sort_click",AFTER_SORT:"after_sort",FREEZE_CLICK:"freeze_click",SCROLL:"scroll",CAN_SCROLL:"can_scroll",SCROLL_HORIZONTAL_END:"scroll_horizontal_end",SCROLL_VERTICAL_END:"scroll_vertical_end",DROPDOWN_MENU_CLICK:"dropdown_menu_click",MOUSEOVER_CHART_SYMBOL:"mouseover_chart_symbol",DRAG_SELECT_END:"drag_select_end",COPY_DATA:"copy_data",DROPDOWN_ICON_CLICK:"dropdown_icon_click",DROPDOWN_MENU_CLEAR:"dropdown_menu_clear",TREE_HIERARCHY_STATE_CHANGE:"tree_hierarchy_state_change",SHOW_MENU:"show_menu",HIDE_MENU:"hide_menu",ICON_CLICK:"icon_click",LEGEND_ITEM_CLICK:"legend_item_click",LEGEND_ITEM_HOVER:"legend_item_hover",LEGEND_ITEM_UNHOVER:"legend_item_unHover",LEGEND_CHANGE:"legend_change",MOUSEENTER_AXIS:"mouseenter_axis",MOUSELEAVE_AXIS:"mouseleave_axis",CHECKBOX_STATE_CHANGE:"checkbox_state_change",RADIO_STATE_CHANGE:"radio_state_change",SWITCH_STATE_CHANGE:"switch_state_change",AFTER_RENDER:"after_render",INITIALIZED:"initialized",CHANGE_CELL_VALUE:"change_cell_value",DRAG_FILL_HANDLE_END:"drag_fill_handle_end",MOUSEDOWN_FILL_HANDLE:"mousedown_fill_handle",DBLCLICK_FILL_HANDLE:"dblclick_fill_handle",EMPTY_TIP_CLICK:"empty_tip_click",EMPTY_TIP_DBLCLICK:"empty_tip_dblclick",BUTTON_CLICK:"button_click"},Bx=(t,e)=>(t=>{switch(Object.prototype.toString.call(t)){case"[object Object]":return"object";case"[object Function]":return"function";case"[object Array]":return"array";case"[object String]":return"string";case"[object Number]":return"number";case"[object RegExp]":return"regExp";case"[object Boolean]":return"boolean";case"[object Symbol]":return"symbol";case"[object Date]":return"date";case"[object Undefined]":return"undefined";case"[object Null]":return"null";case"[object Error]":return"error";case"[object HTMLDocument]":return"document";case"[object global]":return"global";default:return null}})(t)===e;function Rx(t,e,i){let o,n,r,s,a,l,h=0,d=!1,c=!1,u=!0;const g=!e&&0!==e&&"function"==typeof requestAnimationFrame;if("function"!=typeof t)throw new TypeError("Expected a function");function p(e){const i=o,r=n;return n=void 0,o=void 0,h=e,s=t.apply(r,i),s}function f(t,e){return g?requestAnimationFrame(t):setTimeout(t,e)}function v(t){const i=t-l;return void 0===l||i>=e||i<0||d&&t-h>=r}function b(){const t=Date.now();if(v(t))return function(t){return a=void 0,u&&o?p(t):(n=void 0,o=void 0,s)}(t);a=f(b,function(t){const i=t-h,o=e&&-(t-l);return d?Math.min(o,r-i):o}(t))}return e=+e||0,Bx(i,"object")&&(c=!!i.leading,d="maxWait"in i,d&&(r=Math.max(+i.maxWait||0,e)),u="trailing"in i?!!i.trailing:u),function(){const t=Date.now(),i=v(t);for(var r=arguments.length,u=new Array(r),g=0;g<r;g++)u[g]=arguments[g];if(o=u,n=this,l=t,i){if(void 0===a)return function(t){return h=t,a=f(b,e),c?p(t):s}(l);if(d)return a=f(b,e),p(l)}return void 0===a&&(a=f(b,e)),s}}let Tx=1,kx=class{constructor(){this.listeners={},this.reseizeListeners={}}on(t,e,i){if("node"===zw.mode)return-1;const o=Tx++;for(var n=arguments.length,r=new Array(n>3?n-3:0),s=3;s<n;s++)r[s-3]=arguments[s];if(null==t?void 0:t.addEventListener)if("resize"!==e||t===window)null==t||t.addEventListener(e,i,...r);else{const e=new class{constructor(t,e,i){var o;if(this.resizeTime=100,this.lastSize={width:0,height:0},this.mutationResize=()=>{this.onResize()},this.callBack=()=>{const t=this.getSize();let e=!1;t.width===this.lastSize.width&&t.height===this.lastSize.height&&(e=!0),this.lastSize=t,this.cb&&this.cb(Object.assign(Object.assign({},this.lastSize),{windowSizeNotChange:e}))},this.onResize=()=>{this.callBackDebounce()},this.element=t,this.cb=e,this.lastSize=this.getSize(),i&&(this.resizeTime=Math.max(i,16)),this.callBackDebounce=Rx(this.callBack,this.resizeTime),null===window||void 0===window||window.addEventListener("resize",this.onResize),"ResizeObserver"in window){const t=window.ResizeObserver;this.observer=new t(this.mutationResize),null===(o=this.observer)||void 0===o||o.observe(this.element)}else"MutationObserver"in window&&(this.observer=new MutationObserver(this.mutationResize),this.observer.observe(this.element,{attributes:!0,attributeFilter:["style"]}))}disConnect(){window.removeEventListener("resize",this.onResize),this.observer&&(this.observer.disconnect(),this.observer=void 0)}setSize(t){this.lastSize=t}checkSize(){const t=this.getSize();return t.width!==this.lastSize.width||t.height!==this.lastSize.height}getSize(){return this.element?{width:Math.floor(this.element.clientWidth),height:Math.floor(this.element.clientHeight)}:Object.assign({},this.lastSize)}}(t,i,this.resizeTime);this.reseizeListeners[o]=e}const a={target:t,type:e,listener:i,options:r};return this.listeners[o]=a,o}once(t,e,i){var o=this;if("node"===zw.mode)return-1;for(var n=arguments.length,r=new Array(n>3?n-3:0),s=3;s<n;s++)r[s-3]=arguments[s];const a=this.on(t,e,(function(){o.off(a),i(...arguments)}),...r);return a}off(t){var e;if("node"===zw.mode)return;if(null===t)return;const i=null===(e=this.listeners)||void 0===e?void 0:e[t];i&&(delete this.listeners[t],i.target.removeEventListener&&i.target.removeEventListener(i.type,i.listener,...i.options))}fire(t,e){if("node"!==zw.mode){for(var i=arguments.length,o=new Array(i>2?i-2:0),n=2;n<i;n++)o[n-2]=arguments[n];for(const i in this.listeners){const n=this.listeners[i];n.target===t&&n.type===e&&n.listener.call(n.target,...o)}}}hasListener(t,e){if("node"===zw.mode)return!1;let i=!1;for(const o in this.listeners){const n=this.listeners[o];n.target===t&&n.type===e&&(i=!0)}return i}clear(){if("node"!==zw.mode){for(const t in this.listeners){const e=this.listeners[t];e.target.removeEventListener&&e.target.removeEventListener(e.type,e.listener,...e.options)}for(const t in this.reseizeListeners){const e=this.reseizeListeners[t];null==e||e.disConnect()}this.listeners={}}}release(){"node"!==zw.mode&&(this.clear(),this.listeners={})}};const Mx=(t,e)=>{let i=0,o=t.length-1;for(;i<=o;){const n=Math.floor((i+o)/2);if(t[n]===e)return n;t[n]>e?o=n-1:i=n+1}return o<0?0:o};class Lx{constructor(){this._keys=[],this._vals={},this._sorted=!1}count(){return this._keys.length}values(){return this._vals}valueArr(){return Object.values(this._vals)}adjustOrder(t,e,i){const{_keys:o}=this;if(this._sorted||(o.sort(((t,e)=>t<e?-1:t>e?1:0)),this._sorted=!0),t>e){const n=[];for(let r=Mx(o,t+i-1);r>=0;r--){const s=o[r];if(s>=t)n.push(this.get(s));else if(e<=s&&s<t)this.put(s+i,this.get(s));else if(s<e)break}for(let t=0;t<i;t++)this.put(e+t,n[i-1-t])}const{length:n}=o;if(t<e){const r=[];for(let s=Mx(o,t);s<n;s++){const n=o[s];if(n>=t&&n<t+i)r.push(this.get(n));else if(t+i<=n&&n<=e)this.put(n-i,this.get(n));else if(n>e)break}for(let t=0;t<i;t++)this.put(e+t,r[t])}}exchangeOrder(t,e,i,o,n){const{_keys:r}=this;if(this._sorted||(r.sort(((t,e)=>t<e?-1:t>e?1:0)),this._sorted=!0),t>i){const o=[],s=[];for(let n=Mx(r,i);n<Mx(r,t)+e;n++){const i=r[n];i>=t&&i<t+e?s.push(this.get(i)):o.push(this.get(i))}for(let t=0;t<e;t++)this.put(n+t,s[t]);for(let t=0;t<o.length;t++)this.put(n+e+t,o[t])}else{const s=[],a=[];for(let n=Mx(r,t);n<Mx(r,i)+o;n++){const i=r[n];i>=t&&i<t+e?a.push(this.get(i)):s.push(this.get(i))}for(let t=0;t<e;t++)this.put(n+t,a[t]);for(let e=0;e<s.length;e++)this.put(t+e,s[e])}}del(t){delete this._vals[t];const e=this._keys.indexOf(t);-1!==e&&this._keys.splice(e,1)}put(t,e){t in this._vals||(this._keys.push(t),this._sorted=!1),this._vals[t]=e}get(t){return this._vals[t]}has(t){return ot(this._vals[t])}contain(t){return Object.values(this._vals).indexOf(t)>=0}each(t,e,i){const{_keys:o}=this,{length:n}=o;this._sorted||(o.sort(((t,e)=>t<e?-1:t>e?1:0)),this._sorted=!0);for(let r=Mx(o,t);r<n;r++){const n=o[r];if(t<=n&&n<=e){if(!1===i(this.get(n),n))break}else if(e<n)return}}clear(){this._keys.length=0,this._vals={},this._sorted=!1}getLastIndex(){return this._keys[this._keys.length-1]}delLast(){const t=this.getLastIndex();this.del(t)}delAndReorder(t){if(!this.has(t))return;const e=this.getLastIndex();this.adjustOrder(t+1,t,e-t),this.delLast()}addAndReorder(t,e){if(ot(e)){const i=this.getLastIndex();this.adjustOrder(t,t+1,i-t),this.put(t,e)}}}let Px=class t{constructor(t,e,i,o){this.bounds=new He,this.bounds.set(t,e,t+i,e+o)}static bounds(e,i,o,n){return new t(e,i,Math.round(o-e),Math.round(n-i))}get left(){return this.bounds.x1}set left(t){this.bounds.x1=t}get top(){return this.bounds.y1}set top(t){this.bounds.y1=t}get right(){return this.bounds.x2}set right(t){this.bounds.x2=t}get bottom(){return this.bounds.y2}set bottom(t){this.bounds.y2=t}get width(){return this.bounds.width()}set width(t){this.bounds.x2=this.bounds.x1+t}get height(){return this.bounds.height()}set height(t){this.bounds.y2=this.bounds.y1+t}offsetLeft(t){this.bounds.translate(t,0)}offsetTop(t){this.bounds.translate(0,t)}copy(){return new t(this.left,this.top,this.width,this.height)}contains(t){return this.bounds.encloses(t.bounds)}inPoint(t,e){return this.bounds.contains(t,e)}};var Ex={name:"DARK",underlayBackgroundColor:"transparent",defaultStyle:{color:"#D3D5DA",bgColor:"#373b45",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#444A54",padding:[8,12,8,12],hover:{cellBgColor:"#2F4774"}},headerStyle:{color:"#D3D5DA",bgColor:"#373b45",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#444A54",padding:[8,12,8,12],hover:{cellBgColor:"#2F4774"}},rowHeaderStyle:{},cornerHeaderStyle:{},bodyStyle:{color:"#e5e7ea",bgColor:function(t){const{row:e,table:i}=t;return 1&e-i.frozenRowCount?"#282a2e":"#2d3137"},fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#444A54",padding:[8,12,8,12],hover:{cellBgColor:"#29364D"}},frameStyle:{borderColor:"#d1d5da",borderLineWidth:1,borderLineDash:[],cornerRadius:10,shadowBlur:6,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(00, 24, 47, 0.06)"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:4,startColor:"rgba(00, 24, 47, 0.05)",endColor:"rgba(00, 24, 47, 0)"}},selectionStyle:{cellBgColor:"rgba(255, 255, 255, 0.1)",cellBorderColor:"#4284FF",cellBorderLineWidth:2},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"},functionalIconsStyle:{sort_color:"#FFFFFF",sort_color_opacity:"0.75",sort_color_2:"#416EFF",sort_color_opacity_2:"1",frozen_color:"#FFFFFF",frozen_color_opacity:"0.75",collapse_color:"#FFF",collapse_color_opacity:"0.75",expand_color:"#FFF",expand_color_opacity:"0.75",dragReorder_color:"#FFF",dragReorder_color_opacity:"0.75"}};var Hx={name:"BRIGHT",underlayBackgroundColor:"#FFF",defaultStyle:{color:"#FFF",bgColor:"#5389FF",borderColor:"#5286FA",hover:{cellBgColor:"#2E67E3"}},headerStyle:{color:"#FFF",bgColor:"#5389FF",borderColor:"#A1C1FF",hover:{cellBgColor:"#2E67E3"}},bodyStyle:{color:"#000",bgColor:function(t){const{row:e,table:i}=t;return 1&e-i.frozenRowCount?"#FFF":"#F4F8FF"},borderColor:"#E0EAFE",hover:{cellBgColor:"#E9EFFD"}},frameStyle:{borderColor:"#E1E4E8",borderLineWidth:1,borderLineDash:[],cornerRadius:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"black"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:3,startColor:"#CBDCFE",endColor:"#CBDCFE"}},selectionStyle:{cellBgColor:"rgba(0, 0, 255,0.1)"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}};var Fx={name:"ARCO",underlayBackgroundColor:"#FFF",defaultStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:14,fontFamily:"Arial,sans-serif",fontWeight:600,lineHeight:14,borderColor:"#e1e4e8",padding:[8,12,8,12]},headerStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:14,fontFamily:"Arial,sans-serif",fontWeight:600,lineHeight:14,borderColor:"#e1e4e8",padding:[8,12,8,12],hover:{cellBgColor:"#c8daf6"}},rowHeaderStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#e1e4e8",padding:[8,12,8,12],hover:{cellBgColor:"#c8daf6"}},cornerHeaderStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#e1e4e8",padding:[8,12,8,12],hover:{cellBgColor:"#c8daf6"}},bodyStyle:{padding:[8,12,8,12],color:"#141414",fontSize:14,fontFamily:"Arial,sans-serif",fontWeight:400,textAlign:"left",bgColor:function(t){const{row:e,table:i}=t;return 1&e-i.frozenRowCount?"#fbfbfc":"#FFF"},borderColor:"#e1e4e8",lineHeight:14,hover:{cellBgColor:"#F7F8FA",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},frameStyle:{borderColor:"#d1d5da",borderLineWidth:1,borderLineDash:[],cornerRadius:4,shadowBlur:6,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(00, 24, 47, 0.06)"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:4,startColor:"rgba(00, 24, 47, 0.05)",endColor:"rgba(00, 24, 47, 0)"}},selectionStyle:{cellBgColor:"rgba(0, 0, 255,0.1)",cellBorderLineWidth:2,cellBorderColor:"#3073f2"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}};var Ox={name:"DEFAULT",underlayBackgroundColor:"#FFF",defaultStyle:{borderColor:"#E1E4E8",color:"#000",bgColor:"#ECF1F5"},headerStyle:{fontSize:16,fontWeight:"bold",bgColor:"#ECF1F5",hover:{cellBgColor:"#CCE0FF",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},rowHeaderStyle:{fontSize:16,fontWeight:"bold",bgColor:"#ECF1F5",hover:{cellBgColor:"#CCE0FF",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},cornerHeaderStyle:{fontSize:16,fontWeight:"bold"},bodyStyle:{fontSize:14,bgColor:function(t){const{row:e,table:i}=t;return 1&e-i.frozenRowCount?"#FDFDFD":"#FAF9FB"},hover:{cellBgColor:"#CCE0FF",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},frameStyle:{borderColor:"#E1E4E8",borderLineWidth:1,borderLineDash:[],cornerRadius:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"black"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:3,startColor:"rgba(225, 228, 232, 0.6)",endColor:"rgba(225, 228, 232, 0.6)"}},selectionStyle:{cellBgColor:"rgba(0, 0, 255,0.1)",cellBorderLineWidth:2,cellBorderColor:"#0000ff"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}};var Ix={name:"SIMPLIFY",underlayBackgroundColor:"#FFF",defaultStyle:{borderColor:function(t){const{col:e,table:i}=t,{colCount:o,frozenColCount:n}=i,r="#ccc7c7";return n-1===e||o-1===e?[r,"#f2f2f2","#ccc7c7",null]:[r,null,"#ccc7c7",null]},hover:{cellBorderColor:"#0000FF",cellBgColor:"#D0E0E3"},bgColor:"#FFF"},headerStyle:{color:"rgba(0, 0, 0, 0.87)",borderColor:function(t){const{row:e,table:{frozenRowCount:i}}=t;return i-1===e?["#f2f2f2","#f2f2f2","#ccc7c7","#f2f2f2"]:["#f2f2f2"]}},bodyStyle:{color:"rgba(0, 0, 0, 0.87)"},frameStyle:{borderColor:"#f2f2f2",borderLineWidth:1},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF"},selectionStyle:{cellBorderColor:"#FD5",cellBgColor:"rgba(111, 168, 220, 0.1)"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}};const zx={},Dx="Arial,sans-serif",Wx=[],Nx=/^(https?|ftp|file):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/,Gx="$$indicator$$",jx={type:"line"};function Vx(t){return t||{}}const Ux={visible:!0,position:"auto",padding:8,titleStyle:{fontSize:12,fontWeight:"bold",fill:"#4E5969"},contentStyle:{fontSize:12,fill:"#4E5969"},panel:{visible:!0,fill:"#fff",stroke:"#ffffff",lineWidth:0,cornerRadius:3,shadowBlur:12,shadowOffsetX:0,shadowOffsetY:4,shadowColor:"rgba(0, 0, 0, 0.1)",size:0,space:12}};function $x(t,e,i,o){var n,r,s;return null!==(s=null!==(r=null!==(n=cx(t,...i))&&void 0!==n?n:cx(e,...i))&&void 0!==r?r:o&&cx(t,...o))&&void 0!==s?s:o&&cx(e,...o)}class Xx{constructor(t,e){this._defaultStyle=null,this._header=null,this._cornerHeader=null,this._cornerRightTopCell=null,this._cornerLeftBottomCell=null,this._cornerRightBottomCell=null,this._rightFrozen=null,this._bottomFrozen=null,this._rowHeader=null,this._body=null,this._groupTitle=null,this._scroll=null,this._tooltip=null,this._frameStyle=null,this._columnResize=null,this._dragHeaderSplitLine=null,this._frozenColumnLine=null,this._selectionStyle=null,this._axisStyle=null,this._checkboxStyle=null,this._radioStyle=null,this._switchStyle=null,this._buttonStyle=null,this._textPopTipStyle=null,this._internalIconsStyle=null,this.isPivot=!1,this.name="",this.internalTheme={obj:t,superTheme:e},this.name=$x(t,e,["name"])}getExtendTheme(){return this.internalTheme.obj}clearBodyStyleCache(){this._body=null}get font(){const{obj:t,superTheme:e}=this.internalTheme;return $x(t,e,["font"],["bodyStyle","font"])}get underlayBackgroundColor(){const{obj:t,superTheme:e}=this.internalTheme;return $x(t,e,["underlayBackgroundColor"])}get cellInnerBorder(){var t;const{obj:e,superTheme:i}=this.internalTheme;return null===(t=$x(e,i,["cellInnerBorder"]))||void 0===t||t}get cellBorderClipDirection(){var t;const{obj:e,superTheme:i}=this.internalTheme;return null!==(t=$x(e,i,["cellBorderClipDirection"]))&&void 0!==t?t:"top-left"}get _contentOffset(){var t;const{obj:e,superTheme:i}=this.internalTheme;return null!==(t=$x(e,i,["_contentOffset"]))&&void 0!==t?t:0}get defaultStyle(){const t=this;if(!this._defaultStyle){const{obj:e,superTheme:i}=this.internalTheme,o=Vw({},i.defaultStyle,e.defaultStyle);this._defaultStyle={get fontSize(){var t;return null!==(t=o.fontSize)&&void 0!==t?t:16},get fontFamily(){var t;return null!==(t=o.fontFamily)&&void 0!==t?t:Dx},get fontWeight(){return o.fontWeight},get fontVariant(){return o.fontVariant},get fontStyle(){return o.fontStyle},get bgColor(){var t;return null!==(t=o.bgColor)&&void 0!==t?t:"#FFF"},get color(){var t;return null!==(t=o.color)&&void 0!==t?t:"#000"},get borderColor(){var t;return null!==(t=o.borderColor)&&void 0!==t?t:"#000"},get borderLineWidth(){var t;return null!==(t=o.borderLineWidth)&&void 0!==t?t:1},get borderLineDash(){var t;return null!==(t=o.borderLineDash)&&void 0!==t?t:Wx},get hover(){if(o.hover)return{get cellBgColor(){var t,e;return null!==(e=null===(t=o.hover)||void 0===t?void 0:t.cellBgColor)&&void 0!==e?e:void 0},get inlineColumnBgColor(){var t,e,i,n,r,s;return null!==(s=null!==(e=null===(t=o.hover)||void 0===t?void 0:t.inlineColumnBgColor)&&void 0!==e?e:(null===(i=o.hover)||void 0===i?void 0:i.cellBgColor)&&"string"==typeof(null===(n=o.hover)||void 0===n?void 0:n.cellBgColor)?Yw(null===(r=o.hover)||void 0===r?void 0:r.cellBgColor,.1,!1):void 0)&&void 0!==s?s:void 0},get inlineRowBgColor(){var t,e,i,n,r,s;return null!==(s=null!==(e=null===(t=o.hover)||void 0===t?void 0:t.inlineRowBgColor)&&void 0!==e?e:(null===(i=o.hover)||void 0===i?void 0:i.cellBgColor)&&"string"==typeof(null===(n=o.hover)||void 0===n?void 0:n.cellBgColor)?Yw(null===(r=o.hover)||void 0===r?void 0:r.cellBgColor,.1,!1):void 0)&&void 0!==s?s:void 0}}},get select(){if(o.select)return{get inlineColumnBgColor(){var e,i,n,r,s,a;return null!==(a=null!==(r=null!==(i=null===(e=o.select)||void 0===e?void 0:e.inlineColumnBgColor)&&void 0!==i?i:null===(n=t.selectionStyle)||void 0===n?void 0:n.inlineColumnBgColor)&&void 0!==r?r:(null===(s=t.selectionStyle)||void 0===s?void 0:s.cellBgColor)&&"string"==typeof t.selectionStyle.cellBgColor?Yw(t.selectionStyle.cellBgColor,.1,!1):void 0)&&void 0!==a?a:void 0},get inlineRowBgColor(){var e,i,n,r,s;return null!==(s=null!==(n=null!==(i=null===(e=o.select)||void 0===e?void 0:e.inlineRowBgColor)&&void 0!==i?i:t.selectionStyle.inlineRowBgColor)&&void 0!==n?n:(null===(r=t.selectionStyle)||void 0===r?void 0:r.cellBgColor)&&"string"==typeof t.selectionStyle.cellBgColor?Yw(t.selectionStyle.cellBgColor,.1,!1):void 0)&&void 0!==s?s:void 0}}},get padding(){var t;return null!==(t=o.padding)&&void 0!==t?t:[10,16,10,16]},get textAlign(){var t;return null!==(t=o.textAlign)&&void 0!==t?t:"left"},get textBaseline(){var t;return null!==(t=o.textBaseline)&&void 0!==t?t:"middle"},get textOverflow(){var t;return null!==(t=o.textOverflow)&&void 0!==t?t:"ellipsis"},get lineHeight(){return o.lineHeight},get autoWrapText(){var t;return null!==(t=o.autoWrapText)&&void 0!==t&&t},get lineClamp(){var t;return null!==(t=o.lineClamp)&&void 0!==t?t:"auto"},get linkColor(){var t;return null!==(t=o.linkColor)&&void 0!==t?t:"#3772ff"},get cursor(){var t;return null!==(t=o.cursor)&&void 0!==t?t:"auto"},get marked(){var t;return null!==(t=o.marked)&&void 0!==t&&t},get underline(){var t;return null!==(t=o.underline)&&void 0!==t&&t},get underlineColor(){return o.underlineColor},get underlineDash(){return o.underlineDash},get underlineOffset(){return o.underlineOffset},get lineThrough(){var t;return null!==(t=o.lineThrough)&&void 0!==t&&t},get lineThroughColor(){return o.lineThroughColor},get lineThroughDash(){return o.lineThroughDash}}}return this._defaultStyle}get cornerHeaderStyle(){if(!this._cornerHeader){const{obj:t,superTheme:e}=this.internalTheme,i=Vw({},this.defaultStyle,e.cornerHeaderStyle,t.cornerHeaderStyle);this._cornerHeader=this.getStyle(i)}return this._cornerHeader}get cornerRightTopCellStyle(){if(!this._cornerRightTopCell){const{obj:t,superTheme:e}=this.internalTheme;if(!e.cornerRightTopCellStyle&&!t.cornerRightTopCellStyle)return this._cornerRightTopCell;const i=Vw({},this.defaultStyle,e.cornerRightTopCellStyle,t.cornerRightTopCellStyle);this._cornerRightTopCell=this.getStyle(i)}return this._cornerRightTopCell}get cornerLeftBottomCellStyle(){if(!this._cornerLeftBottomCell){const{obj:t,superTheme:e}=this.internalTheme;if(!e.cornerLeftBottomCellStyle&&!t.cornerLeftBottomCellStyle)return this._cornerLeftBottomCell;const i=Vw({},this.defaultStyle,e.cornerLeftBottomCellStyle,t.cornerLeftBottomCellStyle);this._cornerLeftBottomCell=this.getStyle(i)}return this._cornerLeftBottomCell}get cornerRightBottomCellStyle(){if(!this._cornerRightBottomCell){const{obj:t,superTheme:e}=this.internalTheme;if(!e.cornerRightBottomCellStyle&&!t.cornerRightBottomCellStyle)return this._cornerRightBottomCell;const i=Vw({},this.defaultStyle,e.cornerRightBottomCellStyle,t.cornerRightBottomCellStyle);this._cornerRightBottomCell=this.getStyle(i)}return this._cornerRightBottomCell}get rightFrozenStyle(){if(!this._rightFrozen){const{obj:t,superTheme:e}=this.internalTheme;if(!e.rightFrozenStyle&&!t.rightFrozenStyle)return this._rightFrozen;const i=Vw({},this.defaultStyle,this.rowHeaderStyle,e.rightFrozenStyle,t.rightFrozenStyle);this._rightFrozen=this.getStyle(i)}return this._rightFrozen}get bottomFrozenStyle(){if(!this._bottomFrozen){const{obj:t,superTheme:e}=this.internalTheme;if(!e.bottomFrozenStyle&&!t.bottomFrozenStyle)return this._bottomFrozen;const i=Vw({},this.defaultStyle,this.headerStyle,e.bottomFrozenStyle,t.bottomFrozenStyle);this._bottomFrozen=this.getStyle(i)}return this._bottomFrozen}get rowHeaderStyle(){var t;if(!this._rowHeader){const{obj:e,superTheme:i}=this.internalTheme,o=Vw({},this.defaultStyle,i.rowHeaderStyle,null!==(t=e.rowHeaderStyle)&&void 0!==t?t:this.isPivot?null:e.headerStyle);this._rowHeader=this.getStyle(o)}return this._rowHeader}get headerStyle(){if(!this._header){const{obj:t,superTheme:e}=this.internalTheme,i=Vw({},this.defaultStyle,e.headerStyle,t.headerStyle);this._header=this.getStyle(i)}return this._header}get bodyStyle(){if(!this._body){const{obj:t,superTheme:e}=this.internalTheme,i=Vw({},this.defaultStyle,e.bodyStyle,t.bodyStyle);this._body=this.getStyle(i)}return this._body}get groupTitleStyle(){if(!this._groupTitle){const{obj:t,superTheme:e}=this.internalTheme;if(!e.groupTitleStyle&&!t.groupTitleStyle)return this._groupTitle;const i=Vw({},this.defaultStyle,e.groupTitleStyle,t.groupTitleStyle);this._groupTitle=this.getStyle(i)}return this._groupTitle}get frameStyle(){if(!this._frameStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Vw({},e.frameStyle,t.frameStyle);this._frameStyle={get borderColor(){return i.borderColor},get borderLineWidth(){return i.borderLineWidth},get borderLineDash(){return i.borderLineDash},get innerBorder(){return i.innerBorder},get shadowBlur(){return i.shadowBlur},get shadowColor(){return i.shadowColor},get shadowOffsetX(){return i.shadowOffsetX},get shadowOffsetY(){return i.shadowOffsetY},get cornerRadius(){return i.cornerRadius}}}return this._frameStyle}get scrollStyle(){if(!this._scroll){const{obj:t,superTheme:e}=this.internalTheme,i=Vw({},e.scrollStyle,t.scrollStyle);this._scroll={get scrollSliderColor(){var t;return null!==(t=i.scrollSliderColor)&&void 0!==t?t:"#C0C0C0"},get scrollSliderCornerRadius(){return i.scrollSliderCornerRadius},get scrollRailColor(){return i.scrollRailColor},get visible(){var t;return null!==(t=i.visible)&&void 0!==t?t:"scrolling"},get verticalVisible(){return i.verticalVisible},get horizontalVisible(){return i.horizontalVisible},get width(){var t;return null!==(t=i.width)&&void 0!==t?t:7},get hoverOn(){var t;return null===(t=i.hoverOn)||void 0===t||t},get barToSide(){var t;return null!==(t=i.barToSide)&&void 0!==t&&t},get horizontalPadding(){var t;return null!==(t=i.horizontalPadding)&&void 0!==t?t:0},get verticalPadding(){var t;return null!==(t=i.verticalPadding)&&void 0!==t?t:0}}}return this._scroll}get tooltipStyle(){if(!this._tooltip){const{obj:t,superTheme:e}=this.internalTheme,i=Vw({},e.tooltipStyle,t.tooltipStyle);this._tooltip={get fontFamily(){var t;return null!==(t=i.fontFamily)&&void 0!==t?t:Dx},get fontSize(){var t;return null!==(t=i.fontSize)&&void 0!==t?t:16},get bgColor(){var t;return null!==(t=i.bgColor)&&void 0!==t?t:"#000"},get padding(){var t;return null!==(t=i.padding)&&void 0!==t?t:[6,8]},get color(){var t;return null!==(t=i.color)&&void 0!==t?t:"#FFF"},get maxWidth(){return i.maxWidth},get maxHeight(){return i.maxHeight}}}return this._tooltip}get columnResize(){if(!this._columnResize){const{obj:t,superTheme:e}=this.internalTheme,i=Vw({},e.columnResize,t.columnResize);this._columnResize={get lineColor(){var t;return null!==(t=i.lineColor)&&void 0!==t?t:"#416EFF"},get bgColor(){var t;return null!==(t=i.bgColor)&&void 0!==t?t:"#D9E2FF"},get lineWidth(){var t;return null!==(t=i.lineWidth)&&void 0!==t?t:1},get width(){var t;return null!==(t=i.width)&&void 0!==t?t:i.lineWidth+2},get resizeHotSpotSize(){var t;return null!==(t=i.resizeHotSpotSize)&&void 0!==t?t:16},get labelColor(){var t;return null!==(t=i.labelColor)&&void 0!==t?t:"#FFF"},get labelFontSize(){var t;return null!==(t=i.labelFontSize)&&void 0!==t?t:10},get labelFontFamily(){var t;return null!==(t=i.labelFontFamily)&&void 0!==t?t:"sans-serif"},get labelBackgroundFill(){var t;return null!==(t=i.labelBackgroundFill)&&void 0!==t?t:"#3073F2"},get labelBackgroundCornerRadius(){var t;return null!==(t=i.labelBackgroundCornerRadius)&&void 0!==t?t:5},get labelVisible(){var t;return null===(t=i.labelVisible)||void 0===t||t},get visibleOnHover(){var t;return null!==(t=i.visibleOnHover)&&void 0!==t&&t}}}return this._columnResize}get dragHeaderSplitLine(){if(!this._dragHeaderSplitLine){const{obj:t,superTheme:e}=this.internalTheme,i=Vw({},e.dragHeaderSplitLine,t.dragHeaderSplitLine);this._dragHeaderSplitLine={get lineColor(){var t;return null!==(t=i.lineColor)&&void 0!==t?t:"blue"},get lineWidth(){var t;return null!==(t=i.lineWidth)&&void 0!==t?t:2},get shadowBlockColor(){var t;return null!==(t=i.shadowBlockColor)&&void 0!==t?t:"rgba(204,204,204,0.3)"}}}return this._dragHeaderSplitLine}get frozenColumnLine(){if(!this._frozenColumnLine){const{obj:t,superTheme:e}=this.internalTheme,i=Vw({},e.frozenColumnLine,t.frozenColumnLine);this._frozenColumnLine={get shadow(){if(i.shadow)return{get width(){var t,e;return null!==(e=null===(t=i.shadow)||void 0===t?void 0:t.width)&&void 0!==e?e:24},get startColor(){var t,e;return null!==(e=null===(t=i.shadow)||void 0===t?void 0:t.startColor)&&void 0!==e?e:"rgba(00, 24, 47, 0.06)"},get endColor(){var t,e;return null!==(e=null===(t=i.shadow)||void 0===t?void 0:t.endColor)&&void 0!==e?e:"rgba(00, 24, 47, 0)"}}},get border(){if(i.border)return{get lineColor(){var t,e;return null!==(e=null===(t=i.border)||void 0===t?void 0:t.lineColor)&&void 0!==e?e:"rgba(00, 24, 47, 0.06)"},get bgColor(){var t,e,o,n;return null!==(n=null!==(e=null===(t=i.border)||void 0===t?void 0:t.bgColor)&&void 0!==e?e:null===(o=i.border)||void 0===o?void 0:o.lineColor)&&void 0!==n?n:"rgba(00, 24, 47, 0.06)"},get lineWidth(){var t,e;return null!==(e=null===(t=i.border)||void 0===t?void 0:t.lineWidth)&&void 0!==e?e:4},get width(){var t,e,o,n;return null!==(n=null!==(e=null===(t=i.border)||void 0===t?void 0:t.width)&&void 0!==e?e:null===(o=i.border)||void 0===o?void 0:o.lineWidth)&&void 0!==n?n:4}}}}}return this._frozenColumnLine}get selectionStyle(){if(!this._selectionStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Vw({},e.selectionStyle,t.selectionStyle);this._selectionStyle={get cellBgColor(){var t;return null!==(t=null==i?void 0:i.cellBgColor)&&void 0!==t?t:"rgba(0, 0, 255,0.1)"},get cellBorderColor(){var t;return null!==(t=null==i?void 0:i.cellBorderColor)&&void 0!==t?t:"#3073f2"},get cellBorderLineWidth(){var t;return null!==(t=null==i?void 0:i.cellBorderLineWidth)&&void 0!==t?t:2},get inlineColumnBgColor(){return null==i?void 0:i.inlineColumnBgColor},get inlineRowBgColor(){return null==i?void 0:i.inlineRowBgColor},get selectionFillMode(){var t;return null!==(t=null==i?void 0:i.selectionFillMode)&&void 0!==t?t:"overlay"}}}return this._selectionStyle}get axisStyle(){if(!this._axisStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Vw({},e.axisStyle,t.axisStyle);this._axisStyle=function(t){return{defaultAxisStyle:Vx(t.defaultAxisStyle),leftAxisStyle:Vx(t.leftAxisStyle),rightAxisStyle:Vx(t.rightAxisStyle),topAxisStyle:Vx(t.topAxisStyle),bottomAxisStyle:Vx(t.bottomAxisStyle)}}(i)}return this._axisStyle}get checkboxStyle(){if(!this._checkboxStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Vw({},e.checkboxStyle,t.checkboxStyle);this._checkboxStyle=i}return this._checkboxStyle}get radioStyle(){if(!this._radioStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Vw({},e.radioStyle,t.radioStyle);this._radioStyle=i}return this._radioStyle}get switchStyle(){if(!this._switchStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Vw({},e.switchStyle,t.switchStyle);this._switchStyle=i}return this._switchStyle}get buttonStyle(){if(!this._buttonStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Vw({},e.buttonStyle,t.buttonStyle);this._buttonStyle=i}return this._buttonStyle}get textPopTipStyle(){if(!this._textPopTipStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Vw({},Ux,e.textPopTipStyle,t.textPopTipStyle);this._textPopTipStyle=i}return this._textPopTipStyle}get functionalIconsStyle(){if(!this._internalIconsStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Vw({},e.functionalIconsStyle,t.functionalIconsStyle);this._internalIconsStyle=i}return this._internalIconsStyle}hasProperty(t){const{obj:e,superTheme:i}=this.internalTheme;return Yx(e,t)||Yx(i,t)}extends(t){return new Xx(Vw({},t),Vw(this.internalTheme.superTheme,this.internalTheme.obj))}getStyle(t){const e=this;return{get fontSize(){return t.fontSize},get fontFamily(){return t.fontFamily},get fontWeight(){return t.fontWeight},get fontVariant(){return t.fontVariant},get fontStyle(){return t.fontStyle},get bgColor(){return t.bgColor},get color(){return t.color},get strokeColor(){return t.strokeColor},get borderColor(){return t.borderColor},get borderLineWidth(){return t.borderLineWidth},get borderLineDash(){return t.borderLineDash},get hover(){if(t.hover)return{get cellBgColor(){var e,i;return null!==(i=null===(e=t.hover)||void 0===e?void 0:e.cellBgColor)&&void 0!==i?i:void 0},get inlineColumnBgColor(){var e,i,o,n,r,s;return null!==(s=null!==(i=null===(e=t.hover)||void 0===e?void 0:e.inlineColumnBgColor)&&void 0!==i?i:(null===(o=t.hover)||void 0===o?void 0:o.cellBgColor)&&"string"==typeof(null===(n=t.hover)||void 0===n?void 0:n.cellBgColor)?Yw(null===(r=t.hover)||void 0===r?void 0:r.cellBgColor,.1,!1):void 0)&&void 0!==s?s:void 0},get inlineRowBgColor(){var e,i,o,n,r,s;return null!==(s=null!==(i=null===(e=t.hover)||void 0===e?void 0:e.inlineRowBgColor)&&void 0!==i?i:(null===(o=t.hover)||void 0===o?void 0:o.cellBgColor)&&"string"==typeof(null===(n=t.hover)||void 0===n?void 0:n.cellBgColor)?Yw(null===(r=t.hover)||void 0===r?void 0:r.cellBgColor,.1,!1):void 0)&&void 0!==s?s:void 0}}},get select(){return{get inlineColumnBgColor(){var i,o,n,r,s,a;return null!==(a=null!==(r=null!==(o=null===(i=t.select)||void 0===i?void 0:i.inlineColumnBgColor)&&void 0!==o?o:null===(n=e.selectionStyle)||void 0===n?void 0:n.inlineColumnBgColor)&&void 0!==r?r:(null===(s=e.selectionStyle)||void 0===s?void 0:s.cellBgColor)&&"string"==typeof e.selectionStyle.cellBgColor?Yw(e.selectionStyle.cellBgColor,.1,!1):void 0)&&void 0!==a?a:void 0},get inlineRowBgColor(){var i,o,n,r,s;return null!==(s=null!==(n=null!==(o=null===(i=t.select)||void 0===i?void 0:i.inlineRowBgColor)&&void 0!==o?o:e.selectionStyle.inlineRowBgColor)&&void 0!==n?n:(null===(r=e.selectionStyle)||void 0===r?void 0:r.cellBgColor)&&"string"==typeof e.selectionStyle.cellBgColor?Yw(e.selectionStyle.cellBgColor,.1,!1):void 0)&&void 0!==s?s:void 0},get cellBgColor(){var i,o,n;if("replace"===e.selectionStyle.selectionFillMode)return null!==(n=null!==(o=null===(i=t.select)||void 0===i?void 0:i.cellBgColor)&&void 0!==o?o:e.selectionStyle.cellBgColor)&&void 0!==n?n:void 0}}},get frameStyle(){if(t.frameStyle)return{get borderColor(){var e,i;return null!==(i=null===(e=t.frameStyle)||void 0===e?void 0:e.borderColor)&&void 0!==i?i:void 0},get borderLineWidth(){var e,i;return null!==(i=null===(e=t.frameStyle)||void 0===e?void 0:e.borderLineWidth)&&void 0!==i?i:void 0},get borderLineDash(){var e,i;return null!==(i=null===(e=t.frameStyle)||void 0===e?void 0:e.borderLineDash)&&void 0!==i?i:void 0}}},get padding(){return t.padding},get textAlign(){return t.textAlign},get textBaseline(){return t.textBaseline},get textOverflow(){return t.textOverflow},get lineHeight(){return t.lineHeight},get autoWrapText(){return t.autoWrapText},get lineClamp(){return t.lineClamp},get linkColor(){return t.linkColor},get cursor(){return t.cursor},get textStick(){return t.textStick},get marked(){return t.marked},get underline(){var e;return null!==(e=t.underline)&&void 0!==e&&e},get underlineColor(){return t.underlineColor},get underlineDash(){return t.underlineDash},get underlineOffset(){return t.underlineOffset},get lineThrough(){var e;return null!==(e=t.lineThrough)&&void 0!==e&&e},get lineThroughColor(){return t.lineThroughColor},get lineThroughDash(){return t.lineThroughDash}}}}function Yx(t,e){if(t instanceof Xx)return t.hasProperty(e);let i=t;if(!i)return!1;for(let t=0;t<e.length;t++)if(i=i[e[t]],!i)return!1;return!!i}const Kx=new Xx(Ex,Ex),qx=new Xx(Hx,Hx),Zx=new Xx(Fx,Fx),Jx=new Xx(Ox,Ox),Qx=new Xx(Ix,Ix),t_={DEFAULT:Jx,SIMPLIFY:Qx,ARCO:Zx,DARK:Kx,BRIGHT:qx},e_={TableTheme:Xx};function i_(t){if(!t)return null;if("string"==typeof t){const e=function(t,e){if(t[e])return t[e];const i=e.toLowerCase();if(t[i])return t[i];const o=e.toLowerCase();if(t[o])return t[o];for(const e in t)if(e.toLowerCase()===i)return t[e]}(o_(),t);return e?e instanceof Xx?e:new Xx(e,e):null}return t instanceof Xx?t:new Xx(t,t)}function o_(){return hx(t_,zx)}var n_={DARK:Kx,BRIGHT:qx,ARCO:Zx,DEFAULT:Jx,SIMPLIFY:Qx,theme:e_,of:i_,get:o_},r_=Object.freeze({__proto__:null,ARCO:Zx,BRIGHT:qx,DARK:Kx,DEFAULT:Jx,SIMPLIFY:Qx,TableTheme:Xx,default:n_,get:o_,of:i_,theme:e_});function s_(t,e,i){var o;if(t.internalProps.customMergeCell){const o=t.getCustomMerge(e,i);if(o)return o.range}if(!t.internalProps.enableTreeNodeMerge&&!t.isHeader(e,i)&&!(null===(o=t.getBodyColumnDefine(e,i))||void 0===o?void 0:o.mergeCell))return!1;const n=t.getCellRange(e,i);return!(n.start.col===n.end.col&&n.start.row===n.end.row)&&n}class a_{static registerComponent(t,e){a_._components[t]=e}static getComponent(t){return a_._components[t]}static registerFunction(t,e){a_._functions[t]=e}static getFunction(t){return a_._functions[t]}static registerCellType(t,e){a_._cellTypes[t]=e}static getCellType(t){return a_._cellTypes[t]}}function l_(t,e,i,o,n,r){const s=function(t,e){const i=new Array(e);for(let o=0;o<e;o++)i[o]=t(o);return i}(t,i);s.sort(((t,e)=>o(r(t),r(e),n)));for(let t=0;t<i;t++)e(t,s[t])}a_._components={},a_._functions={},a_._cellTypes={};const h_={SOURCE_LENGTH_UPDATE:"source_length_update",CHANGE_ORDER:"change_order"};function d_(t,e){const i=ux(t);if(gx(i)){const t=i.then((t=>(e(t),t)));return e(t),t}return i}function c_(t,e,i,o,n,r){if(null==t)return;if(gx(t))return t.then((t=>c_(t,e,i,o,n,r)));const s=function(t){if(Cx.isObject(t)){const e=t;if(ot(e.get)&&ot(e.set))return!0}return!1}(e)?e.get:e;if(nt(t)&&s in t)return d_(t[s],r);if("function"==typeof s)return d_(s(t,i,o,n),r);if(Array.isArray(s))return d_(function(t,e){let i,o=t;for(;(i=e.shift())&&(o=o[i],o););return o}(t,[...s]),r);const a=`${s}`.split(".");return a.length<=1?d_(t[s],r):d_(dx(t,((t,e)=>c_(t,e,i,o,n,Sx)),...a),r)}function u_(t,e){if(!t)return e;const i=t[e];return ot(i)?i:e}let g_=class extends xw{static get EVENT_TYPE(){return h_}constructor(t,e,i,o,n,r){var s;super(),this.currentIndexedData=[],this.hierarchyExpandLevel=0,this.hasHierarchyStateExpand=!1,this.beforeChangedRecordsMap=new Map,this.registedAggregators={},this.rowHierarchyType="grid",this.fieldAggregators=[],this.registerAggregators(),this.dataSourceObj=t,this.dataConfig=e,this._get=null==t?void 0:t.get,this.columns=o,this._source=(null==t?void 0:t.records)?this.processRecords(null==t?void 0:t.records):t,this._sourceLength=(null===(s=this._source)||void 0===s?void 0:s.length)||0,this.sortedIndexMap=new Map,this._currentPagerIndexedData=[],this.userPagination=i,this.pagination=i||{totalCount:this._sourceLength,perPageCount:this._sourceLength,currentPage:0},r>=1&&(this.hierarchyExpandLevel=r),this.currentIndexedData=Array.from({length:this._sourceLength},((t,e)=>e)),"tree"===n&&this.initTreeHierarchyState(),this.rowHierarchyType=n,this.updatePagerData()}initTreeHierarchyState(){var t;this.currentIndexedData=Array.from({length:this._sourceLength},((t,e)=>e));let e=this._sourceLength;for(let i=0;i<e;i++){const o=this.currentIndexedData[i],n=this.getOriginalRecord(o),r=null!==(t=n.filteredChildren)&&void 0!==t?t:n.children;if((null==r?void 0:r.length)>0){if(this.hierarchyExpandLevel>1?!n.hierarchyState&&(n.hierarchyState=nw.expand):!n.hierarchyState&&(n.hierarchyState=nw.collapse),this.hasHierarchyStateExpand=!0,n.hierarchyState===nw.collapse)continue;const t=this.initChildrenNodeHierarchy(o,this.hierarchyExpandLevel,2,n);i+=t,e+=t}else!0===n.children&&!n.hierarchyState&&(n.hierarchyState=nw.collapse)}}supplementConfig(t,e,i,o){var n;this.columns=e,this._sourceLength=(null===(n=this._source)||void 0===n?void 0:n.length)||0,this.sortedIndexMap=new Map,this._currentPagerIndexedData=[],this.userPagination=t,this.pagination=t||{totalCount:this._sourceLength,perPageCount:this._sourceLength,currentPage:0},o>=1&&(this.hierarchyExpandLevel=o),this.currentIndexedData=Array.from({length:this._sourceLength},((t,e)=>e)),"tree"===i&&this.initTreeHierarchyState(),this.rowHierarchyType=i,this.updatePagerData()}registerAggregator(t,e){this.registedAggregators[t]=e}registerAggregators(){this.registerAggregator(ew.RECORD,dw),this.registerAggregator(ew.SUM,gw),this.registerAggregator(ew.COUNT,pw),this.registerAggregator(ew.MAX,vw),this.registerAggregator(ew.MIN,bw),this.registerAggregator(ew.AVG,fw),this.registerAggregator(ew.NONE,cw),this.registerAggregator(ew.CUSTOM,uw)}updateColumns(t){this.columns=t}_generateFieldAggragations(){const t=this.columns;this.fieldAggregators=[];const e=t=>{delete t.vtable_aggregator;const e=t.field,i=t.aggregation;if(i)if(Array.isArray(i))for(const o of i){const i=new this.registedAggregators[o.aggregationType]({field:e,formatFun:o.formatFun,isRecord:!0,aggregationFun:o.aggregationFun});this.fieldAggregators.push(i),t.vtable_aggregator||(t.vtable_aggregator=[]),t.vtable_aggregator.push(i)}else{const o=new this.registedAggregators[i.aggregationType]({field:e,formatFun:i.formatFun,isRecord:!0,aggregationFun:i.aggregationFun});this.fieldAggregators.push(o),t.vtable_aggregator=o}},i=t=>{if(t&&0!==t.length)for(const o of t)e(o),o.columns&&i(o.columns)};i(t)}processRecords(t){var e,i,o,n,r,s,a,l;this._generateFieldAggragations();const h=[],d=this.fieldAggregators.length>=1;if((null===(i=null===(e=this.dataConfig)||void 0===e?void 0:e.filterRules)||void 0===i?void 0:i.length)>=1||(null===(o=this.lastFilterRules)||void 0===o?void 0:o.length)>=1||d){for(let e=0,i=t.length;e<i;e++){const i=t[e];(null===(r=null===(n=this.dataConfig)||void 0===n?void 0:n.filterRules)||void 0===r?void 0:r.length)>=1?this.filterRecord(i)&&(h.push(i),"tree"===this.rowHierarchyType&&i.children&&(i.filteredChildren=this.filteredChildren(i.children)),d&&this.processRecord(i)):(null===(s=this.lastFilterRules)||void 0===s?void 0:s.length)>=1?(this.clearFilteredChildren(i),d&&this.processRecord(i)):d&&this.processRecord(i)}if((null===(l=null===(a=this.dataConfig)||void 0===a?void 0:a.filterRules)||void 0===l?void 0:l.length)>=1)return h}return t}filteredChildren(t){const e=[];for(let i=0,o=t.length;i<o;i++){const o=t[i];this.filterRecord(o)&&(e.push(o),o.children&&(o.filteredChildren=this.filteredChildren(o.children)))}return e}processRecord(t){for(let e=0;e<this.fieldAggregators.length;e++)this.fieldAggregators[e].push(t)}initChildrenNodeHierarchy(t,e,i,o){var n,r,s;let a=0;const l=o.filteredChildren?o.filteredChildren.length:null!==(r=null===(n=o.children)||void 0===n?void 0:n.length)&&void 0!==r?r:0;for(let n=0;n<l;n++){(i<=e||o.hierarchyState===nw.expand)&&(a+=1);const r=o.filteredChildren?o.filteredChildren[n]:o.children[n],l=Array.isArray(t)?t.concat(n):[t,n];(i<=e||o.hierarchyState===nw.expand)&&this.currentIndexedData.splice(this.currentIndexedData.indexOf(t)+a,0,l),(r.filteredChildren?r.filteredChildren.length>0:(null===(s=r.children)||void 0===s?void 0:s.length)>0)&&(i<e||r.hierarchyState===nw.expand?(!r.hierarchyState&&(r.hierarchyState=nw.expand),this.hasHierarchyStateExpand=!0):!r.hierarchyState&&(r.hierarchyState=nw.collapse)),r.hierarchyState===nw.expand&&(a+=this.initChildrenNodeHierarchy(l,e,i+1,r)),!0===r.children&&!r.hierarchyState&&(r.hierarchyState=nw.collapse)}return a}updatePagination(t){this.pagination=t||{totalCount:this._sourceLength,perPageCount:this._sourceLength,currentPage:0},this.updatePagerData()}updatePagerData(){const{currentIndexedData:t}=this,{perPageCount:e,currentPage:i}=this.pagination,o=e*(i||0),n=o+e;if(this._currentPagerIndexedData.length=0,t&&t.length>0){let e=-1;for(let i=0;i<t.length;i++)if((Array.isArray(t[i])&&1===t[i].length||!Array.isArray(t[i]))&&e++,e>=o&&e<n)this._currentPagerIndexedData.push(t[i]);else if(e>=n)break}else if(this._sourceLength>0)throw new Error("currentIndexedData should has values!")}getRecordIndexPaths(t){return this._currentPagerIndexedData[t]}get records(){return Array.isArray(this._source)?this._source:[]}get source(){return this._source}get(t){return this.getOriginalRecord(u_(this.currentPagerIndexedData,t))}getRaw(t){return this.getRawRecord(u_(this.currentPagerIndexedData,t))}getIndexKey(t){return u_(this.currentPagerIndexedData,t)}getTableIndex(t){return Array.isArray(t)?"tree"===this.rowHierarchyType?this.currentPagerIndexedData.findIndex((e=>It(e,t))):this.currentPagerIndexedData.findIndex((e=>e===t[0])):this.currentPagerIndexedData.findIndex((e=>e===t))}getField(t,e,i,o,n){return this.getOriginalField(u_(this.currentPagerIndexedData,t),e,i,o,n)}getRawField(t,e,i,o,n){return this.getRawFieldData(u_(this.currentPagerIndexedData,t),e,i,o,n)}hasField(t,e){return this.hasOriginalField(u_(this.currentPagerIndexedData,t),e)}getHierarchyState(t){var e;const i=this.getOriginalRecord(this.currentPagerIndexedData[t]);if(null==i?void 0:i.hierarchyState){const t=i.hierarchyState;if((null===(e=i.children)||void 0===e?void 0:e.length)>0||!0===i.children)return t}return null}toggleHierarchyState(t,e,i){const o=this.currentIndexedData.slice(0),n=this.getIndexKey(t),r=this.getHierarchyState(t),s=this.getOriginalRecord(n);if(this.clearSortedIndexMap(),r===nw.collapse)s.hierarchyState=nw.expand,this.pushChildrenNode(n,nw.expand,s),this.hasHierarchyStateExpand=!0;else if(r===nw.expand){let t=0;const e=(i,o,n)=>{if(!o||o===nw.collapse||o===nw.none)return;const r=n.filteredChildren?n.filteredChildren:n.children;if(r)for(let o=0;o<r.length;o++){t+=1;const n=Array.isArray(i)?i.concat([o]):[i,o];e(n,r[o].hierarchyState,r[o])}};e(n,r,s),this.currentIndexedData.splice(this.currentIndexedData.indexOf(n)+1,t),s.hierarchyState=nw.collapse}this.updatePagerData();const a=[],l=[];if(r===nw.collapse){const e=this.currentIndexedData.length-o.length;for(let i=0;i<e;i++)a.push(t+i+1)}else if(r===nw.expand){const e=o.length-this.currentIndexedData.length;for(let i=0;i<e;i++)l.push(t+i+1)}return{add:a,remove:l}}pushChildrenNode(t,e,i){var o,n;if(!e||e===nw.collapse||e===nw.none)return 0;let r=0;const s=i.filteredChildren?i.filteredChildren:i.children;if(s){const e=Array.from({length:s.length},((t,e)=>e));null===(o=this.lastSortStates)||void 0===o||o.forEach((i=>{"normal"!==i.order&&l_((t=>ot(e[t])?e[t]:e[t]=t),((t,i)=>{e[t]=i}),s.length,i.orderFn,i.order,(e=>this.getOriginalField(Array.isArray(t)?t.concat([e]):[t,e],i.field)))}));for(let i=0;i<e.length;i++){r+=1;const o=Array.isArray(t)?t.concat([e[i]]):[t,e[i]];this.currentIndexedData.splice(this.currentIndexedData.indexOf(t)+r,0,o);const a=this.getOriginalRecord(o);!a.hierarchyState&&(null!==(n=a.filteredChildren)&&void 0!==n?n:a.children)&&(a.hierarchyState=nw.collapse),r+=this.pushChildrenNode(o,a.hierarchyState,s[e[i]])}}return r}changeFieldValue(t,e,i,o,n,r){var s;if(null!==i&&e>=0){const o=this.getIndexKey(e);if(this.cacheBeforeChangedRecord(o,r),"string"==typeof i||"number"==typeof i){const e=null===(s=this.beforeChangedRecordsMap.get(o.toString()))||void 0===s?void 0:s[i],n=this.getOriginalRecord(o);let r=t;"number"==typeof e&&function(t){return/^-?\d+(\.\d+)?$/.test(t)}(t)&&(r=parseFloat(t)),gx(n)?n.then((t=>{t[i]=r})).catch((t=>{})):n?n[i]=r:(this.records[o]={},this.records[o][i]=r)}}}cacheBeforeChangedRecord(t,e){var i;if(!this.beforeChangedRecordsMap.has(t.toString())){const e=this.getOriginalRecord(t);this.beforeChangedRecordsMap.set(t.toString(),null!==(i=St(e,void 0,["vtable_gantt_linkedFrom","vtable_gantt_linkedTo"]))&&void 0!==i?i:{})}}setRecord(t,e){var i,o;let n=!0;if((null===(o=null===(i=this.dataConfig)||void 0===i?void 0:i.filterRules)||void 0===o?void 0:o.length)>=1&&(this.filterRecord(t)?"tree"===this.rowHierarchyType&&t.children&&(t.filteredChildren=this.filteredChildren(t.children)):n=!1),n&&Array.isArray(this.records)){const i=this.getIndexKey(e);Array.isArray(i)||this.records.splice(i,1,t)}}addRecord(t,e){var i;if(Array.isArray(this.records)){this.records.splice(e,0,t),this.adjustBeforeChangedRecordsMap(e,1),this.currentIndexedData.push(this.currentIndexedData.length),this._sourceLength+=1;for(let e=0;e<this.fieldAggregators.length;e++)this.fieldAggregators[e].push(t);if("tree"===this.rowHierarchyType&&this.initTreeHierarchyState(),this.userPagination){this.pagination.totalCount=this._sourceLength;const{perPageCount:t,currentPage:i}=this.pagination;e<t*(i||0)+t&&this.updatePagerData()}else this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength,this.updatePagerData();(null===(i=this.dataSourceObj)||void 0===i?void 0:i.added)&&this.dataSourceObj.added(e,1)}}addRecords(t,e){var i;if(Array.isArray(this.records)){if(Array.isArray(t)){this.records.splice(e,0,...t),this.adjustBeforeChangedRecordsMap(e,t.length);for(let e=0;e<t.length;e++)this.currentIndexedData.push(this.currentIndexedData.length);this._sourceLength+=t.length;for(let e=0;e<this.fieldAggregators.length;e++)for(let i=0;i<t.length;i++)this.fieldAggregators[e].push(t[i])}if(this.userPagination){this.pagination.totalCount=this._sourceLength;const{perPageCount:t,currentPage:i}=this.pagination;e<t*(i||0)+t&&this.updatePagerData()}else this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength,this.updatePagerData();(null===(i=this.dataSourceObj)||void 0===i?void 0:i.added)&&this.dataSourceObj.added(e,t.length)}}addRecordForSorted(t){Array.isArray(this.records)&&(this.beforeChangedRecordsMap.clear(),this.records.push(t),this.currentIndexedData.push(this.currentIndexedData.length),this._sourceLength+=1,this.sortedIndexMap.clear(),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength))}addRecordsForSorted(t){if(Array.isArray(this.records)){if(this.beforeChangedRecordsMap.clear(),Array.isArray(t)){this.records.push(...t);for(let e=0;e<t.length;e++)this.currentIndexedData.push(this.currentIndexedData.length);this._sourceLength+=t.length,this.sortedIndexMap.clear()}this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength)}}adjustBeforeChangedRecordsMap(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"add";for(let o=this.beforeChangedRecordsMap.size-1;o>=t;o--){const t=this.beforeChangedRecordsMap.get(o.toString());this.beforeChangedRecordsMap.delete(o.toString()),this.beforeChangedRecordsMap.set((o+("add"===i?e:-e)).toString(),t)}}deleteRecords(t){var e;if(Array.isArray(this.records)){const i=[],o=t.sort(((t,e)=>e-t));for(let t=0;t<o.length;t++){const e=o[t];if(e>=this._sourceLength||e<0)continue;this.adjustBeforeChangedRecordsMap(e,1,"delete"),i.push(e);const n=this.records[e];for(let t=0;t<this.fieldAggregators.length;t++)this.fieldAggregators[t].deleteRecord(n);this.records.splice(e,1),this.currentIndexedData.pop(),this._sourceLength-=1}return this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength),this.updatePagerData(),(null===(e=this.dataSourceObj)||void 0===e?void 0:e.deleted)&&this.dataSourceObj.deleted(i),i}return[]}deleteRecordsForSorted(t){if(Array.isArray(this.records)){const e=t.sort(((t,e)=>e-t));for(let t=0;t<e.length;t++){const i=e[t];if(i>=this._sourceLength||i<0)continue;const o=this.currentIndexedData[i];this.records.splice(o,1),this._sourceLength-=1}this.sortedIndexMap.clear(),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength),this.beforeChangedRecordsMap.clear()}}updateRecords(t,e){const i=[];for(let o=0;o<e.length;o++){const n=e[o];if(Array.isArray(n))this.beforeChangedRecordsMap.delete(n.toString()),i.push(n),n.slice(0,-1).reduce(((t,e)=>(void 0===t[e]&&(t[e]={}),t[e].children)),this.records)[n[n.length-1]]=t[o];else{if(n>=this._sourceLength||n<0)continue;this.beforeChangedRecordsMap.delete(n.toString()),i.push(n);for(let e=0;e<this.fieldAggregators.length;e++)this.fieldAggregators[e].updateRecord(this.records[n],t[o]);this.records[n]=t[o]}}return this.userPagination&&this.updatePagerData(),i}updateRecordsForSorted(t,e){for(let i=0;i<e.length;i++){const o=e[i];if(o>=this._sourceLength||o<0)continue;const n=this.currentIndexedData[o];if("number"!=typeof n)return;this.beforeChangedRecordsMap.delete(n.toString()),this.records[n]=t[i]}this.sortedIndexMap.clear()}sort(t){t=(Array.isArray(t)?t:[t]).filter((t=>{const e=this.columns.find((e=>e.field===t.field));return!1!==(null==e?void 0:e.sort)&&"normal"!==t.order})),this.lastSortStates=t;let e=t.map((t=>this.sortedIndexMap.get(null==t?void 0:t.field)||{asc:[],desc:[],normal:[]})),i=null;if(e.length>0&&(i=t.reduce(((t,i,o)=>{var n;const r=null===(n=e[o])||void 0===n?void 0:n[i.order];return r&&r.length>0?r:t}),null),i&&i.length>0))return this.currentIndexedData=i,this.updatePagerData(),void this.fireListeners(h_.CHANGE_ORDER,null);const o=Array.from({length:this._sourceLength},((t,e)=>e));if(o.sort(((e,i)=>t.reduce(((t,o)=>0!==t?t:(o.orderFn||("desc"!==o.order?(t,e)=>t===e?0:t>e?1:-1:(t,e)=>t===e?0:t<e?1:-1))(this.getOriginalField(e,o.field),this.getOriginalField(i,o.field),o.order)),0))),this.currentIndexedData=o,this.hierarchyExpandLevel){let t=o.length;for(let e=0;e<t;e++){const i=this.getOriginalRecord(o[e]),n=this.pushChildrenNode(o[e],i.hierarchyState,this.getOriginalRecord(o[e]));t+=n,e+=n}}if(!e.length){e=t.map((()=>({asc:[],desc:[],normal:[]})));for(let i=0;i<t.length;i++)this.sortedIndexMap.set(t[i].field,e[i])}t.forEach(((t,i)=>{e[i][t.order]=o.slice()})),this.updatePagerData(),this.fireListeners(h_.CHANGE_ORDER,null)}setSortedIndexMap(t,e){this.sortedIndexMap.set(t,e)}clearFilteredChildren(t){var e,i;t.filteredChildren=void 0;for(let o=0;o<(null!==(i=null===(e=t.children)||void 0===e?void 0:e.length)&&void 0!==i?i:0);o++)this.clearFilteredChildren(t.children[o])}filterRecord(t){var e,i,o;let n=!0;for(let r=0;r<(null===(e=this.dataConfig.filterRules)||void 0===e?void 0:e.length);r++){const e=null===(i=this.dataConfig)||void 0===i?void 0:i.filterRules[r];if(e.filterKey){const i=t[e.filterKey];if(-1===e.filteredValues.indexOf(i)){n=!1;break}}else if(!(null===(o=e.filterFunc)||void 0===o?void 0:o.call(e,t))){n=!1;break}}return n}updateFilterRulesForSorted(t){var e,i,o;this.lastFilterRules=this.dataConfig.filterRules,this.dataConfig.filterRules=t,this._source=this.processRecords(null!==(i=null===(e=this.dataSourceObj)||void 0===e?void 0:e.records)&&void 0!==i?i:this.dataSourceObj),this._sourceLength=(null===(o=this._source)||void 0===o?void 0:o.length)||0,this.sortedIndexMap.clear(),this.currentIndexedData=Array.from({length:this._sourceLength},((t,e)=>e)),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength)}updateFilterRules(t){var e,i,o;this.lastFilterRules=this.dataConfig.filterRules,this.dataConfig.filterRules=t,this._source=this.processRecords(null!==(i=null===(e=this.dataSourceObj)||void 0===e?void 0:e.records)&&void 0!==i?i:this.dataSourceObj),this._sourceLength=(null===(o=this._source)||void 0===o?void 0:o.length)||0,this.currentIndexedData=Array.from({length:this._sourceLength},((t,e)=>e)),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength,"tree"===this.rowHierarchyType&&this.initTreeHierarchyState()),this.updatePagerData()}clearSortedIndexMap(){this.lastSortStates&&this.lastSortStates.length>0&&this.sortedIndexMap.forEach(((t,e)=>{this.lastSortStates.some((t=>t.field===e))?this.lastSortStates.forEach((e=>{"asc"===e.order?(t.desc=[],t.normal=[]):"desc"===e.order?(t.asc=[],t.normal=[]):(t.asc=[],t.desc=[])})):this.sortedIndexMap.delete(e)}))}get sourceLength(){return this._sourceLength}set sourceLength(t){this._sourceLength!==t&&(this._sourceLength=t,this.fireListeners(h_.SOURCE_LENGTH_UPDATE,this._sourceLength))}get length(){return this.currentPagerIndexedData.length}get dataSource(){return this}get currentPagerIndexedData(){return this._currentPagerIndexedData.length>0?this._currentPagerIndexedData:[]}release(){var t;null===(t=super.release)||void 0===t||t.call(this),this.lastFilterRules=null}clearSortedMap(){this.currentIndexedData&&(this.currentIndexedData.length=0),this.currentIndexedData=null,this.sortedIndexMap.forEach((t=>{t.asc&&(t.asc.length=0),t.desc&&(t.desc.length=0)})),this.sortedIndexMap.clear()}clearCurrentIndexedData(){this.currentIndexedData=null,this.currentPagerIndexedData.length=0}getOriginalRecord(t){let e;return e=this.dataSourceObj.records?Array.isArray(t)?p_(this.records,t):this.records[t]:this._get(t),d_(e,(e=>{this.recordPromiseCallBack(t,e)}))}getRawRecord(t){var e,i;if(null===(e=this.beforeChangedRecordsMap)||void 0===e?void 0:e.has(t.toString()))return null===(i=this.beforeChangedRecordsMap)||void 0===i?void 0:i.get(t.toString());let o;return o=this.dataSourceObj.records?Array.isArray(t)?p_(this.records,t):this.records[t]:this._get(t),d_(o,(e=>{this.recordPromiseCallBack(t,e)}))}getOriginalField(t,e,i,o,n){if(null!==e)return c_(this.getOriginalRecord(t),e,i,o,n,(i=>{this.fieldPromiseCallBack(t,e,i)}))}getRawFieldData(t,e,i,o,n){if(null!==e)return c_(this.getRawRecord(t),e,i,o,n,(i=>{this.fieldPromiseCallBack(t,e,i)}))}hasOriginalField(t,e){if(null===e)return!1;if("function"==typeof e)return!0;const i=this.getOriginalRecord(t);return Boolean(i&&e in i)}fieldPromiseCallBack(t,e,i){}recordPromiseCallBack(t,e){}canChangeOrder(t,e){var i;if(null===(i=this.dataSourceObj)||void 0===i?void 0:i.canChangeOrder)return this.dataSourceObj.canChangeOrder(t,e);if(this.hasHierarchyStateExpand){let i=this.currentPagerIndexedData[t],o=this.currentPagerIndexedData[e];if(i=Array.isArray(i)?[...i]:[i],o=Array.isArray(o)?[...o]:[o],e>t&&o.length>i.length){let t=this.currentPagerIndexedData[e+1];t=Array.isArray(t)?[...t]:[t],t.length<o.length&&o.splice(o.length-1,1)}if(i.length===o.length){for(let t=0;t<=i.length-2;t++)if(i[t]!==o[t])return!1;return!0}return!1}return!0}changeOrder(t,e){var i,o,n;if(null===(i=this.dataSourceObj)||void 0===i?void 0:i.changeOrder)this.dataSourceObj.changeOrder(t,e);else if(!(null===(o=this.lastSortStates)||void 0===o?void 0:o.some((t=>"asc"===t.order||"desc"===t.order)))&&this.canChangeOrder(t,e))if(this.hasHierarchyStateExpand){let i,o,r=this.currentPagerIndexedData[t],s=this.currentPagerIndexedData[e];if(r=Array.isArray(r)?[...r]:[r],s=Array.isArray(s)?[...s]:[s],r.length>1||s.length>1){if(e>t&&s.length>r.length){let t=this.currentPagerIndexedData[e+1];t=Array.isArray(t)?[...t]:[t],t.length<s.length&&s.splice(s.length-1,1)}if(i=r.splice(r.length-1,1)[0],o=s.splice(s.length-1,1)[0],r.length>=1){const t=this.getOriginalRecord(r),e=t.filteredChildren?t.filteredChildren.splice(i,1):t.children.splice(i,1);e.unshift(o,0),Array.prototype.splice.apply(null!==(n=t.filteredChildren)&&void 0!==n?n:t.children,e)}else{const t=this.records.splice(i,1);t.unshift(o,0),Array.prototype.splice.apply(this.records,t)}}else{i=this.currentPagerIndexedData[t],o=this.currentPagerIndexedData[e];const n=this.records.splice(i,1);n.unshift(o,0),Array.prototype.splice.apply(this.records,n)}this.restoreTreeHierarchyState(),this.updatePagerData()}else{const i=this.records.splice(t,1);i.unshift(e,0),Array.prototype.splice.apply(this.records,i)}}restoreTreeHierarchyState(){var t,e;if(this.hierarchyExpandLevel){for(let e=0;e<this._sourceLength;e++){const i=this.getOriginalRecord(e);(null!==(t=i.filteredChildren)&&void 0!==t?t:i.children)&&!i.hierarchyState&&(i.hierarchyState=nw.collapse)}this.currentIndexedData=Array.from({length:this._sourceLength},((t,e)=>e));let i=this._sourceLength;for(let t=0;t<i;t++){const o=this.currentIndexedData[t],n=this.getOriginalRecord(o),r=null!==(e=n.filteredChildren)&&void 0!==e?e:n.children;if((null==r?void 0:r.length)>0&&n.hierarchyState===nw.expand){this.hasHierarchyStateExpand=!0;const e=this.restoreChildrenNodeHierarchy(o,n);t+=e,i+=e}else!0===n.children&&!n.hierarchyState&&(n.hierarchyState=nw.collapse)}}}restoreChildrenNodeHierarchy(t,e){var i,o;let n=0;const r=null!==(i=e.filteredChildren)&&void 0!==i?i:e.children,s=null!==(o=null==r?void 0:r.length)&&void 0!==o?o:0;for(let i=0;i<s;i++){e.hierarchyState===nw.expand&&(n+=1);const o=r[i],s=Array.isArray(t)?t.concat(i):[t,i];e.hierarchyState===nw.expand&&this.currentIndexedData.splice(this.currentIndexedData.indexOf(t)+n,0,s),n+=this.restoreChildrenNodeHierarchy(s,o)}return n}};function p_(t,e){var i;let o=t;for(let t=0;t<e.length;t++){const n=e[t];if(!o[n])return;o=o[n];const r=null!==(i=o.filteredChildren)&&void 0!==i?i:null==o?void 0:o.children;r&&t+1<e.length&&(o=r)}return o}function f_(t,e){return t.sort(((t,i)=>{var o,n;ut(t)&&(t=[t]),ut(i)&&(i=[i]);const r=Math.max(t.length,i.length);for(let s=0;s<r;s++){const r=null!==(o=t[s])&&void 0!==o?o:-1,a=null!==(n=i[s])&&void 0!==n?n:-1;if(r!==a)return 1===e?r-a:a-r}return 0}))}g_.EMPTY=new g_({get(){},length:0});var v_=Array.isArray,b_="object"==typeof K&&K&&K.Object===Object&&K,m_="object"==typeof self&&self&&self.Object===Object&&self,y_=b_||m_||Function("return this")(),C_=y_.Symbol,w_=C_,x_=Object.prototype,__=x_.hasOwnProperty,S_=x_.toString,A_=w_?w_.toStringTag:void 0;var B_=function(t){var e=__.call(t,A_),i=t[A_];try{t[A_]=void 0;var o=!0}catch(t){}var n=S_.call(t);return o&&(e?t[A_]=i:delete t[A_]),n},R_=Object.prototype.toString;var T_=B_,k_=function(t){return R_.call(t)},M_=C_?C_.toStringTag:void 0;var L_=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":M_&&M_ in Object(t)?T_(t):k_(t)};var P_=L_,E_=function(t){return null!=t&&"object"==typeof t};var H_=function(t){return"symbol"==typeof t||E_(t)&&"[object Symbol]"==P_(t)},F_=v_,O_=H_,I_=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,z_=/^\w*$/;var D_=function(t,e){if(F_(t))return!1;var i=typeof t;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=t&&!O_(t))||(z_.test(t)||!I_.test(t)||null!=e&&t in Object(e))};var W_=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},N_=L_,G_=W_;var j_,V_=function(t){if(!G_(t))return!1;var e=N_(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},U_=y_["__core-js_shared__"],$_=(j_=/[^.]+$/.exec(U_&&U_.keys&&U_.keys.IE_PROTO||""))?"Symbol(src)_1."+j_:"";var X_=function(t){return!!$_&&$_ in t},Y_=Function.prototype.toString;var K_=V_,q_=X_,Z_=W_,J_=function(t){if(null!=t){try{return Y_.call(t)}catch(t){}try{return t+""}catch(t){}}return""},Q_=/^\[object .+?Constructor\]$/,tS=Function.prototype,eS=Object.prototype,iS=tS.toString,oS=eS.hasOwnProperty,nS=RegExp("^"+iS.call(oS).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var rS=function(t,e){return null==t?void 0:t[e]},sS=function(t){return!(!Z_(t)||q_(t))&&(K_(t)?nS:Q_).test(J_(t))},aS=rS;var lS=function(t,e){var i=aS(t,e);return sS(i)?i:void 0},hS=lS(Object,"create"),dS=hS;var cS=function(){this.__data__=dS?dS(null):{},this.size=0};var uS=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},gS=hS,pS=Object.prototype.hasOwnProperty;var fS=function(t){var e=this.__data__;if(gS){var i=e[t];return"__lodash_hash_undefined__"===i?void 0:i}return pS.call(e,t)?e[t]:void 0},vS=hS,bS=Object.prototype.hasOwnProperty;var mS=function(t){var e=this.__data__;return vS?void 0!==e[t]:bS.call(e,t)},yS=hS;var CS=function(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=yS&&void 0===e?"__lodash_hash_undefined__":e,this},wS=cS,xS=uS,_S=fS,SS=mS,AS=CS;function BS(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var o=t[e];this.set(o[0],o[1])}}BS.prototype.clear=wS,BS.prototype.delete=xS,BS.prototype.get=_S,BS.prototype.has=SS,BS.prototype.set=AS;var RS=BS;var TS=function(){this.__data__=[],this.size=0};var kS=function(t,e){return t===e||t!=t&&e!=e};var MS=function(t,e){for(var i=t.length;i--;)if(kS(t[i][0],e))return i;return-1},LS=MS,PS=Array.prototype.splice;var ES=function(t){var e=this.__data__,i=LS(e,t);return!(i<0)&&(i==e.length-1?e.pop():PS.call(e,i,1),--this.size,!0)},HS=MS;var FS=function(t){var e=this.__data__,i=HS(e,t);return i<0?void 0:e[i][1]},OS=MS;var IS=function(t){return OS(this.__data__,t)>-1},zS=MS;var DS=function(t,e){var i=this.__data__,o=zS(i,t);return o<0?(++this.size,i.push([t,e])):i[o][1]=e,this},WS=TS,NS=ES,GS=FS,jS=IS,VS=DS;function US(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var o=t[e];this.set(o[0],o[1])}}US.prototype.clear=WS,US.prototype.delete=NS,US.prototype.get=GS,US.prototype.has=jS,US.prototype.set=VS;var $S=US,XS=lS(y_,"Map"),YS=RS,KS=$S,qS=XS;var ZS=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var JS=function(t,e){var i=t.__data__;return ZS(e)?i["string"==typeof e?"string":"hash"]:i.map},QS=JS;var tA=function(t){var e=QS(this,t).delete(t);return this.size-=e?1:0,e},eA=JS;var iA=function(t){return eA(this,t).get(t)},oA=JS;var nA=function(t){return oA(this,t).has(t)},rA=JS;var sA=function(t,e){var i=rA(this,t),o=i.size;return i.set(t,e),this.size+=i.size==o?0:1,this},aA=function(){this.size=0,this.__data__={hash:new YS,map:new(qS||KS),string:new YS}},lA=tA,hA=iA,dA=nA,cA=sA;function uA(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var o=t[e];this.set(o[0],o[1])}}uA.prototype.clear=aA,uA.prototype.delete=lA,uA.prototype.get=hA,uA.prototype.has=dA,uA.prototype.set=cA;var gA=uA;function pA(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var i=function(){var o=arguments,n=e?e.apply(this,o):o[0],r=i.cache;if(r.has(n))return r.get(n);var s=t.apply(this,o);return i.cache=r.set(n,s)||r,s};return i.cache=new(pA.Cache||gA),i}pA.Cache=gA;var fA=pA;var vA=function(t){var e=fA(t,(function(t){return 500===i.size&&i.clear(),t})),i=e.cache;return e},bA=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,mA=/\\(\\)?/g,yA=vA((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(bA,(function(t,i,o,n){e.push(o?n.replace(mA,"$1"):i||t)})),e})),CA=yA;var wA=function(t,e){for(var i=-1,o=null==t?0:t.length,n=Array(o);++i<o;)n[i]=e(t[i],i,t);return n},xA=wA,_A=v_,SA=H_,AA=C_?C_.prototype:void 0,BA=AA?AA.toString:void 0;var RA=function t(e){if("string"==typeof e)return e;if(_A(e))return xA(e,t)+"";if(SA(e))return BA?BA.call(e):"";var i=e+"";return"0"==i&&1/e==-Infinity?"-0":i},TA=RA;var kA=v_,MA=D_,LA=CA,PA=function(t){return null==t?"":TA(t)};var EA=H_;var HA=function(t){if("string"==typeof t||EA(t))return t;var e=t+"";return"0"==e&&1/t==-Infinity?"-0":e},FA=function(t,e){return kA(t)?t:MA(t,e)?[t]:LA(PA(t))},OA=HA;var IA=function(t,e){for(var i=0,o=(e=FA(e,t)).length;null!=t&&i<o;)t=t[OA(e[i++])];return i&&i==o?t:void 0},zA=IA;var DA=function(t,e,i){var o=null==t?void 0:zA(t,e);return void 0===o?i:o},WA=q(DA);class NA extends g_{static get EVENT_TYPE(){return g_.EVENT_TYPE}static ofArray(t,e,i,o,n,r){return new NA({get:e=>t[e],length:t.length,records:t},e,i,o,n,r)}constructor(t,e,i,o,n,r){let s;ht(null==e?void 0:e.groupByRules)&&(n="tree",s=!0),super(t,e,i,o,n,r),this._isGrouped=s,this._recordCache=[],this._fieldCache={}}getOriginalRecord(t){return ut(t)&&this._recordCache&&this._recordCache[t]?this._recordCache[t]:super.getOriginalRecord(t)}getRawRecord(t){var e,i,o,n;let r,s;if(this._isGrouped){if(r=this.getOriginRecordIndexForGroup(t),ot(r)&&(null===(e=this.beforeChangedRecordsMap)||void 0===e?void 0:e.has(r.toString())))return null===(i=this.beforeChangedRecordsMap)||void 0===i?void 0:i.get(r.toString())}else if(null===(o=this.beforeChangedRecordsMap)||void 0===o?void 0:o.has(t.toString()))return null===(n=this.beforeChangedRecordsMap)||void 0===n?void 0:n.get(t.toString());return ut(t)&&this._recordCache&&this._recordCache[t]?this._recordCache[t]:(s=this.dataSourceObj.records?Array.isArray(t)?p_(this.records,t):this.records[t]:this._get(t),d_(s,(e=>{this.recordPromiseCallBack(t,e)})))}getOriginalField(t,e,i,o,n){const r=this._fieldCache&&this._fieldCache[t];if(r){const t=r.get(e);if(t)return t}return super.getOriginalField(t,e,i,o,n)}clearCache(){this._recordCache&&(this._recordCache=[]),this._fieldCache&&(this._fieldCache={})}fieldPromiseCallBack(t,e,i){!function(t,e,i,o){(t[e]||(t[e]=new Map)).set(i,o)}(this._fieldCache,t,e,i)}recordPromiseCallBack(t,e){this._recordCache&&(this._recordCache[t]=e)}get records(){return Array.isArray(this._recordCache)&&this._recordCache.length>0?this._recordCache:super.records}release(){var t;null===(t=super.release)||void 0===t||t.call(this),this._recordCache=null,this._fieldCache=null}_generateFieldAggragations(){var t;if(super._generateFieldAggragations(),ht(null===(t=this.dataConfig)||void 0===t?void 0:t.groupByRules)){const t=this.dataConfig.groupByRules;this.groupAggregator=new this.registedAggregators[ew.CUSTOM]({field:"",aggregationFun:(e,i,o)=>{const n=new Map,r=[];for(let e=0;e<i.length;e++)GA(i[e],r,n,t,0);return r}}),this.fieldAggregators.push(this.groupAggregator)}}processRecords(t){var e;const i=super.processRecords(t);return(null===(e=this.groupAggregator)||void 0===e?void 0:e.value())||i}getGroupLength(){var t,e,i;return null!==(i=null===(e=null===(t=this.dataConfig)||void 0===t?void 0:t.groupByRules)||void 0===e?void 0:e.length)&&void 0!==i?i:0}updateGroup(){var t,e,i;this.clearCache();const o=this.source;this._source=this.processRecords(null!==(e=null===(t=this.dataSourceObj)||void 0===t?void 0:t.records)&&void 0!==e?e:this.dataSourceObj),o&&jA(o,this.source),this.sourceLength=(null===(i=this.source)||void 0===i?void 0:i.length)||0,this.sortedIndexMap.clear(),this.currentIndexedData=Array.from({length:this.sourceLength},((t,e)=>e)),this.userPagination||(this.pagination.perPageCount=this.sourceLength,this.pagination.totalCount=this.sourceLength),this.initTreeHierarchyState(),this.updatePagerData()}getOriginRecordIndexForGroup(t){const e=this.getOriginalRecord(t);if(ot(e)&&!(e.children&&e.children.length>0))for(let t=0;t<this.dataSourceObj.records.length;t++)if(this.dataSourceObj.records[t]===e)return t}addRecordsForGroup(t,e){if(!ht(t)||0===t.length)return;let i=this.getOriginRecordIndexForGroup(e);(void 0===i||i>this.dataSourceObj.records)&&(i=this.dataSourceObj.records.length),this.dataSourceObj.records.splice(i,0,...t),this.adjustBeforeChangedRecordsMap(i,t.length),this.updateGroup()}deleteRecordsForGroup(t){if(!ht(t)||0===t.length)return;const e=f_(t,-1);for(let t=0;t<e.length;t++){const i=e[t];if(ut(i)&&(i>=this.sourceLength||i<0))continue;const o=this.getOriginRecordIndexForGroup(i);this.beforeChangedRecordsMap.delete(o.toString()),this.dataSourceObj.records.splice(o,1),this.sourceLength-=1,this.adjustBeforeChangedRecordsMap(o,1,"delete")}this.updateGroup()}updateRecordsForGroup(t,e){for(let i=0;i<e.length;i++){const o=e[i];if(ut(o)&&(o>=this.sourceLength||o<0))continue;const n=this.getOriginRecordIndexForGroup(o);this.beforeChangedRecordsMap.delete(n.toString()),this.dataSourceObj.records[n]=t[i]}this.updateGroup()}addRecordsForTree(t,e){if(ht(t)&&0!==t.length){if(this.adjustBeforeChangedRecordsMap(e,t.length),ut(e))this.dataSourceObj.records.splice(e,0,...t);else{const i=e.pop(),o=this.getOriginalRecord(e);o.children?o.children.splice(i,0,...t):o.children=t}this.initTreeHierarchyState(),this.updatePagerData()}}deleteRecordsForTree(t){if(!ht(t)||0===t.length)return;const e=f_(t,-1);for(let t=0;t<e.length;t++){const i=e[t];if(!ut(i)||!(i>=this.sourceLength||i<0)){if(this.beforeChangedRecordsMap.delete(i.toString()),ut(i))this.dataSourceObj.records.splice(i,1);else{const t=i.pop();this.getOriginalRecord(i).children.splice(t,1)}this.adjustBeforeChangedRecordsMap(i,1,"delete")}}this.initTreeHierarchyState(),this.updatePagerData()}updateRecordsForTree(t,e){for(let i=0;i<e.length;i++){const o=e[i],n=t[i];if(!ut(o)||!(o>=this.sourceLength||o<0))if(this.beforeChangedRecordsMap.delete(o.toString()),ut(o))this.dataSourceObj.records.splice(o,1,n);else{const t=o.pop();this.getOriginalRecord(o).children.splice(t,1,n)}}this.initTreeHierarchyState(),this.updatePagerData()}adjustBeforeChangedRecordsMap(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"add";if("tree"===this.rowHierarchyType){let o;o=ut(t)?[t]:t;const n=[];this.beforeChangedRecordsMap.forEach(((t,r)=>{var s,a;const l=r.split(","),h=Math.max(l.length,o.length);for(let d=0;d<h;d++){const h=null!==(s=o[d])&&void 0!==s?s:-1,c=null!==(a=Number(l[d]))&&void 0!==a?a:-1;if(h<c||h===c&&d===l.length-1&&d===o.length-1)return l[d]=(c+("add"===i?e:-e)).toString(),void n.push({originKey:r,targetKey:l.toString(),value:t})}})),n.forEach((t=>{let{originKey:e,targetKey:i,value:o}=t;this.beforeChangedRecordsMap.delete(e),this.beforeChangedRecordsMap.set(i,o)}))}else super.adjustBeforeChangedRecordsMap(t,e,i)}cacheBeforeChangedRecord(t,e){var i;const o=this.getOriginalRecord(t);e.options.groupBy&&(t=this.getOriginRecordIndexForGroup(t)),this.beforeChangedRecordsMap.has(t.toString())||this.beforeChangedRecordsMap.set(t.toString(),null!==(i=St(o,void 0,["vtable_gantt_linkedFrom","vtable_gantt_linkedTo"]))&&void 0!==i?i:{})}getGroupSeriesNumber(t){const e=this.dataSource.currentIndexedData[t],i=e.length-1;let o=e.length,n=1;for(;o>i;n++){const e=this.dataSource.currentIndexedData[t-n];o=ut(e)?1:e.length}return n-1}}function GA(t,e,i,o,n){const r=o[n];if(!ot(r))return void e.push(t);const s=WA(t,r);if(void 0!==s){if(i.has(s)){const r=i.get(s);return GA(t,e[r].children,e[r].map,o,n+1)}return i.set(s,e.length),e.push({vtableMerge:!0,vtableMergeName:s,children:[],map:new Map}),GA(t,e[e.length-1].children,e[e.length-1].map,o,n+1)}}function jA(t,e,i,o){if(!i){i=new Map;for(let e=0;e<t.length;e++){const o=t[e];o.vtableMerge&&i.set(o.vtableMergeName,e)}}if(!o){o=new Map;for(let t=0;t<e.length;t++){const i=e[t];i.vtableMerge&&o.set(i.vtableMergeName,t)}}for(let i=0;i<t.length;i++){const n=t[i],r=e[o.get(n.vtableMergeName)];ot(r)&&(r.hierarchyState=t[i].hierarchyState),ht(n.children)&&ht(r.children)&&0!==n.map.size&&0!==r.map.size&&jA(n.children,r.children,n.map,r.map)}}var VA={exports:{}},UA={},$A=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))","?\\s*([-,\\\"\\'\\sa-z]+?)\\s*$"].join(""),"i"),XA=["style","variant","weight","size","lineHeight","family"],YA=/([\.0-9]+)(.*)/,KA=function(t,e,i){var o=t.match(YA);if(o){t=parseFloat(o[1]);var n=o[2].toLowerCase().trim(),r=Math.round(t);switch(r===t&&(t=r),n){case"em":if(null===e)return;return t*e;case"px":return t;case"pt":return t/(72/i);case"pc":return t/(6/i);case"mm":return t*(i/25.4);case"cm":return t*(i/2.54);case"in":return t*i;case"%":if(null===e)return;return e*(t/100)}}},qA={size:KA,lineHeight:KA},ZA={serif:1,"sans-serif":1,cursive:1,fantasy:1,monospace:1},JA=VA.exports=function(t,e,i){var o=t+"-"+(e||"null")+"@"+i;if(i=i||96,void 0!==UA[o])return UA[o];if(e&&(e=JA(e,null,i)),"inherit"===t)return e;var n=$A.exec(t);if(n){n.shift();for(var r={},s=0;s<n.length;s++){var a=XA[s],l=n[s];if(qA[a]&&l){var h=e&&e[a]||null,d=qA[a](l,h,i);l=void 0===d&&"lineHeight"===a&&l?r.size*parseFloat(l):d}if(l&&"normal"!==l){if("inherit"===l){if(!e)return;l=e[a]}l.trim&&(l=l.trim()),r[a]=l}}Object.keys(r).length||(r=null),UA[o]=r;var c=[];r.style&&c.push(r.style),r.variant&&c.push(r.variant),r.weight&&"400"!==r.weight&&"normal"!==r.weight&&c.push(r.weight),c.push(r.size+"px"),r.lineHeight&&(c[c.length-1]+="/"+r.lineHeight+"px");var u=r.family.split(",");return r.family=u.map((function(t){return t=t.trim(),ZA[t.toLowerCase()]&&(t=t.toLowerCase()),t})),c.push(r.family),Object.defineProperty(r,"toString",{value:function(){return c.map((function(t){return Array.isArray(t)?t.map((function(t){return t.indexOf(" ")>-1?'"'+t.replace(/["']/g,"")+'"':t})).join(", "):t})).join(" ")}}),r}UA[o]=null};VA.exports.generics=ZA;var QA=q(VA.exports);function tB(t){var e,i,o,n;if(ut(t)||lt(t)||ht(t)){let e=rr(t);return"number"==typeof e||"string"==typeof e?e=[e,e,e,e]:Array.isArray(e)&&(e=e.slice(0)),e}return t&&(isFinite(t.bottom)||isFinite(t.left)||isFinite(t.right)||isFinite(t.top))?[null!==(e=t.top)&&void 0!==e?e:0,null!==(i=t.right)&&void 0!==i?i:0,null!==(o=t.bottom)&&void 0!==o?o:0,null!==(n=t.left)&&void 0!==n?n:0]:[0,0,0,0]}const eB=0,iB=1,oB=2,nB=3,rB=10,sB=11,aB=12,lB=9,hB=13,dB=10,cB=12,uB=32,gB=37,pB=46,fB=48,vB=57,bB=65,mB=90,yB=97,CB=122;function wB(t){return function(t){return t>=yB&&t<=CB}(t)||function(t){return t>=bB&&t<=mB}(t)}function xB(t){return t===lB||t===dB||t===cB||t===hB||t===uB}function _B(t){return t>=fB&&t<=vB}function SB(t){return t===pB}function AB(t){return wB(t)||t===gB}function BB(t){return new Error(`calc parse error: ${t}`)}const RB={"*":3,"/":3,"+":2,"-":2};function TB(t,e){function i(t){const i=t.pop(),o=t.pop(),n=t.pop();if(!(n&&n.nodeType&&o&&o.type===oB&&i&&i.nodeType))throw BB(e);return{nodeType:sB,left:n,op:o,right:i}}const o=[];for(;t.length;){const n=t.shift();if(n.type===eB&&"("===n.value){let i=0;const n=ox.findIndex(t,(t=>{if(t.type===eB&&"("===t.value)i++;else if(t.type===eB&&")"===t.value){if(!i)return!0;i--}return!1}));if(-1===n)throw BB(e);o.push(TB(t.splice(0,n),e)),t.shift()}else if(n.type===oB){if(o.length>=3){const t=o[o.length-2].value;RB[n.value]<=RB[t]&&o.push(i(o))}o.push(n)}else if(n.type===iB){const{value:t,unit:e}=n;o.push({nodeType:rB,value:t,unit:e})}else n.type===nB&&o.push({nodeType:aB,value:n.value})}for(;o.length>1;)o.push(i(o));return o[0]}function kB(t){return TB(function(t){const e=t.replace(/calc\(/g,"(").trim(),i=[],o=e.length;for(let s=0;s<o;s++){const o=e[s],a=o.charCodeAt(0);if("("===o||")"===o)i.push({value:o,type:eB});else if("*"===o||"/"===o)i.push({value:o,type:oB});else if("+"===o||"-"===o)s=n(o,s+1)-1;else if(_B(a)||SB(a))s=r(o,s+1)-1;else if(!xB(a))throw BB(t)}function n(t,n){if(n<o){const i=e[n],o=i.charCodeAt(0);if(_B(o)||SB(o))return r(t+i,n+1)}return i.push({value:t,type:oB}),n}function r(n,r){let a=r;for(;a<o;a++){const i=e[a],o=i.charCodeAt(0);if(_B(o))n+=i;else{if("."!==i){if(AB(o))return s(n,i,a+1);break}if(n.indexOf(".")>=0)throw BB(t);n+=i}}if("."===n)throw BB(t);return i.push({value:parseFloat(n),type:nB}),a}function s(t,n,r){let s=r;for(;s<o;s++){const t=e[s];if(!AB(t.charCodeAt(0)))break;n+=t}return i.push({value:parseFloat(t),unit:n,type:iB}),s}return i}(t),t)}function MB(t,e){if(t.nodeType===sB){const i=MB(t.left,e),o=MB(t.right,e);switch(t.op.value){case"+":return i+o;case"-":return i-o;case"*":return i*o;case"/":return i/o;default:throw new Error(`calc error. unknown operator: ${t.op.value}`)}}else if(t.nodeType===rB)switch(t.unit){case"%":return t.value*e.full/100;case"px":return t.value;default:throw new Error(`calc error. unknown unit: ${t.unit}`)}else if(t.nodeType===aB)return t.value;throw new Error("calc error.")}function LB(t,e){return MB(kB(t),e)}function PB(t){return!!lt(t)&&!!t.endsWith("%")&&function(t){return!(it(t)||!ut(t)&&+t!=+t)}(t.substring(0,t.length-1))}function EB(t,e){const{dataSourceEventIds:i}=t.internalProps;i&&i.forEach((e=>t.internalProps.handler.off(e))),e(t),t.internalProps.dataSourceEventIds=[t.internalProps.handler.on(t.internalProps.dataSource,g_.EVENT_TYPE.CHANGE_ORDER,(()=>{t.dataSource.hierarchyExpandLevel&&t.refreshRowColCount(),t.render()}))]}function HB(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];EB(t,(()=>{t.internalProps.records=e;const i=t.internalProps.dataSource=NA.ofArray(e,t.internalProps.dataConfig,t.pagination,t.internalProps.columns,t.internalProps.layoutMap.rowHierarchyType,FB(t));t.addReleaseObj(i)}))}function FB(t){var e;return t.options.hierarchyExpandLevel?t.options.hierarchyExpandLevel:t.options.groupBy?1/0:(null===(e=t._hasHierarchyTreeHeader)||void 0===e?void 0:e.call(t))?1:void 0}function OB(t,e){return Math.round((i=e,o=t.internalProps.calcWidthContext,"string"==typeof i?LB(i.trim(),o):i-0));var i,o}function IB(t,e,i,o,n){let r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const s=tB(n("padding",t,i,o,e)),a=n("bgColor",t,i,o,e),l=n("font",t,i,o,e);let h,d,c,u,g;if(l){const{family:t,size:e,weight:i,style:o,variant:n}=function(t){return QA(t)}(l);h=t.join(" "),d=e,c=i,u=o,u=n}else h=n("fontFamily",t,i,o,e),d=n("fontSize",t,i,o,e),c=n("fontWeight",t,i,o,e),u=n("fontStyle",t,i,o,e),g=n("fontVariant",t,i,o,e);const p=n("textAlign",t,i,o,e),f=n("textBaseline",t,i,o,e),v=n("color",t,i,o,e),b=n("strokeColor",t,i,o,e),m=n("lineHeight",t,i,o,e),y=n("underline",t,i,o,e),C=n("underlineDash",t,i,o,e),w=n("underlineOffset",t,i,o,e),x=n("lineThrough",t,i,o,e),_=Math.max(1,Math.floor(d/10)),S=n("textOverflow",t,i,o,e),A=n("borderColor",t,i,o,e),B=n("borderLineWidth",t,i,o,e),R=n("borderLineDash",t,i,o,e),T=n("marked",t,i,o,e),k=n("cursor",t,i,o,e),M=!(s&&a&&l&&p&&f&&v&&S&&A&&B&&R&&"boolean"==typeof y&&"boolean"==typeof x&&"boolean"==typeof T);if(!r)return{hasFunctionPros:M};const L={text:{fontFamily:h,fontSize:d,fontWeight:c,fontStyle:u,fontVariant:g,fill:v,stroke:null!=b&&b,textAlign:p,textBaseline:f,lineHeight:null!=m?m:d,underline:y?_:void 0,underlineDash:C,underlineOffset:w,lineThrough:x?_:void 0,ellipsis:"clip"===S?"":"ellipsis"===S?"...":ot(S)?S:void 0},group:{fill:a,lineDash:R,lineWidth:B,stroke:A,cursor:"auto"===k||"default"===k?void 0:k},_vtable:{padding:s,marked:T}};if(Array.isArray(B)&&(L.group.strokeArrayWidth=tB(B)),Array.isArray(A)){const t=tB(A);L.group.stroke=!t.every((t=>!t))&&t,L.group.strokeArrayColor=tB(A)}return{theme:L,hasFunctionPros:M}}function zB(t,e,i){const o=i.theme.frameStyle.cornerRadius;if(i.theme.cellInnerBorder)if(Array.isArray(o)){if(0===t&&0===e)return[o[0],0,0,0];if(t===i.colCount-1&&0===e)return[0,o[1],0,0];if(0===t&&e===i.rowCount-1)return[0,0,0,o[3]];if(t===i.colCount-1&&e===i.rowCount-1)return[0,0,o[2],0]}else if(o){if(0===t&&0===e)return[o,0,0,0];if(t===i.colCount-1&&0===e)return[0,o,0,0];if(0===t&&e===i.rowCount-1)return[0,0,0,o];if(t===i.colCount-1&&e===i.rowCount-1)return[0,0,o,0]}return 0}function DB(t){for(let e=0;e<t.internalProps.columns.length;e++){const i=t.internalProps.columns[e];if(i.aggregation);else if(t.options.aggregation){let o;if(o="function"==typeof t.options.aggregation?t.options.aggregation({col:e,field:i.field}):t.options.aggregation,o)if(Array.isArray(o)){const t=[];o.forEach((e=>{t.push(Object.assign({showOnTop:!1},e))})),i.aggregation=t}else i.aggregation=Object.assign({showOnTop:!1},o)}}}let WB=class extends ac{constructor(t){super(t),"mouseenter_cell"!==this.attribute.visibleTime&&"click_cell"!==this.attribute.visibleTime||(this.attribute.opacity=0),this.attribute.hoverImage&&(this.attribute.originImage=this.attribute.image),this.attribute.isGif&&this.attribute.gif&&this.loadGif()}loadGif(){this.playing=!1,_r.GetFile(this.attribute.gif+"?role=gif"+`&radom=${Math.random()}`,"arrayBuffer").then((t=>{const e=sb(t),i=tb(e,!0);this.renderGIF(i),this.resources.set(this.attribute.image,{state:"success",data:this.gifCanvas})})).catch((t=>{}))}get backgroundWidth(){var t,e;return null!==(e=null!==(t=this.attribute.backgroundWidth)&&void 0!==t?t:this.attribute.width)&&void 0!==e?e:0}get backgroundHeight(){var t,e;return null!==(e=null!==(t=this.attribute.backgroundHeight)&&void 0!==t?t:this.attribute.height)&&void 0!==e?e:0}renderGIF(t){this.loadedFrames=t,this.frameIndex=0,this.tempCanvas||(this.tempCanvas=document.createElement("canvas"),this.tempCtx=this.tempCanvas.getContext("2d")),this.gifCanvas||(this.gifCanvas=document.createElement("canvas"),this.gifCtx=this.gifCanvas.getContext("2d")),this.gifCanvas.width=t[0].dims.width,this.gifCanvas.height=t[0].dims.height,this.playing=!0,this.lastTime=(new Date).getTime(),this.animate().to({},1e3,"linear").loop(1/0)}renderFrame(t,e,i){const o=this.loadedFrames[this.frameIndex||0];2===o.disposalType&&this.gifCtx.clearRect(0,0,this.gifCanvas.width,this.gifCanvas.height),this.drawPatch(o),this.manipulate(t,e,i);const n=(new Date).getTime()-this.lastTime;o.delay<n&&(this.frameIndex++,this.lastTime=(new Date).getTime()),this.frameIndex>=this.loadedFrames.length&&(this.frameIndex=0)}drawPatch(t){const e=t.dims;this.frameImageData&&e.width===this.frameImageData.width&&e.height===this.frameImageData.height||(this.tempCanvas.width=e.width,this.tempCanvas.height=e.height,this.frameImageData=this.tempCtx.createImageData(e.width,e.height)),this.frameImageData.data.set(t.patch),this.tempCtx.putImageData(this.frameImageData,0,0),this.gifCtx.drawImage(this.tempCanvas,e.left,e.top)}manipulate(t,e,i){t.drawImage(this.gifCanvas,0,0,this.gifCanvas.width,this.gifCanvas.height,e,i,this.attribute.width,this.attribute.height)}setAttribute(t,e,i,o){super.setAttribute(t,e,i,o),"gif"===t&&this.loadGif()}setAttributes(t,e,i){super.setAttributes(t,e,i),t.gif&&this.loadGif()}};class NB extends zh{constructor(t){var e,i,o,n,r;t.fill=null!==(e=t.fill)&&void 0!==e?e:"#00F",t.fontSize=null!==(i=t.fontSize)&&void 0!==i?i:12,t.underline=null!==(o=t.underline)&&void 0!==o?o:1,t.textBaseline=null!==(n=t.textBaseline)&&void 0!==n?n:"top",t.cursor=null!==(r=t.cursor)&&void 0!==r?r:"pointer",super(t)}}function GB(t){return{rootContainer:new vs({}),renderDefault:!0}}class jB{constructor(t){this.table=t,this.customLayoutFuncCache=new Map,this.reactRemoveGraphicCache=new Map,this.reactRemoveAllGraphicCache=new Map,this.headerCustomLayoutFuncCache=new Map,this.headerReactRemoveGraphicCache=new Map,this.headerReactRemoveAllGraphicCache=new Map}hasReactCreateGraphic(t,e){return e?this.headerCustomLayoutFuncCache.has(t):this.customLayoutFuncCache.has(t)}setReactCreateGraphic(t,e,i){i?this.headerCustomLayoutFuncCache.set(t,e):this.customLayoutFuncCache.set(t,e)}setReactRemoveGraphic(t,e,i){i?this.headerReactRemoveGraphicCache.set(t,e):this.reactRemoveGraphicCache.set(t,e)}setReactRemoveAllGraphic(t,e,i){i?this.headerReactRemoveAllGraphicCache.set(t,e):this.reactRemoveAllGraphicCache.set(t,e)}updateCustomCell(t,e){const i=this.table;if("autoWidth"===i.widthMode&&i.scenegraph.recalculateColWidths(),(i.isAutoRowHeight()||"auto"===i.internalProps.defaultRowHeight&&!e||"auto"===i.internalProps.defaultHeaderRowHeight&&e)&&i.scenegraph.recalculateRowHeights(),i.isPivotTable()){const o=function(t,e,i){const o=e.internalProps.rowSeriesNumber?1:0,n=[],r=e.internalProps.layoutMap;if(i){const{headerObjects:e}=r,i=[];for(let o=0;o<e.length;o++){const n=e[o];n&&n.define.componentId===t&&i.push(n.id)}for(let t=0;t<i.length;t++){const e=i[t],o=r.getHeaderCellAdressById(e),s=r.getCellRange(o.col,o.row);n.push(s)}}else{let e;const{columnObjects:i,indicatorsAsCol:s}=r;for(let o=0;o<i.length;o++)if(i[o].define.componentId===t){e=o;break}if(s)for(let t=r.rowHeaderLevelCount+e;t<r.colCount;t+=i.length){const e={start:{col:t+o,row:r.columnHeaderLevelCount},end:{col:t+o,row:r.rowCount-1}};n.push(e)}else for(let t=r.columnHeaderLevelCount+e;t<r.rowCount;t+=i.length){const e={start:{col:r.rowHeaderLevelCount+o,row:t},end:{col:r.colCount-1,row:t}};n.push(e)}}return n}(t,i,e);for(let t=0;t<o.length;t++){const e=o[t];for(let t=e.start.col;t<=e.end.col;t++)for(let o=e.start.row;o<=e.end.row;o++)i.scenegraph.updateCellContent(t,o)}}else{const o=function(t,e,i){const o=e.internalProps.rowSeriesNumber?1:0;if(i){const i=e.internalProps.layoutMap,{headerObjects:o}=e.internalProps.layoutMap;let n;for(let e=0;e<o.length;e++){const i=o[e];if(i.define.componentId===t){n=i.id;break}}const r=i.getHeaderCellAdressById(n);return i.getCellRange(r.col,r.row)}const{columnObjects:n}=e.internalProps.layoutMap;for(let i=0;i<n.length;i++)if(n[i].define.componentId===t)return{start:{col:o+i,row:e.columnHeaderLevelCount},end:{col:o+i,row:e.rowCount-1}};return{start:{col:0,row:0},end:{col:e.colCount-1,row:e.rowCount-1}}}(t,i,e);for(let t=o.start.col;t<=o.end.col;t++)for(let e=o.start.row;e<=o.end.row;e++)i.scenegraph.updateCellContent(t,e)}i.scenegraph.renderSceneGraph()}getCustomLayoutFunc(t,e){var i;if(this.table.isHeader(t,e)){const{componentId:o}=this.table.getHeaderDefine(t,e);return null!==(i=this.headerCustomLayoutFuncCache.get(o))&&void 0!==i?i:GB}const{componentId:o}=this.table.getBodyColumnDefine(t,e);return this.customLayoutFuncCache.get(o)||GB}removeCustomCell(t,e){let i;if(this.table.isHeader(t,e)){const o=this.table.getHeaderDefine(t,e),{componentId:n}=o;i=this.headerReactRemoveGraphicCache.get(n)}else{const o=this.table.getBodyColumnDefine(t,e),{componentId:n}=o;i=this.reactRemoveGraphicCache.get(n)}i&&i(t,e)}clearCache(){this.reactRemoveAllGraphicCache.forEach((t=>{t()})),this.headerReactRemoveAllGraphicCache.forEach((t=>{t()}))}updateAllCustomCell(){this.customLayoutFuncCache.forEach(((t,e)=>{this.updateCustomCell(e)})),this.headerCustomLayoutFuncCache.forEach(((t,e)=>{this.updateCustomCell(e,!0)}))}}function VB(t){const e={abstractPos:{x:t.viewport.x,y:t.viewport.y}},i=UB(t.target);return i&&(e.eventArgs={col:i.col,row:i.row,event:t,targetCell:i,mergeInfo:$B(i),target:t.target}),e}function UB(t){for(;t&&t.parent;){if("cell"===t.role)return t;t=t.parent}return null}function $B(t){if(ot(t.mergeStartCol)&&ot(t.mergeStartRow)&&ot(t.mergeEndCol)&&ot(t.mergeEndRow))return{colStart:t.mergeStartCol,colEnd:t.mergeEndCol,rowStart:t.mergeStartRow,rowEnd:t.mergeEndRow}}const XB=/radio-\d+-\d+-(\d+)/,YB="_custom_",KB="custom-container",qB=YB+"_0";function ZB(t,e,i,o,n,r,s,a,l,h,d){var c,u,g;let p,f,v,b,m=!0,y=!1;if("react-custom-layout"===t&&(t=(null===(c=d.reactCustomLayout)||void 0===c?void 0:c.getCustomLayoutFunc(i,o))||GB),"function"==typeof t){const e=t({col:null!==(u=null==h?void 0:h.start.col)&&void 0!==u?u:i,row:null!==(g=null==h?void 0:h.start.row)&&void 0!==g?g:o,dataValue:d.getCellOriginValue(i,o),value:d.getCellValue(i,o)||"",rect:{left:0,top:0,right:n,bottom:r,width:n,height:r},table:d,originCol:i,originRow:o});if(!e)return{renderDefault:!0};e.rootContainer&&(e.rootContainer=tR(e.rootContainer,d.animationManager.timeline)),e.rootContainer instanceof vs&&(b=e.rootContainer,b.name=KB,b.col=i,b.row=o),m=e.renderDefault,y=e.enableCellPadding}else if("function"==typeof e){const t=e({col:i,row:o,dataValue:d.getCellOriginValue(i,o),value:d.getCellValue(i,o)||"",rect:{left:0,top:0,right:n,bottom:r,width:n,height:r},table:d});t&&(v=t.elements,m=t.renderDefault,p=t.expectedWidth,f=t.expectedHeight)}else e&&(p=e.expectedWidth,f=e.expectedHeight,v=e.elements,m=e.renderDefault);return v&&(b=function(t,e,i,o){const n=new vs({x:0,y:0,width:e,height:i,fill:!1,stroke:!1,pickable:!1});return n.name=KB,function(t,e,i,o){const n=[],r=[0,0,0,0];for(let s=0;s<t.length;s++){const a=t[s],l=Object.assign({},a);for(const t in l)l.hasOwnProperty(t)&&et(l[t])&&(l[t]=l[t](o));const h=l;ot(h.x)&&(h.x=lt(h.x)?JB(h.x,e-r[1]):Number(h.x)),ot(h.y)&&(h.y=lt(h.y)?JB(h.y,i-r[2]):Number(h.y)),"width"in l&&(l.width=lt(l.width)?JB(l.width,e-r[1]):Number(l.width)),"height"in l&&(l.height=lt(l.height)?JB(l.height,i-r[2]):Number(l.height)),"radius"in l&&(l.radius=lt(l.radius)?JB(l.radius,Math.min(e-r[1],i-r[2])):Number(l.radius)),"hover"in l&&(l.hover.x=lt(l.hover.x)?JB(l.hover.x,e-r[1]):Number(l.hover.x),l.hover.y=lt(l.hover.y)?JB(l.hover.y,i-r[2]):Number(l.hover.y),l.hover.width=lt(l.hover.width)?JB(l.hover.width,e-r[1]):Number(l.hover.width),l.hover.height=lt(l.hover.height)?JB(l.hover.height,i-r[2]):Number(l.hover.height),l.hover.x+=0,l.hover.y+=0),h.x=h.x+0,h.y=h.y+0,n.push(l)}return n}(t,e,i,o).forEach((t=>{var e,i,o,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x,_,S,A,B,R,T,k;switch(t.clickable&&(t.pickable=t.clickable),t.type){case"arc":const M=xc({x:t.x,y:t.y,dx:null!==(e=t.dx)&&void 0!==e?e:0,dy:null!==(i=t.dy)&&void 0!==i?i:0,fill:t.fill,stroke:t.stroke,outerRadius:t.radius,startAngle:t.startAngle,endAngle:t.endAngle,pickable:!!t.pickable,cursor:t.cursor});M.name=t.name,n.appendChild(M);break;case"text":if(t.background){const e=null!==(r=null===(o=t.background)||void 0===o?void 0:o.expandX)&&void 0!==r?r:0,i=null!==(a=null===(s=t.background)||void 0===s?void 0:s.expandY)&&void 0!==a?a:0,p=oc({x:t.x-e,y:t.y-i,dx:null!==(l=t.dx)&&void 0!==l?l:0,dy:null!==(h=t.dy)&&void 0!==h?h:0,width:t.width+2*e,height:t.height+2*i,cornerRadius:null!==(c=null===(d=t.background)||void 0===d?void 0:d.cornerRadius)&&void 0!==c?c:0,fill:null!==(g=null===(u=t.background)||void 0===u?void 0:u.fill)&&void 0!==g?g:"#888"});n.appendChild(p)}const L=new zh(Object.assign({pickable:!!t.pickable,fill:null!==(p=t.color)&&void 0!==p?p:t.fill},t));L.name=t.name,n.appendChild(L);break;case"rect":const P=oc({x:t.x,y:t.y,dx:null!==(f=t.dx)&&void 0!==f?f:0,dy:null!==(v=t.dy)&&void 0!==v?v:0,width:t.width,height:t.height,cornerRadius:t.radius,fill:t.fill,stroke:t.stroke,pickable:!!t.pickable,cursor:t.cursor});P.name=t.name,n.appendChild(P);break;case"circle":const E=Fh({x:t.x,y:t.y,dx:null!==(b=t.dx)&&void 0!==b?b:0,dy:null!==(m=t.dy)&&void 0!==m?m:0,radius:t.radius,fill:t.fill,stroke:t.stroke,pickable:!!t.pickable,cursor:t.cursor});E.name=t.name,n.appendChild(E);break;case"icon":const H=new WB({x:t.x,y:t.y,dx:null!==(y=t.dx)&&void 0!==y?y:0,dy:null!==(C=t.dy)&&void 0!==C?C:0,width:t.width,height:t.height,image:t.svg,backgroundWidth:t.hover?null!==(w=t.hover.width)&&void 0!==w?w:t.width:void 0,backgroundHeight:t.hover?null!==(x=t.hover.width)&&void 0!==x?x:t.width:void 0,backgroundColor:t.hover?null!==(_=t.hover.bgColor)&&void 0!==_?_:"rgba(22,44,66,0.2)":void 0,pickable:!!t.pickable,cursor:t.cursor});H.name=t.name,H.role="icon-custom",n.appendChild(H);break;case"image":const F=new WB({x:t.x,y:t.y,dx:null!==(S=t.dx)&&void 0!==S?S:0,dy:null!==(A=t.dy)&&void 0!==A?A:0,width:t.width,height:t.height,image:t.src,backgroundWidth:t.hover?null!==(B=t.hover.width)&&void 0!==B?B:t.width:void 0,backgroundHeight:t.hover?null!==(R=t.hover.width)&&void 0!==R?R:t.width:void 0,backgroundColor:t.hover?null!==(T=t.hover.bgColor)&&void 0!==T?T:"rgba(22,44,66,0.2)":void 0,pickable:!!t.pickable,cursor:t.cursor,shape:t.shape});F.name=t.name,F.role="image-custom",n.appendChild(F);break;case"line":const O=tc({points:t.points,lineWidth:null!==(k=t.lineWidth)&&void 0!==k?k:1,stroke:t.stroke,pickable:!!t.pickable,cursor:t.cursor});O.name=t.name,n.appendChild(O)}})),n}(v,s?p:n,a?f:r,d.getCellValue(i,o))),y&&b.setAttributes({x:l[3],y:l[0],width:n-l[1]-l[3],height:r-l[0]-l[2]}),QB(b,n,r),!h||h.start.col===h.end.col&&h.start.row===h.end.row||eR(b,i,o,0),{elementsGroup:b,renderDefault:m}}function JB(t,e){return t.endsWith("px")?parseInt(t,10):t.endsWith("%")&&e?parseInt(t,10)/100*e:parseInt(t,10)}function QB(t,e,i){t&&t.forEachChildren((t=>{var o,n;t&&(nt(t.attribute.width)&&t.attribute.width.percent&&t.setAttribute("width",Math.max(0,t.attribute.width.percent/100*e+(null!==(o=t.attribute.width.delta)&&void 0!==o?o:0))),t.attribute.width<0&&t.setAttribute("width",0),nt(t.attribute.height)&&t.attribute.height.percent&&t.setAttribute("height",Math.max(0,t.attribute.height.percent/100*i+(null!==(n=t.attribute.height.delta)&&void 0!==n?n:0))),t.attribute.height<0&&t.setAttribute("height",0),"group"===t.type&&QB(t,t.attribute.width,t.attribute.height))}))}function tR(t,e){if(!t||!ot(t.$$typeof)&&!ot(t.vtype))return t;const i=t.type,{attribute:o,children:n,stateProxy:r,animation:s}=t.props,a=i({attribute:o});if(function(t,e){let i=!1;switch(t.type){case"richtext":case"rich/image":break;default:i=!0}i&&Object.keys(e).forEach((i=>{const o=Ng[i];o&&t.on(o,e[i])}))}(a,t.props),r&&(a.stateProxy=r),a.id=o.id,a.name=o.name,ht(n)?n.forEach((t=>{const i=tR(t,e);i&&i.type&&a.add(i)})):n&&a.add(tR(n,e)),ht(s)&&e){const t=a.animate();t.setTimeline(e),s.forEach((e=>{t[e[0]](...e.slice(1))}))}return a}function eR(t,e,i,o,n){t&&(t.name=`${YB}${null!=n?n:""}_${o}`,t.onBeforeAttributeUpdate=iR,"group"===t.type&&t.childrenCount&&t.forEachChildren(((t,r)=>{eR(t,e,i,r,(null!=n?n:"")+"_"+o)})))}function iR(t,e){const i=this;if(i.skipMergeUpdate)return;const o=UB(i);if(!o||!o.stage)return;const n=o.stage.table;i.skipAttributeUpdate=!0;const{mergeStartCol:r,mergeEndCol:s,mergeStartRow:a,mergeEndRow:l}=o;if(ot(r)&&ot(s)&&ot(a)&&ot(l)&&(r!==s||a!==l)){for(let e=r;e<=s;e++)for(let r=a;r<=l;r++){if(e===o.col&&r===o.row)continue;const s=n.scenegraph.highPerformanceGetCell(e,r);if("cell"===s.role){const e=s.getChildByName(i.name,!0);if(!e||e.skipAttributeUpdate)continue;for(const i in t)t[i]!==e.attribute[i]&&"dx"!==i&&"dy"!==i&&e.setAttribute(i,t[i])}}i.skipAttributeUpdate=void 0}}const oR={};class nR{static setIcon(t,e){this.cache.set(t,e)}static getIcon(t){return this.cache.has(t)?this.cache.get(t):null}static hasIcon(t){return this.cache.has(t)}static clear(t){return this.cache.delete(t)}static clearAll(){this.cache=new Map}}let rR,sR,aR,lR,hR,dR,cR,uR,gR,pR,fR,vR,bR,mR,yR,CR,wR,xR,_R,SR,AR,BR,RR,TR;function kR(t){var e,i,o,n,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x,_,S;rR=null!==(e=null==t?void 0:t.sort_color)&&void 0!==e?e:"#282F38",sR=null!==(i=null==t?void 0:t.sort_color_opacity)&&void 0!==i?i:"0.35",aR=null!==(o=null==t?void 0:t.sort_color_2)&&void 0!==o?o:"#416EFF",lR=null!==(n=null==t?void 0:t.sort_color_opacity_2)&&void 0!==n?n:"1",hR=null!==(r=null==t?void 0:t.sort_size)&&void 0!==r?r:16,dR=null!==(s=null==t?void 0:t.sort_size_2)&&void 0!==s?s:22,cR=null!==(a=null==t?void 0:t.frozen_color)&&void 0!==a?a:"#282F38",uR=null!==(l=null==t?void 0:t.frozen_color_opacity)&&void 0!==l?l:"0.35",gR=null!==(h=null==t?void 0:t.frozen_color_opacity)&&void 0!==h?h:"0.2",pR=null!==(d=null==t?void 0:t.frozen_color_2)&&void 0!==d?d:"#416EFF",fR=null!==(c=null==t?void 0:t.frozen_color_opacity_2)&&void 0!==c?c:"1",vR=null!==(u=null==t?void 0:t.frozen_size)&&void 0!==u?u:22,bR=null!==(g=null==t?void 0:t.frozen_size_2)&&void 0!==g?g:22,mR=null!==(p=null==t?void 0:t.collapse_color)&&void 0!==p?p:"#141414",yR=null!==(f=null==t?void 0:t.collapse_color_opacity)&&void 0!==f?f:"0.65",CR=null!==(v=null==t?void 0:t.collapse_size)&&void 0!==v?v:16,wR=null!==(b=null==t?void 0:t.frozen_size_2)&&void 0!==b?b:22,xR=null!==(m=null==t?void 0:t.expand_color)&&void 0!==m?m:"#141414",_R=null!==(y=null==t?void 0:t.expand_color_opacity)&&void 0!==y?y:"0.65",SR=null!==(C=null==t?void 0:t.expand_size)&&void 0!==C?C:16,AR=null!==(w=null==t?void 0:t.expand_size_2)&&void 0!==w?w:22,BR=null!==(x=null==t?void 0:t.dragReorder_color)&&void 0!==x?x:"#666666",RR=null!==(_=null==t?void 0:t.dragReorder_color_opacity)&&void 0!==_?_:"1",TR=null!==(S=null==t?void 0:t.dragReorder_size)&&void 0!==S?S:20}nR.cache=new Map;const MR={get sort_downward(){return{type:"svg",svg:`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M4.6665 9H11.3332L7.99984 13.1667L4.6665 9Z" fill="${aR}"  fill-opacity="${lR}"/><path d="M11.3335 7L4.66683 7L8.00016 2.83333L11.3335 7Z" fill="${rR}" fill-opacity="${sR}"/></svg> `,width:hR,height:hR,funcType:sw.sort,name:"sort_downward",positionType:rw.contentRight,marginLeft:3,hover:{width:dR,height:dR,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get sort_upward(){return{type:"svg",svg:`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.6665 9H11.3332L7.99984 13.1667L4.6665 9Z" fill="${rR}"  fill-opacity="${sR}"/><path d="M11.3335 7L4.66683 7L8.00016 2.83333L11.3335 7Z" fill="${aR}"  fill-opacity="${lR}"/> </svg>`,width:hR,height:hR,funcType:sw.sort,positionType:rw.contentRight,name:"sort_upward",marginLeft:3,hover:{width:dR,height:dR,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get sort_normal(){return{type:"svg",svg:`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.6665 9H11.3332L7.99984 13.1667L4.6665 9Z" fill="${rR}" fill-opacity="${sR}"/><path d="M11.3335 7L4.66683 7L8.00016 2.83333L11.3335 7Z" fill="${rR}" fill-opacity="${sR}"/></svg> `,width:hR,height:hR,funcType:sw.sort,positionType:rw.contentRight,name:"sort_normal",marginLeft:3,hover:{width:dR,height:dR,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get freeze(){return{type:"svg",svg:`<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0)"><path d="M17.1313 8.42047C17.1932 8.48238 17.2423 8.55587 17.2759 8.63676C17.3094 8.71764 17.3266 8.80434 17.3266 8.89189C17.3266 8.97944 17.3094 9.06613 17.2759 9.14702C17.2423 9.2279 17.1932 9.3014 17.1313 9.3633L13.3843 13.1103C13.7007 14.3048 13.5305 15.4443 12.8388 16.2395C12.8104 16.2781 12.7778 16.3136 12.7417 16.3451L12.712 16.3755C12.6501 16.4374 12.5766 16.4865 12.4957 16.52C12.4148 16.5535 12.3281 16.5707 12.2406 16.5707C12.153 16.5707 12.0663 16.5535 11.9854 16.52C11.9046 16.4865 11.8311 16.4374 11.7692 16.3755L9.17633 13.7826L6.05316 16.9058L5.11983 17.0925C5.09291 17.0979 5.06508 17.0965 5.03881 17.0886C5.01254 17.0806 4.98863 17.0663 4.96923 17.0469C4.94982 17.0275 4.9355 17.0036 4.92755 16.9773C4.9196 16.951 4.91827 16.9232 4.92366 16.8963L5.11033 15.963L8.23333 12.8396L5.64066 10.2471C5.57875 10.1852 5.52964 10.1117 5.49614 10.0309C5.46263 9.94997 5.44539 9.86327 5.44539 9.77572C5.44539 9.68817 5.46263 9.60148 5.49614 9.52059C5.52964 9.43971 5.57875 9.36621 5.64066 9.3043C5.65066 9.2943 5.66066 9.2843 5.67099 9.27464C5.70266 9.2383 5.73833 9.20547 5.77766 9.17664C6.57283 8.48564 7.71199 8.31564 8.90599 8.63197L12.6528 4.88497C12.7147 4.82306 12.7882 4.77395 12.8691 4.74045C12.95 4.70694 13.0367 4.6897 13.1242 4.6897C13.2118 4.6897 13.2985 4.70694 13.3794 4.74045C13.4603 4.77395 13.5338 4.82306 13.5957 4.88497L17.1312 8.42047H17.1313ZM15.7172 8.8918L13.1243 6.29914L9.56483 9.8588C9.47574 9.94788 9.36323 10.0099 9.24034 10.0376C9.11746 10.0654 8.98922 10.0578 8.87049 10.0156C8.22783 9.78764 7.63899 9.7553 7.17749 9.89814L12.1182 14.8388C12.261 14.3771 12.2287 13.7885 12.0007 13.146C11.9585 13.0272 11.9509 12.899 11.9787 12.7761C12.0064 12.6532 12.0684 12.5407 12.1575 12.4516L15.7172 8.89164V8.8918Z" fill="${cR}" fill-opacity="${gR}"/></g><defs><clipPath id="clip0"><rect width="22" height="22" fill="white"/></clipPath></defs></svg>`,width:vR,height:vR,name:"freeze",funcType:sw.frozen,positionType:rw.right,marginRight:0,hover:{width:bR,height:bR,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get frozen(){return{type:"svg",svg:`<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.49975 3.66663C8.32294 3.66663 8.15337 3.73686 8.02835 3.86189C7.90332 3.98691 7.83309 4.15648 7.83309 4.33329V9.63246C6.76475 10.2533 6.07942 11.1795 6.00625 12.2308C5.99892 12.2786 5.99692 12.3268 6.00009 12.3741L5.99975 12.4166C5.99975 12.5934 6.06999 12.763 6.19501 12.888C6.32004 13.0131 6.48961 13.0833 6.66642 13.0833H10.3333L10.3331 17.5L10.8611 18.292C10.8763 18.3148 10.8969 18.3335 10.9211 18.3464C10.9453 18.3594 10.9723 18.3662 10.9998 18.3662C11.0272 18.3662 11.0542 18.3594 11.0784 18.3464C11.1026 18.3335 11.1232 18.3148 11.1384 18.292L11.6664 17.5L11.6666 13.0833H15.3331C15.5099 13.0833 15.6795 13.0131 15.8045 12.888C15.9295 12.763 15.9998 12.5934 15.9998 12.4166C15.9998 12.4025 15.9998 12.3883 15.9994 12.3741C16.0028 12.3263 16.0008 12.2776 15.9933 12.2295C15.9196 11.1786 15.2343 10.2528 14.1664 9.63229V4.33329C14.1664 4.15648 14.0962 3.98691 13.9712 3.86189C13.8461 3.73686 13.6766 3.66663 13.4998 3.66663H8.49975Z" fill="${cR}" fill-opacity="${uR}"/></svg>`,width:vR,height:vR,name:"frozen",funcType:sw.frozen,positionType:rw.right,marginRight:0,hover:{width:bR,height:bR,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get frozenCurrent(){return{type:"svg",svg:`<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.49975 3.66663C8.32294 3.66663 8.15337 3.73686 8.02835 3.86189C7.90332 3.98691 7.83309 4.15648 7.83309 4.33329V9.63246C6.76475 10.2533 6.07942 11.1795 6.00625 12.2308C5.99892 12.2786 5.99692 12.3268 6.00009 12.3741L5.99975 12.4166C5.99975 12.5934 6.06999 12.763 6.19501 12.888C6.32004 13.0131 6.48961 13.0833 6.66642 13.0833H10.3333L10.3331 17.5L10.8611 18.292C10.8763 18.3148 10.8969 18.3335 10.9211 18.3464C10.9453 18.3594 10.9723 18.3662 10.9998 18.3662C11.0272 18.3662 11.0542 18.3594 11.0784 18.3464C11.1026 18.3335 11.1232 18.3148 11.1384 18.292L11.6664 17.5L11.6666 13.0833H15.3331C15.5099 13.0833 15.6795 13.0131 15.8045 12.888C15.9295 12.763 15.9998 12.5934 15.9998 12.4166C15.9998 12.4025 15.9998 12.3883 15.9994 12.3741C16.0028 12.3263 16.0008 12.2776 15.9933 12.2295C15.9196 11.1786 15.2343 10.2528 14.1664 9.63229V4.33329C14.1664 4.15648 14.0962 3.98691 13.9712 3.86189C13.8461 3.73686 13.6766 3.66663 13.4998 3.66663H8.49975Z"  fill="${pR}" fill-opacity="${fR}"/></svg>`,width:vR,height:vR,funcType:sw.frozen,positionType:rw.right,name:"frozenCurrent",marginRight:0,hover:{width:bR,height:bR,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get dropdownIcon(){return{type:"svg",svg:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g><rect x="2" y="1" width="20" height="20" rx="10" fill="white"/><rect x="2.5" y="1.5" width="19" height="19" rx="9.5" stroke="#959DA5"/></g><path d="M14.9492 9.39531C15.0086 9.31911 15.0165 9.21887 14.9698 9.1356C14.923 9.05234 14.8294 9 14.7273 9L9.27273 9C9.17057 9 9.07697 9.05234 9.03023 9.1356C8.98348 9.21887 8.99142 9.31911 9.0508 9.39531L11.7781 12.8953C11.8293 12.961 11.9119 13 12 13C12.0881 13 12.1707 12.961 12.2219 12.8953L14.9492 9.39531Z" fill="#4F5965"/></svg>',width:24,height:24,funcType:sw.dropDown,positionType:rw.absoluteRight,name:"dropdownIcon",marginRight:0,hover:{width:24,height:24,bgColor:"rgba(101, 117, 168, 0.1)",image:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g><rect x="2" y="1" width="20" height="20" rx="10" fill="#1E54C9"/><rect x="2.5" y="1.5" width="19" height="19" rx="9.5" stroke="#141414" stroke-opacity="0.2"/></g><path d="M14.9492 9.39531C15.0086 9.31911 15.0165 9.21887 14.9698 9.1356C14.923 9.05234 14.8294 9 14.7273 9L9.27273 9C9.17057 9 9.07697 9.05234 9.03023 9.1356C8.98348 9.21887 8.99142 9.31911 9.0508 9.39531L11.7781 12.8953C11.8293 12.961 11.9119 13 12 13C12.0881 13 12.1707 12.961 12.2219 12.8953L14.9492 9.39531Z" fill="white"/></svg>'},cursor:"pointer",visibleTime:"mouseenter_cell"}},get play(){return{type:"svg",svg:'<svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="48" height="48" fill="white" fill-opacity="0.01" /><path d="M24 44C35.0457 44 44 35.0457 44 24C44 12.9543 35.0457 4 24 4C12.9543 4 4 12.9543 4 24C4 35.0457 12.9543 44 24 44Z" fill="none" stroke="#686a6e" stroke-width="4" stroke-linejoin="round" stroke-opacity="0.7" /><path d="M20 24V17.0718L26 20.5359L32 24L26 27.4641L20 30.9282V24Z" fill="none" stroke="#686a6e" stroke-width="4" stroke-linejoin="round" stroke-opacity="0.7" /></svg>',width:24,height:24,funcType:sw.play,positionType:rw.right,name:"play",marginRight:0,hover:{width:24,height:24,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get damage_pic(){return{type:"svg",svg:'<svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 10V38C5 39.1046 5.89543 40 7 40H14H18L15 29L22 27L21 20L29 16L27 13L30 8H7C5.89543 8 5 8.89543 5 10Z" fill="none" stroke="#333" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M43 38V10C43 8.89543 42.1046 8 41 8H38L34 14L37 19L28 23L29 31L22 33L24 40H41C42.1046 40 43 39.1046 43 38Z" fill="none" stroke="#333" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path fill-rule="evenodd" clip-rule="evenodd" d="M14.5 18C15.3284 18 16 17.3284 16 16.5C16 15.6716 15.3284 15 14.5 15C13.6716 15 13 15.6716 13 16.5C13 17.3284 13.6716 18 14.5 18Z" fill="none" stroke="#333" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/></svg>',width:24,height:24,funcType:sw.damagePic,positionType:rw.left,name:"damage_pic",marginRight:0,hover:{width:24,height:24,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get loading_pic(){return{type:"svg",svg:'<svg viewBox="0 0 400 300" fill="none" xmlns="http://www.w3.org/2000/svg"><mask id="a" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="50" y="65" width="301" height="170"><path d="M350.3 65H50v169.8h300.3V65Z" fill="#fff"/></mask><g mask="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M58.3 233.2h32.8v-36.8H58.3v36.8Z" fill="#C7DEFF"/><path d="M91.1 224.5v8.8H58.3M82.4 196.2H58.3" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M305.4 182.5s-2.7 12.6 0 17.4c2.7 4.8 8.3 6.7 12.4 4.4 4.2-2.4 5.3-8.1 2.6-12.9-2.7-4.8-15-8.9-15-8.9ZM336 204.7c4.3 2 9.7-.4 12-5.4 2.3-5-1.5-17.3-1.5-17.3s-11.8 5.1-14.1 10.1c-2.3 5-.7 10.6 3.6 12.6Z" fill="#00E4E5"/><path fill-rule="evenodd" clip-rule="evenodd" d="M326.7 174s-10 11.8-10 18.6c0 6.7 4.5 12.2 10 12.2s10-5.5 10-12.3c0-6.8-10-18.5-10-18.5Z" fill="#00E4E5"/><path d="M332.3 181.5c2.3 3.6 4.4 7.8 4.4 10.9M316.7 192.5c0-3.1 2.1-7.2 4.3-10.8" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M343.1 227.3v-9.7h-34v9.7c0 3.7 3 6.6 6.6 6.6h20.9c3.6 0 6.5-2.9 6.5-6.6Z" fill="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M350.4 220.8V198H302v22.8c0 5.9 4.8 10.7 10.7 10.7h26.9c5.9 0 10.7-4.8 10.8-10.7Z" fill="#C7DEFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M331.7 74.2H117.8L87.4 203h213.8l30.5-128.8Z" fill="#fff"/><path fill-rule="evenodd" clip-rule="evenodd" d="M337 74.2h-6.2l-30.6 129.2h6.2L337 74.2Z" fill="#fff"/><path fill-rule="evenodd" clip-rule="evenodd" d="M303.8 203.5h2.4l30.7-129.3h-1.8l-31.3 129.3Z" fill="#C7DEFF"/><path d="m337 74.2-30.6 129.2h-5.9" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M229.9 202.1h-47.6l2 9.6h47.3l-1.7-9.6Z" fill="#C7DEFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M94.7 172.6 87.4 203h213.1l7.8-30.4H94.7Z" fill="#006EFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M94.7 172.6 87.4 203h213.1l7.8-30.4H94.7Z" fill="#006EFF"/><path d="M138.5 74.2h193.2l-23.4 98.6M94.5 172.7l11-46.3M104.8 155.4l-2.3 11.5h6.7M316 112.1l1.1-4.5" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M148.3 138.1h97V119h-97v19.1Z" fill="#00E4E5"/><path d="M303.1 80.6h20.3l-4.6 19.6M228.3 234.3c3.6 0 6.3-3.2 5.7-6.8l-4.1-24.1" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M226.2 229.5h-68.9v1.2c0 2 1.6 3.7 3.7 3.7h60.1c2.8 0 5-2.2 5.1-4.9Z" fill="#C7DEFF"/><path d="M180.699 226.8h-19.9c-2.8 0-4.6 3-3.3 5.5m0 0c.6 1.2 1.9 2 3.3 2h57.8M175.9 203.4l3.6 17.6M241.2 234.3h65.1M104.6 234.3h41.3" stroke="#071F4D"/><path d="M206.2 234.3h14.9c3.1 0 5.5-2.8 5-5.9l-4.3-24.9M160.7 226.8h46M62.2 226.1h-9.5c-1.2 0-2.2-1-2.2-2.2v-18.3c0-1.2 1-2.2 2.2-2.2h9.5" stroke="#071F4D"/><path d="M53.4 171.7H68c2.1 0 3.7 1.7 3.7 3.7v16.1M79.1 192v-21.8c0-2.5 2-4.6 4.6-4.6h2.2c2.5 0 4.5-2 4.5-4.5m0 0c0-2.5-2-4.5-4.5-4.5H56.1c-2.4 0-4.3-1.9-4.3-4.3V148M71.2 165.2h-18M64 181.7v10.1" stroke="#C7DEFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M85.7 120H124c4.3 0 7.7-3.5 7.7-7.7V65.5H94.2c-4.7 0-8.5 4.9-8.5 11V120Z" fill="#C7DEFF"/><path d="M85.7 110.7V73c0-4.1 3.4-7.5 7.5-7.5h38.5M146.2 73.8v-2.5c0-3.2-2-5.8-5.8-5.8-2.8 0-6 1.1-6 5.8v42.4c0 4.7-3.8 8.5-8.5 8.5h-15.6" stroke="#071F4D"/><path d="M119.7 122.3H87c-6.1 0-11.1-5-11.1-11.1m0 0h39M126.1 122.3c-6.1 0-11.1-5-11.1-11.1" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M85.4 122.1h37.2c-6.5-1.8-8-10.5-8-10.5H76.2c.6 8.8 9.2 10.5 9.2 10.5Z" fill="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M95.8 102.9h4.8V83.6h-4.8v19.3ZM106.6 102.9h4.8V77.6h-4.8v25.3ZM117.3 102.9h4.8V89.1h-4.8v13.8Z" fill="#fff"/><path d="M273.2 195.9h16.9M261.2 195.9h5" stroke="#fff"/><path d="M62.4 201.9v2.9M62.4 224.5v2.9" stroke="#071F4D"/><path d="m153.6 138.1 9.7-19.1M168.8 138.1l9.7-19.1M184.1 138.1l9.7-19.1M199.4 138.1l9.7-19.1M214.6 138.1l9.8-19.1M229.9 138.1l9.7-19.1" stroke="#fff"/><path d="M148.3 138.1h121.6V119H148.3v19.1Z" stroke="#071F4D"/></g></svg>',width:400,height:300,name:"loading_pic",positionType:rw.left}},get expand(){return{type:"svg",svg:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">\n      <path d="M4.64988 6.81235C4.38797 6.48497 4.62106 6 5.04031 6L10.9597 6C11.3789 6 11.612 6.48497 11.3501 6.81235L8.39043 10.512C8.19027 10.7622 7.80973 10.7622 7.60957 10.512L4.64988 6.81235Z" fill="${xR}" fill-opacity="${_R}"/>\n      </svg>`,width:SR,height:SR,funcType:sw.expand,name:"expand",positionType:rw.contentLeft,marginLeft:0,marginRight:4,hover:{width:AR,height:AR,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get collapse(){return{type:"svg",svg:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">\n      <path d="M5.81235 11.3501C5.48497 11.612 5 11.3789 5 10.9597L5 5.04031C5 4.62106 5.48497 4.38797 5.81235 4.64988L9.51196 7.60957C9.76216 7.80973 9.76216 8.19027 9.51196 8.39044L5.81235 11.3501Z"  fill="${mR}" fill-opacity="${yR}"/>\n      </svg>`,width:CR,height:CR,funcType:sw.collapse,name:"collapse",positionType:rw.contentLeft,marginLeft:0,marginRight:4,hover:{width:wR,height:wR,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get drillDown(){return{name:"drillDown",type:"svg",positionType:rw.absolute,funcType:sw.drillDown,svg:'<svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><rect x="0" y="0" width="1024" height="1024" rx="20%" ry="20%" fill="#ffffff" /><path  d="M810.666667 85.333333c70.688 0 128 57.312 128 128v597.333334c0 70.688-57.312 128-128 128H213.333333c-70.688 0-128-57.312-128-128V213.333333c0-70.688 57.312-128 128-128h597.333334z m0 85.333334H213.333333a42.666667 42.666667 0 0 0-42.613333 40.533333L170.666667 213.333333v597.333334a42.666667 42.666667 0 0 0 40.533333 42.613333L213.333333 853.333333h597.333334a42.666667 42.666667 0 0 0 42.613333-40.533333L853.333333 810.666667V213.333333a42.666667 42.666667 0 0 0-40.533333-42.613333L810.666667 170.666667zM549.333333 288a5.333333 5.333333 0 0 1 5.333334 5.333333V469.333333h176a5.333333 5.333333 0 0 1 5.333333 5.333334v74.666666a5.333333 5.333333 0 0 1-5.333333 5.333334H554.666667v176a5.333333 5.333333 0 0 1-5.333334 5.333333h-74.666666a5.333333 5.333333 0 0 1-5.333334-5.333333V554.666667H293.333333a5.333333 5.333333 0 0 1-5.333333-5.333334v-74.666666a5.333333 5.333333 0 0 1 5.333333-5.333334H469.333333V293.333333a5.333333 5.333333 0 0 1 5.333334-5.333333h74.666666z"></path></svg>',width:13,height:13,cursor:"pointer"}},get drillUp(){return{name:"drillUp",type:"svg",positionType:rw.absolute,funcType:sw.drillUp,svg:'<svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><rect x="0" y="0" width="1024" height="1024" rx="20%" ry="20%" fill="#ffffff" /><path d="M810.666667 85.333333c70.688 0 128 57.312 128 128v597.333334c0 70.688-57.312 128-128 128H213.333333c-70.688 0-128-57.312-128-128V213.333333c0-70.688 57.312-128 128-128h597.333334z m0 85.333334H213.333333a42.666667 42.666667 0 0 0-42.613333 40.533333L170.666667 213.333333v597.333334a42.666667 42.666667 0 0 0 40.533333 42.613333L213.333333 853.333333h597.333334a42.666667 42.666667 0 0 0 42.613333-40.533333L853.333333 810.666667V213.333333a42.666667 42.666667 0 0 0-40.533333-42.613333L810.666667 170.666667zM693.333333 469.333333a42.666667 42.666667 0 1 1 0 85.333334H330.666667a42.666667 42.666667 0 1 1 0-85.333334h362.666666z"></path></svg>',width:13,height:13,cursor:"pointer"}},get dragReorder(){return{type:"svg",svg:`<svg t="1710129136961" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5166" width="200" height="200"><path d="M362.666667 192m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${BR}"  fill-opacity="${RR}" p-id="5167"></path><path d="M661.333333 192m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${BR}"  fill-opacity="${RR}" p-id="5168"></path><path d="M362.666667 512m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${BR}"  fill-opacity="${RR}" p-id="5169"></path><path d="M661.333333 512m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${BR}"  fill-opacity="${RR}" p-id="5170"></path><path d="M362.666667 832m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${BR}"  fill-opacity="${RR}" p-id="5171"></path><path d="M661.333333 832m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${BR}"  fill-opacity="${RR}" p-id="5172"></path></svg>`,width:TR,height:TR,funcType:sw.dragReorder,positionType:rw.left,name:"dragReorder",marginLeft:-10,marginRight:10,cursor:"grab"}}};function LR(){return hx(MR,oR)}let PR=class extends vs{clear(){this.removeAllChild()}getChildByName(t,e){let i=null;return this.forEachChildren((e=>e.name===t&&(i=e,!0))),e&&this.forEachChildren((e=>{if(e.getChildByName){const o=e.getChildByName(t,!0);if(o)return i=o,!0}return!1})),i}get width(){var t;let e=this.AABBBounds.width();return e!==1/0&&e!==-1/0||(e=0),Math.max(e,null!==(t=this.attribute.width)&&void 0!==t?t:0)}get height(){var t;let e=this.AABBBounds.height();return e!==1/0&&e!==-1/0||(e=0),Math.max(e,null!==(t=this.attribute.height)&&void 0!==t?t:0)}setDeltaWidth(t){var e;0!==t&&(this.setAttribute("width",(null!==(e=this.attribute.width)&&void 0!==e?e:0)+t),this.border&&(this.border.setAttribute("width",this.border.attribute.width+t),"group"===this.border.type&&this.border.firstChild.setAttribute("width",this.border.firstChild.attribute.width+t)))}setDeltaHeight(t){var e;0!==t&&(this.setAttribute("height",(null!==(e=this.attribute.height)&&void 0!==e?e:0)+t),this.border&&(this.border.setAttribute("height",this.border.attribute.height+t),"group"===this.border.type&&this.border.firstChild.setAttribute("width",this.border.firstChild.attribute.height+t)))}setDeltaX(t){0!==t&&this.setAttribute("x",this.attribute.x+t)}setDeltaY(t){0!==t&&this.setAttribute("y",this.attribute.y+t)}forEachChildrenSkipChild(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"border-rect";if(arguments.length>2&&void 0!==arguments[2]&&arguments[2]){let i=this._lastChild,o=0;for(;i;){if(i.name!==e&&t(i,o++))return;i=i._prev}}else{let i=this._firstChild,o=0;for(;i;){if(i.name!==e&&t(i,o++))return;i=i._next}}}getColGroup(t){let e=this._firstChild;if(!e)return null;for(let i=0;i<this.childrenCount;i++){if(e.col===t)return e;e=e._next}return null}getRowGroup(t){let e=this._firstChild;if(!e)return null;for(let i=0;i<this.childrenCount;i++){if(e.row===t)return e;e=e._next}return null}addCellGroup(t){if(0===this.childrenCount||this.lastChild.row===t.row-1)this.addChild(t);else{let e=this._firstChild;for(let i=0;i<this.childrenCount;i++){if(e.row===t.row-1)return void this.insertAfter(t,e);e=e._next}this.addChild(t)}}getChildAt(t){const e=super.getChildAt(t);return e&&"border-rect"===e.name?e._next:e}tryUpdateAABBBounds(){if("cell"===this.role){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;const t=this.shouldSelfChangeUpdateAABBBounds(),e=this.doUpdateAABBBounds();return this.addUpdateLayoutTag(),function(t,e){t.stage&&t.stage.dirtyBounds&&t.stage.renderCount&&(t.isContainer&&!e||t.stage.dirty(t.globalAABBBounds))}(this,t),e}return super.tryUpdateAABBBounds()}doUpdateAABBBounds(){if("cell"===this.role){const t=this.attribute,{x:e,y:i,width:o,height:n}=t;return this._AABBBounds.setValue(e,i,e+o,i+n),this.parent&&this.parent.addChildUpdateBoundTag(),this.clearUpdateBoundTag(),this.shadowRoot&&this.shadowRoot.tryUpdateAABBBounds(),this._AABBBounds}return"body"===this.role||"row-header"===this.role||"col-header"===this.role||"right-frozen"===this.role||"bottom-frozen"===this.role||"corner-header"===this.role||"corner-right-top-header"===this.role||"corner-right-bottom-header"===this.role||"corner-left-bottom-header"===this.role?(this._AABBBounds.setValue(-1/0,-1/0,1/0,1/0),this.parent&&this.parent.addChildUpdateBoundTag(),this.clearUpdateBoundTag(),this.shadowRoot&&this.shadowRoot.tryUpdateAABBBounds(),this._AABBBounds):super.doUpdateAABBBounds()}updateColumnRowNumber(t){this.rowNumber?this.rowNumber=Math.max(this.rowNumber,t):this.rowNumber=t}updateColumnHeight(t){this.colHeight?this.colHeight+=t:this.colHeight=t}};function ER(t,e,i,o){const n=t/e;let r,s;return n>i/o?(r=i,s=r/n):(s=o,r=s*n),{width:r,height:s}}function HR(t,e,i,o,n,r){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"left",a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"middle",l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:[0,0,0,0],h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,d=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,c=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,u=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0;const g=t+i,p=e+o;let f=t+l[3]+h;"right"===s||"end"===s?f=g-n-l[1]-d:"center"===s&&(f=t+(i-n+h-d)/2);let v=e+l[0]+c;return"bottom"===a||"alphabetic"===a||"ideographic"===a?v=p-r-l[2]-u:"middle"===a&&(v=e+(o-r+c-u)/2),{x:f,y:v}}function FR(t,e,i,o,n){const r=e&&ot(e[t])?e[t]:void 0;return"function"==typeof r?r({col:i,row:o,table:n,value:n.getCellValue(i,o),dataValue:n.getCellOriginValue(i,o),cellHeaderPaths:n.getCellHeaderPaths(i,o)}):r}function OR(t,e,i,o,n){const r=e&&ot(e[t])?e[t]:void 0;if("function"==typeof r)return r({col:i,row:o,table:n,value:n.getCellValue(i,o),dataValue:n.getCellOriginValue(i,o),cellHeaderPaths:n.getCellHeaderPaths(i,o)})}function IR(t,e,i,o){var n,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w;let x=null!==(r=null===(n=null==i?void 0:i.group)||void 0===n?void 0:n.strokeArrayWidth)&&void 0!==r?r:void 0;return o.theme.cellInnerBorder||!function(t){return!!ot(t)&&(!ht(t)||t.some((t=>ot(t))))}(o.theme.frameStyle.borderLineWidth)||function(t){return 0===t||ht(t)&&t.every((t=>0===t))}(o.theme.frameStyle.borderLineWidth)||(0===t&&(x=null!=x?x:[null===(s=null==i?void 0:i.group)||void 0===s?void 0:s.lineWidth,null===(a=null==i?void 0:i.group)||void 0===a?void 0:a.lineWidth,null===(l=null==i?void 0:i.group)||void 0===l?void 0:l.lineWidth,null===(h=null==i?void 0:i.group)||void 0===h?void 0:h.lineWidth],x[3]=0),t===o.colCount-1&&(x=null!=x?x:[null===(d=null==i?void 0:i.group)||void 0===d?void 0:d.lineWidth,null===(c=null==i?void 0:i.group)||void 0===c?void 0:c.lineWidth,null===(u=null==i?void 0:i.group)||void 0===u?void 0:u.lineWidth,null===(g=null==i?void 0:i.group)||void 0===g?void 0:g.lineWidth],x[1]=0),0===e&&(x=null!=x?x:[null===(p=null==i?void 0:i.group)||void 0===p?void 0:p.lineWidth,null===(f=null==i?void 0:i.group)||void 0===f?void 0:f.lineWidth,null===(v=null==i?void 0:i.group)||void 0===v?void 0:v.lineWidth,null===(b=null==i?void 0:i.group)||void 0===b?void 0:b.lineWidth],x[0]=0),e===o.rowCount-1&&(x=null!=x?x:[null===(m=null==i?void 0:i.group)||void 0===m?void 0:m.lineWidth,null===(y=null==i?void 0:i.group)||void 0===y?void 0:y.lineWidth,null===(C=null==i?void 0:i.group)||void 0===C?void 0:C.lineWidth,null===(w=null==i?void 0:i.group)||void 0===w?void 0:w.lineWidth],x[2]=0)),x}class zR extends PR{constructor(t){super(t),this._autoWidth=!1,this._autoHeight=!1,this._leftGroup=new PR({pickable:!1,fill:!1,stroke:!1}),this._leftGroup.role="content-left",this._rightGroup=new PR({pickable:!1,fill:!1,stroke:!1}),this._rightGroup.role="content-right",this._centerGroup=new PR({pickable:!1,fill:!1,stroke:!1}),this._centerGroup.role="content-center",this.appendChild(this._leftGroup),this.appendChild(this._rightGroup),this.appendChild(this._centerGroup)}setCellContentOption(t){this._autoWidth=t.autoWidth,this._autoHeight=t.autoHeight,this._cellWidth=t.cellWidth,this._originCellWidth=t.cellWidth,this._cellHeight=t.cellHeight,this._align=t.align,this._baseline=t.baseline}addLeftOccupyingIcon(t){var e,i,o;t.setAttribute("x",this._leftGroup.width+(null!==(e=t.attribute.marginLeft)&&void 0!==e?e:0)),this._leftGroup.appendChild(t),this._leftGroup.setDeltaWidth((null!==(i=t.attribute.marginLeft)&&void 0!==i?i:0)+(null!==(o=t.attribute.marginRight)&&void 0!==o?o:0)+t.attribute.width)}addRightOccupyingIcon(t){var e,i,o;t.setAttribute("x",this._rightGroup.width+(null!==(e=t.attribute.marginLeft)&&void 0!==e?e:0)),this._rightGroup.appendChild(t),this._rightGroup.setDeltaWidth((null!==(i=t.attribute.marginLeft)&&void 0!==i?i:0)+(null!==(o=t.attribute.marginRight)&&void 0!==o?o:0)+t.attribute.width)}addContent(t){const e=this._centerGroup.lastChild;e&&t.setAttributes({x:e.attribute.x+e.AABBBounds.width()}),this._centerGroup.appendChild(t),t instanceof zh&&(this._centerGroup.setAttribute("pickable",!1),t.setAttribute("textAlign","left"))}layout(){let t=this._leftGroup.width;t===1/0&&(t=0);let e=this._rightGroup.width;if(e===-1/0&&(e=0),this._autoWidth){const i=this._centerGroup.width;this._cellWidth=t+e+i,this.setAttribute("width",this._cellWidth)}else{const i=this._cellWidth-t-e;this.updateCenterLayout(i);const o=this._centerGroup.width;this._cellWidth=t+e+o,this.setAttribute("width",this._cellWidth)}this.updateHorizontalPos();const i=this._leftGroup.height,o=this._rightGroup.height,n=this._centerGroup.height;this._cellHeight=Math.max(i,o,n),this.setAttribute("height",this._cellHeight),this.updateVerticalPos()}updateCenterLayout(t){let e=t;this._centerGroup.forEachChildren((t=>{(t instanceof WB||t instanceof NB)&&(e-=t.AABBBounds.width())}));const i=this._centerGroup.getChildByName("text");i instanceof gc?i.setAttribute("width",e):i instanceof zh&&i.setAttribute("maxLineWidth",e);let o=0;this._centerGroup.forEachChildren((t=>{t.setAttribute("x",o),o+=t.AABBBounds.width()}))}updateHorizontalPos(){this._leftGroup.setAttribute("x",0),this._rightGroup.setAttribute("x",this._cellWidth-this._rightGroup.width),this._centerGroup.setAttribute("x",this._leftGroup.width),"left"===this._align||"start"===this._align?this.setAttribute("dx",0):"center"===this._align?this.setAttribute("dx",-this.attribute.width/2):"right"!==this._align&&"end"!==this._align||this.setAttribute("dx",-this.attribute.width)}updateVerticalPos(){"top"===this._baseline?(this._leftGroup.setAttribute("y",0),this._rightGroup.setAttribute("y",0),this._centerGroup.setAttribute("y",0)):"middle"===this._baseline?(this._leftGroup.forEachChildren((t=>{t.setAttribute("y",(this._leftGroup.height-t.AABBBounds.height())/2)})),this._rightGroup.forEachChildren((t=>{t.setAttribute("y",(this._rightGroup.height-t.AABBBounds.height())/2)})),this._leftGroup.setAttribute("y",this._cellHeight/2-this._leftGroup.height/2),this._rightGroup.setAttribute("y",this._cellHeight/2-this._rightGroup.height/2),this._centerGroup.setAttribute("y",this._cellHeight/2-this._centerGroup.height/2)):"bottom"===this._baseline&&(this._leftGroup.forEachChildren((t=>{t.setAttribute("y",this._leftGroup.height-t.AABBBounds.height())})),this._rightGroup.forEachChildren((t=>{t.setAttribute("y",this._rightGroup.height-t.AABBBounds.height())})),this._leftGroup.setAttribute("y",this._cellHeight-this._leftGroup.height),this._rightGroup.setAttribute("y",this._cellHeight-this._rightGroup.height),this._centerGroup.setAttribute("y",this._cellHeight-this._centerGroup.height))}updateWidth(t){this._cellWidth=t,this._originCellWidth=t,this.layout()}updateHeight(t){this._cellHeight=t,this._cellWidth=this._originCellWidth;const e=this.getChildByName("text",!0);e&&e.setAttribute("heightLimit",t),this.layout()}}function DR(t,e,i){var o,n,r,s,a;let l=0;const h=i.internalProps.layoutMap;if(h.isHeader(t,e)){const r=h.getHeader(t,e);ot(null==r?void 0:r.hierarchyLevel)&&(l=(null!==(o=r.hierarchyLevel)&&void 0!==o?o:0)*("tree"===h.rowHierarchyType&&null!==(n=h.rowHierarchyIndent)&&void 0!==n?n:0),h.rowHierarchyTextStartAlignment&&!i.internalProps.headerHelper.getHierarchyIcon(t,e)&&(l+=i.internalProps.headerHelper.getHierarchyIconWidth()))}else if(i.options.groupBy||(null===(r=i.getBodyColumnDefine(t,e))||void 0===r?void 0:r.tree)){const o=i.dataSource.getIndexKey(i.getRecordShowIndexByCell(t,e)),n=null!==(s=i.dataSource.getGroupLength())&&void 0!==s?s:0;let r=ht(o)?o.length-1:0;n>0&&r===n&&(r=0),l=Array.isArray(o)&&i.getHierarchyState(t,e)!==nw.none?r*(null!==(a=h.hierarchyIndent)&&void 0!==a?a:0):0,h.hierarchyTextStartAlignment&&!i.internalProps.bodyHelper.getHierarchyIcon(t,e)&&(l+=i.internalProps.bodyHelper.getHierarchyIconWidth())}return l}function WR(t,e){var i,o;let n,r=!1;for(lt(t)&&t.length>(e.options.maxCharactersNumber||200)&&(t=t.slice(0,e.options.maxCharactersNumber||200),t+="…",r=!0),n=e.internalProps.enableLineBreak||(null===(i=e.options.customConfig)||void 0===i?void 0:i.multilinesForXTable)?Uw(t).replace(/\r?\n/g,"\n").replace(/\r/g,"\n").split("\n")||[]:[Uw(t)];n.length&&n.length>1&&!n[n.length-1];)n.pop();if((null===(o=e.options.customConfig)||void 0===o?void 0:o.multilinesForXTable)&&!e.internalProps.autoWrapText)for(;n.length&&n.length>1&&!n[0];)n.shift();return{text:n,moreThanMaxCharacters:r}}function NR(t,e,i,o,n,r,s){var a,l,h,d,c,u;const g={};"image"===t.type?t.isGif?(g.gif=t.src,g.image=t.src):g.image=t.src:("svg"===t.type||"svg"in t)&&(g.image=t.svg),g.width=t.width,g.height=t.height,g.visibleTime=null!==(a=t.visibleTime)&&void 0!==a?a:"always",g.funcType=t.funcType,g.interactive=t.interactive,g.isGif=t.isGif;let p,f=0;return s&&0!==(null==s?void 0:s.addedHierarchyOffset)||!ut(i)||!ut(o)||!r||t.funcType!==sw.collapse&&t.funcType!==sw.expand&&t.positionType!==rw.contentLeft&&t.positionType!==rw.contentRight||(f=n?DR(n.start.col,n.start.row,r):DR(i,o,r),s&&(s.addedHierarchyOffset=1)),g.marginLeft=(null!==(l=t.marginLeft)&&void 0!==l?l:0)+f,g.marginRight=null!==(h=t.marginRight)&&void 0!==h?h:0,!1===t.interactive&&(g.pickable=!1),t.hover&&(g.backgroundWidth=null!==(d=t.hover.width)&&void 0!==d?d:t.width,g.backgroundHeight=null!==(c=t.hover.width)&&void 0!==c?c:t.width,g.backgroundColor=null!==(u=t.hover.bgColor)&&void 0!==u?u:"rgba(22,44,66,0.2)",g.hoverImage=t.hover.image),t.cursor&&(g.cursor=t.cursor),"shape"in t&&"circle"===t.shape&&(g.shape=t.shape),e?(e.setAttributes(g),e.loadImage(g.image),e.tooltip=t.tooltip,e.name=t.name,e):("text"===t.type?(g.text=t.content,Tt(g,t.style),p=new NB(g),p.tooltip=t.tooltip,p.name=t.name):(p=new WB(g),p.tooltip=t.tooltip,p.name=t.name),p)}function GR(t){var e,i,o,n,r,s;const a={};return"image"===t.type?a.image=t.src:("svg"===t.type||"svg"in t)&&(a.image=t.svg),a.visibleTime=null!==(e=t.visibleTime)&&void 0!==e?e:"always",a.funcType=t.funcType,a.id=t.name,a.width=t.width,a.height=t.height,(t.marginRight||t.marginLeft)&&(a.margin=[0,null!==(i=t.marginRight)&&void 0!==i?i:0,0,null!==(o=t.marginLeft)&&void 0!==o?o:0]),t.hover&&(a.backgroundWidth=null!==(n=t.hover.width)&&void 0!==n?n:t.width,a.backgroundHeight=null!==(r=t.hover.height)&&void 0!==r?r:t.height,a.backgroundShowMode="hover",a.hoverImage=t.hover.image,a.backgroundStroke=!1,a.backgroundFill=null!==(s=t.hover.bgColor)&&void 0!==s?s:"rgba(22,44,66,0.2)"),t.cursor&&(a.cursor=t.cursor),a.tooltip=t.tooltip,a}function jR(t,e,i,o,n,r,s,a,l){var h,d,c,u;gt(t.contentWidth)&&(o=e-(null!==(h=t.contentWidth)&&void 0!==h?h:t.attribute.width));let g,p=0,f=0,v=0,b=0;t.forEachChildren((t=>{var e,i,o,n;"icon-left"===t.role?(p+=t.AABBBounds.width()+(null!==(e=t.attribute.marginLeft)&&void 0!==e?e:0)+(null!==(i=t.attribute.marginRight)&&void 0!==i?i:0),f=Math.max(f,t.AABBBounds.height())):"icon-right"===t.role&&(v+=t.AABBBounds.width()+(null!==(o=t.attribute.marginLeft)&&void 0!==o?o:0)+(null!==(n=t.attribute.marginRight)&&void 0!==n?n:0),b=Math.max(b,t.AABBBounds.height()))}));const m=t.getChildByName("text"),y=t.getChildByName("content");let C;m instanceof zh?(g=m.AABBBounds.height(),m.setAttribute("maxLineWidth",e-p-v-(r[1]+r[3])-(null!==(d=m.attribute.dx)&&void 0!==d?d:0)-(null!==(c=l.table.theme._contentOffset)&&void 0!==c?c:0)),C=m.AABBBounds.height()):m instanceof gc?(g=m.AABBBounds.height(),m.setAttribute("width",e-p-v-(r[1]+r[3])),C=m.AABBBounds.height()):y&&(g=y.AABBBounds.height(),y.updateWidth(e-p-v-(r[1]+r[3])),C=y.AABBBounds.height());const w=Math.round(Math.max(f,b,g)+r[0]+r[2]);if(t.forEachChildren((i=>{var n;if("icon-left"===i.role);else if("icon-right"===i.role)i.setAttribute("x",i.attribute.x+o);else if("icon-absolute-right"===i.role)i.setAttribute("x",i.attribute.x+o);else if("content"===i.name||"text"===i.name&&"richtext"!==i.type){const t=null!==(n=i.attribute.textAlign)&&void 0!==n?n:s;"center"===t?i.setAttribute("x",r[3]+p+(e-(r[1]+r[3])-p-v)/2):"right"===t&&i.setAttribute("x",r[3]+e-(r[1]+r[3])-v)}else"mark"===i.name&&i.setAttribute("x",t.attribute.width)})),n){let e=Math.max(f,C,b);if(function(t,e,i,o){const n=t.table,r=s_(n,e.col,e.row);if(r&&r.end.row-r.start.row){o/=r.end.row-r.start.row+1,i/=r.end.row-r.start.row+1;for(let t=r.start.row;t<=r.end.row;t++){const e=n.getRowHeight(t);if(e===o&&i!==e)return!0;if(i>e)return!0}}else{const t=n.getRowHeight(e.row);if(t===o&&i!==t)return!0;if(i>t)return!0}return!1}(l,t,Math.round(e+r[0]+r[2]),w))return!0;e=(null!==(u=t.contentHeight)&&void 0!==u?u:i)-(r[0]+r[2]),t.forEachChildren((t=>{"rect"!==t.type&&"chart"!==t.type&&t.name!==KB&&("mark"===t.name?t.setAttribute("y",0):"middle"===a?t.setAttribute("y",r[0]+(e-t.AABBBounds.height())/2):"bottom"===a?t.setAttribute("y",r[0]+e-t.AABBBounds.height()):t.setAttribute("y",r[0]))}))}else"middle"!==a&&"bottom"!==a||t.forEachChildren((t=>{"rect"!==t.type&&"chart"!==t.type&&t.name!==KB&&("mark"===t.name?t.setAttribute("y",0):"middle"===a?t.setAttribute("y",(i-r[2]+r[0]-t.AABBBounds.height())/2):"bottom"===a?t.setAttribute("y",i-t.AABBBounds.height()-r[2]):t.setAttribute("y",r[0]))}));return!1}function VR(t,e,i,o,n,r,s,a){var l;const h=e-Math.floor(n[0]+n[2]),d=t.getChildByName("text");d instanceof zh&&!o?d.setAttributes({heightLimit:!1===(null===(l=a.options.customConfig)||void 0===l?void 0:l.limitContentHeight)?-1:h}):d instanceof gc&&!o?d.setAttributes({height:h}):t.getChildByName("content")&&t.getChildByName("content").updateHeight(h),t.forEachChildren((t=>{t.setAttribute("dy",0),"rect"===t.type||"chart"===t.type||t.name===KB||("mark"===t.name?t.setAttribute("y",0):"middle"===s?t.setAttribute("y",n[0]+(h-t.AABBBounds.height())/2):"bottom"===s?t.setAttribute("y",n[0]+h-t.AABBBounds.height()):t.setAttribute("y",n[0]))}))}function UR(t,e,i,o){const n=[],r=[],s=[],a=[],l=[],h=[],d=[],c=[];let u=0,g=0,p=0,f=0,v=0,b=0;return t.forEach((t=>{switch(t.positionType){case rw.left:n.push(t);break;case rw.right:r.push(t);break;case rw.contentLeft:s.push(t);break;case rw.contentRight:a.push(t);break;case rw.absoluteRight:c.push(t);break;case rw.inlineFront:l.push(t);break;case rw.inlineEnd:h.push(t)}})),n.forEach((t=>{var n,r,s;const a=NR(t,void 0,e.col,e.row,i,o);a.role="icon-left",a.name=t.name,a.setAttribute("x",u+(null!==(n=a.attribute.marginLeft)&&void 0!==n?n:0)),u+=a.AABBBounds.width()+(null!==(r=a.attribute.marginLeft)&&void 0!==r?r:0)+(null!==(s=a.attribute.marginRight)&&void 0!==s?s:0),g=Math.max(g,a.AABBBounds.height()),e.appendChild(a)})),r.forEach((t=>{var n,r,s;const a=NR(t,void 0,e.col,e.row,i,o);a.role="icon-right",a.name=t.name,a.setAttribute("x",p+(null!==(n=a.attribute.marginLeft)&&void 0!==n?n:0)),p+=a.AABBBounds.width()+(null!==(r=a.attribute.marginLeft)&&void 0!==r?r:0)+(null!==(s=a.attribute.marginRight)&&void 0!==s?s:0),f=Math.max(f,a.AABBBounds.height()),e.appendChild(a)})),d.forEach((t=>{var n,r,s;const a=NR(t,void 0,e.col,e.row,i,o);a.role="icon-absolute-left",a.name=t.name,a.setAttribute("x",v+(null!==(n=a.attribute.marginLeft)&&void 0!==n?n:0)),v+=a.AABBBounds.width()+(null!==(r=a.attribute.marginLeft)&&void 0!==r?r:0)+(null!==(s=a.attribute.marginRight)&&void 0!==s?s:0),e.appendChild(a)})),c.forEach((t=>{var n,r,s;const a=NR(t,void 0,e.col,e.row,i,o);a.role="icon-absolute-right",a.name=t.name,a.setAttribute("x",b+(null!==(n=a.attribute.marginLeft)&&void 0!==n?n:0)),b+=a.AABBBounds.width()+(null!==(r=a.attribute.marginLeft)&&void 0!==r?r:0)+(null!==(s=a.attribute.marginRight)&&void 0!==s?s:0),e.appendChild(a)})),{leftIcons:n,rightIcons:r,contentLeftIcons:s,contentRightIcons:a,inlineFrontIcons:l,inlineEndIcons:h,absoluteLeftIcons:d,absoluteRightIcons:c,leftIconWidth:u,leftIconHeight:g,rightIconWidth:p,rightIconHeight:f,absoluteLeftIconWidth:v,absoluteRightIconWidth:b}}function $R(t,e){if(t.hasOwnProperty("hoverIconId")){const e=this;if(e.skipMergeUpdate)return;const i=UB(e);if(!i||!i.stage)return;const o=i.stage.table;e.skipAttributeUpdate=!0;const{mergeStartCol:n,mergeEndCol:r,mergeStartRow:s,mergeEndRow:a}=i;if(ot(n)&&ot(r)&&ot(s)&&ot(a)&&(n!==r||s!==a)){for(let l=n;l<=r;l++)for(let n=s;n<=a;n++){if(l===i.col&&n===i.row){if(t.hoverIconId!==e.attribute.hoverIconId){const i=e._frameCache.icons.get(t.hoverIconId);e.updateHoverIconState(i)}continue}const r=o.scenegraph.highPerformanceGetCell(l,n);if("cell"===r.role){const i=r.getChildByName(e.name,!0);if(!i||i.skipAttributeUpdate)continue;t.hoverIconId!==i.attribute.hoverIconId&&(i.setAttribute("hoverIconId",t.hoverIconId),r.addUpdateBoundTag())}}e.skipAttributeUpdate=void 0}}}function XR(t,e,i,o,n,r,s,a,l,h,d,c,u,g,p,f,v){var b,m,y,C,w,x,_,S,A,B,R,T,k,M,L,P,E,H,F,O,I,z,D,W,N,G,j,V,U,$;const X=OR("padding",g._getCellStyle(o,n),o,n,g);(null===(b=g.options.customConfig)||void 0===b?void 0:b.imageMargin)?h=tB(null===(m=g.options.customConfig)||void 0===m?void 0:m.imageMargin):ot(X)&&(h=X),(null===(y=null==p?void 0:p.text)||void 0===y?void 0:y.textAlign)&&(d=null===(C=null==p?void 0:p.text)||void 0===C?void 0:C.textAlign),(null===(w=null==p?void 0:p.text)||void 0===w?void 0:w.textBaseline)&&(c=null===(x=null==p?void 0:p.text)||void 0===x?void 0:x.textBaseline);const Y=IR(o,n,p,g);let K,q;if(v&&(K=g.scenegraph.highPerformanceGetCell(o,n,!0),K&&"cell"===K.role&&K.setAttributes({x:e,y:i,width:r,height:s,lineWidth:null!==(S=null===(_=null==p?void 0:p.group)||void 0===_?void 0:_.lineWidth)&&void 0!==S?S:void 0,fill:null!==(B=null===(A=null==p?void 0:p.group)||void 0===A?void 0:A.fill)&&void 0!==B?B:void 0,stroke:null!==(T=null===(R=null==p?void 0:p.group)||void 0===R?void 0:R.stroke)&&void 0!==T?T:void 0,strokeArrayWidth:null!=Y?Y:void 0,strokeArrayColor:null!==(M=null===(k=null==p?void 0:p.group)||void 0===k?void 0:k.strokeArrayColor)&&void 0!==M?M:void 0,cursor:null!==(P=null===(L=null==p?void 0:p.group)||void 0===L?void 0:L.cursor)&&void 0!==P?P:void 0,lineDash:null!==(H=null===(E=null==p?void 0:p.group)||void 0===E?void 0:E.lineDash)&&void 0!==H?H:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius})),K&&"cell"===K.role||(K=new PR({x:e,y:i,width:r,height:s,lineWidth:null!==(O=null===(F=null==p?void 0:p.group)||void 0===F?void 0:F.lineWidth)&&void 0!==O?O:void 0,fill:null!==(z=null===(I=null==p?void 0:p.group)||void 0===I?void 0:I.fill)&&void 0!==z?z:void 0,stroke:null!==(W=null===(D=null==p?void 0:p.group)||void 0===D?void 0:D.stroke)&&void 0!==W?W:void 0,strokeArrayWidth:null!=Y?Y:void 0,strokeArrayColor:null!==(G=null===(N=null==p?void 0:p.group)||void 0===N?void 0:N.strokeArrayColor)&&void 0!==G?G:void 0,cursor:null!==(V=null===(j=null==p?void 0:p.group)||void 0===j?void 0:j.cursor)&&void 0!==V?V:void 0,lineDash:null!==($=null===(U=null==p?void 0:p.group)||void 0===U?void 0:U.lineDash)&&void 0!==$?$:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius}),K.role="cell",K.col=o,K.row=n,null==t||t.addCellGroup(K)),u){let t=o,e=n;f&&(t=f.start.col,e=f.start.row),q=g.getCellIcons(t,e)}let Z=0,J=0,Q=0;if(Array.isArray(q)&&0!==q.length){const{leftIconWidth:t,rightIconWidth:e,absoluteLeftIconWidth:i,absoluteRightIconWidth:o}=UR(q,K,f,g);Z=t+e,J=t,Q=e,K.forEachChildren((t=>{"icon-left"===t.role?t.setAttribute("x",t.attribute.x+h[3]):"icon-right"===t.role?t.setAttribute("x",t.attribute.x+r-e-h[1]):"icon-absolute-right"===t.role&&t.setAttribute("x",t.attribute.x+r-o-h[1])})),K.forEachChildren((t=>{"middle"===c?t.setAttribute("y",(s-t.AABBBounds.height())/2):"bottom"===c?t.setAttribute("y",s-t.AABBBounds.height()-h[2]):t.setAttribute("y",h[0])})),K._cellLeftIconWidth=J,K._cellRightIconWidth=Q}const tt=g.getCellValue(o,n),et=lc({x:h[3],y:h[0],width:r-h[1]-h[3]-Z,height:s-h[0]-h[2],image:tt,cursor:"pointer"});return et.name="image",et.keepAspectRatio=a,et.textAlign=d,et.textBaseline=c,a||l?et.resources&&et.resources.has(et.attribute.image)&&"success"===et.resources.get(et.attribute.image).state?setTimeout((()=>{JR(l,a,h,d,c,et,K,g)}),0):et.successCallback=()=>{JR(l,a,h,d,c,et,K,g),g.scenegraph.updateNextFrame()}:et.resources&&et.resources.has(et.attribute.image)&&"success"===et.resources.get(et.attribute.image).state?KR(K,o,n,0,0,g):et.successCallback=()=>{KR(K,o,n,0,0,g)},et.failCallback=()=>{const t=LR();et.image=t.damage_pic.svg},K.appendChild(et),K}function YR(t,e,i,o,n,r,s){let a=!1,l=null,h=null;const{width:d,height:c,isMerge:u}=qR(s,n.table);if(d<i+r[1]+r[3]&&(l=i+r[1]+r[3],a=!0),c<o+r[2]+r[0]&&(h=o+r[2]+r[0],a=!0),a){if("number"==typeof l)if(u)for(let t=s.mergeStartCol;t<=s.mergeEndCol;t++)n.setColWidth(t,l/(s.mergeEndCol-s.mergeStartCol+1));else n.setColWidth(t,l);if("number"==typeof h)if(u)for(let t=s.mergeStartRow;t<=s.mergeEndRow;t++)n.setRowHeight(t,h/(s.mergeEndRow-s.mergeStartRow+1));else n.setRowHeight(e,h);return n.component.updateScrollBar(),!0}return!1}function KR(t,e,i,o,n,r){var s,a,l,h,d,c,u,g,p,f,v,b;const m=t.getChildByName("image");if(!m)return;const y="string"!=typeof m.attribute.image&&m.attribute.image||(null===(s=m.resources)||void 0===s?void 0:s.get(m.attribute.image).data);if(!y)return;const C=r._getCellStyle(e,i),w=null!==(a=FR("textAlign",C,e,i,r))&&void 0!==a?a:"left",x=null!==(l=FR("textBaseline",C,e,i,r))&&void 0!==l?l:"middle";let _;_=(null===(h=r.options.customConfig)||void 0===h?void 0:h.imageMargin)?tB(null===(d=r.options.customConfig)||void 0===d?void 0:d.imageMargin):null!==(c=tB(FR("padding",C,e,i,r)))&&void 0!==c?c:[0,0,0,0];const{width:S,height:A,isMerge:B}=qR(t,r),R=null!==(u=t.mergeStartCol)&&void 0!==u?u:t.col,T=null!==(g=t.mergeStartRow)&&void 0!==g?g:t.row,k=null!==(p=t.mergeEndCol)&&void 0!==p?p:t.col,M=null!==(f=t.mergeEndCol)&&void 0!==f?f:t.row,L=null!==(v=t._cellLeftIconWidth)&&void 0!==v?v:0,P=null!==(b=t._cellRightIconWidth)&&void 0!==b?b:0;if(m.keepAspectRatio){const{width:t,height:e}=ER(y.width||y.videoWidth,y.height||y.videoHeight,S-(_[1]+_[3]),A-(_[0]+_[2])),i=HR(0,0,S,A,t,e,w,x,_);for(let o=R;o<=k;o++)for(let n=T;n<=M;n++){const s=r.scenegraph.getCell(o,n).getChildByName("image");null==s||s.setAttributes({x:i.x,y:i.y,width:t,height:e})}}else for(let t=R;t<=k;t++)for(let e=T;e<=M;e++){const i=r.scenegraph.getCell(t,e).getChildByName("image");null==i||i.setAttributes({x:L+_[3],y:_[0],width:S-_[1]-_[3]-P-L,height:A-_[0]-_[2]})}if(t.getChildByName("play-icon")){const e=0,i=0,{width:o,height:n}=qR(t,r),s=Math.floor(Math.min(o-_[1]-_[3],n-_[2]-_[0])/2),a=e+(o>m.attribute.width?m.attribute.x-e+m.attribute.width/2:o/2),l=i+(n>m.attribute.height?m.attribute.y-i+m.attribute.height/2:n/2);for(let t=R;t<=k;t++)for(let e=T;e<=M;e++)r.scenegraph.getCell(t,e).getChildByName("play-icon").setAttributes({x:a-s/2,y:l-s/2,width:s,height:s})}t.forEachChildren((t=>{"icon-left"===t.role||("icon-right"===t.role||"icon-absolute-right"===t.role)&&t.setAttribute("x",t.attribute.x+o)})),t.forEachChildren((t=>{("rect"===t.type||t.role&&t.role.startsWith("icon"))&&("middle"===x?t.setAttribute("y",_[0]+(A-_[0]-_[2]-t.AABBBounds.height())/2):"bottom"===x?t.setAttribute("y",_[0]+A-_[0]-_[2]-t.AABBBounds.height()):t.setAttribute("y",_[0]))})),B&&ZR(t.mergeStartCol,t.mergeEndCol,t.mergeStartRow,t.mergeEndRow,r)}function qR(t,e){return"cell"===t.role&&ot(t.mergeStartCol)&&ot(t.mergeEndCol)&&ot(t.mergeStartRow)&&ot(t.mergeEndRow)?{width:e.getColsWidth(t.mergeStartCol,t.mergeEndCol),height:e.getRowsHeight(t.mergeStartRow,t.mergeEndRow),isMerge:!0}:{width:t.attribute.width,height:t.attribute.height,isMerge:!1}}function ZR(t,e,i,o,n){for(let r=t;r<=e;r++)for(let t=i;t<=o;t++){const e=n.scenegraph.getCell(r,t);if(e){const i=e.getChildByName("image");i&&i.setAttributes({dx:-n.getColsWidth(e.mergeStartCol,r-1),dy:-n.getRowsHeight(e.mergeStartRow,t-1)});const o=e.getChildByName("play-icon");o&&o.setAttributes({dx:-n.getColsWidth(e.mergeStartCol,r-1),dy:-n.getRowsHeight(e.mergeStartRow,t-1)})}}}function JR(t,e,i,o,n,r,s,a){const l=r.resources.get(r.attribute.image).data,{col:h,row:d}=s;if(t&&!QR(r)&&YR(h,d,l.width,l.height,a.scenegraph,i,s),e||QR(r)){const{width:t,height:e,isMerge:h}=qR(s,a),{width:d,height:c}=ER(l.width,l.height,t-i[1]-i[3],e-i[0]-i[2]),u=HR(0,0,t,e,d,c,o,n,i);r.setAttributes({x:u.x,y:u.y,width:d,height:c}),h&&ZR(s.mergeStartCol,s.mergeEndCol,s.mergeStartRow,s.mergeEndRow,a)}}function QR(t){const e=LR();return t.attribute.image===e.damage_pic.svg}function tT(t,e,i){t.then((()=>{i(),e.scenegraph.updateNextFrame()})).catch((t=>{}))}function eT(t,e){var i,o;const n=this;if(n.shadowRoot&&n.shadowRoot.childrenCount&&(ot(t.width)||ot(t.height))){const e=n.shadowRoot.findChildrenByName("shadow-rect")[0];e&&e.setAttributes({width:null!==(i=t.width)&&void 0!==i?i:e.attribute.width,height:null!==(o=t.height)&&void 0!==o?o:e.attribute.height})}}function iT(t,e,i,o,n,r,s,a,l,h,d,c,u,g,p,f,v,b){var m,y;let C,w=!1;if(gx(e)){if("cell"!==o.scenegraph.highPerformanceGetCell(n,r).role)return C;e=o.getCellValue(n,r),w=!0}if("text"===t||"link"===t||b){if("link"===t){const s=e,a=o.getCellOriginValue(n,r),l=o._getCellStyle(n,r);"link"===t&&("templateLink"in i&&i.templateLink||!("linkDetect"in i)||!ux(i.linkDetect,{col:n,row:r,table:o,value:s,dataValue:a,cellHeaderPaths:void 0})||Nx.test(s))&&(f?(f.text.fill=FR("linkColor",l,n,r,o),f.group.cursor="pointer"):f={text:{fill:FR("linkColor",l,n,r,o)},group:{cursor:"pointer"}})}const{customElementsGroup:y,renderDefault:x}=oT(o,i,n,r,a,l,c,v,b);C=a_.getFunction("createTextCellGroup")(o,e,h,0,d,n,r,s,a,l,c,u,g,p,y,x,f,v,w);const _=o.internalProps.layoutMap.getAxisConfigInPivotChart(n,r);if(_){const t=new(a_.getComponent("axis"))(_,C.attribute.width,C.attribute.height,null!==(m=_.__vtablePadding)&&void 0!==m?m:c,o);C.clear(),C.appendChild(t.component),t.overlap()}else o.internalProps.layoutMap.isEmpty(n,r)?(C.setAttributes({fill:!1,stroke:!1}),C.clear()):o.internalProps.layoutMap.isAxisCell(n,r)&&C.clear()}else if("image"===t)C=a_.getFunction("createImageCellGroup")(h,0,d,n,r,a,l,i.keepAspectRatio,i.imageAutoSizing,c,u,g,p,o,f,v,w);else if("video"===t)C=a_.getFunction("createVideoCellGroup")(h,0,d,n,r,a,l,i.keepAspectRatio,i.imageAutoSizing,c,u,g,p,o,f,v,w);else if("chart"===t){const t=o.internalProps.layoutMap.getChartInstance(n,r);C=a_.getFunction("createChartCellGroup")(null,h,0,d,n,r,a,l,c,e,i.chartModule,o.internalProps.layoutMap.getChartSpec(n,r),t,null!==(y=o.internalProps.layoutMap.getChartDataId(n,r))&&void 0!==y?y:"data",o,f,o.internalProps.layoutMap.isShareChartSpec(n,r),w,o.internalProps.layoutMap.isNoChartDataRenderNothing(n,r))}else if("progressbar"===t){const{customElementsGroup:t,renderDefault:p}=oT(o,i,n,r,a,l,c,v,b),m=o._getCellStyle(n,r),y=o.getCellOriginValue(n,r);C=a_.getFunction("createTextCellGroup")(o,e,h,0,d,n,r,s,a,l,c,u,g,!1,t,p,f,v,w);const x=a_.getFunction("createProgressBarCell")(i,m,s,e,y,n,r,c,o,v);C.firstChild?C.insertBefore(x,C.firstChild):C.appendChild(x)}else"sparkline"===t?C=a_.getFunction("createSparkLineCellGroup")(null,h,0,d,n,r,a,l,c,o,f,w):"checkbox"===t?C=a_.getFunction("createCheckboxCellGroup")(null,h,0,d,n,r,s,a,l,c,u,g,p,o,f,i,v,w):"radio"===t?C=a_.getFunction("createRadioCellGroup")(null,h,0,d,n,r,s,a,l,c,u,g,o,f,i,v):"switch"===t?C=a_.getFunction("createSwitchCellGroup")(null,h,0,d,n,r,s,a,l,c,u,g,p,o,f,i,v,w):"button"===t&&(C=a_.getFunction("createButtonCellGroup")(null,h,0,d,n,r,s,a,l,c,u,g,p,o,f,i,v,w));return C.onBeforeAttributeUpdate=eT,C}function oT(t,e,i,o,n,r,s,a,l){let h,d=!0;if(l)h=l.elementsGroup,d=l.renderDefault;else if((null==a?void 0:a.isCustom)&&!t.isCornerHeader(i,o));else{let l,c;if("body"!==t.getCellLocation(i,o)?(l=null==e?void 0:e.headerCustomRender,c=null==e?void 0:e.headerCustomLayout):(l=(null==e?void 0:e.customRender)||t.customRender,c=null==e?void 0:e.customLayout),c||l){const e=ZB(c,l,i,o,n,r,!1,t.isAutoRowHeight(o),s,a,t);h=e.elementsGroup,d=e.renderDefault}}return{customElementsGroup:h,renderDefault:d}}function nT(t,e,i,o,n,r){var s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x,_;const S=i.scenegraph.highPerformanceGetCell(t,e,!0);if("cell"!==S.role&&!o)return;const A=i.getCellLocation(t,e);let B,R,T,k,M=i.getCellValue(t,e),L=!1;if(i.internalProps.customMergeCell){const o=i.getCustomMerge(t,e);if(o){const{range:t,text:n,style:r,customLayout:s,customRender:a}=o;R=t,B=R.start.col!==R.end.col||R.start.row!==R.end.row,M=n,T=r,(s||a)&&(k=ZB(s,a,t.start.col,t.start.row,i.getColsWidth(t.start.col,t.end.col),i.getRowsHeight(t.start.row,t.end.row),!1,i.isAutoRowHeight(e),[0,0,0,0],R,i)),L=!0}}let P=t,E=e;R&&(P=R.start.col,E=R.start.row);const H="body"!==A?i.getHeaderDefine(P,E):i.getBodyColumnDefine(P,E);let F="body"!==A||(null==H?void 0:H.dragOrder)||!!(null==H?void 0:H.icon)||!!(null==H?void 0:H.tree);R||!i.internalProps.enableTreeNodeMerge&&"body"===A&&!(null==H?void 0:H.mergeCell)||(R=i.getCellRange(t,e),B=R.start.col!==R.end.col||R.start.row!==R.end.row);let O=!1;if(i.internalProps.enableTreeNodeMerge&&B){const o=i.getCellRawRecord(R.start.col,R.start.row),{vtableMergeName:n,vtableMerge:r}=null!=o?o:{};O=r,r&&(F=!0,i.options.groupTitleCustomLayout&&(k=ZB(i.options.groupTitleCustomLayout,void 0,R.start.col,R.start.row,i.getColsWidth(R.start.col,R.end.col),i.getRowsHeight(R.start.row,R.end.row),!1,i.isAutoRowHeight(e),[0,0,0,0],R,i)),i.options.groupTitleFieldFormat?M=i.options.groupTitleFieldFormat(o,t,e,i):n&&(M=n))}const I=T||i._getCellStyle(R?R.start.col:t,R?R.start.row:e),z=null!==(s=I.autoWrapText)&&void 0!==s?s:i.internalProps.autoWrapText,D=IB(I,i,B?R.start.col:t,B?R.start.row:e,FR).theme;if(D.group.cornerRadius=zB(t,e,i),!o&&!B&&!((null==H?void 0:H.customLayout)||(null==H?void 0:H.customRender)||(null==H?void 0:H.headerCustomLayout)||(null==H?void 0:H.headerCustomRender))&&(r||function(t,e,i,o,n,r){var s;const a=r.getBodyColumnType(t,e),l=r.isAutoRowHeight(e),h=r.getCellValue(t,e);return!(r.isHeader(t,e)||"cell"!==i.role||"text"!==a||o||l||n||"text"!==(null===(s=i.firstChild)||void 0===s?void 0:s.type)||gx(h))}(t,e,S,z,F,i))){const o=i.getColWidth(t),n=i.getRowHeight(e),s=IR(t,e,D,i);S.setAttributes({width:o,height:n,lineWidth:null!==(l=null===(a=null==D?void 0:D.group)||void 0===a?void 0:a.lineWidth)&&void 0!==l?l:void 0,fill:null!==(d=null===(h=null==D?void 0:D.group)||void 0===h?void 0:h.fill)&&void 0!==d?d:void 0,stroke:null!==(u=null===(c=null==D?void 0:D.group)||void 0===c?void 0:c.stroke)&&void 0!==u?u:void 0,strokeArrayWidth:null!=s?s:void 0,strokeArrayColor:null!==(p=null===(g=null==D?void 0:D.group)||void 0===g?void 0:g.strokeArrayColor)&&void 0!==p?p:void 0,cursor:null!==(v=null===(f=null==D?void 0:D.group)||void 0===f?void 0:f.cursor)&&void 0!==v?v:void 0,cornerRadius:null!==(m=null===(b=null==D?void 0:D.group)||void 0===b?void 0:b.cornerRadius)&&void 0!==m?m:0,lineDash:null!==(C=null===(y=null==D?void 0:D.group)||void 0===y?void 0:y.lineDash)&&void 0!==C?C:void 0,y:i.scenegraph.getCellGroupY(e)}),S.forEachChildren((t=>{t.setAttributes({dx:0,dy:0})}));const x=S.getChildByName("text");if(r&&x){const t={textBaseline:"top"};x.setAttributes(D.text?Object.assign({},D.text,t):t)}else if(x){const r=i.getCellValue(t,e),{text:s,moreThanMaxCharacters:a}=WR(r,i),l=DR(t,e,i),h=I.lineClamp,d=null!==(w=tB(FR("padding",I,t,e,i)))&&void 0!==w?w:[0,0,0,0],c=D.text.textAlign;let u=0;u="center"===c?d[3]+(o-(d[1]+d[3]))/2:"right"===c?d[3]+o-(d[1]+d[3]):d[3];const g={text:1!==s.length||z?s:s[0],moreThanMaxCharacters:a,maxLineWidth:o-(d[1]+d[3]+l),textBaseline:"top",autoWrapText:z,lineClamp:h,wordBreak:"break-word",heightLimit:n-Math.floor(d[0]+d[2]),pickable:!1,dx:"left"===c?l:0,x:u};if(x.setAttributes(D.text?Object.assign({},D.text,g):g),x.attribute.text){const t=D.text.textBaseline,e=n-(d[0]+d[2]);let i=0;i="middle"===t?d[0]+(e-x.AABBBounds.height())/2:"bottom"===t?d[0]+e-x.AABBBounds.height():d[0],x.setAttributes({y:i})}}return S}if(!o&&"empty"===S.role)return;const W=O||L?"text":i.isHeader(t,e)?null!==(x=i._getHeaderLayoutMap(t,e).headerType)&&void 0!==x?x:"text":null!==(_=i.getBodyColumnType(t,e))&&void 0!==_?_:"text",N=D._vtable.padding,G=D.text.textAlign,j=D.text.textBaseline;let V,U,$;if(R?(U=i.getColsWidth(R.start.col,R.end.col),$=i.getRowsHeight(R.start.row,R.end.row)):(U=i.getColWidth(t),$=i.getRowHeight(e)),gx(M)?(S.removeAllChild(),tT(M,i,sT.bind(null,{type:W,value:M,define:H,table:i,col:t,row:e,cellWidth:U,cellHeight:$,oldCellGroup:S,padding:N,textAlign:G,textBaseline:j,mayHaveIcon:F,addNew:o,range:R,customResult:k,customStyle:T}))):V=rT(W,M,H,i,t,e,U,$,S,N,G,j,F,o,D,R,k),B){const{width:t}=V.attribute,{height:e}=V.attribute;V.contentWidth=t,V.contentHeight=e,n?function(t,e,i,o,n,r,s,a){const{col:l,row:h}=a;t.start.row!==t.end.row&&a.contentHeight!==i&&VR(a,i,0,s.isAutoRowHeight(h),o,0,r,s),t.start.col!==t.end.col&&a.contentWidth!==e&&jR(a,e,i,0,s.isAutoRowHeight(h),o,n,r,s.scenegraph),a.contentWidth=e,a.contentHeight=i;const d=s.getRowHeight(h);lT(a,s.getColWidth(l),d,t,s)}(R,U,$,N,G,j,i,V):aT(R,U,$,N,G,j,i)}return V}function rT(t,e,i,o,n,r,s,a,l,h,d,c,u,g,p,f,v){var b,m;if(gx(e)&&(e=o.getCellValue(n,r)),!g&&(l.row!==r||l.col!==n))return null;if(!g&&l.parent&&o.reactCustomLayout){const t=l.getChildByName("custom-container");if(t){const{col:e,row:i}=t;ut(e)&&ut(i)&&o.reactCustomLayout.removeCustomCell(e,i)}}const y=iT(t,e,i,o,n,r,o.getColWidth(n),s,a,g?o.scenegraph.getColGroup(n):l.parent,g?0:o.scenegraph.getCellGroupY(r),h,d,c,u,p,f,v);return!g&&l.parent&&(l.parent.insertAfter(y,l),l.parent.removeChild(l),(null===(b=o.scenegraph)||void 0===b?void 0:b.proxy.cellCache.get(n))&&(null===(m=o.scenegraph)||void 0===m||m.proxy.cellCache.set(n,y))),y}function sT(t){const{type:e,value:i,define:o,table:n,col:r,row:s,cellWidth:a,cellHeight:l,oldCellGroup:h,padding:d,textAlign:c,textBaseline:u,mayHaveIcon:g,addNew:p,range:f,customResult:v,customStyle:b}=t,m=IB(b||n._getCellStyle(f?f.start.col:r,f?f.start.row:s),n,f?f.start.col:r,f?f.start.row:s,FR).theme;m.group.cornerRadius=zB(r,s,n),rT(e,i,o,n,r,s,a,l,h,d,c,u,g,p,m,f,v)}function aT(t,e,i,o,n,r,s){for(let a=t.start.col;a<=t.end.col;a++)for(let l=t.start.row;l<=t.end.row;l++){const h=s.scenegraph.highPerformanceGetCell(a,l,!0);if("cell"!==h.role)continue;t.start.row!==t.end.row&&h.contentHeight!==i&&VR(h,i,0,s.isAutoRowHeight(l),o,0,r,s),t.start.col!==t.end.col&&h.contentWidth!==e&&jR(h,e,i,0,s.isAutoRowHeight(l),o,n,r,s.scenegraph),h.contentWidth=e,h.contentHeight=i;const d=s.getRowHeight(l);lT(h,s.getColWidth(a),d,t,s)}}function lT(t,e,i,o,n){var r,s;const{col:a,row:l}=t,h=-n.getColsWidth(o.start.col,a-1);let d=0;if(null===(r=n.options.customConfig)||void 0===r?void 0:r._disableColumnAndRowSizeRound)for(let t=o.start.row;t<=l-1;t++)d-=n.getRowHeight(t);else d=-n.getRowsHeight(o.start.row,l-1);t.forEachChildren((t=>{var e,i,o,n,r,s;"number"==typeof t._dx?(t.skipMergeUpdate=!0,t.setAttributes({dx:(null!==(e=t._dx)&&void 0!==e?e:0)+h}),t.skipMergeUpdate=!1):(t.skipMergeUpdate=!0,t._dx=null!==(i=t.attribute.dx)&&void 0!==i?i:0,t.setAttributes({dx:(null!==(o=t.attribute.dx)&&void 0!==o?o:0)+h}),t.skipMergeUpdate=!1),"number"==typeof t._dy?(t.skipMergeUpdate=!0,t.setAttributes({dy:(null!==(n=t._dy)&&void 0!==n?n:0)+d}),t.skipMergeUpdate=!1):(t._dy=null!==(r=t.attribute.dy)&&void 0!==r?r:0,t.skipMergeUpdate=!0,t.setAttributes({dy:(null!==(s=t.attribute.dy)&&void 0!==s?s:0)+d}),t.skipMergeUpdate=!1)}));const c=null!==(s=t.attribute.strokeArrayWidth)&&void 0!==s?s:t.attribute.lineWidth,u=ht(c),g=[0,0,0,0];a===o.start.col&&(g[3]=u?c[3]:c),l===o.start.row&&(g[0]=u?c[0]:c),a===o.end.col&&(g[1]=u?c[1]:c),l===o.end.row&&(g[2]=u?c[2]:c);const p=e!==t.attribute.width,f=i!==t.attribute.height;return t.skipMergeUpdate=!0,t.setAttributes({width:e,height:i,strokeArrayWidth:g}),t.skipMergeUpdate=!1,t.mergeStartCol=o.start.col,t.mergeStartRow=o.start.row,t.mergeEndCol=o.end.col,t.mergeEndRow=o.end.row,{widthChange:p,heightChange:f}}function hT(t,e,i,o){if(o.internalProps.customMergeCell){const n=o.getCustomMerge(t,e);if(n){const{range:r,text:s,style:a,customLayout:l,customRender:h}=n;if(l||h){const n=ZB(l,h,r.start.col,r.start.row,o.getColsWidth(r.start.col,r.end.col),o.getRowsHeight(r.start.row,r.end.row),!1,o.isAutoRowHeight(e),[0,0,0,0],r,o).elementsGroup;i.childrenCount>0&&n?i.insertBefore(n,i.firstChild):n&&i.appendChild(n);const s=o.getRowHeight(e),a=o.getColWidth(t),{width:d}=i.attribute,{height:c}=i.attribute;return i.contentWidth=d,i.contentHeight=c,lT(i,a,s,r,o),r}}}}function dT(t){return!!("cell"===t.role&&ut(t.mergeStartCol)&&ut(t.mergeStartRow)&&ut(t.mergeEndCol)&&ut(t.mergeEndRow))}const cT=new Uy({}),uT=new $y({}),gT=new Qb({});function pT(t,e,i,o,n,r,s,a,l,h,d,c,u,g,p){const f=Kw(nt(t)?t.text:t).split("\n")||[],v=p.getColsWidth(e,o),b=FR("size",n,e,i,p);let m=FR("outerRadius",n,e,i,p);const y=ut(m)?2*m:b;let C=0;if(r){const t=FR("spaceBetweenTextAndIcon",n,e,i,p),o=v-(g[1]+g[3])-s-y-t;ut(m)||(m=Math.round(b/2)),uT.setAttributes({text:{maxLineWidth:o,text:f,fontSize:a,fontStyle:l,fontWeight:h,fontFamily:d,lineHeight:c,wordBreak:"break-word",lineClamp:u},circle:{outerRadius:m},spaceBetweenTextAndIcon:t}),uT.render(),C=uT.AABBBounds.height()}else C=Math.max(b,f.length*c);return C}let fT="quick";const vT=new a(((t,e,i,o)=>{i(nn)?o(nn).to(yT).inSingletonScope():t(nn).to(yT).inSingletonScope()}));new a(((t,e,i,o)=>{i(nn)?o(nn).to(rn).inSingletonScope():t(nn).to(rn).inSingletonScope()}));const bT=new Map;function mT(t,e,i){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"normal";const n=`${t}-${e}-${i}-${o}`,r=bT.get(n);if(r)return r;const s=(a={fontSize:t,fontFamily:i,fontWeight:e,fontStyle:o},new Pe(Object.assign({defaultFontParams:{fontFamily:Co.fontFamily,fontSize:Co.fontSize},getTextBounds:kl,specialCharSet:`{}()//&-/: .,@%'"~…=——${Pe.ALPHABET_CHAR_SET}${Pe.ALPHABET_CHAR_SET.toUpperCase()}0123456789`},{}),a));var a;return bT.set(n,s),s}class yT extends rn{_fastMeasure(t,e){const{fontSize:i,fontFamily:o="Arial,sans-serif",fontWeight:n="normal",fontStyle:r="normal"}=e,s=mT(i,n,o,r).measure(t,fT);if(!ot(s.fontBoundingBoxAscent)&&!ot(s.fontBoundingBoxDescent)){const{ascent:t,descent:i}=this.measureTextBoundADscentEstimate(e);s.fontBoundingBoxAscent=t,s.fontBoundingBoxDescent=i}return s}measureTextWidth(t,e){return this._fastMeasure(t,e).width}measureText(t,e){return this._fastMeasure(t,e)}_measureTextWithoutAlignBaseline(t,e,i){return this._fastMeasure(t,e)}_measureTextWithAlignBaseline(t,e,i){return this._fastMeasure(t,e)}}const CT=new class{measureText(t,e){const{fontSize:i,fontFamily:o="Arial,sans-serif",fontWeight:n="normal",fontStyle:r="normal"}=e;return mT(i,n,o,r).measure(t,fT)}measureTextWidth(t,e){const{fontSize:i,fontFamily:o="Arial,sans-serif",fontWeight:n="normal",fontStyle:r="normal"}=e;return mT(i,n,o,r).measure(t,fT).width}clipText(t,e,i){if(0===t.length)return{str:"",width:0};let o=this.measureTextWidth(t,e);return o<=i?{str:t,width:o}:(o=this.measureTextWidth(t[0],e),o>i?{str:"",width:0}:this._clipText(t,e,i,0,t.length-1))}_clipText(t,e,i,o,n){const r=Math.floor((o+n)/2),s=t.substring(0,r+1),a=this.measureTextWidth(s,e);let l;if(a>i){if(s.length<=1)return{str:"",width:0};const n=t.substring(0,r);return l=this.measureTextWidth(n,e),l<=i?{str:n,width:l}:this._clipText(t,e,i,o,r)}if(a<i){if(r>=t.length-1)return{str:t,width:this.measureTextWidth(t,e)};const o=t.substring(0,r+2);return l=this.measureTextWidth(o,e),l>=i?{str:s,width:a}:this._clipText(t,e,i,r,n)}return{str:s,width:a}}clipTextWithSuffix(t,e,i,o){if(""===o)return this.clipText(t,e,i);if(0===t.length)return{str:"",width:0};const n=this.measureTextWidth(t,e);if(n<=i)return{str:t,width:n};const r=this.measureTextWidth(o,e);if(r>i)return{str:"",width:0};i-=r;const s=this._clipText(t,e,i,0,t.length-1);return s.str+=o,s.width+=r,s}},wT=new zh({ignoreBuf:!0});function xT(t){return wT.initAttributes(Object.assign(Object.assign({},t),{ignoreBuf:!0})),wT.AABBBounds}const _T=new gc({width:0,height:0,textConfig:[]});function ST(t,e,i){let o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=arguments.length>4?arguments[4]:void 0;var r,s,a,l,h,d,c,u,g,p,f;"undefined"!=typeof window&&window.performance.now();const v=[],b=[];if(n)for(let o=e;o<=i;o++)v[o]=t.getRowHeight(o);const m=t.internalProps.layoutMap;t.isPivotTable()&&(m.enableUseGetBodyCache(),m.enableUseHeaderPathCache()),t.defaultHeaderRowHeight,t.defaultHeaderColWidth;const y="auto"===t.defaultHeaderRowHeight||ht(t.defaultHeaderRowHeight)&&t.defaultHeaderRowHeight.some((t=>"auto"===t)),C=t.isAutoRowHeight(e)||"adaptive"===t.heightMode&&!1!==t.options.autoHeightInAdaptiveMode,w="auto"===t.options.defaultRowHeight;if(C||y||w){e=null!=e?e:0,i=null!=i?i:t.rowCount-1,(0===e&&i===t.rowCount-1||o)&&t._clearRowRangeHeightsMap();for(let i=e;i<t.columnHeaderLevelCount;i++){let e=0,o=t.colCount-1;if((t.isPivotTable()&&!t.isPivotChart()||t.isPivotChart()&&!t.internalProps.layoutMap.indicatorsAsCol)&&RT(t,i)&&!s_(t,t.rowHeaderLevelCount,i)&&(e=0,o=t.rowHeaderLevelCount),C||"auto"===t.getDefaultRowHeight(i)){const r=AT(i,e,o,t);b[i]=Math.round(r),"only-body"!==t.heightAdaptiveMode&&n||t._setRowHeight(i,r)}}for(let e=t.rowCount-t.bottomFrozenRowCount;e<=i;e++)if(C||"auto"===t.getDefaultRowHeight(e)){const i=AT(e,0,t.colCount-1,t);n?b[e]=Math.round(i):t._setRowHeight(e,i)}if(i<t.columnHeaderLevelCount||!C&&!w);else if(t.internalProps.transpose||t.isPivotTable()&&!t.internalProps.layoutMap.indicatorsAsCol||t.options.customComputeRowHeight||!function(t,e){var i,o,n;const{layoutMap:r}=t.internalProps,s=t.columnHeaderLevelCount;if((t.internalProps.autoWrapText||t.internalProps.enableLineBreak||t.isPivotChart())&&(t.isAutoRowHeight(e)||"adaptive"===t.options.heightMode))return!1;for(let e=0;e<t.colCount;e++){const a=r.getBody(e,s);if("radio"===a.cellType)return!1;if("function"==typeof a.style||"function"==typeof a.icon||(null===(i=a.define)||void 0===i?void 0:i.customRender)||(null===(o=a.define)||void 0===o?void 0:o.customLayout)||"function"==typeof(null===(n=a.define)||void 0===n?void 0:n.icon))return!1;const l=t._getCellStyle(e,s);if("function"==typeof l.padding||"function"==typeof l.fontSize||"function"==typeof l.lineHeight||!0===l.autoWrapText)return!1}return!0}(t,e))if(t.internalProps.transpose||t.isPivotTable()&&!t.internalProps.layoutMap.indicatorsAsCol)for(let o=Math.max(e,t.columnHeaderLevelCount);o<=i;o++){let e;e=BT(t,o)?AT(o,0,t.rowHeaderLevelCount,t):AT(o,0,t.colCount-1,t),n?b[o]=Math.round(e):t._setRowHeight(o,e)}else for(let o=Math.max(e,t.columnHeaderLevelCount);o<=i;o++){const e=AT(o,0,t.colCount-1,t);n?b[o]=Math.round(e):t._setRowHeight(o,e)}else{!function(t,e,i,o,n){if(!o.internalProps.useOneRowHeightFillAll){for(let r=e;r<=i;r++)n?n[r]=t:o._setRowHeight(r,t);o.internalProps.useOneRowHeightFillAll=!0}}(AT(t.columnHeaderLevelCount,0,t.colCount-1,t),t.columnHeaderLevelCount,t.rowCount-1-t.bottomFrozenRowCount,t,n?b:void 0);for(let e=t.rowCount-t.bottomFrozenRowCount;e<=i;e++){const i=AT(e,0,t.colCount-1,t);n?b[e]=Math.round(i):t._setRowHeight(e,i)}}}else if(("adaptive"===t.heightMode||t.autoFillHeight)&&t.clearRowHeightCache(),n)for(let o=e;o<=i;o++)b[o]=t.getRowHeight(o);if((0===e&&i===t.rowCount-1||o)&&t._clearRowRangeHeightsMap(),"adaptive"===t.heightMode){t._clearRowRangeHeightsMap();let e=t.tableNoFrameHeight,i=0,o=t.rowCount;if("only-body"===t.heightAdaptiveMode){const n=t.getRowsHeight(0,t.columnHeaderLevelCount-1),r=t.isPivotChart()?t.getBottomFrozenRowsHeight():0;e=t.tableNoFrameHeight-n-r,i=t.columnHeaderLevelCount,o=t.isPivotChart()?t.rowCount-t.bottomFrozenRowCount:t.rowCount}let a=0;for(let e=i;e<o;e++)a+=n&&null!==(r=b[e])&&void 0!==r?r:t.getRowHeight(e);const l=e/a;for(let r=i;r<o;r++){let a;a=r===o-1?e-(n?b.reduce(((t,e,n)=>n>=i&&n<=o-2?t+e:t),0):t.getRowsHeight(i,o-2)):Math.round((n&&null!==(s=b[r])&&void 0!==s?s:t.getRowHeight(r))*l),n?b[r]=a:t._setRowHeight(r,a,!1)}}else if(t.autoFillHeight){t._clearRowRangeHeightsMap();const e=t.tableNoFrameHeight;let i=0,o=0;for(let e=0;e<t.rowCount;e++){const r=n&&null!==(a=b[e])&&void 0!==a?a:t.getRowHeight(e);(e<t.columnHeaderLevelCount||t.isPivotChart()&&e>=t.rowCount-t.bottomFrozenRowCount)&&(o+=r),i+=r}if(t.scenegraph._dealAutoFillHeightOriginRowsHeight=i,i<e&&i-o>0){const r=t.columnHeaderLevelCount,s=t.isPivotChart()?t.rowCount-t.bottomFrozenRowCount:t.rowCount,a=(e-o)/(i-o);for(let i=r;i<s;i++){let h;h=i===s-1?e-o-(n?b.reduce(((t,e,i)=>i>=r&&i<=s-2?t+e:t),0):t.getRowsHeight(r,s-2)):Math.round((n&&null!==(l=b[i])&&void 0!==l?l:t.getRowHeight(i))*a),n?b[i]=h:t._setRowHeight(i,h,!1)}}}if(n){for(let o=e;o<=i;o++){const e=null!==(h=b[o])&&void 0!==h?h:t.getRowHeight(o);ot(e)&&t._setRowHeight(o,e)}for(let e=0;e<=t.frozenRowCount-1;e++){const i=t.getRowHeight(e);i!==(null!==(d=v[e])&&void 0!==d?d:t.getRowHeight(e))&&t.scenegraph.updateRowHeight(e,i-(null!==(c=v[e])&&void 0!==c?c:t.getRowHeight(e)),!0)}for(let e=t.rowCount-t.bottomFrozenRowCount;e<=t.rowCount-1;e++){const i=t.getRowHeight(e);i!==(null!==(u=v[e])&&void 0!==u?u:t.getRowHeight(e))&&t.scenegraph.updateRowHeight(e,i-(null!==(g=v[e])&&void 0!==g?g:t.getRowHeight(e)),!0)}for(let e=t.scenegraph.proxy.rowStart;e<=t.scenegraph.proxy.rowEnd;e++){const i=t.getRowHeight(e);i!==(null!==(p=v[e])&&void 0!==p?p:t.getRowHeight(e))&&t.scenegraph.updateRowHeight(e,i-(null!==(f=v[e])&&void 0!==f?f:t.getRowHeight(e)),!0)}}t.isPivotTable()&&(m.disableUseGetBodyCache(),m.disableUseHeaderPathCache())}function AT(t,e,i,o){var n;if(!(o.isAutoRowHeight(t)||"adaptive"===o.heightMode&&!1!==o.options.autoHeightInAdaptiveMode)&&"auto"!==o.getDefaultRowHeight(t))return o.getDefaultRowHeight(t);let r;if(o.options.customComputeRowHeight){const e=o.options.customComputeRowHeight({row:t,table:o});if("number"==typeof e)return e;if("auto"!==e)return o.getDefaultRowHeight(t)}if(o.isPivotChart()&&t>=o.columnHeaderLevelCount&&t<o.rowCount-o.bottomFrozenRowCount)if(o.internalProps.layoutMap.indicatorsAsCol){const e=o.internalProps.layoutMap.getOptimunHeightForChart(t);if(e>0)return e}else{const e=o.getDefaultRowHeight(t);if(ut(e))return e}for(let s=e;s<=i;s++){const e=TT(s,t,o);if(e&&(r=ot(r)?Math.max(e.height,r):e.height,!e.renderDefault))continue;if(o.isPivotChart()){const e=o.internalProps.layoutMap.getAxisConfigInPivotChart(s,t);if(e){const t=a_.getFunction("computeAxisComponentHeight")(e,o);if("number"==typeof t){r=ot(r)?Math.max(t,r):t;continue}}}if(o.isPivotChart()&&(o.isLeftFrozenColumn(s)&&o.isBottomFrozenRow(t)||o.isRightFrozenColumn(s)&&o.isBottomFrozenRow(t)))continue;const i=kT(s,t,o.isHeader(s,t)?null===(n=o._getHeaderLayoutMap(s,t))||void 0===n?void 0:n.headerType:o.getBodyColumnType(s,t),o);r=ot(r)?Math.max(i,r):i}if(ot(r))return r;const s=o.getDefaultRowHeight(t);return ut(s)?s:o.defaultRowHeight}function BT(t,e){var i,o,n;const{layoutMap:r}=t.internalProps;if((t.internalProps.autoWrapText||t.internalProps.enableLineBreak)&&(t.isAutoRowHeight(e)||"adaptive"===t.options.heightMode))return!1;const s=r.getBody(t.rowHeaderLevelCount,e);if("function"==typeof s.style||"function"==typeof s.icon||(null===(i=s.define)||void 0===i?void 0:i.customRender)||(null===(o=s.define)||void 0===o?void 0:o.customLayout)||"function"==typeof(null===(n=s.define)||void 0===n?void 0:n.icon))return!1;const a=t._getCellStyle(t.rowHeaderLevelCount,e);return"function"!=typeof a.padding&&"function"!=typeof a.fontSize&&"function"!=typeof a.lineHeight&&!0!==a.autoWrapText}function RT(t,e){var i,o,n;const{layoutMap:r}=t.internalProps;if(t.internalProps.autoWrapText&&(t.isAutoRowHeight(e)||"adaptive"===t.options.heightMode))return!1;const s=r.getHeader(t.rowHeaderLevelCount,e);if("function"==typeof s.style||"function"==typeof s.icons||(null===(i=s.define)||void 0===i?void 0:i.headerCustomRender)||(null===(o=s.define)||void 0===o?void 0:o.headerCustomLayout)||"function"==typeof(null===(n=s.define)||void 0===n?void 0:n.icon))return!1;const a=t._getCellStyle(t.rowHeaderLevelCount,e);return"function"!=typeof a.padding&&"function"!=typeof a.fontSize&&"function"!=typeof a.lineHeight&&!0!==a.autoWrapText}function TT(t,e,i){var o,n,r,s,a,l,h;const d=i.getCustomRender(t,e);let c=i.getCustomLayout(t,e);if(d||c){let u,g=1,p=0,f=!1,v=!1;(i.isHeader(t,e)||(null===(o=i.getBodyColumnDefine(t,e))||void 0===o?void 0:o.mergeCell)||i.hasCustomMerge())&&(u=i.getCellRange(t,e),g=u.end.row-u.start.row+1);const b={col:null!==(n=null==u?void 0:u.start.col)&&void 0!==n?n:t,row:null!==(r=null==u?void 0:u.start.row)&&void 0!==r?r:e,dataValue:i.getCellOriginValue(t,e),value:i.getCellValue(t,e)||"",rect:MT(t,e,i),table:i,originCol:t,originRow:e,forComputation:!0};if("react-custom-layout"===c&&(c=(null===(s=i.reactCustomLayout)||void 0===s?void 0:s.getCustomLayoutFunc(t,e))||GB),et(c)){const e=c(b);e.rootContainer?(e.rootContainer=tR(e.rootContainer),QB(e.rootContainer,i.getColWidth(t),0),e.rootContainer.setStage(i.scenegraph.stage),p=null!==(a=e.rootContainer.AABBBounds.height())&&void 0!==a?a:0,f=e.renderDefault,v=e.enableCellPadding):(p=0,f=e.renderDefault,v=e.enableCellPadding)}else if("function"==typeof d){const t=d(b);p=null!==(l=null==t?void 0:t.expectedHeight)&&void 0!==l?l:0,f=null==t?void 0:t.renderDefault}else p=null!==(h=null==d?void 0:d.expectedHeight)&&void 0!==h?h:0,f=null==d?void 0:d.renderDefault;if(v){const o=tB(FR("padding",i._getCellStyle(t,e),t,e,i));p+=o[0]+o[2]}return{height:p/g,renderDefault:f}}}function kT(t,e,i,o){var n,r,s,a;let l=0;const h=o.getCellValue(t,e),d=o._getCellStyle(t,e);let c=0,u=0;const g=[];let p=0;const f=[];let v=0,b=!1;if("body"!==o.getCellLocation(t,e))b=!0;else{const i=o.getBodyColumnDefine(t,e);b=!!(null==i?void 0:i.icon)||!!(null==i?void 0:i.tree)||(null==i?void 0:i.dragOrder)}if(b){const i=o.getCellIcons(t,e);null==i||i.forEach((t=>{var e,i,o,n,r,s,a,l,h,d;t.positionType!==rw.absoluteRight&&t.positionType!==rw.inlineFront&&t.positionType!==rw.inlineEnd?(u+=(null!==(e=t.width)&&void 0!==e?e:0)+(null!==(i=t.marginLeft)&&void 0!==i?i:0)+(null!==(o=t.marginRight)&&void 0!==o?o:0),c=Math.max(c,null!==(n=t.height)&&void 0!==n?n:0)):t.positionType===rw.inlineFront?(g.push(t),p=Math.max(p,(null!==(r=t.height)&&void 0!==r?r:0)+(null!==(s=t.marginLeft)&&void 0!==s?s:0)+(null!==(a=t.marginRight)&&void 0!==a?a:0))):t.positionType===rw.inlineEnd&&(f.push(t),v=Math.max(v,(null!==(l=t.height)&&void 0!==l?l:0)+(null!==(h=t.marginLeft)&&void 0!==h?h:0)+(null!==(d=t.marginRight)&&void 0!==d?d:0)))}))}let m=1,y=t;if(o.isHeader(t,e)||(null===(n=o.getBodyColumnDefine(t,e))||void 0===n?void 0:n.mergeCell)||o.hasCustomMerge()){const i=o.getCellRange(t,e);m=i.end.row-i.start.row+1,t=i.start.col,y=i.end.col}const C=tB(FR("padding",d,t,e,o)),w=FR("fontSize",d,t,e,o),x=FR("fontStyle",d,t,e,o),_=FR("fontWeight",d,t,e,o),S=null!==(r=FR("lineHeight",d,t,e,o))&&void 0!==r?r:w,A=FR("fontFamily",d,t,e,o),B=FR("autoWrapText",d,t,e,o),R=FR("lineClamp",d,t,e,o),T=FR("underline",d,t,e,o),k=null!==(s=FR("underlineOffset",d,t,e,o))&&void 0!==s?s:0;let M;if("text"!==i&&"link"!==i&&"progressbar"!==i&&"checkbox"!==i&&"radio"!==i&&"switch"!==i&&"button"!==i)l=S;else if("checkbox"===i)l=function(t,e,i,o,n,r,s,a,l,h,d,c,u,g,p){const f=Kw(nt(t)?t.text:t).split("\n")||[],v=p.getColsWidth(e,o),b=FR("size",n,e,i,p);let m=0;if(r){const t=FR("spaceBetweenTextAndIcon",n,e,i,p),o=v-(g[1]+g[3])-s-b-t;cT.setAttributes({text:{maxLineWidth:o,text:f,fontSize:a,fontStyle:l,fontWeight:h,fontFamily:d,lineHeight:c,wordBreak:"break-word",lineClamp:u},icon:{width:Math.floor(b/1.4),height:Math.floor(b/1.4)},box:{width:b,height:b},spaceBetweenTextAndIcon:t}),cT.render(),m=cT.AABBBounds.height()}else m=Math.max(b,f.length*c);return m}(h,t,e,y,d,B,u,w,x,_,A,S,R,C,o);else if("radio"===i)l=function(t,e,i,o,n,r,s,a,l,h,d,c,u,g,p){var f;if(ht(t)){let v=0;const b=p.getBodyColumnDefine(e,i),m=FR("spaceBetweenRadio",n,e,i,p),y=null!==(f=null==b?void 0:b.radioDirectionInCell)&&void 0!==f?f:"vertical";return"vertical"===y?t.forEach(((f,b)=>{const y=pT(f,e,i,o,n,r,s,a,l,h,d,c,u,g,p);v+=y,b!==t.length-1&&(v+=m)})):"horizontal"===y&&t.forEach((t=>{const f=pT(t,e,i,o,n,r,s,a,l,h,d,c,u,g,p);v=Math.max(f,v)})),v}return pT(t,e,i,o,n,r,s,a,l,h,d,c,u,g,p)}(h,t,e,y,d,B,u,w,x,_,A,S,R,C,o);else if("switch"===i)l=function(t,e,i,o,n,r,s,a,l,h,d,c,u,g,p){return FR("boxWidth",n,e,i,p)}(0,t,e,0,d,0,0,0,0,0,0,0,0,0,o);else if("button"===i)l=function(t,e,i,o,n,r,s,a,l,h,d,c,u,g,p){const f=Kw(nt(t)?t.text:t).split("\n")||[],v=p.getColsWidth(e,o),b=FR("buttonPadding",n,e,i,p),m=FR("buttonLineWidth",n,e,i,p);let y=0;if(r){const t=v-(g[1]+g[3]);gT.setAttributes({text:f,textStyle:{maxLineWidth:t,fontSize:a,fontStyle:l,fontWeight:h,fontFamily:d,lineHeight:c,wordBreak:"break-word",lineClamp:u},padding:b,panel:{visible:!0,fill:"red",stroke:"red",lineWidth:m}}),uT.render(),y=uT.AABBBounds.height()}else y=f.length*c+2*b;return y}(h,t,e,y,d,B,0,w,x,_,A,S,R,C,o);else{M=h;const i=WR(M,o).text,n=o.getColsWidth(t,y);if(g.length||f.length)if(B){const t=Object.assign({text:null==h?void 0:h.toString(),fontFamily:A,fontSize:w,fontStyle:x,fontWeight:_,lineHeight:S});t.textBaseline="middle";const e=[...g.map((t=>GR(t))),t,...f.map((t=>GR(t)))];_T.setAttributes({width:n-(C[1]+C[3])-u,height:0,textConfig:e}),l=_T.AABBBounds.height()}else l=0,i.forEach(((t,e)=>{var n;(null===(n=o.options.customConfig)||void 0===n?void 0:n.multilinesForXTable)&&0!==e||(0===e&&g.length?l+=Math.max(S,p):e===i.length-1&&f.length?l+=Math.max(S,v):l+=S)}));else if(B){const r=DR(t,e,o),s=xT({maxLineWidth:n-(C[1]+C[3])-u-r,text:i,fontSize:w,fontStyle:x,fontWeight:_,fontFamily:A,lineHeight:S,wordBreak:"break-word",whiteSpace:1!==i.length||B?"normal":"no-wrap",lineClamp:R});l=(s.height()||("number"==typeof S?S:w))+(T?k:0)}else l=(null===(a=o.options.customConfig)||void 0===a?void 0:a.multilinesForXTable)?S:i.length*S}return(Math.max(l,c)+C[0]+C[2])/m}function MT(t,e,i){return{left:0,top:0,right:i.getColWidth(t),bottom:i.getRowHeight(e),width:i.getColWidth(t),height:0}}function LT(t,e){if(!e||!e.proxy)return{colStart:0,colEnd:0,rowStart:0,rowEnd:0};const{mergeStartCol:i,mergeEndCol:o,mergeStartRow:n,mergeEndRow:r,col:s,row:a}=t;return{colStart:i,colEnd:o,rowStart:n,rowEnd:r}}function PT(t,e,i,o){o||t.table._setRowHeight(e,t.table.getRowHeight(e)+i,!0);for(let o=0;o<t.table.colCount;o++){const n=t.getCell(o,e);if("empty"===n.role)continue;const r=s_(t.table,o,e);r&&r.start.col!==o||(ET(t,n,o,e,n.attribute.height+i,i,t.table.isHeader(o,e)),t.updateCellContentWhileResize(o,e))}let n=0,r=0;e<t.table.frozenRowCount?(n=e+1,r=t.table.frozenRowCount-1):e>=t.table.rowCount-t.table.bottomFrozenRowCount?(n=e+1,r=t.table.rowCount-1):(n=e+1,r=Math.min(t.proxy.rowEnd,t.table.rowCount-t.table.bottomFrozenRowCount-1));for(let e=0;e<t.table.colCount;e++)for(let o=n;o<=r;o++){const n=t.highPerformanceGetCell(e,o);"cell"===n.role&&n.setAttribute("y",n.attribute.y+i)}}function ET(t,e,i,o,n,r,s){e&&function(t,e,i,o,n,r,s){var a,l,h,d,c;if(e.attribute.height===n&&!e.needUpdateHeight)return;e.needUpdateHeight=!1,e.setAttribute("height",n);const u=null===(a=t.table.getCellRawRecord(i,o))||void 0===a?void 0:a.vtableMerge,g=!!t.table.getCustomMerge(i,o),p=u||g?"text":t.table.isHeader(i,o)?null!==(l=t.table._getHeaderLayoutMap(i,o).headerType)&&void 0!==l?l:"text":null!==(h=t.table.getBodyColumnType(i,o))&&void 0!==h?h:"text";if("progressbar"===p){const s=t.table.getBodyColumnDefine(i,o),a=t.table._getCellStyle(i,o),l=t.table.getCellValue(i,o),h=t.table.getCellOriginValue(i,o),d=tB(FR("padding",a,i,o,t.table));let c;(null==s?void 0:s.mergeCell)&&(c=t.table.getCellRange(i,o));const u=a_.getFunction("createProgressBarCell")(s,a,e.attribute.width,l,h,i,o,d,t.table,c),g=e.getChildByName("progress-bar");e.insertBefore(u,g),e.removeChild(g),g.removeAllChild(),g.release(),HT(e,n,r,t.table.isAutoRowHeight(o),!0,t.table)}else if("sparkline"===p){e.removeAllChild();const n=t.table._getCellStyle(i,o),r=tB(FR("padding",n,i,o,t.table));a_.getFunction("createSparkLineCellGroup")(e,e.parent,e.attribute.x,e.attribute.y,i,o,e.attribute.width,e.attribute.height,r,t.table,IB(n,t.table,i,o,FR).theme,!1)}else if("image"===p||"video"===p)KR(e,i,o,0,0,t.table);else if("axis"===(null===(d=e.firstChild)||void 0===d?void 0:d.name))null===(c=e.firstChild)||void 0===c||c.originAxis.resize(e.attribute.width,e.attribute.height);else{let s=!0;const a=e.getChildByName(KB)||e.getChildByName(qB);if(a){let n;e.removeChild(a);const r=hT(i,o,e,t.table);if(r)for(let e=r.start.row;e<=r.end.row;e++){if(e===o)continue;const n=t.getCell(i,e),r=n.getChildByName(KB)||n.getChildByName(qB);r.removeAllChild(),n.removeChild(r),hT(i,e,n,t.table)}else{let r,a;const l=t.table.getCellLocation(i,o),{vtableMerge:h}=t.table.getCellRawRecord(i,o)||{};if(h&&t.table.options.groupTitleCustomLayout)a=t.table.options.groupTitleCustomLayout;else if("body"!==l){const e=t.table.getHeaderDefine(i,o);r=null==e?void 0:e.headerCustomRender,a=null==e?void 0:e.headerCustomLayout}else{const e=t.table.getBodyColumnDefine(i,o);r=(null==e?void 0:e.customRender)||t.table.customRender,a=null==e?void 0:e.customLayout}if((r||a)&&dT(e))for(let i=e.mergeStartCol;i<=e.mergeEndCol;i++)for(let n=e.mergeStartRow;n<=e.mergeEndRow;n++)n!==o&&t.updateCellContent(i,n);if(a||r){const l=tB(FR("padding",t.table._getCellStyle(i,o),i,o,t.table));let h=e.attribute.width,d=e.attribute.height;dT(e)&&(h=t.table.getColsWidth(e.mergeStartCol,e.mergeEndCol),d=t.table.getRowsHeight(e.mergeStartRow,e.mergeEndRow));const c=ZB(a,r,i,o,h,d,!1,t.table.isAutoRowHeight(o),l,dT(e)?{start:{col:e.mergeStartCol,row:e.mergeStartRow},end:{col:e.mergeEndCol,row:e.mergeEndRow}}:void 0,t.table);n=c.elementsGroup,s=c.renderDefault}e.childrenCount>0&&n?e.insertBefore(n,e.firstChild):n&&e.appendChild(n)}}HT(e,n,r,t.table.isAutoRowHeight(o),s,t.table)}}(t,e,i,o,n,r)}function HT(t,e,i,o,n,r){if(dT(t)){e=0;for(let i=t.mergeStartRow;i<=t.mergeEndRow;i++)e+=r.getRowHeight(i);const{colStart:i,colEnd:s,rowStart:a,rowEnd:l}=LT(t,r.scenegraph);for(let h=i;h<=s;h++)for(let s=a;s<=l;s++){const l=r.scenegraph.getCell(h,s);if("cell"!==l.role)continue;if(l.forEachChildren((t=>{t.setAttributes({dx:0,dy:0})})),n){const t=r._getCellStyle(i,a);VR(l,e,0,o,tB(FR("padding",t,h,s,r)),t.textAlign,t.textBaseline,r)}const d=r.getRowHeight(s),c=r.getColWidth(h);l.contentHeight=e;const{widthChange:u}=lT(l,c,d,{start:{col:t.mergeStartCol,row:t.mergeStartRow},end:{col:t.mergeEndCol,row:t.mergeEndRow}},r);u&&(l.needUpdateWidth=!0)}}else{const i=r._getCellStyle(t.col,t.row);VR(t,e,0,o,tB(FR("padding",i,t.col,t.row,r)),i.textAlign,i.textBaseline,r)}}function FT(t,e,i,o){var n,r,s,a,l,h,d;let c=!1;const u=null!==(n=null==t?void 0:t.attribute.width)&&void 0!==n?n:0;if(null==t||t.setAttribute("width",u+e),null==t||t.forEachChildren(((t,n)=>{if(function(t,e,i,o,n,r,s,a,l){var h,d,c,u,g,p,f;if(e.attribute.width===r&&!e.needUpdateWidth)return!1;e.needUpdateWidth=!1,e.setAttribute("width",r);const v=e;if(!v)return!1;const b=t.table.isAutoRowHeight(o),m=null===(h=t.table.getCellRawRecord(i,o))||void 0===h?void 0:h.vtableMerge,y=!!t.table.getCustomMerge(i,o),C=m||y?"text":t.table.isHeader(i,o)?null!==(d=t.table._getHeaderLayoutMap(i,o).headerType)&&void 0!==d?d:"text":null!==(c=t.table.getBodyColumnType(i,o))&&void 0!==c?c:"text";let w=!1;if("progressbar"===C){const e=t.table.getBodyColumnDefine(i,o),n=t.table._getCellStyle(i,o),a=t.table.getCellValue(i,o),l=t.table.getCellOriginValue(i,o),h=tB(FR("padding",n,i,o,t.table));let d;(null==e?void 0:e.mergeCell)&&(d=t.table.getCellRange(i,o));const c=a_.getFunction("createProgressBarCell")(e,n,v.attribute.width,a,l,i,o,h,t.table,d),u=v.getChildByName("progress-bar");v.insertBefore(c,u),v.removeChild(u),u.removeAllChild(),u.release();const g=OT(v,r,s,b,!0,t.table);w=w||g}else if("sparkline"===C){v.removeAllChild();const e=t.table._getCellStyle(i,o),n=tB(FR("padding",e,i,o,t.table));a_.getFunction("createSparkLineCellGroup")(v,v.parent,v.attribute.x,v.attribute.y,i,o,v.attribute.width,v.attribute.height,n,t.table,IB(e,t.table,i,o,FR).theme,!1)}else if("image"===C||"video"===C)KR(v,i,o,s,0,t.table);else if("axis"===(null===(u=v.firstChild)||void 0===u?void 0:u.name)){const e=t.table.internalProps.layoutMap.getAxisConfigInPivotChart(i,o),n=tB(FR("padding",t.table._getCellStyle(i,o),i,o,t.table));if(e){const i=new(a_.getComponent("axis"))(e,v.attribute.width,v.attribute.height,null!==(g=e.__vtablePadding)&&void 0!==g?g:n,t.table);v.clear(),v.appendChild(i.component),i.overlap()}}else if("axis"===(null===(p=e.firstChild)||void 0===p?void 0:p.name))null===(f=e.firstChild)||void 0===f||f.originAxis.resize(e.attribute.width,e.attribute.height);else{let n=!0;const a=e.getChildByName(KB)||e.getChildByName(qB);if(a){let r;e.removeChild(a);const s=hT(i,o,e,t.table);if(s)for(let e=s.start.col;e<=s.end.col;e++){if(e===i)continue;const n=t.getCell(e,o),r=n.getChildByName(KB)||n.getChildByName(qB);r.removeAllChild(),n.removeChild(r),hT(e,o,n,t.table)}else{let s,a;const l=t.table.getCellLocation(i,o),{vtableMerge:h}=t.table.getCellRawRecord(i,o)||{};if(h&&t.table.options.groupTitleCustomLayout)a=t.table.options.groupTitleCustomLayout;else if("body"!==l){const e=t.table.getHeaderDefine(i,o);s=null==e?void 0:e.headerCustomRender,a=null==e?void 0:e.headerCustomLayout}else{const e=t.table.getBodyColumnDefine(i,o);s=(null==e?void 0:e.customRender)||t.table.customRender,a=null==e?void 0:e.customLayout}if((s||a)&&dT(v))for(let e=v.mergeStartCol;e<=v.mergeEndCol;e++)if(e!==i)for(let i=v.mergeStartRow;i<=v.mergeEndRow;i++)t.updateCellContent(e,i);if(a||s){const e=tB(FR("padding",t.table._getCellStyle(i,o),i,o,t.table));let l=v.attribute.width,h=v.attribute.height;dT(v)&&(l=t.table.getColsWidth(v.mergeStartCol,v.mergeEndCol),h=t.table.getRowsHeight(v.mergeStartRow,v.mergeEndRow));const d=ZB(a,s,i,o,l,h,!1,t.table.isAutoRowHeight(o),e,dT(v)?{start:{col:v.mergeStartCol,row:v.mergeStartRow},end:{col:v.mergeEndCol,row:v.mergeEndRow}}:void 0,t.table);r=d.elementsGroup,n=d.renderDefault,w=!0}e.childrenCount>0&&r?e.insertBefore(r,e.firstChild):r&&e.appendChild(r)}}const l=OT(v,r,s,b,n,t.table);w=w||l}l||(l=t.table._getCellStyle(i,o).autoWrapText);return!(!b||!l)&&w}(o,t,t.col,t.row,0,u+e,e,"row-body"!==i||(t.col,o.table.rowHeaderLevelCount),o.table.internalProps.autoWrapText)){const e=s_(o.table,t.col,t.row);if(e&&e.end.row-e.start.row)for(let t=e.start.row;t<=e.end.row;t++)IT(o,t);else IT(o,t.row);c=!0}})),c){let t,e,n,c=0;for(let u=0;u<o.table.colCount;u++){if("col-corner"===i?(n=0,t=o.getColGroup(u,!0),e=null!==(r=o.colHeaderGroup.attribute.height)&&void 0!==r?r:0):"row-body"===i?(n=o.table.frozenRowCount,t=o.getColGroup(u,!1),e=null!==(s=o.bodyGroup.attribute.height)&&void 0!==s?s:0):"bottom"===i?(n=o.table.rowCount-o.table.bottomFrozenRowCount,t=o.getColGroupInBottom(u),e=null!==(a=o.bottomFrozenGroup.attribute.height)&&void 0!==a?a:0):"left-bottom"===i?(n=o.table.rowCount-o.table.bottomFrozenRowCount,t=o.getColGroupInLeftBottomCorner(u),e=null!==(l=o.leftBottomCornerGroup.attribute.height)&&void 0!==l?l:0):"right-top"===i?(n=0,t=o.getColGroupInRightTopCorner(u),e=null!==(h=o.rightTopCornerGroup.attribute.height)&&void 0!==h?h:0):"right-bottom"===i&&(n=o.table.rowCount-o.table.bottomFrozenRowCount,t=o.getColGroupInRightBottomCorner(u),e=null!==(d=o.rightBottomCornerGroup.attribute.height)&&void 0!==d?d:0),!t)continue;let g=0;t.forEachChildren((t=>{var e;t.setAttribute("y",g),g+=null!==(e=o.table.getRowHeight(t.row))&&void 0!==e?e:0})),c=g}o.updateContainerHeight(n,c-e);for(let t=0;t<o.table.frozenColCount;t++){const e=o.getColGroupInLeftBottomCorner(t);let i=0;null==e||e.forEachChildren((t=>{t.setAttribute("y",i),i+=o.table.getRowHeight(t.row)}))}for(let t=o.table.colCount-o.table.rightFrozenColCount;t<o.table.colCount;t++){const e=o.getColGroupInRightBottomCorner(t);let i=0;null==e||e.forEachChildren((t=>{t.setAttribute("y",i),i+=o.table.getRowHeight(t.row)}))}for(let t=o.table.frozenColCount;t<o.table.colCount-o.table.rightFrozenColCount;t++){const e=o.getColGroupInBottom(t);let i=0;null==e||e.forEachChildren((t=>{t.setAttribute("y",i),i+=o.table.getRowHeight(t.row)}))}}}function OT(t,e,i,o,n,r){if(dT(t)){e=0;let s=!1;for(let i=t.mergeStartCol;i<=t.mergeEndCol;i++)e+=r.getColWidth(i);let a=0;for(let e=t.mergeStartRow;e<=t.mergeEndRow;e++)a+=r.getRowHeight(e);const{colStart:l,colEnd:h,rowStart:d,rowEnd:c}=LT(t,r.scenegraph);for(let u=l;u<=h;u++)for(let h=d;h<=c;h++){if(u===t.col&&h!==t.row)continue;const c=r.scenegraph.getCell(u,h);if("cell"!==c.role)continue;c.forEachChildren((t=>{t.setAttributes({dx:0,dy:0})}));let g=!1;if(n){const t=r._getCellStyle(l,d);g=jR(c,e,a,i,o,tB(FR("padding",t,u,h,r)),t.textAlign,t.textBaseline,r.scenegraph);const n=DR(c.col,c.row,r);if(n){const t=c.getChildByName("text"),e=c.getChildByName("expand")||c.getChildByName("collapse");"icon-left"!==(null==e?void 0:e.role)&&t&&t.setAttribute("dx",n)}}const p=r.getRowHeight(h),f=r.getColWidth(u);c.contentWidth=e;const{heightChange:v}=lT(c,f,p,{start:{col:t.mergeStartCol,row:t.mergeStartRow},end:{col:t.mergeEndCol,row:t.mergeEndRow}},r);v&&(c.needUpdateHeight=!0),s=s||g}return s}const s=r._getCellStyle(t.col,t.row),a=tB(FR("padding",s,t.col,t.row,r)),l=s.textAlign,h=s.textBaseline;return jR(t,e,r.getRowHeight(t.row),i,o,a,l,h,r.scenegraph)}function IT(t,e){const i=Math.round(AT(e,0,t.table.colCount-1,t.table));t.table._setRowHeight(e,i,!0);for(let o=0;o<t.table.colCount;o++){const n=i,r=t.highPerformanceGetCell(o,e);"empty"!==r.role&&ET(t,r,o,e,n,n-r.attribute.height,t.table.isHeader(o,e))}}var zT;!function(t){t.dropDown="dropDown",t.contextmenu="contextmenu",t.custom="custom"}(zT||(zT={}));const DT=12,WT="Arial,sans-serif",NT="#000",GT="#2E68CF",jT="#EEE",VT=30,UT="#FFF",$T=4,XT=.5,YT="#CCC",KT=6,qT=9,ZT=200;const JT=LR();class QT{constructor(){const t=JT.drillDown;this.icon=new WB({x:-1e3,y:-1e3,image:t.svg,width:t.width,height:t.height,dx:-t.width/2,dy:-t.height/2,visible:!1,funcType:t.funcType,cursor:t.cursor}),this.icon.role="icon-drill"}appand(t){t.appendChild(this.icon)}update(t,e,i,o,n,r){if(!t||o&&n)return this.icon.setAttributes({x:-1e3,y:-1e3,visible:!1}),void r.updateNextFrame();const s=JT.drillDown,a=JT.drillUp;this.icon.setAttributes({x:e,y:i,image:o?s.svg:a.svg,visible:!0}),this.icon.loadImage(this.icon.attribute.image),r.updateNextFrame()}}class tk{constructor(t){const e=t.theme.dragHeaderSplitLine.lineWidth,i=t.theme.dragHeaderSplitLine.lineColor,o=t.theme.dragHeaderSplitLine.shadowBlockColor;this.columnMoverLabel=Zd({visible:!1,pickable:!1,x:0,y:0,symbolType:"triangle",fill:i}),this.columnMoverLine=tc({visible:!1,pickable:!1,stroke:i,lineWidth:e,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]}),this.columnMoverBack=oc({visible:!1,pickable:!1,fill:o,x:0,y:0,width:0,height:0}),this.table=t}appand(t){t.appendChild(this.columnMoverLabel),t.appendChild(this.columnMoverLine),t.appendChild(this.columnMoverBack)}show(t,e,i){const o=this.table.getCellLocation(t,e),n=s_(this.table,t,e);n&&(t=n.start.col,e=n.start.row);let r=0,s=0,a=0,l=0,h=0,d=0,c=0,u=0,g=Math.PI;const p=[];return"columnHeader"===o?(r=this.table.getColsWidth(0,t-1)-this.table.stateManager.scroll.horizontalBarPos,s=this.table.getRowsHeight(0,this.table.frozenRowCount-1),l=this.table.tableNoFrameHeight,a=n?this.table.getColsWidth(n.start.col,n.end.col):this.table.getColWidth(t),h=r-i,c=r+a,u=2,p.push({x:0,y:0}),p.push({x:0,y:this.table.tableNoFrameHeight})):("rowHeader"===o||this.table.internalProps.layoutMap.isSeriesNumberInBody(t,e))&&(s=this.table.getRowsHeight(0,e-1)-this.table.stateManager.scroll.verticalBarPos,r=this.table.getColsWidth(0,this.table.frozenColCount-1),a=this.table.tableNoFrameWidth,l=n?this.table.getRowsHeight(n.start.row,n.end.row):this.table.getRowHeight(e),d=s-i,c=2,u=s+l,g=Math.PI/2,p.push({x:0,y:0}),p.push({x:this.table.tableNoFrameWidth,y:0})),this.columnMoverBack.setAttributes({visible:!0,x:r-h,y:s-d,width:a,height:l,dx:h,dy:d}),this.columnMoverLine.setAttributes({x:c,y:u,visible:!0,points:p}),this.columnMoverLabel.setAttributes({visible:!0,x:c,y:u,angle:g}),{backX:r-h,lineX:c,backY:s-d,lineY:u}}hide(){this.columnMoverLabel.setAttribute("visible",!1),this.columnMoverLine.setAttribute("visible",!1),this.columnMoverBack.setAttribute("visible",!1)}update(t,e,i,o){"number"==typeof t&&"number"==typeof e?(this.columnMoverLabel.setAttribute("x",e),this.columnMoverLine.setAttribute("x",e),this.columnMoverBack.setAttribute("x",t)):"number"==typeof i&&"number"==typeof o&&(this.columnMoverLabel.setAttribute("y",o),this.columnMoverLine.setAttribute("y",o),this.columnMoverBack.setAttribute("y",i))}updateStyle(){const t=this.table.theme.dragHeaderSplitLine.lineWidth,e=this.table.theme.dragHeaderSplitLine.lineColor,i=this.table.theme.dragHeaderSplitLine.shadowBlockColor;this.columnMoverLabel.setAttributes({fill:e}),this.columnMoverLine.setAttributes({stroke:e,lineWidth:t}),this.columnMoverBack.setAttributes({fill:i})}}function ek(t,e,i){if(i)return Math.min(e.tableNoFrameWidth,e.getAllColsWidth())-e.getColsWidth(t,e.colCount-1);let o=e.getColsWidth(0,t);return t>=e.frozenColCount&&(o-=e.scrollLeft),o}function ik(t,e,i){if(i)return Math.min(e.tableNoFrameWidth,e.getAllRowsHeight())-e.getRowsHeight(t,e.rowCount-1);let o=e.getRowsHeight(0,t);return t>=e.frozenRowCount&&(o-=e.scrollTop),o}class ok{constructor(t){var e,i,o,n,r,s,a,l,h,d,c,u,g,p,f,v,b;this.table=t;const m=this.table.theme;this.createScrollBar();const y=null===(e=m.columnResize)||void 0===e?void 0:e.lineColor,C=null===(i=m.columnResize)||void 0===i?void 0:i.lineWidth,w=null===(o=m.columnResize)||void 0===o?void 0:o.bgColor,x=null===(n=m.columnResize)||void 0===n?void 0:n.width,_=null===(s=null===(r=m.columnResize)||void 0===r?void 0:r.labelVisible)||void 0===s||s,S=null===(a=m.columnResize)||void 0===a?void 0:a.labelColor,A=null===(l=m.columnResize)||void 0===l?void 0:l.labelFontSize,B=null===(h=m.columnResize)||void 0===h?void 0:h.labelFontFamily,R=null===(d=m.columnResize)||void 0===d?void 0:d.labelBackgroundFill,T=null===(c=m.columnResize)||void 0===c?void 0:c.labelBackgroundCornerRadius;this.labelVisible=_,this.columnResizeLine=tc({visible:!1,pickable:!1,stroke:y,lineWidth:C,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]}),this.columnResizeBgLine=tc({visible:!1,pickable:!1,stroke:w,lineWidth:x,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]});const k=Dh({visible:!1,pickable:!1,x:0,y:0,fontSize:A,fill:S,fontFamily:B,text:"",textBaseline:"top",dx:16,dy:-A/2}),M=oc({visible:!1,pickable:!1,fill:R,x:0,y:0,width:5*A*.8,height:A+8,cornerRadius:T,dx:12,dy:-A/2-4});this.columnResizeLabel=bs({visible:!1,pickable:!1,x:0,y:0}),this.columnResizeLabel.appendChild(M),this.columnResizeLabel.appendChild(k),this.rowResizeLine=tc({visible:!1,pickable:!1,stroke:y,lineWidth:C,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]}),this.rowResizeBgLine=tc({visible:!1,pickable:!1,stroke:w,lineWidth:x,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]});const L=Dh({visible:!1,pickable:!1,x:0,y:0,fontSize:A,fill:S,fontFamily:B,text:"",textBaseline:"top",dx:16,dy:-A/2}),P=oc({visible:!1,pickable:!1,fill:R,x:0,y:0,width:5*A*.8,height:A+8,cornerRadius:T,dx:12,dy:-A/2-4});this.rowResizeLabel=bs({visible:!1,pickable:!1,x:0,y:0}),this.rowResizeLabel.appendChild(P),this.rowResizeLabel.appendChild(L),this.cellMover=new tk(this.table);const E=null===(g=null===(u=m.frozenColumnLine)||void 0===u?void 0:u.shadow)||void 0===g?void 0:g.width,H=null===(f=null===(p=m.frozenColumnLine)||void 0===p?void 0:p.shadow)||void 0===f?void 0:f.startColor,F=null===(b=null===(v=m.frozenColumnLine)||void 0===v?void 0:v.shadow)||void 0===b?void 0:b.endColor;this.frozenShadowLine=oc({visible:!0,pickable:!1,x:0,y:0,width:E,height:0,fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:[{color:H,offset:0},{color:F,offset:1}]}}),this.rightFrozenShadowLine=oc({visible:!0,pickable:!1,x:0,y:0,width:E,height:0,fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:[{color:F,offset:0},{color:H,offset:1}]}}),this.menu=new class{constructor(t){this._table=t,this._menuInstance=new PR({x:0,y:0,fill:UT,stroke:YT,cornerRadius:$T,lineWidth:XT}),this._menuInfo={x:-1,y:-1,col:-1,row:-1,type:zT.dropDown,menuInfo:[],highlightIndex:-1}}bindTableComponent(t){t.appendChild(this._menuInstance),this.bindEvent()}release(){}attach(t,e,i,o,n,r){if(n===zT.dropDown&&this.checkDropDownMenuChange(i,o)){const t=this.getMenuInfo(i,o,n);if(!t)return;const{menuInfo:e,highlightIndex:r}=t;this.updateMenuInfo(i,o,n,e,r),this.updateMenuInstance(e,r)}else if(n===zT.contextmenu&&this.checkContextMenuChange(t,e)){const t=this.getMenuInfo(i,o,n);if(!t)return;const{menuInfo:e,highlightIndex:r}=t;this.updateMenuInfo(i,o,n,e,r),this.updateMenuInstance(e,r)}this.updatePosition(t-this._table.scenegraph.x,e-this._table.scenegraph.y),this.addToScene()}updateMenuInfo(t,e,i,o,n){this._menuInfo.col=t,this._menuInfo.row=e,this._menuInfo.type=i,this._menuInfo.menuInfo=o,this._menuInfo.highlightIndex=n}checkDropDownMenuChange(t,e){const{type:i,col:o,row:n}=this._menuInfo;return i!==zT.dropDown||t!==o||e!==n}checkContextMenuChange(t,e){var i;const{type:o,menuInfo:n}=this._menuInfo;return o!==zT.contextmenu||n!==(null===(i=this._table.internalProps.menu)||void 0===i?void 0:i.contextMenuItems)}updateMenuInstance(t,e){this._menuInstance.removeAllChild();let i=KT;const o=KT;let n=0;t.forEach(((t,r)=>{var s,a;const l=e===r;let h,d;"string"==typeof t?d=t:"object"==typeof t&&(d=t.text,h=l?t.selectedIcon:t.icon);const c=new PR({y:i,x:o,height:VT,fill:UT});c.role="menu-item",this._menuInstance.appendChild(c),c.stateProxy=t=>"hover"===t?{fill:jT}:{fill:UT},c.addEventListener("pointerenter",(t=>{c.addState("hover",!0,!1),this._table.scenegraph.updateNextFrame()})),c.addEventListener("pointerleave",(t=>{c.removeState("hover",!1),this._table.scenegraph.updateNextFrame()}));const u=new zh({x:qT,y:qT,fill:l?GT:NT,text:d,textBaseline:"top",fontSize:DT,fontFamily:WT,pickable:!1,maxLineWidth:ZT,ellipsis:"…"});if(c.addChild(u),h){u.AABBBounds.height();const t=null!==(s=h.width)&&void 0!==s?s:16,e=null!==(a=h.height)&&void 0!==a?a:16,i=new WB({x:qT,y:(VT-e)/2,width:t,height:e,image:h.svg,pickable:!1});i.role="menu-icon",c.insertBefore(i,u),u.setAttribute("x",t+qT)}n=Math.max(c.AABBBounds.width(),n),i+=VT})),this._menuInstance.setAttributes({width:n+2*qT+2*KT,height:i+KT}),this._menuInstance.forEachChildren((t=>{t.setAttribute("width",n+2*qT)}))}updatePosition(t,e){this._menuInstance.setAttributes({x:this._menuInfo.type===zT.dropDown?t-this._menuInstance.attribute.width:t,y:e}),this._menuInfo.x=zT.dropDown?t-this._menuInstance.attribute.width:t,this._menuInfo.y=e}addToScene(){this._table.scenegraph.updateNextFrame()}detach(){this._menuInstance.setAttributes({x:-1e3,y:-1e3}),this._table.scenegraph.updateNextFrame()}getMenuInfo(t,e,i){var o;if(i===zT.dropDown){let i=this._table.globalDropDownMenu;i=this._table._getHeaderLayoutMap(t,e).dropDownMenu,"function"==typeof i&&(i=i({row:e,col:t,table:this._table}));let o=-1;if(Array.isArray(i))for(let n=0;n<i.length;n++)if(this._table._dropDownMenuIsHighlight(t,e,n)){o=n;break}return{menuInfo:i,highlightIndex:o}}if(i===zT.contextmenu){const i=null===(o=this._table.internalProps.menu)||void 0===o?void 0:o.contextMenuItems;let n;if(Array.isArray(i))n=i;else if("function"==typeof i){const{field:o}=this._table.isHeader(t,e)?this._table.getHeaderDefine(t,e):this._table.getBodyColumnDefine(t,e);n=i(o,e,t)}return{menuInfo:n,highlightIndex:-1}}}bindEvent(){this._menuInstance.addEventListener("click",(t=>{const{target:e}=t;if(e&&"menu-item"===e.role){const i=this.getEventInfo(e),o=this._table.getMenuInfo(this._menuInfo.col,this._menuInfo.row,this._menuInfo.type),n=Object.assign(i,o);n.event=t.nativeEvent,this._table.fireListeners(Ax.DROPDOWN_MENU_CLICK,n)}}))}getEventInfo(t){const e=t.parent;let i=0;e.forEachChildren(((e,o)=>e===t&&(i=o-1,!0)));const o="string"==typeof this._menuInfo.menuInfo[i]?this._menuInfo.menuInfo[i]:this._menuInfo.menuInfo[i].text,n="string"==typeof this._menuInfo.menuInfo[i]?o:this._menuInfo.menuInfo[i].menuKey||o;return{col:this._menuInfo.col,row:this._menuInfo.row,dropDownIndex:i,highlight:i===this._menuInfo.highlightIndex,text:o,menuKey:n}}get bounds(){return this._menuInstance.globalAABBBounds}}(this.table),this.drillIcon=new QT}addToGroup(t){t.addChild(this.frozenShadowLine),t.addChild(this.rightFrozenShadowLine),t.addChild(this.columnResizeBgLine),t.addChild(this.columnResizeLine),t.addChild(this.columnResizeLabel),t.addChild(this.rowResizeBgLine),t.addChild(this.rowResizeLine),t.addChild(this.rowResizeLabel),this.table.theme.scrollStyle.hoverOn&&!this.table.theme.scrollStyle.barToSide?(t.addChild(this.hScrollBar),t.addChild(this.vScrollBar)):(t.stage.defaultLayer.addChild(this.hScrollBar),t.stage.defaultLayer.addChild(this.vScrollBar)),this.menu.bindTableComponent(t),this.drillIcon.appand(t),this.cellMover.appand(t)}createScrollBar(){var t,e,i,o,n,r;const s=this.table.theme,a=null===(t=s.scrollStyle)||void 0===t?void 0:t.scrollRailColor,l=null===(e=s.scrollStyle)||void 0===e?void 0:e.scrollSliderColor,h=null===(i=s.scrollStyle)||void 0===i?void 0:i.scrollSliderCornerRadius,d=null===(o=s.scrollStyle)||void 0===o?void 0:o.width,c=null===(n=s.scrollStyle)||void 0===n?void 0:n.horizontalPadding,u=null===(r=s.scrollStyle)||void 0===r?void 0:r.verticalPadding;let g;g=ot(h)?{cornerRadius:h,fill:l}:{fill:l},this.hScrollBar=new Nb({direction:"horizontal",x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,width:this.table.tableNoFrameWidth,height:d,padding:c,railStyle:{fill:a},sliderStyle:g,range:[0,.1],visible:!1}),this.hScrollBar.render(),this.hScrollBar.hideAll(),this.vScrollBar=new Nb({direction:"vertical",x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,width:d,height:this.table.tableNoFrameHeight-this.table.getFrozenRowsHeight(),padding:u,railStyle:{fill:a},sliderStyle:g,range:[0,.1],visible:!1}),this.vScrollBar.render(),this.vScrollBar.hideAll()}updateScrollBar(){var t,e,i,o,n,r,s;const a=this.table.stateManager.scroll.horizontalBarPos,l=this.table.stateManager.scroll.verticalBarPos,h=this.table.theme,d=null===(t=h.scrollStyle)||void 0===t?void 0:t.width,c=null===(e=h.scrollStyle)||void 0===e?void 0:e.visible,u=null!==(o=null===(i=h.scrollStyle)||void 0===i?void 0:i.horizontalVisible)&&void 0!==o?o:c,g=null!==(r=null===(n=h.scrollStyle)||void 0===n?void 0:n.verticalVisible)&&void 0!==r?r:c,p=Math.ceil(this.table.scenegraph.tableGroup.attribute.width),f=Math.ceil(this.table.scenegraph.tableGroup.attribute.height),v=this.table.getAllRowsHeight(),b=this.table.getAllColsWidth(),m=this.table.getFrozenRowsHeight(),y=this.table.getFrozenColsWidth(),C=this.table.getBottomFrozenRowsHeight(),w=this.table.getRightFrozenColsWidth(),x=(null===(s=this.table.options.customConfig)||void 0===s?void 0:s._disableColumnAndRowSizeRound)?1:0;if(b>p+x){const t=Math.min(f,v),e=Math.max(.05,(p-y)/(b-y)),i=this.table.theme.scrollStyle.hoverOn;let o=0;o=this.table.theme.scrollStyle.barToSide?this.table.tableNoFrameHeight-(i?d:-this.table.scenegraph.tableGroup.attribute.y)+this.table.tableY:t-(i?d:-this.table.scenegraph.tableGroup.attribute.y),this.hScrollBar.setAttributes({x:y+(i?0:this.table.scenegraph.tableGroup.attribute.x),y:o,width:p-y-w,range:[0,e],visible:"always"===u});const n=this.hScrollBar.AABBBounds&&this.hScrollBar.globalAABBBounds;this.hScrollBar._viewPosition={x:n.x1,y:n.y1},"always"===u&&this.hScrollBar.showAll()}else this.hScrollBar.setAttributes({x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,width:0,visible:!1});if(v>f+x){const t=Math.min(p,b),e=Math.max(.05,(f-m)/(v-m));let i=0;const o=this.table.theme.scrollStyle.hoverOn;i=this.table.theme.scrollStyle.barToSide?this.table.tableNoFrameWidth-(o?d:-this.table.scenegraph.tableGroup.attribute.x)+this.table.tableX:t-(o?d:-this.table.scenegraph.tableGroup.attribute.x),this.vScrollBar.setAttributes({x:i,y:m+(o?0:this.table.scenegraph.tableGroup.attribute.y),height:f-m-C,range:[0,e],visible:"always"===g});const n=this.vScrollBar.AABBBounds&&this.vScrollBar.globalAABBBounds;this.vScrollBar._viewPosition={x:n.x1,y:n.y1},"always"===g&&this.vScrollBar.showAll()}else this.vScrollBar.setAttributes({x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,height:0,visible:!1});this.table.stateManager.setScrollLeft(a),this.table.stateManager.setScrollTop(l)}hideResizeCol(){this.columnResizeLine.setAttribute("visible",!1),this.columnResizeBgLine.setAttribute("visible",!1),this.columnResizeLabel.setAttribute("visible",!1),this.columnResizeLabel.hideAll()}showResizeCol(t,e,i){const o=ek(t,this.table,i);this.columnResizeLine.setAttributes({visible:!0,x:o,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.columnResizeBgLine.setAttributes({visible:!0,x:o,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.labelVisible&&(this.columnResizeLabel.showAll(),this.columnResizeLabel.setAttributes({visible:!0,x:o,y:e}),this.columnResizeLabel.lastChild.setAttribute("text",`${this.table.getColWidth(t)}px`))}updateResizeCol(t,e,i){const o=ek(t,this.table,i);this.columnResizeLine.setAttributes({x:o,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.columnResizeBgLine.setAttributes({x:o,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.labelVisible&&(this.columnResizeLabel.setAttributes({x:o,y:e}),this.columnResizeLabel.lastChild.setAttribute("text",`${Math.floor(this.table.getColWidth(t))}px`))}hideResizeRow(){this.rowResizeLine.setAttribute("visible",!1),this.rowResizeBgLine.setAttribute("visible",!1),this.rowResizeLabel.setAttribute("visible",!1),this.rowResizeLabel.hideAll()}showResizeRow(t,e,i){const o=ik(t,this.table,i);this.rowResizeLine.setAttributes({visible:!0,y:o,points:[{y:0,x:0},{y:0,x:this.table.getColsWidth(0,this.table.colCount-1)}]}),this.rowResizeBgLine.setAttributes({visible:!0,y:o,points:[{y:0,x:0},{y:0,x:this.table.getColsWidth(0,this.table.colCount-1)}]}),this.labelVisible&&(this.rowResizeLabel.showAll(),this.rowResizeLabel.setAttributes({visible:!0,y:o,x:e}),this.rowResizeLabel.lastChild.setAttribute("text",`${this.table.getRowHeight(t)}px`))}updateResizeRow(t,e,i){const o=ik(t,this.table,i);this.rowResizeLine.setAttributes({y:o,points:[{y:0,x:0},{y:0,x:this.table.getColsWidth(0,this.table.colCount-1)}]}),this.rowResizeBgLine.setAttributes({y:o,points:[{y:0,x:0},{y:0,x:this.table.getColsWidth(0,this.table.colCount-1)}]}),this.labelVisible&&(this.rowResizeLabel.setAttributes({y:o,x:e}),this.rowResizeLabel.lastChild.setAttribute("text",`${Math.floor(this.table.getRowHeight(t))}px`))}hideMoveCol(){this.cellMover.hide()}showMoveCol(t,e,i){return this.cellMover.show(t,e,i)}updateMoveCol(t,e,i,o){this.cellMover.update(t,e,i,o)}setFrozenColumnShadow(t,e){if(t<0)this.frozenShadowLine.setAttributes({visible:!1});else{const i=ek(t,this.table,e);this.frozenShadowLine.setAttributes({visible:!0,x:i,height:this.table.getDrawRange().height})}}setRightFrozenColumnShadow(t){if(t>=this.table.colCount)this.rightFrozenShadowLine.setAttributes({visible:!1});else{const e=ek(t,this.table,!0);this.rightFrozenShadowLine.setAttributes({visible:!0,x:e-this.rightFrozenShadowLine.attribute.width,height:this.table.getDrawRange().height})}}hideVerticalScrollBar(){var t;const e=this.table.theme.scrollStyle.visible,i=null!==(t=this.table.theme.scrollStyle.verticalVisible)&&void 0!==t?t:e;"focus"!==i&&"scrolling"!==i||(this.vScrollBar.setAttribute("visible",!1),this.vScrollBar.hideAll(),this.table.scenegraph.updateNextFrame())}showVerticalScrollBar(){var t;const e=this.table.theme.scrollStyle.visible,i=null!==(t=this.table.theme.scrollStyle.verticalVisible)&&void 0!==t?t:e;"focus"!==i&&"scrolling"!==i||(this.vScrollBar.setAttribute("visible",!0),this.vScrollBar.showAll(),this.table.scenegraph.updateNextFrame())}hideHorizontalScrollBar(){var t;const e=this.table.theme.scrollStyle.visible,i=null!==(t=this.table.theme.scrollStyle.horizontalVisible)&&void 0!==t?t:e;"focus"!==i&&"scrolling"!==i||(this.hScrollBar.setAttribute("visible",!1),this.hScrollBar.hideAll(),this.table.scenegraph.updateNextFrame())}showHorizontalScrollBar(){var t;const e=this.table.theme.scrollStyle.visible,i=null!==(t=this.table.theme.scrollStyle.horizontalVisible)&&void 0!==t?t:e;"focus"!==i&&"scrolling"!==i||(this.hScrollBar.setAttribute("visible",!0),this.hScrollBar.showAll(),this.table.scenegraph.updateNextFrame())}updateVerticalScrollBarPos(t){const e=this.vScrollBar.attribute.range,i=e[1]-e[0],o=t*(1-i);this.vScrollBar.setAttribute("range",[o,o+i]);const n=this.vScrollBar.AABBBounds&&this.vScrollBar.globalAABBBounds;this.vScrollBar._viewPosition={x:n.x1,y:n.y1}}updateHorizontalScrollBarPos(t){const e=this.hScrollBar.attribute.range,i=e[1]-e[0],o=t*(1-i);this.hScrollBar.setAttribute("range",[o,o+i]);const n=this.hScrollBar.AABBBounds&&this.hScrollBar.globalAABBBounds;this.hScrollBar._viewPosition={x:n.x1,y:n.y1}}updateStyle(){var t,e,i,o,n,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x;const _=this.table.theme,S=null===(t=_.scrollStyle)||void 0===t?void 0:t.scrollRailColor,A=null===(e=_.scrollStyle)||void 0===e?void 0:e.scrollSliderColor,B=null===(i=_.scrollStyle)||void 0===i?void 0:i.scrollSliderCornerRadius,R=null===(o=_.scrollStyle)||void 0===o?void 0:o.width,T=null===(n=_.scrollStyle)||void 0===n?void 0:n.horizontalPadding,k=null===(r=_.scrollStyle)||void 0===r?void 0:r.verticalPadding;let M;M=ot(B)?{cornerRadius:B,fill:A}:{fill:A},this.hScrollBar.setAttributes({height:R,padding:T,railStyle:{fill:S},sliderStyle:M}),this.vScrollBar.setAttributes({width:R,padding:k,railStyle:{fill:S},sliderStyle:M});const L=null===(s=_.columnResize)||void 0===s?void 0:s.lineColor,P=null===(a=_.columnResize)||void 0===a?void 0:a.lineWidth,E=null===(l=_.columnResize)||void 0===l?void 0:l.bgColor,H=null===(h=_.columnResize)||void 0===h?void 0:h.width;this.columnResizeLine.setAttributes({stroke:L,lineWidth:P}),this.columnResizeBgLine=tc({stroke:E,lineWidth:H});const F=null===(d=_.columnResize)||void 0===d?void 0:d.labelColor,O=null===(c=_.columnResize)||void 0===c?void 0:c.labelFontSize,I=null===(u=_.columnResize)||void 0===u?void 0:u.labelFontFamily,z=null===(g=_.columnResize)||void 0===g?void 0:g.labelBackgroundFill,D=null===(p=_.columnResize)||void 0===p?void 0:p.labelBackgroundCornerRadius,W=null===(v=null===(f=_.columnResize)||void 0===f?void 0:f.labelVisible)||void 0===v||v;this.labelVisible=W,this.columnResizeLabel.lastChild.setAttributes({fontSize:O,fill:F,fontFamily:I,dy:-O/2}),this.columnResizeLabel.firstChild.setAttributes({fill:z,width:5*O*.8,height:O+8,cornerRadius:D,dy:-O/2-4}),this.rowResizeLabel.lastChild.setAttributes({fontSize:O,fill:F,fontFamily:I,dy:-O/2}),this.rowResizeLabel.firstChild.setAttributes({fill:z,width:5*O*.8,height:O+8,cornerRadius:D,dy:-O/2-4});const N=null===(m=null===(b=_.frozenColumnLine)||void 0===b?void 0:b.shadow)||void 0===m?void 0:m.width,G=null===(C=null===(y=_.frozenColumnLine)||void 0===y?void 0:y.shadow)||void 0===C?void 0:C.startColor,j=null===(x=null===(w=_.frozenColumnLine)||void 0===w?void 0:w.shadow)||void 0===x?void 0:x.endColor;this.frozenShadowLine.setAttributes({width:N,fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:[{color:G,offset:0},{color:j,offset:1}]}}),this.rightFrozenShadowLine.setAttributes({width:N,fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:[{color:j,offset:0},{color:G,offset:1}]}}),this.cellMover.updateStyle()}}function nk(t,e,i,o,n){var r,s,a,l,h,d;if(!e)return;const c="table"===i,{shadowBlur:u,shadowOffsetX:g,shadowOffsetY:p,shadowColor:f,cornerRadius:v,borderColor:b,borderLineWidth:m,borderLineDash:y}=e;let C=!1;const w={},x={pickable:!1};u&&c&&(x.shadowBlur=u,x.shadowOffsetX=g,x.shadowOffsetY=p,x.shadowColor=f,x.stroke=!0,x.stroke=f,x.lineWidth=1,C=!0),m&&(x.stroke=!0,x.fill=!1,x.stroke=sk(null!=b?b:"#E1E4E8",o,m),x.lineWidth=m,y&&(x.lineDash=y),x.lineCap="butt"),Array.isArray(b)&&(x.strokeArrayColor=tB(b)),Array.isArray(m)&&(x.strokeArrayWidth=tB(m),x.lineWidth=1),v&&(x.cornerRadius=v,w.cornerRadius=v);const _=x.strokeArrayWidth?x.strokeArrayWidth[0]:null!==(r=x.lineWidth)&&void 0!==r?r:0,S=x.strokeArrayWidth?x.strokeArrayWidth[1]:null!==(s=x.lineWidth)&&void 0!==s?s:0,A=x.strokeArrayWidth?x.strokeArrayWidth[2]:null!==(a=x.lineWidth)&&void 0!==a?a:0,B=x.strokeArrayWidth?x.strokeArrayWidth[3]:null!==(l=x.lineWidth)&&void 0!==l?l:0;if(t.setAttributes(w),!n)if(x.stroke)if(x.x=B/2,x.y=_/2,x.pickable=!1,c){if(v)if(Array.isArray(v)){const t=tB(v);x.cornerRadius=t,w.cornerRadius=t,t[0]&&(t[0]=t[0]+Math.min(B,_)/2),t[1]&&(t[1]=t[1]+Math.min(_,S)/2),t[2]&&(t[2]=t[2]+Math.min(S,A)/2),t[3]&&(t[3]=t[3]+Math.min(A,B)/2)}else if(ht(m)){const t=[];x.cornerRadius=t,w.cornerRadius=t,t[0]=v+Math.min(B,_)/2,t[1]=v+Math.min(_,S)/2,t[2]=v+Math.min(S,A)/2,t[3]=v+Math.min(A,B)/2}else x.cornerRadius=v+(null!==(h=x.lineWidth)&&void 0!==h?h:0)/2,w.cornerRadius=v+(null!==(d=x.lineWidth)&&void 0!==d?d:0)/2;let i,o;if(e.innerBorder?(x.x=t.attribute.x+B/2,x.y=t.attribute.y+_/2,x.width=t.attribute.width-B/2-S/2,x.height=t.attribute.height-_/2-A/2):(x.x=t.attribute.x-B/2,x.y=t.attribute.y-_/2,x.width=t.attribute.width+B/2+S/2,x.height=t.attribute.height+_/2+A/2),C){x.fill="white",x.notAdjustPos=!0,o=bs(x),o.name="table-border-rect",i=oc({x:B/2,y:_/2,width:t.attribute.width,height:t.attribute.height,fill:"red",cornerRadius:t.attribute.cornerRadius,globalCompositeOperation:"destination-out"}),o.addChild(i);const e=oc({x:B/2,y:_/2,width:t.attribute.width,height:t.attribute.height,fill:"transparent",pickable:!1,globalCompositeOperation:"source-over"});o.addChild(e)}else o=oc(x),o.name="table-border-rect";e.innerBorder&&!C?t.parent.insertAfter(o,t):t.parent.insertBefore(o,t),t.border=o}else{x.width=t.attribute.width-B/2-S/2,x.height=t.attribute.height-_/2-A/2;const e=oc(x);e.name="border-rect",t.addChild(e),t.border=e}else{const e=oc({fill:!1,stroke:!1,pickable:!1,lineWidth:0});e.name="border-rect",t.addChild(e),t.border=e}}function rk(t,e,i){var o;if(!e)return;const{borderColor:n}=e;null===(o=t.border)||void 0===o||o.setAttribute("stroke",sk(n,i))}function sk(t,e,i){let o=!0;return!e&&!ht(i)||ht(t)?e?o=e:e||ht(t)?ht(t)&&(o=!0):o=t:o=(null!=e?e:i).map((e=>!!e&&t)),o}function ak(t){var e,i,o,n;if(!t.border)return;const r=t.border.attribute.strokeArrayWidth?t.border.attribute.strokeArrayWidth[0]:null!==(e=t.border.attribute.lineWidth)&&void 0!==e?e:0,s=t.border.attribute.strokeArrayWidth?t.border.attribute.strokeArrayWidth[1]:null!==(i=t.border.attribute.lineWidth)&&void 0!==i?i:0,a=t.border.attribute.strokeArrayWidth?t.border.attribute.strokeArrayWidth[2]:null!==(o=t.border.attribute.lineWidth)&&void 0!==o?o:0,l=t.border.attribute.strokeArrayWidth?t.border.attribute.strokeArrayWidth[3]:null!==(n=t.border.attribute.lineWidth)&&void 0!==n?n:0;t.border.setAttributes({borderLeft:l,borderTop:r,borderRight:s,borderBottom:a,width:t.attribute.width-l/2-s/2,height:t.attribute.height-r/2-a/2}),"group"===t.border.type&&t.border.firstChild.setAttributes({width:t.attribute.width,height:t.attribute.height})}function lk(t,e){t.setAttribute("cornerRadius",e),t.border&&t.border.setAttribute("cornerRadius",e)}const hk=Xr();class dk extends vs{constructor(t,e){if(super(e),this.type="chart",this.numberType=hk,this.isShareChartSpec=t,e.chartInstance)this.chartInstance=e.chartInstance;else{const t=this.chartInstance=new e.ClassType(e.spec,Tt({},this.attribute.tableChartOption,{renderCanvas:e.canvas,mode:"node"===this.attribute.mode?"node":"desktop-browser",modeParams:this.attribute.modeParams,canvasControled:!1,viewBox:{x1:0,x2:0,y1:0,y2:0},dpr:e.dpr,interactive:!1,animation:!1,autoFit:!1}));t.renderSync(),t.getStage().enableDirtyBounds(),e.chartInstance=this.chartInstance=t}}activate(t){var e,i,o,n,r;this.active=!0;const{col:s,row:a}=this.parent,{x1:l,y1:h,x2:d,y2:c}=this.getViewBox(),u=function(t,e,i){var o,n,r,s,a,l,h,d;const{layoutMap:c}=i.internalProps,u=new He,g=i.scenegraph.tableGroup.globalAABBBounds;return u.x1=g.x1,u.x2=g.x2,u.y1=g.y1,u.y2=g.y2,c.isLeftBottomCorner(t,e)||c.isRightTopCorner(t,e)||c.isLeftTopCorner(t,e)||c.isRightBottomCorner(t,e)||(c.isFrozenColumn(t,e)?(u.y1=g.y1+i.getFrozenRowsHeight(),u.y2=g.y2-i.getBottomFrozenRowsHeight()):c.isFrozenRow(t,e)?(u.x1=g.x1+i.getFrozenColsWidth(),u.x2=g.x2-i.getRightFrozenColsWidth()):c.isRightFrozenColumn(t,e)?(u.y1=g.y1+i.getFrozenRowsHeight(),u.y2=g.y2-i.getBottomFrozenRowsHeight()):c.isBottomFrozenRow(t,e)?(u.x1=g.x1+i.getFrozenColsWidth(),u.x2=g.x2-i.getRightFrozenColsWidth()):c.isFrozenColumn(t,e)||c.isRightFrozenColumn(t,e)||(u.x1=g.x1+i.getFrozenColsWidth(),u.x2=g.x2-i.getRightFrozenColsWidth(),u.y1=g.y1+i.getFrozenRowsHeight(),u.y2=g.y2-i.getBottomFrozenRowsHeight())),u.x1=u.x1+(null!==(n=null===(o=i.options.viewBox)||void 0===o?void 0:o.x1)&&void 0!==n?n:0),u.x2=u.x2+(null!==(s=null===(r=i.options.viewBox)||void 0===r?void 0:r.x1)&&void 0!==s?s:0),u.y1=u.y1+(null!==(l=null===(a=i.options.viewBox)||void 0===a?void 0:a.y1)&&void 0!==l?l:0),u.y2=u.y2+(null!==(d=null===(h=i.options.viewBox)||void 0===h?void 0:h.y1)&&void 0!==d?d:0),u}(s,a,t).intersect({x1:l-t.scrollLeft,x2:d-t.scrollLeft,y1:h-t.scrollTop,y2:c-t.scrollTop});null===(e=this.activeChartInstance)||void 0===e||e.release(),this.activeChartInstance=new this.attribute.ClassType(this.attribute.spec,Tt({},this.attribute.tableChartOption,{renderCanvas:this.attribute.canvas,mode:"desktop-browser",canvasControled:!1,viewBox:{x1:0,x2:d-l,y1:0,y2:c-h},dpr:t.internalProps.pixelRatio,animation:!1,interactive:!0,autoFit:!1,beforeRender:e=>{const i=this.stage,o=e.window.getContext(),n=i.window.getViewBoxTransform(),r=i.window.getViewBox();o.inuse=!0,o.clearMatrix(),o.setTransform(n.a,n.b,n.c,n.d,n.e,n.f,!0),o.translate(r.x1,r.y1),o.setTransformForCurrent(!0),o.beginPath(),o.rect(u.x1,u.y1,u.x2-u.x1,u.y2-u.y1),o.clip(),o.clearMatrix(),t.options.canvas&&!e.needRender&&(e.pauseRender(),t.scenegraph.stage.dirtyBounds.union(this.globalAABBBounds),t.scenegraph.updateNextFrame())},afterRender(t){t.window.getContext().inuse=!1,t.needRender=!1,g.resumeRender()}}));const g=this.activeChartInstance.getStage(),p=this.globalTransMatrix.clone(),f=this.stage.window.getViewBoxTransform();p.multiply(f.a,f.b,f.c,f.d,f.e,f.f),g.window.setViewBoxTransform&&g.window.setViewBoxTransform(p.a,p.b,p.c,p.d,p.e,p.f),this.activeChartInstance.renderSync(),null===(o=null===(i=t.internalProps.layoutMap)||void 0===i?void 0:i.updateDataStateToActiveChartInstance)||void 0===o||o.call(i,this.activeChartInstance),this.activeChartInstance.on("click",(e=>{var i;!1===(null===(i=this.attribute.spec.select)||void 0===i?void 0:i.enable)?t.scenegraph.updateChartState(null):dk.temp&&t.scenegraph.updateChartState(null==e?void 0:e.datum)})),this.activeChartInstance.on("brushEnd",(e=>{var i;t.scenegraph.updateChartState(null===(i=null==e?void 0:e.value)||void 0===i?void 0:i.inBrushData),dk.temp=0,setTimeout((()=>{dk.temp=1}),0)})),null===(r=(n=t)._bindChartEvent)||void 0===r||r.call(n,this.activeChartInstance)}deactivate(){var t,e;this.active=!1,null===(t=this.activeChartInstance)||void 0===t||t.updateViewBox({x1:-1e3,x2:-800,y1:-1e3,y2:-800},!1,!1),null===(e=this.activeChartInstance)||void 0===e||e.release(),this.activeChartInstance=null}updateData(t){this.attribute.data=t}getViewBox(){var t,e,i,o,n,r,s,a;const l=this.parent,h=this.attribute.cellPadding,d=this.stage.table,{x1:c,y1:u,x2:g,y2:p}=l.globalAABBBounds;return{x1:Math.ceil(c+h[3]+d.scrollLeft+(null!==(e=null===(t=d.options.viewBox)||void 0===t?void 0:t.x1)&&void 0!==e?e:0)),x2:Math.ceil(c+l.attribute.width-h[1]+d.scrollLeft+(null!==(o=null===(i=d.options.viewBox)||void 0===i?void 0:i.x1)&&void 0!==o?o:0)),y1:Math.ceil(u+h[0]+d.scrollTop+(null!==(r=null===(n=d.options.viewBox)||void 0===n?void 0:n.y1)&&void 0!==r?r:0)),y2:Math.ceil(u+l.attribute.height-h[2]+d.scrollTop+(null!==(a=null===(s=d.options.viewBox)||void 0===s?void 0:s.y1)&&void 0!==a?a:0))}}}dk.temp=1;let ck,uk=[],gk=[],pk=5,fk=!1;function vk(t){ot(t)&&(pk=t)}function bk(){uk=[],gk=[],fk=!1,cancelAnimationFrame(ck)}function mk(t){var e,i,o,n,r,s,a;const{axes:l,dataId:h,data:d,spec:c,ClassType:u,canvas:g,mode:p,modeParams:f,dpr:v}=t.attribute;let{chartInstance:b}=t;b||(b=new u(c,{renderCanvas:g,mode:"node"===p?"node":"desktop-browser",modeParams:f,canvasControled:!1,viewBox:{x1:0,x2:0,y1:0,y2:0},dpr:v,interactive:!1,animation:!1,autoFit:!1}),b.renderSync(),t.chartInstance=b);const m=t.getViewBox();m.x2<=m.x1&&(m.x2=m.x1+1),m.y2<=m.y1&&(m.y2=m.y1+1),b.updateViewBox({x1:0,x2:m.x2-m.x1,y1:0,y2:m.y2-m.y1},!1,!1);const y=b.getStage(),C=t.globalTransMatrix.clone(),w=t.stage.window.getViewBoxTransform();C.multiply(w.a,w.b,w.c,w.d,w.e,w.f),y.window.setViewBoxTransform&&y.window.setViewBoxTransform(C.a,C.b,C.c,C.d,C.e,C.f);const{table:x}=t.getRootNode();let _=!1;if(x.options.specFormat){const i=x.options.specFormat(t.attribute.spec,b,t);if(i.needFormatSpec&&i.spec){const t=i.spec;b.updateSpecSync(t),_=null===(e=i.updateSpec)||void 0===e||e}}if(!_)if(null==l||l.forEach(((t,e)=>{var i,o,n,r,s;"band"===t.type?b.updateModelSpec({type:"axes",index:e},{domain:t.domain.slice(0)},!0):b.updateModelSpecSync({type:"axes",index:e},{min:null!==(o=null===(i=t.range)||void 0===i?void 0:i.min)&&void 0!==o?o:0,max:null!==(r=null===(n=t.range)||void 0===n?void 0:n.max)&&void 0!==r?r:0,tick:{tickMode:null===(s=t.tick)||void 0===s?void 0:s.tickMode}},!0)})),null===(o=null===(i=x.internalProps.layoutMap)||void 0===i?void 0:i.updateDataStateToActiveChartInstance)||void 0===o||o.call(i,b),"string"==typeof h)b.updateDataSync(h,null!=d?d:[]);else{const t=[];for(const e in h){const i=h[e],o=c.series.find((t=>{var i;return(null===(i=null==t?void 0:t.data)||void 0===i?void 0:i.id)===e}));t.push({id:e,values:i?null!==(n=null==d?void 0:d.filter((t=>t.hasOwnProperty(i))))&&void 0!==n?n:[]:null!=d?d:[],fields:null===(r=null==o?void 0:o.data)||void 0===r?void 0:r.fields}),b.updateFullDataSync||b.updateDataSync(e,i?null!==(s=null==d?void 0:d.filter((t=>t.hasOwnProperty(i))))&&void 0!==s?s:[]:null!=d?d:[])}null===(a=b.updateFullDataSync)||void 0===a||a.call(b,t)}!function(t,e){var i;const{viewWidth:o,viewHeight:n}=t;if(o<Ck&&n<Ck)return e.cacheCanvas=wk(t),void(e.isShareChartSpec||(null===(i=e.chartInstance)||void 0===i||i.release(),e.chartInstance=null,e.setAttribute("chartInstance",null)));const r=Math.ceil(n/Ck),s=Math.ceil(o/Ck),a=[];for(let e=0;e<r;e++)for(let i=0;i<s;i++){const r=i*Ck,s=e*Ck,l=r+Ck>o?o:r+Ck,h=s+Ck>n?n:s+Ck,d=l-r,c=h-s,u=new He;u.setValue(r,s,l,h);const g=wk(t,!1,u);a.push({canvas:g,x:r,y:s,width:d,height:c})}e.cacheCanvas=a}(b.getStage(),t)}function yk(t){fk=!0,gk.length>0?ck=requestAnimationFrame((()=>{const e=gk.splice(0,pk);uk.splice(0,pk),e.forEach((t=>{mk(t),t.addUpdateBoundTag()})),t.render(),yk(t)})):fk=!1}const Ck=2e3;function wk(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0;if("released"===t.releaseStatus)return null;const o=t.window.getViewBoxTransform(),n=function(t){let e=arguments.length>2?arguments[2]:void 0;const i=t.window.getViewBoxTransform(),o=sn.get(gn),n=e?-e.x1:0,r=e?-e.y1:0,s=e?e.x2:t.viewWidth,a=e?e.y2:t.viewHeight,l=e?e.width():t.viewWidth,h=e?e.height():t.viewHeight;return o.create({viewBox:{x1:n,y1:r,x2:s,y2:a},width:l*i.a,height:h*i.d,dpr:t.window.dpr,canvasControled:!0,offscreen:!0,title:""}),t.renderTo(o),o}(t,e,i);n.setViewBoxTransform(o.a,o.b,o.c,o.d,0,0),t.renderTo(n);const r=n.getNativeHandler();return r.nativeCanvas?r.nativeCanvas:null}var xk=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};const _k=Symbol.for("ChartRender");let Sk=class extends fa{constructor(){super(...arguments),this.numberType=hk}drawShape(t,e,i,o,n,r,s,a){var l,h,d,c;const u=kn(t,null==r?void 0:r.theme).group,{dataId:g,data:p,spec:f}=t.attribute,{width:v=u.width,height:b=u.height}=(t.getViewBox(),t.attribute),{table:m}=t.getRootNode(),{active:y,cacheCanvas:C,activeChartInstance:w}=t;if(!y&&C)ht(C)?C.forEach((t=>{const{x:i,y:o,width:n,height:r,canvas:s}=t;e.drawImage(s,i,o,n,r)})):e.drawImage(C,i,o,v,b);else if(w){if(m.options.specFormat){const e=m.options.specFormat(t.attribute.spec,w,t);if(e.needFormatSpec&&e.spec){const t=e.spec;w.updateSpecSync(t)}}const e=t.getViewBox();w.updateViewBox({x1:0,x2:e.x2-e.x1,y1:0,y2:e.y2-e.y1},!1,!1);const i=w.getStage();i.needRender=!0;const o=t.globalTransMatrix.clone(),n=t.stage.window.getViewBoxTransform().clone();if(n.multiply(o.a,o.b,o.c,o.d,o.e,o.f),i.window.setViewBoxTransform(n.a,n.b,n.c,n.d,n.e,n.f),"string"==typeof g)w.updateDataSync(g,null!=p?p:[]);else{const t=[];for(const e in g){const i=g[e],o=f.series.find((t=>{var i;return(null===(i=null==t?void 0:t.data)||void 0===i?void 0:i.id)===e}));t.push({id:e,values:i?null!==(l=null==p?void 0:p.filter((t=>t.hasOwnProperty(i))))&&void 0!==l?l:[]:null!=p?p:[],fields:null===(h=null==o?void 0:o.data)||void 0===h?void 0:h.fields}),w.updateFullDataSync||w.updateDataSync(e,i?null!==(d=null==p?void 0:p.filter((t=>t.hasOwnProperty(i))))&&void 0!==d?d:[]:null!=p?p:[])}null===(c=w.updateFullDataSync)||void 0===c||c.call(w,t)}}else m.internalProps.renderChartAsync?(-1===uk.indexOf(`${t.parent.col}+${t.parent.row}`)&&(uk.push(`${t.parent.col}+${t.parent.row}`),gk.push(t)),fk||yk(m)):mk(t)}draw(t,e,i,o){this._draw(t,{},!1,i,o)}};Sk=xk([C()],Sk);var Ak=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let Bk=class{constructor(){this.time=Ri.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,o,n,r,s,a,l,h,d,c,u){const{shape:g}=t.attribute;if("circle"===g){const{width:n=l.width,height:r=l.height}=t.attribute;e.beginPath(),e.arc(i+n/2,o+r/2,Math.min(n,r)/2,0,2*Math.PI),e.closePath(),e.save(),e.clip()}}};Bk=Ak([C()],Bk);let Rk=class{constructor(){this.time=Ri.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,o,n,r,s,a,l,h,d,c,u){const{shape:g}=t.attribute;"circle"===g&&e.restore()}};Rk=Ak([C()],Rk);let Tk=class{constructor(){this.time=Ri.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,o,n,r,s,a,l,h,d,c,u){const{isGif:g}=t.attribute;g&&t.playing&&(t.attribute.opacity=0)}};Tk=Ak([C()],Tk);let kk=class{constructor(){this.time=Ri.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,o,n,r,s,a,l,h,d,c,u){const{isGif:g}=t.attribute;g&&t.playing&&(t.attribute.opacity=1,e.globalAlpha=t.attribute.opacity,t.renderFrame(e,i,o))}};function Mk(t,e,i,o){var n;const{highlightScope:r,disableHeader:s,cellPos:a}=t.hover,l=t.table,h=l.isHeader(e,i);if(h&&s)return;let d;if(r===QC.single&&a.col===e&&a.row===i?d="cellBgColor":r===QC.column&&a.col===e?d=a.col===e&&a.row===i?"cellBgColor":"inlineColumnBgColor":r===QC.row&&a.row===i?d=a.col===e&&a.row===i?"cellBgColor":"inlineRowBgColor":r===QC.cross&&(a.col===e&&a.row===i?d="cellBgColor":a.col===e?d="inlineColumnBgColor":a.row===i&&(d="inlineRowBgColor")),d){let t;if(h){const r=l.getHeaderDefine(e,i);t=null==r?void 0:r.disableHeaderHover,o.firstChild&&"axis"===o.firstChild.name&&(null===(n=l.options.hover)||void 0===n?void 0:n.disableAxisHover)&&(t=!0)}else{const o=l.getBodyColumnDefine(e,i);t=null==o?void 0:o.disableHover}t&&(d=void 0)}return d}function Lk(t,e,i,o){const{highlightInRange:n,disableHeader:r,ranges:s}=t.select;let a;const l=1===s.length&&function(t){return t.start.col!==t.end.col||t.start.row!==t.end.row}(null==s?void 0:s[0])&&n;if(l?1===(null==s?void 0:s.length)&&s[0].start&&s[0].end:1===(null==s?void 0:s.length)&&s[0].end.col===s[0].start.col&&s[0].end.row===s[0].start.row){if(t.table.isHeader(e,i)&&r)return;a=l?function(t,e,i){let o;const{highlightScope:n,cellPos:r,ranges:s}=t.select,a=s[0],l=Math.min(a.start.col,a.end.col),h=Math.max(a.start.col,a.end.col),d=Math.min(a.start.row,a.end.row),c=Math.max(a.start.row,a.end.row);return n===QC.single&&r.col===e&&r.row===i?o="cellBgColor":n===QC.column&&e>=l&&e<=h?o=vx(s[0],e,i)?"cellBgColor":"inlineColumnBgColor":n===QC.row&&i>=d&&i<=c?o=vx(s[0],e,i)?"cellBgColor":"inlineRowBgColor":n===QC.cross&&(vx(s[0],e,i)?o="cellBgColor":e>=l&&e<=h?o="inlineColumnBgColor":i>=d&&i<=c&&(o="inlineRowBgColor")),o}(t,e,i):function(t,e,i){let o;const{highlightScope:n,cellPos:r}=t.select;return n===QC.single&&r.col===e&&r.row===i?o="cellBgColor":n===QC.column&&r.col===e?o=r.col===e&&r.row===i?"cellBgColor":"inlineColumnBgColor":n===QC.row&&r.row===i?o=r.col===e&&r.row===i?"cellBgColor":"inlineRowBgColor":n===QC.cross&&(r.col===e&&r.row===i?o="cellBgColor":r.col===e?o="inlineColumnBgColor":r.row===i&&(o="inlineRowBgColor")),o}(t,e,i),a&&Pk(t.table,e,i)&&(a=void 0)}else if("replace"===t.table.theme.selectionStyle.selectionFillMode)for(let t=0;t<s.length;t++){const o=s[t],n=Math.min(o.start.col,o.end.col),r=Math.max(o.start.col,o.end.col),l=Math.min(o.start.row,o.end.row),h=Math.max(o.start.row,o.end.row);if(n<=e&&l<=i&&r>=e&&h>=i){a="cellBgColor";break}}return a}function Pk(t,e,i){var o,n;const r=null===(o=t.options.select)||void 0===o?void 0:o.disableSelect;if("function"==typeof r?r(e,i,t):r)return!0;if(t.isHeader(e,i)){let o=null===(n=t.options.select)||void 0===n?void 0:n.disableHeaderSelect;if(o)return!0;const r=t.getHeaderDefine(e,i);if(o=null==r?void 0:r.disableHeaderSelect,o)return!0}else{const o=t.getBodyColumnDefine(e,i),n=null==o?void 0:o.disableSelect;if("function"==typeof n?n(e,i,t):n)return!0}return!1}kk=Ak([C()],kk);var Ek=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let Hk=class{constructor(){this.time=Ri.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,o,n,r,s,a,l,h,d,c,u){const{stroke:g=l.stroke,strokeArrayWidth:p=l.strokeArrayWidth,strokeArrayColor:f=l.strokeArrayColor}=t.attribute;g&&(Array.isArray(p)||Array.isArray(f))&&(u.doStroke=!1)}};Hk=Ek([C()],Hk);let Fk=class{constructor(){this.time=Ri.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,o,n,r,s,a,l,h,d,c){var u,g;const{stroke:p=l.stroke,strokeArrayColor:f=l.strokeArrayColor,strokeArrayWidth:v=l.strokeArrayWidth,lineWidth:b=l.lineWidth,strokeColor:m=l.stroke,cornerRadius:y=l.cornerRadius}=t.attribute;let C,w,{width:x=l.width,height:_=l.height}=t.attribute;if(p&&(Array.isArray(v)||0!==b)&&(Array.isArray(f)||Array.isArray(v))){if("number"==typeof b&&1&b||Array.isArray(v)&&v.some((t=>1&t))){const e=t.stage.table;if(!e)return;const n="bottom-right"===(null===(u=null==e?void 0:e.theme)||void 0===u?void 0:u.cellBorderClipDirection);if(n){if(i=Math.floor(i)-.5,o=Math.floor(o)-.5,"cell"===t.role){const e=t.col,n=t.row;0===e&&(i+=1),0===n&&(o+=1)}}else i=Math.floor(i)+.5,o=Math.floor(o)+.5;(null===(g=e.options.customConfig)||void 0===g?void 0:g._disableColumnAndRowSizeRound)&&(x=Math.round(x),_=Math.round(_));const{width:r,height:s}=Xk(t,Math.ceil(x),Math.ceil(_),n);C=r,w=s}else C=Math.ceil(x),w=Math.ceil(_);0===y||ht(y)&&y.every((t=>0===t))?Ik(t,e,i,o,l,p,v||b,f||m,C,w):(e.beginPath(),Pa(e,i,o,C,w,y,new Array(4).fill(0).map(((n,r)=>(n,s,a,h)=>{Zk(r,n,s,a,h,t,e,i,o,l,p,v||b,f||m,C,w)}))),e.stroke())}}};function Ok(t){if(!Array.isArray(t))return{isSplitDraw:!1,width:t};let e;for(let i=0;i<t.length;i++){const o=t[i];if(o)if(e){if(o!==e)return{isSplitDraw:!0}}else e=o}return{isSplitDraw:!1,width:e}}function Ik(t,e,i,o,n,r,s,a,l,h,d,c){var u,g,p,f;const v=Ok(s),b=!Array.isArray(s),m=!Array.isArray(r),y=Array.isArray(c),C=Array.isArray(a)||v.isSplitDraw;e.setStrokeStyle(t,t.attribute,i,o,n);const{lineDash:w=n.lineDash}=t.attribute;let x=!1;w.length&&w.some((t=>Array.isArray(t)))&&(x=!0),e.beginPath(),e.moveTo(i,o);const _=(m||r[0])&&(b||s[0]),S=(m||r[1])&&(b||s[1]),A=(m||r[2])&&(b||s[2]),B=(m||r[3])&&(b||s[3]);if(_){const t=(b?v.width:s[0])/2,n=(b?v.width:s[0])/2;y&&Array.isArray(c[0])?(e.moveTo(i-t+(l+t+n)*c[0][0],o),e.lineTo(i-t+(l+t+n)*(c[0][1]-c[0][0]),o),e.moveTo(i+l+n,o)):(e.moveTo(i-t,o),e.lineTo(i+l+n,o)),(C||x)&&(a&&a[0]?e.strokeStyle=a[0]:a&&!a[0]&&(e.strokeStyle="transparent"),b||(e.lineWidth=s[0]),e.lineDashOffset=e.currentMatrix.e/e.currentMatrix.a,x&&e.setLineDash(null!==(u=w[0])&&void 0!==u?u:[]),e.stroke(),e.beginPath(),e.moveTo(i+l,o))}else e.moveTo(i+l,o);if(S){const t=(b?v.width:s[1])/2,n=(b?v.width:s[1])/2;y&&Array.isArray(c[1])?(e.moveTo(i+l,o-t+h*c[1][0]),e.lineTo(i+l,o-t+(h+t+n)*(c[1][1]-c[1][0])),e.moveTo(i+l,o+h+n)):(e.moveTo(i+l,o-t),e.lineTo(i+l,o+h+n)),(C||x)&&(a&&a[1]?e.strokeStyle=a[1]:a&&!a[1]&&(e.strokeStyle="transparent"),b||(e.lineWidth=s[1]),e.lineDashOffset=e.currentMatrix.f/e.currentMatrix.d,x&&e.setLineDash(null!==(g=w[1])&&void 0!==g?g:[]),e.stroke(),e.beginPath(),e.moveTo(i+l,o+h))}else e.moveTo(i+l,o+h);if(A){const t=(b?v.width:s[2])/2,n=(b?v.width:s[2])/2;y&&Array.isArray(c[2])?(e.moveTo(i-t+(l+t+n)*c[2][0],o+h),e.lineTo(i-t+(l+t+n)*(c[2][1]-c[2][0]),o+h),e.moveTo(i-t,o+h)):(e.moveTo(i-t,o+h),e.lineTo(i+l+n,o+h)),(C||x)&&(a&&a[2]?e.strokeStyle=a[2]:a&&!a[2]&&(e.strokeStyle="transparent"),b||(e.lineWidth=s[2]),e.lineDashOffset=e.currentMatrix.e/e.currentMatrix.a,x&&e.setLineDash(null!==(p=w[2])&&void 0!==p?p:[]),e.stroke(),e.beginPath(),e.moveTo(i,o+h))}else e.moveTo(i,o+h);if(B){const t=(b?v.width:s[3])/2,n=(b?v.width:s[3])/2;y&&Array.isArray(c[3])?(e.moveTo(i,o-t+(h+t+n)*c[3][0]),e.lineTo(i,o-t+(h+t+n)*(c[3][1]-c[3][0])),e.moveTo(i,o-t)):(e.moveTo(i,o-t),e.lineTo(i,o+h+n)),(C||x)&&(a&&a[3]?e.strokeStyle=a[3]:a&&!a[3]&&(e.strokeStyle="transparent"),b||(e.lineWidth=s[3]),e.lineDashOffset=e.currentMatrix.f/e.currentMatrix.d,x&&e.setLineDash(null!==(f=w[3])&&void 0!==f?f:[]),e.stroke(),e.beginPath(),e.moveTo(i,o))}else e.moveTo(i,o);C||x||(!b&&v.width&&(e.lineWidth=v.width),e.stroke()),e.lineDashOffset=0,e.setLineDash([])}Fk=Ek([C()],Fk);let zk=class{constructor(){this.time=Ri.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,o,n,r,s,a,l,h,d,c,u){var g;const{lineDash:p=l.lineDash,stroke:f=l.stroke,strokeArrayColor:v=l.strokeArrayColor,strokeArrayWidth:b=l.strokeArrayWidth}=t.attribute;f&&Array.isArray(p)&&p.length&&(null===(g=p[0])||void 0===g?void 0:g.length)&&!Array.isArray(v)&&!Array.isArray(b)&&(u.doStroke=!1)}};zk=Ek([C()],zk);let Dk=class{constructor(){this.time=Ri.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,o,n,r,s,a,l,h,d,c){var u,g,p,f,v,b;const{lineDash:m=l.lineDash,stroke:y=l.stroke,strokeArrayColor:C=l.strokeArrayColor,strokeArrayWidth:w=l.strokeArrayWidth,lineWidth:x=l.lineWidth}=t.attribute;if(!y||!(Array.isArray(m)&&m.length&&(null===(u=m[0])||void 0===u?void 0:u.length))||Array.isArray(C)||Array.isArray(w))return;const _=t.stage.table;if(!_)return;const S=ht(m[0])?function(t){return 1===t.length?[t[0],t[0],t[0],t[0]]:2===t.length?[t[0],t[1],t[0],t[1]]:t}(m):[m,m,m,m];let A,B,{width:R=l.width,height:T=l.height}=t.attribute;if((null===(g=_.options.customConfig)||void 0===g?void 0:g._disableColumnAndRowSizeRound)?(R=Math.round(R),T=Math.round(T)):(R=Math.ceil(R),T=Math.ceil(T)),1&x){const e="bottom-right"===_.theme.cellBorderClipDirection,n=0,r=0;e?(i=Math.floor(i)-.5,o=Math.floor(o)-.5,"cell"===t.role&&(0===t.col&&(i+=1),0===t.row&&(o+=1))):(i=Math.floor(i)+.5,o=Math.floor(o)+.5);const{width:s,height:a}=Xk(t,Math.ceil(R+n),Math.ceil(T+r),e);A=s,B=a}else A=Math.ceil(R),B=Math.ceil(T);e.setStrokeStyle(t,t.attribute,i,o,l),e.beginPath(),e.moveTo(i,o),e.lineTo(i+A,o),e.lineDashOffset=e.currentMatrix.e/e.currentMatrix.a,e.setLineDash(null!==(p=S[0])&&void 0!==p?p:[]),e.stroke(),e.beginPath(),e.moveTo(i+A,o),e.lineTo(i+A,o+B),e.lineDashOffset=e.currentMatrix.f/e.currentMatrix.d,e.setLineDash(null!==(f=S[1])&&void 0!==f?f:[]),e.stroke(),e.beginPath(),e.moveTo(i,o+B),e.lineTo(i+A,o+B),e.lineDashOffset=e.currentMatrix.e/e.currentMatrix.a,e.setLineDash(null!==(v=S[2])&&void 0!==v?v:[]),e.stroke(),e.beginPath(),e.moveTo(i,o),e.lineTo(i,o+B),e.lineDashOffset=e.currentMatrix.f/e.currentMatrix.d,e.setLineDash(null!==(b=S[3])&&void 0!==b?b:[]),e.stroke(),e.lineDashOffset=0,e.setLineDash([])}};Dk=Ek([C()],Dk);let Wk=class{constructor(){this.time=Ri.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,o,n,r,s,a,l,h,d,c,u){const{lineWidth:g=l.lineWidth,stroke:p=l.stroke,lineDash:f=l.lineDash,strokeArrayWidth:v=l.strokeArrayWidth,strokeArrayColor:b=l.strokeArrayColor,notAdjustPos:m}=t.attribute;!0!==m&&p&&Array.isArray(f)&&!f.length&&!Array.isArray(b)&&!Array.isArray(v)&&1&g&&(u.doStroke=!1)}};Wk=Ek([C()],Wk);let Nk=class{constructor(){this.time=Ri.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,o,n,r,s,a,l,h,d,c){var u,g;const{lineWidth:p=l.lineWidth,stroke:f=l.stroke,lineDash:v=l.lineDash,strokeArrayWidth:b=l.strokeArrayWidth,strokeArrayColor:m=l.strokeArrayColor,notAdjustPos:y,cornerRadius:C=l.cornerRadius}=t.attribute;let{width:w=l.width,height:x=l.height}=t.attribute;if(!0!==y&&f&&Array.isArray(v)&&!v.length&&!Array.isArray(m)&&!Array.isArray(b)&&1&p){const n=t.stage.table;if(!n)return;(null===(u=n.options.customConfig)||void 0===u?void 0:u._disableColumnAndRowSizeRound)&&(w=Math.round(w),x=Math.round(x)),e.beginPath();const r="bottom-right"===(null===(g=null==n?void 0:n.theme)||void 0===g?void 0:g.cellBorderClipDirection),s=0,a=0;r?(i=Math.floor(i)-.5,o=Math.floor(o)-.5,"cell"===t.role&&(0===t.col&&(i+=1),0===t.row&&(o+=1))):(i=Math.floor(i)+.5,o=Math.floor(o)+.5);const{width:h,height:d}=Xk(t,Math.ceil(w),Math.ceil(x),r);C?Pa(e,i,o,h+s,d+a,C):e.rect(i,o,h,d),e.setStrokeStyle(t,t.attribute,i,o,l),e.stroke()}}};Nk=Ek([C()],Nk);let Gk=class{constructor(){this.time=Ri.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,o,n,r,s,a,l,h,d,c,u){if("cell"===t.role){const e=t.stage.table;if(e){const i=function(t,e){var i,o,n,r,s,a,l,h,d,c,u;let g,p;if("cell"===t.role&&ot(t.mergeStartCol)&&ot(t.mergeStartRow)&&ot(t.mergeEndCol)&&ot(t.mergeEndRow)){const{colStart:i,colEnd:o,rowStart:n,rowEnd:r}=LT(t,e.scenegraph);for(let t=i;t<=o;t++)for(let i=n;i<=r;i++){const o=Lk(e.stateManager,t,i);!o||g&&"cellBgColor"!==o||(g=o)}}else"cell"===t.role&&(g=Lk(e.stateManager,t.col,t.row));if(!g)return;const f=e.internalProps.layoutMap;return f.isCornerHeader(t.col,t.row)?p=(null===(i=e.theme.cornerHeaderStyle)||void 0===i?void 0:i.select)||(null===(o=e.theme.headerStyle)||void 0===o?void 0:o.select):f.isColumnHeader(t.col,t.row)?p=null===(n=e.theme.headerStyle)||void 0===n?void 0:n.select:f.isRowHeader(t.col,t.row)?p=null===(r=e.theme.rowHeaderStyle)||void 0===r?void 0:r.select:f.isBottomFrozenRow(t.col,t.row)?p=(null===(s=e.theme.bottomFrozenStyle)||void 0===s?void 0:s.select)||(e.isListTable()?null===(a=e.theme.bodyStyle)||void 0===a?void 0:a.select:null===(l=e.theme.headerStyle)||void 0===l?void 0:l.select):f.isRightFrozenColumn(t.col,t.row)?p=(null===(h=e.theme.rightFrozenStyle)||void 0===h?void 0:h.select)||(e.isListTable()?null===(d=e.theme.bodyStyle)||void 0===d?void 0:d.select:null===(c=e.theme.rowHeaderStyle)||void 0===c?void 0:c.select):e.isHeader(t.col,t.row)||(p=null===(u=e.theme.bodyStyle)||void 0===u?void 0:u.select),FR(g,p,t.col,t.row,e)}(t,e);if(i)t.attribute._vtableHightLightFill=i;else if(e.stateManager.interactionState!==JC.scrolling){const i=function(t,e){var i,o,n,r,s,a,l,h,d,c,u;let g,p;if("cell"===t.role&&ot(t.mergeStartCol)&&ot(t.mergeStartRow)&&ot(t.mergeEndCol)&&ot(t.mergeEndRow)){const{colStart:i,colEnd:o,rowStart:n,rowEnd:r}=LT(t,e.scenegraph);for(let s=i;s<=o;s++)for(let i=n;i<=r;i++){const o=Mk(e.stateManager,s,i,t);!o||g&&"cellBgColor"!==o||(g=o)}}else"cell"===t.role&&(g=Mk(e.stateManager,t.col,t.row,t));if(!g)return;const f=e.internalProps.layoutMap;return f.isCornerHeader(t.col,t.row)?p=(null===(i=e.theme.cornerHeaderStyle)||void 0===i?void 0:i.hover)||(null===(o=e.theme.headerStyle)||void 0===o?void 0:o.hover):f.isColumnHeader(t.col,t.row)?p=null===(n=e.theme.headerStyle)||void 0===n?void 0:n.hover:f.isRowHeader(t.col,t.row)?p=null===(r=e.theme.rowHeaderStyle)||void 0===r?void 0:r.hover:f.isBottomFrozenRow(t.col,t.row)?p=(null===(s=e.theme.bottomFrozenStyle)||void 0===s?void 0:s.hover)||(e.isListTable()?null===(a=e.theme.bodyStyle)||void 0===a?void 0:a.hover:null===(l=e.theme.headerStyle)||void 0===l?void 0:l.hover):f.isRightFrozenColumn(t.col,t.row)?p=(null===(h=e.theme.rightFrozenStyle)||void 0===h?void 0:h.hover)||(e.isListTable()?null===(d=e.theme.bodyStyle)||void 0===d?void 0:d.hover:null===(c=e.theme.rowHeaderStyle)||void 0===c?void 0:c.hover):e.isHeader(t.col,t.row)||(p=null===(u=e.theme.bodyStyle)||void 0===u?void 0:u.hover),FR(g,p,t.col,t.row,e)}(t,e);i&&(t.attribute._vtableHightLightFill=i)}}}}};Gk=Ek([C()],Gk);let jk=class{constructor(){this.time=Ri.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,o,n,r,s,a,l,h,d,c){if(t.attribute._vtableHightLightFill)if(d);else if(s){const n=t.attribute.fill;t.attribute.fill=t.attribute._vtableHightLightFill,e.setCommonStyle(t,t.attribute,i,o,l),e.fill(),t.attribute.fill=n,t.attribute._vtableHightLightFill=void 0}}};jk=Ek([C()],jk);let Vk=class{constructor(){this.time=Ri.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,o,n,r,s,a,l,h,d,c,u){var g,p,f,v,b,m;const y=t.stage.table;y&&("body"===t.role?$k(e,-(null!==(g=t.attribute.x)&&void 0!==g?g:0)+y.getFrozenColsWidth(),-(null!==(p=t.attribute.y)&&void 0!==p?p:0)+y.getFrozenRowsHeight(),t.parent.attribute.width-y.getFrozenColsWidth()-y.getRightFrozenColsWidth(),t.parent.attribute.height-y.getFrozenRowsHeight()-y.getBottomFrozenRowsHeight()):"row-header"===t.role?$k(e,0,-(null!==(f=t.attribute.y)&&void 0!==f?f:0)+y.getFrozenRowsHeight(),y.getFrozenColsWidth(),t.parent.attribute.height-y.getFrozenRowsHeight()-y.getBottomFrozenRowsHeight()):"col-header"===t.role?$k(e,-(null!==(v=t.attribute.x)&&void 0!==v?v:0)+y.getFrozenColsWidth(),0,t.parent.attribute.width-y.getFrozenColsWidth()-y.getRightFrozenColsWidth(),y.getFrozenRowsHeight()):"right-frozen"===t.role?$k(e,0,-(null!==(b=t.attribute.y)&&void 0!==b?b:0)+y.getFrozenRowsHeight(),y.getRightFrozenColsWidth(),t.parent.attribute.height-y.getFrozenRowsHeight()-y.getBottomFrozenRowsHeight()):"bottom-frozen"===t.role?$k(e,-(null!==(m=t.attribute.x)&&void 0!==m?m:0)+y.getFrozenColsWidth(),0,t.parent.attribute.width-y.getFrozenColsWidth()-y.getRightFrozenColsWidth(),y.getBottomFrozenRowsHeight()):"corner-header"===t.role?$k(e,0,0,y.getFrozenColsWidth(),y.getFrozenRowsHeight()):"corner-right-top-header"===t.role?$k(e,0,0,y.getRightFrozenColsWidth(),y.getFrozenRowsHeight()):"corner-right-bottom-header"===t.role?$k(e,0,0,y.getRightFrozenColsWidth(),y.getBottomFrozenRowsHeight()):"corner-left-bottom-header"===t.role&&$k(e,0,0,y.getFrozenColsWidth(),y.getBottomFrozenRowsHeight()))}};Vk=Ek([C()],Vk);const Uk=Math.pow(2,24);function $k(t,e,i,o,n){t.beginPath();const r=t.applyedMatrix;Math.abs(r.f)>Uk||Math.abs(r.g)>Uk?t.rect(e-Uk,i-Uk,o+2*Uk,n+2*Uk):t.rect(e,i,o,n)}function Xk(t,e,i,o){const n=t.stage.table;if(!n)return{width:e,height:i};if("cell"===t.role){let r=t.col,s=t.row;const a=s_(n,r,s);a&&(r=a.end.col,s=a.end.row),r!==n.colCount-1||o?(r===n.frozenColCount-1&&n.scrollLeft&&!o||0===r&&o)&&(e-=1):e-=1,s!==n.rowCount-1||o?(s===n.frozenRowCount-1&&n.scrollTop&&!o||0===s&&o)&&(i-=1):i-=1}else"corner-frozen"===t.role&&(n.scrollLeft&&!o&&(e-=1),n.scrollTop&&!o&&(i-=1));return{width:e,height:i}}var Yk=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let Kk=class{constructor(){this.time=Ri.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,o,n,r,s,a,l,h,d,c,u){const{stroke:g=l.stroke,strokeArrayWidth:p=l.strokeArrayWidth,strokeArrayColor:f=l.strokeArrayColor}=t.attribute;g&&(Array.isArray(g)||Array.isArray(p)||Array.isArray(f))&&(u.doStroke=!1)}};Kk=Yk([C()],Kk);let qk=class{constructor(){this.time=Ri.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,o,n,r,s,a,l,h,d,c){const{width:u=l.width,height:g=l.height,stroke:p=l.stroke,strokeArrayColor:f=l.strokeArrayColor,strokeArrayWidth:v=l.strokeArrayWidth,lineWidth:b=l.lineWidth,strokeColor:m=l.stroke,cornerRadius:y=l.cornerRadius}=t.attribute;if(p&&(Array.isArray(v)||0!==b)&&(Array.isArray(p)||Array.isArray(f)||Array.isArray(v))){const n=0,r=0;"border-rect"!==t.name&&"table-border-rect"!==t.name&&("number"==typeof b&&1&b||Array.isArray(v)&&v.some((t=>1&t)))&&(i=Math.floor(i)+.5,o=Math.floor(o)+.5),0===y||ht(y)&&y.every((t=>0===t))?Ik(t,e,i,o,l,p,v||b,f||m,"table-border-rect"!==t.name?Math.ceil(u+n):u+n,"table-border-rect"!==t.name?Math.ceil(g+r):g+r):(e.beginPath(),Pa(e,i,o,u,g,y,new Array(4).fill(0).map(((s,a)=>(s,h,d,c)=>{Zk(a,s,h,d,c,t,e,i,o,l,p,v||b,f||m,Math.ceil(u+n),Math.ceil(g+r))}))),e.stroke())}}};function Zk(t,e,i,o,n,r,s,a,l,h,d,c,u,g,p){var f,v,b,m;const y=r,C=h,w=Ok(c),x=!Array.isArray(c),_=!Array.isArray(d),S=Array.isArray(u)||w.isSplitDraw;s.stroke(),s.setStrokeStyle(r,r.attribute,a,l,h);const{lineDash:A=C.lineDash}=y.attribute;let B=!1;A.length&&A.some((t=>Array.isArray(t)))&&(B=!0),s.beginPath(),s.moveTo(a,l);const R=(_||d[0])&&(x||c[0]),T=(_||d[1])&&(x||c[1]),k=(_||d[2])&&(x||c[2]),M=(_||d[3])&&(x||c[3]);R&&0===t?(x?w.width:c[0],x?w.width:c[0],s.moveTo(e,i),s.lineTo(o,n),(S||B)&&(u&&u[0]?s.strokeStyle=u[0]:u&&!u[0]&&(s.strokeStyle="transparent"),x||(s.lineWidth=c[0]),s.lineDashOffset=s.currentMatrix.e/s.currentMatrix.a,B&&s.setLineDash(null!==(f=A[0])&&void 0!==f?f:[]),s.stroke(),s.beginPath())):0===t&&s.moveTo(a+g,l),T&&1===t?(x?w.width:c[1],x?w.width:c[1],s.moveTo(e,i),s.lineTo(o,n),(S||B)&&(u&&u[1]?s.strokeStyle=u[1]:u&&!u[1]&&(s.strokeStyle="transparent"),x||(s.lineWidth=c[1]),s.lineDashOffset=s.currentMatrix.f/s.currentMatrix.d,B&&s.setLineDash(null!==(v=A[1])&&void 0!==v?v:[]),s.stroke(),s.beginPath(),s.moveTo(a+g,l+p))):1===t&&s.moveTo(a+g,l+p),k&&2===t?(x?w.width:c[2],x?w.width:c[2],s.moveTo(e,i),s.lineTo(o,n),(S||B)&&(u&&u[2]?s.strokeStyle=u[2]:u&&!u[2]&&(s.strokeStyle="transparent"),x||(s.lineWidth=c[2]),s.lineDashOffset=s.currentMatrix.e/s.currentMatrix.a,B&&s.setLineDash(null!==(b=A[2])&&void 0!==b?b:[]),s.stroke(),s.beginPath(),s.moveTo(a,l+p))):2===t&&s.moveTo(a,l+p),M&&3===t?(x?w.width:c[3],x?w.width:c[3],s.moveTo(e,i),s.lineTo(o,n),(S||B)&&(u&&u[3]?s.strokeStyle=u[3]:u&&!u[3]&&(s.strokeStyle="transparent"),x||(s.lineWidth=c[3]),s.lineDashOffset=s.currentMatrix.f/s.currentMatrix.d,B&&s.setLineDash(null!==(m=A[3])&&void 0!==m?m:[]),s.stroke(),s.beginPath(),s.moveTo(a,l))):3===t&&s.moveTo(a,l),s.closePath(),S||B||(!x&&w.width&&(s.lineWidth=w.width),s.stroke()),s.lineDashOffset=0,s.setLineDash([]),s.beginPath()}qk=Yk([C()],qk);var Jk=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let Qk,tM=class{constructor(){this.order=1,this.interceptors=[new eM]}afterDrawItem(t,e,i,o,n){for(let r=0;r<this.interceptors.length;r++)if(this.interceptors[r].afterDrawItem&&this.interceptors[r].afterDrawItem(t,e,i,o,n))return!0;return!1}beforeDrawItem(t,e,i,o,n){if((!t.in3dMode||i.in3dInterceptor)&&!t.shadowRoot&&!(t.baseGraphic||t.attribute.globalZIndex||t.interactiveGraphic))return!1;for(let r=0;r<this.interceptors.length;r++)if(this.interceptors[r].beforeDrawItem&&this.interceptors[r].beforeDrawItem(t,e,i,o,n))return!0;return!1}};tM=Jk([C()],tM);class eM{constructor(){this.order=1}afterDrawItem(t,e,i,o,n){return"image"===t.type&&this.drawItem(t,e,i,o,n),!1}drawItem(t,e,i,o,n){const{image:r,gif:s}=t.attribute;if(s&&t.playing)return!1;if(!r||!t.resources)return!1;const a=t.resources.get(r);if(!a||"loading"!==a.state)return!1;if(!Qk){const t=LR(),e=t.loading_pic.svg,i=t.loading_pic.width,o=t.loading_pic.height;Qk=lc({width:i,height:o,image:e})}const{image:l}=Qk.attribute;if(!r||!Qk.resources)return!1;const h=Qk.resources.get(l);if("success"!==h.state)return!1;const{context:d}=i;d.highPerformanceSave(),t.parent&&d.setTransformFromMatrix(t.parent.globalTransMatrix,!0),t.glyphHost&&t.glyphHost.parent&&d.setTransformFromMatrix(t.glyphHost.parent.globalTransMatrix,!0);const c=t.AABBBounds,{width:u,height:g}=ER(h.data.width,h.data.height,c.width(),c.height());return d.drawImage(h.data,c.x1+(c.width()-u)/2,c.y1+(c.height()-g)/2,u,g),d.highPerformanceRestore(),!0}}var iM=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let oM=class{constructor(){this.time=Ri.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,o,n,r,s,a,l,h,d,c,u){var g,p;const{text:f,underline:v=l.underline,lineThrough:b=l.lineThrough,direction:m=l.direction,whiteSpace:y=l.whiteSpace,fontSize:C=l.fontSize,verticalMode:w=l.verticalMode,ellipsis:x=l.ellipsis,textAlign:_=l.textAlign,textBaseline:S=l.textBaseline,x:A=l.x,y:B=l.y}=t.attribute;let R=!1;if(Array.isArray(t)){const e=null===(g=t.cache)||void 0===g?void 0:g.layoutData;x&&e&&e.lines.every((t=>""===t.str))&&(R=!0)}else{const{cache:e}=t;x&&e&&""===e.clipedText&&0===e.clipedWidth&&(R=!0)}if(!R)return;const T=lt(x)?x:"...",k=null!==(p=pr(t.attribute.lineHeight,C))&&void 0!==p?p:C;let M=0;k!==C&&("top"===S?M=(k-C)/2:"middle"===S||"bottom"===S&&(M=-(k-C)/2)),r&&(c?c(e,t.attribute,l):a&&(e.setStrokeStyle(t,t.attribute,A-i,B-o,l),e.strokeText(T,A,B+M))),n&&(d?d(e,t.attribute,l):s&&(e.setCommonStyle(t,t.attribute,A-i,B-o,l),e.fillText(T,A,B+M),this.drawUnderLine(v,b,t,A,B+M,0,l,e,T)))}drawUnderLine(t,e,i,o,n,r,s,a,l){if(e+t<=0)return;const{textAlign:h=s.textAlign,textBaseline:d=s.textBaseline,fontSize:c=s.fontSize,fontFamily:u=s.fontFamily,fontWeight:g=s.fontWeight,fontStyle:p=s.fontStyle,fill:f=s.fill,opacity:v=s.opacity,underlineOffset:b=s.underlineOffset,underlineDash:m=s.underlineDash,fillOpacity:y=s.fillOpacity}=i.attribute;if(!t&&!e)return;const C=CT.measureTextWidth(l,{fontSize:c,fontFamily:u,fontWeight:g,fontStyle:p}),w=Qs(h,C),x=ta(d,c,c),_={lineWidth:0,stroke:f,opacity:v,strokeOpacity:y};if(t){_.lineWidth=t,a.setStrokeStyle(i,_,o,n,s),a.setLineDash(m),a.beginPath();const e=n+x+c+b;a.moveTo(o+w,e,r),a.lineTo(o+w+C,e,r),a.stroke()}if(e){_.lineWidth=e,a.setStrokeStyle(i,_,o,n,s),a.beginPath();const t=n+x+c/2;a.moveTo(o+w,t,r),a.lineTo(o+w+C,t,r),a.stroke()}}};oM=iM([C()],oM);var nM=new a(((t,e,i,o)=>{i(Fa)?o(Fa).to(Kk).inSingletonScope():(t(Kk).toSelf().inSingletonScope(),t(Ks).toService(Kk)),i(Oa)?o(Oa).to(qk).inSingletonScope():(t(qk).toSelf().inSingletonScope(),t(Ks).toService(qk)),t(Sk).toSelf().inSingletonScope(),t(_k).to(Sk),t(ih).to(Sk),t(Bk).toSelf().inSingletonScope(),t($s).toService(Bk),t(Rk).toSelf().inSingletonScope(),t($s).toService(Rk),t(Tk).toSelf().inSingletonScope(),t($s).toService(Tk),t(kk).toSelf().inSingletonScope(),t($s).toService(kk),t(Gk).toSelf().inSingletonScope(),t(Us).toService(Gk),t(jk).toSelf().inSingletonScope(),t(Us).toService(jk),t(Fk).toSelf().inSingletonScope(),t(Us).toService(Fk),t(Hk).toSelf().inSingletonScope(),t(Us).toService(Hk),t(zk).toSelf().inSingletonScope(),t(Us).toService(zk),t(Dk).toSelf().inSingletonScope(),t(Us).toService(Dk),t(Wk).toSelf().inSingletonScope(),t(Us).toService(Wk),t(Nk).toSelf().inSingletonScope(),t(Us).toService(Nk),t(Vk).toSelf().inSingletonScope(),t(Us).toService(Vk),t(tM).toSelf().inSingletonScope(),t(vh).toService(tM),t(oM).toSelf().inSingletonScope(),t(Zs).toService(oM)}));function rM(t,e,i,o){var n,r,s,a,l,h,d,c;t.internalProps.columnWidthConfig&&t._parseColumnWidthConfig(t.internalProps.columnWidthConfig),t.isPivotTable()&&t.internalProps.columnWidthConfigForRowHeader&&t._parseColumnWidthConfigForRowHeader(t.internalProps.columnWidthConfigForRowHeader),e=null!=e?e:0,i=null!=i?i:t.colCount-1,0===e&&i===t.colCount-1&&t._clearColRangeWidthsMap();const u=t.internalProps.layoutMap;t.isPivotTable()&&(u.enableUseGetBodyCache(),u.enableUseHeaderPathCache());const g=[],p=[];if(o)for(let e=0;e<t.colCount;e++)g[e]=t.getColWidth(e);for(let l=e;l<=i;l++){let e;if(t.internalProps.transpose||"only-header"!==(null===(r=null===(n=t.internalProps.layoutMap.columnObjects)||void 0===n?void 0:n[l])||void 0===r?void 0:r.columnWidthComputeMode)&&"only-header"!==t.columnWidthComputeMode||!("showHeader"in t.internalProps.layoutMap))e=t.internalProps.transpose||"only-body"!==(null===(a=null===(s=t.internalProps.layoutMap.columnObjects)||void 0===s?void 0:s[l])||void 0===a?void 0:a.columnWidthComputeMode)&&"only-body"!==t.columnWidthComputeMode?sM(l,0,t.rowCount-1,t):sM(l,t.internalProps.layoutMap.getBodyRange().start.row,t.internalProps.layoutMap.getBodyRange().end.row,t);else{const i=t.internalProps.layoutMap.showHeader;t.internalProps.layoutMap.showHeader=!0,e=sM(l,0,t.internalProps.layoutMap.headerLevelCount-1,t),t.internalProps.layoutMap.showHeader=i}t._setColContentWidth(l,e),t.getColWidth(l)!==e&&t._clearColRangeWidthsMap(l),o?p[l]=Math.round(t._adjustColWidth(l,e)):t._setColWidth(l,t._adjustColWidth(l,e),!1,!0)}if("adaptive"===t.widthMode){t._clearColRangeWidthsMap();const e=t.tableNoFrameWidth;let i=0,n=0,r=t.colCount;if("only-body"===t.widthAdaptiveMode){for(let e=0;e<t.colCount;e++){const n=o&&null!==(l=p[e])&&void 0!==l?l:t.getColWidth(e);(e<t.rowHeaderLevelCount||t.isPivotChart()&&e>=t.colCount-t.rightFrozenColCount)&&(i+=n)}n=t.rowHeaderLevelCount,r=t.isPivotChart()?t.colCount-t.rightFrozenColCount:t.colCount}cM(e-i,n,r,o,p,t)}else if(t.autoFillWidth){t._clearColRangeWidthsMap();const e=t.tableNoFrameWidth;let i=0,n=0;for(let e=0;e<t.colCount;e++){const r=o&&null!==(h=p[e])&&void 0!==h?h:t.getColWidth(e);(e<t.rowHeaderLevelCount+t.leftRowSeriesNumberCount||t.isPivotChart()&&e>=t.colCount-t.rightFrozenColCount)&&(i+=r),n+=r}n<e&&n>i&&cM(e-i,t.rowHeaderLevelCount+t.leftRowSeriesNumberCount,t.isPivotChart()?t.colCount-t.rightFrozenColCount:t.colCount,o,p,t)}if(o){for(let e=0;e<t.colCount;e++){const i=null!==(c=null!==(d=p[e])&&void 0!==d?d:t.getColWidth(e))&&void 0!==c?c:t.getColWidth(e);i!==g[e]&&t._setColWidth(e,i,!1,!0)}t.stateManager.checkFrozen();for(let e=0;e<t.colCount;e++){const i=t.getColWidth(e);i!==g[e]&&t.scenegraph.updateColWidth(e,i-g[e],!0,!0)}t.scenegraph.updateContainer(!0)}t.isPivotTable()&&(u.disableUseGetBodyCache(),u.disableUseHeaderPathCache())}function sM(t,e,i,o){let n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=function(t,e){const i=e.getColWidthDefined(t);return e.internalProps._widthResizedColMap.has(t)?e.getColWidth(t):i}(t,o);return o.internalProps.transpose&&"auto"===r&&("only-header"===o.columnWidthComputeMode&&t>=o.rowHeaderLevelCount||"only-body"===o.columnWidthComputeMode&&t<o.rowHeaderLevelCount)&&(r=o.getDefaultColumnWidth(t)),n&&!o.internalProps.transpose?aM(r,t,e,i,n,o):"number"==typeof r?r:"auto"!==r&&"string"==typeof r?o._adjustColWidth(t,o._colWidthDefineToPxWidth(r)):aM(r,t,e,i,n,o)}function aM(t,e,i,o,n,r){var s,a,l,h,d;let c=0,u=1,g=1;if(o-i>5e3&&(g=Math.ceil((o-i)/5e3)),r.isPivotChart()&&e>=r.rowHeaderLevelCount&&e<r.colCount-r.rightFrozenColCount){if(r.internalProps.layoutMap.indicatorsAsCol)return r.defaultColWidth;{const t=r.internalProps.layoutMap.getOptimunWidthForChart(e);if(t>0)return t}}for(let p=i;p<=o;p+=u){if(r.isPivotChart()){const t=r.internalProps.layoutMap,i=t.getAxisConfigInPivotChart(e,p);if(i){const t=a_.getFunction("computeAxisComponentWidth")(i,r);if("number"==typeof t){c=Math.max(t,c);continue}}else if(t.isLeftBottomCorner(e,p)||t.isRightTopCorner(e,p)||t.isRightBottomCorner(e,p))continue}const i=lM(e,p,r);if(i&&(c=Math.max(i.width,c),!i.renderDefault))continue;const o=t;if("number"==typeof o&&"standard"===r.widthMode&&!n){c=Math.max(o,c);continue}const f=r.isHeader(e,p)?null===(s=r._getHeaderLayoutMap(e,p))||void 0===s?void 0:s.headerType:r.getBodyColumnType(e,p);if(ot(f)&&"text"!==f&&"link"!==f&&"progressbar"!==f&&"checkbox"!==f&&"radio"!==f&&"switch"!==f&&"button"!==f){c=Math.max(c,r.getColWidthDefinedNumber(e)||0);continue}let v=0;const b=r.internalProps.layoutMap;if(b.isHeader(e,p)){const t=b.getHeader(e,p);if("only-body"===(null===(a=null==t?void 0:t.define)||void 0===a?void 0:a.columnWidthComputeMode))continue;ot(null==t?void 0:t.hierarchyLevel)&&(v=(null!==(l=t.hierarchyLevel)&&void 0!==l?l:0)*("tree"===b.rowHierarchyType&&null!==(h=b.rowHierarchyIndent)&&void 0!==h?h:0),b.rowHierarchyTextStartAlignment&&!r.internalProps.headerHelper.getHierarchyIcon(e,p)&&(v+=r.internalProps.headerHelper.getHierarchyIconWidth()))}else if(r.isListTable()){u=g;const t=r.getBodyColumnDefine(e,p);if(null==t?void 0:t.tree){const t=r.dataSource.getIndexKey(r.getRecordShowIndexByCell(e,p));v=Array.isArray(t)&&r.getHierarchyState(e,p)!==nw.none?(t.length-1)*(null!==(d=b.hierarchyIndent)&&void 0!==d?d:0):0,b.hierarchyTextStartAlignment&&!r.internalProps.bodyHelper.getHierarchyIcon(e,p)&&(v+=r.internalProps.headerHelper.getHierarchyIconWidth())}}const m=hM(e,p,f,r);c=Math.max(m+v,c),u>1&&r.bottomFrozenRowCount>0&&p<r.rowCount-r.bottomFrozenRowCount&&p+u>=r.rowCount-r.bottomFrozenRowCount&&(p=r.rowCount-r.bottomFrozenRowCount-u,u=1,g=1)}const p=r.getMinColWidth(e),f=r.getMaxColWidth(e);return c<p?p:c>f?f:(c<=0&&(c=r.defaultColWidth),c)}function lM(t,e,i){var o,n,r,s,a,l,h;const d=i.getCustomRender(t,e);let c=i.getCustomLayout(t,e);if(d||c){let u,g=1,p=0,f=!1,v=!1;(i.isHeader(t,e)||(null===(o=i.getBodyColumnDefine(t,e))||void 0===o?void 0:o.mergeCell)||i.hasCustomMerge())&&(u=i.getCellRange(t,e),g=u.end.col-u.start.col+1);const b={col:null!==(n=null==u?void 0:u.start.col)&&void 0!==n?n:t,row:null!==(r=null==u?void 0:u.start.row)&&void 0!==r?r:e,dataValue:i.getCellOriginValue(t,e),value:i.getCellValue(t,e)||"",rect:dM(t,e,i),table:i,originCol:t,originRow:e,forComputation:!0};if("react-custom-layout"===c&&(c=(null===(s=i.reactCustomLayout)||void 0===s?void 0:s.getCustomLayoutFunc(t,e))||GB),et(c)){const t=c(b);if(t.rootContainer){t.rootContainer=tR(t.rootContainer),QB(t.rootContainer,0,i.getRowHeight(e));const o=t.rootContainer.attribute.width;t.rootContainer.setStage(i.scenegraph.stage),p=o>0?o:null!==(a=t.rootContainer.AABBBounds.width())&&void 0!==a?a:0,f=t.renderDefault,v=t.enableCellPadding}else p=0,f=t.renderDefault,v=t.enableCellPadding}else if("function"==typeof d){const t=d(b);p=null!==(l=null==t?void 0:t.expectedWidth)&&void 0!==l?l:0,f=null==t?void 0:t.renderDefault}else p=null!==(h=null==d?void 0:d.expectedWidth)&&void 0!==h?h:0,f=null==d?void 0:d.renderDefault;if(p=Math.ceil(p),v){const o=tB(FR("padding",i._getCellStyle(t,e),t,e,i));p+=o[1]+o[3]}return{width:p/g,renderDefault:f}}}function hM(t,e,i,o){var n,r,s,a;let l=0;const h=o.getCellValue(t,e),d=o._getCellStyle(t,e);let c=0,u=!1;if("body"!==o.getCellLocation(t,e))u=!0;else{const i=o.getBodyColumnDefine(t,e);u=!!(null==i?void 0:i.icon)||!!(null==i?void 0:i.tree)||(null==i?void 0:i.dragOrder)}if(u){const i=o.getCellIcons(t,e);null==i||i.forEach((t=>{var e,i,o;t.positionType!==rw.absoluteRight&&(c+=(null!==(e=t.width)&&void 0!==e?e:0)+(null!==(i=t.marginLeft)&&void 0!==i?i:0)+(null!==(o=t.marginRight)&&void 0!==o?o:0))}))}let g=1;if(o.isHeader(t,e)||(null===(n=o.getBodyColumnDefine(t,e))||void 0===n?void 0:n.mergeCell)||o.hasCustomMerge()){const i=o.getCellRange(t,e);g=i.end.col-i.start.col+1}const p=tB(FR("padding",d,t,e,o)),f=p[1]+p[3],v=FR("fontSize",d,t,e,o),b=FR("fontFamily",d,t,e,o),m=FR("fontWeight",d,t,e,o);let y;if("checkbox"===i)y=nt(h)?h.text:h;else if("radio"===i)if(ht(h)){y="";const i=o.getBodyColumnDefine(t,e),n=null!==(r=null==i?void 0:i.radioDirectionInCell)&&void 0!==r?r:"vertical";"vertical"===n?h.forEach((t=>{y+=(nt(t)?t.text:t).toString()+"\n"})):"horizontal"===n&&h.forEach((t=>{y+=(nt(t)?t.text:t).toString()}))}else y=nt(h)?h.text:h;else if("button"===i){const i=ux(o.getBodyColumnDefine(t,e).text,{col:t,row:e,table:o,context:null,value:h,dataValue:o.getCellOriginValue(t,e)});y=null!==(s=null!=i?i:h)&&void 0!==s?s:""}else y=h;const C=WR(y,o).text;if(C.length>=1&&(1!==C.length||""!==C[0])?C.forEach((t=>{const e=o.measureText(t,{fontSize:v,fontFamily:b,fontWeight:m}).width;l=Math.max((e+f+4+c)/g,l)})):l=Math.max((f+4+c)/g,l),!1!==o.internalProps.limitMaxAutoWidth&&(l=Math.min("number"==typeof o.internalProps.limitMaxAutoWidth?o.internalProps.limitMaxAutoWidth:450,l)),"checkbox"===i){const i=FR("size",d,t,e,o);if(l+=i,y){const i=FR("spaceBetweenTextAndIcon",d,t,e,o);l+=i}}else if("radio"===i){const i=FR("size",d,t,e,o),n=FR("outerRadius",d,t,e,o),r=ut(n)?2*n:i,s=FR("spaceBetweenTextAndIcon",d,t,e,o);if(ht(h)){const i=o.getBodyColumnDefine(t,e),n=FR("spaceBetweenRadio",d,t,e,o),c=null!==(a=null==i?void 0:i.radioDirectionInCell)&&void 0!==a?a:"vertical";"vertical"===c?(l+=r,l+=s):"horizontal"===c&&(l+=(r+s)*h.length,l+=n*(h.length-1))}else l+=r,y&&(l+=s)}else if("switch"===i){const i=FR("boxWidth",d,t,e,o);l=i}else if("button"===i){const i=FR("buttonPadding",d,t,e,o);l+=2*i}return l}function dM(t,e,i){return{left:0,top:0,right:i.getColWidth(t),bottom:i.getRowHeight(e),width:null,height:null}}function cM(t,e,i,o,n,r,s){var a,l,h,d;let c=0;const u=[],g=[];let p=0;for(let s=e;s<i;s++){const e=o&&null!==(a=n[s])&&void 0!==a?a:r.getColWidth(s),i=r.getMaxColWidth(s),h=r.getMinColWidth(s);e!==i&&e!==h?(c+=e,u.push(s)):t-=e,(null===(l=r.options.customConfig)||void 0===l?void 0:l.shrinkSparklineFirst)&&"sparkline"===r.getBodyColumnType(s,0)&&(g.push({col:s,width:e}),p+=e-r.defaultColWidth)}const f=t/c;if((null===(h=r.options.customConfig)||void 0===h?void 0:h.shrinkSparklineFirst)&&f<1&&c-t<p)for(let e=0;e<g.length;e++){const{col:i,width:a}=g[e],l=(c-t)/g.length,h=Math.floor(a-l);o?n[i]=r._adjustColWidth(i,h):s?r.scenegraph.setColWidth(i,r._adjustColWidth(i,h)):r._setColWidth(i,r._adjustColWidth(i,h),!1,!0)}else for(let e=0;e<u.length;e++){const i=u[e];let a;a=e===u.length-1?t-u.reduce(((t,e,s)=>{var a;return e!==i?t+(o?null!==(a=n[e])&&void 0!==a?a:r.getColWidth(i):r.getColWidth(e)):t}),0):Math.round((o&&null!==(d=n[i])&&void 0!==d?d:r.getColWidth(i))*f),o?n[i]=r._adjustColWidth(i,a):s?r.scenegraph.setColWidth(i,r._adjustColWidth(i,a)):r._setColWidth(i,r._adjustColWidth(i,a),!1,!0)}}const uM=new PR({});function gM(t,e,i,o,n,r,s,a,l){var h,d;let c,u,g,p=0;t.lastChild&&t.lastChild.row===o-1?p=t.lastChild.attribute.y+t.lastChild.attribute.height:t.colHeight&&(p=t.colHeight);for(let f=o;f<=n;f++){const n=f;let v,b,m,y,C=a.getCellLocation(e,n),w=a.getCellValue(e,n),x=i,_=a.getRowHeight(n),S=!1;if(a.internalProps.customMergeCell){const t=a.getCustomMerge(e,n);if(t){const{range:e,text:i,style:s,customLayout:l,customRender:h}=t;if(v=e,b=v.start.col!==v.end.col||v.start.row!==v.end.row,b){const t=fM(v,r,a,o>v.start.row);x=t.cellWidth,_=t.cellHeight}w=i,m=s,(l||h)&&(y=ZB(l,h,e.start.col,e.start.row,a.getColsWidth(e.start.col,e.end.col),a.getRowsHeight(e.start.row,e.end.row),!1,a.isAutoRowHeight(n),[0,0,0,0],v,a)),S=!0}}let A,B=e,R=n;v&&(B=v.start.col,R=v.start.row),!a.isPivotTable()&&("columnHeader"===C||"cornerHeader"===C)&&n>=a.columnHeaderLevelCount&&(C="body"),A=!a.isPivotTable()&&a.isSeriesNumberInBody(e,n)?a.getBodyColumnDefine(B,R):"body"!==C?a.getHeaderDefine(B,R):a.getBodyColumnDefine(B,R);let T="body"!==C||(null==A?void 0:A.dragOrder)||!!(null==A?void 0:A.icon)||!!(null==A?void 0:A.tree);if(!v&&(a.internalProps.enableTreeNodeMerge||"body"!==C||(null==A?void 0:A.mergeCell))&&(v=a.getCellRange(e,n),b=v.start.col!==v.end.col||v.start.row!==v.end.row,b)){const t=fM(v,r,a,o>v.start.row);x=t.cellWidth,_=t.cellHeight}let k=!1;if(a.internalProps.enableTreeNodeMerge&&b){const t=a.getCellRawRecord(v.start.col,v.start.row),{vtableMergeName:i,vtableMerge:o}=null!=t?t:{};k=o,o&&(T=!0,a.options.groupTitleCustomLayout&&(y=ZB(a.options.groupTitleCustomLayout,void 0,v.start.col,v.start.row,a.getColsWidth(v.start.col,v.end.col),a.getRowsHeight(v.start.row,v.end.row),!1,a.isAutoRowHeight(n),[0,0,0,0],v,a)),a.options.groupTitleFieldFormat?w=a.options.groupTitleFieldFormat(t,e,n,a):i&&(w=i))}const M=k||S?"text":null!==(d=a.isHeader(e,n)?null!==(h=a._getHeaderLayoutMap(e,n).headerType)&&void 0!==h?h:"text":a.getBodyColumnType(e,n))&&void 0!==d?d:"text";if(gx(w)){vM(e,n,0,p,x,_,t),tT(w,a,pM.bind(null,{type:M,value:w,define:A,table:a,col:e,row:n,colWidth:i,cellWidth:x,cellHeight:_,columnGroup:t,y:p,customStyle:m,mayHaveIcon:T,cellLocation:C,range:v,customResult:y,defaultRowHeight:s})),t.updateColumnRowNumber(n);const o=a.getRowHeight(n);t.updateColumnHeight(o),p+=o}else{const o=IB(m||a._getCellStyle(v?v.start.col:e,v?v.start.row:n),a,v?v.start.col:e,v?v.start.row:n,FR).theme;o.group.cornerRadius=zB(e,n,a),o.group.width=i,o.group.height=Array.isArray(s)?s[n]:s,o._vtable.padding&&(c=o._vtable.padding),o.text.textAlign&&(u=o.text.textAlign),o.text.textBaseline&&(g=o.text.textBaseline),"body"===C||o.group.fill||(o.group.fill="#fff");const r=iT(M,w,A,a,e,n,i,x,_,t,p,c,u,g,T,o,v,y);if(t.updateColumnRowNumber(n),b){const i=a.getRowHeight(n),{width:o}=(a.getColWidth(e),r.attribute),{height:s}=r.attribute;r.contentWidth=o,r.contentHeight=s,aT(v,o,s,c,u,g,a),t.updateColumnHeight(i),p+=i}else t.updateColumnHeight(_),p+=_}if(l&&n>l)break}return t.setAttribute("width",i),{width:i,height:p}}function pM(t){let e,i,o;const{type:n,value:r,define:s,table:a,col:l,row:h,colWidth:d,cellWidth:c,cellHeight:u,columnGroup:g,y:p,cellLocation:f,mayHaveIcon:v,customStyle:b,range:m,customResult:y,defaultRowHeight:C}=t,w=IB(b||a._getCellStyle(m?m.start.col:l,m?m.start.row:h),a,m?m.start.col:l,m?m.start.row:h,FR).theme;w.group.cornerRadius=zB(l,h,a),w.group.width=d,w.group.height=Array.isArray(C)?C[h]:C,w._vtable.padding&&(e=w._vtable.padding),w.text.textAlign&&(i=w.text.textAlign),w.text.textBaseline&&(o=w.text.textBaseline),"body"===f||w.group.fill||(w.group.fill="#fff"),iT(n,r,s,a,l,h,d,c,u,g,p,e,i,o,v,w,m,y)}function fM(t,e,i,o){let n=0,r=0;const s=e.get(`${t.start.col},${t.start.row};${t.end.col},${t.end.row}`);if(!s||o){for(let e=t.start.col;e<=t.end.col;e++)n+=i.getColWidth(e);for(let e=t.start.row;e<=t.end.row;e++)r+=i.getRowHeight(e);e.set(`${t.start.col},${t.start.row};${t.end.col},${t.end.row}`,{cellWidth:n,cellHeight:r})}else n=s.cellWidth,r=s.cellHeight;return{cellWidth:n,cellHeight:r}}function vM(t,e,i,o,n,r,s){const a=new PR({x:i,y:o,width:n,height:r});a.role="cell",a.col=t,a.row=e,s.addChild(a)}function bM(t,e,i,o,n,r,s,a,l,h){if(o>n||r>s)return;const{layoutMap:d,defaultHeaderRowHeight:c,defaultColWidth:u}=l.internalProps,g=l.defaultRowHeight;let p=0,f=0;for(let d=o;d<=n;d++){const o=d,n=l.getColWidth(o),u=new PR({x:e+p,y:i,width:n,height:0,clip:!1,pickable:!1});u.role="column",u.col=d,t.addChild(u);const{width:v,height:b}=gM(u,o,n,r,s,l.scenegraph.mergeMap,"columnHeader"===a&&ut(c)?c:g,l,h);p+=v,f=Math.max(f,b)}t.setAttribute("width",p),t.setAttribute("height",f)}function mM(t){let e=t.firstChild;for(;e&&"group"!==e.type;)e=e._next;return e}function yM(t){let e=t.lastChild;for(;e&&"group"!==e.type;)e=e._prev;return e}function CM(t,e,i){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"left";for(let n=t;n<=e;n++){const t=i.scenegraph.getColGroup(n);t&&wM(t,i,o);const e=i.scenegraph.getColGroup(n,!0);e&&wM(e,i,o);const r=i.scenegraph.getColGroupInBottom(n);r&&wM(r,i,o)}const n=Math.min(i.scenegraph.proxy.colLimit,i.scenegraph.proxy.bodyRightCol-i.scenegraph.proxy.bodyLeftCol+1),r=i.getColsWidth(i.frozenColCount,i.frozenColCount+n),s=i.getColsWidth(i.frozenColCount,i.colCount-1);i.scenegraph.proxy.xLimitLeft=r/2,i.scenegraph.proxy.xLimitRight=s-r/2}function wM(t,e){if("left"===(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"left")){let i;const o=function(t){let e=t._prev;for(;e&&"group"!==e.type;)e=e._prev;return e}(t);i=o?o.attribute.x+e.getColWidth(t._prev.col):e.getColsWidth(e.frozenColCount,t.col-1),t.setAttribute("x",i)}else{let i;const o=function(t){let e=t._next;for(;e&&"group"!==e.type;)e=e._next;return e}(t);i=o?o.attribute.x-e.getColWidth(t.col):e.getColsWidth(e.frozenColCount,t.col-1),t.setAttribute("x",i)}}uM.role="empty";var xM=function(t,e,i,o){return new(i||(i=Promise))((function(n,r){function s(t){try{l(o.next(t))}catch(t){r(t)}}function a(t){try{l(o.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((o=o.apply(t,e||[])).next())}))};function _M(t,e,i,o){return xM(this,void 0,void 0,(function*(){if(!e)return;const n=e.col,r=e.left;let s;if(s=i?o.bodyRightCol-o.colEnd:o.screenLeftCol-o.referenceCol,function(t,e,i,o,n){t>0?(SM(t,"left",n.screenLeftCol,i,o,n),n.updateDeltaX(o,i,e),n.table.scenegraph.setBodyAndColHeaderX(-o+n.deltaX)):t<0?(SM(-t,"right",n.screenLeftCol,i,o,n),n.updateDeltaX(o,i,e),n.table.scenegraph.setBodyAndColHeaderX(-o+n.deltaX)):(n.updateDeltaX(o,i,e),n.table.scenegraph.setBodyAndColHeaderX(-o+n.deltaX))}(s,n,r,t,o),i){const e=o.table.scenegraph.getColGroup(o.colEnd);if(e){const i=e.attribute.x+e.attribute.width-(o.table.tableNoFrameWidth-o.table.getFrozenColsWidth()-o.table.getRightFrozenColsWidth())-t;o.deltaX=-i,o.table.scenegraph.setBodyAndColHeaderX(-t+o.deltaX)}}o.table.scenegraph.updateNextFrame()}))}function SM(t,e,i,o,n,r){return xM(this,void 0,void 0,(function*(){if("left"===e&&r.colEnd+t>r.bodyRightCol?t=r.bodyRightCol-r.colEnd:"right"===e&&r.colStart-t<r.bodyLeftCol&&(t=r.colStart-r.bodyLeftCol),0!==t)if(t<0&&(e="left"===e?"right":"left",t=-t),t<r.colEnd-r.colStart){const n="left"===e?r.colStart:r.colEnd-t+1,s="left"===e?r.colStart+t-1:r.colEnd,a="left"===e?r.colEnd+1:r.colStart-t,l="left"===e?r.colEnd+t:r.colStart-1;rM(r.table,a,l),function(t,e,i,o){for(let n=t;n<=e;n++)o.table.scenegraph.bodyGroup.childrenCount>0&&"group"===o.table.scenegraph.bodyGroup.firstChild.type&&TM(o.table.scenegraph.bodyGroup,i,o),o.table.scenegraph.colHeaderGroup.childrenCount>0&&"group"===o.table.scenegraph.colHeaderGroup.firstChild.type&&TM(o.table.scenegraph.colHeaderGroup,i,o),o.table.scenegraph.bottomFrozenGroup.childrenCount>0&&"group"===o.table.scenegraph.bottomFrozenGroup.firstChild.type&&TM(o.table.scenegraph.bottomFrozenGroup,i,o)}(n,s,e,r);const h=a,d=l;r.colStart="left"===e?r.colStart+t:r.colStart-t,r.colEnd="left"===e?r.colEnd+t:r.colEnd-t,kM(h,d,r),CM(h,d,r.table,e);const c=r.table.scenegraph.getColGroup(i)||r.table.scenegraph.getColGroup(i,!0),u=o-(c.attribute.x+r.table.getFrozenColsWidth()+r.table.scenegraph.proxy.deltaX);r.table.scenegraph.proxy.deltaX+=u,r.currentCol="left"===e?r.currentCol+t:r.currentCol-t,r.totalCol=Math.max(0,Math.min(r.table.colCount-1,"left"===e?r.totalCol+t:r.totalCol-t)),r.referenceCol=r.colStart+Math.floor((r.colEnd-r.colStart)/2),r.colUpdatePos=a,r.colUpdateDirection=e,r.table.scenegraph.updateNextFrame()}else{const i="left"===e?r.colStart+t:r.colStart-t,o="left"===e?r.colEnd+t:r.colEnd-t;rM(r.table,i,o),function(t,e,i,o){o.table.scenegraph.colHeaderGroup.forEachChildren(((n,r)=>{"group"===n.type&&AM(n,"left"===i?n.col+e:n.col-e,0===r?t:n._prev.attribute.x+o.table.getColWidth(n._prev.col))})),o.table.scenegraph.bottomFrozenGroup.forEachChildren(((n,r)=>{"group"===n.type&&AM(n,"left"===i?n.col+e:n.col-e,0===r?t:n._prev.attribute.x+o.table.getColWidth(n._prev.col))})),o.table.scenegraph.bodyGroup.forEachChildren(((n,r)=>{"group"===n.type&&AM(n,"left"===i?n.col+e:n.col-e,0===r?t:n._prev.attribute.x+o.table.getColWidth(n._prev.col))}))}(r.table.getColsWidth(r.bodyLeftCol,i-1),t,e,r);const n=i,s=o;r.colStart=i,r.colEnd=o,kM(n,s,r),CM(n,s,r.table,o>r.bodyRightCol-(r.colEnd-r.colStart+1)?"right":"left"),r.currentCol="left"===e?r.currentCol+t:r.currentCol-t,r.totalCol=Math.max(0,Math.min(r.table.colCount-1,"left"===e?r.totalCol+t:r.totalCol-t)),r.referenceCol=r.colStart+Math.floor((r.colEnd-r.colStart)/2),r.colUpdatePos=r.colStart,r.colUpdateDirection=o>r.bodyRightCol-(r.colEnd-r.colStart+1)?"right":"left",r.table.scenegraph.updateNextFrame()}}))}function AM(t,e,i){t.col=e,t.forEachChildren((t=>{t.col=e,t.needUpdate=!0})),t.setAttribute("x",i),t.needUpdate=!0}function BM(t,e){if(!t)return;let i=t.firstChild;for(;i;)i=e.updateCellGroupContent(i)._next;t.needUpdate=!1,t.setAttribute("width",e.table.getColWidth(t.col))}function RM(t,e){if(!t)return;const i=e.screenTopRow,o=Math.max(e.bodyTopRow,i-1*e.screenRowCount),n=Math.min(e.bodyBottomRow,i+2*e.screenRowCount,e.table.rowCount-1);for(let i=o;i<=n;i++){const o=e.highPerformanceGetCell(t.col,i,!0);e.updateCellGroupContent(o)}e.rowUpdatePos=e.rowStart,t.needUpdate=!1,t.setAttribute("width",e.table.getColWidth(t.col))}function TM(t,e,i){if("left"===e){const e=mM(t),o=yM(t);AM(e,o.col+1,o.attribute.x+i.table.getColWidth(o.col)),t.appendChild(e),t.border&&t.appendChild(t.border)}else{const e=yM(t),o=mM(t);AM(e,o.col-1,o.attribute.x-i.table.getColWidth(o.col-1)),t.insertBefore(e,t.firstChild)}}function kM(t,e,i){for(let o=t;o<=e;o++){const t=i.table.scenegraph.getColGroup(o,!0);t&&BM(t,i);const e=i.table.scenegraph.getColGroupInBottom(o);e&&BM(e,i);const n=i.table.scenegraph.getColGroupInRightTopCorner(o);n&&BM(n,i);const r=i.table.scenegraph.getColGroupInRightBottomCorner(o);r&&BM(r,i);const s=i.table.scenegraph.getColGroup(o);s&&RM(s,i)}MM(i.table.scenegraph.colHeaderGroup),MM(i.table.scenegraph.bottomFrozenGroup),MM(i.table.scenegraph.bodyGroup),i.progress()}function MM(t){var e,i;const o=yM(t);if(o&&(t.setAttribute("width",o.attribute.x+o.attribute.width),t.border)){const n=t.border;n.setAttribute("width",o.attribute.x+o.attribute.width-(null!==(e=n.attribute.borderLeft)&&void 0!==e?e:0)/2-(null!==(i=n.attribute.borderRight)&&void 0!==i?i:0)/2)}}function LM(t,e,i,o,n){let r=arguments.length>6?arguments[6]:void 0;var s,a;if("up"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"up"))for(let a=t;a<=e;a++)for(let t=i;t<=o;t++){const e=n.scenegraph.highPerformanceGetCell(a,t,!0);if("cell"!==e.role||!e.row)continue;let i;if(e._prev)i=(null===(s=e._prev)||void 0===s?void 0:s.attribute.y)+n.getRowHeight(e._prev.row);else if(r){const e=o===n.rowCount-n.bottomFrozenRowCount-1?o:o+1;if(i=n.scenegraph.highPerformanceGetCell(a,e,!0).attribute.y,ot(i))for(let o=t;o<e;o++)i-=n.getRowHeight(o)}else i=PM(e.row,n);ot(i)&&e.setAttribute("y",i)}else for(let s=t;s<=e;s++)for(let t=o;t>=i;t--){const e=n.scenegraph.highPerformanceGetCell(s,t,!0);if("cell"!==e.role||!e.row)continue;let o;if(e._next)o=(null===(a=e._next)||void 0===a?void 0:a.attribute.y)-n.getRowHeight(e.row);else if(r){const e=i<=n.frozenRowCount?n.frozenRowCount:i-1;o=i<=n.frozenRowCount?0:n.scenegraph.highPerformanceGetCell(s,e,!0).attribute.y;for(let i=e;i<t;i++)o+=n.getRowHeight(i)}else o=PM(e.row,n);ot(o)&&e.setAttribute("y",o)}const l=Math.min(n.scenegraph.proxy.rowLimit,n.scenegraph.proxy.bodyBottomRow-n.scenegraph.proxy.bodyTopRow+1),h=n.getRowsHeight(n.frozenRowCount,n.frozenRowCount+l),d=n.getRowsHeight(n.frozenRowCount,n.rowCount-1);n.scenegraph.proxy.yLimitTop=h/2,n.scenegraph.proxy.yLimitBottom=d-h/2}function PM(t,e){let i;return i=t<e.frozenRowCount?e.getRowsHeight(0,t-1):t>=e.rowCount-e.bottomFrozenRowCount?e.getRowsHeight(e.rowCount-e.bottomFrozenRowCount,t-1):e.getRowsHeight(e.frozenRowCount,t-1),i}var EM=function(t,e,i,o){return new(i||(i=Promise))((function(n,r){function s(t){try{l(o.next(t))}catch(t){r(t)}}function a(t){try{l(o.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((o=o.apply(t,e||[])).next())}))};function HM(t,e,i,o){return EM(this,void 0,void 0,(function*(){if(!e)return;const n=e.row,r=e.top;let s;if(s=i?o.bodyBottomRow-o.rowEnd:n-o.referenceRow,function(t,e,i,o,n){t>0?(FM(t,"up",e,i,o,n),n.updateDeltaY(o,i,e),n.updateBody(o-n.deltaY)):t<0?(FM(-t,"down",e,i,o,n),n.updateDeltaY(o,i,e),n.updateBody(o-n.deltaY)):(n.updateDeltaY(o,i,e),n.updateBody(o-n.deltaY))}(s,n,r,t,o),i){const e=o.table.scenegraph.highPerformanceGetCell(o.colStart,o.rowEnd,!0);if("cell"===e.role){const i=e.attribute.y+e.attribute.height-(o.table.tableNoFrameHeight-o.table.getFrozenRowsHeight()-o.table.getBottomFrozenRowsHeight())-t;o.deltaY=-i,o.updateBody(t-o.deltaY)}}}))}function FM(t,e,i,o,n,r){return EM(this,void 0,void 0,(function*(){if("up"===e&&r.rowEnd+t>r.bodyBottomRow?t=r.bodyBottomRow-r.rowEnd:"down"===e&&r.rowStart-t<r.bodyTopRow&&(t=r.rowStart-r.bodyTopRow),0!==t)if(t<0&&(e="up"===e?"down":"up",t=-t),t<r.rowEnd-r.rowStart){const o="up"===e?r.rowStart:r.rowEnd-t+1,n="up"===e?r.rowStart+t-1:r.rowEnd,s="up"===e?r.rowEnd+1:r.rowStart-t,a="up"===e?r.rowEnd+t:r.rowStart-1;let l,h;r.table.isAutoRowHeight(o)?(l=s,h=a):(l=Math.max(r.bodyTopRow,i-1*r.screenRowCount),h=Math.min(r.bodyBottomRow,i+2*r.screenRowCount,r.table.rowCount-1)),ST(r.table,l,h,!1),function(t,e,i,o){for(let n=0;n<o.table.frozenColCount;n++){const r=o.table.scenegraph.getColGroup(n);if(r)for(let n=t;n<=e;n++)OM(r,i,o)}for(let n=o.table.colCount-o.table.rightFrozenColCount;n<o.table.colCount;n++){const r=o.table.scenegraph.getColGroup(n);if(r)for(let n=t;n<=e;n++)OM(r,i,o)}for(let n=o.bodyLeftCol;n<=o.bodyRightCol;n++){const r=o.table.scenegraph.getColGroup(n);if(r)for(let n=t;n<=e;n++)OM(r,i,o)}}(o,n,e,r),r.rowStart="up"===e?r.rowStart+t:r.rowStart-t,r.rowEnd="up"===e?r.rowEnd+t:r.rowEnd-t;const d=IM(l,h,r,!0);r.table.isAutoRowHeight(o)&&(LM(r.bodyLeftCol,r.bodyRightCol,l,h,r.table,a>r.bodyBottomRow-(r.rowEnd-r.rowStart+1)?"down":"up",!0),LM(0,r.table.frozenColCount-1,l,h,r.table,a>r.bodyBottomRow-(r.rowEnd-r.rowStart+1)?"down":"up",!0),LM(r.table.colCount-r.table.rightFrozenColCount,r.table.colCount-1,l,h,r.table,a>r.bodyBottomRow-(r.rowEnd-r.rowStart+1)?"down":"up",!0)),r.currentRow="up"===e?r.currentRow+t:r.currentRow-t,r.totalRow=Math.max(0,Math.min(r.bodyBottomRow,"up"===e?r.totalRow+t:r.totalRow-t,r.table.rowCount-1)),r.referenceRow=r.rowStart+Math.floor((r.rowEnd-r.rowStart)/2),r.table.isAutoRowHeight(o)&&d?r.rowUpdatePos=Math.min(r.rowUpdatePos,r.rowEnd+1):r.rowUpdatePos=Math.min(r.rowUpdatePos,s),r.rowUpdateDirection=e,r.table.scenegraph.updateNextFrame(),yield r.progress()}else{const o="up"===e?r.rowStart+t:r.rowStart-t,n=Math.min(r.table.rowCount-1,"up"===e?r.rowEnd+t:r.rowEnd-t),s=r.table.getRowsHeight(r.bodyTopRow,o-1);let a,l;r.table.isAutoRowHeight(o)?(a=o,l=n):(a=Math.max(r.bodyTopRow,i-1*r.screenRowCount),l=Math.min(r.bodyBottomRow,i+2*r.screenRowCount,r.table.rowCount-1)),ST(r.table,a,l,!1),function(t,e,i,o){for(let n=0;n<o.table.frozenColCount;n++){const r=o.table.scenegraph.getColGroup(n);null==r||r.forEachChildren(((n,r)=>{o.updateCellGroupPosition(n,"up"===i?n.row+e:n.row-e,0===r?t:n._prev.attribute.y+o.table.getRowHeight(n._prev.row))}))}for(let n=o.table.colCount-o.table.rightFrozenColCount;n<o.table.colCount;n++){const r=o.table.scenegraph.getColGroup(n);null==r||r.forEachChildren(((n,r)=>{o.updateCellGroupPosition(n,"up"===i?n.row+e:n.row-e,0===r?t:n._prev.attribute.y+o.table.getRowHeight(n._prev.row))}))}for(let n=o.bodyLeftCol;n<=o.bodyRightCol;n++){const r=o.table.scenegraph.getColGroup(n);null==r||r.forEachChildren(((n,r)=>{o.updateCellGroupPosition(n,"up"===i?n.row+e:n.row-e,0===r?t:n._prev.attribute.y+o.table.getRowHeight(n._prev.row))}))}}(s,t,e,r),r.rowStart=o,r.rowEnd=n;const h=IM(a,l,r,!0);r.table.isAutoRowHeight(o)&&(LM(r.bodyLeftCol,r.bodyRightCol,a,l,r.table,n>r.bodyBottomRow-(r.rowEnd-r.rowStart+1)?"down":"up"),LM(0,r.table.frozenColCount-1,a,l,r.table,n>r.bodyBottomRow-(r.rowEnd-r.rowStart+1)?"down":"up"),LM(r.table.colCount-r.table.rightFrozenColCount,r.table.colCount-1,a,l,r.table,n>r.bodyBottomRow-(r.rowEnd-r.rowStart+1)?"down":"up")),r.currentRow="up"===e?r.currentRow+t:r.currentRow-t,r.totalRow=Math.max(0,Math.min(r.bodyBottomRow,"up"===e?r.totalRow+t:r.totalRow-t,r.table.rowCount-1)),r.referenceRow=r.rowStart+Math.floor((r.rowEnd-r.rowStart)/2),r.table.isAutoRowHeight(o)&&h?r.rowUpdatePos=r.rowEnd+1:r.rowUpdatePos=r.rowStart,r.rowUpdateDirection=n>r.bodyBottomRow-(r.rowEnd-r.rowStart+1)?"down":"up",r.table.scenegraph.updateNextFrame(),yield r.progress()}}))}function OM(t,e,i){if(t.childrenCount>=1)if("up"===e){const e=t.firstChild;i.updateCellGroupPosition(e,t.lastChild.row+1,t.lastChild.attribute.y+i.table.getRowHeight(t.lastChild.row)),t.appendChild(e)}else{const e=t.lastChild;i.updateCellGroupPosition(e,t.firstChild.row-1,t.firstChild.attribute.y-i.table.getRowHeight(e.row)),t.insertBefore(e,t.firstChild)}}function IM(t,e,i){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];for(let o=0;o<i.table.frozenColCount;o++)for(let n=t;n<=e;n++){const t=i.highPerformanceGetCell(o,n,!0);i.updateCellGroupContent(t)}for(let o=i.table.colCount-i.table.rightFrozenColCount;o<i.table.colCount;o++)for(let n=t;n<=e;n++){const t=i.highPerformanceGetCell(o,n);i.updateCellGroupContent(t)}let n=i.bodyLeftCol,r=i.bodyRightCol,s=!0;if(o){const t=i.screenLeftCol;n=Math.max(i.bodyLeftCol,t-1*i.screenColCount),r=Math.min(i.bodyRightCol,t+2*i.screenColCount),n===i.bodyLeftCol&&r===i.bodyRightCol||(s=!1)}for(let o=n;o<=r;o++)for(let n=t;n<=e;n++){const t=i.highPerformanceGetCell(o,n);i.updateCellGroupContent(t)}return zM(i.table.scenegraph.rowHeaderGroup),zM(i.table.scenegraph.rightFrozenGroup),zM(i.table.scenegraph.bodyGroup),i.table.scenegraph.updateNextFrame(),s}function zM(t){var e,i;const o=yM(t);if(!o)return;const n=yM(o);if(n&&(t.setAttribute("height",n.attribute.y+n.attribute.height),t.border)){const o=t.border;o.setAttribute("height",n.attribute.y+n.attribute.height-(null!==(e=o.attribute.borderTop)&&void 0!==e?e:0)/2-(null!==(i=o.attribute.borderBottom)&&void 0!==i?i:0)/2)}}var DM=function(t,e,i,o){return new(i||(i=Promise))((function(n,r){function s(t){try{l(o.next(t))}catch(t){r(t)}}function a(t){try{l(o.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((o=o.apply(t,e||[])).next())}))};var WM=function(t,e,i,o){return new(i||(i=Promise))((function(n,r){function s(t){try{l(o.next(t))}catch(t){r(t)}}function a(t){try{l(o.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((o=o.apply(t,e||[])).next())}))};function NM(t){const{changedCells:e}=t.internalProps.stick;e.forEach((e=>{t.scenegraph.getCell(e.col,e.row).forEachChildren((t=>{t.setAttributes({dx:e.dx,dy:e.dy})}))})),e.clear();const{scrollTop:i,scrollLeft:o,frozenRowCount:n,frozenColCount:r}=t,s=t.getFrozenRowsHeight(),a=t.getFrozenColsWidth(),{row:l}=t.getRowAt(i+s+1),{col:h}=t.getColAt(o+a+1),d=Math.max(l,t.frozenRowCount),c=Math.max(h,t.frozenColCount),u=t.getAllRowsHeight()>t.tableNoFrameHeight?t.getRowAt(i+t.tableNoFrameHeight-t.getBottomFrozenRowsHeight()-1).row:t.rowCount-t.bottomFrozenRowCount-1,g=t.getAllColsWidth()>t.tableNoFrameWidth?t.getColAt(o+t.tableNoFrameWidth-t.getRightFrozenColsWidth()-1).col:t.colCount-t.rightFrozenColCount-1;if(!(g<0||u<0)){for(let i=0;i<n&&!(g<c);i++)[c,g].forEach((o=>{const n=t._getCellStyle(o,i);(null==n?void 0:n.textStick)&&"vertical"!==(null==n?void 0:n.textStick)&&VM(t.scenegraph.getCell(o,i),a+t.tableX,t.tableNoFrameWidth-t.getRightFrozenColsWidth()+t.tableX,e,null==n?void 0:n.textStickBaseOnAlign,t)}));for(let i=0;i<r&&!(u<d);i++)[d,u].forEach((o=>{const n=t._getCellStyle(i,o);(null==n?void 0:n.textStick)&&"horizontal"!==(null==n?void 0:n.textStick)&&GM(t.scenegraph.getCell(i,o),s+t.tableY,t.tableNoFrameHeight-t.getBottomFrozenRowsHeight()+t.tableY,e,null==n?void 0:n.textStickBaseOnAlign,t)}));for(let i=c;i<=g&&!(u<d);i++)[d,u].forEach((o=>{const n=t._getCellStyle(i,o);(null==n?void 0:n.textStick)&&"horizontal"!==(null==n?void 0:n.textStick)&&GM(t.scenegraph.getCell(i,o),s+t.tableY,t.tableNoFrameHeight-t.getBottomFrozenRowsHeight()+t.tableY,e,null==n?void 0:n.textStickBaseOnAlign,t)}));for(let i=d;i<=u&&!(g<c);i++)[c,g].forEach((o=>{const n=t._getCellStyle(o,i);(null==n?void 0:n.textStick)&&"vertical"!==(null==n?void 0:n.textStick)&&VM(t.scenegraph.getCell(o,i),a+t.tableX,t.tableNoFrameWidth-t.getRightFrozenColsWidth()+t.tableX,e,null==n?void 0:n.textStickBaseOnAlign,t)}))}}function GM(t,e,i,o,n,r){if(ut(t.mergeStartCol)&&ut(t.mergeStartRow)&&ut(t.mergeEndCol)&&ut(t.mergeEndRow)){const{colStart:s,colEnd:a,rowStart:l,rowEnd:h}=LT(t,r.scenegraph);for(let t=s;t<=a;t++)for(let s=l;s<=h;s++){const a=r.scenegraph.getCell(t,s);"cell"===a.role&&jM(a,e,i,o,n)}}else jM(t,e,i,o,n)}function jM(t,e,i,o,n){var r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w;const x=t.getChildByName("text",!0)||t.getChildByName("image",!0);if(!x)return;if("image"===x.type){const{image:t}=x.attribute;if(!t||!x.resources)return;if("success"!==x.resources.get(t).state)return}const _=null!==(r=x.textBaseline)&&void 0!==r?r:"top";x.AABBBounds.width();const S=x.globalAABBBounds.y1,A=x.globalAABBBounds.y2;if("middle"===_&&n){const n=t.globalAABBBounds.y1+(null!==(a=null===(s=t.firstChild)||void 0===s?void 0:s.attribute.dy)&&void 0!==a?a:0),r=n+(null!==(h=null!==(l=t.contentHeight)&&void 0!==l?l:t.attribute.height)&&void 0!==h?h:0);if(n<e||r>i){const s=Math.max(n,e),a=Math.min(r,i),l=x.globalTransMatrix.f-(a+s)/2+x.AABBBounds.height()/2;!o.has(`${t.col}-${t.row}`)&&o.set(`${t.col}-${t.row}`,{col:t.col,row:t.row,dx:null!==(c=null===(d=t.firstChild)||void 0===d?void 0:d.attribute.dx)&&void 0!==c?c:0,dy:null!==(g=null===(u=t.firstChild)||void 0===u?void 0:u.attribute.dy)&&void 0!==g?g:0}),t.forEachChildren((t=>{var e;t.setAttribute("dy",(null!==(e=t.attribute.dy)&&void 0!==e?e:0)-l+2)}))}}else if(S<e){const i=S-e;!o.has(`${t.col}-${t.row}`)&&o.set(`${t.col}-${t.row}`,{col:t.col,row:t.row,dx:null!==(f=null===(p=t.firstChild)||void 0===p?void 0:p.attribute.dx)&&void 0!==f?f:0,dy:null!==(b=null===(v=t.firstChild)||void 0===v?void 0:v.attribute.dy)&&void 0!==b?b:0}),t.forEachChildren((t=>{var e;t.setAttribute("dy",(null!==(e=t.attribute.dy)&&void 0!==e?e:0)-i+2)}))}else if(A>i){const e=A-i;!o.has(`${t.col}-${t.row}`)&&o.set(`${t.col}-${t.row}`,{col:t.col,row:t.row,dx:null!==(y=null===(m=t.firstChild)||void 0===m?void 0:m.attribute.dx)&&void 0!==y?y:0,dy:null!==(w=null===(C=t.firstChild)||void 0===C?void 0:C.attribute.dy)&&void 0!==w?w:0}),t.forEachChildren((t=>{var i;t.setAttribute("dy",(null!==(i=t.attribute.dy)&&void 0!==i?i:0)-e)}))}}function VM(t,e,i,o,n,r){if(ut(t.mergeStartCol)&&ut(t.mergeStartRow)&&ut(t.mergeEndCol)&&ut(t.mergeEndRow)){const{colStart:s,colEnd:a,rowStart:l,rowEnd:h}=LT(t,r.scenegraph);for(let t=s;t<=a;t++)for(let s=l;s<=h;s++){const a=r.scenegraph.getCell(t,s);"cell"===a.role&&UM(a,e,i,o,n)}}else UM(t,e,i,o,n)}function UM(t,e,i,o,n){var r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x;const _=t.getChildByName("text",!0)||t.getChildByName("image",!0);if(!_)return;if("image"===_.type){const{image:t}=_.attribute;if(!t||!_.resources)return;if("success"!==_.resources.get(t).state)return}const S=null!==(s=null!==(r=_.attribute.textAlign)&&void 0!==r?r:_.textAlign)&&void 0!==s?s:"left";_.AABBBounds.width();const A=_.globalAABBBounds.x1,B=_.globalAABBBounds.x2;if("center"===S&&n){const n=t.globalAABBBounds.x1+(null!==(l=null===(a=t.firstChild)||void 0===a?void 0:a.attribute.dx)&&void 0!==l?l:0),r=n+(null!==(d=null!==(h=t.contentWidth)&&void 0!==h?h:t.attribute.width)&&void 0!==d?d:0);if(n<e||r>i){const s=Math.max(n,e),a=Math.min(r,i),l=_.globalTransMatrix.e-(a+s)/2;!o.has(`${t.col}-${t.row}`)&&o.set(`${t.col}-${t.row}`,{col:t.col,row:t.row,dx:null!==(u=null===(c=t.firstChild)||void 0===c?void 0:c.attribute.dx)&&void 0!==u?u:0,dy:null!==(p=null===(g=t.firstChild)||void 0===g?void 0:g.attribute.dy)&&void 0!==p?p:0}),t.forEachChildren((t=>{var e;t.setAttribute("dx",(null!==(e=t.attribute.dx)&&void 0!==e?e:0)-l+2)}))}}else if(A<e){const i=A-e;!o.has(`${t.col}-${t.row}`)&&o.set(`${t.col}-${t.row}`,{col:t.col,row:t.row,dx:null!==(v=null===(f=t.firstChild)||void 0===f?void 0:f.attribute.dx)&&void 0!==v?v:0,dy:null!==(m=null===(b=t.firstChild)||void 0===b?void 0:b.attribute.dy)&&void 0!==m?m:0}),t.forEachChildren((t=>{var e;t.setAttribute("dx",(null!==(e=t.attribute.dx)&&void 0!==e?e:0)-i+2)}))}else if(B>i){const e=B-i;!o.has(`${t.col}-${t.row}`)&&o.set(`${t.col}-${t.row}`,{col:t.col,row:t.row,dx:null!==(C=null===(y=t.firstChild)||void 0===y?void 0:y.attribute.dx)&&void 0!==C?C:0,dy:null!==(x=null===(w=t.firstChild)||void 0===w?void 0:w.attribute.dy)&&void 0!==x?x:0}),t.forEachChildren((t=>{var i;t.setAttribute("dx",(null!==(i=t.attribute.dx)&&void 0!==i?i:0)-e)}))}}function $M(t){var e,i;const o=t.internalProps.layoutMap.headerObjects,n=t.internalProps.layoutMap.columnObjects;for(let t=0;t<o.length;t++){const i=o[t];if(i&&(null===(e=i.style)||void 0===e?void 0:e.textStick))return!0}for(let t=0;t<n.length;t++){const e=n[t];if(e&&(null===(i=e.style)||void 0===i?void 0:i.textStick))return!0}return!!(t.theme.headerStyle.textStick||t.theme.rowHeaderStyle.textStick||t.theme.bodyStyle.textStick)}var XM=function(t,e,i,o){return new(i||(i=Promise))((function(n,r){function s(t){try{l(o.next(t))}catch(t){r(t)}}function a(t){try{l(o.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((o=o.apply(t,e||[])).next())}))};class YM{constructor(t){this.isRelease=!1,this.mode="column",this.rowLimit=200,this.currentRow=0,this.rowStart=0,this.rowEnd=0,this.referenceRow=0,this.screenTopRow=0,this.deltaY=0,this.deltaHeight=0,this.colLimit=100,this.screenLeftCol=0,this.deltaX=0,this.deltaWidth=0,this.cellCache=new Map,this.table=t,this.table.isPivotChart()?(this.rowLimit=Math.max(100,Math.ceil(2*t.tableNoFrameHeight/t.defaultRowHeight)),this.colLimit=Math.max(100,Math.ceil(2*t.tableNoFrameWidth/t.defaultColWidth))):this.table.isAutoRowHeight(t.columnHeaderLevelCount)?this.rowLimit=Math.max(100,Math.ceil(2*t.tableNoFrameHeight/t.defaultRowHeight)):("autoWidth"===this.table.widthMode||(this.rowLimit=Math.max(200,Math.ceil(2*t.tableNoFrameHeight/t.defaultRowHeight))),this.colLimit=Math.max(100,Math.ceil(2*t.tableNoFrameWidth/t.defaultColWidth))),this.table.internalProps.transpose?this.mode="row":this.table.isPivotTable()&&(this.mode="pivot"),this.table.options.maintainedDataCount&&(this.rowLimit=this.table.options.maintainedDataCount),this.table.options.maintainedColumnCount&&(this.colLimit=this.table.options.maintainedColumnCount),"adaptive"===this.table.heightMode&&(this.rowLimit=this.table.rowCount),"adaptive"===this.table.widthMode&&(this.colLimit=this.table.colCount)}get bodyLeftCol(){return this.table.frozenColCount}get bodyTopRow(){return this.table.frozenRowCount}setParamsForColumn(){this.bodyRightCol=this.table.colCount-1-this.table.rightFrozenColCount;const t=Math.min(this.colLimit,this.bodyRightCol-this.bodyLeftCol+1);this.totalActualBodyColCount=t,this.totalCol=this.bodyLeftCol+t-1,this.colStart=this.bodyLeftCol,this.colEnd=this.totalCol;const e=this.table.defaultColWidth;this.taskColCount=1*Math.ceil(this.table.tableNoFrameWidth/e);const i=e*t,o=e*(this.bodyRightCol-this.bodyLeftCol+1);this.xLimitLeft=i/2,this.xLimitRight=o-i/2;const n=5*this.table.tableNoFrameWidth;this.screenColCount=Math.ceil(this.table.tableNoFrameWidth/e),this.firstScreenColLimit=Math.max(15,this.bodyLeftCol+Math.min(this.colLimit,Math.ceil(n/e))),this.colUpdatePos=this.bodyRightCol}setParamsForRow(){this.bodyBottomRow=this.table.rowCount-1-this.table.bottomFrozenRowCount;const t=Math.min(this.rowLimit,this.bodyBottomRow-this.bodyTopRow+1);this.totalActualBodyRowCount=t,this.totalRow=this.bodyTopRow+t-1,this.rowStart=this.bodyTopRow,this.rowEnd=this.totalRow;const e=this.table.defaultRowHeight;this.taskRowCount=1*Math.ceil(this.table.tableNoFrameHeight/e);const i=e*t,o=e*(this.bodyBottomRow-this.bodyTopRow+1);this.yLimitTop=i/2,this.yLimitBottom=o-i/2;const n=5*this.table.tableNoFrameHeight;this.screenRowCount=Math.ceil(this.table.tableNoFrameHeight/e),this.firstScreenRowLimit=Math.max(30,this.bodyTopRow+Math.min(this.rowLimit,Math.ceil(n/e))),this.rowUpdatePos=this.bodyBottomRow}refreshRowCount(){this.bodyBottomRow=this.table.rowCount-1-this.table.bottomFrozenRowCount;const t=Math.min(this.rowLimit,this.bodyBottomRow-this.bodyTopRow+1);this.totalActualBodyRowCount=t,this.totalRow=this.rowStart+t-1}refreshColCount(){this.bodyRightCol=this.table.colCount-1-this.table.rightFrozenColCount;const t=Math.min(this.colLimit,this.bodyRightCol-this.bodyLeftCol+1);this.totalActualBodyColCount=t,this.totalCol=this.bodyLeftCol+t-1,this.colStart=this.bodyLeftCol,this.colEnd=this.totalCol}resize(){const t=this.table.defaultColWidth;this.taskColCount=1*Math.ceil(this.table.tableNoFrameWidth/t);const e=5*this.table.tableNoFrameWidth;this.screenColCount=Math.ceil(this.table.tableNoFrameWidth/t),this.firstScreenColLimit=this.bodyLeftCol+Math.min(this.colLimit,Math.ceil(e/t));const i=this.table.defaultRowHeight;this.taskRowCount=1*Math.ceil(this.table.tableNoFrameHeight/i);const o=5*this.table.tableNoFrameHeight;this.screenRowCount=Math.ceil(this.table.tableNoFrameHeight/i),this.firstScreenRowLimit=this.bodyTopRow+Math.min(this.rowLimit,Math.ceil(o/i))}createGroupForFirstScreen(t,e,i,o,n,r,s,a){!function(t,e,i,o,n,r,s,a,l){var h,d,c,u,g,p,f,v,b,m,y,C;const{table:w}=l,{leftBottomCornerGroup:x,rightTopCornerGroup:_,rightBottomCornerGroup:S}=w.scenegraph;let A,B,R,T;l.setParamsForRow(),l.setParamsForColumn(),"adaptive"===w.widthMode||w.options.autoWrapText&&("adaptive"===w.heightMode||w.isAutoRowHeight(w.columnHeaderLevelCount))?(R=w.colCount-1,A=Math.min(l.firstScreenColLimit-1,w.colCount-1)):A=Math.min(l.firstScreenColLimit-1,w.colCount-1),"adaptive"===w.heightMode?(T=w.rowCount-1,B=Math.min(l.firstScreenRowLimit-1,w.rowCount-1)):B=Math.min(l.firstScreenRowLimit-1,w.rowCount-1),0===w.internalProps._widthResizedColMap.size&&rM(w,0,null!=R?R:A),0===w.internalProps._heightResizedRowMap.size&&ST(w,0,"auto"===w.options.canvasHeight?w.rowCount-1:null!=T?T:B),A<w.colCount-w.rightFrozenColCount&&w.colCount-w.rightFrozenColCount<=w.colCount-1&&rM(w,w.colCount-w.rightFrozenColCount,w.colCount-1),B<w.rowCount-w.bottomFrozenRowCount&&w.rowCount-w.bottomFrozenRowCount<=w.rowCount-1&&ST(w,w.rowCount-w.bottomFrozenRowCount,w.rowCount-1),w.scenegraph.colHeaderGroup.setAttribute("x",w.getFrozenColsWidth()),w.scenegraph.rowHeaderGroup.setAttribute("y",w.getFrozenRowsHeight()),w.scenegraph.bottomFrozenGroup.setAttribute("x",w.getFrozenColsWidth()),w.scenegraph.rightFrozenGroup.setAttribute("y",w.getFrozenRowsHeight()),w.scenegraph.bodyGroup.setAttributes({x:w.getFrozenColsWidth(),y:w.getFrozenRowsHeight()}),bM(t,s,a,0,w.frozenColCount-1,0,w.frozenRowCount-1,w.isListTable()?"columnHeader":"cornerHeader",w),A-w.rightFrozenColCount>=w.frozenColCount&&bM(e,s,a,w.frozenColCount,A-w.rightFrozenColCount,0,w.frozenRowCount-1,"columnHeader",w),w.frozenColCount>0&&(w.leftRowSeriesNumberCount>0&&bM(i,s,a,0,w.leftRowSeriesNumberCount-1,w.frozenRowCount,B-w.bottomFrozenRowCount,"rowHeader",w),w.frozenColCount>w.leftRowSeriesNumberCount&&bM(i,s,a,w.leftRowSeriesNumberCount,Math.min(w.frozenColCount-1,w.rowHeaderLevelCount+w.leftRowSeriesNumberCount-1),w.frozenRowCount,B-w.bottomFrozenRowCount,"rowHeader",w),w.frozenColCount>w.rowHeaderLevelCount+w.leftRowSeriesNumberCount&&bM(i,s,a,w.rowHeaderLevelCount+w.leftRowSeriesNumberCount,w.frozenColCount-1,w.frozenRowCount,B-w.bottomFrozenRowCount,"body",w)),w.bottomFrozenRowCount>0&&(w.frozenColCount>0&&(w.leftRowSeriesNumberCount>0&&bM(x,s,a,0,w.leftRowSeriesNumberCount-1,w.rowCount-1-w.bottomFrozenRowCount+1,w.rowCount-1,"rowHeader",w),w.rowHeaderLevelCount>0&&bM(x,s,a,w.leftRowSeriesNumberCount,w.leftRowSeriesNumberCount+w.rowHeaderLevelCount-1,w.rowCount-1-w.bottomFrozenRowCount+1,w.rowCount-1,"rowHeader",w),w.frozenColCount>w.rowHeaderLevelCount+w.leftRowSeriesNumberCount&&bM(x,s,a,w.rowHeaderLevelCount+w.leftRowSeriesNumberCount,w.frozenColCount-1,w.rowCount-1-w.bottomFrozenRowCount+1,w.rowCount-1,"body",w)),A-w.rightFrozenColCount>=w.frozenColCount&&bM(n,s,a,w.frozenColCount,A-w.rightFrozenColCount,w.rowCount-1-w.bottomFrozenRowCount+1,w.rowCount-1,w.isPivotChart()?"rowHeader":"body",w)),w.rightFrozenColCount>0&&(bM(_,s,a,w.colCount-1-w.rightFrozenColCount+1,w.colCount-1,0,w.frozenRowCount-1,"columnHeader",w),bM(o,s,a,w.colCount-1-w.rightFrozenColCount+1,w.colCount-1,w.frozenRowCount,B-w.bottomFrozenRowCount,w.isPivotChart()?"rowHeader":"body",w)),w.bottomFrozenRowCount>0&&w.rightFrozenColCount>0&&bM(S,s,a,w.colCount-1-w.rightFrozenColCount+1,w.colCount-1,w.rowCount-1-w.bottomFrozenRowCount+1,w.rowCount-1,"body",w),A-w.rightFrozenColCount>=w.frozenColCount&&bM(r,s,a,w.frozenColCount,A-w.rightFrozenColCount,w.frozenRowCount,B-w.bottomFrozenRowCount,"body",w),r.firstChild||e.firstChild||t.firstChild||i.firstChild?(l.currentRow=null!==(u=null!==(d=null===(h=r.firstChild)||void 0===h?void 0:h.rowNumber)&&void 0!==d?d:null===(c=i.firstChild)||void 0===c?void 0:c.rowNumber)&&void 0!==u?u:l.totalRow,l.rowEnd=l.currentRow,l.rowUpdatePos=l.rowEnd+1,l.referenceRow=l.rowStart+Math.floor((l.rowEnd-l.rowStart)/2),l.currentCol=null!==(C=null!==(m=null!==(v=null!==(p=null===(g=r.lastChild)||void 0===g?void 0:g.col)&&void 0!==p?p:null===(f=e.lastChild)||void 0===f?void 0:f.col)&&void 0!==v?v:null===(b=i.lastChild)||void 0===b?void 0:b.col)&&void 0!==m?m:null===(y=t.lastChild)||void 0===y?void 0:y.col)&&void 0!==C?C:l.totalCol,l.colEnd=l.currentCol,l.colUpdatePos=l.colEnd+1,l.referenceCol=l.colStart+Math.floor((l.colEnd-l.colStart)/2),l.progress()):(l.currentRow=l.totalRow,l.rowEnd=l.currentRow,l.rowUpdatePos=l.rowEnd+1,l.referenceRow=l.rowStart+Math.floor((l.rowEnd-l.rowStart)/2),l.currentCol=l.totalCol,l.colEnd=l.currentCol,l.colUpdatePos=l.colEnd+1,l.referenceCol=l.colStart+Math.floor((l.colEnd-l.colStart)/2))}(t,e,i,o,n,r,s,a,this)}progress(){return XM(this,void 0,void 0,(function*(){if(!this.isProgressing)return this.isProgressing=!0,new Promise(((t,e)=>{setTimeout((()=>XM(this,void 0,void 0,(function*(){this.isProgressing=!1,this.isRelease||(this.colUpdatePos<=this.colEnd?(yield this.updateColCellGroupsAsync(),yield this.progress()):this.rowUpdatePos<=this.rowEnd?(yield this.updateRowCellGroupsAsync(),yield this.progress()):this.currentCol<this.totalCol?(yield this.createCol(),yield this.progress()):this.currentRow<this.totalRow&&(yield this.createRow(),yield this.progress()),NM(this.table),this.table.scenegraph.updateNextFrame(),t())}))),16)}))}))}createRow(){return XM(this,void 0,void 0,(function*(){this.taskRowCount&&this.createRowCellGroup(this.taskRowCount)}))}createCol(){return XM(this,void 0,void 0,(function*(){this.taskColCount&&this.createColGroup(this.taskRowCount)}))}createRowCellGroup(t){const e=Math.min(this.totalRow,this.currentRow+t);if("adaptive"!==this.table.heightMode&&ST(this.table,this.currentRow+1,e,!1),this.rowEnd=e,this.table.frozenColCount){let t=0;for(let i=0;i<this.table.frozenColCount;i++){const o=this.table.scenegraph.getColGroup(i),{height:n}=(this.table.isListTable(),gM(o,i,o.attribute.width,this.currentRow+1,e,this.table.scenegraph.mergeMap,this.table.defaultRowHeight,this.table));t=Math.max(t,n),this.table.scenegraph.rowHeaderGroup.setAttribute("height",t)}}if(this.table.rightFrozenColCount){let t=0;for(let i=this.table.colCount-this.table.rightFrozenColCount;i<this.table.colCount;i++){const o=this.table.scenegraph.getColGroup(i),{height:n}=(this.table.isPivotChart(),gM(o,i,o.attribute.width,this.currentRow+1,e,this.table.scenegraph.mergeMap,this.table.defaultRowHeight,this.table));t=Math.max(t,n),this.table.scenegraph.rightFrozenGroup.setAttribute("height",t)}}let i=0;for(let t=this.bodyLeftCol;t<=this.bodyRightCol;t++){const o=this.table.scenegraph.getColGroup(t);if(!o)continue;this.table.rowHeaderLevelCount;const{height:n}=gM(o,t,o.attribute.width,this.currentRow+1,e,this.table.scenegraph.mergeMap,this.table.defaultRowHeight,this.table);i=Math.max(i,n)}this.table.scenegraph.bodyGroup.setAttribute("height",i),this.currentRow=e,this.rowUpdatePos=this.rowEnd,this.table.scenegraph.updateContainer(),this.table.scenegraph.updateBorderSizeAndPosition()}createColGroup(t){const e=Math.min(this.totalCol,this.currentCol+t);"adaptive"!==this.table.widthMode&&rM(this.table,this.currentCol+1,e),this.colEnd=e;for(let t=0;t<this.table.rowCount;t++){const e=this.highPerformanceGetCell(this.currentCol,t);"cell"===e.role&&ut(e.mergeStartCol)&&e.mergeStartCol>this.currentCol&&this.table.scenegraph.updateCellContent(e.col,e.row)}if(this.table.frozenRowCount){const t=this.table.scenegraph.colHeaderGroup.lastChild instanceof PR?this.table.scenegraph.colHeaderGroup.lastChild:this.table.scenegraph.colHeaderGroup.lastChild._prev,i=t.attribute.x+t.attribute.width,o=t.attribute.y;bM(this.table.scenegraph.colHeaderGroup,i,o,this.currentCol+1,e,0,this.table.frozenRowCount-1,"columnHeader",this.table)}if(this.table.bottomFrozenRowCount){const t=this.table.scenegraph.bottomFrozenGroup.lastChild instanceof PR?this.table.scenegraph.bottomFrozenGroup.lastChild:this.table.scenegraph.bottomFrozenGroup.lastChild._prev,i=t.attribute.x+t.attribute.width,o=t.attribute.y;bM(this.table.scenegraph.bottomFrozenGroup,i,o,this.currentCol+1,e,this.table.rowCount-this.table.bottomFrozenRowCount,this.table.rowCount-1,"columnHeader",this.table)}let i=this.table.scenegraph.bodyGroup.lastChild&&(this.table.scenegraph.bodyGroup.lastChild instanceof PR?this.table.scenegraph.bodyGroup.lastChild:this.table.scenegraph.bodyGroup.lastChild._prev);i||(i=this.table.scenegraph.colHeaderGroup.lastChild&&(this.table.scenegraph.colHeaderGroup.lastChild instanceof PR?this.table.scenegraph.colHeaderGroup.lastChild:this.table.scenegraph.colHeaderGroup.lastChild._prev));const o=i.attribute.x+i.attribute.width,n=i.attribute.y;bM(this.table.scenegraph.bodyGroup,o,n,this.currentCol+1,e,this.rowStart,this.rowEnd,"body",this.table),this.currentCol=e,this.colUpdatePos=this.colEnd,this.table.scenegraph.updateContainer(),this.table.scenegraph.updateBorderSizeAndPosition()}setY(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return XM(this,void 0,void 0,(function*(){const i=this.table.getRowsHeight(this.bodyTopRow,this.bodyTopRow+(this.rowEnd-this.rowStart+1))/2,o=this.table.getAllRowsHeight()-i,n=this.table.getTargetRowAt(t+this.table.scenegraph.colHeaderGroup.attribute.height);n&&(this.screenTopRow=n.row),t<i&&this.rowStart===this.bodyTopRow||t>o&&this.rowEnd===this.bodyBottomRow?(this.updateDeltaY(t),this.updateBody(t-this.deltaY)):this.table.scenegraph.bodyGroup.firstChild&&"group"===this.table.scenegraph.bodyGroup.firstChild.type&&0!==this.table.scenegraph.bodyGroup.firstChild.childrenCount||this.table.scenegraph.rowHeaderGroup.firstChild&&"group"===this.table.scenegraph.rowHeaderGroup.firstChild.type&&0!==this.table.scenegraph.rowHeaderGroup.firstChild.childrenCount?this.dynamicSetY(t,n,e):(this.updateDeltaY(t),this.updateBody(t-this.deltaY))}))}setX(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return XM(this,void 0,void 0,(function*(){const i=this.table.getColsWidth(this.bodyLeftCol,this.bodyLeftCol+(this.colEnd-this.colStart+1))/2,o=this.table.getAllColsWidth()-i,n=this.table.getTargetColAt(t+this.table.scenegraph.rowHeaderGroup.attribute.width);n&&(this.screenLeftCol=n.col),t<i&&this.colStart===this.bodyLeftCol||t>o&&this.colEnd===this.bodyRightCol||this.table.scenegraph.bodyGroup.firstChild&&"group"===this.table.scenegraph.bodyGroup.firstChild.type&&0===this.table.scenegraph.bodyGroup.firstChild.childrenCount?(this.updateDeltaX(t),this.table.scenegraph.setBodyAndColHeaderX(-t+this.deltaX)):this.dynamicSetX(t,n,e)}))}dynamicSetY(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return XM(this,void 0,void 0,(function*(){HM(t,e,i,this)}))}dynamicSetX(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return XM(this,void 0,void 0,(function*(){_M(t,e,i,this)}))}updateBody(t){this.table.scenegraph.setBodyAndRowHeaderY(-t)}updateRowCellGroupsAsync(){return XM(this,void 0,void 0,(function*(){this.updateCellGroups(this.taskRowCount)}))}updateCellGroups(t){const e=Math.min(this.bodyBottomRow,this.rowUpdatePos+t);this.table.isAutoRowHeight(this.rowUpdatePos)&&ST(this.table,this.rowUpdatePos,e,!1),IM(this.rowUpdatePos,e,this),this.table.isAutoRowHeight(this.rowUpdatePos)&&(LM(this.bodyLeftCol,this.bodyRightCol,this.rowUpdatePos,e,this.table,this.rowUpdateDirection,!0),LM(0,this.table.frozenColCount-1,this.rowUpdatePos,e,this.table,this.rowUpdateDirection,!0),LM(this.table.colCount-this.table.rightFrozenColCount,this.table.colCount-1,this.rowUpdatePos,e,this.table,this.rowUpdateDirection,!0)),this.rowUpdatePos=e+1}updateBottomFrozenCellGroups(){const t=this.table.rowCount-this.table.bottomFrozenRowCount,e=this.table.rowCount-1;this.table.isAutoRowHeight(t)&&ST(this.table,t,e,!1),IM(t,e,this),this.table.isAutoRowHeight(t)&&(LM(this.bodyLeftCol,this.bodyRightCol,t,e,this.table,this.rowUpdateDirection),LM(0,this.table.frozenColCount-1,t,e,this.table,this.rowUpdateDirection),LM(this.table.colCount-this.table.rightFrozenColCount,this.table.colCount-1,t,e,this.table,this.rowUpdateDirection))}updateRightFrozenCellGroups(){const t=this.table.colCount-this.table.rightFrozenColCount,e=this.table.colCount-1;"autoWidth"===this.table.widthMode&&rM(this.table,t,e,!1),kM(t,e,this),this.table.isAutoRowHeight(this.rowStart)&&CM(t,e,this.table,this.colUpdateDirection)}updateColCellGroupsAsync(){return XM(this,void 0,void 0,(function*(){this.updateColGroups(this.taskRowCount)}))}updateColGroups(t){const e=Math.min(this.bodyRightCol,this.colUpdatePos+t);"autoWidth"===this.table.widthMode&&rM(this.table,this.colUpdatePos,e),kM(this.colUpdatePos,e,this),this.colUpdatePos=e+1}updateCellGroupPosition(t,e,i){t.row=e,t.mergeStartCol=void 0,t.mergeStartRow=void 0,t.mergeEndCol=void 0,t.mergeEndRow=void 0,t.setAttribute("y",i),t.needUpdate=!0,t.needUpdateForAutoRowHeight=!0}updateCellGroupContent(t){if(!t.needUpdate||"cell"!==t.role)return t;const e=this.table.scenegraph.updateCellContent(t.col,t.row);return t.needUpdate=!1,e||t}sortCellVertical(){return XM(this,void 0,void 0,(function*(){yield function(t){var e;return DM(this,void 0,void 0,(function*(){let i,o;t.table.scenegraph.bodyGroup.forEachChildren(((t,e)=>{"group"===t.type&&(t.needUpdate=!0,null==t||t.forEachChildren((t=>{t.needUpdate=!0})))})),t.table.isAutoRowHeight(t.rowStart)?(i=t.rowStart,o=t.rowEnd):(i=Math.max(t.bodyTopRow,t.screenTopRow-1*t.screenRowCount),o=Math.min(t.bodyBottomRow,t.screenTopRow+2*t.screenRowCount,t.table.rowCount-1));const n=t.table.getAllRowsHeight();ST(t.table,i,o);const r=t.table.getAllRowsHeight();n!==r&&t.table.scenegraph.updateContainerHeight(t.table.frozenRowCount,r-n);for(let i=0;i<(null!==(e=t.table.frozenColCount)&&void 0!==e?e:0);i++){const e=t.table.scenegraph.getColGroup(i);null==e||e.setAttribute("chartInstance",void 0);for(let e=t.rowStart;e<=t.rowEnd;e++)t.table.scenegraph.updateCellContent(i,e);for(let e=t.table.rowCount-t.table.bottomFrozenRowCount;e<t.table.rowCount;e++)t.table.scenegraph.updateCellContent(i,e)}for(let e=t.colStart;e<=t.colEnd;e++){const i=t.table.scenegraph.getColGroup(e);null==i||i.setAttribute("chartInstance",void 0);for(let i=t.table.rowCount-t.table.bottomFrozenRowCount;i<t.table.rowCount;i++)t.table.scenegraph.updateCellContent(e,i)}for(let e=t.table.colCount-t.table.rightFrozenColCount;e<t.table.colCount;e++){const i=t.table.scenegraph.getColGroup(e);null==i||i.setAttribute("chartInstance",void 0);for(let i=t.rowStart;i<=t.rowEnd;i++)t.table.scenegraph.updateCellContent(e,i);for(let i=t.table.rowCount-t.table.bottomFrozenRowCount;i<t.table.rowCount;i++)t.table.scenegraph.updateCellContent(e,i)}IM(i,o,t),t.table.isAutoRowHeight(i)&&LM(t.bodyLeftCol,t.bodyRightCol,i,o,t.table,t.rowEnd>t.bodyBottomRow-(t.rowEnd-t.rowStart+1)?"down":"up"),t.rowUpdatePos=t.rowStart,t.rowUpdateDirection=t.rowEnd>t.bodyBottomRow-(t.rowEnd-t.rowStart+1)?"down":"up",t.table.scenegraph.updateNextFrame(),t.table.isAutoRowHeight(t.rowStart)||(yield t.progress())}))}(this)}))}sortCellHorizontal(){return XM(this,void 0,void 0,(function*(){yield function(t){return WM(this,void 0,void 0,(function*(){t.table.scenegraph.bodyGroup.forEachChildren(((t,e)=>{"group"===t.type&&(t.needUpdate=!0,null==t||t.forEachChildren((t=>{t.needUpdate=!0})))}));const e=Math.max(t.bodyLeftCol,t.screenLeftCol-1*t.screenColCount),i=Math.min(t.bodyRightCol,t.screenLeftCol+2*t.screenColCount);rM(t.table,e,i);for(let e=t.colStart;e<=t.colEnd;e++){const i=t.table.scenegraph.getColGroup(e);null==i||i.setAttribute("chartInstance",void 0);for(let i=t.table.rowCount-t.table.bottomFrozenRowCount;i<t.table.rowCount;i++)t.table.scenegraph.updateCellContent(e,i)}for(let e=t.table.colCount-t.table.rightFrozenColCount;e<t.table.colCount;e++){const i=t.table.scenegraph.getColGroup(e);null==i||i.setAttribute("chartInstance",void 0);for(let i=t.rowStart;i<=t.rowEnd;i++)t.table.scenegraph.updateCellContent(e,i);for(let i=t.table.rowCount-t.table.bottomFrozenRowCount;i<t.table.rowCount;i++)t.table.scenegraph.updateCellContent(e,i)}kM(e,i,t),t.colUpdatePos=t.colStart,t.colUpdateDirection=t.colEnd>t.bodyRightCol-(t.colEnd-t.colStart+1)?"right":"left",t.table.scenegraph.updateNextFrame(),yield t.progress()}))}(this)}))}highPerformanceGetCell(t,e,i){if(e>=this.table.frozenRowCount&&e<this.table.rowCount-this.table.bottomFrozenRowCount&&(e<this.rowStart||e>this.rowEnd))return uM;if(t>=this.table.frozenColCount&&t<this.table.colCount-this.table.rightFrozenColCount&&(t<this.colStart||t>this.colEnd))return uM;if(this.cellCache.get(t)){const o=this.cellCache.get(t);if((o._next||o._prev)&&Math.abs(o.row-e)<e){let n=KM(o,e);return n&&(i||"shadow-cell"!==n.role)||(n=this.table.scenegraph.getCell(t,e,i)),n.row&&this.cellCache.set(t,n),n}const n=this.table.scenegraph.getCell(t,e,i);return n.col===t&&n.row&&this.cellCache.set(t,n),n}const o=this.table.scenegraph.getCell(t,e,i);return o.col===t&&o.row&&this.cellCache.set(t,o),o}updateDeltaY(t,e,i){if(this.rowStart===this.bodyTopRow){const t=this.table.scenegraph.highPerformanceGetCell(this.colStart,this.rowStart,!0);if("cell"===t.role){const e=t.attribute.y;this.deltaY=-e}}else if(this.rowEnd===this.bodyBottomRow){const t=this.table.scenegraph.highPerformanceGetCell(this.colStart,this.rowEnd,!0);if("cell"===t.role){const e=t.attribute.y+t.attribute.height-(this.table.getAllRowsHeight()-this.table.getFrozenRowsHeight()-this.table.getBottomFrozenRowsHeight());this.deltaY=-e}}else if(ot(e)&&ot(i)){let o=this.table.scenegraph.highPerformanceGetCell(this.colStart,i,!0);"cell"!==o.role&&(o=this.table.scenegraph.highPerformanceGetCell(0,i,!0));const n=t-this.deltaY,r=e-n,s=o.attribute.y-n+this.table.getFrozenRowsHeight();this.deltaY=r-s}}updateDeltaX(t,e,i){if(this.colStart===this.bodyLeftCol){const t=this.table.scenegraph.getColGroup(this.colStart);if(t){const e=t.attribute.x;this.deltaX=-e}}else if(this.colEnd===this.bodyRightCol){const t=this.table.scenegraph.getColGroup(this.colEnd);if(t){const e=t.attribute.x+t.attribute.width-(this.table.getAllColsWidth()-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth());this.deltaX=-e}}else if(ot(e)&&ot(i)){const o=this.table.scenegraph.getColGroup(i)||this.table.scenegraph.getColGroup(i,!0),n=t-this.deltaX,r=e-n,s=o.attribute.x-n+this.table.getFrozenColsWidth();this.deltaX=r-s}}release(){this.isRelease=!0}}function KM(t,e){if(!t)return null;if(t.row===e)return t;const i=t._prev,o=t._next;return t.row>e&&i&&i.row===t.row-1?KM(i,e):t.row<e&&o&&o.row===t.row+1?KM(o,e):null}function qM(t){t.customSelectedRangeComponents.forEach(((e,i)=>{ZM(e,i,t)})),t.selectingRangeComponents.forEach(((e,i)=>{ZM(e,i,t)})),t.selectedRangeComponents.forEach(((e,i)=>{ZM(e,i,t)}))}function ZM(t,e,i){var o,n,r,s,a,l,h,d,c,u;const g=i.table,[p,f,v,b]=e.split("-"),m=parseInt(p,10),y=parseInt(f,10),C=parseInt(v,10),w=parseInt(b,10);let x,_=m,S=y,A=C,B=w;switch(t.role){case"rowHeader":x=g.getBodyVisibleRowRange(),x&&(S=Math.max(y,x.rowStart-1),B=Math.min(w,x.rowEnd+1));break;case"columnHeader":case"bottomFrozen":x=g.getBodyVisibleCellRange(),x&&(_=Math.max(m,x.colStart-1),A=Math.min(C,x.colEnd+1));break;case"cornerHeader":case"rightTopCorner":case"leftBottomCorner":case"rightBottomCorner":break;case"rightFrozen":x=g.getBodyVisibleCellRange(),x&&(S=Math.max(y,x.rowStart-1),B=Math.min(w,x.rowEnd+1));break;default:x=g.getBodyVisibleCellRange(),x&&(S=Math.max(y,x.rowStart-1),B=Math.min(w,x.rowEnd+1),_=Math.max(m,x.colStart-1),A=Math.min(C,x.colEnd+1))}const R=g.getColsWidth(_,A),T=g.getRowsHeight(S,B),k=i.highPerformanceGetCell(_,S).globalAABBBounds;if(t.rect.setAttributes({x:k.x1-i.tableGroup.attribute.x,y:k.y1-i.tableGroup.attribute.y,width:R,height:T,visible:!0}),t.fillhandle){const e=null===(o=i.table.options.excelOptions)||void 0===o?void 0:o.fillHandle;let r,s=!0;"function"==typeof e&&(s=e({selectRanges:i.table.stateManager.select.ranges,table:i.table})),r=A<g.colCount-1?i.highPerformanceGetCell(A,B).globalAABBBounds:i.highPerformanceGetCell(_-1,B).globalAABBBounds;const a=r.x2-i.tableGroup.attribute.x-3;r=B<g.rowCount-1?i.highPerformanceGetCell(A,B).globalAABBBounds:i.highPerformanceGetCell(A,S-1).globalAABBBounds;const l=r.y2-i.tableGroup.attribute.y-3;null===(n=t.fillhandle)||void 0===n||n.setAttributes({x:a,y:l,width:6,height:6,visible:s})}let M=!!g.frozenColCount&&m===g.frozenColCount;!M&&g.frozenColCount&&g.scrollLeft>0&&m>=g.frozenColCount&&g.getColsWidth(0,m-1)-g.scrollLeft<g.getFrozenColsWidth()&&(M=!0);let L=!!g.rightFrozenColCount&&g.rightFrozenColCount>0&&C===g.colCount-g.rightFrozenColCount-1;!L&&g.rightFrozenColCount&&C<g.colCount-g.rightFrozenColCount&&g.getColsWidth(0,C)-g.scrollLeft>g.tableNoFrameWidth-g.getRightFrozenColsWidth()&&(L=!0);let P=!g.frozenRowCount||y===g.frozenRowCount;!P&&g.frozenRowCount&&g.scrollTop>0&&y>=g.frozenRowCount&&g.getRowsHeight(0,y-1)-g.scrollTop<g.getFrozenRowsHeight()&&(P=!0);let E=!!g.bottomFrozenRowCount&&w===g.rowCount-g.bottomFrozenRowCount-1;if(!E&&g.bottomFrozenRowCount&&w<g.rowCount-g.bottomFrozenRowCount&&g.getRowsHeight(0,w)-g.scrollTop>g.tableNoFrameHeight-g.getBottomFrozenRowsHeight()&&(E=!0),M&&t.rect.attribute.stroke[3]||L&&t.rect.attribute.stroke[1]||P&&t.rect.attribute.stroke[0]||E&&t.rect.attribute.stroke[2]){if(M&&t.rect.attribute.stroke[3]&&i.tableGroup.insertAfter(t.rect,"columnHeader"===t.role?i.cornerHeaderGroup:"bottomFrozen"===t.role?i.leftBottomCornerGroup:i.rowHeaderGroup),E&&t.rect.attribute.stroke[2]&&i.tableGroup.insertAfter(t.rect,"rowHeader"===t.role?i.leftBottomCornerGroup:"rightFrozen"===t.role?i.rightBottomCornerGroup:i.bottomFrozenGroup),P&&t.rect.attribute.stroke[0]&&i.tableGroup.insertAfter(t.rect,"rowHeader"===t.role?i.cornerHeaderGroup:"rightFrozen"===t.role?i.rightTopCornerGroup:i.colHeaderGroup),L&&t.rect.attribute.stroke[1]&&i.tableGroup.insertAfter(t.rect,"columnHeader"===t.role?i.rightTopCornerGroup:"bottomFrozen"===t.role?i.rightBottomCornerGroup:i.rightFrozenGroup),t.rect.attribute.x<g.getFrozenColsWidth()&&g.scrollLeft>0&&("body"===t.role||"columnHeader"===t.role||"bottomFrozen"===t.role)){const e=t.rect.attribute.width-(g.getFrozenColsWidth()-t.rect.attribute.x);t.rect.setAttributes({x:t.rect.attribute.x+(g.getFrozenColsWidth()-t.rect.attribute.x),width:e>0?e:0}),null===(r=t.fillhandle)||void 0===r||r.setAttributes({visible:e>0})}if(g.getRightFrozenColsWidth()>0&&i.rightFrozenGroup.attribute.height>0&&t.rect.attribute.x+t.rect.attribute.width>i.rightFrozenGroup.attribute.x&&("body"===t.role||"columnHeader"===t.role||"bottomFrozen"===t.role)){const e=i.rightFrozenGroup.attribute.x-t.rect.attribute.x;t.rect.setAttributes({x:t.rect.attribute.x,width:e>0?e:0}),null===(s=t.fillhandle)||void 0===s||s.setAttributes({visible:e-R>0})}if(t.rect.attribute.y<i.colHeaderGroup.attribute.height&&g.scrollTop>0&&("body"===t.role||"rowHeader"===t.role||"rightFrozen"===t.role)){const e=t.rect.attribute.height-(i.colHeaderGroup.attribute.height-t.rect.attribute.y);t.rect.setAttributes({y:t.rect.attribute.y+(i.colHeaderGroup.attribute.height-t.rect.attribute.y),height:e>0?e:0}),null===(a=t.fillhandle)||void 0===a||a.setAttributes({visible:e>0})}if(i.bottomFrozenGroup.attribute.width>0&&i.bottomFrozenGroup.attribute.height>0&&t.rect.attribute.y+t.rect.attribute.height>i.bottomFrozenGroup.attribute.y&&("body"===t.role||"rowHeader"===t.role||"rightFrozen"===t.role)){const e=i.bottomFrozenGroup.attribute.y-t.rect.attribute.y;t.rect.setAttributes({y:t.rect.attribute.y,height:e>0?e:0}),null===(l=t.fillhandle)||void 0===l||l.setAttributes({visible:e-T>0})}}else i.tableGroup.insertAfter(t.rect,"body"===t.role?i.bodyGroup:"columnHeader"===t.role?i.colHeaderGroup:"rowHeader"===t.role?i.rowHeaderGroup:"cornerHeader"===t.role?i.cornerHeaderGroup:"rightTopCorner"===t.role?i.rightTopCornerGroup:"rightFrozen"===t.role?i.rightFrozenGroup:"leftBottomCorner"===t.role?i.leftBottomCornerGroup:"bottomFrozen"===t.role?i.bottomFrozenGroup:i.rightBottomCornerGroup);let H=0;"number"==typeof t.rect.attribute.lineWidth&&(H=Math.ceil(t.rect.attribute.lineWidth/2)),C===g.colCount-1&&(Array.isArray(t.rect.attribute.lineWidth)&&(H=Math.ceil((null!==(h=t.rect.attribute.lineWidth[1])&&void 0!==h?h:0)/2)),t.rect.setAttributes({width:t.rect.attribute.width-H})),0===m&&(Array.isArray(t.rect.attribute.lineWidth)&&(H=Math.ceil((null!==(d=t.rect.attribute.lineWidth[3])&&void 0!==d?d:0)/2)),t.rect.setAttributes({x:t.rect.attribute.x+H,width:t.rect.attribute.width-H})),w===g.rowCount-1&&(Array.isArray(t.rect.attribute.lineWidth)&&(H=Math.ceil((null!==(c=t.rect.attribute.lineWidth[2])&&void 0!==c?c:0)/2)),t.rect.setAttributes({height:t.rect.attribute.height-H})),0===y&&(Array.isArray(t.rect.attribute.lineWidth)&&(H=Math.ceil((null!==(u=t.rect.attribute.lineWidth[0])&&void 0!==u?u:0)/2)),t.rect.setAttributes({y:t.rect.attribute.y+H,height:t.rect.attribute.height-H}))}function JM(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const o=t.table,n=e.start.col,r=e.start.row,s=e.end.col,a=e.end.row,l=e.skipBodyMerge;let h=Math.max(Math.min(s,n),0),d=Math.max(Math.min(a,r),0),c=Math.min(Math.max(s,n),o.colCount-1),u=Math.min(Math.max(a,r),o.rowCount-1);const g=()=>{let t=!1;for(let e=h;e<=c;e++){if(e===h)for(let i=d;i<=u;i++){if(!o.isHeader(e,i)&&l)continue;const n=s_(o,e,i);if(n&&n.start.col<h){h=n.start.col,t=!0;break}}if(!t&&e===c)for(let i=d;i<=u;i++){if(!o.isHeader(e,i)&&l)continue;const n=s_(o,e,i);if(n&&Math.min(n.end.col,o.colCount-1)>c){c=n.end.col,t=!0;break}}if(t)break}if(!t)for(let e=d;e<=u;e++){if(e===d)for(let i=h;i<=c;i++){if(!o.isHeader(i,e)&&l)continue;const n=s_(o,i,e);if(n&&n.start.row<d){d=n.start.row,t=!0;break}}if(!t&&e===u)for(let i=h;i<=c;i++){if(!o.isHeader(i,e)&&l)continue;const n=s_(o,i,e);if(n&&Math.min(n.end.row,o.rowCount-1)>u){u=n.end.row,t=!0;break}}if(t)break}t&&g()};i&&(g(),e.start.col>e.end.col?(e.start.col=Math.max(h,c),e.end.col=Math.min(h,c)):(e.start.col=Math.min(h,c),e.end.col=Math.max(h,c)),e.start.row>e.end.row?(e.start.row=Math.max(d,u),e.end.row=Math.min(d,u)):(e.start.row=Math.min(d,u),e.end.row=Math.max(d,u))),t.selectingRangeComponents.forEach(((t,e)=>{var i;t.rect.delete(),null===(i=t.fillhandle)||void 0===i||i.delete()})),t.selectingRangeComponents=new Map;let p=!1,f=!1,v=!1,b=!1,m=!1,y=!1,C=!1,w=!1,x=!1;if(h<=o.frozenColCount-1&&d<=o.frozenRowCount-1&&(y=!0),c>=o.colCount-o.rightFrozenColCount&&d<=o.frozenRowCount-1&&(C=!0),h<=o.frozenColCount-1&&u>=o.rowCount-o.bottomFrozenRowCount&&(x=!0),c>=o.colCount-o.rightFrozenColCount&&u>=o.rowCount-o.bottomFrozenRowCount&&(w=!0),h<=o.frozenColCount-1&&u>=o.frozenRowCount&&d<=o.rowCount-o.bottomFrozenRowCount-1&&(p=!0),c>=o.colCount-o.rightFrozenColCount&&u>=o.frozenRowCount&&d<=o.rowCount-o.bottomFrozenRowCount-1&&(f=!0),d<=o.frozenRowCount-1&&c>=o.frozenColCount&&h<=o.colCount-o.rightFrozenColCount-1&&(v=!0),u>=o.rowCount-o.bottomFrozenRowCount&&c>=o.frozenColCount&&h<=o.colCount-o.rightFrozenColCount-1&&(b=!0),h<=o.colCount-o.rightFrozenColCount-1&&c>=o.frozenColCount&&d<=o.rowCount-o.bottomFrozenRowCount-1&&u>=o.frozenRowCount&&(m=!0),y){const e=Math.min(c,o.frozenColCount-1),i=Math.min(u,o.frozenRowCount-1),n=[!0,!v,!p,!0];t.createCellSelectBorder(h,d,e,i,"cornerHeader",`${h}${d}${c}${u}`,n)}if(C){const e=Math.max(h,o.colCount-o.rightFrozenColCount),i=Math.min(u,o.frozenRowCount-1),n=[!0,!0,!f,!v];t.createCellSelectBorder(e,d,c,i,"rightTopCorner",`${h}${d}${c}${u}`,n)}if(x){const e=Math.min(c,o.frozenColCount-1),i=Math.max(d,o.rowCount-o.bottomFrozenRowCount),n=[!p,!b,!0,!0];t.createCellSelectBorder(h,i,e,u,"leftBottomCorner",`${h}${d}${c}${u}`,n)}if(w){const e=Math.max(h,o.colCount-o.rightFrozenColCount),i=Math.max(d,o.rowCount-o.bottomFrozenRowCount),n=[!f,!0,!0,!b];t.createCellSelectBorder(e,i,c,u,"rightBottomCorner",`${h}${d}${c}${u}`,n)}if(v){const e=Math.max(h,o.frozenColCount),i=Math.min(c,o.colCount-o.rightFrozenColCount-1),n=Math.min(u,o.frozenRowCount-1),r=[!0,!C,!m,!y];t.createCellSelectBorder(e,d,i,n,"columnHeader",`${h}${d}${c}${u}`,r)}if(b){const e=Math.max(h,o.frozenColCount),i=Math.min(c,o.colCount-o.rightFrozenColCount-1),n=Math.max(d,o.rowCount-o.bottomFrozenRowCount),r=[!m,!w,!0,!x];t.createCellSelectBorder(e,n,i,u,"bottomFrozen",`${h}${d}${c}${u}`,r)}if(p){const e=Math.max(d,o.frozenRowCount),i=Math.min(u,o.rowCount-o.bottomFrozenRowCount-1),n=Math.min(c,o.frozenColCount-1),r=[!y,!m,!x,!0];t.createCellSelectBorder(h,e,n,i,"rowHeader",`${h}${d}${c}${u}`,r)}if(f){const e=Math.max(d,o.frozenRowCount),i=Math.min(u,o.rowCount-o.bottomFrozenRowCount-1),n=Math.max(h,o.colCount-o.rightFrozenColCount),r=[!C,!0,!w,!m];t.createCellSelectBorder(n,e,c,i,"rightFrozen",`${h}${d}${c}${u}`,r)}if(m){const e=Math.max(h,o.frozenColCount),i=Math.max(d,o.frozenRowCount),n=Math.min(c,o.colCount-o.rightFrozenColCount-1),r=Math.min(u,o.rowCount-o.bottomFrozenRowCount-1),s=[!v,!f,!b,!p];t.createCellSelectBorder(e,i,n,r,"body",`${h}${d}${c}${u}`,s)}}function QM(t){t.selectingRangeComponents.forEach(((t,e)=>{t.rect.setAttribute("opacity",0)})),t.selectedRangeComponents.forEach(((t,e)=>{t.rect.setAttribute("opacity",0)}))}function tL(t){t.selectingRangeComponents.forEach(((t,e)=>{t.rect.setAttribute("opacity",1)})),t.selectedRangeComponents.forEach(((t,e)=>{t.rect.setAttribute("opacity",1)}))}function eL(t,e,i,o,n,r,s){if(!e)return;const a=Array.isArray(e)?e:[e,e,e,e],l=s.colCount-1,h=s.rowCount-1,d=[0,0,0,0];let c=!1;return 0===i&&0===o?(d[0]=a[0],c=!0):n===l&&r===h?(d[2]=a[2],c=!0):0===i&&r===h?(d[3]=a[3],c=!0):n===l&&0===o&&(d[1]=a[1],c=!0),c?d:void 0}function iL(t){t.selectingRangeComponents.forEach(((e,i)=>{var o;t.selectedRangeComponents.get(i)&&(t.selectingRangeComponents.get(i).rect.delete(),null===(o=t.selectingRangeComponents.get(i).fillhandle)||void 0===o||o.delete()),t.selectedRangeComponents.set(i,e)})),t.selectingRangeComponents=new Map,t.updateNextFrame()}function oL(t){t.selectedRangeComponents.forEach(((t,e)=>{var i;t.rect.delete(),null===(i=t.fillhandle)||void 0===i||i.delete()})),t.selectedRangeComponents=new Map}function nL(t){t.selectingRangeComponents.forEach(((t,e)=>{var i;t.rect.delete(),null===(i=t.fillhandle)||void 0===i||i.delete()})),t.selectingRangeComponents=new Map}function rL(t,e,i,o,n){var r,s;const a=o.scenegraph,l=Jw(t.map((t=>t.row))).sort(((t,e)=>e-t)),h=Jw(e.map((t=>t.row))).sort(((t,e)=>t-e)),d=Jw(i.map((t=>t.row))).sort(((t,e)=>t-e));let c;if(d.length&&(c=hL(d[0]-1,d[d.length-1]+1,a)),h.length){const t=hL(h[0]-1,h[h.length-1]+1,a);c=ot(c)?ot(t)?Math.min(c,t):c:t}if(l.length){const t=hL(l[0]-1,l[l.length-1]+1,a);c=ot(c)?ot(t)?Math.min(c,t):c:t}l.forEach((t=>{!function(t,e,i){const o=e.proxy;if(t>=o.rowStart&&t<=o.rowEnd&&(aL(t,e),o.rowEnd--,o.currentRow--),!i){o.bodyBottomRow--;const t=Math.min(o.rowLimit,o.bodyBottomRow-o.bodyTopRow+1);o.totalActualBodyRowCount=t,o.totalRow=Math.min(o.table.rowCount-1,o.rowStart+t-1)}}(t,a,n)}));const u=o.rowHeightsMap;if(l.forEach((t=>{u.delete(t)})),l.length){!function(t){function e(e,i){e.row=i;const o=s_(t.table,e.col,e.row);o?(e.mergeStartCol=o.start.col,e.mergeEndCol=o.end.col,e.mergeStartRow=o.start.row,e.mergeEndRow=o.end.row):(e.mergeStartCol=void 0,e.mergeEndCol=void 0,e.mergeStartRow=void 0,e.mergeEndRow=void 0)}t.bodyGroup.forEachChildren((i=>{let o=t.bodyRowStart;null==i||i.forEachChildren((t=>{e(t,o),o++}))})),t.rowHeaderGroup.forEachChildren((i=>{let o=t.bodyRowStart;null==i||i.forEachChildren((t=>{e(t,o),o++}))})),t.rightFrozenGroup.forEachChildren((i=>{let o=t.bodyRowStart;null==i||i.forEachChildren((t=>{e(t,o),o++}))})),t.bottomFrozenGroup.forEachChildren((i=>{let o=t.table.rowCount-t.table.bottomFrozenRowCount;null==i||i.forEachChildren((t=>{e(t,o),o++}))})),t.leftBottomCornerGroup.forEachChildren((i=>{let o=t.table.rowCount-t.table.bottomFrozenRowCount;null==i||i.forEachChildren((t=>{e(t,o),o++}))})),t.rightBottomCornerGroup.forEachChildren((i=>{let o=t.table.rowCount-t.table.bottomFrozenRowCount;null==i||i.forEachChildren((t=>{e(t,o),o++}))}))}(a);const t=lL(l[l.length-1]-1,l[0]-l.length+1,a);c=ot(c)?ot(t)?Math.min(c,t):c:t}let g;if(a.table._clearRowRangeHeightsMap(),h.forEach((t=>{const e=function(t,e,i){const o=e.proxy;if(!i){o.bodyBottomRow++;const t=Math.min(o.rowLimit,o.bodyBottomRow-o.bodyTopRow+1);o.totalActualBodyRowCount=t,o.totalRow=o.rowStart+t-1}if(!(t<o.rowStart))return t>o.rowEnd?o.rowEnd-o.rowStart+1<o.rowLimit?(o.rowEnd++,o.currentRow++,sL(t,e),t):void 0:o.rowEnd-o.rowStart+1<o.rowLimit?(o.rowEnd++,o.currentRow++,sL(t,e),t):t}(t,a,n);g=null!=g?g:e,u.insert(t)})),function(t){function e(e,i,o){e.row=i,e.setAttribute("y",o);const n=s_(t.table,e.col,e.row);n?(e.mergeStartCol=n.start.col,e.mergeEndCol=n.end.col,e.mergeStartRow=n.start.row,e.mergeEndRow=n.end.row):(e.mergeStartCol=void 0,e.mergeEndCol=void 0,e.mergeStartRow=void 0,e.mergeEndRow=void 0)}t.bodyGroup.forEachChildren((i=>{let o=t.bodyRowStart,n=t.getCellGroupY(o);null==i||i.forEachChildren((t=>{e(t,o,n),o++,n+=t.attribute.height}))})),t.rowHeaderGroup.forEachChildren((i=>{let o=t.bodyRowStart,n=t.getCellGroupY(o);null==i||i.forEachChildren((t=>{e(t,o,n),o++,n+=t.attribute.height}))})),t.rightFrozenGroup.forEachChildren((i=>{let o=t.bodyRowStart,n=t.getCellGroupY(o);null==i||i.forEachChildren((t=>{e(t,o,n),o++,n+=t.attribute.height}))})),t.bottomFrozenGroup.forEachChildren((i=>{let o=t.table.rowCount-t.table.bottomFrozenRowCount,n=0;null==i||i.forEachChildren((t=>{e(t,o,n),o++,n+=t.attribute.height}))})),t.leftBottomCornerGroup.forEachChildren((i=>{let o=t.table.rowCount-t.table.bottomFrozenRowCount,n=0;null==i||i.forEachChildren((t=>{e(t,o,n),o++,n+=t.attribute.height}))})),t.rightBottomCornerGroup.forEachChildren((i=>{let o=t.table.rowCount-t.table.bottomFrozenRowCount,n=0;null==i||i.forEachChildren((t=>{e(t,o,n),o++,n+=t.attribute.height}))}))}(a),h.length){const t=lL(h[0]-1,h[h.length-1]+1,a);c=ot(c)?ot(t)?Math.min(c,t):c:t}for(let t=0;t<o.colCount;t++)d.forEach((e=>{if(e<o.frozenRowCount){const i=s_(a.table,t,e);if(i)for(let t=i.start.col;t<=i.end.col;t++)for(let e=i.start.row;e<=i.end.row;e++)nT(t,e,a.table,!1);else nT(t,e,a.table,!1)}else if(e>o.rowCount-1||e<a.table.rowCount-a.table.bottomFrozenRowCount&&(e<a.proxy.rowStart||e>a.proxy.rowEnd))aL(e,a);else{const i=s_(a.table,t,e);if(i)for(let t=i.start.col;t<=i.end.col;t++)for(let e=i.start.row;e<=i.end.row;e++)nT(t,e,a.table,!1);else nT(t,e,a.table,!1)}}));if(d.length){const t=lL(d[0]-1,d[d.length-1]+1,a);c=ot(c)?ot(t)?Math.min(c,t):c:t}if(ut(g)){for(let t=0;t<Math.max(o.colCount,null!==(r=o.internalProps._oldColCount)&&void 0!==r?r:o.colCount);t++)for(let e=g;e<Math.max(o.rowCount,null!==(s=o.internalProps._oldRowCount)&&void 0!==s?s:o.rowCount);e++){const i=a.highPerformanceGetCell(t,e,!0);i&&(i.needUpdate=!0)}c=ot(c)?ot(g)?Math.min(c,g):c:g}if(ut(c)&&(a.proxy.rowUpdatePos=Math.min(a.proxy.rowUpdatePos,c)),h.length){if(!ut(g)){const t=Math.min(...h);a.proxy.rowUpdatePos=Math.min(t,a.proxy.rowUpdatePos)}a.proxy.rowUpdateDirection="up",a.proxy.updateCellGroups(2*a.proxy.screenRowCount),f()}else l.length&&(function(t,e){if(e.table.isHasSeriesNumber())for(let i=t;i<=e.table.rowCount-1;i++)nT(0,i,e.table,!1)}(l[l.length-1],a),a.proxy.updateCellGroups(2*a.proxy.screenRowCount),f());a.proxy.progress();const p=o.getRowsHeight(o.frozenRowCount,o.rowCount-1-o.bottomFrozenRowCount);function f(){if((null==h?void 0:h[(null==h?void 0:h.length)-1])>=o.rowCount-o.bottomFrozenRowCount||(null==d?void 0:d[(null==d?void 0:d.length)-1])>=o.rowCount-o.bottomFrozenRowCount||(null==l?void 0:l[0])>=o.rowCount-o.bottomFrozenRowCount){for(let t=0;t<o.colCount;t++)for(let e=o.rowCount-o.bottomFrozenRowCount;e<o.rowCount;e++){const i=a.highPerformanceGetCell(t,e,!0);i&&(i.needUpdate=!0)}a.proxy.updateBottomFrozenCellGroups()}}a.updateContainerHeight(a.table.frozenRowCount,p-a.bodyGroup.attribute.height)}function sL(t,e){for(let i=0;i<e.table.colCount;i++){const o=new PR({x:0,y:0,width:e.table.getColWidth(i),height:e.table.getRowHeight(t)});if(o.role="cell",o.col=i,o.row=t,o.needUpdate=!0,!o)continue;const n=e.getColGroup(i);if(n)if(n.firstChild&&t<n.firstChild.row)n.insertBefore(o,n.firstChild),n.firstChild.row=n.firstChild.row+1;else if(n.lastChild&&t>n.lastChild.row)n.appendChild(o);else{const r=e.highPerformanceGetCell(i,t,!0);r!==o&&(n.insertBefore(o,r),r&&(r.row=r.row+1),r!==n.lastChild&&n.lastChild&&(n.lastChild.row=n.lastChild.row+1))}}}function aL(t,e){for(let i=0;i<e.table.colCount;i++){const o=e.getColGroup(i,!1);if(!o)continue;let n;o.forEachChildren((e=>e.row===t&&(n=e,!0))),n&&(o.updateColumnHeight(-n.attribute.height),o.removeChild(n))}}function lL(t,e,i){let o;for(let n=0;n<i.table.colCount;n++){const r=i.table.getCellRange(n,t);let s;r.start.row<=t+1&&r.end.row>=t+1&&(dL(r,i),s=r.start.row);const a=i.table.getCellRange(n,e);a.start.row<=e+1&&a.end.row>=e+1&&(dL(a,i),s=a.start.row),ot(s)&&(o=ot(o)?Math.min(o,s):s)}return o}function hL(t,e,i){let o;for(let n=0;n<i.table.colCount;n++){let r;const s=i.highPerformanceGetCell(n,t);s.mergeStartRow&&s.mergeEndRow&&s.mergeEndRow>t&&(dL({start:{row:s.mergeStartRow,col:i.table.isAutoRowHeight(e)?0:s.mergeStartCol},end:{row:s.mergeEndRow,col:i.table.isAutoRowHeight(e)?i.table.colCount-1:s.mergeEndCol}},i),r=s.mergeStartRow);const a=i.highPerformanceGetCell(n,e);a.mergeStartRow&&a.mergeEndRow&&a.mergeStartRow<e&&(dL({start:{row:a.mergeStartRow,col:i.table.isAutoRowHeight(e)?0:a.mergeStartCol},end:{row:a.mergeEndRow,col:i.table.isAutoRowHeight(e)?i.table.colCount-1:a.mergeEndCol}},i),r=a.mergeStartRow),ot(r)&&(o=ot(o)?Math.min(o,r):r)}return o}function dL(t,e){const{start:i,end:o}=t;for(let t=i.col;t<=o.col;t++)for(let n=i.row;n<=o.row;n++){const i=e.highPerformanceGetCell(t,n,!0);i&&(i.needUpdate=!0)}}function cL(t){if(!t.table.reactCustomLayout)return;const{table:e,stage:i}=t,o=i.pluginService.findPluginsByName("ReactAttributePlugin")[0],{htmlMap:n,renderId:r}=o;for(const s in n){const a=n[s],{graphic:l,wrapContainer:h,renderId:d}=a;if(d!==r)continue;let c;if(t.frozenColCount>e.frozenColCount){const i=UB(l);if(!i)continue;const{col:o,row:n}=i;n>=e.rowCount-e.bottomFrozenRowCount&&o<t.frozenColCount&&o>=e.frozenColCount&&l.attribute.react.container===e.frozenBottomDomContainer?c=e.bottomDomContainer:n>=e.frozenRowCount&&o<t.frozenColCount&&o>=e.frozenColCount&&l.attribute.react.container===e.frozenBodyDomContainer?c=e.bodyDomContainer:n<e.frozenRowCount&&o<t.frozenColCount&&o>=e.frozenColCount&&l.attribute.react.container===e.frozenHeaderDomContainer&&(c=e.headerDomContainer)}else if(t.frozenColCount<e.frozenColCount){const i=UB(l);if(!i)continue;const{col:o,row:n}=i;n>=e.rowCount-e.bottomFrozenRowCount&&o<e.frozenColCount&&o>=t.frozenColCount&&l.attribute.react.container===e.bottomDomContainer?c=e.frozenBottomDomContainer:n>=e.frozenRowCount&&o<e.frozenColCount&&o>=t.frozenColCount&&l.attribute.react.container===e.bodyDomContainer?c=e.frozenBodyDomContainer:n<e.frozenRowCount&&o<e.frozenColCount&&o>=t.frozenColCount&&l.attribute.react.container===e.headerDomContainer&&(c=e.frozenHeaderDomContainer)}c&&(c.appendChild(h),a.nativeContainer=c,a.container=c,l.attribute.react.container=c,o.updateStyleOfWrapContainer(l,i,h,c,l.attribute.react))}}function uL(t){const e=t.bodyGroup.firstChild instanceof PR?t.bodyGroup.firstChild:null;e&&(t.rowHeaderGroup.appendChild(e),t.rowHeaderGroup.setAttribute("width",t.rowHeaderGroup.attribute.width+e.attribute.width),t.bodyGroup.setAttribute("width",t.bodyGroup.attribute.width-e.attribute.width))}function gL(t){const e=t.colHeaderGroup.firstChild instanceof PR?t.colHeaderGroup.firstChild:null;e&&(t.cornerHeaderGroup.appendChild(e),t.cornerHeaderGroup.setAttribute("width",t.cornerHeaderGroup.attribute.width+e.attribute.width),t.colHeaderGroup.setAttribute("width",t.colHeaderGroup.attribute.width-e.attribute.width))}function pL(t){var e;const i=t.rowHeaderGroup.lastChild instanceof PR?t.rowHeaderGroup.lastChild:null===(e=t.rowHeaderGroup.lastChild)||void 0===e?void 0:e._prev;i&&(mL(t.bodyGroup,i,t.bodyGroup.firstChild),t.bodyGroup.setAttribute("width",t.bodyGroup.attribute.width+i.attribute.width),t.rowHeaderGroup.setAttribute("width",t.rowHeaderGroup.attribute.width-i.attribute.width))}function fL(t){var e;const i=t.cornerHeaderGroup.lastChild instanceof PR?t.cornerHeaderGroup.lastChild:null===(e=t.cornerHeaderGroup.lastChild)||void 0===e?void 0:e._prev;i&&(mL(t.colHeaderGroup,i,t.colHeaderGroup.firstChild),t.colHeaderGroup.setAttribute("width",t.colHeaderGroup.attribute.width+i.attribute.width),t.cornerHeaderGroup.setAttribute("width",t.cornerHeaderGroup.attribute.width-i.attribute.width))}function vL(t){const e=t.bottomFrozenGroup.firstChild instanceof PR?t.bottomFrozenGroup.firstChild:null;e&&(t.leftBottomCornerGroup.appendChild(e),t.leftBottomCornerGroup.setAttribute("width",t.leftBottomCornerGroup.attribute.width+e.attribute.width),t.bottomFrozenGroup.setAttribute("width",t.bottomFrozenGroup.attribute.width-e.attribute.width),t.table.isPivotChart()&&e.forEachChildren((t=>{t.setAttributes({stroke:!1,fill:!1})})))}function bL(t){var e;const i=t.leftBottomCornerGroup.lastChild instanceof PR?t.leftBottomCornerGroup.lastChild:null===(e=t.leftBottomCornerGroup.lastChild)||void 0===e?void 0:e._prev;i&&(mL(t.bottomFrozenGroup,i,t.bottomFrozenGroup.firstChild),t.bottomFrozenGroup.setAttribute("width",t.bottomFrozenGroup.attribute.width+i.attribute.width),t.leftBottomCornerGroup.setAttribute("width",t.leftBottomCornerGroup.attribute.width-i.attribute.width),t.table.isPivotChart()&&i.forEachChildren((e=>{var i,o,n,r;const s=t.table._getCellStyle(e.col,e.row),a=t.table.getCellRange(e.col,e.row),l=IB(s,t.table,a?a.start.col:e.col,a?a.start.row:e.row,FR).theme;e.setAttributes({fill:null!==(o=null===(i=null==l?void 0:l.group)||void 0===i?void 0:i.fill)&&void 0!==o?o:void 0,stroke:null!==(r=null===(n=null==l?void 0:l.group)||void 0===n?void 0:n.stroke)&&void 0!==r?r:void 0})})))}function mL(t,e,i){e&&t&&(i?t.insertBefore(e,i):t.appendChild(e))}function yL(t){var e;let i=!1;for(let o=0;o<t.bodyGroup.childrenCount;o++){const n=t.bodyGroup.children[o].firstChild;null===(e=t.colHeaderGroup.children[o])||void 0===e||e.appendChild(n),i||(t.colHeaderGroup.setAttribute("height",t.colHeaderGroup.attribute.height+n.attribute.height),t.bodyGroup.setAttribute("height",t.bodyGroup.attribute.height-n.attribute.height),i=!0)}}function CL(t){var e;let i=!1;for(let o=0;o<t.rowHeaderGroup.childrenCount;o++){const n=t.rowHeaderGroup.children[o].firstChild;null===(e=t.cornerHeaderGroup.children[o])||void 0===e||e.appendChild(n),i||(t.cornerHeaderGroup.setAttribute("height",t.cornerHeaderGroup.attribute.height+n.attribute.height),t.rowHeaderGroup.setAttribute("height",t.rowHeaderGroup.attribute.height-n.attribute.height),i=!0)}}function wL(t){var e;let i=!1;for(let o=0;o<t.rightFrozenGroup.childrenCount;o++){const n=t.rightFrozenGroup.children[o].firstChild;null===(e=t.rightTopCornerGroup.children[o])||void 0===e||e.appendChild(n),i||(t.rightTopCornerGroup.setAttribute("height",t.rightTopCornerGroup.attribute.height+n.attribute.height),t.rightFrozenGroup.setAttribute("height",t.rightFrozenGroup.attribute.height-n.attribute.height),i=!0)}}function xL(t){let e=!1;for(let i=0;i<t.colHeaderGroup.childrenCount;i++){const o=t.colHeaderGroup.children[i].lastChild;mL(t.bodyGroup.children[i],o,t.bodyGroup.children[i].firstChild),e||(t.colHeaderGroup.setAttribute("height",t.colHeaderGroup.attribute.height-o.attribute.height),t.bodyGroup.setAttribute("height",t.bodyGroup.attribute.height+o.attribute.height),e=!0)}}function _L(t){let e=!1;for(let i=0;i<t.cornerHeaderGroup.childrenCount;i++){const o=t.cornerHeaderGroup.children[i].lastChild;mL(t.rowHeaderGroup.children[i],o,t.rowHeaderGroup.children[i].firstChild),e||(t.cornerHeaderGroup.setAttribute("height",t.cornerHeaderGroup.attribute.height-o.attribute.height),t.rowHeaderGroup.setAttribute("height",t.rowHeaderGroup.attribute.height+o.attribute.height),e=!0)}}function SL(t){let e=!1;for(let i=0;i<t.rightTopCornerGroup.childrenCount;i++){const o=t.rightTopCornerGroup.children[i].lastChild;mL(t.rightFrozenGroup.children[i],o,t.rightFrozenGroup.children[i].firstChild),e||(t.rightTopCornerGroup.setAttribute("height",t.rightTopCornerGroup.attribute.height-o.attribute.height),t.rightFrozenGroup.setAttribute("height",t.rightFrozenGroup.attribute.height+o.attribute.height),e=!0)}}function AL(t){var e;for(let i=t.proxy.colStart;i<=t.proxy.colEnd;i++){const o=t.getColGroup(i);null===(e=null==o?void 0:o.getChildren())||void 0===e||e.forEach((t=>{t.children.forEach((t=>{"chart"===t.type&&(t.cacheCanvas=null,t.addUpdateBoundTag())}))}))}}function BL(t,e,i){t.forEachChildren((t=>{"chart"===t.type&&(t.cacheCanvas=null,t.setAttributes({width:Math.ceil(e-t.attribute.cellPadding[3]-t.attribute.cellPadding[1]),height:Math.ceil(i-t.attribute.cellPadding[0]-t.attribute.cellPadding[2])}))}))}function RL(t,e,i){return new PR({x:0,y:0,width:t,height:e,clip:null!=i&&i,pickable:!1})}function TL(t,e){return t.forEachChildrenSkipChild(((t,i)=>{t.setAttribute("x",e),e+=t.attribute.width})),e}function kL(t,e,i,o,n){const r=t.name;PL(i,o,(t=>t.name===r),(t=>{NR(e,t),t.name=e.name}),n),n.updateNextFrame()}function ML(t){const{col:e,row:i,iconMark:o,order:n,oldSortCol:r,oldSortRow:s,oldIconMark:a,scene:l}=t,h=l.table.internalProps.headerHelper.getSortIcon(n,l.table,e,i);if(o&&kL(o,h,e,i,l),!function(t,e,i,o,n){const r=n.getCellRange(t,e),s=n.getCellRange(i,o);return r.start.col===s.start.col&&r.start.row===s.start.row&&r.end.col===s.end.col&&r.end.row===s.end.row}(e,i,r,s,l.table)){const t=l.table.internalProps.headerHelper.getSortIcon("normal",l.table,r,s);a?kL(a,t,r,s,l):function(t,e,i,o){const n=o.getCell(t,e);if(ot(n.mergeStartCol)&&ot(n.mergeStartRow)&&ot(n.mergeEndCol)&&ot(n.mergeEndRow))for(let t=n.mergeStartCol;t<=n.mergeEndCol;t++)for(let e=n.mergeStartRow;e<=n.mergeEndRow;e++){let n;o.getCell(t,e).forEachChildren((t=>"sort"===t.attribute.funcType&&(n=t,!0))),n&&(NR(i,n),n.name=i.name)}else{let t;Qw(n,"children",(e=>"sort"===e.attribute.funcType&&(t=e,!0))),t&&(NR(i,t),t.name=i.name)}}(r,s,t,l)}}function LL(t,e,i){t&&"empty"!==t.role&&t.forEachChildren((t=>{"group"===t.type?LL(t,e,i):e(t)&&i(t)}))}function PL(t,e,i,o,n){const r=n.getCell(t,e);if("cell"===r.role&&ot(r.mergeStartCol)&&ot(r.mergeStartRow)&&ot(r.mergeEndCol)&&ot(r.mergeEndRow)){const{colStart:t,colEnd:e,rowStart:s,rowEnd:a}=LT(r,n);for(let r=t;r<=e;r++)for(let t=s;t<=a;t++)LL(n.highPerformanceGetCell(r,t),i,o)}else LL(r,i,o)}function EL(t,e){const{bgColor:i,borderColor:o,borderLineWidth:n,borderLineDash:r}=e,s={x:0,y:0,width:0,height:0,visible:!1,pickable:!0,fill:i};return s.stroke=sk(o,void 0),s.lineWidth=n,r&&(s.lineDash=r),s.lineCap="butt",Array.isArray(o)&&(s.strokeArrayColor=tB(o)),Array.isArray(n)&&(s.strokeArrayWidth=tB(n),s.lineWidth=1),t.setAttributes(s),t.role="corner-frozen",t}function HL(t,e,i,o){var n,r;const s=o.scenegraph,a=FL(t.map((t=>t.col))).sort(((t,e)=>e-t)),l=FL(e.map((t=>t.col))).sort(((t,e)=>t-e)),h=FL(i.map((t=>t.col))).sort(((t,e)=>t-e));a.forEach((t=>{!function(t,e){const i=e.proxy;if(t>=e.table.rowHeaderLevelCount)if(t>=e.table.colCount-e.table.rightFrozenColCount);else{const i=e.getColGroup(t,!1);i&&i.parent===e.bodyGroup&&e.bodyGroup.removeChild(i);const o=e.getColGroupInBottom(t);o&&o.parent===e.bottomFrozenGroup&&e.bottomFrozenGroup.removeChild(o);const n=e.getColGroup(t,!0);n&&n.parent===e.colHeaderGroup&&e.colHeaderGroup.removeChild(n)}t>=i.colStart&&t<=i.colEnd&&(i.colEnd--,i.currentCol--),i.bodyRightCol--;const o=Math.min(i.colLimit,i.bodyRightCol-i.bodyLeftCol+1);i.totalActualBodyColCount=o,i.totalCol=i.colStart+o-1}(t,s)}));const d=o.colWidthsMap;let c;if(a.forEach((t=>{d.delAndReorder(t)})),a.length&&OL(s),s.table._clearColRangeWidthsMap(),l.forEach((t=>{const e=function(t,e){const i=e.proxy;i.bodyRightCol++;const o=Math.min(i.colLimit,i.bodyRightCol-i.bodyLeftCol+1);if(i.totalActualBodyColCount=o,i.totalCol=i.colStart+o-1,!(t<i.colStart))return t>i.colEnd?i.colEnd-i.colStart+1<i.colLimit?(i.colEnd++,i.currentCol++,IL(t,e),t):void 0:i.colEnd-i.colStart+1<i.colLimit?(i.colEnd++,i.currentCol++,IL(t,e),t):t}(t,s);OL(s),c=null!=c?c:e,d.addAndReorder(t)})),function(t){let e=t.bodyColStart,i=t.getCellGroupX(e);function o(i){i.col=e;const o=s_(t.table,i.col,i.row);o&&(i.mergeStartCol=o.start.col,i.mergeStartCol=o.start.col,i.mergeEndCol=o.end.col,i.mergeEndCol=o.end.col),i.role}t.bodyGroup.forEachChildren((t=>{t.col=e,null==t||t.forEachChildren((t=>{o(t)})),t.setAttribute("x",i),i+=t.attribute.width,e++})),e=t.bodyColStart,i=t.getCellGroupX(e),t.colHeaderGroup.forEachChildren((t=>{t.col=e,null==t||t.forEachChildren((t=>{o(t)})),t.setAttribute("x",i),i+=t.attribute.width,e++})),e=t.bodyColStart,i=t.getCellGroupX(e),t.bottomFrozenGroup.forEachChildren((t=>{t.col=e,null==t||t.forEachChildren((t=>{o(t)})),t.setAttribute("x",i),i+=t.attribute.width,e++})),e=t.table.colCount-t.table.rightFrozenColCount,i=0,t.rightFrozenGroup.forEachChildren((t=>{t.col=e,null==t||t.forEachChildren((t=>{o(t)})),t.setAttribute("x",i),i+=t.attribute.width,e++})),e=t.table.colCount-t.table.rightFrozenColCount,i=0,t.rightTopCornerGroup.forEachChildren((t=>{t.col=e,null==t||t.forEachChildren((t=>{o(t)})),t.setAttribute("x",i),i+=t.attribute.width,e++})),e=t.table.colCount-t.table.rightFrozenColCount,i=0,t.rightBottomCornerGroup.forEachChildren((t=>{t.col=e,null==t||t.forEachChildren((t=>{o(t)})),t.setAttribute("x",i),i+=t.attribute.width,e++}))}(s),h.forEach((t=>{for(let e=0;e<o.rowCount;e++){const i=s_(s.table,t,e);if(i)for(let t=i.start.col;t<=i.end.col;t++)for(let t=i.start.col;t<=i.end.col;t++)nT(t,e,s.table,!1);else nT(t,e,s.table,!1)}})),ut(c)){for(let t=c;t<Math.max(o.colCount,null!==(n=o.internalProps._oldColCount)&&void 0!==n?n:o.colCount);t++)for(let e=0;e<Math.max(o.rowCount,null!==(r=o.internalProps._oldRowCount)&&void 0!==r?r:o.rowCount);e++){const i=s.highPerformanceGetCell(t,e,!0);i&&(i.needUpdate=!0)}s.proxy.colUpdatePos=c}if(l.length){if(!ut(c)){const t=Math.min(...l);s.proxy.colUpdatePos=t}s.proxy.colUpdateDirection="left",s.proxy.updateColGroups(2*s.proxy.screenColCount),g(),s.proxy.progress()}else a.length&&(s.proxy.updateColGroups(2*s.proxy.screenColCount),g(),s.proxy.progress());const u=o.getColsWidth(o.frozenColCount,o.colCount-1);function g(){if((null==l?void 0:l[(null==l?void 0:l.length)-1])>=o.colCount-o.rightFrozenColCount||(null==h?void 0:h[(null==h?void 0:h.length)-1])>=o.colCount-o.rightFrozenColCount||(null==a?void 0:a[0])>=o.colCount-o.rightFrozenColCount){for(let t=o.colCount-o.rightFrozenColCount;t<o.colCount;t++)for(let e=0;e<o.rowCount;e++){const i=s.highPerformanceGetCell(t,e,!0);i&&(i.needUpdate=!0)}s.proxy.updateRightFrozenCellGroups()}}s.updateContainerWidth(s.table.frozenColCount,u-s.bodyGroup.attribute.width)}function FL(t){const e=[];for(let i=0;i<t.length;i++)-1===e.indexOf(t[i])&&e.push(t[i]);return e}function OL(t){let e=t.bodyColStart;function i(i){i.col=e;const o=s_(t.table,i.col,i.row);o&&(i.mergeStartCol=o.start.col,i.mergeStartCol=o.start.col,i.mergeEndCol=o.end.col,i.mergeEndCol=o.end.col),i.role}t.bodyGroup.forEachChildren((t=>{t.col=e,null==t||t.forEachChildren((t=>{i(t)})),e++})),e=t.bodyColStart,t.colHeaderGroup.forEachChildren((t=>{t.col=e,null==t||t.forEachChildren((t=>{i(t)})),e++})),e=t.bodyColStart,t.bottomFrozenGroup.forEachChildren((t=>{t.col=e,null==t||t.forEachChildren((t=>{i(t)})),e++}))}function IL(t,e){if(e.colHeaderGroup&&e.table.columnHeaderLevelCount>0){const o=new PR({x:0,y:0,width:e.table.getColWidth(t),height:0,clip:!1,pickable:!1});o.role="column",o.col=t;const n=e.getColGroup(t,!0);n?e.colHeaderGroup.insertBefore(o,n):e.colHeaderGroup.appendChild(o),i(o,t,0,e.table.columnHeaderLevelCount-1)}if(e.bodyGroup){const o=new PR({x:0,y:0,width:e.table.getColWidth(t),height:0,clip:!1,pickable:!1});o.role="column",o.col=t;const n=e.getColGroup(t,!1);n?e.bodyGroup.insertBefore(o,n):e.bodyGroup.appendChild(o),i(o,t,e.bodyRowStart,e.bodyRowEnd)}if(e.bottomFrozenGroup&&e.table.bottomFrozenRowCount>0){const o=new PR({x:0,y:0,width:e.table.getColWidth(t),height:0,clip:!1,pickable:!1});o.role="column",o.col=t;const n=e.getColGroupInBottom(t);n?e.bottomFrozenGroup.insertBefore(o,n):e.bottomFrozenGroup.appendChild(o),i(o,t,e.table.rowCount-e.table.bottomFrozenRowCount,e.table.rowCount-1)}function i(t,i,o,n){for(let r=o;r<=n;r++){const o=new PR({x:0,y:0,width:e.table.getColWidth(i),height:e.table.getRowHeight(r)});o.role="cell",o.col=i,o.row=r,o.needUpdate=!0,t.appendChild(o)}}}qy(),sn.load(nM),sn.load(vT);class zL{constructor(t){let e,i;var o;this._needUpdateContainer=!1,this.table=t,this.hasFrozen=!1,this.clear=!0,this.mergeMap=new Map,o=this.table.theme.textPopTipStyle,Tt(em.poptip,tm,o),"node"===zw.mode?(fu.setEnv("node",t.options.modeParams),e=t.canvasWidth,i=t.canvasHeight):t.options.canvas&&t.options.viewBox?(fu.setEnv("browser"),e=t.options.viewBox.x2-t.options.viewBox.x1,i=t.options.viewBox.y2-t.options.viewBox.y1):(fu.setEnv("browser"),e=t.canvas.width,i=t.canvas.height),this.stage=Pu(Object.assign({canvas:t.canvas,width:e,height:i,disableDirtyBounds:!1,background:t.theme.underlayBackgroundColor,dpr:t.internalProps.pixelRatio,enableLayout:!0,beforeRender:t=>{this.table.options.beforeRender&&this.table.options.beforeRender(t),this.table.animationManager.ticker.start()},afterRender:t=>{this.table.options.afterRender&&this.table.options.afterRender(t),this.table.fireListeners("after_render",null)},canvasControled:!t.options.canvas,viewBox:t.options.viewBox},t.options.renderOption)),this.stage.defaultLayer.setTheme({group:{boundsPadding:0,strokeBoundsBuffer:0,lineJoin:"round"},text:{ignoreBuf:!0}}),this.initSceneGraph(),this.stage.defaultLayer.add(this.tableGroup),this.stage.table=this.table,this.createComponent()}get width(){var t,e;return null!==(e=null===(t=this.tableGroup.attribute)||void 0===t?void 0:t.width)&&void 0!==e?e:0}get height(){var t,e;return null!==(e=null===(t=this.tableGroup.attribute)||void 0===t?void 0:t.height)&&void 0!==e?e:0}get x(){var t,e;return null!==(e=null===(t=this.tableGroup.attribute)||void 0===t?void 0:t.x)&&void 0!==e?e:0}get y(){var t,e;return null!==(e=null===(t=this.tableGroup.attribute)||void 0===t?void 0:t.y)&&void 0!==e?e:0}get bodyRowStart(){var t;return null!==(t=this.proxy.rowStart)&&void 0!==t?t:0}get bodyRowEnd(){var t;return null!==(t=this.proxy.rowEnd)&&void 0!==t?t:this.table.rowCount-1}get bodyColStart(){var t;return null!==(t=this.proxy.colStart)&&void 0!==t?t:0}get bodyColEnd(){var t;return null!==(t=this.proxy.colEnd)&&void 0!==t?t:this.table.colCount-1}initSceneGraph(){this.isPivot=this.table.isPivotTable(),function(t){const e=t.table.tableNoFrameWidth,i=t.table.tableNoFrameHeight;t.tableGroup=new PR({x:0,y:0,width:e,height:i,clip:!0,pickable:!1}),t.tableGroup.role="table";const o=RL(0,0,!t.table.options.enableTreeStickCell);o.role="col-header",t.colHeaderGroup=o;const n=RL(0,0,!t.table.options.enableTreeStickCell);n.role="corner-header",t.cornerHeaderGroup=n;const r=RL(0,0,!0);r.role="row-header",t.rowHeaderGroup=r;const s=RL(e,0,!0);s.role="body",t.bodyGroup=s;const a=RL(0,0,!0);a.role="right-frozen",t.rightFrozenGroup=a;const l=RL(0,0,!0);l.role="bottom-frozen",t.bottomFrozenGroup=l;const h=RL(0,0);h.role="component",t.componentGroup=h;const d=RL(0,0,!0);d.role="corner-right-top-header",t.rightTopCornerGroup=d;const c=RL(0,0,!0);c.role="corner-right-bottom-header",t.rightBottomCornerGroup=c;const u=RL(0,0,!0);u.role="corner-left-bottom-header",t.leftBottomCornerGroup=u,t.tableGroup.addChild(s),t.tableGroup.addChild(r),t.tableGroup.addChild(l),t.tableGroup.addChild(o),t.tableGroup.addChild(a),t.tableGroup.addChild(c),t.tableGroup.addChild(d),t.tableGroup.addChild(u),t.tableGroup.addChild(n),t.tableGroup.addChild(h)}(this)}clearCells(){var t,e;this.table.animationManager.clear(),(this.table.isPivotChart()||this.table._hasCustomRenderOrLayout())&&this.stage.pluginService.findPluginsByName("poptipForText").forEach((t=>{t.deactivate(this.stage.pluginService)})),this.clear=!0,this.hasFrozen=!1,this.mergeMap.clear(),this.colHeaderGroup.clear(),delete this.colHeaderGroup.border,this.rowHeaderGroup.clear(),delete this.rowHeaderGroup.border,this.cornerHeaderGroup.clear(),delete this.cornerHeaderGroup.border,this.bodyGroup.clear(),delete this.bodyGroup.border,this.bottomFrozenGroup.clear(),delete this.bottomFrozenGroup.border,this.rightFrozenGroup.clear(),delete this.rightFrozenGroup.border,this.rightTopCornerGroup.clear(),delete this.rightTopCornerGroup.border,this.rightBottomCornerGroup.clear(),delete this.rightBottomCornerGroup.border,this.leftBottomCornerGroup.clear(),delete this.leftBottomCornerGroup.border,this.colHeaderGroup.setAttributes({x:0,y:0,width:0,height:0}),this.rowHeaderGroup.setAttributes({x:0,y:0,width:0,height:0}),this.cornerHeaderGroup.setAttributes({x:0,y:0,width:0,height:0}),this.bodyGroup.setAttributes({x:0,y:0,width:0,height:0}),this.rightFrozenGroup.setAttributes({x:0,y:0,width:0,height:0}),this.bottomFrozenGroup.setAttributes({x:0,y:0,width:0,height:0}),this.rightTopCornerGroup.setAttributes({x:0,y:0,width:0,height:0,visible:!1}),this.leftBottomCornerGroup.setAttributes({x:0,y:0,width:0,height:0,visible:!1}),this.rightBottomCornerGroup.setAttributes({x:0,y:0,width:0,height:0,visible:!1}),this.tableGroup.setAttributes({x:this.table.tableX,y:this.table.tableY,width:0,height:0}),this.tableGroup.border&&(this.tableGroup.parent.removeChild(this.tableGroup.border),delete this.tableGroup.border),null===(t=this.proxy)||void 0===t||t.release(),null===(e=this.table.reactCustomLayout)||void 0===e||e.clearCache()}updateStageBackground(){this.stage.background=this.table.theme.underlayBackgroundColor,this.stage.renderNextFrame()}createComponent(){this.component=new ok(this.table),this.component.addToGroup(this.componentGroup),this.selectedRangeComponents=new Map,this.selectingRangeComponents=new Map,this.customSelectedRangeComponents=new Map}updateComponent(){this.component.updateStyle()}createSceneGraph(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(this.table.rowHeightsMap.clear(),this.table.internalProps.layoutMap.clearCellRangeMap()),(this.table.isPivotChart()||this.table._hasCustomRenderOrLayout())&&this.stage.pluginService.autoEnablePlugins.getContributions().forEach((t=>{"poptipForText"===t.name&&this.stage.pluginService.register(t)})),this.clear=!1,this.frozenColCount=this.table.frozenColCount,this.frozenRowCount=this.table.frozenRowCount,this.proxy=new YM(this.table),nk(this.tableGroup,this.table.theme.frameStyle,this.tableGroup.role,void 0,!0),this.table.isPivotChart()&&(EL(this.rightTopCornerGroup,this.table.theme.cornerRightTopCellStyle||this.table.theme.cornerHeaderStyle||{}),EL(this.leftBottomCornerGroup,this.table.theme.cornerLeftBottomCellStyle||this.table.theme.cornerHeaderStyle||{}),EL(this.rightBottomCornerGroup,this.table.theme.cornerRightBottomCellStyle||this.table.theme.cornerHeaderStyle||{})),this.proxy.createGroupForFirstScreen(this.cornerHeaderGroup,this.colHeaderGroup,this.rowHeaderGroup,this.rightFrozenGroup,this.bottomFrozenGroup,this.bodyGroup,0,0),this.afterScenegraphCreated()}renderSceneGraph(){this.stage.render()}getCell(t,e,i){var o,n,r,s,a,l;let h;if(h=this.table.rightFrozenColCount>0&&t>=this.table.colCount-this.table.rightFrozenColCount&&e<this.table.frozenRowCount?null===(o=this.rightTopCornerGroup.getColGroup(t))||void 0===o?void 0:o.getRowGroup(e):this.table.bottomFrozenRowCount>0&&e>=this.table.rowCount-this.table.bottomFrozenRowCount&&t<this.table.frozenColCount?null===(n=this.leftBottomCornerGroup.getColGroup(t))||void 0===n?void 0:n.getRowGroup(e):this.table.rightFrozenColCount>0&&this.table.bottomFrozenRowCount>0&&t>=this.table.colCount-this.table.rightFrozenColCount&&e>=this.table.rowCount-this.table.bottomFrozenRowCount?null===(r=this.rightBottomCornerGroup.getColGroup(t))||void 0===r?void 0:r.getRowGroup(e):this.table.rightFrozenColCount>0&&t>this.table.colCount-1-this.table.rightFrozenColCount?null===(s=this.rightFrozenGroup.getColGroup(t))||void 0===s?void 0:s.getRowGroup(e):this.table.bottomFrozenRowCount>0&&e>this.table.rowCount-1-this.table.bottomFrozenRowCount?null===(a=this.bottomFrozenGroup.getColGroup(t))||void 0===a?void 0:a.getRowGroup(e):null===(l=this.getColGroup(t,e<this.frozenRowCount))||void 0===l?void 0:l.getRowGroup(e),h&&"shadow-cell"===h.role&&!i){const i=this.table.getCellRange(t,e);i.start.col===t&&i.start.row===e||(h=this.getCell(i.start.col,i.start.row))}return h||uM}highPerformanceGetCell(t,e,i){return this.proxy.highPerformanceGetCell(t,e,i)}getColGroup(t){let e,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e=t<this.frozenColCount&&i?this.cornerHeaderGroup.getColGroup(t):t<this.frozenColCount?this.rowHeaderGroup.getColGroup(t):i&&this.table.rightFrozenColCount>0&&t>this.table.colCount-1-this.table.rightFrozenColCount?this.rightTopCornerGroup.getColGroup(t):!i&&this.table.rightFrozenColCount>0&&t>this.table.colCount-1-this.table.rightFrozenColCount?this.rightFrozenGroup.getColGroup(t):i?this.colHeaderGroup.getColGroup(t):this.bodyGroup.getColGroup(t),e||void 0}getColGroupInBottom(t){var e;if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]){const i=null!==(e=this.getColGroupInLeftBottomCorner(t))&&void 0!==e?e:this.getColGroupInRightBottomCorner(t);if(i)return i}if(this.table.bottomFrozenRowCount>0)return this.bottomFrozenGroup.getColGroup(t)}getColGroupInLeftBottomCorner(t){if(this.table.bottomFrozenRowCount>0)return this.leftBottomCornerGroup.getColGroup(t)}getColGroupInRightTopCorner(t){if(this.table.rightFrozenColCount>0)return this.rightTopCornerGroup.getColGroup(t)}getColGroupInRightBottomCorner(t){if(this.table.rightFrozenColCount>0&&this.table.bottomFrozenRowCount>0)return this.rightBottomCornerGroup.getColGroup(t)}getCellSize(t,e){const i=this.getCell(t,e),o=s_(this.table,t,e);let n=i.attribute.width,r=i.attribute.height;return o&&(n/=o.end.col-o.start.col+1,r/=o.end.row-o.start.row+1),{width:n,height:r}}updateNextFrame(){this.updateContainerSync(),this.resetAllSelectComponent(),this.stage.renderNextFrame()}resetAllSelectComponent(){var t,e,i,o;((null===(e=null===(t=this.table.stateManager.select)||void 0===t?void 0:t.ranges)||void 0===e?void 0:e.length)>0||(null===(o=null===(i=this.table.stateManager.select)||void 0===i?void 0:i.customSelectRanges)||void 0===o?void 0:o.length)>0)&&qM(this)}hideHoverIcon(t,e){!function(t,e,i){-1!==t&&-1!==e&&(PL(t,e,(t=>"mouseenter_cell"===t.attribute.visibleTime),(t=>{t.setAttribute("opacity",0);const e=t.parent.getChildByName("icon-back");e&&e.setAttribute("visible",!1)}),i),i.updateNextFrame())}(t,e,this)}showHoverIcon(t,e){!function(t,e,i){-1!==t&&-1!==e&&(PL(t,e,(t=>"mouseenter_cell"===t.attribute.visibleTime),(t=>{t.setAttribute("opacity",1)}),i),i.updateNextFrame())}(t,e,this)}hideClickIcon(t,e){!function(t,e,i){-1!==t&&-1!==e&&(PL(t,e,(t=>"click_cell"===t.attribute.visibleTime),(t=>{t.setAttribute("opacity",0)}),i),i.updateNextFrame())}(t,e,this)}showClickIcon(t,e){!function(t,e,i){-1!==t&&-1!==e&&(PL(t,e,(t=>"click_cell"===t.attribute.visibleTime),(t=>{t.setAttribute("opacity",1)}),i),i.updateNextFrame())}(t,e,this)}getIcon(t,e,i,o){return function(t,e,i,o,n){let r;return n.getCell(t,e).forEachChildren((t=>{t.role&&t.role.startsWith("icon")&&t.containsPoint(i,o,Ci.GLOBAL)&&(r=t)})),r}(t,e,i,o,this)}setIconHoverStyle(t,e,i,o){!function(t,e,i,o,n){var r,s;if((t.attribute.backgroundColor||t.attribute.hoverImage)&&PL(e,i,(e=>e.name===t.name),(t=>{var e,i,o,n,r,s,a,l;if(t.attribute.backgroundColor){let h=t.parent.getChildByName("icon-back");h?h.setAttributes({x:(null!==(e=t.attribute.x)&&void 0!==e?e:0)+(t.AABBBounds.width()-t.backgroundWidth)/2,y:(null!==(i=t.attribute.y)&&void 0!==i?i:0)+(t.AABBBounds.height()-t.backgroundHeight)/2,dx:null!==(o=t.attribute.dx)&&void 0!==o?o:0,dy:null!==(n=t.attribute.dy)&&void 0!==n?n:0,width:t.backgroundWidth,height:t.backgroundHeight,fill:t.attribute.backgroundColor,cornerRadius:5,visible:!0}):(h=oc({x:(null!==(r=t.attribute.x)&&void 0!==r?r:0)+(t.AABBBounds.width()-t.backgroundWidth)/2,y:(null!==(s=t.attribute.y)&&void 0!==s?s:0)+(t.AABBBounds.height()-t.backgroundHeight)/2,dx:null!==(a=t.attribute.dx)&&void 0!==a?a:0,dy:null!==(l=t.attribute.dy)&&void 0!==l?l:0,width:t.backgroundWidth,height:t.backgroundHeight,fill:t.attribute.backgroundColor,cornerRadius:5,pickable:!1,visible:!0}),h.name="icon-back"),t.parent.insertBefore(h,t)}t.attribute.hoverImage&&t.attribute.image!==t.attribute.hoverImage&&(t.image=t.attribute.hoverImage)}),n),t.tooltip){const{x1:o,x2:a,y1:l,y2:h}=t.globalAABBBounds,d={content:t.tooltip.title,referencePosition:{rect:{left:o,right:a,top:l,bottom:h,width:t.globalAABBBounds.width(),height:t.globalAABBBounds.height()},placement:t.tooltip.placement},disappearDelay:t.tooltip.disappearDelay,style:Object.assign({},null===(r=n.table.internalProps.theme)||void 0===r?void 0:r.tooltipStyle,null===(s=t.tooltip)||void 0===s?void 0:s.style)};n.table.internalProps.tooltipHandler.isBinded(d)||n.table.showTooltip(e,i,d)}}(t,e,i,0,this)}updateSortIcon(t){const{col:e,row:i,iconMark:o,order:n,oldSortCol:r,oldSortRow:s,oldIconMark:a}=t;ML({col:e,row:i,iconMark:o,order:n,oldSortCol:r,oldSortRow:s,oldIconMark:a,scene:this})}updateFrozenIcon(t,e){!function(t){for(let e=0;e<t.table.colCount;e++)for(let i=0;i<t.table.columnHeaderLevelCount;i++)PL(e,i,(t=>"frozen"===t.attribute.funcType),(o=>{const n=t.table.internalProps.headerHelper.getFrozenIcon(e,i);NR(n,o),o.name=n.name}),t)}(this)}updateHierarchyIcon(t,e){!function(t,e,i){let o;o=i.table.isHeader(t,e)?i.table.internalProps.headerHelper.getHierarchyIcon(t,e):i.table.internalProps.bodyHelper.getHierarchyIcon(t,e),PL(t,e,(t=>t.attribute.funcType===sw.collapse||t.attribute.funcType===sw.expand),(t=>{NR(o,t),t.name=o.name}),i)}(t,e,this)}setIconNormalStyle(t,e,i){!function(t,e,i,o){(t.attribute.backgroundColor||t.attribute.hoverImage)&&PL(e,i,(e=>e.name===t.name),(t=>{const e=t.parent.getChildByName("icon-back");e&&e.setAttribute("visible",!1),t.attribute.hoverImage&&t.attribute.image!==t.attribute.originImage&&(t.image=t.attribute.originImage)}),o)}(t,e,i,this)}residentHoverIcon(t,e){!function(t,e,i){PL(t,e,(t=>t.attribute.funcType===sw.dropDown),(t=>{t.oldVisibleTime=t.attribute.visibleTime,t.setAttribute("visibleTime","always"),t.setAttribute("opacity",1)}),i)}(t,e,this)}resetResidentHoverIcon(t,e){!function(t,e,i){PL(t,e,(t=>t.attribute.funcType===sw.dropDown),(t=>{t.oldVisibleTime&&t.setAttribute("visibleTime",t.oldVisibleTime),t.setAttribute("opacity","always"===t.attribute.visibleTime?1:0)}),i)}(t,e,this)}deactivateChart(t,e){var i,o;if(-1===t||-1===e)return;const n=this.getCell(t,e);null===(o=null===(i=null==n?void 0:n.firstChild)||void 0===i?void 0:i.deactivate)||void 0===o||o.call(i)}activateChart(t,e){var i,o,n;if(-1===t||-1===e)return;const r=this.getCell(t,e);return null===(o=null===(i=null==r?void 0:r.firstChild)||void 0===i?void 0:i.activate)||void 0===o||o.call(i,this.table),null===(n=null==r?void 0:r.firstChild)||void 0===n?void 0:n.activeChartInstance}removeInteractionBorder(t,e){const i=this.getCell(t,e);i.setAttribute("highlightStroke",void 0),i.setAttribute("highlightStrokeArrayWidth",void 0),i.setAttribute("highlightStrokeArrayColor",void 0)}createCellSelectBorder(t,e,i,o,n,r,s){!function(t,e,i,o,n,r,s,a){var l,h,d,c,u,g,p,f,v;let b=!!(null===(l=t.table.options.excelOptions)||void 0===l?void 0:l.fillHandle);if((null===(h=t.table.stateManager.select.ranges)||void 0===h?void 0:h.length)>1)b=!1,t.removeFillHandleFromSelectComponents();else if(1===(null===(d=t.table.stateManager.select.ranges)||void 0===d?void 0:d.length)){const e=Math.max(t.table.stateManager.select.ranges[0].start.row,t.table.stateManager.select.ranges[0].end.row),i=Math.max(t.table.stateManager.select.ranges[0].start.col,t.table.stateManager.select.ranges[0].end.col);t.table.isHeader(i,e)&&(b=!1)}!Array.isArray(a)||!1!==a[1]&&!1!==a[2]||(b=!1);const m=Math.min(e,o),y=Math.min(i,n),C=Math.max(e,o),w=Math.max(i,n),x=t.highPerformanceGetCell(m,y).globalAABBBounds,_=t.highPerformanceGetCell(C,w).globalAABBBounds,S=t.table.theme,A=null===(c=S.selectionStyle)||void 0===c?void 0:c.cellBorderColor,B=null===(u=S.selectionStyle)||void 0===u?void 0:u.cellBorderLineWidth,R=oc({pickable:!1,fill:"replace"!==(null===(g=S.selectionStyle)||void 0===g?void 0:g.selectionFillMode)&&(null!==(f=null===(p=S.selectionStyle)||void 0===p?void 0:p.cellBgColor)&&void 0!==f?f:"rgba(0, 0, 255,0.1)"),lineWidth:B,stroke:a.map((t=>!!t&&A)),x:x.x1-t.tableGroup.attribute.x,y:x.y1-t.tableGroup.attribute.y,width:0,height:0,visible:!0,cornerRadius:eL(0,null===(v=t.table.theme.frameStyle)||void 0===v?void 0:v.cornerRadius,e,i,o,n,t.table)});let T;b&&(T=oc({pickable:!1,fill:A,stroke:A,x:_.x2-3,y:_.y2-3,width:6,height:6,visible:!0})),t.lastSelectId=s,t.selectingRangeComponents.set(`${m}-${y}-${C}-${w}-${s}`,{rect:R,fillhandle:T,role:r}),t.tableGroup.insertAfter(R,"body"===r?t.bodyGroup:"columnHeader"===r?t.colHeaderGroup:"rowHeader"===r?t.rowHeaderGroup:"cornerHeader"===r?t.cornerHeaderGroup:"rightTopCorner"===r?t.rightTopCornerGroup:"rightFrozen"===r?t.rightFrozenGroup:"leftBottomCorner"===r?t.leftBottomCornerGroup:"bottomFrozen"===r?t.bottomFrozenGroup:t.rightBottomCornerGroup),b&&t.tableGroup.insertAfter(T,"body"===r?t.bodyGroup:"columnHeader"===r?t.colHeaderGroup:"rowHeader"===r?t.rowHeaderGroup:"cornerHeader"===r?t.cornerHeaderGroup:"rightTopCorner"===r?t.rightTopCornerGroup:"rightFrozen"===r?t.rightFrozenGroup:"leftBottomCorner"===r?t.leftBottomCornerGroup:"bottomFrozen"===r?t.bottomFrozenGroup:t.rightBottomCornerGroup)}(this,t,e,i,o,n,r,s)}moveSelectingRangeComponentsToSelectedRangeComponents(){iL(this)}deleteLastSelectedRangeComponents(){var t;(t=this).selectedRangeComponents.forEach(((e,i)=>{var o;i.split("-")[4]===t.lastSelectId&&(e.rect.delete(),null===(o=e.fillhandle)||void 0===o||o.delete(),t.selectedRangeComponents.delete(i))}))}deleteAllSelectBorder(){oL(this),nL(this)}updateCellSelectBorder(t){JM(this,t,!(arguments.length>1&&void 0!==arguments[1])||arguments[1])}removeFillHandleFromSelectComponents(){this.selectedRangeComponents.forEach(((t,e)=>{var i;null===(i=t.fillhandle)||void 0===i||i.delete(),t.fillhandle=void 0}))}recreateAllSelectRangeComponents(){oL(this),this.table.stateManager.select.ranges.forEach((t=>{JM(this,t),iL(this)}))}updateColWidth(t,e,i,o){(function(t,e,i,o){o||t.table._setColWidth(e,t.table.getColWidth(e)+i,!0);const n=t.getColGroup(e,!0),r=t.getColGroupInRightTopCorner(e);n&&!r&&FT(n,i,"col-corner",t),r&&FT(r,i,"right-top",t);const s=t.getColGroup(e);s&&FT(s,i,"row-body",t);const a=t.getColGroupInLeftBottomCorner(e);a&&FT(a,i,"left-bottom",t);const l=t.getColGroupInBottom(e);l&&FT(l,i,"bottom",t);const h=t.getColGroupInRightBottomCorner(e);h&&FT(h,i,"right-bottom",t),e<t.frozenColCount?(t.cornerHeaderGroup.forEachChildrenSkipChild(((t,o)=>{t.col>e&&t.setAttribute("x",t.attribute.x+i)})),t.rowHeaderGroup.forEachChildrenSkipChild(((t,o)=>{t.col>e&&t.setAttribute("x",t.attribute.x+i)}))):(t.colHeaderGroup.forEachChildrenSkipChild(((t,o)=>{t.col>e&&t.setAttribute("x",t.attribute.x+i)})),t.bodyGroup.forEachChildrenSkipChild(((t,o)=>{t.col>e&&t.setAttribute("x",t.attribute.x+i)}))),a&&t.leftBottomCornerGroup.forEachChildrenSkipChild(((t,o)=>{t.col>e&&t.setAttribute("x",t.attribute.x+i)})),l&&t.bottomFrozenGroup.forEachChildrenSkipChild(((t,o)=>{t.col>e&&t.setAttribute("x",t.attribute.x+i)})),h&&t.rightBottomCornerGroup.forEachChildrenSkipChild(((t,o)=>{t.col>e&&t.setAttribute("x",t.attribute.x+i)}))})(this,t,Math.round(e),o),i||this.updateContainer(!0)}updateChartSizeForResizeColWidth(t){!function(t,e){const{table:i}=t,o=i.internalProps.layoutMap,n=-1===e?"all":i.internalProps.columnResizeType;if("column"===n){const o=t.getColGroup(e),n=t.getColGroup(e,!0),r=t.getColGroupInBottom(e,!0);if(null==o||o.forEachChildren((t=>{BL(t,i.getColWidth(t.col),i.getRowHeight(t.row))})),null==n||n.forEachChildren((t=>{BL(t,i.getColWidth(t.col),i.getRowHeight(t.row))})),null==r||r.forEachChildren((t=>{BL(t,i.getColWidth(t.col),i.getRowHeight(t.row))})),"adaptive"===i.widthMode&&e<i.colCount-1){const o=t.getColGroup(e+1),n=t.getColGroup(e+1,!0),r=t.getColGroupInBottom(e+1,!0);null==o||o.forEachChildren((t=>{BL(t,i.getColWidth(t.col),i.getRowHeight(t.row))})),null==n||n.forEachChildren((t=>{BL(t,i.getColWidth(t.col),i.getRowHeight(t.row))})),null==r||r.forEachChildren((t=>{BL(t,i.getColWidth(t.col),i.getRowHeight(t.row))}))}}else{let r,s,a,l=i.rowHeaderLevelCount,h=i.colCount-1;if("indicator"===n)if(o.indicatorsAsCol)r=o.getIndicatorKey(e,i.columnHeaderLevelCount);else{const t=o.getCellHeaderPaths(e,i.columnHeaderLevelCount-1),n=t.colHeaderPaths[t.colHeaderPaths.length-1];s=n.dimensionKey,a=n.value}else if("indicatorGroup"===n){const t=i.internalProps.layoutMap,e=t.getCellHeaderPaths(i.stateManager.columnResize.col,i.columnHeaderLevelCount),o=t.getHeadNodeByRowOrColDimensions(e.colHeaderPaths.slice(0,e.colHeaderPaths.length-1));l=o.startInTotal+i.frozenColCount,h=o.startInTotal+i.frozenColCount+o.size-1}for(let e=l;e<=h;e++){const l=t.getColGroup(e),h=t.getColGroup(e,!0),d=t.getColGroupInBottom(e,!0);if(l){if("indicator"===n){const t=o.getIndicatorKey(e,i.columnHeaderLevelCount);if(o.indicatorsAsCol&&t!==r)continue;if(!o.indicatorsAsCol){const t=o.getCellHeaderPaths(e,i.columnHeaderLevelCount-1),n=null==t?void 0:t.colHeaderPaths[t.colHeaderPaths.length-1];if(!n||s!==n.dimensionKey||a!==n.value)continue}}l.forEachChildren((t=>{BL(t,i.getColWidth(t.col),i.getRowHeight(t.row))})),null==h||h.forEachChildren((t=>{BL(t,i.getColWidth(t.col),i.getRowHeight(t.row))})),null==d||d.forEachChildren((t=>{BL(t,i.getColWidth(t.col),i.getRowHeight(t.row))}))}}}}(this,t)}updateChartSizeForResizeRowHeight(t){!function(t,e){var i;const{table:o}=t,n=o.internalProps.layoutMap,r=o.stateManager,s=-1===e?"all":o.internalProps.rowResizeType;let a,l,h,d=o.columnHeaderLevelCount,c=o.rowCount-1;if("indicator"===s)if(n.indicatorsAsCol){const t=n.getCellHeaderPaths(o.rowHeaderLevelCount-1,e),r=null===(i=t.rowHeaderPaths)||void 0===i?void 0:i[t.rowHeaderPaths.length-1];l=null==r?void 0:r.dimensionKey,h=null==r?void 0:r.value}else a=n.getIndicatorKey(o.rowHeaderLevelCount,e);else if("indicatorGroup"===s){const t=o.internalProps.layoutMap,i=t.getCellHeaderPaths(o.rowHeaderLevelCount,e),n=t.getHeadNodeByRowOrColDimensions(i.rowHeaderPaths.slice(0,i.rowHeaderPaths.length-1));d=n.startInTotal+o.frozenRowCount,c=n.startInTotal+o.frozenRowCount+n.size-1}const u=[{startCol:t.proxy.colStart,endCol:t.proxy.colEnd}];o.frozenColCount&&u.push({startCol:0,endCol:o.frozenColCount-1}),o.rightFrozenColCount&&u.push({startCol:o.colCount-o.rightFrozenColCount,endCol:o.colCount-1}),u.forEach((i=>{let{startCol:u,endCol:g}=i;for(let i=u;i<=g;i++)if("row"===s){const n=t.highPerformanceGetCell(i,e);if("cell"!==n.role)continue;if(BL(n,o.getColWidth(n.col),o.getRowHeight(n.row)),"adaptive"===o.heightMode&&e<o.rowCount-1){const n=t.highPerformanceGetCell(i,e+1);BL(n,o.getColWidth(n.col),o.getRowHeight(n.row))}}else for(let e=d;e<=c;e++){if("indicator"===s){const t=n.getIndicatorKey(r.table.rowHeaderLevelCount,e);if(!n.indicatorsAsCol&&t!==a)continue;if(n.indicatorsAsCol){const t=n.getCellHeaderPaths(r.table.rowHeaderLevelCount-1,e),i=null==t?void 0:t.rowHeaderPaths[t.rowHeaderPaths.length-1];if(!i||l!==i.dimensionKey||h!==i.value)continue}}const d=t.highPerformanceGetCell(i,e);"cell"===d.role&&BL(d,o.getColWidth(d.col),o.getRowHeight(d.row))}}))}(this,t)}updateChartState(t){this.table.isPivotChart()&&function(t,e){const i=t.table;if(i.isPivotChart()){const o=i._selectedDataItemsInChart.length;if((null===e||0===(null==e?void 0:e.length)||0===Object.keys(e).length)&&0===o)return;const n=[];if(Array.isArray(e))e.forEach((t=>{if(t&&0!==t.key&&Object.keys(t).length>0){const e={};for(const i in t)i.startsWith("VGRAMMAR_")||i.startsWith("__VCHART")||(e[i]=t[i]);n.push(e)}}));else if(e&&0!==e.key&&Object.keys(e).length>0){const t={};for(const i in e)i.startsWith("VGRAMMAR_")||i.startsWith("__VCHART")||(t[i]=e[i]);n.push(t)}Lt(i._selectedDataItemsInChart,n)||(i._selectedDataItemsInChart=n,i.internalProps.layoutMap.updateDataStateToChartInstance(),AL(t),i.scenegraph.updateNextFrame())}}(this,t)}updateCheckboxCellState(t,e,i){var o,n;if(this.table.transpose)null===(o=this.bodyGroup.children)||void 0===o||o.forEach((t=>{var o;null===(o=t.getChildAt(e))||void 0===o||o.getChildren().forEach((t=>{"checkbox"===t.name&&("indeterminate"===i?(t.setAttribute("indeterminate",!0),t.setAttribute("checked",void 0)):(t.setAttribute("indeterminate",void 0),t.setAttribute("checked",i)))}))}));else{const e=this.getColGroup(t);null===(n=null==e?void 0:e.children)||void 0===n||n.forEach((t=>{t.getChildren().find((t=>{"checkbox"===t.name&&("indeterminate"===i?(t.setAttribute("indeterminate",!0),t.setAttribute("checked",void 0)):(t.setAttribute("indeterminate",void 0),t.setAttribute("checked",i)))}))}))}}updateHeaderCheckboxCellState(t,e,i){var o,n;this.table.transpose?null===(o=this.rowHeaderGroup.children)||void 0===o||o.forEach((t=>{t.getChildAt(e).getChildren().forEach((t=>{"checkbox"===t.name&&("indeterminate"===i?(t.setAttribute("indeterminate",!0),t.setAttribute("checked",void 0)):(t.setAttribute("indeterminate",void 0),t.setAttribute("checked",i)))}))})):null===(n=this.getColGroup(t,!0).children)||void 0===n||n.forEach((t=>{t.getChildren().find((t=>{"checkbox"===t.name&&("indeterminate"===i?(t.setAttribute("indeterminate",!0),t.setAttribute("checked",void 0)):(t.setAttribute("indeterminate",void 0),t.setAttribute("checked",i)))}))}))}updateAutoColWidth(t){this.table.internalProps._widthResizedColMap.delete(t);const e=this.table.getColWidth(t),i=sM(t,0,this.table.rowCount-1,this.table,!0);i!==e&&this.updateColWidth(t,i-e)}recalculateColWidths(){const t=this.table;"adaptive"===t.widthMode||t.autoFillWidth||t.internalProps.transpose?rM(this.table,0,this.table.colCount-1,!0):(t._clearColRangeWidthsMap(),t.frozenColCount>0&&rM(this.table,0,t.frozenColCount-1,!0),t.rightFrozenColCount>0&&rM(this.table,t.rightFrozenColCount,t.colCount-1,!0),rM(t,this.proxy.colStart,this.proxy.colEnd,!0))}recalculateRowHeights(){const t=this.table;t.internalProps.useOneRowHeightFillAll=!1,"adaptive"===t.heightMode||t.autoFillHeight?ST(this.table,0,this.table.rowCount-1,!0,!0):(t.frozenRowCount>0&&ST(this.table,0,t.frozenRowCount-1,!0,!0),t.bottomFrozenRowCount>0&&ST(this.table,t.bottomFrozenRowCount,t.rowCount-1,!0,!0),ST(t,this.proxy.rowStart,this.proxy.rowEnd,!0,!0))}resize(){this.proxy.resize(),("adaptive"===this.table.widthMode||this.table.autoFillWidth)&&(0===this.table.internalProps._widthResizedColMap.size?this.recalculateColWidths():this.dealWidthMode()),"adaptive"===this.table.heightMode?0===this.table.internalProps._heightResizedRowMap.size?this.recalculateRowHeights():this.dealHeightMode():this.table.autoFillHeight&&this.dealHeightMode(),this.resetFrozen(),this.updateTableSize(),this.updateBorderSizeAndPosition(),this.component.updateScrollBar(),("adaptive"===this.table.widthMode||"adaptive"===this.table.heightMode||this.table.autoFillWidth||this.table.autoFillHeight)&&this.updateChartSizeForResizeColWidth(-1),this.proxy.progress(),this.updateNextFrame()}updateTableSize(){var t,e,i,o,n,r,s,a,l,h,d,c,u;if(this.tableGroup.setAttributes({x:this.table.tableX,y:this.table.tableY,width:Math.min(this.table.tableNoFrameWidth,Math.max(this.colHeaderGroup.attribute.width,this.bodyGroup.attribute.width,this.bottomFrozenGroup.attribute.width,0)+Math.max(this.cornerHeaderGroup.attribute.width,this.rowHeaderGroup.attribute.width,this.leftBottomCornerGroup.attribute.width,0)+Math.max(this.rightTopCornerGroup.attribute.width,this.rightFrozenGroup.attribute.width,this.rightBottomCornerGroup.attribute.width,0)),height:Math.min(this.table.tableNoFrameHeight,Math.max(this.colHeaderGroup.attribute.height,this.cornerHeaderGroup.attribute.height,this.rightTopCornerGroup.attribute.height,0)+Math.max(this.rowHeaderGroup.attribute.height,this.bodyGroup.attribute.height,this.rightFrozenGroup.attribute.height,0)+Math.max(this.leftBottomCornerGroup.attribute.height,this.bottomFrozenGroup.attribute.height,this.rightBottomCornerGroup.attribute.height,0))}),this.tableGroup.border){const g=null===(t=this.tableGroup.border)||void 0===t?void 0:t.attribute;let p,f,v,b;(null==g?void 0:g.strokeArrayWidth)?(p=g.strokeArrayWidth?g.strokeArrayWidth[0]:null!==(e=g.lineWidth)&&void 0!==e?e:0,f=g.strokeArrayWidth?g.strokeArrayWidth[1]:null!==(i=g.lineWidth)&&void 0!==i?i:0,v=g.strokeArrayWidth?g.strokeArrayWidth[2]:null!==(o=g.lineWidth)&&void 0!==o?o:0,b=g.strokeArrayWidth?g.strokeArrayWidth[3]:null!==(n=g.lineWidth)&&void 0!==n?n:0):(p=null!==(r=null==g?void 0:g.lineWidth)&&void 0!==r?r:0,f=null!==(s=null==g?void 0:g.lineWidth)&&void 0!==s?s:0,v=null!==(a=null==g?void 0:g.lineWidth)&&void 0!==a?a:0,b=null!==(l=null==g?void 0:g.lineWidth)&&void 0!==l?l:0),"rect"===this.tableGroup.border.type?(null===(h=this.table.theme.frameStyle)||void 0===h?void 0:h.innerBorder)?this.tableGroup.border.setAttributes({x:this.table.tableX+b/2,y:this.table.tableY+p/2,width:this.tableGroup.attribute.width-b/2-f/2,height:this.tableGroup.attribute.height-p/2-v/2}):this.tableGroup.border.setAttributes({x:this.table.tableX-b/2,y:this.table.tableY-p/2,width:this.tableGroup.attribute.width+b/2+f/2,height:this.tableGroup.attribute.height+p/2+v/2}):"group"===this.tableGroup.border.type&&((null===(d=this.table.theme.frameStyle)||void 0===d?void 0:d.innerBorder)?(this.tableGroup.border.setAttributes({x:this.table.tableX+b/2,y:this.table.tableY+p/2,width:this.tableGroup.attribute.width-b/2-f/2,height:this.tableGroup.attribute.height-p/2-v/2}),null===(c=this.tableGroup.border.firstChild)||void 0===c||c.setAttributes({x:0,y:0,width:this.tableGroup.attribute.width-b/2-f/2,height:this.tableGroup.attribute.height-p/2-v/2})):(this.tableGroup.border.setAttributes({x:this.table.tableX-b/2,y:this.table.tableY-p/2,width:this.tableGroup.attribute.width+b/2+f/2,height:this.tableGroup.attribute.height+p/2+v/2}),null===(u=this.tableGroup.border.firstChild)||void 0===u||u.setAttributes({x:b/2,y:p/2,width:this.tableGroup.attribute.width,height:this.tableGroup.attribute.height})))}this.table.bottomFrozenRowCount>0&&(this.bottomFrozenGroup.setAttribute("y",this.tableGroup.attribute.height-this.table.getBottomFrozenRowsHeight()),this.leftBottomCornerGroup.setAttributes({visible:!0,y:this.tableGroup.attribute.height-this.table.getBottomFrozenRowsHeight(),height:this.table.getBottomFrozenRowsHeight(),width:this.table.getFrozenColsWidth()}),this.rightBottomCornerGroup.setAttributes({visible:!0,y:this.tableGroup.attribute.height-this.table.getBottomFrozenRowsHeight(),height:this.table.getBottomFrozenRowsHeight()})),this.table.rightFrozenColCount>0&&(this.rightFrozenGroup.setAttribute("x",this.tableGroup.attribute.width-this.table.getRightFrozenColsWidth()),this.rightTopCornerGroup.setAttributes({visible:!0,x:this.tableGroup.attribute.width-this.table.getRightFrozenColsWidth(),width:this.table.getRightFrozenColsWidth(),height:this.table.getFrozenRowsHeight()}),this.rightBottomCornerGroup.setAttributes({visible:!0,x:this.tableGroup.attribute.width-this.table.getRightFrozenColsWidth(),width:this.table.getRightFrozenColsWidth()})),this.updateDomContainer()}updateRowHeight(t,e,i){PT(this,t,e=Math.round(e),i),this.updateContainerHeight(t,e)}updateRowsHeight(t,e,i){for(let o=0;o<t.length;o++){const n=t[o];if(n>=this.proxy.rowStart&&n<=this.proxy.rowEnd){const t=e[o];PT(this,n,Math.round(t),i),this._updateContainerHeight(n,t)}}this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame()}updateContainerWidth(t,e){t<this.frozenColCount?(this.rowHeaderGroup.setDeltaWidth(e),this.cornerHeaderGroup.setDeltaWidth(e),this.colHeaderGroup.setDeltaX(e),this.bodyGroup.setDeltaX(e)):(this.colHeaderGroup.setDeltaWidth(e),this.bodyGroup.setDeltaWidth(e)),this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame()}_updateContainerHeight(t,e){t<this.table.frozenRowCount?(this.colHeaderGroup.setDeltaHeight(e),this.cornerHeaderGroup.setDeltaHeight(e),this.rowHeaderGroup.setDeltaY(e),this.bodyGroup.setDeltaY(e),this.table.rightFrozenColCount&&this.rightFrozenGroup.setDeltaY(e)):t>=this.table.rowCount-this.table.bottomFrozenRowCount?(this.leftBottomCornerGroup.setDeltaHeight(e),this.bottomFrozenGroup.setDeltaHeight(e),this.table.rightFrozenColCount&&this.rightBottomCornerGroup.setDeltaHeight(e)):(this.rowHeaderGroup.setDeltaHeight(e),this.bodyGroup.setDeltaHeight(e),this.table.rightFrozenColCount&&this.rightFrozenGroup.setDeltaHeight(e))}updateContainerHeight(t,e){this._updateContainerHeight(t,e),this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame()}setColWidth(t,e){const i=this.table.getColWidth(t);i!==e&&(this.updateColWidth(t,e-i),this.table._clearColRangeWidthsMap(t))}setRowHeight(t,e){const i=this.table.getRowHeight(t);i!==e&&((t>=this.proxy.rowStart&&t<=this.proxy.rowEnd||t>=this.table.rowCount-this.table.bottomFrozenRowCount&&t<=this.table.rowCount-1||t<this.table.frozenRowCount)&&this.updateRowHeight(t,e-i),this.table._clearRowRangeHeightsMap(t))}setX(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.table.scenegraph.proxy.setX(-t,e)}setY(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.table.scenegraph.proxy.setY(-t,e)}setBodyAndRowHeaderY(t){var e,i,o,n,r,s;const a=null!==(i=null===(e=this.bodyGroup.firstChild)||void 0===e?void 0:e.firstChild)&&void 0!==i?i:null===(o=this.rowHeaderGroup.firstChild)||void 0===o?void 0:o.firstChild,l=null!==(r=null===(n=this.bodyGroup.firstChild)||void 0===n?void 0:n.lastChild)&&void 0!==r?r:null===(s=this.rowHeaderGroup.firstChild)||void 0===s?void 0:s.lastChild;0===t&&a&&a.row===this.table.frozenRowCount&&a.attribute.y+t<0?t=-a.attribute.y:l&&this.table.tableNoFrameHeight<this.table.getAllRowsHeight()&&l.row===this.table.rowCount-this.table.bottomFrozenRowCount-1&&l.attribute.y+l.attribute.height+t<this.table.tableNoFrameHeight-this.table.getFrozenRowsHeight()-this.table.getBottomFrozenRowsHeight()&&(t=this.table.tableNoFrameHeight-this.table.getFrozenRowsHeight()-this.table.getBottomFrozenRowsHeight()-l.attribute.y-l.attribute.height),this.colHeaderGroup.attribute.height+t!==this.bodyGroup.attribute.y&&(this.bodyGroup.setAttribute("y",this.colHeaderGroup.attribute.height+t),this.rowHeaderGroup.setAttribute("y",this.cornerHeaderGroup.attribute.height+t),this.table.rightFrozenColCount>0&&this.rightFrozenGroup.setAttribute("y",this.rightTopCornerGroup.attribute.height+t),this.updateNextFrame())}setBodyAndColHeaderX(t){const e=this.bodyGroup.firstChild,i=this.bodyGroup.lastChild;0===t&&e&&e.col===this.table.frozenColCount&&e.attribute.x+t<0?t=-e.attribute.x:i&&this.table.tableNoFrameWidth<this.table.getAllColsWidth()&&i.col===this.table.colCount-this.table.rightFrozenColCount-1&&i.attribute.x+i.attribute.width+t<this.table.tableNoFrameWidth-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth()&&(t=this.table.tableNoFrameWidth-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth()-i.attribute.x-i.attribute.width),this.table.getFrozenColsWidth()+t!==this.bodyGroup.attribute.x&&(this.bodyGroup.setAttribute("x",this.table.getFrozenColsWidth()+t),this.colHeaderGroup.setAttribute("x",this.table.getFrozenColsWidth()+t),this.table.bottomFrozenRowCount>0&&this.bottomFrozenGroup.setAttribute("x",this.table.getFrozenColsWidth()+t),this.updateNextFrame())}afterScenegraphCreated(){this.isPivot||this.table.transpose?this.table.options.frozenColCount?this.component.setFrozenColumnShadow(this.table.frozenColCount-1):this.table.options.rightFrozenColCount?this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount):this.component.setFrozenColumnShadow(-1):(this.component.setFrozenColumnShadow(this.table.frozenColCount-1),this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount)),this.table.stateManager.checkFrozen(),this.updateContainer(),this.createFrameBorder(),this.updateBorderSizeAndPosition(),this.component.updateScrollBar(),NM(this.table),this.table.options.animationAppear&&function(t){var e,i,o,n;if(!t.options.animationAppear)return;let r,s,a,l;!0===t.options.animationAppear?(r=500,s=0,a="one-by-one",l="column"):(r=null!==(e=t.options.animationAppear.duration)&&void 0!==e?e:500,s=null!==(i=t.options.animationAppear.delay)&&void 0!==i?i:0,a=null!==(o=t.options.animationAppear.type)&&void 0!==o?o:"one-by-one",l=null!==(n=t.options.animationAppear.direction)&&void 0!==n?n:"row");const{scenegraph:h,frozenColCount:d,frozenRowCount:c}=t,{colStart:u,colEnd:g,rowStart:p,rowEnd:f}=h.proxy;for(let t=0;t<=g;t++)for(let e=0;e<=f;e++){const i=h.highPerformanceGetCell(t,e);i&&"cell"===i.role&&i.forEachChildren((i=>{i.setAttribute("opacity",0),i.animate().wait("one-by-one"===a?("row"===l?e:t)*(r-s):s).to({opacity:1},r,"linear")}))}}(this.table),this.updateNextFrame()}dealWidthMode(){const t=this.table;if("adaptive"===t.widthMode){t._clearColRangeWidthsMap();const e=t.tableNoFrameWidth;let i=0;for(let e=0;e<t.colCount;e++)(e<t.rowHeaderLevelCount||t.isPivotChart()&&e>=t.colCount-t.rightFrozenColCount)&&(i+=t.getColWidth(e));cM(e-i,t.rowHeaderLevelCount,t.isPivotChart()?t.colCount-t.rightFrozenColCount:t.colCount,!1,[],t,!0)}else if(t.autoFillWidth){t._clearColRangeWidthsMap();const e=t.tableNoFrameWidth;let i=0,o=0;for(let e=0;e<t.colCount;e++){const n=t.getColWidth(e);(e<t.rowHeaderLevelCount||t.isPivotChart()&&e>=t.colCount-t.rightFrozenColCount)&&(i+=n),o+=n}if(o<e&&o>i){cM(e-i,t.rowHeaderLevelCount,t.isPivotChart()?t.colCount-t.rightFrozenColCount:t.colCount,!1,[],t,!0)}}let e=0;this.bodyGroup.forEachChildrenSkipChild((t=>{e+=t.attribute.width})),this.bodyGroup.setAttribute("width",e);let i=0;this.colHeaderGroup.forEachChildrenSkipChild((t=>{i+=t.attribute.width})),this.colHeaderGroup.setAttribute("width",i);let o=0;this.rowHeaderGroup.forEachChildrenSkipChild((t=>{o+=t.attribute.width})),this.rowHeaderGroup.setAttribute("width",o);let n=0;this.cornerHeaderGroup.forEachChildrenSkipChild((t=>{n+=t.attribute.width})),this.cornerHeaderGroup.setAttribute("width",n),this.colHeaderGroup.setAttribute("x",this.cornerHeaderGroup.attribute.width),this.rowHeaderGroup.setAttribute("y",this.cornerHeaderGroup.attribute.height),this.bodyGroup.setAttributes({x:this.rowHeaderGroup.attribute.width,y:this.colHeaderGroup.attribute.height})}dealHeightMode(){var t;const e=this.table;if("adaptive"===e.heightMode){e._clearRowRangeHeightsMap();const t=e.getRowsHeight(0,e.columnHeaderLevelCount-1),i=e.isPivotChart()?e.getBottomFrozenRowsHeight():0,o=e.tableNoFrameHeight-t-i,n=e.columnHeaderLevelCount,r=e.isPivotChart()?e.rowCount-e.bottomFrozenRowCount:e.rowCount;let s=0;for(let t=n;t<r;t++)s+=e.getRowHeight(t);const a=o/s;for(let t=n;t<r;t++){let i;i=t===r-1?o-e.getRowsHeight(n,r-2):Math.round(e.getRowHeight(t)*a),this.setRowHeight(t,i)}}else if(e.autoFillHeight){e._clearRowRangeHeightsMap();const i=e.tableNoFrameHeight;let o=0,n=0;for(let t=0;t<e.rowCount;t++){const i=e.getRowHeight(t);(t<e.columnHeaderLevelCount||e.isPivotChart()&&t>=e.rowCount-e.bottomFrozenRowCount)&&(n+=i),o+=i}if((null!==(t=this._dealAutoFillHeightOriginRowsHeight)&&void 0!==t?t:o)<i&&o-n>0){const t=e.columnHeaderLevelCount,r=e.isPivotChart()?e.rowCount-e.bottomFrozenRowCount:e.rowCount,s=(i-n)/(o-n);for(let o=t;o<r;o++){let a;a=o===r-1?i-n-e.getRowsHeight(t,r-2):Math.round(e.getRowHeight(o)*s),this.setRowHeight(o,a)}}}}dealFrozen(){!function(t){var e,i,o,n;if(t.table.frozenColCount>t.table.rowHeaderLevelCount){t.rowHeaderGroup.setAttribute("height",t.bodyGroup.attribute.height),t.rowHeaderGroup.setAttribute("y",t.bodyGroup.attribute.y),t.cornerHeaderGroup.setAttribute("height",t.colHeaderGroup.attribute.height);for(let e=0;e<t.table.frozenColCount-t.table.rowHeaderLevelCount;e++)uL(t),gL(t),vL(t)}else if(t.table.frozenColCount<t.table.rowHeaderLevelCount){t.bodyGroup.setAttribute("height",t.rowHeaderGroup.attribute.height),t.bodyGroup.setAttribute("y",t.rowHeaderGroup.attribute.y),t.colHeaderGroup.setAttribute("height",t.cornerHeaderGroup.attribute.height);for(let e=0;e<t.table.rowHeaderLevelCount-t.table.frozenColCount;e++)pL(t),fL(t),bL(t)}t.bodyGroup.setAttribute("x",t.rowHeaderGroup.attribute.width),t.colHeaderGroup.setAttribute("x",t.cornerHeaderGroup.attribute.width),t.updateContainer(),t.updateBorderSizeAndPosition(),t.isPivot||t.table.transpose?t.table.options.frozenColCount?t.component.setFrozenColumnShadow(t.table.frozenColCount-1):t.table.options.frozenColCount&&t.component.setRightFrozenColumnShadow(t.table.colCount-t.table.rightFrozenColCount):(t.component.setFrozenColumnShadow(t.table.frozenColCount-1),t.component.setRightFrozenColumnShadow(t.table.colCount-t.table.rightFrozenColCount)),t.hasFrozen=!0,t.frozenColCount=t.table.frozenColCount,t.frozenRowCount=null!==(n=null!==(i=null===(e=t.colHeaderGroup.firstChild)||void 0===e?void 0:e.childrenCount)&&void 0!==i?i:null===(o=t.cornerHeaderGroup.firstChild)||void 0===o?void 0:o.childrenCount)&&void 0!==n?n:t.table.frozenRowCount}(this)}resetFrozen(){!function(t){var e,i,o,n,r,s;if(t.frozenColCount>t.table.frozenColCount){t.bodyGroup.setAttribute("height",t.rowHeaderGroup.attribute.height),t.bodyGroup.setAttribute("y",t.rowHeaderGroup.attribute.y),t.colHeaderGroup.setAttribute("height",t.cornerHeaderGroup.attribute.height);for(let e=0;e<t.frozenColCount-t.table.frozenColCount;e++)pL(t),fL(t),bL(t)}else if(t.frozenColCount<t.table.frozenColCount){t.rowHeaderGroup.setAttribute("height",t.bodyGroup.attribute.height),t.rowHeaderGroup.setAttribute("y",t.bodyGroup.attribute.y),t.cornerHeaderGroup.setAttribute("height",t.colHeaderGroup.attribute.height);for(let e=0;e<t.table.frozenColCount-t.frozenColCount;e++)uL(t),gL(t),vL(t)}cL(t),t.recreateAllSelectRangeComponents(),t.frozenColCount=t.table.frozenColCount,t.frozenRowCount=null!==(n=null!==(i=null===(e=t.colHeaderGroup.firstChild)||void 0===e?void 0:e.childrenCount)&&void 0!==i?i:null===(o=t.cornerHeaderGroup.firstChild)||void 0===o?void 0:o.childrenCount)&&void 0!==n?n:t.table.frozenRowCount,t.proxy.colStart=null!==(s=null===(r=t.bodyGroup.firstChild)||void 0===r?void 0:r.col)&&void 0!==s?s:t.table.frozenColCount,t.bodyGroup.setAttribute("x",t.rowHeaderGroup.attribute.width),t.colHeaderGroup.setAttribute("x",t.cornerHeaderGroup.attribute.width),t.updateContainer(),t.updateBorderSizeAndPosition(),t.isPivot||t.table.transpose?t.table.options.frozenColCount?t.component.setFrozenColumnShadow(t.table.frozenColCount-1):t.table.options.rightFrozenColCount&&t.component.setRightFrozenColumnShadow(t.table.colCount-t.table.rightFrozenColCount):(t.component.setFrozenColumnShadow(t.table.frozenColCount-1),t.component.setRightFrozenColumnShadow(t.table.colCount-t.table.rightFrozenColCount)),t.hasFrozen=!0}(this)}resetRowFrozen(){!function(t){var e,i,o,n,r;if(t.frozenRowCount>t.table.frozenRowCount){t.bodyGroup.setAttribute("width",t.colHeaderGroup.attribute.width),t.bodyGroup.setAttribute("x",t.colHeaderGroup.attribute.x),t.rowHeaderGroup.setAttribute("width",t.cornerHeaderGroup.attribute.width);for(let e=0;e<t.frozenRowCount-t.table.frozenRowCount;e++)xL(t),_L(t),SL(t)}else if(t.frozenRowCount<t.table.frozenRowCount){t.colHeaderGroup.setAttribute("width",t.bodyGroup.attribute.width),t.colHeaderGroup.setAttribute("x",t.bodyGroup.attribute.x),t.cornerHeaderGroup.setAttribute("width",t.rowHeaderGroup.attribute.width);for(let e=0;e<t.table.frozenRowCount-t.frozenRowCount;e++)yL(t),CL(t),wL(t)}cL(t),t.recreateAllSelectRangeComponents(),t.frozenRowCount=t.table.frozenRowCount,t.frozenColCount=null!==(i=null===(e=t.rowHeaderGroup)||void 0===e?void 0:e.childrenCount)&&void 0!==i?i:0,t.proxy.rowStart=null!==(r=null===(n=null===(o=t.bodyGroup.firstChild)||void 0===o?void 0:o.firstChild)||void 0===n?void 0:n.row)&&void 0!==r?r:t.table.frozenRowCount,t.bodyGroup.setAttribute("y",t.colHeaderGroup.attribute.height),t.rowHeaderGroup.setAttribute("y",t.cornerHeaderGroup.attribute.height),t.updateContainer(),t.updateBorderSizeAndPosition(),t.hasFrozen=!0}(this)}updateCellLayoutWidthCertainWidth(t,e,i){const o=t.attribute.width;let n=!1;return t.forEachChildren(((t,r)=>{r+=e;const s=s_(this.table,i,r);s?t=this.getCell(s.start.col,s.start.row):t.setAttribute("width",o);const a=tB(FR("padding",this.table._getCellStyle(i,r),i,r,this.table)),l=t.getChildByName("text");let h=0,d=0;if(l)h=l.AABBBounds.height()+(a[0]+a[2]),l.setAttribute("maxLineWidth",o-(a[1]+a[3])),d=l.AABBBounds.height()+(a[0]+a[2]);else{const e=t.getChildAt(1);h=e.AABBBounds.height()+(a[0]+a[2]),e._cellWidth=o-(a[1]+a[3]),e.layout(),d=e.AABBBounds.height()+(a[0]+a[2])}const c=this.table.getRowHeight(r);t.attribute.height!==d&&(t.setAttribute("height",d),(c===h||d>c)&&(n=!0))})),n}updateHeaderPosition(t,e,i,o,n){!function(t,e,i,o,n,r){const s=r.scenegraph;for(let i=t;i<=e;i++){const t=r.getColWidth(i),e=r.scenegraph.getColGroup(i,!0),o=r.scenegraph.getColGroup(i),n=r.scenegraph.getColGroupInBottom(i),s=r.scenegraph.getColGroupInLeftBottomCorner(i),a=r.scenegraph.getColGroupInRightBottomCorner(i);e&&(e.setAttribute("width",t),e.forEachChildren((e=>{e.setAttribute("width",t)}))),o&&(o.setAttribute("width",t),o.forEachChildren((e=>{e.setAttribute("width",t)}))),n&&(n.setAttribute("width",t),n.forEachChildren((e=>{e.setAttribute("width",t)}))),a&&(a.setAttribute("width",t),a.forEachChildren((e=>{e.setAttribute("width",t)}))),s&&(s.setAttribute("width",t),s.forEachChildren((e=>{e.setAttribute("width",t)})))}if(s.updateContainer(),"column"===n)for(let i=t;i<=e;i++){const t=r.scenegraph.getColGroup(i);null==t||t.setAttribute("chartInstance",void 0);for(let t=0;t<=r.frozenRowCount-1;t++)s.updateCellContent(i,t);for(let t=s.bodyRowStart;t<=s.bodyRowEnd;t++)s.updateCellContent(i,t);for(let t=r.rowCount-r.bottomFrozenRowCount;t<=r.rowCount-1;t++)s.updateCellContent(i,t)}else{for(let t=0;t<=r.frozenColCount-1;t++){const e=r.scenegraph.getColGroup(t);null==e||e.setAttribute("chartInstance",void 0);for(let e=i;e<=o;e++)s.updateCellContent(t,e)}for(let t=s.bodyColStart;t<=s.bodyColEnd;t++){const e=r.scenegraph.getColGroup(t);null==e||e.setAttribute("chartInstance",void 0);for(let e=i;e<=o;e++)s.updateCellContent(t,e)}for(let t=r.colCount-r.rightFrozenColCount;t<=r.colCount-1;t++){const e=r.scenegraph.getColGroup(t);null==e||e.setAttribute("chartInstance",void 0);for(let e=i;e<=o;e++)s.updateCellContent(t,e)}}}(t,e,i,o,n,this.table)}updateContainerAttrWidthAndX(){var t,e,i;const o=TL(this.cornerHeaderGroup,0),n=TL(this.rowHeaderGroup,0),r=this.colHeaderGroup.hasChildNodes()&&this.colHeaderGroup.firstChild?TL(this.colHeaderGroup,this.colHeaderGroup.firstChild.col>0?this.table.getColsWidth(null!==(t=this.table.frozenColCount)&&void 0!==t?t:0,this.colHeaderGroup.firstChild.col-1):0):0,s=this.bodyGroup.hasChildNodes()&&this.bodyGroup.firstChild?TL(this.bodyGroup,this.bodyGroup.firstChild.col>0?this.table.getColsWidth(null!==(e=this.table.frozenColCount)&&void 0!==e?e:0,this.bodyGroup.firstChild.col-1):0):0,a=TL(this.rightFrozenGroup.childrenCount>0?this.rightFrozenGroup:this.rightTopCornerGroup,0);this.bottomFrozenGroup.hasChildNodes()&&this.bottomFrozenGroup.firstChild&&TL(this.bottomFrozenGroup,this.bottomFrozenGroup.firstChild.col>0?this.table.getColsWidth(null!==(i=this.table.frozenColCount)&&void 0!==i?i:0,this.bottomFrozenGroup.firstChild.col-1):0),TL(this.leftBottomCornerGroup,0),TL(this.rightTopCornerGroup,0),TL(this.rightBottomCornerGroup,0),this.cornerHeaderGroup.setDeltaWidth(o-this.cornerHeaderGroup.attribute.width),this.leftBottomCornerGroup.setDeltaWidth(o-this.leftBottomCornerGroup.attribute.width),this.colHeaderGroup.setDeltaWidth(r-this.colHeaderGroup.attribute.width),this.rowHeaderGroup.setDeltaWidth(n-this.rowHeaderGroup.attribute.width),this.bottomFrozenGroup.setDeltaWidth(r-this.bottomFrozenGroup.attribute.width),this.rightFrozenGroup.setDeltaWidth(a-this.rightFrozenGroup.attribute.width),this.rightTopCornerGroup.setDeltaWidth(a-this.rightTopCornerGroup.attribute.width),this.rightBottomCornerGroup.setDeltaWidth(a-this.rightBottomCornerGroup.attribute.width),this.bodyGroup.setDeltaWidth(s-this.bodyGroup.attribute.width),this.colHeaderGroup.setAttribute("x",this.cornerHeaderGroup.attribute.width),this.bottomFrozenGroup.setAttribute("x",this.table.getFrozenColsWidth()),this.bodyGroup.setAttribute("x",this.rowHeaderGroup.attribute.width)}updateContainer(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._needUpdateContainer||(this._needUpdateContainer=!0,setTimeout((()=>{this.updateContainerSync()}),0)):(this._needUpdateContainer=!0,this.updateContainerSync())}updateContainerSync(){this._needUpdateContainer&&(this._needUpdateContainer=!1,this.updateContainerAttrWidthAndX(),this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame())}updateCellContentWhileResize(t,e){var i;const o=(null===(i=this.table.getCellRawRecord(t,e))||void 0===i?void 0:i.vtableMerge)?"text":this.table.isHeader(t,e)?this.table._getHeaderLayoutMap(t,e).headerType:this.table.getBodyColumnType(t,e),n=this.getCell(t,e);"image"!==o&&"video"!==o||KR(n,t,e,0,0,this.table)}createFrameBorder(){var t,e,i,o,n;this.updateTableSize();const r=!this.isPivot&&!this.table.internalProps.transpose;nk(this.bodyGroup,this.table.theme.bodyStyle.frameStyle,this.bodyGroup.role,r?[!0,!0,!0,!1]:void 0),nk(this.rowHeaderGroup,this.isPivot||this.table.internalProps.transpose?this.table.theme.rowHeaderStyle.frameStyle:this.table.theme.bodyStyle.frameStyle,this.rowHeaderGroup.role,r?[!0,!1,!0,!0]:void 0),nk(this.colHeaderGroup,this.table.theme.headerStyle.frameStyle,this.colHeaderGroup.role,r?[!0,!0,!0,!1]:void 0),nk(this.cornerHeaderGroup,this.isPivot?this.table.theme.cornerHeaderStyle.frameStyle:this.table.theme.headerStyle.frameStyle,this.cornerHeaderGroup.role,r?[!0,!1,!0,!0]:void 0),(null===(t=this.table.theme.cornerLeftBottomCellStyle)||void 0===t?void 0:t.frameStyle)&&nk(this.leftBottomCornerGroup,this.table.theme.cornerLeftBottomCellStyle.frameStyle,this.leftBottomCornerGroup.role,r?[!0,!1,!0,!0]:void 0),(null===(e=this.table.theme.bottomFrozenStyle)||void 0===e?void 0:e.frameStyle)&&nk(this.bottomFrozenGroup,this.table.theme.bottomFrozenStyle.frameStyle,this.bottomFrozenGroup.role,r?[!0,!0,!0,!1]:void 0),(null===(i=this.table.theme.rightFrozenStyle)||void 0===i?void 0:i.frameStyle)&&nk(this.rightFrozenGroup,this.table.theme.rightFrozenStyle.frameStyle,this.rightFrozenGroup.role,void 0),(null===(o=this.table.theme.cornerRightTopCellStyle)||void 0===o?void 0:o.frameStyle)&&nk(this.rightTopCornerGroup,this.table.theme.cornerRightTopCellStyle.frameStyle,this.rightTopCornerGroup.role,void 0),(null===(n=this.table.theme.cornerRightBottomCellStyle)||void 0===n?void 0:n.frameStyle)&&nk(this.rightBottomCornerGroup,this.table.theme.cornerRightBottomCellStyle.frameStyle,this.rightBottomCornerGroup.role,void 0),nk(this.tableGroup,this.table.theme.frameStyle,this.tableGroup.role,void 0)}getResizeColAt(t,e,i){const o=this.table.theme.columnResize.resizeHotSpotSize/2;let n;if(!i){const i=this.table.getDrawRange();return e>=i.top&&e<=i.bottom&&(n=this.table.getCellAtRelativePosition(t-o,e),n.col===this.table.colCount-1)?n:{col:-1,row:-1}}return i.stage?(t<i.globalAABBBounds.x1+o?n={col:i.col-1,row:i.row,x:i.globalAABBBounds.x1}:i.globalAABBBounds.x2-o<t&&(n={col:i.col,row:i.row,x:i.globalAABBBounds.x2}),n&&this.table.rightFrozenColCount>0&&n.col>=this.table.colCount-this.table.rightFrozenColCount-1&&this.table.tableNoFrameWidth-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth()+this.table.scrollLeft<this.bodyGroup.attribute.width&&(n.col=n.col+1,n.rightFrozen=!0),n||{col:-1,row:-1}):{col:-1,row:-1}}getResizeRowAt(t,e,i){const o=this.table.theme.columnResize.resizeHotSpotSize/2;if(i){let t;if(e<i.globalAABBBounds.y1+o?t={col:i.col,row:i.row-1,y:i.globalAABBBounds.y1}:i.globalAABBBounds.y2-o<e&&(t={col:i.col,row:i.row,y:i.globalAABBBounds.y2}),t&&this.table.bottomFrozenRowCount>0&&t.row>=this.table.rowCount-this.table.bottomFrozenRowCount-1&&this.table.tableNoFrameHeight-this.table.getFrozenRowsHeight()-this.table.getBottomFrozenRowsHeight()+this.table.scrollTop<this.bodyGroup.attribute.height&&(t.row=t.row+1,t.bottomFrozen=!0),t)return t}return{col:-1,row:-1}}updateFrozen(){this.clear||(this.resetFrozen(),this.component.updateScrollBar())}updateRowFrozen(){this.clear||(this.resetRowFrozen(),this.component.updateScrollBar())}dealWidthRightFrozen(t){this.clear?this.table.internalProps.rightFrozenColCount=t:function(t,e){const{table:i,proxy:o,rightTopCornerGroup:n,rightFrozenGroup:r,rightBottomCornerGroup:s,bottomFrozenGroup:a,bodyGroup:l,colHeaderGroup:h}=e,d=e.table.rightFrozenColCount;if(t>d){for(let o=i.colCount-d-1;o>=i.colCount-t;o--)mL(r,e.getColGroup(o),r.firstChild),mL(n,e.getColGroup(o,!0),n.firstChild),mL(s,e.getColGroupInBottom(o),s.firstChild);let o=0;r.forEachChildren((t=>{t.setAttribute("x",o),o+=t.attribute.width})),o=0,n.forEachChildren((t=>{t.setAttribute("x",o),o+=t.attribute.width})),o=0,s.forEachChildren((t=>{t.setAttribute("x",o),o+=t.attribute.width}))}else if(t<d){for(let o=i.colCount-d;o<i.colCount-t;o++){const t=e.getColGroup(o);t.setAttribute("x",l.lastChild.attribute.x+i.getColWidth(l.lastChild.col)),l.appendChild(t);const n=e.getColGroupInRightTopCorner(o);n.setAttribute("x",h.lastChild.attribute.x+i.getColWidth(h.lastChild.col)),h.appendChild(n);const r=e.getColGroupInRightBottomCorner(o);r.setAttribute("x",a.lastChild.attribute.x+i.getColWidth(a.lastChild.col)),a.appendChild(r)}let o=0;r.forEachChildren((t=>{t.setAttribute("x",o),o+=t.attribute.width})),o=0,n.forEachChildren((t=>{t.setAttribute("x",o),o+=t.attribute.width})),o=0,s.forEachChildren((t=>{t.setAttribute("x",o),o+=t.attribute.width}))}r.setAttribute("width",i.getColsWidth(i.colCount-t,i.colCount-1)),n.setAttribute("width",i.getColsWidth(i.colCount-t,i.colCount-1)),s.setAttribute("width",i.getColsWidth(i.colCount-t,i.colCount-1)),i.internalProps.rightFrozenColCount=t,e.updateContainer(),e.component.updateScrollBar(),e.updateNextFrame()}(t,this)}dealWidthBottomFrozen(t){this.clear?this.table.internalProps.bottomFrozenRowCount=t:function(t,e){const{table:i,proxy:o,bottomFrozenGroup:n,leftBottomCornerGroup:r,rightBottomCornerGroup:s}=e;n.childrenCount||(o.table.isPivotChart()||(bM(r,0,0,0,i.frozenColCount-1,0,-1,"rowHeader",i),bM(s,0,0,i.colCount-i.rightFrozenColCount,i.colCount-1,0,-1,"body",i)),bM(n,0,0,o.colStart,o.colEnd,0,-1,"body",i));const a=e.table.bottomFrozenRowCount;if(t>a){for(let o=0;o<i.frozenColCount;o++){const n=e.getColGroupInLeftBottomCorner(o);for(let r=i.rowCount-a-1;r>=i.rowCount-t;r--)mL(n,e.getCell(o,r,!0),n.firstChild);let r=0;n.forEachChildren((t=>{t.setAttribute("y",r),r+=i.getRowHeight(t.row)}))}for(let n=o.colStart;n<=o.colEnd;n++){const o=e.getColGroupInBottom(n);for(let r=i.rowCount-a-1;r>=i.rowCount-t;r--)mL(o,e.getCell(n,r,!0),o.firstChild);let r=0;o.forEachChildren((t=>{t.setAttribute("y",r),r+=i.getRowHeight(t.row)}))}if(i.rightFrozenColCount>0)for(let o=i.colCount-i.rightFrozenColCount;o<i.colCount;o++){const n=e.getColGroupInRightBottomCorner(o);for(let r=i.rowCount-a-1;r>=i.rowCount-t;r--)mL(n,e.getCell(o,r,!0),n.firstChild);let r=0;n.forEachChildren((t=>{t.setAttribute("y",r),r+=i.getRowHeight(t.row)}))}}else if(t<a){for(let o=0;o<i.rowHeaderLevelCount;o++){const n=e.getColGroup(o);for(let r=i.rowCount-a;r<i.rowCount-t;r++){const t=e.getCell(o,r,!0);t.setAttribute("y",n.lastChild.attribute.y+i.getRowHeight(n.lastChild.row)),n.appendChild(t)}const r=e.getColGroupInLeftBottomCorner(o);let s=0;r.forEachChildren((t=>{t.setAttribute("y",s),s+=i.getRowHeight(t.row)}))}for(let n=o.colStart;n<=o.colEnd;n++){const o=e.getColGroup(n);for(let r=i.rowCount-a;r<i.rowCount-t;r++){const t=e.getCell(n,r,!0);t.setAttribute("y",o.lastChild.attribute.y+i.getRowHeight(o.lastChild.row)),o.appendChild(t)}const r=e.getColGroupInBottom(n);let s=0;r.forEachChildren((t=>{t.setAttribute("y",s),s+=i.getRowHeight(t.row)}))}if(i.rightFrozenColCount>0)for(let o=i.colCount-i.rightFrozenColCount;o<i.colCount;o++){const n=e.getColGroup(o);for(let r=i.rowCount-a;r<i.rowCount-t;r++){const t=e.getCell(o,r,!0);t.setAttribute("y",n.lastChild.attribute.y+i.getRowHeight(n.lastChild.row)),n.appendChild(t)}const r=e.getColGroupInRightBottomCorner(o);let s=0;r.forEachChildren((t=>{t.setAttribute("y",s),s+=i.getRowHeight(t.row)}))}}n.setAttribute("height",i.getRowsHeight(i.rowCount-t,i.rowCount-1)),r.setAttribute("height",i.getRowsHeight(i.rowCount-t,i.rowCount-1)),s.setAttribute("height",i.getRowsHeight(i.rowCount-t,i.rowCount-1)),i.internalProps.bottomFrozenRowCount=t,e.updateContainer(),e.component.updateScrollBar(),e.updateNextFrame()}(t,this)}updateBorderSizeAndPosition(){this.bodyGroup.border&&(this.bodyGroup.appendChild(this.bodyGroup.border),ak(this.bodyGroup),this.rowHeaderGroup.attribute.width,rk(this.bodyGroup,this.table.theme.bodyStyle.frameStyle)),this.colHeaderGroup.border&&(this.colHeaderGroup.appendChild(this.colHeaderGroup.border),ak(this.colHeaderGroup),this.cornerHeaderGroup.attribute.width,rk(this.colHeaderGroup,this.table.theme.headerStyle.frameStyle)),this.rowHeaderGroup.border&&(this.rowHeaderGroup.appendChild(this.rowHeaderGroup.border),ak(this.rowHeaderGroup)),this.cornerHeaderGroup.border&&(this.cornerHeaderGroup.appendChild(this.cornerHeaderGroup.border),ak(this.cornerHeaderGroup)),this.leftBottomCornerGroup.border&&(this.leftBottomCornerGroup.appendChild(this.leftBottomCornerGroup.border),ak(this.leftBottomCornerGroup)),this.bottomFrozenGroup.border&&(this.bottomFrozenGroup.appendChild(this.bottomFrozenGroup.border),ak(this.bottomFrozenGroup)),this.rightFrozenGroup.border&&(this.rightFrozenGroup.appendChild(this.rightFrozenGroup.border),ak(this.rightFrozenGroup)),this.rightTopCornerGroup.border&&(this.rightTopCornerGroup.appendChild(this.rightTopCornerGroup.border),ak(this.rightTopCornerGroup)),this.rightBottomCornerGroup.border&&(this.rightBottomCornerGroup.appendChild(this.rightBottomCornerGroup.border),ak(this.rightBottomCornerGroup)),function(t){if(!t.theme.frameStyle.cornerRadius)return;const e=t.theme.frameStyle.cornerRadius,{cornerHeaderGroup:i,colHeaderGroup:o,rowHeaderGroup:n,bodyGroup:r,rightTopCornerGroup:s,leftBottomCornerGroup:a,rightBottomCornerGroup:l,rightFrozenGroup:h,bottomFrozenGroup:d}=t.scenegraph;i.setAttribute("cornerRadius",0),o.setAttribute("cornerRadius",0),n.setAttribute("cornerRadius",0),r.setAttribute("cornerRadius",0),s.setAttribute("cornerRadius",0),a.setAttribute("cornerRadius",0),l.setAttribute("cornerRadius",0),h.setAttribute("cornerRadius",0),d.setAttribute("cornerRadius",0);const c=fx(e);i.attribute.width>0&&i.attribute.height>0?lk(i,[c[0],0,0,0]):o.attribute.height>0?lk(o,[c[0],0,0,0]):n.attribute.width>0?lk(n,[c[0],0,0,0]):lk(r,[c[0],0,0,0]),a.attribute.width>0&&a.attribute.height>0?lk(a,[0,0,0,c[3]]):d.attribute.height>0?lk(d,[0,0,0,c[3]]):n.attribute.width>0?lk(n,[0,0,0,c[3]]):lk(r,[0,0,0,c[3]]),s.attribute.width>0&&s.attribute.height>0?lk(s,[0,c[1],0,0]):o.attribute.height>0?lk(o,[0,c[1],0,0]):h.attribute.width>0?lk(h,[0,c[1],0,0]):lk(r,[0,c[1],0,0]),l.attribute.width>0&&l.attribute.height>0?lk(l,[0,0,c[2],0]):h.attribute.width>0?lk(h,[0,0,c[2],0]):d.attribute.height>0?lk(d,[0,0,c[2],0]):lk(r,[0,0,c[2],0])}(this.table)}sortCell(){this.isPivot||(this.table.transpose?this.proxy.sortCellHorizontal():this.proxy.sortCellVertical())}getCellOverflowText(t,e){const i=this.getCell(t,e).getChildByName("text",!0);if(i&&"text"===i.type){if(i.attribute.moreThanMaxCharacters)return this.table.getCellValue(t,e);if(i.cliped)return this.table.getCellValue(t,e)}else if(i&&"richtext"===i.type){const o=i;if(o.attribute.ellipsis&&o._frameCache&&o.attribute.height<o._frameCache.actualHeight)return o.attribute.textConfig.find((t=>t.text)),this.table.getCellValue(t,e)}return null}updateDrill(t,e,i,o,n){this.component.drillIcon.update(t,e,i,o,n,this)}updateCellContent(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.clear)return nT(t,e,this.table,void 0,void 0,i)}setPixelRatio(t){this.stage.disableDirtyBounds(),this.stage.window.setDpr(t),this.stage.render(),this.stage.enableDirtyBounds()}updateRow(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=arguments.length>4?arguments[4]:void 0;this.table.internalProps.layoutMap.clearCellRangeMap(),this.table.internalProps.useOneRowHeightFillAll=!1;const r=Jw(e.map((t=>t.row))).sort(((t,e)=>t-e)),s=Jw(i.map((t=>t.row))).sort(((t,e)=>t-e)),a=this.table.getAllRowsHeight()-[...r,...s].reduce(((t,e)=>t+this.table.getRowHeight(e)),0)<=this.table.tableNoFrameHeight;if(rL(t,e,i,this.table,n),o&&this.recalculateColWidths(),"adaptive"===this.table.heightMode||this.table.autoFillHeight&&(this.table.getAllRowsHeight()<=this.table.tableNoFrameHeight||a))this.table.scenegraph.recalculateRowHeights();else if(this.table.isAutoRowHeight(this.table.columnHeaderLevelCount))for(let t=0;t<s.length;t++){const e=s[t],i=this.table.getRowHeight(e),o=AT(e,0,this.table.colCount-1,this.table);(e>=this.proxy.rowStart&&e<=this.proxy.rowEnd||e>=this.table.rowCount-this.table.bottomFrozenRowCount&&e<=this.table.rowCount-1)&&this.table.scenegraph.updateRowHeight(e,o-i)}this.table.stateManager.checkFrozen(),this.isPivot||this.table.transpose?this.table.options.frozenColCount?this.component.setFrozenColumnShadow(this.table.frozenColCount-1):this.table.options.rightFrozenColCount&&this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount):(this.component.setFrozenColumnShadow(this.table.frozenColCount-1),this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount)),this.component.updateScrollBar(),this.updateNextFrame()}updateCol(t,e){HL(t,e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],this.table),this.recalculateColWidths(),this.recalculateRowHeights(),this.table.stateManager.checkFrozen(),this.isPivot||this.table.transpose?this.table.options.frozenColCount?this.component.setFrozenColumnShadow(this.table.frozenColCount-1):this.table.options.rightFrozenColCount&&this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount):(this.component.setFrozenColumnShadow(this.table.frozenColCount-1),this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount)),this.component.updateScrollBar(),this.updateNextFrame()}updateCornerHeaderCells(){for(let t=0;t<this.table.frozenColCount;t++)for(let e=0;e<this.table.frozenRowCount;e++)nT(t,e,this.table,!1)}updateRowHeaderCells(){for(let t=0;t<this.table.frozenColCount;t++)for(let e=this.table.frozenRowCount;e<this.table.rowCount;e++)nT(t,e,this.table,!1)}updateColumnHeaderCells(){for(let t=0;t<this.table.frozenRowCount;t++)for(let e=this.table.frozenColCount;e<this.table.colCount;e++)nT(e,t,this.table,!1)}getColumnGroupX(t){return t<this.table.rowHeaderLevelCount?this.table.getColsWidth(0,t-1):t<this.table.colCount-this.table.rightFrozenColCount?this.table.getColsWidth(this.table.rowHeaderLevelCount,t-1):t<this.table.colCount?this.table.getColsWidth(this.table.colCount-this.table.bottomFrozenRowCount,t-1):0}getCellGroupY(t){return t<this.table.frozenRowCount?this.table.getRowsHeight(0,t-1):t<this.table.rowCount-this.table.bottomFrozenRowCount?this.table.getRowsHeight(this.table.frozenRowCount,t-1):t<this.table.rowCount?this.table.getRowsHeight(this.table.rowCount-this.table.bottomFrozenRowCount,t-1):0}getCellGroupX(t){return t<this.table.rowHeaderLevelCount?this.table.getColsWidth(0,t-1):t<this.table.colCount-this.table.rightFrozenColCount?this.table.getColsWidth(this.table.rowHeaderLevelCount,t-1):t<this.table.colCount?this.table.getColsWidth(this.table.colCount-this.table.rightFrozenColCount,t-1):0}updateDomContainer(){!function(t){const{headerDomContainer:e,bodyDomContainer:i,frozenBodyDomContainer:o,frozenHeaderDomContainer:n,rightFrozenBodyDomContainer:r,rightFrozenHeaderDomContainer:s,bottomDomContainer:a,frozenBottomDomContainer:l,rightFrozenBottomDomContainer:h}=t.internalProps;if(!(e||i||o||n||r||s||a||l||h))return;const d=t.getAllColsWidth(),c=Math.min(d,t.tableNoFrameWidth),u=t.getFrozenColsWidth(),g=t.getRightFrozenColsWidth(),p=u+g,f=Math.min(d-p,c-p),v=t.getAllRowsHeight(),b=Math.min(v,t.tableNoFrameHeight),m=t.getFrozenRowsHeight(),y=t.getBottomFrozenRowsHeight(),C=m+y,w=Math.min(v-C,b-C);t.frozenColCount>0?(e.style.left=`${t.tableX+u}px`,i.style.left=`${t.tableX+u}px`,a.style.left=`${t.tableX+u}px`):0===t.frozenColCount&&(e.style.left=`${t.tableX}px`,i.style.left=`${t.tableX}px`,a.style.left=`${t.tableX}px`),o.style.left=`${t.tableX}px`,n.style.left=`${t.tableX}px`,e.style.width=`${f}px`,e.style.height=`${m}px`,i.style.top=`${t.tableY}px`,i.style.width=`${f}px`,i.style.height=`${w}px`,i.style.top=`${t.tableY+m}px`,o.style.width=`${u}px`,o.style.height=`${w}px`,o.style.top=`${t.tableY+m}px`,n.style.width=`${u}px`,n.style.height=`${m}px`,n.style.top=`${t.tableY}px`,r.style.width=`${g}px`,r.style.height=`${w}px`,r.style.top=`${t.tableY+m}px`,r.style.left=t.tableX+c-g+"px",s.style.width=`${g}px`,s.style.height=`${m}px`,s.style.top=`${t.tableY}px`,s.style.left=t.tableX+c-g+"px",a.style.width=`${f}px`,a.style.height=`${y}px`,a.style.top=t.tableY+b-y+"px",l.style.width=`${u}px`,l.style.height=`${y}px`,l.style.top=t.tableY+b-y+"px",h.style.width=`${g}px`,h.style.height=`${y}px`,h.style.top=t.tableY+b-y+"px",h.style.left=t.tableX+c-g+"px"}(this.table)}setLoadingHierarchyState(t,e){const i=this.getCell(t,e),o=i.getChildByName("collapse",!0)||i.getChildByName("expand",!0);if(o){const i=LR()[aw.loadingIconName];i&&NR(i,o,t,e)}}temporarilyUpdateSelectRectStyle(t){!function(t,e){const{selectedRangeComponents:i}=e;i.forEach(((e,i)=>{e.rect.setAttributes(t)})),e.updateNextFrame()}(t,this)}resetSelectRectStyle(){this.recreateAllSelectRangeComponents()}}function DL(t,e,i){const o=t.highPerformanceGetCell(e,i);if("cell"===o.role&&ot(o.mergeStartCol)&&ot(o.mergeStartRow)&&ot(o.mergeEndCol)&&ot(o.mergeEndRow)){const{colStart:e,colEnd:i,rowStart:n,rowEnd:r}=LT(o,t);for(let o=e;o<=i;o++)for(let e=n;e<=r;e++){const i=t.highPerformanceGetCell(o,e);"cell"===i.role&&i.addUpdateBoundTag()}}else o.addUpdateBoundTag()}function WL(t,e,i,o,n){const r=t.table;for(let i=0;i<r.columnHeaderLevelCount;i++)DL(t,e,i);const s=t.getColGroup(e);return null==s||s.addUpdateBoundTag(),!0}function NL(t,e,i,o,n,r){const s=t.table;for(let i=0;i<s.columnHeaderLevelCount;i++)DL(t,e,i);const a=t.getColGroup(e);return null==a||a.addUpdateBoundTag(),!0}function GL(t,e,i,o,n){const r=t.table;for(let e=0;e<r.colCount;e++)DL(t,e,i);return!0}function jL(t,e,i,o,n,r){const s=t.table;for(let e=0;e<s.colCount;e++)DL(t,e,i);return!0}function VL(t,e,i){const{table:o}=t,{scenegraph:n}=o,{highlightScope:r,singleStyle:s,disableHeader:a,cellPos:l,cellPosContainHeader:h}=t.hover,d=l.col,c=l.row;if(r===QC.none||a&&(h.col!==e||h.row!==i)){const t=h.col,o=h.row;n.hideHoverIcon(t,o),n.showHoverIcon(e,i),h.col=e,h.row=i}if((a&&o.isHeader(e,i)||r===QC.none)&&(e=-1,i=-1),d===e&&c===i)return;n.deactivateChart(d,c),n.activateChart(e,i);let u=!1;const{ranges:g,highlightScope:p}=t.select;if(-1!==d&&-1!==c&&(u=function(t,e,i,o,n,r,s){let a=!1;return r===QC.single?a=!!function(t,e,i,o,n){return DL(t,e,i),!0}(t,e,i):r===QC.row?a=!!GL(t,0,i):r===QC.column?a=!!WL(t,e):r===QC.cross&&(a=!!GL(t,0,i),a=!!WL(t,e)),a}(n,d,c,0,0,r),a||n.hideHoverIcon(d,c)),-1===e||-1===i)return l.col=-1,l.row=-1,void(!u||d===e&&c===i||t.table.scenegraph.updateNextFrame());r===QC.single?u=!!function(t,e,i,o,n){return DL(t,e,i),!0}(n,e,i):r===QC.row?u=!!jL(n,0,i):r===QC.column?u=!!NL(n,e):r===QC.cross&&(u=!!jL(n,0,i),u=!!NL(n,e)),r===QC.none||a||n.showHoverIcon(e,i),l.col=e,l.row=i,u&&t.table.scenegraph.updateNextFrame()}function UL(t,e,i,o){var n;let r,s=null,a=!1;if(Array.isArray(i.sortState))for(let o=0;o<i.sortState.length&&(r=i.sortState[o],r&&(s=i._getHeaderCellBySortState(r)),s&&(a=$L(t,e,s.col,s.row,i)),!a);o++);else r=i.sortState,r&&(s=i._getHeaderCellBySortState(r)),s&&(a=$L(t,e,s.col,s.row,i));const l=i.getHeaderDefine(t,e);if(r&&a&&(null==l?void 0:l.sort)?r.order="asc"===r.order?"desc":"desc"===r.order?"normal":"asc":(null==l?void 0:l.sort)?r={field:i.getHeaderField(t,e),order:"asc"}:a&&(null==l?void 0:l.showSort)||(r={field:i.getHeaderField(t,e),order:"normal"}),r.event=o,i.fireListeners(Ax.SORT_CLICK,r).includes(!1))return;let h=!1,d=i.internalProps.sortState?Array.isArray(i.internalProps.sortState)&&(h=!0)?i.internalProps.sortState:[i.internalProps.sortState]:[];if(Array.isArray(d)){const t=d.findIndex((t=>t.field===r.field));t>=0?d[t]=r:d.push(r)}d=d.filter((t=>"normal"!==t.order)),d=i.internalProps.multipleSort&&(h=!0)?d:d.splice(-1),d=h&&d.length?d:d[0],i.internalProps.sortState=d,i.stateManager.setSortState(d),(null==l?void 0:l.sort)&&function(t,e,i){t=Array.isArray(t)||!t?t:[t],e.dataSource.sort((t||[]).map((t=>{var i,o;const n=e.internalProps.layoutMap.headerObjects.find((e=>e&&e.field===t.field));return{field:t.field,order:t.order||"asc",orderFn:"function"==typeof(null===(i=null==n?void 0:n.define)||void 0===i?void 0:i.sort)?null===(o=null==n?void 0:n.define)||void 0===o?void 0:o.sort:Zw}})))}(d,i),i.internalProps.useOneRowHeightFillAll=!1,i.internalProps.layoutMap.clearCellRangeMap(),i.scenegraph.sortCell();const c=!!(null===(n=i.stateManager.select.ranges)||void 0===n?void 0:n.length);i.stateManager.updateSelectPos(-1,-1),i.stateManager.endSelectCells(!0,c)}function $L(t,e,i,o,n){return n._getLayoutCellId(t,e)===n._getLayoutCellId(i,o)}const XL=hx(Ax,{PIVOT_SORT_CLICK:"pivot_sort_click",DRILLMENU_CLICK:"drillmenu_click"});function YL(t,e,i,o,n){for(let i=t;i<=e;i++)n._clearColRangeWidthsMap(i);for(let t=i;t<=o;t++)n._clearRowRangeHeightsMap(t)}function KL(t){var e;if(!t)return;const i=(null===(e=t.role)||void 0===e?void 0:e.startsWith("icon"))?t:"richtext"===t.type?t._currentHoverIcon:void 0;return i?"richtext"===t.type?{icon:i,position:{left:t.globalAABBBounds.x1+i.globalAABBBounds.x1,right:t.globalAABBBounds.x1+i.globalAABBBounds.x2,top:t.globalAABBBounds.y1+i.globalAABBBounds.y1,bottom:t.globalAABBBounds.y1+i.globalAABBBounds.y2,width:i.globalAABBBounds.x2-i.globalAABBBounds.x1,height:i.globalAABBBounds.y2-i.globalAABBBounds.y1},type:"richtext-icon"}:{icon:i,position:{left:i.globalAABBBounds.x1,right:i.globalAABBBounds.x2,top:i.globalAABBBounds.y1,bottom:i.globalAABBBounds.y2,width:i.globalAABBBounds.x2-i.globalAABBBounds.x1,height:i.globalAABBBounds.y2-i.globalAABBBounds.y1},type:"icon"}:void 0}function qL(t,e){"adaptive"===e.table.widthMode&&e.columnResize.col<e.table.colCount-1?(e.table.scenegraph.updateColWidth(e.columnResize.col,t),e.table.scenegraph.updateColWidth(e.columnResize.col+1,-t),e.table.internalProps._widthResizedColMap.add(e.columnResize.col),e.table.internalProps._widthResizedColMap.add(e.columnResize.col+1)):(e.table.scenegraph.updateColWidth(e.columnResize.col,t),e.table.internalProps._widthResizedColMap.add(e.columnResize.col))}function ZL(t,e,i,o,n){const r=n.table.getRecordShowIndexByCell(t,e);if(r>=0){const t=n.table.dataSource.getIndexKey(r).toString();n.checkedState.get(t)?n.checkedState.get(t)[i]=o:n.checkedState.set(t,{[i]:o})}}function JL(t,e){e.checkedState.clear(),e.headerCheckedState={},e.radioState={};let i=!1;if(e._checkboxCellTypeFields=[],e._headerCheckFuncs={},e.table.internalProps.layoutMap.headerObjects.forEach(((t,o)=>{if("checkbox"===t.headerType){const o=t.define.checked;null==o||"function"==typeof o?(i=!0,"function"==typeof o&&(e._headerCheckFuncs[t.field]=o)):e.headerCheckedState[t.field]=o,"checkbox"!==t.define.cellType&&!et(t.define.cellType)||t.fieldFormat||e._checkboxCellTypeFields.push(t.field)}})),1===e.table.leftRowSeriesNumberCount)e.headerCheckedState._vtable_rowSeries_number=!1,e._checkboxCellTypeFields.push("_vtable_rowSeries_number"),i=!0;else if(e.table.leftRowSeriesNumberCount>1){for(let t=0;t<e.table.leftRowSeriesNumberCount;t++)e.headerCheckedState[`_vtable_rowSeries_number_${t}`]=!1,e._checkboxCellTypeFields.push(`_vtable_rowSeries_number_${t}`);i=!0}i&&function(t,e){const i=e.table,o=i.isPivotTable()?0:i.internalProps.transpose?i.rowHeaderLevelCount:i.columnHeaderLevelCount,n=i.isPivotTable()?ht(t)?t.length:0:i.internalProps.transpose?i.colCount:i.rowCount;for(let r=0;r+o<n;r++){const o=i.isPivotTable()?t[r]:i.dataSource.get(r);e._checkboxCellTypeFields.forEach((t=>{const n=o&&o[t];let s;if(nt(n)?s=n.checked:"boolean"==typeof n&&(s=n),null==s){const i=e._headerCheckFuncs[t];if(i){const o=e.table.getCellAddrByFieldRecord(t,r);s=ux(i,{col:o.col,row:o.row,table:e.table,context:null,value:n})}}const a=i.isPivotTable()?r.toString():e.table.dataSource.getIndexKey(r).toString();e.checkedState.get(a)||e.checkedState.set(a,{}),e.checkedState.get(a)[t]=s}))}}(t,e)}function QL(t,e,i,o){const n=o.scenegraph.getCell(t,e),r=null==n?void 0:n.getChildByName("checkbox");r&&("indeterminate"===i?(r.setAttribute("indeterminate",!0),r.setAttribute("checked",void 0)):(r.setAttribute("indeterminate",void 0),r.setAttribute("checked",i)))}function tP(t,e){"adaptive"===e.table.heightMode&&e.rowResize.row<e.table.rowCount-1?(e.table.scenegraph.updateRowHeight(e.rowResize.row,t),e.table.scenegraph.updateRowHeight(e.rowResize.row+1,-t),e.table.internalProps._heightResizedRowMap.add(e.rowResize.row),e.table.internalProps._heightResizedRowMap.add(e.rowResize.row+1)):(e.table.scenegraph.updateRowHeight(e.rowResize.row,t),e.table.internalProps._heightResizedRowMap.add(e.rowResize.row))}hx(Ax,{VCHART_EVENT_TYPE:"vchart_event_type"});function eP(t){if(t.eventManager.bindSparklineHoverEvent)return;let e=!1;e=t.isPivotTable()?t.internalProps.layoutMap.indicatorsDefine.some((t=>"string"!=typeof t&&"sparkline"===t.cellType)):t.internalProps.layoutMap.columnObjects.some((t=>"sparkline"===t.cellType||"function"==typeof t.cellType)),e&&(t.eventManager.bindSparklineHoverEvent=!0,t.on(Ax.MOUSEMOVE_CELL,(e=>{const{col:i,row:o,x:n,y:r}=e;"sparkline"!==t.getBodyColumnType(i,o)&&t.stateManager.updateSparklineHoverPose(-1,-1,0,0),t.stateManager.updateSparklineHoverPose(i,o,n,r)})),t.on(Ax.MOUSELEAVE_TABLE,(e=>{t.stateManager.updateSparklineHoverPose(-1,-1,0,0)})))}function iP(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var o;let{deltaX:n,deltaY:r}=t;t.shiftKey&&t.deltaY&&(n=r,r=0);const[s,a]=function(t,e,i){var o,n;const r=Math.abs(t/e),s=r<=.5?0:t,a=r>2?0:e;return[Math.ceil(s*(null!==(o=i.horizontal)&&void 0!==o?o:0)),Math.ceil(a*(null!==(n=i.vertical)&&void 0!==n?n:0))]}(n,r,{horizontal:1,vertical:1});(s||a)&&e.interactionState!==JC.scrolling&&e.updateInteractionState(JC.scrolling),s&&(e.setScrollLeft(e.scroll.horizontalBarPos+s,t),e.showHorizontalScrollBar(!0)),a&&(e.setScrollTop(e.scroll.verticalBarPos+a,t),e.showVerticalScrollBar(!0)),i&&e.resetInteractionState(e.interactionStateBeforeScroll),(null===(o=t.nativeEvent)||void 0===o?void 0:o.cancelable)&&("none"===e.table.internalProps.overscrollBehavior||Math.abs(r)>=Math.abs(n)&&0!==r&&oP(r,e)||Math.abs(r)<=Math.abs(n)&&0!==n&&nP(n,e))&&t.nativeEvent.preventDefault()}function oP(t,e){return 0!=e.table.getAllRowsHeight()-e.table.scenegraph.height&&!function(t,e){return 0!=e.table.getAllRowsHeight()-e.table.scenegraph.height&&t<=0&&e.scroll.verticalBarPos<1}(t,e)&&!function(t,e){var i;const o=(null===(i=e.table.options.customConfig)||void 0===i?void 0:i._disableColumnAndRowSizeRound)?1:0,n=e.table.getAllRowsHeight()-e.table.scenegraph.height;return 0!==n&&t>=0&&Math.abs(e.scroll.verticalBarPos-n)<1+o}(t,e)}function nP(t,e){return 0!=e.table.getAllColsWidth()-e.table.scenegraph.width&&!function(t,e){return 0!=e.table.getAllColsWidth()-e.table.scenegraph.width&&t<=0&&e.scroll.horizontalBarPos<1}(t,e)&&!function(t,e){var i;const o=(null===(i=e.table.options.customConfig)||void 0===i?void 0:i._disableColumnAndRowSizeRound)?1:0,n=e.table.getAllColsWidth()-e.table.scenegraph.width;return 0!==n&&t>=0&&Math.abs(e.scroll.horizontalBarPos-n)<1+o}(t,e)}class rP{constructor(t){this.stateManager=t}setScrollHandle(t){this.scrollHandle=t}startInertia(t,e,i){this.lastTime=Date.now(),this.speedX=t,this.speedY=e,this.friction=i,this.runingId||(this.runingId=requestAnimationFrame(this.inertia.bind(this)))}inertia(){var t;const e=Date.now(),i=e-this.lastTime;let o=!0;const n=Math.pow(this.friction,i/16),r=n*this.speedX,s=n*this.speedY;let a=0,l=0;Math.abs(r)>.05&&(o=!1,a=(this.speedX+r)/2*i),Math.abs(s)>.05&&(o=!1,l=(this.speedY+s)/2*i),null===(t=this.scrollHandle)||void 0===t||t.call(this,a,l),o?this.runingId=null:(this.lastTime=e,this.speedX=r,this.speedY=s,this.runingId=requestAnimationFrame(this.inertia.bind(this)))}endInertia(){cancelAnimationFrame(this.runingId),this.runingId=null}isInertiaScrolling(){return!!this.runingId}}function sP(t,e,i){var o,n,r,s;e&&-1!==(null===(o=t.stateManager.columnMove)||void 0===o?void 0:o.colSource)&&-1!==(null===(n=t.stateManager.columnMove)||void 0===n?void 0:n.rowSource)&&-1!==(null===(r=t.stateManager.columnMove)||void 0===r?void 0:r.colTarget)&&-1!==(null===(s=t.stateManager.columnMove)||void 0===s?void 0:s.rowTarget)?t.hasListeners(Ax.CHANGE_HEADER_POSITION)&&t.fireListeners(Ax.CHANGE_HEADER_POSITION,{target:{col:t.stateManager.columnMove.colTarget,row:t.stateManager.columnMove.rowTarget},source:{col:t.stateManager.columnMove.colSource,row:t.stateManager.columnMove.rowSource},event:i}):e||t.hasListeners(Ax.CHANGE_HEADER_POSITION_FAIL)&&t.fireListeners(Ax.CHANGE_HEADER_POSITION_FAIL,{target:{col:t.stateManager.columnMove.colTarget,row:t.stateManager.columnMove.rowTarget},source:{col:t.stateManager.columnMove.colSource,row:t.stateManager.columnMove.rowSource},event:i})}function aP(t){const e=t.table,i=e.stateManager;e.scenegraph.tableGroup.addEventListener("pointermove",(o=>{var n,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x;const _=null!==(r=null===(n=e.eventManager.LastPointerXY)||void 0===n?void 0:n.x)&&void 0!==r?r:o.x,S=null!==(a=null===(s=e.eventManager.LastPointerXY)||void 0===s?void 0:s.y)&&void 0!==a?a:o.y;e.eventManager.LastPointerXY={x:o.x,y:o.y},t.touchSetTimeout&&(clearTimeout(t.touchSetTimeout),t.touchSetTimeout=void 0);const A=VB(o);if(A.eventArgs&&e.hasListeners(Ax.MOUSEMOVE_TABLE)&&e.fireListeners(Ax.MOUSEMOVE_TABLE,{col:A.eventArgs.col,row:A.eventArgs.row,x:A.abstractPos.x,y:A.abstractPos.y,event:o.nativeEvent,target:null===(l=null==A?void 0:A.eventArgs)||void 0===l?void 0:l.target,mergeCellInfo:null===(h=A.eventArgs)||void 0===h?void 0:h.mergeInfo}),i.interactionState===JC.grabing&&!(null===(d=e.editorManager)||void 0===d?void 0:d.editingEditor))return void(Math.abs(_-o.x)+Math.abs(S-o.y)>=1&&(i.isResizeCol()||i.isResizeRow()||(i.isMoveCol()?t.dealColumnMover(A):i.isFillHandle()?t.dealFillSelect(A,!0):(null===(c=e.options.select)||void 0===c?void 0:c.disableDragSelect)||t.dealTableSelect(A,!0))));!(null===(u=e.options.select)||void 0===u?void 0:u.disableDragSelect)&&e.eventManager.isDraging&&i.isSelecting()&&!(null===(g=e.editorManager)||void 0===g?void 0:g.editingEditor)&&t.dealTableSelect(A,!0);const B=o.path.find((t=>"cell"===t.role));if(e.hasListeners(Ax.MOUSELEAVE_CELL)&&(-1===e.stateManager.hover.cellPos.col||-1===e.stateManager.hover.cellPos.row||(null==B?void 0:B.col)===e.stateManager.hover.cellPos.col&&(null==B?void 0:B.row)===e.stateManager.hover.cellPos.row||e.fireListeners(Ax.MOUSELEAVE_CELL,{col:e.stateManager.hover.cellPos.col,row:e.stateManager.hover.cellPos.row,cellRange:e.getCellRangeRelativeRect({col:e.stateManager.hover.cellPos.col,row:e.stateManager.hover.cellPos.row}),scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,event:o.nativeEvent,target:null===(p=null==A?void 0:A.eventArgs)||void 0===p?void 0:p.target})),e.hasListeners(Ax.MOUSEENTER_CELL)&&("cell"!==(null==B?void 0:B.role)||!ot(B.col)||!ot(B.row)||B.col===e.stateManager.hover.cellPos.col&&B.row===e.stateManager.hover.cellPos.row||B.col===(null===(f=e.stateManager.hover.cellPosContainHeader)||void 0===f?void 0:f.col)&&B.row===(null===(v=e.stateManager.hover.cellPosContainHeader)||void 0===v?void 0:v.row)||e.fireListeners(Ax.MOUSEENTER_CELL,{col:B.col,row:B.row,cellRange:e.getCellRangeRelativeRect({col:B.col,row:B.row}),scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,event:o.nativeEvent,target:null===(b=null==A?void 0:A.eventArgs)||void 0===b?void 0:b.target,mergeCellInfo:null===(m=A.eventArgs)||void 0===m?void 0:m.mergeInfo})),t.dealIconHover(A),t.dealTableHover(A),e.theme.columnResize.visibleOnHover&&t.checkColumnResize(A,!0),A.eventArgs&&e.hasListeners(Ax.MOUSEMOVE_CELL)){let t,i;if(null===(y=A.eventArgs)||void 0===y?void 0:y.target){const e=KL(null===(C=A.eventArgs)||void 0===C?void 0:C.target);e&&(t=e.icon,i=e.position)}e.fireListeners(Ax.MOUSEMOVE_CELL,{col:A.eventArgs.col,row:A.eventArgs.row,x:A.abstractPos.x,y:A.abstractPos.y,event:o.nativeEvent,targetIcon:t?{name:t.name,position:i,funcType:t.attribute.funcType}:void 0,target:null===(w=null==A?void 0:A.eventArgs)||void 0===w?void 0:w.target,mergeCellInfo:null===(x=A.eventArgs)||void 0===x?void 0:x.mergeInfo})}})),e.scenegraph.tableGroup.addEventListener("pointerout",(e=>{var i;const o=VB(e),n=null===(i=null==o?void 0:o.eventArgs)||void 0===i?void 0:i.target;"table"===(null==n?void 0:n.role)&&t.dealTableHover()})),e.scenegraph.tableGroup.addEventListener("pointerover",(t=>{var i,o;const n=VB(t),r=null===(i=null==n?void 0:n.eventArgs)||void 0===i?void 0:i.target;if(r&&e.hasListeners(Ax.MOUSEOVER_CHART_SYMBOL)&&"symbol"===r.type){const i=t.composedPath().find((t=>"cell"===t.roll));if(i){const{col:r,row:s}=i,a={col:r,row:s,field:e.getHeaderField(r,s),value:e.getCellValue(r,s),dataValue:e.getCellOriginValue(r,s),cellHeaderPaths:e.internalProps.layoutMap.getCellHeaderPaths(r,s),title:e.getBodyColumnDefine(r,s).title,cellRange:e.getCellRelativeRect(r,s),event:t.nativeEvent,sparkline:{pointData:void 0},scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,target:null===(o=null==n?void 0:n.eventArgs)||void 0===o?void 0:o.target};e.fireListeners(Ax.MOUSEOVER_CHART_SYMBOL,a)}}})),e.scenegraph.tableGroup.addEventListener("pointerenter",(t=>{(e.theme.scrollStyle.horizontalVisible&&"focus"===e.theme.scrollStyle.horizontalVisible||!e.theme.scrollStyle.horizontalVisible&&"focus"===e.theme.scrollStyle.visible)&&i.showHorizontalScrollBar(),(e.theme.scrollStyle.verticalVisible&&"focus"===e.theme.scrollStyle.verticalVisible||!e.theme.scrollStyle.verticalVisible&&"focus"===e.theme.scrollStyle.visible)&&i.showVerticalScrollBar(),e.hasListeners(Ax.MOUSEENTER_TABLE)&&e.fireListeners(Ax.MOUSEENTER_TABLE,{event:t.nativeEvent})})),e.scenegraph.tableGroup.addEventListener("pointerleave",(o=>{i.isResizeCol()||i.isResizeRow()||i.isMoveCol()||i.isSelecting()||(i.updateInteractionState(JC.default),i.updateCursor()),(e.theme.scrollStyle.horizontalVisible&&"focus"===e.theme.scrollStyle.horizontalVisible||!e.theme.scrollStyle.horizontalVisible&&"focus"===e.theme.scrollStyle.visible)&&i.hideHorizontalScrollBar(),(e.theme.scrollStyle.verticalVisible&&"focus"===e.theme.scrollStyle.verticalVisible||!e.theme.scrollStyle.verticalVisible&&"focus"===e.theme.scrollStyle.visible)&&i.hideVerticalScrollBar(),e.hasListeners(Ax.MOUSELEAVE_CELL)&&-1!==e.stateManager.hover.cellPos.col&&-1!==e.stateManager.hover.cellPos.row&&e.fireListeners(Ax.MOUSELEAVE_CELL,{col:e.stateManager.hover.cellPos.col,row:e.stateManager.hover.cellPos.row,cellRange:e.getCellRangeRelativeRect({col:e.stateManager.hover.cellPos.col,row:e.stateManager.hover.cellPos.row}),scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,event:o.nativeEvent,target:void 0}),t.dealTableHover();const n=o.target;n&&!n.isDescendantsOf(e.scenegraph.tableGroup)&&e.fireListeners(Ax.MOUSELEAVE_TABLE,{event:o.nativeEvent})}));const o=o=>{var n;const r=o.target;if(!e.getElement().contains(r)){px(null===(n=e.editorManager)||void 0===n?void 0:n.completeEdit(o),(e=>{!1!==e&&(i.updateInteractionState(JC.default),t.dealTableHover())}))}},n=o=>{var n;const r=o.target;if(!e.getElement().contains(r)&&!e.internalProps.menuHandler.containElement(r)){px(null===(n=e.editorManager)||void 0===n?void 0:n.completeEdit(o),(o=>{var n,r;if(!1!==o&&(null===(n=e.options.select)||void 0===n?void 0:n.outsideClickDeselect)){const e=!!(null===(r=i.select.ranges)||void 0===r?void 0:r.length);t.dealTableSelect(),i.endSelectCells(!0,e)}}))}};t.globalEventListeners.push({name:"pointerup",env:"document",callback:o}),t.globalEventListeners.push({name:"pointerdown",env:"document",callback:n}),fu.addEventListener("pointerup",o),fu.addEventListener("pointerdown",n),e.scenegraph.tableGroup.addEventListener("pointerdown",(o=>{var n,r,s,a,l;if(e.hasListeners(Ax.MOUSEDOWN_TABLE)&&e.fireListeners(Ax.MOUSEDOWN_TABLE,{event:o.nativeEvent}),e.eventManager.isDown=!0,e.eventManager.LastBodyPointerXY={x:o.x,y:o.y},e.eventManager.LastPointerXY={x:o.x,y:o.y},0!==o.button)return;const h=VB(o);if(t.downIcon=void 0,i.interactionState!==JC.default)return;if(e.isPivotChart()&&"chart"!==(null===(n=null==h?void 0:h.eventArgs)||void 0===n?void 0:n.target.type)&&e.scenegraph.updateChartState(null),(null===(r=h.eventArgs)||void 0===r?void 0:r.target)!==(null===(s=i.residentHoverIcon)||void 0===s?void 0:s.icon)&&i.hideMenu(),"chart"===(null===(a=null==h?void 0:h.eventArgs)||void 0===a?void 0:a.target.type))return;px(null===(l=e.editorManager)||void 0===l?void 0:l.completeEdit(o.nativeEvent),(n=>{var r,s,a,l,d,c,u,g,p,f,v;if(!1===n)return;const b=(null===(a=null===(s=null===(r=null==h?void 0:h.eventArgs)||void 0===r?void 0:r.target)||void 0===s?void 0:s.role)||void 0===a?void 0:a.startsWith("icon"))?h.eventArgs.target:(null===(l=o.target.role)||void 0===l?void 0:l.startsWith("icon"))?o.target:void 0;if(t.downIcon=b,b&&!1!==b.attribute.interactive)b.attribute.funcType===sw.dragReorder&&(i.startMoveCol(h.eventArgs.col,h.eventArgs.row,h.abstractPos.x,h.abstractPos.y,null===(f=null===(p=h.eventArgs)||void 0===p?void 0:p.event)||void 0===f?void 0:f.nativeEvent),i.updateInteractionState(JC.grabing));else{if(t.cellIsHeaderCheck(h))return;if("touch"===o.pointerType){if(t.touchEnd=!1,t.touchSetTimeout=setTimeout((()=>{t.isTouchdown=!1,t.touchMove=!0,(!t.touchEnd&&(t.checkColumnResize(h,!0)||t.checkRowResize(h,!0))||!t.touchEnd&&t.checkColumnMover(h)||t.dealTableSelect(h)&&!t.touchEnd)&&i.updateInteractionState(JC.grabing)}),500),e.hasListeners(Ax.MOUSEENTER_CELL)){const t=o.path.find((t=>"cell"===t.role));"cell"!==(null==t?void 0:t.role)||!ot(t.col)||!ot(t.row)||t.col===e.stateManager.hover.cellPos.col&&t.row===e.stateManager.hover.cellPos.row||t.col===(null===(d=e.stateManager.hover.cellPosContainHeader)||void 0===d?void 0:d.col)&&t.row===(null===(c=e.stateManager.hover.cellPosContainHeader)||void 0===c?void 0:c.row)||e.fireListeners(Ax.MOUSEENTER_CELL,{col:t.col,row:t.row,cellRange:e.getCellRangeRelativeRect({col:t.col,row:t.row}),scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,event:o.nativeEvent,target:null===(u=null==h?void 0:h.eventArgs)||void 0===u?void 0:u.target,mergeCellInfo:null===(g=h.eventArgs)||void 0===g?void 0:g.mergeInfo})}t.dealTableHover(h)}else{if(!t.checkCellFillhandle(h)&&(t.checkColumnResize(h,!0)||t.checkRowResize(h,!0)))return e.scenegraph.updateChartState(null),void i.updateInteractionState(JC.grabing);if(t.checkColumnMover(h))return void i.updateInteractionState(JC.grabing);if(t.checkCellFillhandle(h,!0)&&t.dealFillSelect(h))return void i.updateInteractionState(JC.grabing);t.dealTableSelect(h)&&i.updateInteractionState(JC.grabing)}}if(e.hasListeners(Ax.MOUSEDOWN_CELL)){const t=VB(o);t.eventArgs&&e.fireListeners(Ax.MOUSEDOWN_CELL,{col:t.eventArgs.col,row:t.eventArgs.row,event:o.nativeEvent,target:null===(v=null==t?void 0:t.eventArgs)||void 0===v?void 0:v.target,mergeCellInfo:t.eventArgs.mergeInfo})}}))})),e.scenegraph.tableGroup.addEventListener("pointerup",(t=>{var o,n,r,s;if(0===t.button){if("grabing"===i.interactionState){if(i.updateInteractionState(JC.default),i.isResizeCol())hP(e);else if(i.isResizeRow())dP(e);else if(i.isMoveCol()){const i=e.stateManager.endMoveCol();sP(e,i,t.nativeEvent)}else if(i.isSelecting()){e.stateManager.endSelectCells(),e.stateManager.isFillHandle()&&e.stateManager.endFillSelect();const i=VB(t);if(e.eventManager.isDraging&&i.eventArgs&&e.hasListeners(Ax.DRAG_SELECT_END)){const r={event:t.nativeEvent,cells:[],col:i.eventArgs.target.col,row:i.eventArgs.target.row,scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,target:null===(o=null==i?void 0:i.eventArgs)||void 0===o?void 0:o.target,mergeCellInfo:null===(n=i.eventArgs)||void 0===n?void 0:n.mergeInfo};r.cells=e.getSelectedCellInfos(),e.fireListeners(Ax.DRAG_SELECT_END,r)}}}else i.interactionState===JC.scrolling&&i.updateInteractionState(JC.default);if(e.hasListeners(Ax.MOUSEUP_CELL)){const i=VB(t);i.eventArgs&&e.fireListeners(Ax.MOUSEUP_CELL,{col:i.eventArgs.col,row:i.eventArgs.row,event:t.nativeEvent,target:null===(r=null==i?void 0:i.eventArgs)||void 0===r?void 0:r.target,mergeCellInfo:null===(s=i.eventArgs)||void 0===s?void 0:s.mergeInfo})}}})),e.scenegraph.tableGroup.addEventListener("rightdown",(t=>{var o,n,r,s;const a=VB(t);if(a.eventArgs){i.triggerContextMenu(a.eventArgs.col,a.eventArgs.row,a.abstractPos.x,a.abstractPos.y);const{col:l,row:h}=a.eventArgs;if(e.hasListeners(Ax.CONTEXTMENU_CELL)){const i=e.getCellInfo(l,h);let d,c;if(null===(o=a.eventArgs)||void 0===o?void 0:o.target){const t=KL(null===(n=a.eventArgs)||void 0===n?void 0:n.target);t&&(d=t.icon,c=t.position)}const u=Object.assign(Object.assign({},i),{event:t.nativeEvent,cells:[],targetIcon:d?{name:d.name,position:c,funcType:d.attribute.funcType}:void 0,target:null===(r=null==a?void 0:a.eventArgs)||void 0===r?void 0:r.target,mergeCellInfo:null===(s=a.eventArgs)||void 0===s?void 0:s.mergeInfo});!function(t,e,i){for(let o=0;o<t.length;o++){const n=t[o],r=Math.min(n.start.col,n.end.col),s=Math.max(n.start.col,n.end.col),a=Math.min(n.start.row,n.end.row),l=Math.max(n.start.row,n.end.row);if(r<=e&&e<=s&&a<=i&&i<=l||s<=e&&e<=r&&l<=i&&i<=a)return!0}return!1}(e.stateManager.select.ranges,l,h)?u.cells=[[i]]:u.cells=e.getSelectedCellInfos(),e.fireListeners(Ax.CONTEXTMENU_CELL,u)}}})),e.scenegraph.tableGroup.addEventListener("pointertap",(o=>{var n,r,s,a,l;if(e.stateManager.columnResize.resizing)return;const h=VB(o);if(!t.touchMove&&0===o.button&&h.eventArgs&&e.hasListeners(Ax.CLICK_CELL)){const{col:t,row:i}=h.eventArgs,l=e.getCellInfo(t,i);let d,c;if(null===(n=h.eventArgs)||void 0===n?void 0:n.target){const t=KL(null===(r=h.eventArgs)||void 0===r?void 0:r.target);t&&(d=t.icon,c=t.position)}const u=Object.assign(Object.assign({},l),{event:o.nativeEvent,federatedEvent:o,cells:[],targetIcon:d?{name:d.name,position:c,funcType:d.attribute.funcType}:void 0,target:null===(s=null==h?void 0:h.eventArgs)||void 0===s?void 0:s.target,mergeCellInfo:null===(a=h.eventArgs)||void 0===a?void 0:a.mergeInfo});e.fireListeners(Ax.CLICK_CELL,u)}if(!e.stateManager.columnResize.resizing&&!e.stateManager.columnMove.moving&&(t.dealIconClick(o,h),(null==h?void 0:h.eventArgs)&&t.touchSetTimeout&&"touch"===o.pointerType)){const e=VB(o);if(t.touchSetTimeout){clearTimeout(t.touchSetTimeout);const o=!!(null===(l=i.select.ranges)||void 0===l?void 0:l.length);t.dealTableSelect(e),i.endSelectCells(!0,o),t.touchSetTimeout=void 0}}})),e.scenegraph.stage.addEventListener("pointerdown",(o=>{var n,r,s,a;const l=VB(o);(null===(n=l.eventArgs)||void 0===n?void 0:n.target)&&(null===(r=l.eventArgs)||void 0===r?void 0:r.target)===(null===(s=i.residentHoverIcon)||void 0===s?void 0:s.icon)||i.hideMenu();px(null===(a=e.editorManager)||void 0===a?void 0:a.completeEdit(o.nativeEvent),(n=>{var r;if(!1===n)return;const s=(null===(r=o.target.role)||void 0===r?void 0:r.startsWith("icon"))?o.target:void 0;if(t.downIcon=s,"touch"===o.pointerType||s||t.checkCellFillhandle(l)||i.columnResize.resizing||!t.checkColumnResize(l,!0));else{e.scenegraph.updateChartState(null),i.updateInteractionState(JC.grabing);const{eventArgs:t}=l;(null==t?void 0:t.targetCell)||e.getCellAt(l.abstractPos.x-e.theme.columnResize.resizeHotSpotSize/2,l.abstractPos.y)&&e.hasListeners(Ax.MOUSEDOWN_TABLE)&&e.fireListeners(Ax.MOUSEDOWN_TABLE,{event:o.nativeEvent})}}))})),e.scenegraph.stage.addEventListener("pointerup",(t=>{"grabing"===i.interactionState&&(i.updateInteractionState(JC.default),i.isResizeCol()?hP(e):i.isResizeRow()&&dP(e))})),e.scenegraph.stage.addEventListener("pointertap",(o=>{var n,r,s;const a=o.target;if(e.eventManager.isDraging||!a||!a.isDescendantsOf(e.scenegraph.stage)&&a.stage!==a||a.isDescendantsOf(e.scenegraph.tableGroup))e.eventManager.isDraging&&i.isSelecting()&&i.endSelectCells();else{i.updateInteractionState(JC.default),t.dealTableHover();const o=!!(null===(n=i.select.ranges)||void 0===n?void 0:n.length);(null===(s=null===(r=e.options.select)||void 0===r?void 0:r.blankAreaClickDeselect)||void 0===s||s)&&t.dealTableSelect(),i.endSelectCells(!0,o),i.updateCursor(),e.scenegraph.updateChartState(null)}})),e.scenegraph.stage.addEventListener("pointermove",(o=>{const n=VB(o);i.isResizeCol()||t.checkColumnResize(n)?e.stateManager.select&&t.checkCellFillhandle(n)?i.updateCursor("crosshair"):i.updateCursor("col-resize"):i.isResizeRow()||t.checkRowResize(n)?e.stateManager.select&&t.checkCellFillhandle(n)?i.updateCursor("crosshair"):i.updateCursor("row-resize"):i.isMoveCol()||i.updateCursor()})),e.scenegraph.tableGroup.addEventListener("checkbox_state_change",(t=>{var i,o;const n=VB(t),{col:r,row:s}=n.eventArgs,a=e.getCellInfo(r,s),l=s_(e,r,s);if(l)for(let i=l.start.col;i<=l.end.col;i++)for(let o=l.start.row;o<=l.end.row;o++)e.scenegraph.getCell(i,o).forEachChildren((e=>{"checkbox"===e.name&&e.setAttributes({checked:t.target.attribute.checked,indeterminate:t.target.attribute.indeterminate})}));const h=Object.assign(Object.assign({},a),{event:t.nativeEvent,target:null===(i=null==n?void 0:n.eventArgs)||void 0===i?void 0:i.target,mergeCellInfo:null===(o=null==n?void 0:n.eventArgs)||void 0===o?void 0:o.mergeInfo,checked:t.detail.checked});if(e.isHeader(r,s))e.stateManager.setHeaderCheckedState(a.field,t.detail.checked),"checkbox"===e.getCellType(r,s)&&e.scenegraph.updateCheckboxCellState(r,s,t.detail.checked);else if(e.stateManager.setCheckedState(r,s,a.field,t.detail.checked),"checkbox"===e.getCellType(r,s)){const t=e.stateManager.headerCheckedState[a.field],i=e.stateManager.updateHeaderCheckedState(a.field,r,s);t!==i&&e.scenegraph.updateHeaderCheckboxCellState(r,s,i)}e.fireListeners(Ax.CHECKBOX_STATE_CHANGE,h),e.scenegraph.updateNextFrame()})),e.scenegraph.tableGroup.addEventListener("radio_checked",(t=>{var i,o,n;const r=VB(t),{col:s,row:a,target:l}=r.eventArgs,h=e.getCellInfo(s,a),d=null===(i=XB.exec(l.id))||void 0===i?void 0:i[1],c=s_(e,s,a);if(c)for(let t=c.start.col;t<=c.end.col;t++)for(let i=c.start.row;i<=c.end.row;i++)e.scenegraph.getCell(t,i).forEachChildren((t=>{"radio"===t.name&&t.id===l.id&&t.setAttributes({checked:!0})}));const u=e.getBodyColumnDefine(s,a).radioCheckType||"column";if("cell"===u)if(c)for(let t=c.start.col;t<=c.end.col;t++)for(let i=c.start.row;i<=c.end.row;i++)e.scenegraph.getCell(t,i).forEachChildren((t=>{"radio"===t.name&&t.id!==l.id&&t.setAttributes({checked:!1})}));else e.scenegraph.getCell(s,a).forEachChildren((t=>{"radio"===t.name&&t.id!==l.id&&t.setAttributes({checked:!1})}));else"column"===u&&e.scenegraph.getColGroup(s).forEachChildren((t=>{t.forEachChildren((t=>{"radio"===t.name&&t.id!==l.id&&t.setAttributes({checked:!1})}))}));const g=d?Number(d):void 0;e.stateManager.setRadioState(s,a,h.field,u,g);const p=Object.assign(Object.assign({},h),{event:t.nativeEvent,target:null===(o=null==r?void 0:r.eventArgs)||void 0===o?void 0:o.target,mergeCellInfo:null===(n=null==r?void 0:r.eventArgs)||void 0===n?void 0:n.mergeInfo,radioIndexInCell:g});e.fireListeners(Ax.RADIO_STATE_CHANGE,p),e.scenegraph.updateNextFrame()})),e.scenegraph.tableGroup.addEventListener("switch_state_change",(t=>{var i,o;const n=VB(t),{col:r,row:s,target:a}=n.eventArgs,l=e.getCellInfo(r,s),h=s_(e,r,s);if(h)for(let i=h.start.col;i<=h.end.col;i++)for(let o=h.start.row;o<=h.end.row;o++)e.scenegraph.getCell(i,o).forEachChildren((e=>{"switch"===e.name&&e.setAttributes({checked:t.target.attribute.checked})}));const d=Object.assign(Object.assign({},l),{event:t.nativeEvent,target:null===(i=null==n?void 0:n.eventArgs)||void 0===i?void 0:i.target,mergeCellInfo:null===(o=null==n?void 0:n.eventArgs)||void 0===o?void 0:o.mergeInfo,checked:t.detail.checked});e.stateManager.setCheckedState(r,s,l.field,t.detail.checked),e.fireListeners(Ax.SWITCH_STATE_CHANGE,d),e.scenegraph.updateNextFrame()})),e.scenegraph.stage.addEventListener("wheel",(t=>{var o;t.path.find((t=>"legend"===t.name))||(null===(o=e.editorManager)||void 0===o||o.completeEdit(),e.eventManager._enableTableScroll&&iP(t,i))}))}function lP(t){const e=t.table;t.gesture=new Vg(e.scenegraph.tableGroup,{tap:{interval:300}}),t.gesture.on("doubletap",(t=>{!function(t,e){var i,o,n,r,s,a;const l=VB(t);let h=-1,d=-1;l.eventArgs&&(h=l.eventArgs.col,d=l.eventArgs.row);const c=e.getCellValue(h,d),u=null===(o=null===(i=l.eventArgs)||void 0===i?void 0:i.targetCell)||void 0===o?void 0:o.globalAABBBounds;if(u&&e.internalProps.focusControl.setFocusRect(new Px(u.x1+e.scrollLeft,u.y1+e.scrollTop,u.x2-u.x1,u.y2-u.y1),c),e.hasListeners(Ax.DBLCLICK_CELL)){const i=e.getCellInfo(h,d);let o,c;if(null===(n=l.eventArgs)||void 0===n?void 0:n.target){const t=KL(null===(r=l.eventArgs)||void 0===r?void 0:r.target);t&&(o=t.icon,c=t.position)}const u=Object.assign(Object.assign({},i),{event:t.nativeEvent,federatedEvent:t,cells:[],targetIcon:o?{name:o.name,position:c,funcType:o.attribute.funcType}:void 0,target:null===(s=null==l?void 0:l.eventArgs)||void 0===s?void 0:s.target,mergeCellInfo:null===(a=null==l?void 0:l.eventArgs)||void 0===a?void 0:a.mergeInfo});e.fireListeners(Ax.DBLCLICK_CELL,u)}}(t,e)}))}function hP(t){t.stateManager.endResizeCol();const e=[];for(let i=0;i<t.colCount;i++)e.push(t.getColWidth(i));t.fireListeners(Ax.RESIZE_COLUMN_END,{col:t.stateManager.columnResize.col,colWidths:e})}function dP(t){t.stateManager.endResizeRow(),t.fireListeners(Ax.RESIZE_ROW_END,{row:t.stateManager.rowResize.row,rowHeight:t.getRowHeight(t.stateManager.rowResize.row)})}let cP=1;function uP(){return tx?cP=1:(cP=Math.ceil(window.devicePixelRatio||1),cP>1&&cP%2!=0&&(cP+=1)),cP}uP();var gP=function(t,e,i,o){return new(i||(i=Promise))((function(n,r){function s(t){try{l(o.next(t))}catch(t){r(t)}}function a(t){try{l(o.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((o=o.apply(t,e||[])).next())}))};function pP(t){return!!t.changedTouches}function fP(t,e,i){if(i.indicatorsAsCol){if(i.hasTwoIndicatorAxes&&e===i.columnHeaderLevelCount-1&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount)return"top";if(e===i.rowCount-i.bottomFrozenRowCount&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount)return"bottom";if(t===i.rowHeaderLevelCount-1&&e>=i.rowHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount)return"left"}else{if(t===i.rowHeaderLevelCount-1&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount)return"left";if(t===i.colCount-i.rightFrozenColCount&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount)return"right";if(e===i.rowCount-i.bottomFrozenRowCount&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount)return"bottom"}return"bottom"}function vP(t,e,i,o,n){var r;let s=e+1;for(;ht(o[s])&&(null===(r=o[s])||void 0===r?void 0:r.length)>i.length;){const e=n.columnHeaderLevelCount+s;n.stateManager.setCheckedState(0,e,"_vtable_rowSeries_number",t),QL(0,e,t,n),s++}}function bP(t,e,i,o){var n;let r=e.length-1;if(r>0){let e=t-1;for(;r>0&&e>=0;)(ht(i[e])&&(null===(n=i[e])||void 0===n?void 0:n.length)===r||1===r&&ut(i[e]))&&(mP(0,o.columnHeaderLevelCount+e,i[e],o),r--),e--}}function mP(t,e,i,o){const{checkedState:n}=o.stateManager,r=i.toString(),s=ht(i)?i.length:1;let a=!1;const l=[],h=Array.from(n.keys()).sort(((t,e)=>{var i,o;const n=t.split(","),r=e.split(","),s=Math.max(n.length,r.length);for(let t=0;t<s;t++){const e=null!==(i=Number(n[t]))&&void 0!==i?i:0,s=null!==(o=Number(r[t]))&&void 0!==o?o:0;if(e!==s)return e-s}return 0})),d=h.map((t=>n.get(t)));if(d.forEach(((t,e)=>{const i=h[e],o=t;a&&(i.split(",").length===s?a=!1:l.push(o._vtable_rowSeries_number)),i===r&&(a=!0)})),0===l.length)return;const c=l.every((t=>!!t)),u=l.every((t=>!t));c?(o.stateManager.setCheckedState(t,e,"_vtable_rowSeries_number",!0),QL(t,e,!0,o)):u?(o.stateManager.setCheckedState(t,e,"_vtable_rowSeries_number",!1),QL(t,e,!1,o)):(o.stateManager.setCheckedState(t,e,"_vtable_rowSeries_number","indeterminate"),QL(t,e,"indeterminate",o))}function yP(t,e,i){const{checkedState:o}=i.stateManager,n=e.toString(),r=ht(e)?e.length:1;let s=!1;const a=Array.from(o.keys()).sort(((t,e)=>{var i,o;const n=t.split(","),r=e.split(","),s=Math.max(n.length,r.length);for(let t=0;t<s;t++){const e=null!==(i=Number(n[t]))&&void 0!==i?i:0,s=null!==(o=Number(r[t]))&&void 0!==o?o:0;if(e!==s)return e-s}return 0})),l=a.map((t=>o.get(t)));l.forEach(((e,i)=>{const o=a[i],l=e;s&&(o.split(",").length===r?s=!1:l._vtable_rowSeries_number=t),o===n&&(s=!0)}))}function CP(t,e,i){const o=t.getRecordShowIndexByCell(e,i);return t.dataSource.getHierarchyState(o)}function wP(t){t.on(Ax.ICON_CLICK,(e=>{var i;const{col:o,row:n,x:r,y:s,funcType:a,icon:l,event:h}=e,{stateManager:d}=t;if(a===sw.dropDown)d.triggerDropDownMenu(o,n,r,s,h);else if(a===sw.sort)d.triggerSort(o,n,l,h);else if(a===sw.frozen)d.triggerFreeze(o,n,l);else if(a===sw.drillDown)!function(t){t.fireListeners(XL.DRILLMENU_CLICK,t.stateManager.drill)}(t);else if(a===sw.collapse||a===sw.expand){const e=!!(null===(i=d.select.ranges)||void 0===i?void 0:i.length);d.updateSelectPos(-1,-1),d.endSelectCells(!0,e),t.toggleHierarchyState(o,n)}}))}let xP;const _P=t=>{const e=t.value;return Number(e)>80?"#20a8d8":Number(e)>50?"#4dbd74":Number(e)>20?"#ffc107":"#f86c6b"};class SP extends Rw{static get DEFAULT(){return xP||(xP=new SP)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var e,i,o,n,r,s,a,l,h,d,c,u,g,p,f,v;super(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this._showBar=null===(e=t.showBar)||void 0===e||e,this._barColor=null!==(i=t.barColor)&&void 0!==i?i:_P,this._barPositiveColor=null!==(o=t.barPositiveColor)&&void 0!==o?o:"#4dbd74",this._barNegativeColor=null!==(n=t.barNegativeColor)&&void 0!==n?n:"#f86c6b",this._barAxisColor=null!==(r=t.barAxisColor)&&void 0!==r?r:"black",this._barBgColor=t.barBgColor,this._barHeight=null!==(s=t.barHeight)&&void 0!==s?s:3,this._barHeight=null!==(a=t.barHeight)&&void 0!==a?a:3,this._barBottom=null!==(l=t.barBottom)&&void 0!==l?l:0,this._barPadding=null!==(h=t.barPadding)&&void 0!==h?h:[0,0,0,0],this._showBarMark=null!==(d=t.showBarMark)&&void 0!==d&&d,this._barMarkPositiveColor=null!==(c=t.barMarkPositiveColor)&&void 0!==c?c:"#4dbd74",this._barMarkNegativeColor=null!==(u=t.barMarkNegativeColor)&&void 0!==u?u:"#f86c6b",this._barMarkWidth=null!==(g=t.barMarkWidth)&&void 0!==g?g:2,this._barMarkPosition=null!==(p=t.barMarkPosition)&&void 0!==p?p:"right",this._barRightToLeft=null!==(f=t.barRightToLeft)&&void 0!==f&&f,this._barMarkInBar=null===(v=t.barMarkInBar)||void 0===v||v}get showBar(){return this._showBar}set showBar(t){this._showBar=t}get barColor(){return this._barColor}set barColor(t){this._barColor=t}get barBgColor(){return this._barBgColor}set barBgColor(t){this._barBgColor=t}get barHeight(){return this._barHeight}set barHeight(t){this._barHeight=t}get barBottom(){return this._barBottom}set barBottom(t){this._barBottom=t}get barPositiveColor(){return this._barPositiveColor}set barPositiveColor(t){this._barPositiveColor=t}get barNegativeColor(){return this._barNegativeColor}set barNegativeColor(t){this._barNegativeColor=t}get barAxisColor(){return this._barAxisColor}set barAxisColor(t){this._barAxisColor=t}get barPadding(){return this._barPadding}set barPadding(t){this._barPadding=t}get showBarMark(){return this._showBarMark}set showBarMark(t){this._showBarMark=t}get barMarkPositiveColor(){return this._barMarkPositiveColor}set barMarkPositiveColor(t){this._barMarkPositiveColor=t}get barMarkNegativeColor(){return this._barMarkNegativeColor}set barMarkNegativeColor(t){this._barMarkNegativeColor=t}get barMarkWidth(){return this._barMarkWidth}set barMarkWidth(t){this._barMarkWidth=t}get barMarkPosition(){return this._barMarkPosition}set barMarkPosition(t){this._barMarkPosition=t}get barRightToLeft(){return this._barRightToLeft}set barRightToLeft(t){this._barRightToLeft=t}get barMarkInBar(){return this._barMarkInBar}set barMarkInBar(t){this._barMarkInBar=t}clone(){return new SP(this,null)}}const AP=["type","content","style","color","width","height","marginRight","marginLeft","src","svg","name","path","positionType","tooltip","hover","cursor","shape","interactive","isGif"];class BP{constructor(t){this._table=t;const e=LR();this.expandIcon=e[aw.expandIconName],this.collapseIcon=e[aw.collapseIconName]}getIcons(t,e,i,o,n){const r=[],s=this.getHierarchyIcon(t,e);s&&r.push(s);const{icon:a}=this._table.getBodyColumnDefine(t,e);if(a){let n;n="function"==typeof a?a({col:t,row:e,value:i,dataValue:o,table:this._table}):a;const s=LR(),l=t=>{let e;e="string"==typeof t?s[t]:t,e&&r.push(e)};Array.isArray(n)?n.forEach(((t,e)=>{l(t)})):l(n)}return n&&r.forEach(((i,o)=>{(i.content||i.src)&&(r[o]=this.getCellIconFromRecordValue(i,t,e))})),r}getStyleClass(t){switch(t){case"text":case"link":return kw;case"image":case"video":return Tw;case"chart":case"sparkline":return Rw;case"progressbar":return SP;case"checkbox":return Ew;case"radio":return Hw;case"switch":return Fw;case"button":return Ow}return kw}getCellIconFromRecordValue(t,e,i){if(Array.isArray(t))return t.map((t=>this.getCellIconFromRecordValue(t,e,i)));if(!Cx.isObject(t)||"function"==typeof t)return this._table.getFieldData(t,e,i);const o={},n=t;return AP.forEach((t=>{var r,s;if(void 0!==n[t]){const a=this._table.getFieldData(n[t],e,i);ot(a)?o[t]=a:(null===(s=(r=this._table)._hasField)||void 0===s?void 0:s.call(r,n[t],e,i))||(o[t]=n[t])}})),o}getHierarchyIcon(t,e){const i=this._table.getHierarchyState(t,e);return i===nw.expand?this.expandIcon:i===nw.collapse?this.collapseIcon:void 0}getHierarchyIconWidth(){var t,e;return this.expandIcon.width+(null!==(t=this.expandIcon.marginLeft)&&void 0!==t?t:0)+(null!==(e=this.expandIcon.marginRight)&&void 0!==e?e:0)}}function RP(t,e){const i=document.createElement(t);return e&&i.classList.add(...e),i}!function(){if("node"===zw.mode)return;const t=document.createElement("style");t.id="vtable-menu-styleSheet",t.textContent="\n@keyframes vtable__menu-element--shown-animation {\n\t0% {\n\t\topacity: 0;\n\t}\n\t100% {\n\t\topacity: 1;\n\t}\n}\n.vtable__menu-element {\n\tposition: absolute;\n\tbox-sizing: border-box;\n\tborder-radius: 4px;\n\tbackground-color: #fff;\n\tpadding: 6px 0;\n\t/* pointer-events: none; */\n\tuser-select: none;\n\tcolor: #000;\n\tmax-width: 300px;\n\tz-index: 99999;\n\tborder: #CCC 0.5px solid;\n\tcursor: default;\n\twidth: max-content;\n\tbox-shadow: 0px 8px 16px rgba(27, 31, 35, 0.12);\n  max-height: 100%;\n  overflow-y: auto;\n}\n.vtable__menu-element--hidden {\n\topacity: 0;\n\t/* transform: translate(-50%, -50%); */\n\ttransition: opacity 75ms linear;\n\tz-index: -9999;\n}\n.vtable__menu-element--shown {\n\topacity: 1;\n\t/* transform: translate(-50%, -50%); */\n\tanimation: vtable__menu-element--shown-animation 150ms ease-out;\n}\n.vtable__menu-element__content {\n\tfont-family: Roboto;\n\tfont-size: 12px;\n\toverflow: hidden;\n\tdisplay: inline-block;\n\t/* height: 100%; */\n\tline-height: 30px;\n}\n.vtable__menu-element__item {\n\theight: 32px;\n\tpadding: 0px 12px;\n\tcursor: pointer;\n\tposition: relative;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: flex-start;\n}\n.vtable__menu-element__item:hover {\n\tbackground-color: rgba(27, 31, 35, 0.06);\n}\n.vtable__menu-element__icon{\n\t/* vertical-align: top; */\n\tdisplay: flex;\n\t/* line-height: 30px; */\n\tmargin-right: 6px;\n}\n.vtable__menu-element__no-event {\n\tpointer-events: none;\n}\n.vtable__menu-element--select {\n\tcolor: #2E68CF;\n}.vtable__menu-element--normal {\n\tcolor: rgba(20, 20, 20, 0.9);;\n}\n.vtable__menu-element__split {\n\theight: 0px;\n\tborder: 1px solid rgb(209, 213, 218);\n\tmargin: 5px 0;\n}\n.vtable__menu-element__title {\n\tcolor: rgb(149, 149, 149);\n}\n.vtable__menu-element__arrow {\n\tposition: absolute;\n\tright: 3px;\n\tfont-weight: bold;\n\tmargin-top: 1px;\n}\n.vtable__menu-element__item-text {\n\tmargin-right: 15px;\n}\n",document.head.appendChild(t)}();const TP="vtable__menu-element",kP=`${TP}__item`,MP=`${TP}__content`,LP=`${TP}--hidden`,PP=`${TP}--shown`,EP=`${TP}--normal`,HP=`${TP}--select`,FP=`${TP}__icon`,OP=`${TP}__split`,IP=`${TP}__title`,zP=`${TP}__arrow`,DP=`${TP}__no-event`,WP=`${TP}__item-text`;function NP(){return RP("div",[TP,LP])}function GP(t,e,i,o,n,r){const s=t.getCellRange(o,n);for(let o=0;o<e.length;o++){const n=e[o];let{col:r,row:a}=n;const{field:l,menuKey:h}=n;if("number"!=typeof r||"number"!=typeof a)if(t.isPivotTable()){const e=t.internalProps.layoutMap.getPivotCellAdress(l);if(!e)continue;r=e.col,a=e.row}else{const e=t.internalProps.layoutMap.getHeaderCellAddressByField(l);if(!e)continue;r=e.col,a=e.row}if(ot(r)&&ot(a)&&vx(s,r,a)&&i===h)return!0}return!1}class jP{constructor(t){var e,i,o,n,r,s,a,l,h,d,c;this._handler=new kx,this._rootElement=NP(),this._secondElement=NP(),this._secondElement.sub=!0,this._showChildrenIndex=-1,this._rootElement.addEventListener("wheel",(t=>{t.stopPropagation()})),null===(e=this._rootElement)||void 0===e||e.addEventListener("mousedown",(t=>{t.stopPropagation(),t.preventDefault()})),null===(i=this._rootElement)||void 0===i||i.addEventListener("contextmenu",(t=>{t.stopPropagation(),t.preventDefault()})),null===(o=this._rootElement)||void 0===o||o.addEventListener("touchend",(e=>{if(e.stopPropagation(),e.preventDefault(),this._rootElement.classList.contains(LP))return;const{col:i,row:o,dropDownIndex:n,menuKey:r,text:s,hasChildren:a}=e.target;if("number"!=typeof n||a)return void e.stopPropagation();const l=t.isPivotTable()?t.internalProps.layoutMap.getPivotDimensionInfo(i,o):t.getHeaderField(i,o),h=t._dropDownMenuIsHighlight(i,o,n);t.fireListeners(Ax.DROPDOWN_MENU_CLICK,{col:i,row:o,field:l,menuKey:r,text:s,highlight:h,cellLocation:t.getCellLocation(i,o),event:e}),t.fireListeners(Ax.DROPDOWN_MENU_CLEAR,null),t.fireListeners(Ax.HIDE_MENU,null),e.stopPropagation()})),null===(n=this._rootElement)||void 0===n||n.addEventListener("click",(e=>{if(e.stopPropagation(),e.preventDefault(),this._rootElement.classList.contains(LP))return;const{col:i,row:o,dropDownIndex:n,menuKey:r,text:s,hasChildren:a}=e.target;if("number"!=typeof n||a)return void e.stopPropagation();const l=t.isPivotTable()?t.internalProps.layoutMap.getPivotDimensionInfo(i,o):t.getHeaderField(i,o),h=t._dropDownMenuIsHighlight(i,o,n);t.fireListeners(Ax.DROPDOWN_MENU_CLICK,{col:i,row:o,field:l,menuKey:r,text:s,highlight:h,cellLocation:t.getCellLocation(i,o),event:e}),t.fireListeners(Ax.DROPDOWN_MENU_CLEAR,null),t.fireListeners(Ax.HIDE_MENU,null),e.stopPropagation()})),null===(r=this._rootElement)||void 0===r||r.addEventListener("mousemove",(e=>{var i,o;if(this._rootElement.classList.contains(LP))return;e.stopPropagation();const{hasChildren:n,dropDownIndex:r,col:s,row:a,sub:l}=e.target;if(n){this._showChildrenIndex=r;const o=this._secondElement;null==o||o.classList.remove(LP),null==o||o.classList.add(PP),o.innerHTML="";const n=null===(i=this._menuInstanceInfo.content[r])||void 0===i?void 0:i.children;for(let e=0;e<n.length;e++){const i=n[e],r=VP(i,!!t.stateManager.menu.dropDownMenuHighlight&&GP(t,t.stateManager.menu.dropDownMenuHighlight,"object"==typeof i?(null==i?void 0:i.menuKey)||(null==i?void 0:i.text):i,s,a));r.col=s,r.row=a,r.dropDownIndex=e,"string"==typeof i?(r.text=i,r.menuKey=i):"object"==typeof i&&(r.text=i.text,r.menuKey=i.menuKey||i.text),r.sub=!0,r.sub=!0,o.appendChild(r)}const l=e.target.getBoundingClientRect();this._bindSecondElement(t,s,a,l.right,l.top)}else if(n&&this._showChildrenIndex===r){const t=this._secondElement;null==t||t.classList.remove(LP),null==t||t.classList.add(PP)}else!l&&(null===(o=this._secondElement)||void 0===o?void 0:o.classList.contains(PP))&&setTimeout((()=>{if(!0!==this._mouseEnterSecondElement){this._showChildrenIndex=-1;const t=this._secondElement;null==t||t.classList.remove(PP),null==t||t.classList.add(LP)}}),300)})),null===(s=this._secondElement)||void 0===s||s.addEventListener("wheel",(t=>{t.stopPropagation()})),null===(a=this._secondElement)||void 0===a||a.addEventListener("mousemove",(t=>{this._rootElement.classList.contains(LP)||t.stopPropagation()})),null===(l=this._secondElement)||void 0===l||l.addEventListener("mouseenter",(t=>{this._mouseEnterSecondElement=!0})),null===(h=this._secondElement)||void 0===h||h.addEventListener("mouseleave",(t=>{this._mouseEnterSecondElement=!1})),null===(d=this._secondElement)||void 0===d||d.addEventListener("mousedown",(t=>{t.stopPropagation(),t.preventDefault()})),null===(c=this._secondElement)||void 0===c||c.addEventListener("click",(e=>{if(e.stopPropagation(),e.preventDefault(),this._secondElement.classList.contains(LP))return;const{col:i,row:o,dropDownIndex:n,menuKey:r,text:s,hasChildren:a}=e.target;if("number"!=typeof n||a)return void e.stopPropagation();const l=t.isPivotTable()?t.internalProps.layoutMap.getPivotDimensionInfo(i,o):t.getHeaderField(i,o);let h=!1;this._menuInstanceInfo.content.forEach(((e,n)=>{if("object"==typeof e&&e.children&&e.children.length)for(let n=0;n<e.children.length;n++){const s=e.children[n];if(GP(t,t.stateManager.menu.dropDownMenuHighlight,"object"==typeof s?null==s?void 0:s.menuKey:s,i,o)&&r===("object"==typeof s?null==s?void 0:s.menuKey:s))return void(h=!0)}})),t.fireListeners(Ax.DROPDOWN_MENU_CLICK,{col:i,row:o,field:l,cellHeaderPaths:t.isPivotTable()?t.getCellHeaderPaths(i,o):void 0,menuKey:r,text:s,highlight:h,cellLocation:t.getCellLocation(i,o),event:e}),t.fireListeners(Ax.DROPDOWN_MENU_CLEAR,null),t.fireListeners(Ax.HIDE_MENU,null),e.stopPropagation()}))}get rootElement(){return this._rootElement}release(){this.unbindFromCell();const t=this._rootElement;(null==t?void 0:t.parentElement)&&t.parentElement.removeChild(t),this._handler.release(),delete this._rootElement}bindToCell(t,e,i,o){var n,r;const s=this._rootElement,a=this._secondElement;if(this._menuInstanceInfo=o,null==s||s.classList.remove(PP),null==s||s.classList.add(LP),null==a||a.classList.remove(PP),null==a||a.classList.add(LP),this._canBindToCell(t,e,i)){if(s.innerHTML="",Array.isArray(o.content)){const a=o.content;for(let o=0;null!==(n=o<(null==a?void 0:a.length))&&void 0!==n&&n;o++){const n=a[o];let l=!!t.stateManager.menu.dropDownMenuHighlight&&GP(t,t.stateManager.menu.dropDownMenuHighlight,"object"==typeof n?(null==n?void 0:n.menuKey)||(null==n?void 0:n.text):n,e,i);if(t.stateManager.menu.dropDownMenuHighlight&&"object"==typeof n&&Array.isArray(n.children)&&n.children.length)for(let o=0;o<n.children.length;o++){const r=n.children[o];if(GP(t,t.stateManager.menu.dropDownMenuHighlight,"object"==typeof r?(null==r?void 0:r.menuKey)||(null==r?void 0:r.text):r,e,i)){l=!0;break}}const h=VP(n,l);h.col=e,h.row=i,h.dropDownIndex=o,"string"==typeof n?(h.text=n,h.menuKey=n):"object"==typeof n&&(h.text=n.text,h.menuKey=n.menuKey||n.text,(null===(r=n.children)||void 0===r?void 0:r.length)&&(h.hasChildren=!0)),s.appendChild(h)}}if(this._bindToCell(t,e,i,o.position,o.referencePosition))return null==s||s.classList.add(PP),null==s||s.classList.remove(LP),!0}else this.unbindFromCell();return!1}unbindFromCell(){const t=this._rootElement,e=this._secondElement;this._menuInstanceInfo=void 0,(null==t?void 0:t.parentElement)&&(t.classList.remove(PP),t.classList.add(LP)),(null==e?void 0:e.parentElement)&&(e.classList.remove(PP),e.classList.add(LP))}_canBindToCell(t,e,i){var o;const n=t.getCellRangeRelativeRect({col:e,row:i}),r=null!==(o=t.internalProps.menu.parentElement)&&void 0!==o?o:t.getElement(),{top:s,bottom:a,left:l,right:h}=n;if(t.isFrozenCell(e,i))return!0;if(a<t.getFrozenRowsHeight()||h<t.getFrozenColsWidth()||l>t.tableNoFrameWidth-t.getRightFrozenColsWidth()||s>t.tableNoFrameHeight-t.getBottomFrozenRowsHeight())return!1;const{offsetHeight:d,offsetWidth:c}=r;return!(d<s||c<l)}_bindToCell(t,e,i,o,n){var r;const s=this._rootElement,a=null!==(r=t.internalProps.menu.parentElement)&&void 0!==r?r:t.getElement(),{width:l,height:h,left:d,top:c}=a.getBoundingClientRect();if(s){s.parentElement!==a&&a.appendChild(s),s.style.left="0px";const e=.8*l;s.style.maxWidth=`${e}px`;const i=s.offsetWidth,r=s.offsetHeight;let u,g;o?(u=o.x,g=o.y):n&&(u=n.rect.right-i,g=n.rect.bottom);const p=a.getBoundingClientRect(),f=p.width/a.offsetWidth,v=p.height/a.offsetHeight;g*v+r>h&&(g=(h-r)/v),g<0&&(g/=2);let b=0,m=0;if(t.getElement()!==a){const{left:e,top:i}=t.getElement().getBoundingClientRect();b=i-c,m=e-d}return s.style.top=`${g+b}px`,u<0?u=0:u*f+i>l&&(u=(l-i)/f),s.style.left=`${u+m}px`,!0}return!1}_bindSecondElement(t,e,i,o,n){var r;const s=this._secondElement,a=this._rootElement,l=null!==(r=t.internalProps.menu.parentElement)&&void 0!==r?r:t.getElement(),{width:h,left:d,top:c}=l.getBoundingClientRect(),{x:u,y:g,width:p}=a.getBoundingClientRect();if(s){s.parentElement!==l&&l.appendChild(s),s.style.left="0px";const t=.8*h;s.style.maxWidth=`${t}px`;const e=s.clientWidth,i=n-4-c,r=o-d;s.style.top=`${i}px`;let a=r;return a+e>h?a=a-e-p:a+=4,s.style.left=`${a}px`,!0}return!1}pointInMenuElement(t,e){const i=this._rootElement,{x:o,y:n,width:r,height:s}=i.getBoundingClientRect();if(t>o-5&&t<o+r+5&&e>n-5&&e<n+s+5)return!0;if(this._secondElement){const{x:o,y:n,width:r,height:s}=i.getBoundingClientRect();if(t>o-5&&t<o+r+5&&e>n-5&&e<n+s+5)return!0}return!1}}function VP(t,e){var i,o,n;const r=RP("div",[kP,e?HP:EP]);if("string"==typeof t){const e=RP("span",[MP,DP,WP]);e.innerHTML=t,r.appendChild(e)}else if("object"==typeof t){const s=null!==(i=t.type)&&void 0!==i?i:"item";if("split"===s)return null==r||r.classList.add(OP),r;if(null===(o=null==t?void 0:t.icon)||void 0===o?void 0:o.svg)if(Nx.test(t.icon.svg)){const e=new Image;t.icon.width?e.style.width=t.icon.width.toString()+"px":e.style.width="16px",t.icon.height?e.style.height=t.icon.height.toString()+"px":e.style.height="16px",e.src=t.icon.svg,r.appendChild(e)}else{const i=RP("span",[FP,DP]);i.innerHTML=e&&t.selectedIcon&&t.selectedIcon.svg?t.selectedIcon.svg:t.icon.svg,t.icon.width&&i.children[0].setAttribute("width",t.icon.width.toString()),t.icon.height&&i.children[0].setAttribute("height",t.icon.height.toString()),r.appendChild(i)}const a=RP("span",[MP,DP,WP]);if(a.innerHTML=t.text,r.appendChild(a),"title"===s)null==r||r.classList.add(DP,IP);else if(null===(n=null==t?void 0:t.children)||void 0===n?void 0:n.length){const t=RP("span",[MP,DP,zP]);t.innerHTML=e?'<svg width="8" height="12" viewBox="0 0 10 17" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: baseline"><path d="M1.78186 16.7729L0.300378 15.2915L6.8189 8.77295L0.300377 2.25443L1.78186 0.77295L9.78186 8.77295L1.78186 16.7729Z" fill="#2E68CF" fill-opacity="0.65"></path></svg>':'<svg width="8" height="12" viewBox="0 0 10 17" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: baseline"><path d="M1.78186 16.7729L0.300378 15.2915L6.8189 8.77295L0.300377 2.25443L1.78186 0.77295L9.78186 8.77295L1.78186 16.7729Z" fill="#141414" fill-opacity="0.65"></path></svg>',r.appendChild(t)}}return r}let UP;const $P={CHANGE_STYLE:"change_style"};class XP extends xw{static get EVENT_TYPE(){return $P}static get DEFAULT(){return UP||(UP=new XP)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i,o,n,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x,_,S,A,B,R,T,k,M,L,P,E;super(),this._defaultPadding=[10,16,10,16],this._color=null!==(i=t.color)&&void 0!==i?i:null==e?void 0:e.color,this._strokeColor=null!==(o=null==t?void 0:t.strokeColor)&&void 0!==o?o:null==e?void 0:e.strokeColor,this._fontSize=null!==(n=t.fontSize)&&void 0!==n?n:null==e?void 0:e.fontSize,this._fontFamily=null!==(r=t.fontFamily)&&void 0!==r?r:null==e?void 0:e.fontFamily,this._fontWeight=null!==(s=t.fontWeight)&&void 0!==s?s:null==e?void 0:e.fontWeight,this._fontVariant=null!==(a=t.fontVariant)&&void 0!==a?a:null==e?void 0:e.fontVariant,this._fontStyle=null!==(l=t.fontStyle)&&void 0!==l?l:null==e?void 0:e.fontStyle,this._textOverflow=(null!==(h=t.textOverflow)&&void 0!==h?h:null==e?void 0:e.textOverflow)||"ellipsis",this._textStick=null!==(c=null!==(d=t.textStick)&&void 0!==d?d:null==e?void 0:e.textStick)&&void 0!==c&&c,this._textStickBaseOnAlign=null!==(g=null!==(u=t.textStickBaseOnAlign)&&void 0!==u?u:null==e?void 0:e.textStickBaseOnAlign)&&void 0!==g&&g,this._marked=null!==(f=null!==(p=t.marked)&&void 0!==p?p:null==e?void 0:e.marked)&&void 0!==f&&f,this._textAlign=(null!==(v=t.textAlign)&&void 0!==v?v:null==e?void 0:e.textAlign)||"left",this._textBaseline=(null!==(b=t.textBaseline)&&void 0!==b?b:null==e?void 0:e.textBaseline)||"middle",this._bgColor=null!==(m=t.bgColor)&&void 0!==m?m:null==e?void 0:e.bgColor,this._padding=null!==(C=null!==(y=t.padding)&&void 0!==y?y:null==e?void 0:e.padding)&&void 0!==C?C:this._defaultPadding,this._borderColor=null!==(w=t.borderColor)&&void 0!==w?w:null==e?void 0:e.borderColor,this._lineHeight=null!==(x=t.lineHeight)&&void 0!==x?x:null==e?void 0:e.lineHeight,this._underline=null!==(_=t.underline)&&void 0!==_?_:null==e?void 0:e.underline,this._underlineColor=null!==(S=t.underlineColor)&&void 0!==S?S:null==e?void 0:e.underlineColor,this._underlineDash=null!==(A=t.underlineDash)&&void 0!==A?A:null==e?void 0:e.underlineDash,this._underlineOffset=null!==(B=t.underlineOffset)&&void 0!==B?B:null==e?void 0:e.underlineOffset,this._lineThrough=null!==(R=t.lineThrough)&&void 0!==R?R:null==e?void 0:e.lineThrough,this._lineThroughColor=null!==(T=t.lineThroughColor)&&void 0!==T?T:null==e?void 0:e.lineThroughColor,this._lineThroughDash=null!==(k=t.lineThroughDash)&&void 0!==k?k:null==e?void 0:e.lineThroughDash,this._linkColor=null!==(M=t.linkColor)&&void 0!==M?M:null==e?void 0:e.linkColor,this._cursor=null!==(L=t.cursor)&&void 0!==L?L:null==e?void 0:e.cursor,this._borderLineWidth=null!==(P=t.borderLineWidth)&&void 0!==P?P:null==e?void 0:e.borderLineWidth,this._borderLineDash=null!==(E=t.borderLineDash)&&void 0!==E?E:null==e?void 0:e.borderLineDash}get bgColor(){return this._bgColor}set bgColor(t){this._bgColor=t}get color(){return this._color}set color(t){this._color=t}get strokeColor(){return this._strokeColor}set strokeColor(t){this._strokeColor=t}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize=t}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t}get textOverflow(){return this._textOverflow}set textOverflow(t){this._textOverflow=t}get padding(){var t;return null!==(t=this._padding)&&void 0!==t?t:this._defaultPadding}set padding(t){this._padding=t}get borderColor(){return this._borderColor}set borderColor(t){this._borderColor=t}get textStick(){return this._textStick}set textStick(t){this._textStick=t}get textStickBaseOnAlign(){return this._textStickBaseOnAlign}set textStickBaseOnAlign(t){this._textStickBaseOnAlign=t}get marked(){return this._marked}set marked(t){this._marked=t}get textAlign(){return this._textAlign}set textAlign(t){this._textAlign=t}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t}get underline(){return this._underline}set underline(t){this._underline=t}get underlineColor(){return this._underlineColor}set underlineColor(t){this._underlineColor=t}get underlineDash(){return this._underlineDash}set underlineDash(t){this._underlineDash=t}get underlineOffset(){return this._underlineOffset}set underlineOffset(t){this._underlineOffset=t}get lineThrough(){return this._lineThrough}set lineThrough(t){this._lineThrough=t}get lineThroughColor(){return this._lineThroughColor}set lineThroughColor(t){this._lineThroughColor=t}get lineThroughDash(){return this._lineThroughDash}set lineThroughDash(t){this._lineThroughDash=t}get linkColor(){return this._linkColor}set linkColor(t){this._linkColor=t}get cursor(){return this._cursor}set cursor(t){this._cursor=t}get borderLineWidth(){return this._borderLineWidth}set borderLineWidth(t){this._borderLineWidth=t}get borderLineDash(){return this._borderLineDash}set borderLineDash(t){this._borderLineDash=t}clone(){return new XP(this)}}let YP,KP,qP;class ZP extends XP{static get DEFAULT(){return YP||(YP=new ZP)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i;super(t,e),this.textAlign=(null!==(i=t.textAlign)&&void 0!==i?i:null==e?void 0:e.textAlign)||"center"}clone(){return new ZP(this)}}class JP extends XP{static get DEFAULT(){return KP||(KP=new JP)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;var i,o;super(t,e),this._autoWrapText=null!==(i=null==t?void 0:t.autoWrapText)&&void 0!==i?i:null==e?void 0:e.autoWrapText,this._lineClamp=null!==(o=null==t?void 0:t.lineClamp)&&void 0!==o?o:null==e?void 0:e.lineClamp}clone(){return new JP(this,null)}get lineClamp(){return this._lineClamp}set lineClamp(t){this._lineClamp=t}get autoWrapText(){return this._autoWrapText}set autoWrapText(t){this._autoWrapText=t}}class QP extends XP{static get DEFAULT(){return qP||(qP=new QP)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var o,n,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x,_,S;super(t,e),this._size=(null!==(n=null!==(o=null==t?void 0:t.size)&&void 0!==o?o:null==e?void 0:e.size)&&void 0!==n?n:null==i?void 0:i.size)||14,this._spaceBetweenTextAndIcon=(null!==(s=null!==(r=null==t?void 0:t.spaceBetweenTextAndIcon)&&void 0!==r?r:null==e?void 0:e.spaceBetweenTextAndIcon)&&void 0!==s?s:null==i?void 0:i.spaceBetweenTextAndIcon)||8,this._defaultFill=null!==(l=null===(a=null==t?void 0:t.checkboxStyle)||void 0===a?void 0:a.defaultFill)&&void 0!==l?l:null==i?void 0:i.defaultFill,this._defaultStroke=null!==(d=null===(h=null==t?void 0:t.checkboxStyle)||void 0===h?void 0:h.defaultStroke)&&void 0!==d?d:null==i?void 0:i.defaultStroke,this._disableFill=null!==(u=null===(c=null==t?void 0:t.checkboxStyle)||void 0===c?void 0:c.disableFill)&&void 0!==u?u:null==i?void 0:i.disableFill,this._checkedFill=null!==(p=null===(g=null==t?void 0:t.checkboxStyle)||void 0===g?void 0:g.checkedFill)&&void 0!==p?p:null==i?void 0:i.checkedFill,this._checkedStroke=null!==(v=null===(f=null==t?void 0:t.checkboxStyle)||void 0===f?void 0:f.checkedStroke)&&void 0!==v?v:null==i?void 0:i.checkedStroke,this._disableCheckedFill=null!==(m=null===(b=null==t?void 0:t.checkboxStyle)||void 0===b?void 0:b.disableCheckedFill)&&void 0!==m?m:null==i?void 0:i.disableCheckedFill,this._disableCheckedStroke=null!==(C=null===(y=null==t?void 0:t.checkboxStyle)||void 0===y?void 0:y.disableCheckedStroke)&&void 0!==C?C:null==i?void 0:i.disableCheckedStroke,this._checkIconImage=null!==(x=null===(w=null==t?void 0:t.checkboxStyle)||void 0===w?void 0:w.checkIconImage)&&void 0!==x?x:null==i?void 0:i.checkIconImage,this._indeterminateIconImage=null!==(S=null===(_=null==t?void 0:t.checkboxStyle)||void 0===_?void 0:_.indeterminateIconImage)&&void 0!==S?S:null==i?void 0:i.indeterminateIconImage}get size(){return this._size}set size(t){this._size=t}get spaceBetweenTextAndIcon(){return this._spaceBetweenTextAndIcon}set spaceBetweenTextAndIcon(t){this._spaceBetweenTextAndIcon=t}get defaultFill(){return this._defaultFill}set defaultFill(t){this._defaultFill=t}get defaultStroke(){return this._defaultStroke}set defaultStroke(t){this._defaultStroke=t}get disableFill(){return this._disableFill}set disableFill(t){this._disableFill=t}get checkedFill(){return this._checkedFill}set checkedFill(t){this._checkedFill=t}get checkedStroke(){return this._checkedStroke}set checkedStroke(t){this._checkedStroke=t}get disableCheckedFill(){return this._disableCheckedFill}set disableCheckedFill(t){this._disableCheckedFill=t}get disableCheckedStroke(){return this._disableCheckedStroke}set disableCheckedStroke(t){this._disableCheckedStroke=t}get checkIconImage(){return this._checkIconImage}set checkIconImage(t){this._checkIconImage=t}get indeterminateIconImage(){return this._indeterminateIconImage}set indeterminateIconImage(t){this._indeterminateIconImage=t}getStyle(t){return new QP(t,this)}clone(){return new QP(this)}}function tE(t,e,i,o,n,r){var s;return t||e?t instanceof XP?t:"function"==typeof t?tE(t(i),e,i,o,n,r):(t||(t={}),n&&!ot(t.autoWrapText)&&(t.autoWrapText=!0),o===QP?new QP(null!=t?t:{},null!=e?e:{},null!==(s=r.checkboxStyle)&&void 0!==s?s:{}):new o(null!=t?t:{},null!=e?e:{})):o.DEFAULT}class eE{constructor(t){this._table=t;const e=LR();this.freezeIcon=e[aw.freezeIconName],this.frozenIcon=e[aw.frozenIconName],this.frozenCurrentIcon=e[aw.frozenCurrentIconName],this.normalIcon=e[aw.normalIconName],this.upIcon=e[aw.upwardIconName],this.downIcon=e[aw.downwardIconName],this.dropDownAbsoluteIcon=e[aw.dropdownIconName],this.expandIcon=e[aw.expandIconName],this.collapseIcon=e[aw.collapseIconName]}getIcons(t,e){const i=[];if(this._table.isPivotTable()){const{showSort:o,sort:n}=this._table.internalProps.layoutMap.getHeader(t,e);let r;if(r="function"==typeof o?o({col:t,row:e,table:this._table}):o,r){let o=this._table.getPivotSortState(t,e);o&&(o=o.toUpperCase());const n="ASC"===o?this.upIcon:"DESC"===o?this.downIcon:this.normalIcon;n&&i.push(n)}else if(n){const o=this.getSortIconForPivotTable(this._table.getPivotSortState(t,e),this._table,t,e);o&&i.push(o)}}else{const o=this._table.sortState;let n;n=void 0;const r=this._table.getCellRange(t,e);if(o)if(Array.isArray(o))for(let t=0;t<o.length;t++){const e=o[t],i=this._table._getHeaderCellBySortState(e);if(i&&vx(r,i.col,i.row)){({order:n}=e);break}}else{const t=this._table._getHeaderCellBySortState(o);t&&vx(r,t.col,t.row)&&({order:n}=o)}const s=this.getSortIcon(n,this._table,t,e);s&&i.push(s)}if(this._table.showFrozenIcon&&t<this._table.allowFrozenColCount){const o=this.getFrozenIcon(t,e);o&&i.push(o)}if(this.checkDropDownIcon(this._table,t,e)){const t=this.dropDownAbsoluteIcon;i.push(t)}const o=this.getDropDownStateIcons(this._table,t,e);o.length&&i.push(...o);const{headerIcon:n}=this._table._getHeaderLayoutMap(t,e),r=this.getHierarchyIcon(t,e);if(r&&i.push(r),n){let o;o="function"==typeof n?n({col:t,row:e,value:this._table.getCellValue(t,e),dataValue:this._table.getCellOriginValue(t,e),table:this._table}):n;const r=LR(),s=t=>{let e;e="string"==typeof t?r[t]:t,e&&i.push(e)};Array.isArray(o)?o.forEach(((t,e)=>{s(t)})):s(o)}return i}getFrozenIcon(t,e){if(this._table.isPivotTable()||this._table.transpose)return null;if(this._table.rightFrozenColCount&&t>=this._table.colCount-this._table.rightFrozenColCount)return null;const i=this._table.getHeaderDefine(t,e);if(i.columns&&i.columns.length>0)return null;let o=this.freezeIcon;return this._table.options.frozenColCount-1>t?o=this.frozenIcon:this._table.options.frozenColCount-1===t&&(o=this.frozenCurrentIcon),o}getSortIcon(t,e,i,o){const n="asc"===t?this.upIcon:"desc"===t?this.downIcon:this.normalIcon,r=e.getHeaderDefine(i,o);let s;return r&&(s="function"==typeof r.showSort?r.showSort({col:i,row:o,table:this._table}):r.showSort),!r||!1===s||!ot(s)&&!r.sort||r.columns&&r.columns.length>0?null:n}getSortIconForPivotTable(t,e,i,o){const n=e.getHeaderDefine(i,o);let r;return n&&(r="function"==typeof n.showSort?n.showSort({col:i,row:o,table:this._table}):n.showSort),!n||!1===r||!ot(r)&&!n.sort||n.columns&&n.columns.length>0?null:"ASC"===(null==t?void 0:t.toUpperCase())?this.upIcon:"DESC"===(null==t?void 0:t.toUpperCase())?this.downIcon:this.normalIcon}getDropDownStateIcons(t,e,i){var o,n,r;const s=t.getHeaderDefine(e,i),a=t._getHeaderLayoutMap(e,i);let{dropDownMenu:l}=a;"function"==typeof l&&(l=l({row:i,col:e,table:t}));let h=t.globalDropDownMenu;"function"==typeof h&&(h=h({row:i,col:e,table:t}));const d=[];if(Array.isArray(l)&&l.length||Array.isArray(h)&&h.length&&!(null===(o=null==s?void 0:s.columns)||void 0===o?void 0:o.length)){const o=l||h;let s=-1,a=-1;for(let l=0;l<o.length;l++){const h=o[l];if("object"==typeof h&&h.children&&h.children.length)for(let o=0;o<h.children.length;o++){const d=h.children[o];if((null===(n=t.stateManager.menu)||void 0===n?void 0:n.dropDownMenuHighlight)&&GP(t,null===(r=t.stateManager.menu)||void 0===r?void 0:r.dropDownMenuHighlight,"object"==typeof d?null==d?void 0:d.menuKey:d,e,i)){s=l,a=o;break}}if(t._dropDownMenuIsHighlight(e,i,l)){s=l;break}}if(-1!==s){let t;t=-1!==a?o[s].children[a]:o[s],t.stateIcon&&(t.stateIcon.svg?d.push({type:"svg",name:t.stateIcon.src||t.stateIcon.svg,width:t.stateIcon.width||22,height:t.stateIcon.height||22,svg:t.stateIcon.svg,positionType:rw.right,marginRight:0,funcType:sw.dropDownState,interactive:!1}):t.stateIcon.src&&d.push({type:"image",name:t.stateIcon.src||t.stateIcon.svg,width:t.stateIcon.width||22,height:t.stateIcon.height||22,src:t.stateIcon.src,positionType:rw.right,marginRight:0,funcType:sw.dropDownState,interactive:!1}))}}return d}getDropDownIconRect(t,e,i){var o,n,r,s,a,l,h,d;const c=null!==(s=null!==(n=null===(o=this.downIcon.hover)||void 0===o?void 0:o.width)&&void 0!==n?n:null===(r=this.downIcon)||void 0===r?void 0:r.width)&&void 0!==s?s:0,u=null!==(d=null!==(l=null===(a=this.downIcon.hover)||void 0===a?void 0:a.height)&&void 0!==l?l:null===(h=this.downIcon)||void 0===h?void 0:h.height)&&void 0!==d?d:0,g=t.right-2-c,p=t.right-2;let f;return f="middle"===i?t.top+t.height/2-c/2:"top"===i?t.top+e/2:"bottom"===i?t.bottom-2*e:t.top,{left:g,right:p,top:f,bottom:u+f,width:c,height:u}}getHierarchyIcon(t,e){const{hierarchyState:i}=this._table._getHeaderLayoutMap(t,e);if(i){if(i===nw.expand)return this.expandIcon;if(i===nw.collapse)return this.collapseIcon}}getHierarchyIconWidth(){var t,e;return this.expandIcon.width+(null!==(t=this.expandIcon.marginLeft)&&void 0!==t?t:0)+(null!==(e=this.expandIcon.marginRight)&&void 0!==e?e:0)}checkDropDownIcon(t,e,i){var o;if(t.isPivotTable()){let o=t._getHeaderLayoutMap(e,i).dropDownMenu;if("function"==typeof o&&(o=o({row:i,col:e,table:t})),Array.isArray(o)&&o.length)return!0}else{const n=t.getHeaderDefine(e,i),r=n.dropDownMenu;let s=t.globalDropDownMenu;if("function"==typeof s&&(s=s({row:i,col:e,table:t})),Array.isArray(r)&&r.length||(!Array.isArray(n.dropDownMenu)||0!==n.dropDownMenu.length)&&Array.isArray(s)&&s.length&&!(null===(o=null==n?void 0:n.columns)||void 0===o?void 0:o.length))return!0}return!1}getStyleClass(t){switch(t){case"text":case"link":return JP;case"image":case"video":return ZP;case"checkbox":return QP}}setTableColumnsEditor(){const t=(e,i)=>{null==e||e.forEach(((e,o)=>{e.editor&&(i[o].editor=e.editor),e.columns&&t(e.columns,i[o].columns)}))};t(this._table.options.columns,this._table.internalProps.columns)}}class iE extends EventTarget{constructor(t,e){if(super(),this._table=t,"node"===zw.mode)return;const i=document.createElement("div");i.style.opacity="0",i.dataset.vtable="vtable",i.style.pointerEvents="none",i.classList.add("input-container");const o=this._input=document.createElement("input");i.appendChild(o),o.classList.add("table-focus-control"),o.dataset.vtable="vtable",o.readOnly=!0,e.appendChild(i),this._container=i}focus(){this._input.focus({preventScroll:!0})}setFocusRect(t,e){const i=this._input;i.value=e,i.select();const o=t.top-this._table.scrollTop,n=t.left-this._table.scrollLeft;i.style.top=`${o.toFixed()}px`,i.style.left=`${n.toFixed()}px`,i.style.width=`${t.width.toFixed()}px`,i.style.height=`${t.height.toFixed()}px`}get input(){return this._input}release(){var t;null===(t=this._container.parentElement)||void 0===t||t.removeChild(this._container)}}class oE{constructor(t){this.isUpdate=!1,this._keys=[],this._sorted=!1,this.data=new Map,this._keys.length=0,this.cumulativeSum=new Map,this.difference=new Map,this.totalSum=0,this.table=t}get length(){return this.data.size}clear(){this._keys=[],this.data.clear(),this.cumulativeSum.clear(),this.difference.clear(),this.totalSum=0}clearRange(){this.cumulativeSum.clear(),this.difference.clear()}add(t,e){if(!ot(e))return;const i=this.table.getRowHeight(t);this.data.has(t)||(this._keys.push(t),this._sorted=!1),this.data.set(t,e),this.totalSum+=e,this.updateDifference(t,e-i)}remove(t){if(this.data.has(t)){const e=this.data.get(t);this.data.delete(t);const i=this._keys.indexOf(t);-1!==i&&this._keys.splice(i,1),this.totalSum-=e;const o=this.table.getRowHeight(t);this.updateDifference(t,o-e)}}put(t,e){if(ot(e))if(this.data.has(t)){const i=this.data.get(t);if(i===e)return;this.data.set(t,e);const o=e-i;this.totalSum+=o,this.updateDifference(t,o)}else this.add(t,e)}get(t){return this.data.get(t)}has(t){return this.data.has(t)}_sort(){const{_keys:t}=this;this._sorted||(t.sort(((t,e)=>t<e?-1:t>e?1:0)),this._sorted=!0)}updateDifference(t,e){var i;const o=null!==(i=this.difference.get(t))&&void 0!==i?i:0;this.difference.set(t,o+e),this.update()}getSumInRange(t,e){return this.calculatePrefixSum(e)-this.calculatePrefixSum(t-1)}updateCumulativeSum(t,e){for(const[i,o]of this.cumulativeSum)i>=t&&this.cumulativeSum.set(i,o+e)}calculatePrefixSum(t){if(t<0)return 0;if(this.cumulativeSum.has(t)){let e=this.cumulativeSum.get(t);for(const[i,o]of this.difference)i<=t&&(e+=o);return e}return this.dealDiffenence(),this.getCumulativeSum(t)}getCumulativeSum(t){var e;let i=0;for(let o=t;o>=0;o--){if(this.cumulativeSum.has(o)){i+=this.cumulativeSum.get(o);break}i+=null!==(e=this.data.get(o))&&void 0!==e?e:this.table.getRowHeight(o)}return this.cumulativeSum.set(t,i),i}update(){this.isUpdate||(this.isUpdate=!0,setTimeout((()=>{this.dealDiffenence(),this.isUpdate=!1}),0))}dealDiffenence(){for(const[t]of this.cumulativeSum)for(const[e,i]of this.difference)if(t>=e){const e=this.cumulativeSum.get(t);this.cumulativeSum.set(t,e+i)}this.difference.clear()}insert(t,e){for(let e=t;e<=this.getLastIndex();e++)this.cumulativeSum.delete(e);const i=this.getLastIndex()+1;this.adjustOrder(t,t+1,i-t),ot(e)&&this.put(t,e)}getLastIndex(){return this._sort(),this._keys[this._keys.length-1]}delLast(){const t=this.getLastIndex();this.remove(t)}delete(t){if(!this.has(t))return;for(let e=t;e<=this.getLastIndex();e++)this.cumulativeSum.delete(e);const e=this.getLastIndex();this.adjustOrder(t+1,t,e-t),this.delLast()}adjustOrder(t,e,i){this.clearRange(),this._sort();const{_keys:o}=this;if(t>e){const n=[];for(let r=nE(o,t+i-1);r>=0;r--){const s=o[r];if(s>=t)n.push(this.get(s));else if(e<=s&&s<t)this.put(s+i,this.get(s));else if(s<e)break}for(let t=0;t<i;t++)this.put(e+t,n[i-1-t])}const{length:n}=o;if(t<e){const r=[];for(let s=nE(o,t);s<n;s++){const n=o[s];if(n>=t&&n<t+i)r.push(this.get(n));else if(t+i<=n&&n<=e)this.put(n-i,this.get(n));else if(n>e)break}for(let t=0;t<i;t++)this.put(e+t,r[t])}}exchangeOrder(t,e,i,o,n){const{_keys:r}=this;if(this._sorted||(r.sort(((t,e)=>t<e?-1:t>e?1:0)),this._sorted=!0),t>i){const o=[],s=[];for(let n=nE(r,i);n<nE(r,t)+e;n++){const i=r[n];i>=t&&i<t+e?s.push(this.get(i)):o.push(this.get(i))}for(let t=0;t<e;t++)this.put(n+t,s[t]);for(let t=0;t<o.length;t++)this.put(n+e+t,o[t])}else{const s=[],a=[];for(let n=nE(r,t);n<nE(r,i)+o;n++){const i=r[n];i>=t&&i<t+e?a.push(this.get(i)):s.push(this.get(i))}for(let t=0;t<e;t++)this.put(n+t,a[t]);for(let e=0;e<s.length;e++)this.put(t+e,s[e])}}}function nE(t,e){let i=0,o=t.length-1;for(;i<=o;){const n=Math.floor((i+o)/2);if(t[n]===e)return n;t[n]>e?o=n-1:i=n+1}return o<0?0:o}class rE{constructor(t){this._table=t;const e=LR();this.dragReorderIconName=e[aw.dragReorderIconName]}getIcons(t,e){return[this.dragReorderIconName]}}class sE{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"grid",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;this.hasHideNode=!1,this.sizeIncludeParent=!1,this.tree={id:0,dimensionKey:"",value:"",children:[],level:-1,afterSpanLevel:-1,levelSpan:1,startIndex:0,size:0,startInTotal:0,hierarchyState:void 0},this.totalLevel=0,this.expandedMaxLevel=0,this.dimensionKeys=new Lx,this.dimensionKeysIncludeVirtual=new Lx,this.cache=new Map,this.sizeIncludeParent=null!=o,this.setExpandLevel=o,this.hierarchyType=i,this.sharedVar=e,this.reset(t)}reset(t){this.totalLevel=0,this.expandedMaxLevel=0,this.hasHideNode=!1,this.cache.clear(),this.dimensionKeys=new Lx,this.dimensionKeysIncludeVirtual=new Lx,this.tree.children=t,this.setTreeNode(this.tree,0,this.tree)}setTreeNode(t,e,i){var o,n,r,s;t.startIndex=e,t.startInTotal=(null!==(o=i.startInTotal)&&void 0!==o?o:0)+t.startIndex,t.hide&&(this.hasHideNode=!0),(null!==(n=t.dimensionKey)&&void 0!==n?n:t.indicatorKey)&&(t.virtual||this.dimensionKeys.contain(t.indicatorKey?Gx:t.dimensionKey)||this.dimensionKeys.put(t.level,t.indicatorKey?Gx:t.dimensionKey),this.dimensionKeysIncludeVirtual.contain(t.indicatorKey?Gx:t.dimensionKey)||this.dimensionKeysIncludeVirtual.put(t.level,t.indicatorKey?Gx:t.dimensionKey),t.id||(t.id=++this.sharedVar.seqId));let a=t.dimensionKey&&this.sizeIncludeParent?1:0;const l=t.children||t.columns;return"grid"===this.hierarchyType||null===this.hierarchyType?(null==l?void 0:l.length)>=1?l.forEach((e=>{var i,o,n;e.level=(null!==(i=t.level)&&void 0!==i?i:0)+1,"grid"===this.hierarchyType&&(e.afterSpanLevel=(null!==(o=t.afterSpanLevel)&&void 0!==o?o:0)+(null!==(n=t.levelSpan)&&void 0!==n?n:1)),this.totalLevel=Math.max(this.totalLevel,e.level+1),a+=this.setTreeNode(e,a,t)})):a=-1===t.level?0:1:t.hierarchyState===nw.expand&&(null==l?void 0:l.length)>=1?l.forEach((e=>{var i;e.level=(null!==(i=t.level)&&void 0!==i?i:0)+1,this.totalLevel=Math.max(this.totalLevel,e.level+1),this.expandedMaxLevel=Math.max(this.expandedMaxLevel,e.level+1),a+=this.setTreeNode(e,a,t)})):t.hierarchyState===nw.collapse&&(null==l?void 0:l.length)>=1?l.forEach((e=>{var i;e.level=(null!==(i=t.level)&&void 0!==i?i:0)+1,this.totalLevel=Math.max(this.totalLevel,e.level+1),this.setTreeNode(e,a,t)})):!t.hierarchyState&&t.level+1<this.setExpandLevel&&((null==l?void 0:l.length)>=1||!0===l)?((null===(r=l[0])||void 0===r?void 0:r.indicatorKey)&&"grid-tree"===this.hierarchyType||(t.hierarchyState=nw.expand),(null==l?void 0:l.length)>=1&&l.forEach((e=>{var i;e.level=(null!==(i=t.level)&&void 0!==i?i:0)+1,this.totalLevel=Math.max(this.totalLevel,e.level+1),this.expandedMaxLevel=Math.max(this.expandedMaxLevel,e.level+1),a+=this.setTreeNode(e,a,t)}))):(null==l?void 0:l.length)>=1||!0===l?((null===(s=l[0])||void 0===s?void 0:s.indicatorKey)&&"grid-tree"===this.hierarchyType||(t.hierarchyState=nw.collapse),(null==l?void 0:l.length)>=1&&l.forEach((e=>{var i;e.level=(null!==(i=t.level)&&void 0!==i?i:0)+1,this.totalLevel=Math.max(this.totalLevel,e.level+1),this.setTreeNode(e,a,t)}))):(t.hierarchyState=nw.none,a=-1===t.level?0:1),t.size=a,a}getTreePath(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;const i=[];return this.searchPath(t,this.tree,i,e),i.shift(),i}findNodeById(t,e){return t.find((t=>t.id===e))}searchPath(t,e,i,o){if(!e)return;if(t<e.startIndex||t>=e.startIndex+e.size)return;if(i.push(e),!e.children||0===e.children.length||e.level>=o)return;const n=t-e.startIndex;if(this.cache.has(e.level+1)){const t=this.cache.get(e.level+1);if(n>=t.startIndex&&n<t.startIndex+t.size)return void this.searchPath(n,t,i,o)}let r=0,s=e.children.length-1;for(;r<=s;){const t=Math.floor((r+s)/2),a=e.children[t];if(n>=a.startIndex&&n<a.startIndex+a.size){this.cache.set(a.level,a);const t=[];this.cache.forEach(((e,i)=>{i>a.level&&t.push(i)})),t.forEach((t=>{this.cache.delete(t)})),this.searchPath(n,a,i,o);break}n<a.startIndex?s=t-1:r=t+1}}movePosition(t,e,i){let o,n,r;const s=(a,l)=>{if(void 0!==n&&void 0!==r)return;a.level===t&&(a.startInTotal===e&&(n=l),a.startInTotal<=i&&i<=a.startInTotal+a.size-1&&(r=l));const h=a.children||a.columns;if(h&&a.level<t){o=a;for(let t=0;t<h.length;t++)(e>=h[t].startInTotal&&e<=h[t].startInTotal+h[t].size||i>=h[t].startInTotal&&i<=h[t].startInTotal+h[t].size)&&s(h[t],t)}};s(this.tree,0);const a=o.children||o.columns,l=a.splice(n,1);l.unshift(r,0),Array.prototype.splice.apply(a,l)}getCopiedTree(){const t=St(this.tree.children);return aE(t),t}}function aE(t){for(let e=0;e<t.length;e++){const i=t[e];delete i.level,delete i.startIndex,delete i.id,delete i.levelSpan,delete i.size,delete i.startInTotal;const o=i.children||i.columns;o&&aE(o)}}function lE(t,e){var i;const o=function(t,e){if(!t.internalProps.frozenRowCount)return null;let{scrollTop:i}=t;const o=t.internalProps.frozenRowCount;for(let n=0;n<o;n++){const o=t.getRowHeight(n),r=i+o;if(r>e)return{top:i,row:n,bottom:r,height:o};i=r}return null}(e,t);return o||(null!==(i=cE(t,e))&&void 0!==i?i:{top:-1,row:-1,bottom:-1,height:-1})}function hE(t,e){var i;const o=function(t,e){if(!t.internalProps.frozenColCount)return null;let{scrollLeft:i}=t;const o=t.internalProps.frozenColCount;for(let n=0;n<o;n++){const o=t.getColWidth(n),r=i+o;if(r>e)return{left:i,col:n,right:r,width:o};i=r}return null}(e,t);return o||(null!==(i=dE(t,e))&&void 0!==i?i:{left:-1,col:-1,right:-1,width:1})}function dE(t,e){if(0===t)return{left:0,col:0,right:0,width:0};const i=function(t,e){if(e._colRangeWidthsMap.get("$0$"+(e.colCount-1))){let i=0,o=e.colCount-1;for(;o-i>1;){const n=Math.floor((i+o)/2);if(t<e._colRangeWidthsMap.get(`$0$${n}`))o=n;else{if(!(t>e._colRangeWidthsMap.get(`$0$${n}`)))return n;i=n}}return o}return Math.min(Math.ceil(t/e.internalProps.defaultColWidth),e.colCount-1)}(t,e),o=e.getColsWidth(0,i);return t>=o?((i,o)=>{let n=o-e.getColWidth(i);const{colCount:r}=e.internalProps;for(let o=i;o<r;o++){const i=e.getColWidth(o),r=n+i;if(Math.round(n)<=Math.round(t)&&Math.round(t)<Math.round(r))return{left:n,col:o,right:r,width:i};n=r}return null})(i,o):((i,o)=>{let n=o;for(let o=i;o>=0;o--){const i=e.getColWidth(o),r=n-i;if(Math.round(r)<=Math.round(t)&&Math.round(t)<Math.round(n))return{left:r,col:o,right:n,width:i};n=r}return null})(i,o)}function cE(t,e){var i;if(0===t)return{top:0,row:0,bottom:0,height:0};const o=!0===(null===(i=e.options.customConfig)||void 0===i?void 0:i._disableColumnAndRowSizeRound)?Math.floor:Math.round,n=function(t,e){let i=e.defaultRowHeight;return e._rowRangeHeightsMap.get("$0$"+(e.rowCount-1))&&(i=e._rowRangeHeightsMap.get("$0$"+(e.rowCount-1))/e.rowCount),Math.min(Math.ceil(t/i),e.rowCount-1)}(t,e),r=e.getRowsHeight(0,n);return t>=r?((i,n)=>{let r=n-e.getRowHeight(i);const{rowCount:s}=e.internalProps;for(let n=i;n<s;n++){const i=e.getRowHeight(n),s=r+i;if(o(r)<=o(t)&&o(t)<o(s))return{top:r,row:n,bottom:s,height:i};r=s}return null})(n,r):((i,n)=>{let r=n;for(let n=i;n>=0;n--){const i=e.getRowHeight(n),s=r-i;if(o(s)<=o(t)&&o(t)<o(r))return{top:s,row:n,bottom:r,height:i};r=s}return null})(n,r)}function uE(t,e,i){if(0===t)return{left:0,col:0,right:0,width:0};if(t-=i.tableX,e&&t>i.tableNoFrameWidth-i.getRightFrozenColsWidth()&&t<i.tableNoFrameWidth&&t<=i.getAllColsWidth())for(let e=0;e<i.rightFrozenColCount;e++)if(t>i.tableNoFrameWidth-i.getColsWidth(i.colCount-e-1,i.colCount-1))return{col:i.colCount-e-1,left:void 0,right:void 0,width:void 0};return dE(t,i)}function gE(t,e,i){if(0===t)return{top:0,row:0,bottom:0,height:0};if(t-=i.tableY,e&&t>i.tableNoFrameHeight-i.getBottomFrozenRowsHeight()&&t<i.tableNoFrameHeight)for(let e=0;e<i.rightFrozenColCount;e++)if(t>i.tableNoFrameHeight-i.getRowsHeight(i.rowCount-e-1,i.rowCount-1))return{row:i.rowCount-e-1,top:void 0,bottom:void 0,height:void 0};return cE(t,i)}function pE(t){return 2===t.length&&gt(t[0])&&gt(t[1])&&t[1]>=t[0]}function fE(t){const e=t[1]-t[0],i=t[1]*t[0]<0;let o=t[0]<=0?0-t[0]:0,n=t[1]>0?t[1]-0:0;return 0===e?t[0]<0?(o=1,n=0):t[0]>0&&(o=0,n=1):(o/=e,n/=e),{total:e,negative:o,positive:n,includeZero:i,domain:t,extendable_min:!0,extendable_max:!0}}function vE(t,e){const{positive:i,negative:o,extendable_min:n,extendable_max:r,domain:s}=t,{positive:a,negative:l,extendable_min:h,extendable_max:d,domain:c}=e;if(a>0){if(!h)return!1;let t=o/i;r&&(t=o/Math.max(i,a),s[1]=-s[0]/t),c[0]=-c[1]*t}else if(l>0){if(!d)return!1;let t=i/o;n&&(t=i/Math.max(o,o),s[0]=-s[1]/t),c[1]=-c[0]*t}return!0}function bE(t,e){const{extendable_min:i,extendable_max:o,domain:n}=t,{positive:r,negative:s,domain:a}=e;return!(0===r&&0===s||r>0&&!o||s>0&&!i||(n[0]=a[0],n[1]=a[1],0))}function mE(t,e){const{positive:i,negative:o,extendable_max:n,domain:r}=t,{positive:s,negative:a,extendable_min:l,domain:h}=e;if(n&&l){const t=Math.max(o,a)/Math.max(i,s);r[1]=-r[0]/t,h[0]=-h[1]*t}else if(l){const t=o/i;h[0]=-h[1]*t}else{if(!n)return!1;{const t=a/s;r[1]=-r[0]/t}}return!0}function yE(t,e){const{extendable_min:i,domain:o}=t,{extendable_max:n,domain:r}=e;return!(!i||!n||(o[0]=-o[1],r[1]=-r[0],0))}function CE(t,e,i,o){return 0!==o&&t?()=>t.map((t=>{const o=(t-e.min)/(e.max-e.min),n=(i.max-i.min)*o+i.min;return Math.round(100*n)/100})):void 0}function wE(t,e,i){var o,n,r,s,a,l,h;if(i._table.isPivotChart())if(i.indicatorsAsCol){if(i.hasTwoIndicatorAxes&&e===i.columnHeaderLevelCount-1&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount){const o=RE("top",t,e+1,t,i.columnHeaderLevelCount-1,t,e,1,i);if(!o)return;const n=tB(FR("padding",i._table._getCellStyle(t,e+1),t,e+1,i._table)),{range:r,ticks:s,axisOption:a,targetTicks:l,targetRange:h,index:d,theme:c}=o;return ut(null==a?void 0:a.min)&&(r.min=a.min,r.min>0&&(a.zero=!1)),ut(null==a?void 0:a.max)&&(r.max=a.max,r.max<0&&(a.zero=!1)),Tt({range:r},a,{orient:"top",type:(null==a?void 0:a.type)||"linear",label:{flush:!0},tick:{tickMode:CE(l,h,r,d)},__ticksForVTable:s,__vtableChartTheme:c,__vtablePadding:n})}if(e===i.rowCount-i.bottomFrozenRowCount&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount){const o=i.getIndicatorKeyInChartSpec(t,e);let n=null;null==o||o.forEach((t=>{const e=i.getIndicatorInfo(t);e&&(n=e)}));const r=RE("bottom",t,e-1,t,e,t,e,0,i);if(!r)return;const s=tB(FR("padding",i._table._getCellStyle(t,e-1),t,e-1,i._table)),{range:a,ticks:l,axisOption:h,index:d,targetTicks:c,targetRange:u,theme:g}=r;return ut(null==h?void 0:h.min)&&(a.min=h.min,a.min>0&&(h.zero=!1)),ut(null==h?void 0:h.max)&&(a.max=h.max,a.max<0&&(h.zero=!1)),Tt({title:{visible:!0,text:null==n?void 0:n.title},range:a},h,{orient:"bottom",type:(null==h?void 0:h.type)||"linear",label:{flush:!0},tick:{tickMode:CE(c,u,a,d)},__ticksForVTable:l,__vtableChartTheme:g,__vtablePadding:s})}if(t===i.rowHeaderLevelCount-1&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount){let a=i.getDimensionKeyInChartSpec(i.rowHeaderLevelCount,e);ht(a)&&(a=a[0]);const l=null!==(o=i.dataset.collectedValues[a])&&void 0!==o?o:[],h=i.getRowKeysPath(t,e),d=null!==(n=l[null!=h?h:""])&&void 0!==n?n:[],{axisOption:c,theme:u,chartType:g}=xE(t+1,e,"left",i);if(!1===(null==c?void 0:c.visible))return;const p=tB(FR("padding",i._table._getCellStyle(t+1,e),t+1,e,i._table)),f=i.getRawChartSpec(t+1,e);return Tt({domain:"linear"===(null==c?void 0:c.type)?void 0:Array.from(d),range:"linear"===(null==c?void 0:c.type)?d:void 0,title:{autoRotate:!0}},c,{orient:"left",type:null!==(r=null==c?void 0:c.type)&&void 0!==r?r:"band",__vtableChartTheme:u,inverse:BE(c,"horizontal"===(null!==(s=null==f?void 0:f.direction)&&void 0!==s?s:"scatter"===g?"vertical":"horizontal")),__vtablePadding:p})}}else{if(t===i.rowHeaderLevelCount-1&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount){const o=i.getIndicatorKeyInChartSpec(t,e);let n=null;null==o||o.forEach((t=>{const e=i.getIndicatorInfo(t);e&&(n=e)}));const r=RE("left",t+1,e,t,e,t,e,0,i);if(!r)return;const s=tB(FR("padding",i._table._getCellStyle(t+1,e),t+1,e,i._table)),{range:a,ticks:l,axisOption:h,index:d,targetTicks:c,targetRange:u,theme:g}=r;return ut(null==h?void 0:h.min)&&(a.min=h.min,a.min>0&&(h.zero=!1)),ut(null==h?void 0:h.max)&&(a.max=h.max,a.max<0&&(h.zero=!1)),Tt({title:{visible:!0,text:null==n?void 0:n.title,autoRotate:!0},range:a},h,{orient:"left",type:(null==h?void 0:h.type)||"linear",label:{flush:!0},tick:{tickMode:CE(c,u,a,d)},__ticksForVTable:l,__vtableChartTheme:g,__vtablePadding:s})}if(t===i.colCount-i.rightFrozenColCount&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount){const o=RE("right",t-1,e,i.rowHeaderLevelCount-1,e,t,e,1,i);if(!o)return;const n=tB(FR("padding",i._table._getCellStyle(t-1,e),t-1,e,i._table)),{range:r,ticks:s,axisOption:a,index:l,targetTicks:h,targetRange:d,theme:c}=o;return ut(null==a?void 0:a.min)&&(r.min=a.min,r.min>0&&(a.zero=!1)),ut(null==a?void 0:a.max)&&(r.max=a.max,r.max<0&&(a.zero=!1)),Tt({range:r,title:{autoRotate:!0}},a,{orient:"right",type:(null==a?void 0:a.type)||"linear",label:{flush:!0},tick:{tickMode:CE(h,d,r,l)},__ticksForVTable:s,__vtableChartTheme:c,__vtablePadding:n})}if(e===i.rowCount-i.bottomFrozenRowCount&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount){let o=i.getDimensionKeyInChartSpec(t,i.columnHeaderLevelCount);ht(o)&&(o=o[0]);const n=null!==(a=i.dataset.collectedValues[o])&&void 0!==a?a:[],r=i.getColKeysPath(t,e),s=null!==(l=null==n?void 0:n[null!=r?r:""])&&void 0!==l?l:[],{axisOption:d,isPercent:c,theme:u,chartType:g}=xE(t,e-1,"bottom",i);if(!1===(null==d?void 0:d.visible))return;const p=tB(FR("padding",i._table._getCellStyle(t,e-1),t,e-1,i._table));return Tt({domain:"linear"===(null==d?void 0:d.type)?void 0:Array.from(s),range:"linear"===(null==d?void 0:d.type)?s:void 0},d,{orient:"bottom",type:null!==(h=null==d?void 0:d.type)&&void 0!==h?h:"band",__vtableChartTheme:u,__vtablePadding:p})}}}function xE(t,e,i,o){var n,r;const s=o.getRawChartSpec(t,e),a=null!==(n=s.axes)&&void 0!==n?n:[];if(o._table.pivotChartAxes.forEach((t=>{-1===a.findIndex((e=>t.orient===e.orient))&&a.push(t)})),s&&ht(a)){const t=a.find((t=>t.orient===i));if(t){const{seriesIndex:e,seriesId:n}=t;let a,l;ot(n)&&ht(s.series)?a=(ht(n)?n:[n]).map((t=>{const e=s.series.findIndex((e=>e.id===t));return e>=0&&(l=s.series[e]),e})):ot(e)&&ht(s.series)&&(a=e);const{isZeroAlign:h,isTickAlign:d}=_E(s,i,o);return{axisOption:t,isPercent:s.percent,isZeroAlign:h,isTickAlign:d,seriesIndice:a,theme:s.theme,chartType:null!==(r=null==l?void 0:l.type)&&void 0!==r?r:s.type}}}const l=o._table.pivotChartAxes.find((t=>t.orient===i)),{isZeroAlign:h,isTickAlign:d}=_E(s,i,o);return{axisOption:l,isPercent:!1,isZeroAlign:h,isTickAlign:d,theme:s.theme,chartType:s.type}}function _E(t,e,i){const o=[];let n;"left"===e||"right"===e?o.push("left","right"):"top"!==e&&"bottom"!==e||o.push("top","bottom"),n=t&&ht(t.axes)?t.axes:i._table.pivotChartAxes;let r=!1,s=!1;if(ht(n)){const t=[];n.forEach((e=>{o.includes(e.orient)&&t.push(e)}));for(let e=0;e<t.length;e++){const i=t[e];i.sync&&i.sync.axisId&&t.find((t=>t.id===i.sync.axisId))&&(r=r||i.sync.zeroAlign,s=s||i.sync.tickAlign)}}return{isZeroAlign:r,isTickAlign:s}}function SE(t,e,i,o,n){var r;if(ht(n)){const r={min:1/0,max:-1/0};for(let s=0;s<n.length;s++){const a=SE(t,e,i,o,n[s]);a&&(r.min=Math.min(r.min,a.min),r.max=Math.max(r.max,a.max))}return isFinite(r.min)&&isFinite(r.max)?r:null}let s=null==e?void 0:e[n];if(ht(s)&&(s=s[0]),!s)return null;const a=t[s],l=Tt({},null!==(r=null==a?void 0:a[null!=o?o:""])&&void 0!==r?r:{min:0,max:1});return l.positiveMax&&l.positiveMax>l.max&&(l.max=l.positiveMax),l.negativeMin&&l.negativeMin<l.min&&(l.min=l.negativeMin),l.min===l.max&&(l.min>0?l.min=0:l.max=0),l}var AE;function BE(t,e){let i=null==t?void 0:t.inverse;return e&&!("bottom"===(o=null==t?void 0:t.orient)||"top"===o)&&(i=!ot(null==t?void 0:t.inverse)||!(null==t?void 0:t.inverse)),i;var o}function RE(t,e,i,o,n,r,s,a,l){const h=l.getIndicatorKeyInChartSpec(o,n);let d;d="top"===t||"bottom"===t?l.getColKeysPath(r,s):l.getRowKeysPath(r,s);const c=TE(e,i,a,t,h,d,l);if(!c)return;const u="bottom"===t?"top":"top"===t?"bottom":"left"===t?"right":"left",{targetRange:g,targetTicks:p}=function(t,e,i,o,n,r,s,a,l,h){let d,c;if(!o&&!n)return{targetTicks:d,targetRange:c};const u=TE(t,e,s.length-1-i,a,s,l,h);if(u){const{range:s,ticks:l}=u;if(c=s,o){const t=function(t,e){const i=[t.min,t.max],o=[e.min,e.max];if(!pE(i)||!pE(o))return;const n=fE(i),r=fE(o),{positive:s,negative:a,extendable_min:l,extendable_max:h,includeZero:d}=n,{positive:c,negative:u,extendable_min:g,extendable_max:p,includeZero:f}=r;if(0===s&&0===a){if(!bE(n,r))return}else if(0===c&&0===u){if(!bE(r,n))return}else if(d||f)if(d&&!f){if(!vE(n,r))return}else if(f&&!d){if(!vE(r,n))return}else{if(a===u)return;if(a>u){if(!mE(n,r))return}else if(!mE(r,n))return}else{if(0===a&&0===c){if(!yE(n,r))return}else if(0===u&&0===s&&!yE(r,n))return;if(0===a&&0===u)if(0===i[0]&&o[0]>0){if(!g)return;o[0]=0}else{if(!(0===o[0]&&i[0]>0))return;if(!l)return;i[0]=0}if(0===s&&0===c)if(0===i[1]&&o[1]>0){if(!p)return;o[1]=0}else{if(!(0===o[1]&&i[1]>0))return;if(!h)return;i[1]=0}}return{range1:i,range2:o}}(r,s);t&&(r.min=t.range1[0],r.max=t.range1[1],c.min=t.range2[0],c.max=t.range2[1])}n&&(d=o?function(t,e,i,o,n,r){const s=a_.getFunction("getAxisDomainRangeAndLabels"),{axisOption:a,isZeroAlign:l}=xE(e,i,0===o?"right":"left",r),{ticks:h}=s(t.min,t.max,a,l,"bottom"===n||"top"===n?r._table.getColWidth(e)||r._table.tableNoFrameWidth:r._table.getRowHeight(i)||r._table.tableNoFrameHeight);return h}(c,t,e,i,a,h):l)}return{targetTicks:d,targetRange:c}}(e,i,c.index,c.isZeroAlign,c.isTickAlign,c.range,h,u,d,l);if(0!==c.index&&p){const e=a_.getFunction("getAxisDomainRangeAndLabels"),{range:i,ticks:o}=e(c.range.min,c.range.max,c.axisOption,c.isZeroAlign,"bottom"===t||"top"===t?l._table.getColWidth(r)||l._table.tableNoFrameWidth:l._table.getRowHeight(s)||l._table.tableNoFrameHeight,{targetTicks:p,targetRange:g});c.range.min=i[0],c.range.max=i[1],c.ticks=o}return c.targetRange=g,c.targetTicks=p,c}function TE(t,e,i,o,n,r,s){const{axisOption:a,isPercent:l,isZeroAlign:h,isTickAlign:d,seriesIndice:c,theme:u,chartType:g}=xE(t,e,o,s),p=SE(s.dataset.collectedValues,n,h,r,null!=c?c:i);if(!p)return;l&&(p.min=p.min<0?-1:0,p.max=p.max>0?1:0),((null==a?void 0:a.zero)||p.min===p.max)&&(p.min=Math.min(p.min,0),p.max=Math.max(p.max,0));const f=a_.getFunction("getAxisDomainRangeAndLabels"),{range:v,ticks:b}=f(p.min,p.max,a,h,"bottom"===o||"top"===o?s._table.getColWidth(t)||s._table.tableNoFrameWidth:s._table.getRowHeight(e)||s._table.tableNoFrameHeight);(null==a?void 0:a.nice)&&(p.min=v[0],p.max=v[1]);const m=b;return ut(null==a?void 0:a.min)&&(p.min=a.min),ut(null==a?void 0:a.max)&&(p.max=a.max),{index:null!=c?c:i,range:p,ticks:m,isZeroAlign:h,isTickAlign:d,axisOption:a,theme:u,chartType:g}}!function(t){t.vertical="vertical",t.horizontal="horizontal"}(AE||(AE={}));class kE{constructor(t,e,i){this.table=t,this.customCellStyle=e,this.customCellStyleArrangement=i}getCustomCellStyle(t,e){const i=this.getCustomCellStyleIds(t,e);if(i.length){const o=[];return i.forEach((i=>{const n=this.getCustomCellStyleOption(i);if(et(null==n?void 0:n.style)){const i=n.style({col:t,row:e,table:this.table,value:this.table.getCellValue(t,e),dataValue:this.table.getCellOriginValue(t,e),cellHeaderPaths:this.table.getCellHeaderPaths(t,e)});o.push(i)}else(null==n?void 0:n.style)&&o.push(n.style)})),Tt({},...o)}}getCustomCellStyleIds(t,e){const i=[],o=this.table.getCellRange(t,e);for(let t=o.start.col;t<=o.end.col;t++)for(let e=o.start.row;e<=o.end.row;e++)this.customCellStyleArrangement.forEach((o=>{o.cellPosition.range?o.cellPosition.range.start.col<=t&&o.cellPosition.range.end.col>=t&&o.cellPosition.range.start.row<=e&&o.cellPosition.range.end.row>=e&&i.push(o.customStyleId):o.cellPosition.col===t&&o.cellPosition.row===e&&i.push(o.customStyleId)}));return i}getCustomCellStyleOption(t){return this.customCellStyle.find((e=>e.id===t))}registerCustomCellStyle(t,e){const i=this.customCellStyle.findIndex((e=>e.id===t));-1===i?this.customCellStyle.push({id:t,style:e}):this.customCellStyle[i]={id:t,style:e},this.customCellStyleArrangement.forEach((e=>{const i=e.cellPosition;if(e.customStyleId===t)if(i.range)for(let t=Math.max(0,i.range.start.col);t<=Math.min(this.table.colCount-1,i.range.end.col);t++)for(let e=Math.max(0,i.range.start.row);e<=Math.min(this.table.rowCount-1,i.range.end.row);e++)this.table.scenegraph.updateCellContent(t,e);else this.table.scenegraph.updateCellContent(i.col,i.row)})),this.table.scenegraph.updateNextFrame()}arrangeCustomCellStyle(t,e,i){var o;const n=this.customCellStyleArrangement.findIndex((e=>e.cellPosition.range&&t.range?e.cellPosition.range.start.col===t.range.start.col&&e.cellPosition.range.start.row===t.range.start.row&&e.cellPosition.range.end.col===t.range.end.col&&e.cellPosition.range.end.row===t.range.end.row:e.cellPosition.col===t.col&&e.cellPosition.row===t.row));if(-1===n&&!e)return;if(-1===n&&e)this.customCellStyleArrangement.push({cellPosition:{col:t.col,row:t.row,range:t.range},customStyleId:e});else{if(this.customCellStyleArrangement[n].customStyleId===e)return;e?this.customCellStyleArrangement[n].customStyleId=e:this.customCellStyleArrangement.splice(n,1)}const r=null===(o=this.getCustomCellStyleOption(e))||void 0===o?void 0:o.style;if(r){i=!0;for(const t in r)if(-1===tw.indexOf(t)){i=!1;break}}if(t.range)for(let e=Math.max(0,t.range.start.col);e<=Math.min(this.table.colCount-1,t.range.end.col);e++)for(let o=Math.max(0,t.range.start.row);o<=Math.min(this.table.rowCount-1,t.range.end.row);o++){const t=this.table.getCellRange(e,o);for(let e=t.start.col;e<=t.end.col;e++)for(let o=t.start.row;o<=t.end.row;o++)this.table.scenegraph.updateCellContent(e,o,i)}else this.table.scenegraph.updateCellContent(t.col,t.row,i);this.table.scenegraph.updateNextFrame()}updateCustomCell(t,e){this.customCellStyle.length=0,this.customCellStyleArrangement.length=0,t.forEach((t=>{this.registerCustomCellStyle(t.id,t.style)})),e.forEach((t=>{this.arrangeCustomCellStyle(t.cellPosition,t.customStyleId)}))}hasCustomCellStyle(t){return this.customCellStyle.some((e=>e.id===t))}}function ME(t,e){t=t.clone();for(const i in e){const o=e[i];ot(o)&&(t[`_${i}`]=o)}return t}const LE={};function PE(t){return Math.floor(t)===t}class EE extends Kn{onUpdate(t,e,i){if(this.from.x!==this.to.x){const i=t?this.to.x:this.from.x+Math.floor((this.to.x-this.from.x)*e);this.params.table.scrollLeft=i}if(this.from.y!==this.to.y){const i=t?this.to.y:this.from.y+Math.floor((this.to.y-this.from.y)*e);this.params.table.scrollTop=i}}}class HE{constructor(t){this.table=t,this.timeline=new Xn,this.ticker=new Un,this.ticker.addTimeline(this.timeline),this.ticker.setFPS(60),this.tempGraphic=oc({})}scrollTo(t,e){var i,o;const n={x:this.table.scrollLeft,y:this.table.scrollTop},{col:r,row:a}=t;let l,h,d=r,c=a;ut(r)&&!PE(r)&&(d=Math.floor(r),l=r-d),ut(a)&&!PE(a)&&(c=Math.floor(a),h=a-c);const u=this.table.getCellRect(null!=d?d:0,null!=c?c:0);let{left:g,top:p}=u;l&&(g+=l*u.width),h&&(p+=h*u.height);const f={x:ut(r)?g-this.table.getFrozenColsWidth():this.table.scrollLeft,y:ut(a)?p-this.table.getFrozenRowsHeight():this.table.scrollTop},v=tt(e)?e?3e3:0:null!==(i=null==e?void 0:e.duration)&&void 0!==i?i:3e3,b=tt(e)?e?"linear":"":null!==(o=null==e?void 0:e.easing)&&void 0!==o?o:"linear";new Zn(s.GenAutoIncrementId(),this.timeline).bind(this.tempGraphic).play(new EE(n,f,v,b,{graphic:this.tempGraphic,table:this.table})),this.ticker.start()}clear(){this.timeline.clear(),this.ticker.stop()}}function FE(t){return et(t)?t:ht(t)?(e,i)=>t.find((t=>t.range.start.col<=e&&t.range.end.col>=e&&t.range.start.row<=i&&t.range.end.row>=i)):void 0}const{toBoxArray:OE}=_x,{isTouchEvent:IE}=xx,zE=/^\$(\d+)\$(\d+)$/;!function(){if("node"===zw.mode)return;const t=document.createElement("style");t.id="vtable-style-styleSheet",t.textContent="\n.vtable .input-container {\n\tposition: absolute;\n\ttop:0px;\n}\n.vtable .table-scrollable {\n\tposition: absolute;\n\toverflow: scroll;\n}\n.vtable .table-scrollable::-webkit-scrollbar-button{\n\tbackground-color: transparent;\n}\n.vtable .table-scrollable::-webkit-scrollbar-track-piece{\n\tbackground-color: transparent;\n}\n.vtable .table-scrollable::-webkit-scrollbar-corner {\n\tbackground-color: transparent;\n}\n.vtable .table-scrollable::-webkit-scrollbar-thumb {\n\tborder-radius      : 4px;\n\tbackground-color   : rgba(100, 100, 100, .5);\n}\n\n.vtable .table-scroll-end-point {\n\topacity: 0;\n\tposition: relative;\n}\n.vtable {\n\t/* 设置overflow: auto 应该是为了滚动条的某个问题 但设置了auto之后 dom的下拉菜单只能显示在vtable节点中 超出会截断;现在去掉auto 暂时滚动条的问题没有发现 */\n\t/* overflow: auto; */\n\tposition: relative;\n\twidth: 100%;\n\theight: 100%;\n\ttext-align: left;\n  -webkit-font-smoothing:auto;\n\n  overflow: hidden; // for react-vtable dom custom element\n}\n\n.vtable-gantt {\n\t/* 设置overflow: auto 应该是为了滚动条的某个问题 但设置了auto之后 dom的下拉菜单只能显示在vtable节点中 超出会截断;现在去掉auto 暂时滚动条的问题没有发现 */\n\t/* overflow: auto; */\n\tposition: absolute;\n\twidth: 100%;\n\theight: 100%;\n\ttext-align: left;\n  -webkit-font-smoothing:auto;\n\n  overflow: hidden; // for react-vtable dom custom element\n}\n.vtable .table-component-container {\n  pointer-events: none;\n  overflow: hidden;\n  position: absolute;\n  top: 0px;\n  left: 0px;\n}\n.vtable > canvas {\n\tposition: absolute;\n\twidth: 0;\n\theight: 0;\n}\n.vtable .table-focus-control {\n\tposition: relative !important;\n\twidth: 1px;\n\theight: 1px;\n\topacity: 0;\n\tpadding: 0;\n\tmargin: 0;\n\tbox-sizing: border-box;\n\tpointer-events: none;\n\tmax-width: 500px;\n\tmax-height: 500px;\n\tfloat: none !important;\n}\n.vtable input.table-focus-control::-ms-clear {\n\tvisibility: hidden;\n}\n.vtable input.table-focus-control.composition {\n\topacity: 1;\n\tmax-width: none;\n\tmax-height: none;\n}\n",document.head.appendChild(t)}();class DE extends xw{static get EVENT_TYPE(){return Ax}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i,o,n,r,s,a,l,h,d,c,u,g,p,f,v,b;if(super(),this.showFrozenIcon=!0,this.version="1.17.6",this.id=`VTable${Date.now()}`,this.isReleased=!1,this._chartEventMap={},this.throttleInvalidate=function(t,e){let i=null;return function(){for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];i||(i=setTimeout((()=>{t.apply(this,n),i=null}),e))}}(this.render.bind(this),200),!t&&"node"!==e.mode&&!e.canvas)throw new Error("vtable's container is undefined");!1===(null===(i=e.customConfig)||void 0===i?void 0:i.imageAnonymous)&&(fu.isImageAnonymous=!1);const{frozenColCount:m=0,unfreezeAllOnExceedsMaxWidth:y,frozenRowCount:C,defaultRowHeight:w=40,defaultHeaderRowHeight:x,defaultColWidth:_=80,defaultHeaderColWidth:S,widthMode:A="standard",heightMode:B="standard",autoFillWidth:R=!1,autoFillHeight:T=!1,widthAdaptiveMode:k="only-body",heightAdaptiveMode:M="only-body",keyboardOptions:L,eventOptions:P,rowSeriesNumber:E,columnResizeMode:H,rowResizeMode:F="none",resize:O,dragHeaderMode:I,dragOrder:z,showFrozenIcon:D,allowFrozenColCount:W,padding:N,hover:G,menu:j,select:V,customRender:U,pixelRatio:$=cP,renderChartAsync:X,renderChartAsyncBatchCount:Y,mode:K,modeParams:q,canvasWidth:Z,canvasHeight:J,overscrollBehavior:Q,limitMinWidth:it,limitMinHeight:rt,clearDOM:st=!0}=e;this.container=t,this.options=e,this._widthMode=A,this._heightMode=B,this._widthAdaptiveMode=k,this._heightAdaptiveMode=M,this._autoFillWidth=R,this._autoFillHeight=T,this.customRender=U,this.padding={top:0,right:0,left:0,bottom:0},N&&("number"==typeof N?(this.padding.top=N,this.padding.left=N,this.padding.bottom=N,this.padding.right=N):(N.top&&(this.padding.top=N.top),N.bottom&&(this.padding.bottom=N.bottom),N.left&&(this.padding.left=N.left),N.right&&(this.padding.right=N.right))),(ot(J)||ot(Z))&&(this.canvasSizeSeted=!0),this.tableNoFrameWidth=0,this.tableNoFrameHeight=0,this.canvasWidth=ut(Z)?Z:void 0,this.canvasHeight=ut(J)?J:void 0,this.columnWidthComputeMode=null!==(o=e.columnWidthComputeMode)&&void 0!==o?o:"normal";const at=this.internalProps={};void 0!==D&&(this.showFrozenIcon=D),"number"==typeof W&&W<=0&&(this.showFrozenIcon=!1),this.options.canvas?("node"!==zw.mode&&(at.element=this.options.canvas.parentElement,at.element.style.position="relative"),at.focusControl=new iE(this,at.element),at.canvas=this.options.canvas,at.context=at.canvas.getContext("2d")):"node"!==zw.mode&&(at.element=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vtable";var i,o;const n=document.createElement("div");n.setAttribute("tabindex","0"),n.classList.add(e),n.style.outline="none",n.style.margin=`${t.top}px ${t.right}px ${t.bottom}px ${t.left}px`;const r=(n.offsetWidth||(null===(i=n.parentElement)||void 0===i?void 0:i.offsetWidth)||1)-1,s=(n.offsetHeight||(null===(o=n.parentElement)||void 0===o?void 0:o.offsetHeight)||1)-1;return n.style.width=r&&r-t.left-t.right+"px"||"0px",n.style.height=s&&s-t.top-t.bottom+"px"||"0px",n}(this.padding),at.focusControl=new iE(this,at.element),at.canvas=document.createElement("canvas"),at.element.appendChild(at.canvas),at.context=at.canvas.getContext("2d"),(null===(n=e.customConfig)||void 0===n?void 0:n.createReactContainer)&&function(t){const{internalProps:e}=t;e.bodyDomContainer=document.createElement("div"),e.bodyDomContainer.id="vtable-body-dom-container",e.bodyDomContainer.classList.add("table-component-container"),e.element.appendChild(e.bodyDomContainer),e.headerDomContainer=document.createElement("div"),e.headerDomContainer.id="vtable-header-dom-container",e.headerDomContainer.classList.add("table-component-container"),e.element.appendChild(e.headerDomContainer),e.frozenBodyDomContainer=document.createElement("div"),e.frozenBodyDomContainer.id="vtable-frozen-body-dom-container",e.frozenBodyDomContainer.classList.add("table-component-container"),e.element.appendChild(e.frozenBodyDomContainer),e.frozenHeaderDomContainer=document.createElement("div"),e.frozenHeaderDomContainer.id="vtable-frozen-header-dom-container",e.frozenHeaderDomContainer.classList.add("table-component-container"),e.element.appendChild(e.frozenHeaderDomContainer),e.rightFrozenBodyDomContainer=document.createElement("div"),e.rightFrozenBodyDomContainer.id="vtable-right-frozen-body-dom-container",e.rightFrozenBodyDomContainer.classList.add("table-component-container"),e.element.appendChild(e.rightFrozenBodyDomContainer),e.rightFrozenHeaderDomContainer=document.createElement("div"),e.rightFrozenHeaderDomContainer.id="vtable-right-frozen-header-dom-container",e.rightFrozenHeaderDomContainer.classList.add("table-component-container"),e.element.appendChild(e.rightFrozenHeaderDomContainer),e.frozenBottomDomContainer=document.createElement("div"),e.frozenBottomDomContainer.id="vtable-frozen-bottom-dom-container",e.frozenBottomDomContainer.classList.add("table-component-container"),e.element.appendChild(e.frozenBottomDomContainer),e.bottomDomContainer=document.createElement("div"),e.bottomDomContainer.id="vtable-bottom-dom-container",e.bottomDomContainer.classList.add("table-component-container"),e.element.appendChild(e.bottomDomContainer),e.rightFrozenBottomDomContainer=document.createElement("div"),e.rightFrozenBottomDomContainer.id="vtable-right-frozen-bottom-dom-container",e.rightFrozenBottomDomContainer.classList.add("table-component-container"),e.element.appendChild(e.rightFrozenBottomDomContainer)}(this)),at.handler=new kx,ut(this.options.resizeTime)&&(at.handler.resizeTime=this.options.resizeTime),at.pixelRatio=$,at.frozenColCount=m,at.frozenRowCount=C,at.unfreezeAllOnExceedsMaxWidth=null==y||y,at.defaultRowHeight=w,at.defaultHeaderRowHeight=null!=x?x:w,at.defaultColWidth=_,at.defaultHeaderColWidth=null!=S?S:_,at.keyboardOptions=L,at.eventOptions=P,at.rowSeriesNumber=E,at.columnResizeMode=null!==(r=null==O?void 0:O.columnResizeMode)&&void 0!==r?r:H,at.rowResizeMode=null!==(s=null==O?void 0:O.rowResizeMode)&&void 0!==s?s:F,at.dragHeaderMode=null!==(l=null!==(a=null==z?void 0:z.dragHeaderMode)&&void 0!==a?a:I)&&void 0!==l?l:"none",at.renderChartAsync=X,vk(Y),at.overscrollBehavior=null!=Q?Q:"auto",at._rowHeightsMap=new oE(this),at._rowRangeHeightsMap=new Map,at._colRangeWidthsMap=new Map,at._widthResizedColMap=new Set,at._heightResizedRowMap=new Set,this.colWidthsMap=new Lx,this.colContentWidthsMap=new Lx,this.colWidthsLimit={};const dt=this;if(at.calcWidthContext={_:at,get full(){var t;return"node"===zw.mode?dt.canvasWidth/(null!=$?$:1):this._.canvas.width/(null!==(t=this._.context.pixelRatio)&&void 0!==t?t:window.devicePixelRatio)}},at.cellTextOverflows={},at.focusedTable=!1,at.theme=n_.of(null!==(h=e.theme)&&void 0!==h?h:n_.DEFAULT),at.theme.isPivot=this.isPivotTable(),kR(at.theme.functionalIconsStyle),t?(st&&(t.innerHTML=""),t.appendChild(at.element),this._updateSize()):this._updateSize(),at.bodyHelper=new BP(this),at.headerHelper=new eE(this),at.rowSeriesNumberHelper=new rE(this),at.autoWrapText=e.autoWrapText,at.enableLineBreak=e.enableLineBreak,at.allowFrozenColCount=null!==(d=e.allowFrozenColCount)&&void 0!==d?d:0,at.limitMaxAutoWidth=null!==(c=e.limitMaxAutoWidth)&&void 0!==c?c:450,at.limitMinWidth=null!=it?"number"==typeof it?it:it?10:0:10,at.limitMinHeight=null!=rt?"number"==typeof rt?rt:rt?10:0:10,this.scenegraph=new zL(this),this.stateManager=new class{constructor(t){this.fastScrolling=!1,this.checkedState=new Map,this.headerCheckedState={},this._checkboxCellTypeFields=[],this._headerCheckFuncs={},this.radioState={},this.resetInteractionState=Rx((t=>{this.updateInteractionState(null!=t?t:JC.default)}),100),this.table=t,this.initState(),this.updateVerticalScrollBar=this.updateVerticalScrollBar.bind(this),this.updateHorizontalScrollBar=this.updateHorizontalScrollBar.bind(this)}initState(){this._initState(),this.setHoverState(),this.setSelectState(),this.setFrozenState()}updateOptionSetState(){this._updateOptionSetState(),this.setHoverState(),this.setSelectState(),this.setFrozenState()}_updateOptionSetState(){this.interactionState=JC.default,this.hoverIcon={col:-1,row:-1,icon:null},this.columnResize={col:-1,x:0,resizing:!1},this.rowResize={row:-1,y:0,resizing:!1},this.columnMove={colSource:-1,colTarget:-1,rowSource:-1,rowTarget:-1,x:0,y:0,moving:!1},this.menu={x:-1,y:-1,isShow:!1,itemList:[],bounds:new He,highlightIndex:-1,dropDownMenuHighlight:[]},this.sort=[{col:-1,row:-1,order:"normal"}],this.frozen={col:-1,row:-1},this.tablePosition={absoluteX:0,absoluteY:0},this.drill={col:-1,row:-1},this.sparkLine={col:-1,row:-1}}_initState(){this.interactionState=JC.default,this.select={highlightScope:QC.single,ranges:[],cellPos:{col:-1,row:-1},selecting:!1},this.fillHandle={isFilling:!1,startX:void 0,startY:void 0},this.hover={highlightScope:QC.single,cellPos:{col:-1,row:-1}},this.hoverIcon={col:-1,row:-1,icon:null},this.columnResize={col:-1,x:0,resizing:!1},this.rowResize={row:-1,y:0,resizing:!1},this.columnMove={colSource:-1,colTarget:-1,rowSource:-1,rowTarget:-1,x:0,y:0,moving:!1},this.menu={x:-1,y:-1,isShow:!1,itemList:[],bounds:new He,highlightIndex:-1,dropDownMenuHighlight:[]},this.sort=[{col:-1,row:-1,order:"normal"}],this.frozen={col:-1,row:-1},this.scroll={horizontalBarPos:0,verticalBarPos:0},this.tablePosition={absoluteX:0,absoluteY:0},this.drill={col:-1,row:-1},this.sparkLine={col:-1,row:-1}}setHoverState(){var t;const{highlightMode:e,disableHover:i,disableHeaderHover:o}=null!==(t=this.table.options.hover)&&void 0!==t?t:{highlightMode:"cell"};i?this.hover.highlightScope=QC.none:"cross"===e?this.hover.highlightScope=QC.cross:"row"===e?this.hover.highlightScope=QC.row:"column"===e?this.hover.highlightScope=QC.column:"cell"===e&&(this.hover.highlightScope=QC.single),this.hover.singleStyle=!i,this.hover.disableHeader=o,(this.hover.highlightScope===QC.none||o)&&(this.hover.cellPosContainHeader={col:-1,row:-1})}setSelectState(){var t,e,i,o,n;const{headerSelectMode:r,disableSelect:s,disableHeaderSelect:a,highlightMode:l,highlightInRange:h}=Object.assign({},{headerSelectMode:"inline",disableSelect:!1,disableHeaderSelect:!1,highlightMode:"cell",highlightInRange:!1},this.table.options.select),d=(null===(t=this.table.options.select)||void 0===t?void 0:t.cornerHeaderSelectMode)?null===(e=this.table.options.select)||void 0===e?void 0:e.cornerHeaderSelectMode:"body"===(null===(i=this.table.options.select)||void 0===i?void 0:i.headerSelectMode)?null===(o=this.table.options.select)||void 0===o?void 0:o.headerSelectMode:"all";this.select.highlightScope=!0===s?QC.none:"cross"===l?QC.cross:"row"===l?QC.row:"column"===l?QC.column:QC.single,this.select.singleStyle=!s,this.select.disableHeader=a,this.select.headerSelectMode=r,this.select.cornerHeaderSelectMode=d,this.select.highlightInRange=h,this.select.disableCtrlMultiSelect=!1===(null===(n=this.table.options.keyboardOptions)||void 0===n?void 0:n.ctrlMultiSelect)}isSelected(t,e){let i=!1;return this.select.ranges.forEach((o=>{vx(o,t,e)&&(i=!0)})),i}setSortState(t){const e=this,i=(t=!t||Array.isArray(t)?t:[t])&&t.reduce(((t,i)=>{var o,n,r;const s=null===(o=function(t){const i=[];return function t(o){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;o.forEach((o=>{var r;const s=o.startInTotal?null!==(r=o.startInTotal+e.table.internalProps.layoutMap.leftRowSeriesNumberColumnCount)&&void 0!==r?r:0:n;o.columns?t(o.columns,s):i.push(Object.assign(Object.assign({},o),{startIndex:s}))}))}(t),i}(this.table.internalProps.columns))||void 0===o?void 0:o.find((t=>(null==t?void 0:t.field)===(null==i?void 0:i.field)));return this.table.internalProps.transpose?t.push({field:i.field,order:i.order,row:null!==(n=(null==s?void 0:s.startInTotal)+this.table.internalProps.layoutMap.leftRowSeriesNumberColumnCount)&&void 0!==n?n:0,col:null==s?void 0:s.level}):t.push({field:i.field,order:i.order,col:null!==(r=(null==s?void 0:s.startInTotal)+this.table.internalProps.layoutMap.leftRowSeriesNumberColumnCount)&&void 0!==r?r:0,row:null==s?void 0:s.level}),t}),[]);this.sort=i||[]}setFrozenState(){this.frozen.col=this.table.frozenColCount-1}updateInteractionState(t){if(this.interactionState===t)return;t===JC.scrolling&&(this.interactionStateBeforeScroll=this.interactionState);const e=this.interactionState;this.interactionState=t,e===JC.scrolling&&JC.default}updateHoverhighlightScope(t){this.hover.highlightScope!==t&&(this.hover.highlightScope=t)}updateHoverPos(t,e){VL(this,t,e)}updateSelectPos(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];-1!==e&&-1!==e&&(this.select.selecting=!0),t<0&&(t=-1),e<0&&(e=-1),t>this.table.colCount-1&&(t=this.table.colCount-1),e>this.table.rowCount-1&&(e=this.table.rowCount-1),function(t,e,i,o,n,r){let s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],a=arguments.length>7&&void 0!==arguments[7]&&arguments[7];var l,h;const{table:d,interactionState:c}=t,{scenegraph:u}=d,{highlightScope:g,disableHeader:p,cellPos:f,disableCtrlMultiSelect:v}=t.select;if(-1!==e&&-1!==i&&s&&d._makeVisibleCell(e,i),-1!==e&&-1!==i&&s)if(c===JC.grabing&&t.select.ranges.length>0){const o=t.select.ranges[t.select.ranges.length-1];e>o.start.col&&e>o.end.col&&d._makeVisibleCell(e+1,i),i>o.start.row&&i>o.end.row&&d._makeVisibleCell(e,i+1),e<o.start.col&&e<o.end.col&&d._makeVisibleCell(e-1,i),i<o.start.row&&i<o.end.row&&d._makeVisibleCell(e,i-1)}else d._makeVisibleCell(e,i);if(r){t.select.ranges=[],u.deleteAllSelectBorder();let e=0,i=0;const{disableHeaderSelect:o,disableRowSeriesNumberSelect:n}=(null===(l=d.options.keyboardOptions)||void 0===l?void 0:l.selectAllOnCtrlA)||{};o&&(e=d.rowHeaderLevelCount,i=d.columnHeaderLevelCount),(n||o&&d.transpose)&&d.options.rowSeriesNumber&&(e+=1),t.select.ranges.push({start:{col:e,row:i},end:{col:d.colCount-1,row:d.rowCount-1}});const r=t.select.ranges[t.select.ranges.length-1];u.updateCellSelectBorder(r,!1)}else if(-1===f.col||-1===f.row||-1!==e&&-1!==i)if(c!==JC.default||d.eventManager.isDraging||d.stateManager.isResizeCol()){if((c===JC.grabing||d.eventManager.isDraging)&&!d.stateManager.isResizeCol()){let o=!0;-1===f.col&&(f.col=e),-1===f.row&&(f.row=i),f.col=e,f.row=i;const n=t.select.ranges[t.select.ranges.length-1];if(n){if(d.internalProps.layoutMap.isSeriesNumberInBody(n.start.col,n.start.row))o=!1,n.end={col:d.colCount-1,row:i};else if(t.fillHandle.isFilling){if("top"===t.fillHandle.direction)if(i===t.fillHandle.beforeFillMinRow&&i===t.fillHandle.beforeFillMaxRow)n.start.row=n.end.row=i;else if(i<=t.fillHandle.beforeFillMinRow){if(n.start.row<n.end.row){const t=n.start.row;n.start.row=n.end.row,n.end.row=t}n.end.row=i}else i===t.fillHandle.beforeFillMaxRow&&(n.start.row>n.end.row?n.start.row=i:n.end.row=i);else if("bottom"===t.fillHandle.direction){if(i>=t.fillHandle.beforeFillMaxRow){if(n.start.row>n.end.row){const t=n.start.row;n.start.row=n.end.row,n.end.row=t}n.end.row=i}}else if("left"===t.fillHandle.direction)if(e===t.fillHandle.beforeFillMinCol&&e===t.fillHandle.beforeFillMaxCol)n.start.col=n.end.col=e;else if(e<=t.fillHandle.beforeFillMinCol){if(n.start.col<n.end.col){const t=n.start.col;n.start.col=n.end.col,n.end.col=t}n.end.col=e}else e===t.fillHandle.beforeFillMaxCol&&(n.start.col>n.end.col?n.start.col=e:n.end.col=e);else if("right"===t.fillHandle.direction&&e>=t.fillHandle.beforeFillMaxCol){if(n.start.col>n.end.col){const t=n.start.col;n.start.col=n.end.col,n.end.col=t}n.end.col=e}}else{n.end={col:e,row:i};const o=a?{start:{col:e,row:i},end:{col:e,row:i}}:d.getCellRange(e,i);n.start.col<o.end.col?n.end.col=o.end.col:n.start.col>o.start.col&&(n.end.col=o.start.col),n.start.row<o.end.row?n.end.row=o.end.row:n.start.row>o.start.row&&(n.end.row=o.start.row),"body"===t.select.headerSelectMode&&(d.isRowHeader(e,i)?(n.start.col=d.rowHeaderLevelCount+d.leftRowSeriesNumberCount,n.end.col=d.colCount-1):d.isColumnHeader(e,i)?(n.start.row=d.columnHeaderLevelCount,n.end.row=d.rowCount-1):d.internalProps.layoutMap.isSeriesNumberInBody(e,i)?(n.start.col=d.leftRowSeriesNumberCount,n.end.col=d.colCount-1):d.isCornerHeader(e,i)?(n.start.col=d.rowHeaderLevelCount+d.leftRowSeriesNumberCount,n.start.row=d.columnHeaderLevelCount,n.end.col=d.colCount-1,n.end.row=d.rowCount-1):d.isSeriesNumber(e,i)&&(n.start.col=d.leftRowSeriesNumberCount,n.start.row=d.columnHeaderLevelCount,n.end.col=d.colCount-1,n.end.row=d.rowCount-1)),a&&(n.skipBodyMerge=!0)}n&&n.start.row<=d.rowCount-1&&n.end.row<=d.rowCount-1&&n.start.col<=d.colCount-1&&n.end.col<=d.colCount-1&&u.updateCellSelectBorder(n,o)}}}else{const r=t.select.ranges[t.select.ranges.length-1];if(o&&r){if(n&&!v||(f.col=e,f.row=i),"cell"!==t.select.headerSelectMode&&d.isColumnHeader(e,i)){const o=Math.min(r.start.col,r.end.col,e),n=Math.max(r.start.col,r.end.col,e),s=Math.min(r.start.row,r.end.row,i),a=d.rowCount-1;"body"===t.select.headerSelectMode?(r.start={col:o,row:d.columnHeaderLevelCount},r.end={col:n,row:d.rowCount-1}):(r.start={col:o,row:s},r.end={col:n,row:a})}else if("cell"!==t.select.headerSelectMode&&d.isRowHeader(e,i)){const o=Math.min(r.start.col,r.end.col,e),n=d.colCount-1,s=Math.min(r.start.row,r.end.row,i),a=Math.max(r.start.row,r.end.row,i);"body"===t.select.headerSelectMode?(r.start={col:d.leftRowSeriesNumberCount+d.rowHeaderLevelCount,row:s},r.end={col:d.colCount-1,row:a}):(r.start={col:o,row:s},r.end={col:n,row:a})}else if("cell"!==t.select.headerSelectMode&&d.isSeriesNumberInBody(e,i)){const o=Math.min(r.start.col,r.end.col,e),n=d.colCount-1,s=Math.min(r.start.row,r.end.row,i),a=Math.max(r.start.row,r.end.row,i);"body"===t.select.headerSelectMode?(r.start={col:d.leftRowSeriesNumberCount,row:s},r.end={col:d.colCount-1,row:a}):(r.start={col:o,row:s},r.end={col:n,row:a})}else r.end={col:e,row:i};u.deleteLastSelectedRangeComponents(),u.updateCellSelectBorder(r)}else{let o=!0;if(-1===f.col||-1===f.row||n&&!v||(t.select.ranges=[],u.deleteAllSelectBorder()),"cell"!==t.select.headerSelectMode&&d.isColumnHeader(e,i)){const o=d.getCellRange(e,i);"body"===t.select.headerSelectMode?t.select.ranges.push({start:{col:o.start.col,row:d.columnHeaderLevelCount},end:{col:o.end.col,row:d.rowCount-1},skipBodyMerge:!0}):t.select.ranges.push({start:{col:o.start.col,row:o.start.row},end:{col:o.end.col,row:d.rowCount-1},skipBodyMerge:!0})}else if("cell"!==t.select.headerSelectMode&&d.isRowHeader(e,i)){const o=d.getCellRange(e,i);"body"===t.select.headerSelectMode?t.select.ranges.push({start:{col:d.rowHeaderLevelCount+d.leftRowSeriesNumberCount,row:o.start.row},end:{col:d.colCount-1,row:o.end.row},skipBodyMerge:!0}):t.select.ranges.push({start:{col:o.start.col,row:o.start.row},end:{col:d.colCount-1,row:o.end.row},skipBodyMerge:!0})}else if(d.internalProps.layoutMap.isSeriesNumberInHeader(e,i)){o=!1;const{cornerHeaderSelectMode:n}=t.select;if("body"===n)t.select.ranges.push({start:{col:d.leftRowSeriesNumberCount,row:d.columnHeaderLevelCount},end:{col:d.colCount-1,row:d.rowCount-1},skipBodyMerge:!0});else if("inline"===n){const o=a?{start:{col:e,row:i},end:{col:e,row:i}}:d.getCellRange(e,i);t.select.ranges.push({start:{col:o.start.col,row:o.start.row},end:{col:o.end.col,row:d.rowCount-1},skipBodyMerge:!0})}else if("cell"===n){const o=a?{start:{col:e,row:i},end:{col:e,row:i}}:d.getCellRange(e,i);t.select.ranges.push({start:{col:o.start.col,row:o.start.row},end:{col:o.end.col,row:o.end.row},skipBodyMerge:a||void 0})}else t.select.ranges.push({start:{col:0,row:0},end:{col:d.colCount-1,row:d.rowCount-1},skipBodyMerge:!0})}else if(d.internalProps.layoutMap.isSeriesNumberInBody(e,i))o=!1,"body"===t.select.headerSelectMode?t.select.ranges.push({start:{col:d.leftRowSeriesNumberCount,row:i},end:{col:d.colCount-1,row:i},skipBodyMerge:!0}):t.select.ranges.push({start:{col:e,row:i},end:{col:d.colCount-1,row:i},skipBodyMerge:!0});else if(d.internalProps.layoutMap.isCornerHeader(e,i)){o=!1;const{cornerHeaderSelectMode:n}=t.select;if("body"===n)t.select.ranges.push({start:{col:d.rowHeaderLevelCount+d.leftRowSeriesNumberCount,row:d.columnHeaderLevelCount},end:{col:d.colCount-1,row:d.rowCount-1},skipBodyMerge:!0});else if("cell"===n){const o=a?{start:{col:e,row:i},end:{col:e,row:i}}:d.getCellRange(e,i);t.select.ranges.push({start:{col:o.start.col,row:o.start.row},end:{col:o.end.col,row:o.end.row},skipBodyMerge:a||void 0})}else if("inline"===n){const o=a?{start:{col:e,row:i},end:{col:e,row:i}}:d.getCellRange(e,i);t.select.ranges.push({start:{col:o.start.col,row:o.start.row},end:{col:o.end.col,row:d.rowCount-1},skipBodyMerge:!0})}else t.select.ranges.push({start:{col:d.leftRowSeriesNumberCount,row:0},end:{col:d.colCount-1,row:d.rowCount-1},skipBodyMerge:!0})}else if(e>=0&&i>=0){const o=a?{start:{col:e,row:i},end:{col:e,row:i}}:d.getCellRange(e,i);t.select.ranges.push({start:{col:o.start.col,row:o.start.row},end:{col:o.end.col,row:o.end.row},skipBodyMerge:a||void 0})}f.col=e,f.row=i;const r=null===(h=t.select.ranges)||void 0===h?void 0:h[t.select.ranges.length-1];r&&r.start.row<=d.rowCount-1&&r.end.row<=d.rowCount-1&&r.start.col<=d.colCount-1&&r.end.col<=d.colCount-1&&u.updateCellSelectBorder(r,o)}}else f.col=-1,f.row=-1,t.select.ranges=[],u.deleteAllSelectBorder();u.updateNextFrame()}(this,t,e,i,o,n,r,s)}checkCellRangeInSelect(t,e){return function(t,e,i,o){for(let o=0;o<i.length;o++)if(mx(i[o],{start:t,end:e}))return!0;return!1}(t,e,this.select.ranges,this.select.highlightScope)}updateHoverIcon(t,e,i,o){var n,r,s,a,l,h,d,c,u;if((null===(n=this.residentHoverIcon)||void 0===n?void 0:n.icon)&&i===(null===(r=this.residentHoverIcon)||void 0===r?void 0:r.icon))return;const g=KL(i);if(g)if("richtext-icon"===g.type){const i=g.icon;if(this.hoverIcon.icon&&this.hoverIcon.icon!==(null===(a=this.residentHoverIcon)||void 0===a?void 0:a.icon)&&(this.table.scenegraph.setIconNormalStyle(this.hoverIcon.icon,this.hoverIcon.col,this.hoverIcon.row),this.hoverIcon.col=-1,this.hoverIcon.col=-1,this.hoverIcon.icon=null,this.table.scenegraph.updateNextFrame()),i.attribute.tooltip){const o={content:i.attribute.tooltip.title,referencePosition:{rect:g.position,placement:i.attribute.tooltip.placement},style:Object.assign({},null===(l=this.table.internalProps.theme)||void 0===l?void 0:l.tooltipStyle,null===(h=i.tooltip)||void 0===h?void 0:h.style,null===(c=null===(d=i.attribute)||void 0===d?void 0:d.tooltip)||void 0===c?void 0:c.style),disappearDelay:i.attribute.tooltip.disappearDelay};this.table.internalProps.tooltipHandler.isBinded(o)||this.table.showTooltip(t,e,o)}}else{const i=g.icon;i!==this.hoverIcon.icon&&(this.hoverIcon.icon&&this.hoverIcon.icon!==(null===(u=this.residentHoverIcon)||void 0===u?void 0:u.icon)&&this.table.scenegraph.setIconNormalStyle(this.hoverIcon.icon,this.hoverIcon.col,this.hoverIcon.row),this.hoverIcon.col=t,this.hoverIcon.row=e,this.hoverIcon.icon=i,this.table.scenegraph.setIconHoverStyle(i,t,e,o),this.table.scenegraph.updateNextFrame())}else this.hoverIcon.icon&&this.hoverIcon.icon!==(null===(s=this.residentHoverIcon)||void 0===s?void 0:s.icon)&&(this.table.scenegraph.setIconNormalStyle(this.hoverIcon.icon,this.hoverIcon.col,this.hoverIcon.row),this.hoverIcon.col=-1,this.hoverIcon.col=-1,this.hoverIcon.icon=null,this.table.scenegraph.updateNextFrame())}isResizeCol(){return this.columnResize.resizing}isResizeRow(){return this.rowResize.resizing}isFillHandle(){return this.fillHandle.isFilling}isSelecting(){return this.select.selecting}endSelectCells(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.select.selecting){if(this.select.selecting=!1,0===this.select.ranges.length)return;const e=this.select.ranges[this.select.ranges.length-1];this.table.isSeriesNumber(this.select.cellPos.col,this.select.cellPos.row)||this.table.isHeader(this.select.cellPos.col,this.select.cellPos.row)||function(t,e){const i=t.start.col,o=t.end.col,n=t.start.row,r=t.end.row;let s=i,a=o,l=n,h=r;for(let t=i;t<=o;t++)for(let i=n;i<=r;i++){const o=e.getCellRange(t,i);o&&(s=Math.min(s,o.start.col),a=Math.max(a,o.end.col),l=Math.min(l,o.start.row),h=Math.max(h,o.end.row))}t.start.col=s,t.end.col=a,t.start.row=l,t.end.row=h}(e,this.table);let i=!1;for(let t=0;t<this.select.ranges.length-1;t++){const o=this.select.ranges[t];if(o&&o.start.col===e.start.col&&o.start.row===e.start.row&&o.end.col===e.end.col&&o.end.row===e.end.row){i=!0;break}}i?(this.select.ranges.pop(),nL(this.table.scenegraph),this.table.scenegraph.selectingRangeComponents.clear()):this.table.scenegraph.moveSelectingRangeComponentsToSelectedRangeComponents();const o=this.select.ranges[this.select.ranges.length-1].end.col,n=this.select.ranges[this.select.ranges.length-1].end.row;t&&this.table.fireListeners(Ax.SELECTED_CELL,{ranges:this.select.ranges,col:o,row:n})}else e&&0===this.select.ranges.length&&this.table.fireListeners(Ax.SELECTED_CLEAR,{})}endResizeCol(){setTimeout((()=>{this.columnResize.resizing=!1}),0),this.table.scenegraph.updateChartSizeForResizeColWidth(this.columnResize.col),this.checkFrozen(),this.table.scenegraph.component.hideResizeCol(),this.table.scenegraph.updateNextFrame()}startResizeCol(t,e,i,o){this.columnResize.resizing=!0,this.columnResize.col=t,this.columnResize.x=e,this.columnResize.isRightFrozen=o,this.table.scenegraph.component.showResizeCol(t,i,o),this.table.scenegraph.updateNextFrame()}updateResizeCol(t,e){!function(t,e,i){t=Math.ceil(t),e=Math.ceil(e);let o=i.columnResize.isRightFrozen?i.columnResize.x-t:t-i.columnResize.x;if(Math.abs(o)<1)return;const n=i.table.getColWidth(i.columnResize.col);let r=n;r+=o;const s=i.table.getMinColWidth(i.columnResize.col),a=i.table.getMaxColWidth(i.columnResize.col);if(r<s||r>a){if(n===s||n===a)return;o=n-s>a-n?a-n:s-n}let l=i.table.getColWidth(i.columnResize.col)+o;if(l<i.table.internalProps.limitMinWidth&&(l=i.table.internalProps.limitMinWidth,o=l-i.table.getColWidth(i.columnResize.col)),"adaptive"===i.table.widthMode&&i.columnResize.col<i.table.colCount-1){const t=i.table.getColWidth(i.columnResize.col+1),e=i.table.getMinColWidth(i.columnResize.col+1),n=i.table.getMaxColWidth(i.columnResize.col+1);let r=t;if(r-=o,r<e||r>n){if(t===e||t===n)return;o=t-e>n-t?n-t:e-t}r-o<i.table.internalProps.limitMinWidth&&(o=r-i.table.internalProps.limitMinWidth)}o=Math.ceil(o),i.columnResize.col<i.table.rowHeaderLevelCount||i.columnResize.col>=i.table.colCount-i.table.rightFrozenColCount?qL(o,i):"indicator"===i.table.internalProps.columnResizeType?function(t,e){const i=e.table.internalProps.layoutMap;let o,n,r;if(i.indicatorsAsCol)o=i.getIndicatorKey(e.columnResize.col,e.table.columnHeaderLevelCount);else{const t=i.getCellHeaderPaths(e.columnResize.col,e.table.columnHeaderLevelCount-1),o=t.colHeaderPaths[t.colHeaderPaths.length-1];n=o.dimensionKey,r=o.value}for(let s=e.table.rowHeaderLevelCount;s<e.table.colCount-e.table.rightFrozenColCount;s++){const a=i.getIndicatorKey(s,e.table.columnHeaderLevelCount);if(i.indicatorsAsCol&&a===o)e.table.scenegraph.updateColWidth(s,t),e.table.internalProps._widthResizedColMap.add(s);else if(!i.indicatorsAsCol){const o=i.getCellHeaderPaths(s,e.table.columnHeaderLevelCount-1),a=null==o?void 0:o.colHeaderPaths[o.colHeaderPaths.length-1];a&&n===a.dimensionKey&&r===a.value&&(e.table.scenegraph.updateColWidth(s,t),e.table.internalProps._widthResizedColMap.add(s))}}}(o,i):"indicatorGroup"===i.table.internalProps.columnResizeType?function(t,e){const i=e.table.internalProps.layoutMap,o=i.getCellHeaderPaths(e.columnResize.col,e.table.columnHeaderLevelCount),n=i.getHeadNodeByRowOrColDimensions(o.colHeaderPaths.slice(0,o.colHeaderPaths.length-1)),r=n.startInTotal+e.table.frozenColCount,s=n.startInTotal+e.table.frozenColCount+n.size-1,a=e.table.getColsWidth(r,s),l=t;for(let t=r;t<=s;t++){if(!(e.table.internalProps.transpose||e.table.isPivotTable()&&!i.indicatorsAsCol)){const o=i.getBody(t,e.table.columnHeaderLevelCount);if(null==o?void 0:o.disableColumnResize)continue}let o=e.table.getColWidth(t)/a*l;o>0&&o<.5?o=.5:o<0&&o>=-.5&&(o=-.5),e.table.scenegraph.updateColWidth(t,o),e.table.internalProps._widthResizedColMap.add(t)}}(o,i):"all"===i.table.internalProps.columnResizeType?function(t,e){const i=e.table.internalProps.layoutMap;for(let o=e.table.frozenColCount;o<e.table.colCount-e.table.rightFrozenColCount;o++){if(!(e.table.internalProps.transpose||e.table.isPivotTable()&&!i.indicatorsAsCol)){const t=i.getBody(o,e.table.columnHeaderLevelCount);if(null==t?void 0:t.disableColumnResize)continue}e.table.scenegraph.updateColWidth(o,t),e.table.internalProps._widthResizedColMap.add(o)}}(o,i):qL(o,i),i.columnResize.x=t,i.table.scenegraph.component.updateResizeCol(i.columnResize.col,e,i.columnResize.isRightFrozen),i.columnResize.col<i.table.frozenColCount&&!i.table.isPivotTable()&&!i.table.transpose?i.table.scenegraph.component.setFrozenColumnShadow(i.table.frozenColCount-1,i.columnResize.isRightFrozen):i.table.options.frozenColCount&&i.table.scenegraph.component.setFrozenColumnShadow(i.table.frozenColCount-1),(i.columnResize.col>=i.table.colCount-i.table.rightFrozenColCount&&!i.table.isPivotTable()&&!i.table.transpose||i.table.options.rightFrozenColCount)&&i.table.scenegraph.component.setRightFrozenColumnShadow(i.table.colCount-i.table.rightFrozenColCount),i.table.scenegraph.updateNextFrame()}(t,e,this)}endResizeRow(){setTimeout((()=>{this.rowResize.resizing=!1}),0),this.table.scenegraph.updateChartSizeForResizeRowHeight(this.rowResize.row),this.table.scenegraph.component.hideResizeRow(),this.table.scenegraph.updateNextFrame()}startResizeRow(t,e,i,o){this.rowResize.resizing=!0,this.rowResize.row=t,this.rowResize.y=i,this.rowResize.isBottomFrozen=o,this.table.scenegraph.component.showResizeRow(t,e,o),this.table.scenegraph.updateNextFrame()}updateResizeRow(t,e){!function(t,e,i){t=Math.ceil(t),e=Math.ceil(e);let o=i.rowResize.isBottomFrozen?i.rowResize.y-e:e-i.rowResize.y;if(Math.abs(o)<1)return;i.table.getRowHeight(i.rowResize.row);let n=i.table.getRowHeight(i.rowResize.row)+o;if(n<i.table.internalProps.limitMinHeight&&(n=i.table.internalProps.limitMinHeight,o=n-i.table.getRowHeight(i.rowResize.row)),"adaptive"===i.table.heightMode&&i.rowResize.row<i.table.rowCount-1){let t=i.table.getRowHeight(i.rowResize.row+1);t-=o,t-o<i.table.internalProps.limitMinHeight&&(o=t-i.table.internalProps.limitMinHeight)}o=Math.ceil(o),i.rowResize.row<i.table.columnHeaderLevelCount||i.rowResize.row>=i.table.rowCount-i.table.bottomFrozenRowCount?tP(o,i):"indicator"===i.table.internalProps.rowResizeType?function(t,e){var i,o;const n=e.table.internalProps.layoutMap;let r,s,a;if(n.indicatorsAsCol){const t=n.getCellHeaderPaths(e.table.rowHeaderLevelCount-1,e.rowResize.row),o=null===(i=t.rowHeaderPaths)||void 0===i?void 0:i[t.rowHeaderPaths.length-1];s=null==o?void 0:o.dimensionKey,a=null==o?void 0:o.value}else r=n.getIndicatorKey(e.table.rowHeaderLevelCount,e.rowResize.row);for(let i=e.table.columnHeaderLevelCount;i<e.table.rowCount-e.table.bottomFrozenRowCount;i++){const l=n.getIndicatorKey(e.table.rowHeaderLevelCount,i);if(n.indicatorsAsCol||l!==r){if(n.indicatorsAsCol){const r=n.getCellHeaderPaths(e.table.rowHeaderLevelCount-1,i),l=null===(o=null==r?void 0:r.rowHeaderPaths)||void 0===o?void 0:o[r.rowHeaderPaths.length-1];l&&s===l.dimensionKey&&a===l.value&&(e.table.scenegraph.updateRowHeight(i,t),e.table.internalProps._heightResizedRowMap.add(i))}}else e.table.scenegraph.updateRowHeight(i,t),e.table.internalProps._heightResizedRowMap.add(i)}}(o,i):"indicatorGroup"===i.table.internalProps.rowResizeType?function(t,e){const i=e.table.internalProps.layoutMap,o=i.getCellHeaderPaths(e.table.rowHeaderLevelCount,e.rowResize.row),n=i.getHeadNodeByRowOrColDimensions(o.rowHeaderPaths.slice(0,o.rowHeaderPaths.length-1)),r=n.startInTotal+e.table.frozenRowCount,s=n.startInTotal+e.table.frozenRowCount+n.size-1,a=e.table.getRowsHeight(r,s),l=t;for(let t=r;t<=s;t++){let i=e.table.getRowHeight(t)/a*l;i>0&&i<.5?i=.5:i<0&&i>=-.5&&(i=-.51),e.table.scenegraph.updateRowHeight(t,i),e.table.internalProps._heightResizedRowMap.add(t)}}(o,i):"all"===i.table.internalProps.rowResizeType?function(t,e){for(let i=e.table.frozenRowCount;i<e.table.rowCount-e.table.bottomFrozenRowCount;i++)e.table.scenegraph.updateRowHeight(i,t),e.table.internalProps._heightResizedRowMap.add(i)}(o,i):tP(o,i),i.rowResize.y=e,i.table.scenegraph.component.updateResizeRow(i.rowResize.row,t,i.rowResize.isBottomFrozen),i.table.scenegraph.updateNextFrame()}(t,e,this)}startFillSelect(t,e){this.fillHandle.isFilling=!0,this.fillHandle.startX=t,this.fillHandle.startY=e;const i=this.select.ranges[this.select.ranges.length-1];this.fillHandle.beforeFillMinCol=Math.min(i.start.col,i.end.col),this.fillHandle.beforeFillMinRow=Math.min(i.start.row,i.end.row),this.fillHandle.beforeFillMaxCol=Math.max(i.start.col,i.end.col),this.fillHandle.beforeFillMaxRow=Math.max(i.start.row,i.end.row),this.table.fireListeners(Ax.MOUSEDOWN_FILL_HANDLE,{})}endFillSelect(){this.fillHandle.isFilling=!1,this.fillHandle.startX=void 0,this.fillHandle.startY=void 0,this.fillHandle.directionRow=void 0;const t=Math.min(this.select.ranges[0].start.col,this.select.ranges[0].end.col),e=Math.min(this.select.ranges[0].start.row,this.select.ranges[0].end.row),i=Math.max(this.select.ranges[0].start.col,this.select.ranges[0].end.col),o=Math.max(this.select.ranges[0].start.row,this.select.ranges[0].end.row);this.fillHandle.beforeFillMinCol===t&&this.fillHandle.beforeFillMinRow===e&&this.fillHandle.beforeFillMaxCol===i&&this.fillHandle.beforeFillMaxRow===o||this.table.eventManager.isDraging&&this.table.fireListeners(Ax.DRAG_FILL_HANDLE_END,{direction:this.fillHandle.direction}),this.fillHandle.beforeFillMaxCol=void 0,this.fillHandle.beforeFillMaxRow=void 0,this.fillHandle.beforeFillMinCol=void 0,this.fillHandle.beforeFillMinRow=void 0}startMoveCol(t,e,i,o,n){!function(t,e,i,o,n,r){var s;if(!("canMoveHeaderPosition"in n.table.internalProps.layoutMap))return;n.columnMove.moving=!0,n.columnMove.colSource=t,n.columnMove.rowSource=e,n.columnMove.x=i-n.table.tableX,n.columnMove.y=o-n.table.tableY;const a=n.table.getCellLocation(t,e),l="columnHeader"===a?n.columnMove.x:"rowHeader"===a||n.table.internalProps.layoutMap.isSeriesNumberInBody(t,e)?n.columnMove.y:0,{backX:h,lineX:d,backY:c,lineY:u}=n.table.scenegraph.component.showMoveCol(t,e,l);n.table.fireListeners(Ax.CHANGE_HEADER_POSITION_START,{col:t,row:e,x:i,y:o,backX:h,lineX:d,backY:c,lineY:u,event:r});const g=!!(null===(s=n.select.ranges)||void 0===s?void 0:s.length);n.table.stateManager.updateSelectPos(-1,-1),n.table.stateManager.endSelectCells(!0,g),n.table.scenegraph.updateNextFrame()}(t,e,i,o,this,n)}updateMoveCol(t,e,i,o,n){!function(t,e,i,o,n,r){if(!("canMoveHeaderPosition"in n.table.internalProps.layoutMap))return;const s=function(t,e,i){const o=i.getCellRange(t.col,t.row);if(i.isColumnHeader(t.col,t.row)){const n=i.getCellRange(e.col,o.start.row);e.row>=i.columnHeaderLevelCount&&(e.row=i.columnHeaderLevelCount-1),e.col>=t.col?e.col=n.end.col:e.col=n.start.col}else if(i.isRowHeader(t.col,t.row)){const n=i.internalProps.layoutMap,r=i.getCellRange(o.start.col,e.row);if(e.col>=i.rowHeaderLevelCount+n.leftRowSeriesNumberColumnCount&&(e.col=i.rowHeaderLevelCount+n.leftRowSeriesNumberColumnCount-1),"tree"===n.rowHierarchyType){const o=n.getCellHeaderPathsWithTreeNode(t.col,t.row).rowHeaderPaths,r=n.getCellHeaderPathsWithTreeNode(e.col,e.row).rowHeaderPaths;if(o.length<=r.length){const n=r[o.length-1];n&&(e.row>=t.row?e.row=n.startInTotal+n.size-1+i.columnHeaderLevelCount:e.row=n.startInTotal+i.columnHeaderLevelCount)}}else e.row>=t.row?e.row=r.end.row:e.row=r.start.row}return e}({col:n.columnMove.colSource,row:n.columnMove.rowSource},{col:t,row:e},n.table);if(n.table.internalProps.layoutMap.canMoveHeaderPosition({col:n.columnMove.colSource,row:n.columnMove.rowSource},{col:s.col,row:s.row})){let a,l,h,d;n.columnMove.x=i-n.table.tableX,n.columnMove.y=o-n.table.tableY,n.columnMove.colTarget=s.col,n.columnMove.rowTarget=s.row,n.updateCursor("grabbing");const c=n.table.getCellLocation(n.columnMove.colSource,n.columnMove.rowSource);"columnHeader"===c?(l=n.columnMove.x,a=n.table.isLeftFrozenColumn(t)?n.columnMove.colTarget>=n.columnMove.colSource?n.table.getColsWidth(0,n.columnMove.colTarget):n.table.getColsWidth(0,n.columnMove.colTarget-1):n.table.isRightFrozenColumn(t)?n.table.tableNoFrameWidth-n.table.getColsWidth(s.col+1,n.table.colCount-1):(n.columnMove.colTarget>=n.columnMove.colSource?n.table.getColsWidth(0,n.columnMove.colTarget):n.table.getColsWidth(0,n.columnMove.colTarget-1))-n.table.stateManager.scroll.horizontalBarPos):("rowHeader"===c||n.table.internalProps.layoutMap.isSeriesNumberInBody(t,e))&&(d=n.columnMove.y,h=n.table.isFrozenRow(e)?n.columnMove.rowTarget>=n.columnMove.rowSource?n.table.getRowsHeight(0,n.columnMove.rowTarget):n.table.getRowsHeight(0,n.columnMove.rowTarget-1):n.table.isBottomFrozenRow(e)?n.table.tableNoFrameHeight-n.table.getRowsHeight(s.row+1,n.table.rowCount-1):(n.columnMove.rowTarget>=n.columnMove.rowSource?n.table.getRowsHeight(0,n.columnMove.rowTarget):n.table.getRowsHeight(0,n.columnMove.rowTarget-1))-n.table.stateManager.scroll.verticalBarPos),n.table.scenegraph.component.updateMoveCol(l,a,d,h),n.table.fireListeners(Ax.CHANGING_HEADER_POSITION,{col:t,row:e,x:i,y:o,backX:l,lineX:a,backY:d,lineY:h,event:r}),n.table.scenegraph.updateNextFrame()}else n.updateCursor("not-allowed"),n.columnMove.colTarget=n.columnMove.colSource,n.columnMove.rowTarget=n.columnMove.rowSource}(t,e,i,o,this,n)}isMoveCol(){return this.columnMove.moving}endMoveCol(){return function(t){var e,i;let o=!1;if("canMoveHeaderPosition"in t.table.internalProps.layoutMap&&t.columnMove.moving&&t.columnMove.colSource>=0&&t.columnMove.rowSource>=0&&t.columnMove.colTarget>=0&&t.columnMove.rowTarget>=0&&!0!==(null===(e=t.table.options.customConfig)||void 0===e?void 0:e.notUpdateInColumnRowMove)){const e=t.table.getCellRange(t.columnMove.colSource,t.columnMove.rowSource),i=t.table.getCellRange(t.columnMove.colTarget,t.columnMove.rowTarget),n=t.table._moveHeaderPosition({col:t.columnMove.colSource,row:t.columnMove.rowSource},{col:t.columnMove.colTarget,row:t.columnMove.rowTarget});if(!n||n.targetIndex===n.sourceIndex)return t.updateCursor(),t.columnMove.moving=!1,delete t.columnMove.colSource,delete t.columnMove.rowSource,delete t.columnMove.colTarget,delete t.columnMove.rowTarget,t.table.scenegraph.component.hideMoveCol(),t.table.scenegraph.updateNextFrame(),!1;{t.table.internalProps.useOneRowHeightFillAll=!1,t.table.internalProps.layoutMap.clearCellRangeMap();const r=t.table.getCellRange(t.columnMove.colSource,t.columnMove.rowSource),s=t.table.getCellRange(t.columnMove.colTarget,t.columnMove.rowTarget),a=Math.min(r.start.col,s.start.col,e.start.col,i.start.col),l=Math.max(r.end.col,s.end.col,e.end.col,i.end.col),h=Math.min(r.start.row,s.start.row,e.start.row,i.start.row);let d=Math.max(r.end.row,s.end.row,e.end.row,i.end.row);"row"===n.moveType&&"tree"===t.table.internalProps.layoutMap.rowHierarchyType&&(d=n.targetIndex>n.sourceIndex?d+n.targetSize-1:d+n.sourceSize-1),!t.table.transpose&&t.table.internalProps.layoutMap.isSeriesNumberInBody(t.columnMove.colSource,t.columnMove.rowSource)&&(t.table.changeRecordOrder(n.sourceIndex,n.targetIndex),t.changeCheckboxAndRadioOrder(n.sourceIndex,n.targetIndex)),"column"===n.moveType?YL(a,l,0,-1,t.table):YL(0,-1,h,d,t.table),t.table.clearCellStyleCache(),t.table.internalProps.layoutMap.isSeriesNumberInBody(t.columnMove.colSource,t.columnMove.rowSource)?t.table.scenegraph.updateHeaderPosition(t.table.scenegraph.proxy.colStart,t.table.scenegraph.proxy.colEnd,t.table.scenegraph.proxy.rowStart,t.table.scenegraph.proxy.rowEnd,n.moveType):"column"===n.moveType?t.table.scenegraph.updateHeaderPosition(a,l,0,-1,n.moveType):t.table.scenegraph.updateHeaderPosition(0,-1,h,d,n.moveType),"adjustFrozenCount"===t.table.internalProps.frozenColDragHeaderMode&&t.table.isListTable()&&(t.table.isLeftFrozenColumn(t.columnMove.colTarget)&&!t.table.isLeftFrozenColumn(t.columnMove.colSource)?t.table.frozenColCount+=r.end.col-r.start.col+1:t.table.isLeftFrozenColumn(t.columnMove.colSource)&&!t.table.isLeftFrozenColumn(t.columnMove.colTarget)&&(t.table.frozenColCount-=r.end.col-r.start.col+1),t.table.isRightFrozenColumn(t.columnMove.colTarget)&&!t.table.isRightFrozenColumn(t.columnMove.colSource)?t.table.rightFrozenColCount+=r.end.col-r.start.col+1:t.table.isRightFrozenColumn(t.columnMove.colSource)&&!t.table.isRightFrozenColumn(t.columnMove.colTarget)&&(t.table.rightFrozenColCount-=r.end.col-r.start.col+1)),o=!0}}return t.columnMove.moving=!1,setTimeout((()=>{delete t.columnMove.colSource,delete t.columnMove.rowSource,delete t.columnMove.colTarget,delete t.columnMove.rowTarget}),0),t.table.scenegraph.component.hideMoveCol(),t.columnResize.col<t.table.frozenColCount&&!t.table.isPivotTable()&&!t.table.transpose?(t.table.scenegraph.component.setFrozenColumnShadow(t.table.frozenColCount-1,t.columnResize.isRightFrozen),t.table.scenegraph.component.setRightFrozenColumnShadow(t.table.colCount-t.table.rightFrozenColCount)):t.columnResize.col>=t.table.colCount-t.table.rightFrozenColCount&&!t.table.isPivotTable()&&!t.table.transpose?t.table.scenegraph.component.setRightFrozenColumnShadow(t.table.colCount-t.table.rightFrozenColCount):t.table.options.frozenColCount?t.table.scenegraph.component.setFrozenColumnShadow(t.table.frozenColCount-1):t.table.options.rightFrozenColCount&&t.table.scenegraph.component.setRightFrozenColumnShadow(t.table.colCount-t.table.rightFrozenColCount),t.table.scenegraph.updateNextFrame(),!0===(null===(i=t.table.options.customConfig)||void 0===i?void 0:i.notUpdateInColumnRowMove)||o}(this)}checkFrozen(){var t;let e=this.table.options.frozenColCount?this.table.options.frozenColCount:this.table.isPivotTable()||this.table.isListTable()&&this.table.internalProps.transpose?(null!==(t=this.table.rowHeaderLevelCount)&&void 0!==t?t:0)+this.table.internalProps.layoutMap.leftRowSeriesNumberColumnCount:0;if(e){e>this.table.colCount&&(e=this.table.colCount);const t=this.table._getMaxFrozenWidth();if(this.table.getColsWidth(0,e-1)>t)if(this.table.internalProps.unfreezeAllOnExceedsMaxWidth)this.table._setFrozenColCount(0),this.setFrozenCol(-1);else{const t=this.table._getComputedFrozenColCount(e);this.table._setFrozenColCount(t),this.setFrozenCol(t)}else this.table.frozenColCount!==e&&(this.table._setFrozenColCount(e),this.setFrozenCol(e))}}setFrozenCol(t){t!==this.frozen.col?(this.frozen.col=t,this.table.scenegraph.updateFrozen(),this.table.scenegraph.updateFrozenIcon(0,this.table.colCount-1)):this.table.scenegraph.updateFrozenIcon(0,this.table.colCount-1)}setFrozenRow(t){t!==this.frozen.row&&(this.frozen.row=t,this.table.scenegraph.updateRowFrozen())}checkVerticalScrollBarEnd(){var t,e;const i=this.table.getAllRowsHeight(),o=this.scroll.verticalBarPos,n=this.table.tableNoFrameHeight;o+n>=i&&this.table.fireListeners(Ax.SCROLL_VERTICAL_END,{scrollTop:o,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:null===(t=this.table.theme.scrollStyle)||void 0===t?void 0:t.width,scrollWidth:null===(e=this.table.theme.scrollStyle)||void 0===e?void 0:e.width,viewHeight:n,viewWidth:this.table.tableNoFrameWidth})}checkHorizontalScrollBarEnd(){var t,e;const i=this.table.getAllColsWidth(),o=this.scroll.horizontalBarPos,n=this.table.tableNoFrameWidth;o+n>=i&&this.table.fireListeners(Ax.SCROLL_HORIZONTAL_END,{scrollTop:this.scroll.verticalBarPos,scrollLeft:o,scrollHeight:null===(t=this.table.theme.scrollStyle)||void 0===t?void 0:t.width,scrollWidth:null===(e=this.table.theme.scrollStyle)||void 0===e?void 0:e.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:n})}updateVerticalScrollBar(t){var e,i,o,n;const r=this.table.getAllRowsHeight(),s=this.scroll.verticalBarPos;let a=Math.ceil(t*(r-this.table.scenegraph.height));ot(a)&&!isNaN(a)||(a=0);const l=a-this.table.scenegraph.proxy.deltaY-s;if(this.table.fireListeners(Ax.CAN_SCROLL,{event:void 0,scrollTop:a-this.table.scenegraph.proxy.deltaY,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:null===(e=this.table.theme.scrollStyle)||void 0===e?void 0:e.width,scrollWidth:null===(i=this.table.theme.scrollStyle)||void 0===i?void 0:i.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"vertical",scrollRatioY:t,dy:l}).some((t=>!1===t))){const t=this.scroll.verticalBarPos/(r-this.table.scenegraph.height);this.table.scenegraph.component.updateVerticalScrollBarPos(t)}else this.scroll.verticalBarPos=a,this.table.scenegraph.setY(-this.scroll.verticalBarPos,1===t),this.scroll.verticalBarPos-=this.table.scenegraph.proxy.deltaY,this.table.scenegraph.proxy.deltaY=0,this.updateHoverPos(-1,-1),this.table.fireListeners(Ax.SCROLL,{event:void 0,scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:null===(o=this.table.theme.scrollStyle)||void 0===o?void 0:o.width,scrollWidth:null===(n=this.table.theme.scrollStyle)||void 0===n?void 0:n.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"vertical",scrollRatioY:t,dy:l}),s!==this.scroll.verticalBarPos&&this.checkVerticalScrollBarEnd()}updateHorizontalScrollBar(t){var e,i,o,n;const r=this.table.getAllColsWidth(),s=this.scroll.horizontalBarPos;let a=Math.ceil(t*(r-this.table.scenegraph.width));ot(a)&&!isNaN(a)||(a=0);const l=a-this.table.scenegraph.proxy.deltaX-s;if(this.table.fireListeners(Ax.CAN_SCROLL,{event:void 0,scrollTop:this.scroll.verticalBarPos,scrollLeft:a-this.table.scenegraph.proxy.deltaX,scrollHeight:null===(e=this.table.theme.scrollStyle)||void 0===e?void 0:e.width,scrollWidth:null===(i=this.table.theme.scrollStyle)||void 0===i?void 0:i.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"horizontal",scrollRatioX:t,dx:l}).some((t=>!1===t))){const t=this.scroll.horizontalBarPos/(r-this.table.scenegraph.width);this.table.scenegraph.component.updateHorizontalScrollBarPos(t)}else this.scroll.horizontalBarPos=a,this.table.scenegraph.setX(-this.scroll.horizontalBarPos,1===t),this.scroll.horizontalBarPos-=this.table.scenegraph.proxy.deltaX,this.table.scenegraph.proxy.deltaX=0,this.updateHoverPos(-1,-1),this.table.fireListeners(Ax.SCROLL,{event:void 0,scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:null===(o=this.table.theme.scrollStyle)||void 0===o?void 0:o.width,scrollWidth:null===(n=this.table.theme.scrollStyle)||void 0===n?void 0:n.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"horizontal",scrollRatioX:t,dx:l}),s!==this.scroll.horizontalBarPos&&this.checkHorizontalScrollBarEnd()}setScrollTop(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var o,n,r,s,a,l,h;const d=this.table.getAllRowsHeight(),c=(null===(o=this.table.options.customConfig)||void 0===o?void 0:o._disableColumnAndRowSizeRound)?1:0;t=Math.max(0,Math.min(t,d-this.table.scenegraph.height-c)),t=Math.ceil(t);const u=this.scroll.verticalBarPos,g=t/(d-this.table.scenegraph.height);if((u!==t||!0===(null===(r=null===(n=this.table.options)||void 0===n?void 0:n.customConfig)||void 0===r?void 0:r.scrollEventAlwaysTrigger))&&i){let i=t;ot(i)&&!isNaN(i)||(i=0);const o=i-u;if(this.table.fireListeners(Ax.CAN_SCROLL,{event:null==e?void 0:e.nativeEvent,scrollTop:i,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:null===(s=this.table.theme.scrollStyle)||void 0===s?void 0:s.width,scrollWidth:null===(a=this.table.theme.scrollStyle)||void 0===a?void 0:a.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"vertical",scrollRatioY:g,dy:o}).some((t=>!1===t))){const t=this.scroll.verticalBarPos/(d-this.table.scenegraph.height);return void this.table.scenegraph.component.updateVerticalScrollBarPos(t)}}(t!==this.scroll.verticalBarPos||this.table.isPivotChart())&&this.updateHoverPos(-1,-1),this.scroll.verticalBarPos=t,ot(this.scroll.verticalBarPos)&&!isNaN(this.scroll.verticalBarPos)||(this.scroll.verticalBarPos=0),this.table.scenegraph.setY(-t),this.table.scenegraph.component.updateVerticalScrollBarPos(g);const p=this.scroll.verticalBarPos-u;this.table.fireListeners(Ax.SCROLL,{event:null==e?void 0:e.nativeEvent,scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:null===(l=this.table.theme.scrollStyle)||void 0===l?void 0:l.width,scrollWidth:null===(h=this.table.theme.scrollStyle)||void 0===h?void 0:h.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"vertical",scrollRatioY:g,dy:p}),u!==t&&i&&this.checkVerticalScrollBarEnd()}setScrollLeft(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var o,n,r,s,a,l,h;this.table.scrollLeft;const d=this.table.getAllColsWidth(),c=(this.table.getFrozenColsWidth(),(null===(o=this.table.options.customConfig)||void 0===o?void 0:o._disableColumnAndRowSizeRound)?1:0);t=Math.max(0,Math.min(t,d-this.table.scenegraph.width-c)),t=Math.ceil(t);const u=this.scroll.horizontalBarPos,g=t/(d-this.table.scenegraph.width);if((u!==t||!0===(null===(r=null===(n=this.table.options)||void 0===n?void 0:n.customConfig)||void 0===r?void 0:r.scrollEventAlwaysTrigger))&&i){let i=t;ot(i)&&!isNaN(i)||(i=0);const o=i-u;if(this.table.fireListeners(Ax.CAN_SCROLL,{event:null==e?void 0:e.nativeEvent,scrollTop:this.scroll.verticalBarPos,scrollLeft:i,scrollHeight:null===(s=this.table.theme.scrollStyle)||void 0===s?void 0:s.width,scrollWidth:null===(a=this.table.theme.scrollStyle)||void 0===a?void 0:a.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"horizontal",scrollRatioX:g,dx:o}).some((t=>!1===t))){const t=this.scroll.horizontalBarPos/(d-this.table.scenegraph.width);return void this.table.scenegraph.component.updateHorizontalScrollBarPos(t)}}t!==this.scroll.horizontalBarPos&&this.updateHoverPos(-1,-1),this.scroll.horizontalBarPos=t,ot(this.scroll.horizontalBarPos)&&!isNaN(this.scroll.horizontalBarPos)||(this.scroll.horizontalBarPos=0),this.table.scenegraph.setX(-t),this.table.scenegraph.component.updateHorizontalScrollBarPos(g);const p=this.scroll.horizontalBarPos-u;this.table.fireListeners(Ax.SCROLL,{event:null==e?void 0:e.nativeEvent,scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:null===(l=this.table.theme.scrollStyle)||void 0===l?void 0:l.width,scrollWidth:null===(h=this.table.theme.scrollStyle)||void 0===h?void 0:h.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"horizontal",scrollRatioX:g,dx:p}),u!==t&&i&&this.checkHorizontalScrollBarEnd()}hideVerticalScrollBar(){this.table.scenegraph.component.hideVerticalScrollBar()}showVerticalScrollBar(t){this.table.scenegraph.component.showVerticalScrollBar(),t&&(clearTimeout(this._clearVerticalScrollBar),this._clearVerticalScrollBar=setTimeout((()=>{var t;null===(t=this.table.scenegraph)||void 0===t||t.component.hideVerticalScrollBar()}),1e3))}hideHorizontalScrollBar(){this.table.scenegraph.component.hideHorizontalScrollBar()}showHorizontalScrollBar(t){this.table.scenegraph.component.showHorizontalScrollBar(),t&&(clearTimeout(this._clearHorizontalScrollBar),this._clearHorizontalScrollBar=setTimeout((()=>{var t;null===(t=this.table.scenegraph)||void 0===t||t.component.hideHorizontalScrollBar()}),1e3))}triggerContextMenu(t,e,i,o){this.menu.isShow&&this.menu.x===i&&this.menu.y===o?this.hideMenu():this.showContextMenu(t,e,i,o)}showContextMenu(t,e,i,o){var n;(null===(n=this.table.internalProps.menu)||void 0===n?void 0:n.contextMenuItems)&&("html"===this.table.internalProps.menu.renderMode?this.menu.isShow=!0:(this.menu.isShow=!0,this.menu.x=i,this.menu.y=o,this.table.scenegraph.component.menu.attach(i,o,t,e,zT.contextmenu)),this.table.fireListeners(Ax.SHOW_MENU,{x:i,y:o,col:t,row:e,type:"contextmenu"}))}triggerDropDownMenu(t,e,i,o,n){this.table.fireListeners(Ax.DROPDOWN_ICON_CLICK,{col:t,row:e,event:n}),this.menu.isShow?this.hideMenu():this.showDropDownMenu(t,e,i,o)}showDropDownMenu(t,e,i,o){"html"===this.table.internalProps.menu.renderMode?this.menu.isShow=!0:(this.menu.isShow=!0,this.table.scenegraph.component.menu.attach(i,o,t,e,zT.dropDown),this.menu.bounds=this.table.scenegraph.component.menu.bounds),this.table.fireListeners(Ax.SHOW_MENU,{x:i,y:o,col:t,row:e,type:"dropDown"}),this.residentHoverIcon&&this.table.scenegraph.setIconNormalStyle(this.residentHoverIcon.icon,this.residentHoverIcon.col,this.residentHoverIcon.row);const n=this.table.scenegraph.getCell(t,e);let r;n.forEachChildren((t=>t.attribute.funcType===sw.dropDown&&(r=t,!0))),r&&(this.residentHoverIcon={col:t,row:e,icon:r},this.table.scenegraph.setIconHoverStyle(this.residentHoverIcon.icon,this.residentHoverIcon.col,this.residentHoverIcon.row,n),this.table.scenegraph.residentHoverIcon(t,e))}hideMenu(){this.menu.isShow&&(this.table.fireListeners(Ax.DROPDOWN_MENU_CLEAR,null),this.table.fireListeners(Ax.HIDE_MENU,null),this.menu.isShow=!1,this.table.scenegraph.component.menu.detach(),this.residentHoverIcon&&(this.table.scenegraph.setIconNormalStyle(this.residentHoverIcon.icon,this.residentHoverIcon.col,this.residentHoverIcon.row),this.table.scenegraph.resetResidentHoverIcon(this.residentHoverIcon.col,this.residentHoverIcon.row),this.residentHoverIcon=null))}setDropDownMenuHighlight(t){this.menu.dropDownMenuHighlight=t;for(let e=0;e<t.length;e++){const{col:i,row:o}=t[e],n=this.table.getCellRange(i,o);if(n)for(let t=n.start.col;t<=n.end.col;t++)for(let e=n.start.row;e<=n.end.row;e++)this.table.scenegraph.updateCellContent(t,e)}}dropDownMenuIsHighlight(t,e,i){const o=this.menu.dropDownMenuHighlight;if(Array.isArray(o))for(let n=0;n<o.length;n++){const r=o[n];let{col:s,row:a}=r;const{field:l,menuKey:h}=r;if("number"!=typeof s||"number"!=typeof a)if(this.table.isPivotTable()){const t=this.table.internalProps.layoutMap.getPivotCellAdress(l);if(!t)continue;s=t.col,a=t.row}else{const t=this.table.internalProps.layoutMap.getHeaderCellAddressByField(l);if(!t)continue;s=t.col,a=t.row}if(ot(s)&&ot(a)&&this.table.isCellRangeEqual(t,e,s,a)){let o=this.table._getHeaderLayoutMap(null!=s?s:t,null!=a?a:e).dropDownMenu||this.table.globalDropDownMenu;if("function"==typeof o&&(o=o({row:a,col:s,table:this.table})),o)for(let t=0;t<o.length;t++){const e=o[t];if(nt(e)&&(e.menuKey||e.text)===(h||"")&&t===i)return!0;if(lt(e)&&e===h&&t===i)return!0}}}return!1}triggerSort(t,e,i,o){if(this.table.isPivotTable()){const i=this.table.getPivotSortState(t,e),n=i?i.toUpperCase():"NORMAL",r="ASC"===n?"DESC":"DESC"===n?"NORMAL":"ASC";return this.table.sort(t,e,r),void this.table.fireListeners(XL.PIVOT_SORT_CLICK,{col:t,row:e,order:n||"normal",dimensionInfo:this.table.internalProps.layoutMap.getPivotDimensionInfo(t,e),cellLocation:this.table.getCellLocation(t,e),event:o})}const n=[...this.sort],r=this.table.internalProps.multipleSort||!n.length?null:this.sort[this.sort.length-1];UL(t,e,this.table,o);const s=this.table.getCellRange(t,e),a=this.sort.find((t=>t.col===s.start.col&&t.row===s.start.row)),l=this.table.internalProps.multipleSort||!r?null:r.col,h=this.table.internalProps.multipleSort||!r?null:r.row,d=n.findIndex((i=>i.col===t&&i.row===e));d>=0&&n.splice(d,1),this.table.scenegraph.updateSortIcon({col:t,row:e,iconMark:i,order:null==a?void 0:a.order,oldSortCol:l,oldSortRow:h,oldIconMark:null==r?void 0:r.icon}),a&&(a.icon=i),this.table.internalProps.multipleSort||n.forEach((t=>{this.table.scenegraph.updateSortIcon({col:null,row:null,iconMark:null,order:"normal",oldSortCol:t.col,oldSortRow:t.row,oldIconMark:null})})),this.table.fireListeners(XL.AFTER_SORT,{order:null==a?void 0:a.order,field:this.table.getHeaderField(t,e),event:o})}updateSortState(t){var e,i,o,n,r,s,a,l;t=Array.isArray(t)?t:[t];for(let l=0;l<t.length;l++){if(t[l].field===(null===(e=this.sort[l])||void 0===e?void 0:e.field)&&t[t.length-1].order===(null===(i=this.sort[l])||void 0===i?void 0:i.order))return;const h=this.table.internalProps.multipleSort?null:(null===(o=this.sort[l])||void 0===o?void 0:o.col)||null,d=this.table.internalProps.multipleSort?null:(null===(n=this.sort[l])||void 0===n?void 0:n.row)||null;"asc"===(null===(r=this.sort[l])||void 0===r?void 0:r.order)||null===(s=this.sort[l])||void 0===s||s.order,this.setSortState(t.slice(0,l+1));const c=this.table.internalProps.layoutMap.getHeaderCellAddressByField(t[l].field);let u;this.sort[l].col=c.col,this.sort[l].row=c.row,Qw(this.table.scenegraph.getCell(this.sort[l].col,this.sort[l].row),"children",(t=>"sort"===t.attribute.funcType&&(u=t,!0))),this.table.scenegraph.updateSortIcon({col:this.sort[l].col,row:this.sort[l].row,iconMark:u,order:this.sort[l].order,oldSortCol:h,oldSortRow:d,oldIconMark:null===(a=this.sort[l])||void 0===a?void 0:a.icon})}const h=[];this.table.internalProps.layoutMap.columnTree.tree.children.forEach((e=>{t.some((t=>t.field===e.field))||h.push(e)}));for(let t=0;t<h.length;t++){const e=h[t];this.table.scenegraph.updateSortIcon({col:null,row:null,iconMark:null,order:null,oldSortCol:null!==(l=e.startInTotal+this.table.internalProps.layoutMap.leftRowSeriesNumberColumnCount)&&void 0!==l?l:0,oldSortRow:e.level,oldIconMark:null})}}triggerFreeze(t,e,i){if(!this.table.isPivotTable()&&!this.table.transpose){if(function(t,e,i){i.frozenColCount>0?t!==i.frozenColCount-1?i.setFrozenColCount(t+1):i.setFrozenColCount(0):i.setFrozenColCount(t+1)}(t,0,this.table),this.table.hasListeners(XL.FREEZE_CLICK)){const i=this.table.internalProps.layoutMap.columnObjects.slice(0,t+1);this.table.fireListeners(XL.FREEZE_CLICK,{col:t,row:e,fields:i.reduce(((t,e)=>t.concat(e.field)),[]),colCount:this.table.frozenColCount})}this.frozen.icon=i}}updateCursor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";this.table.getElement().style.cursor=t}updateDrillState(t,e,i,o,n,r){this.drill.dimensionKey=t,this.drill.title=e,this.drill.drillDown=i,this.drill.drillUp=o,this.drill.col=n,this.drill.row=r,function(t,e,i,o,n){const r=n.getCellLocation(t,e);let s=0,a=0,l=!1;"columnHeader"===r?(s=n.getColsWidth(0,n.rowHeaderLevelCount-1)-(0===n.frozenColCount?n.scrollLeft:0),a=n.getRowsHeight(0,e-1)+n.getRowHeight(e)/2,l=!0):"rowHeader"===r&&(a=n.getRowsHeight(0,n.columnHeaderLevelCount-1),s=n.getColsWidth(0,t-1)+n.getColWidth(t)/2,l=!0),n.scenegraph.updateDrill(l,s,a,i,o)}(n,r,i,o,this.table)}updateSparklineHoverPose(t,e,i,o){-1!==this.sparkLine.col&&-1!==this.sparkLine.row&&function(t,e,i){const o=i.scenegraph.getCell(t,e).getChildByName("sparkline"),n=null==o?void 0:o.getChildByName("highlight-line"),r=null==o?void 0:o.getChildByName("highlight-symbol");n&&n.setAttributes({visible:!1,pickable:!1}),r&&r.setAttributes({visible:!1,pickable:!1}),i.scenegraph.updateNextFrame()}(this.sparkLine.col,this.sparkLine.row,this.table);let n=!1;-1!==t&&-1!==e&&(n=function(t,e,i,o,n){var r,s;const a=n.scenegraph.getCell(t,e).getChildByName("sparkline"),l=null==a?void 0:a.getChildByName("sparkline-line"),h=null==a?void 0:a.getChildByName("sparkline-symbol-group");if(!l)return!1;const d=l.bandwidth,c=l.min,u=l.max,g=l.attribute.points;let p;i-=a.globalAABBBounds.x1,a.globalAABBBounds.y1;for(let t=0;t<g.length;t++){const{x:e,y:o,defined:n,rawData:f}=g[t];if(Math.abs(i-e)<d/2&&(p={point:g[t],points:g,pointsBandWidth:d,pointData:f},n)){const t=a.getChildByName("highlight-line");if(t)t.setAttributes({points:[{x:e,y:u},{x:e,y:c}],visible:!0,pickable:!0});else{const t=tc({points:[{x:e,y:u},{x:e,y:c}],lineWidth:null===(r=l.hover)||void 0===r?void 0:r.strokeWidth,stroke:null===(s=l.hover)||void 0===s?void 0:s.stroke});t.name="highlight-line",a.addChild(t)}const i=a.getChildByName("highlight-symbol");if(i)i.setAttributes({x:e,y:o,visible:!0,pickable:!0});else{const t=Zd({x:e,y:o,stroke:h.hover.stroke,lineWidth:h.hover.strokeWidth,fill:h.hover.fill,size:2*h.hover.size,symbolType:"circle"});t.name="highlight-symbol",a.addChild(t)}break}}if(n.scenegraph.updateNextFrame(),p){const i={col:t,row:e,field:n.getHeaderField(t,e),value:n.getCellValue(t,e),dataValue:n.getCellOriginValue(t,e),cellHeaderPaths:n.internalProps.layoutMap.getCellHeaderPaths(t,e),title:n.getBodyColumnDefine(t,e).title,cellRange:n.getCellRelativeRect(t,e),sparkline:{pointData:p.pointData},scaleRatio:n.canvas.getBoundingClientRect().width/n.canvas.offsetWidth};n.fireListeners(Ax.MOUSEOVER_CHART_SYMBOL,i)}return!0}(t,e,i,0,this.table)),n?(this.sparkLine.col=t,this.sparkLine.row=e):(this.sparkLine.col=-1,this.sparkLine.row=-1)}setCheckedState(t,e,i,o){return function(t,e,i,o,n){const r=n.table.getCellRange(t,e);if(r.start.col!==r.end.col||r.start.row!==r.end.row)for(let t=r.start.col;t<=r.end.col;t++)for(let e=r.start.row;e<=r.end.row;e++)ZL(t,e,i,o,n);else ZL(t,e,i,o,n)}(t,e,i,o,this)}setHeaderCheckedState(t,e){return function(t,e,i){var o;i.headerCheckedState[t]=e,null===(o=i.checkedState)||void 0===o||o.forEach((i=>{i[t]=e}))}(t,e,this)}syncCheckedState(t,e,i,o){return function(t,e,i,o,n){var r,s;if(n.table.isHeader(t,e)){if(ot(n.headerCheckedState[i]))return n.headerCheckedState[i];if("function"==typeof o)return;if(ot(o))n.headerCheckedState[i]=o;else if((null===(r=n.checkedState)||void 0===r?void 0:r.size)>0)return n.updateHeaderCheckedState(i,t,e);return n.headerCheckedState[i]}const a=n.table.getRecordShowIndexByCell(t,e);if(a>=0){const t=n.table.dataSource.getIndexKey(a).toString();if(ot(null===(s=n.checkedState.get(t))||void 0===s?void 0:s[i]))return n.checkedState.get(t)[i];if(n.checkedState.get(t))n.checkedState.get(t)[i]=o;else if(t.includes(",")){const e=t.split(",").slice(0,-1).join(",");n.checkedState.has(e)&&!0===n.checkedState.get(e)[i]?n.checkedState.set(t,{[i]:!0}):n.checkedState.set(t,{[i]:o})}else n.checkedState.set(t,{[i]:o})}return o}(t,e,i,o,this)}initCheckedState(t){return JL(t,this)}updateHeaderCheckedState(t,e,i){return function(t,e,i,o){let n=!0,r=!0,s=!1;return e.checkedState.forEach(((a,l)=>{var h,d;l=l.includes(",")?l.split(",").map((t=>Number(t))):Number(l);const c=e.table.getTableIndexByRecordIndex(l),u=e.table.transpose?e.table.getCustomMerge(c,o):e.table.getCustomMerge(i,c),g=null===(h=e.table.dataSource)||void 0===h?void 0:h.get(l);u||!(null===(d=e.table.internalProps.rowSeriesNumber)||void 0===d?void 0:d.enableTreeCheckbox)&&(null==g?void 0:g.vtableMerge)||(!0!==(null==a?void 0:a[t])?n=!1:(r=!1,s=!0))})),n?(e.headerCheckedState[t]=!0,n):r?(e.headerCheckedState[t]=!1,!1):!!s&&(e.headerCheckedState[t]="indeterminate","indeterminate")}(t,this,e,i)}initLeftRecordsCheckState(t){return function(t,e){for(let i=e.checkedState.size;i<t.length;i++){const o=t[i];e._checkboxCellTypeFields.forEach((t=>{const n=o[t];let r;nt(n)?r=n.checked:"boolean"==typeof n&&(r=n);const s=i.toString();e.checkedState.get(s)||e.checkedState.set(s,{}),e.checkedState.get(s)[t]=r}))}}(t,this)}setRadioState(t,e,i,o,n){!function(t,e,i,o,n,r){const s=r.table.getRecordShowIndexByCell(t,e);if(s>=0){const t=r.table.dataSource.getIndexKey(s);"column"===o?ut(n)?(r.radioState[i]={},r.radioState[i][t]=n):r.radioState[i]=t:(r.radioState[i]||(r.radioState[i]={}),ut(n)?r.radioState[i][t]=n:r.radioState[i][t]=!0)}}(t,e,i,o,n,this)}syncRadioState(t,e,i,o,n,r){return function(t,e,i,o,n,r,s){var a,l,h,d,c;const u=s.table.getRecordShowIndexByCell(t,e);if(u>=0){const t=s.table.dataSource.getIndexKey(u);if("column"===o){if(!ot(s.radioState[i])&&r)return ut(n)?(s.radioState[i]={},s.radioState[i][t]=n):s.radioState[i]=t,!0;if(ut(s.radioState[i])&&!ut(n))return s.radioState[i]===t;if(ut(s.radioState[i])&&ut(n))return!1;if(nt(s.radioState[i])&&!ut(n))return!1;if(nt(s.radioState[i])&&ut(n))return s.radioState[i][t]===n}else if("cell"===o){if(!ot(s.radioState[i])&&r)return s.radioState[i]={},ut(n)?s.radioState[i][t]=n:s.radioState[i][t]=!0,!0;if(!ot(null===(a=s.radioState[i])||void 0===a?void 0:a[t])&&r)return ut(n)?s.radioState[i][t]=n:s.radioState[i][t]=!0,!0;if(tt(null===(l=s.radioState[i])||void 0===l?void 0:l[t])&&!ut(n))return s.radioState[i][t];if(tt(null===(h=s.radioState[i])||void 0===h?void 0:h[t])&&ut(n))return!1;if(ut(null===(d=s.radioState[i])||void 0===d?void 0:d[t])&&!ut(n))return!1;if(ut(null===(c=s.radioState[i])||void 0===c?void 0:c[t])&&ut(n))return s.radioState[i][t]===n}}return r}(t,e,i,o,n,r,this)}changeCheckboxAndRadioOrder(t,e){this.checkedState.size&&function(t,e,i){const{checkedState:o,table:n}=i;let r,s;if(n.internalProps.transpose?(t=n.getRecordShowIndexByCell(t,0),e=n.getRecordShowIndexByCell(e,0)):(r=n.isPivotTable()?void 0:n.getRecordIndexByCell(0,t),s=n.isPivotTable()?void 0:n.getRecordIndexByCell(0,e)),ut(r)&&ut(s)){if((t=r)>(e=s)){const i=o.get(t.toString());for(let i=t;i>e;i--)o.set(i.toString(),o.get((i-1).toString()));o.set(e.toString(),i)}else if(t<e){const i=o.get(t.toString());for(let i=t;i<e;i++)o.set(i.toString(),o.get((i+1).toString()));o.set(e.toString(),i)}}else if(ht(r)&&ht(s))if((t=r[r.length-1])>(e=s[s.length-1])){const i=o.get(r.toString());for(let i=t;i>e;i--){const t=[...r];t[t.length-1]=i;const e=[...r];e[e.length-1]=i-1,o.set(t.toString(),o.get(e.toString()))}o.set(s.toString(),i)}else if(t<e){const i=o.get(r.toString());for(let i=t;i<e;i++){const t=[...r];t[t.length-1]=i;const e=[...r];e[e.length-1]=i+1,o.set(t.toString(),o.get(e.toString()))}o.set(s.toString(),i)}}(t,e,this),this.radioState.length&&function(t,e,i){const{radioState:o,table:n}=i;if(n.internalProps.transpose?(t=n.getRecordShowIndexByCell(t,0),e=n.getRecordShowIndexByCell(e,0)):(t=n.getRecordShowIndexByCell(0,t),e=n.getRecordShowIndexByCell(0,e)),t>e){const i=o[t];for(let i=t;i>e;i--)o[i]=o[i-1];o[e]=i}else if(t<e){const i=o[t];for(let i=t;i<e;i++)o[i]=o[i+1];o[e]=i}}(t,e,this)}setCustomSelectRanges(t){(function(t){const{customSelectedRangeComponents:e}=t.table.scenegraph;e.forEach(((t,e)=>{t.rect.delete()})),e.clear(),t.select.customSelectRanges=[]})(this),function(t,e){const{customSelectedRangeComponents:i}=e.table.scenegraph;t.forEach((t=>{var e,o,n,r;const{range:s,style:a}=t,l=oc({fill:null!==(e=a.cellBgColor)&&void 0!==e&&e,stroke:null!==(o=a.cellBorderColor)&&void 0!==o&&o,lineWidth:null!==(n=a.cellBorderLineWidth)&&void 0!==n?n:0,lineDash:null!==(r=a.cellBorderLineDash)&&void 0!==r?r:[],pickable:!1});i.set(`${s.start.col}-${s.start.row}-${s.end.col}-${s.end.row}`,{rect:l,role:"body"})})),e.select.customSelectRanges=t,qM(e.table.scenegraph),e.table.scenegraph.updateNextFrame()}(t,this)}}(this),this.eventManager=new class{constructor(t){this.isDown=!1,this.isDraging=!1,this.globalEventListeners=[],this._enableTableScroll=!0,this.table=t,this.handleTextStickBindId=[],this.inertiaScroll=new rP(t.stateManager),"node"===zw.mode||t.options.disableInteraction||(this.bindOuterEvent(),setTimeout((()=>{this.bindSelfEvent()}),0))}bindOuterEvent(){aP(this),function(t){const e=t.table,i=e.stateManager,o=e.internalProps.handler;function n(t){var i;if(e.hasListeners(Ax.KEYDOWN)){const o={keyCode:null!==(i=t.keyCode)&&void 0!==i?i:t.which,code:t.code,event:t,scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth};e.fireListeners(Ax.KEYDOWN,o)}}o.on(e.getElement(),"blur",(e=>{t.dealTableHover()})),o.on(e.getElement(),"keydown",(o=>{var r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x,_,S;if("a"===o.key&&(o.ctrlKey||o.metaKey))(null===(r=e.keyboardOptions)||void 0===r?void 0:r.selectAllOnCtrlA)&&(o.preventDefault(),t.deelTableSelectAll());else if(i.select.cellPos.col>=0&&i.select.cellPos.row>=0&&("ArrowUp"===o.key||"ArrowDown"===o.key||"ArrowLeft"===o.key||"ArrowRight"===o.key)){if((null===(a=null===(s=e.options.keyboardOptions)||void 0===s?void 0:s.moveEditCellOnArrowKeys)||void 0===a||!a)&&(null===(l=e.editorManager)||void 0===l?void 0:l.editingEditor)||!1===(null===(h=e.options.keyboardOptions)||void 0===h?void 0:h.moveSelectedCellOnArrowKeys))return;let t,n;if(o.preventDefault(),o.stopPropagation(),"ArrowUp"===o.key?o.ctrlKey||o.metaKey?(t=i.select.cellPos.col,n=0):(o.shiftKey,t=i.select.cellPos.col,n=Math.min(e.rowCount-1,Math.max(0,i.select.cellPos.row-1))):"ArrowDown"===o.key?o.ctrlKey||o.metaKey?(t=i.select.cellPos.col,n=e.rowCount-1):(o.shiftKey,t=i.select.cellPos.col,n=Math.min(e.rowCount-1,Math.max(0,i.select.cellPos.row+1))):"ArrowLeft"===o.key?o.ctrlKey||o.metaKey?(t=0,n=i.select.cellPos.row):(o.shiftKey,n=i.select.cellPos.row,t=Math.min(e.colCount-1,Math.max(0,i.select.cellPos.col-1))):"ArrowRight"===o.key&&(o.ctrlKey||o.metaKey?(t=e.colCount-1,n=i.select.cellPos.row):(o.shiftKey,n=i.select.cellPos.row,t=Math.min(e.colCount-1,Math.max(0,i.select.cellPos.col+1)))),Pk(e,t,n))return;e.selectCell(t,n,o.shiftKey),null!==(c=null===(d=e.options.keyboardOptions)||void 0===d?void 0:d.moveEditCellOnArrowKeys)&&void 0!==c&&c&&(null===(u=e.editorManager)||void 0===u?void 0:u.editingEditor)&&(e.editorManager.completeEdit(),e.getElement().focus(),e.getEditor(t,n)&&e.editorManager.startEditCell(t,n))}else if("Escape"===o.key)null===(g=e.editorManager)||void 0===g||g.cancelEdit(),e.getElement().focus();else if("Enter"===o.key){if(null===(p=e.editorManager)||void 0===p?void 0:p.editingEditor){if(n(o),e.editorManager.completeEdit(),e.getElement().focus(),!0===(null===(f=e.options.keyboardOptions)||void 0===f?void 0:f.moveFocusCellOnEnter)){const t=i.select.cellPos.col,n=Math.min(e.rowCount-1,Math.max(0,i.select.cellPos.row+1));if(Pk(e,t,n))return;e.selectCell(t,n,o.shiftKey)}return}if(!0===(null===(v=e.options.keyboardOptions)||void 0===v?void 0:v.moveFocusCellOnEnter)){const t=i.select.cellPos.col,n=Math.min(e.rowCount-1,Math.max(0,i.select.cellPos.row+1));if(Pk(e,t,n))return;e.selectCell(t,n,o.shiftKey)}else if((null===(m=null===(b=e.options.keyboardOptions)||void 0===b?void 0:b.editCellOnEnter)||void 0===m||m)&&1===(null!==(C=null===(y=e.stateManager.select.ranges)||void 0===y?void 0:y.length)&&void 0!==C?C:0)){const t=e.stateManager.select.ranges[0].start.col,i=e.stateManager.select.ranges[0].start.row,o=e.stateManager.select.ranges[0].end.col,n=e.stateManager.select.ranges[0].end.row;t===o&&i===n&&e.getEditor(t,i)&&e.editorManager.startEditCell(t,i)}}else if("Tab"===o.key){if((null===(x=null===(w=e.options.keyboardOptions)||void 0===w?void 0:w.moveFocusCellOnTab)||void 0===x||x)&&i.select.cellPos.col>=0&&i.select.cellPos.row>=0){if(i.select.cellPos.col===e.colCount-1&&i.select.cellPos.row===e.rowCount-1)return;let t,n;if(o.preventDefault(),i.select.cellPos.col===e.colCount-1?(n=Math.min(e.rowCount-1,i.select.cellPos.row+1),t=e.rowHeaderLevelCount):(n=i.select.cellPos.row,t=i.select.cellPos.col+1),Pk(e,t,n))return;e.selectCell(t,n),(null===(_=e.editorManager)||void 0===_?void 0:_.editingEditor)&&(e.editorManager.completeEdit(),e.getElement().focus(),e.getEditor(t,n)&&e.editorManager.startEditCell(t,n))}}else if(!(o.ctrlKey||o.metaKey||o.shiftKey)){const t=e.options.editCellTrigger;if(("keydown"===t||Array.isArray(t)&&t.includes("keydown"))&&!(null===(S=e.editorManager)||void 0===S?void 0:S.editingEditor)){const t=/^[a-zA-Z0-9+\-*\/%=.,\s]$/;o.key.match(t)&&e.editorManager.startEditCell(i.select.cellPos.col,i.select.cellPos.row,"")}}n(o)})),o.on(e.getElement(),"copy",(t=>gP(this,void 0,void 0,(function*(){var i,o;if(null===(i=e.keyboardOptions)||void 0===i?void 0:i.copySelected){const i=e.getCopyValue();if(ot(i)){t.preventDefault();const n=yield navigator.permissions.query({name:"clipboard-write"});if((null===(o=navigator.clipboard)||void 0===o?void 0:o.write)&&"granted"===n.state){const t=t=>{const e=["<table>"],i=['<meta name="author" content="Visactor"/>','<style type="text/css">td{white-space:normal}br{mso-data-placement:same-cell}</style>'].join(""),o=t.split("\r\n");return o.forEach((function(t,i){const n=t.split("\t"),r=[];0===i&&e.push("<tbody>"),n.forEach((function(t,e){const i=t?t.toString().replace(/&/g,"&amp;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>").replace(/(<br(\s*|\/)>(\r\n|\n)?|\r\n|\n)/g,"<br>\r\n").replace(/\x20{2,}/gi,(t=>`<span style="mso-spacerun: yes">${"&nbsp;".repeat(t.length-1)} </span>`)).replace(/\t/gi,"&#9;"):" ";r.push(`<td>${i}</td>`)})),e.push("<tr>",...r,"</tr>"),i===o.length-1&&e.push("</tbody>")})),e.push("</table>"),[i,e.join("")].join("")},e=t(i);navigator.clipboard.write([new ClipboardItem({"text/html":new Blob([e],{type:"text/html"}),"text/plain":new Blob([i],{type:"text/plain"})})])}else yx?window.clipboardData.setData("Text",i):t.clipboardData.setData("text/plain",i);e.fireListeners(Ax.COPY_DATA,{cellRange:e.stateManager.select.ranges,copyData:i})}}})))),o.on(e.getElement(),"paste",(t=>{var i,o,n,r;if((null===(i=e.keyboardOptions)||void 0===i?void 0:i.pasteValueToCell)&&e.changeCellValues){if(null===(o=e.editorManager)||void 0===o?void 0:o.editingEditor)return;if((null===(n=e.stateManager.select.ranges)||void 0===n?void 0:n.length)>0)if(null===(r=navigator.clipboard)||void 0===r?void 0:r.read)navigator.clipboard.read().then((t=>{for(const e of t)e.types.includes("text/html")?a(e):1===e.types.length&&"text/plain"===e.types[0]&&h(e)}));else{const i=e.stateManager.select.ranges,o=Math.min(i[0].start.col,i[0].end.col),n=Math.min(i[0].start.row,i[0].end.row),r=(t.clipboardData||window.Clipboard).getData("text").split("\n"),s=[];r.forEach((function(t,e){const i=t.split("\t"),o=[];s.push(o),i.forEach((function(t,e){e===i.length-1&&(t=t.trim()),o.push(t)}))})),e.changeCellValues(o,n,s)}}})),o.on(e.getElement(),"contextmenu",(t=>{var i;!1!==(null===(i=e.eventOptions)||void 0===i?void 0:i.preventDefaultContextMenu)?t.preventDefault():u(t)})),e.options.canvas||o.on(e.getContainer(),"resize",(t=>{var i;e.isReleased||0===t.width&&0===t.height||((e.autoFillWidth||e.autoFillHeight)&&(null===(i=e.editorManager)||void 0===i||i.completeEdit()),ot(e.options.pixelRatio)||e.setPixelRatio(uP()),t.windowSizeNotChange||e.resize())}));const r=/<tr[^>]*>([\s\S]*?)<\/tr>/g,s=/<td[^>]*>([\s\S]*?)<\/td>/g;function a(t){const i=e.stateManager.select.ranges,o=i.length,n=Math.min(i[o-1].start.col,i[o-1].end.col),a=Math.min(i[o-1].start.row,i[o-1].end.row),h=Math.max(i[o-1].start.col,i[o-1].end.col),c=Math.max(i[o-1].start.row,i[o-1].end.row);let u=0,g=0,p=[];t.getType("text/html").then((t=>{t.text().then((t=>{var i,o;if(t&&/(<table)|(<TABLE)/g.test(t)){const l=Array.from(t.matchAll(r));for(const t of l){const e=t[1],o=Array.from(e.matchAll(s)).map((t=>t[1].replace(/(<(?!br)([^>]+)>)/gi,"").replace(/<br(\s*|\/)>[\r\n]?/gim,"\n").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#9;/gi,"\t").replace(/&nbsp;/g," ")));p.push(o),u=Math.max(u,null!==(i=null==o?void 0:o.length)&&void 0!==i?i:0)}g=null!==(o=p.length)&&void 0!==o?o:0,p=d(p,g,u,c-a+1,h-n+1),e.changeCellValues(n,a,p,!0)}else navigator.clipboard.read().then((t=>{for(const e of t)e.types.includes("text/plain")&&e.getType("text/plain").then((t=>{t.text().then(l)}))}))}))}))}function l(t){var i;const o=e.stateManager.select.ranges,n=o.length,r=Math.min(o[n-1].start.col,o[n-1].end.col),s=Math.min(o[n-1].start.row,o[n-1].end.row),a=Math.max(o[n-1].start.col,o[n-1].end.col),l=Math.max(o[n-1].start.row,o[n-1].end.row);let h=0,c=0,u=[];t.split("\n").forEach((function(t,e){var i;const o=t.split("\t"),n=[];u.push(n),o.forEach((function(t,e){e===o.length-1&&(t=t.trim()),n.push(t)})),h=Math.max(h,null!==(i=null==n?void 0:n.length)&&void 0!==i?i:0)})),c=null!==(i=u.length)&&void 0!==i?i:0,u=d(u,c,h,l-s+1,a-r+1),e.changeCellValues(r,s,u,!0)}function h(t){const i=e.stateManager.select.ranges,o=i.length,n=Math.min(i[o-1].start.col,i[o-1].end.col),r=Math.min(i[o-1].start.row,i[o-1].end.row),s=Math.max(i[o-1].start.col,i[o-1].end.col),a=Math.max(i[o-1].start.row,i[o-1].end.row);let l=0,h=0;t.getType("text/plain").then((t=>{t.text().then((t=>{var i;const o=t.replace(/\r(?!\n)/g,"\r\n").split("\r\n");let c=[];o.length>1&&""===o[o.length-1]&&o.pop(),o.forEach((function(t,e){var i;const o=t.split("\t"),n=[];c.push(n),o.forEach((function(t,e){t.includes("\n")&&(t=t.replace(/^"(.*)"$/,"$1").replace(/["]*/g,(t=>new Array(Math.floor(t.length/2)).fill('"').join("")))),n.push(t)})),l=Math.max(l,null!==(i=null==n?void 0:n.length)&&void 0!==i?i:0)})),h=null!==(i=c.length)&&void 0!==i?i:0,c=d(c,h,l,a-r+1,s-n+1),e.changeCellValues(n,r,c,!0)}))}))}function d(t,e,i,o,n){if(n>i||o>e){if(n%i==0&&o%e==0){const r=[];for(let s=0;s<o;s++){const o=[];r.push(o);for(let r=0;r<n;r++){const n=s%e,a=r%i;o.push(t[n][a])}}return r}return t}return t}const c=t=>{e.eventManager.LastBodyPointerXY={x:t.x,y:t.y},e.eventManager.isDown=!0};t.globalEventListeners.push({name:"pointerdown",env:"body",callback:c}),document.body.addEventListener("pointerdown",c);const u=t=>{if(t.target!==e.canvas&&(t=>{var o,n;if(i.menu.isShow&&setTimeout((()=>{e.internalProps.menuHandler.pointInMenuElement(t.clientX,t.clientY)||i.menu.isShow&&i.hideMenu()}),0),i.isResizeCol())hP(e);else if(i.isResizeRow())dP(e);else if(i.isMoveCol()){const i=e.stateManager.endMoveCol();sP(e,i,t)}else if(i.isSelecting()&&(null===(n=null===(o=e.stateManager.select)||void 0===o?void 0:o.ranges)||void 0===n?void 0:n.length)){const i=e.stateManager.select.ranges[e.stateManager.select.ranges.length-1].end.col,o=e.stateManager.select.ranges[e.stateManager.select.ranges.length-1].end.row;if(e.stateManager.endSelectCells(),e.hasListeners(Ax.DRAG_SELECT_END)){const n={event:t,cells:[],col:i,row:o,scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,target:void 0};n.cells=e.getSelectedCellInfos(),e.fireListeners(Ax.DRAG_SELECT_END,n)}}})(t),e.eventManager.LastBodyPointerXY=null,e.eventManager.isDown=!1,e.eventManager.isDraging=!1,e.eventManager.inertiaScroll.endInertia(),"grabing"===i.interactionState&&i.isResizeCol())hP(e);else if("grabing"===i.interactionState&&i.isResizeRow())dP(e);else if(i.isMoveCol()){const i=e.stateManager.endMoveCol();sP(e,i,t)}};t.globalEventListeners.push({name:"pointerup",env:"document",callback:u}),document.addEventListener("pointerup",u);const g=o=>{var n,r,s,a,l;if(e.eventManager.isDown&&e.eventManager.LastBodyPointerXY){const t=null!==(r=null===(n=e.eventManager.LastBodyPointerXY)||void 0===n?void 0:n.x)&&void 0!==r?r:o.x,i=null!==(a=null===(s=e.eventManager.LastBodyPointerXY)||void 0===s?void 0:s.y)&&void 0!==a?a:o.y;(Math.abs(t-o.x)>1||Math.abs(i-o.y)>1)&&(e.eventManager.isDraging=!0)}const{x:h,y:d}=e._getMouseAbstractPoint(o,!1);i.interactionState===JC.grabing&&(i.isResizeCol()?(t.dealColumnResize(h,d),e.hasListeners(Ax.RESIZE_COLUMN)&&e.fireListeners(Ax.RESIZE_COLUMN,{col:e.stateManager.columnResize.col,colWidth:e.getColWidth(e.stateManager.columnResize.col)})):i.isResizeRow()&&(t.dealRowResize(h,d),e.hasListeners(Ax.RESIZE_ROW)&&e.fireListeners(Ax.RESIZE_ROW,{row:e.stateManager.rowResize.row,rowHeight:e.getRowHeight(e.stateManager.rowResize.row)})));const c=e.stateManager.isSelecting();if(t._enableTableScroll&&t.isDraging&&c&&(null===(l=e.stateManager.select.ranges)||void 0===l?void 0:l.length)>0){const t=e.getDrawRange(),i=e.getFrozenRowsHeight(),o=e.getBottomFrozenRowsHeight(),n=e.getFrozenColsWidth(),r=e.getRightFrozenColsWidth(),s=e.stateManager.select.ranges[e.stateManager.select.ranges.length-1].start;if(e.isSeriesNumber(s.col,s.row))return;const a=e.stateManager.select.ranges[e.stateManager.select.ranges.length-1].end,l=(!1===e.isFrozenRow(s.row)||!1===e.isFrozenRow(a.row))&&e.getAllRowsHeight()>e.tableNoFrameHeight,c=(!1===e.isFrozenColumn(s.col)||!1===e.isFrozenColumn(a.col))&&e.getAllColsWidth()>e.tableNoFrameWidth;if((d>t.bottom-o||d<t.top+i)&&l||(h>t.right-r||h<t.left+n)&&c){e.eventManager.scrollXSpeed=0,e.eventManager.scrollYSpeed=0;let s=!1,a=!1,u=!1,g=!1;d>t.bottom-o&&l&&e.scrollTop+e.tableNoFrameHeight<e.getAllRowsHeight()?(s=!0,e.eventManager.scrollYSpeed=-(d-t.bottom+o)/50):d<t.top+i&&l&&e.scrollTop>0&&(a=!0,e.eventManager.scrollYSpeed=-(d-t.top-i)/50),h>t.right-r&&c&&e.scrollLeft+e.tableNoFrameWidth<e.getAllColsWidth()?(u=!0,e.eventManager.scrollXSpeed=-(h-t.right+r)/50):h<t.left+n&&c&&e.scrollLeft>0&&(g=!0,e.eventManager.scrollXSpeed=-(h-t.left-n)/50),e.eventManager.inertiaScroll.startInertia(e.eventManager.scrollXSpeed,e.eventManager.scrollYSpeed,1),e.eventManager.inertiaScroll.setScrollHandle(((l,c)=>{var p;let f,v;iP({deltaX:-l,deltaY:-c},e.stateManager,!1),s?v=e.scrollTop+t.height-o-20:a&&(v=e.scrollTop+i+20),u?f=e.scrollLeft+t.width-r-20:g&&(f=e.scrollLeft+n+20);let b=!1,m=!1;u||g||(h>e.tableNoFrameWidth-e.getRightFrozenColsWidth()&&h<e.tableNoFrameWidth||h>0&&h<e.getFrozenColsWidth()?(f=h,m=!0):f=e.scrollLeft+h),s||a||(d>e.tableNoFrameHeight-e.getBottomFrozenRowsHeight()&&d<e.tableNoFrameHeight||d>0&&d<e.getFrozenRowsHeight()?(v=d,b=!0):v=e.scrollTop+d),e.stateManager.updateInteractionState(JC.grabing);const y=e.getTargetColAtConsiderRightFrozen(f,m),C=e.getTargetRowAtConsiderBottomFrozen(v,b);!(null===(p=e.options.select)||void 0===p?void 0:p.disableDragSelect)&&ot(y)&&ot(C)&&e.stateManager.updateSelectPos(y.col,C.row,!1,!1,!1,!1)}))}else e.eventManager.inertiaScroll.isInertiaScrolling()?e.eventManager.inertiaScroll.endInertia():e.eventManager.scrollYSpeed=0}};t.globalEventListeners.push({name:"pointermove",env:"body",callback:g}),document.body.addEventListener("pointermove",g)}(this),function(t){const e=t.table,i=e.stateManager,o=e.scenegraph;o.component.vScrollBar.addEventListener("pointerover",(t=>{i.showVerticalScrollBar()})),o.component.hScrollBar.addEventListener("pointerover",(t=>{i.showHorizontalScrollBar()})),o.component.vScrollBar.addEventListener("pointerout",(t=>{i.interactionState!==JC.scrolling&&i.hideVerticalScrollBar()})),o.component.hScrollBar.addEventListener("pointerout",(t=>{i.interactionState!==JC.scrolling&&i.hideHorizontalScrollBar()})),o.component.vScrollBar.addEventListener("pointermove",(t=>{o.table.stateManager.updateCursor("default"),t.stopPropagation()})),o.component.vScrollBar.addEventListener("pointerdown",(t=>{t.stopPropagation(),o.table.hasListeners(Ax.MOUSEDOWN_TABLE)&&o.table.fireListeners(Ax.MOUSEDOWN_TABLE,{event:t.nativeEvent})})),o.component.vScrollBar.addEventListener("scrollDown",(t=>{var e;o.table.eventManager.LastBodyPointerXY={x:t.x,y:t.y},o.table.eventManager.isDown=!0,i.interactionState!==JC.scrolling&&i.updateInteractionState(JC.scrolling),o.table.stateManager.hideMenu(),null===(e=o.table.editorManager)||void 0===e||e.completeEdit(),o.table.hasListeners(Ax.MOUSEDOWN_TABLE)&&o.table.fireListeners(Ax.MOUSEDOWN_TABLE,{event:t.nativeEvent})})),o.component.vScrollBar.addEventListener("pointerup",(()=>{i.fastScrolling=!1,o.table.eventManager.isDraging=!1,i.interactionState===JC.scrolling&&i.updateInteractionState(JC.default)})),o.component.vScrollBar.addEventListener("pointerupoutside",(()=>{i.fastScrolling=!1,i.interactionState===JC.scrolling&&i.updateInteractionState(JC.default)})),o.component.vScrollBar.addEventListener("scrollUp",(t=>{o.table.eventManager.isDraging=!1})),o.component.hScrollBar.addEventListener("pointermove",(t=>{o.table.stateManager.updateCursor("default"),t.stopPropagation()})),o.component.hScrollBar.addEventListener("pointerdown",(t=>{t.stopPropagation(),o.table.hasListeners(Ax.MOUSEDOWN_TABLE)&&o.table.fireListeners(Ax.MOUSEDOWN_TABLE,{event:t.nativeEvent})})),o.component.hScrollBar.addEventListener("scrollDown",(t=>{var e;o.table.eventManager.LastBodyPointerXY={x:t.x,y:t.y},o.table.eventManager.isDown=!0,i.interactionState!==JC.scrolling&&i.updateInteractionState(JC.scrolling),o.table.stateManager.hideMenu(),null===(e=o.table.editorManager)||void 0===e||e.completeEdit(),o.table.hasListeners(Ax.MOUSEDOWN_TABLE)&&o.table.fireListeners(Ax.MOUSEDOWN_TABLE,{event:t.nativeEvent})})),o.component.hScrollBar.addEventListener("pointerup",(()=>{i.fastScrolling=!1,o.table.eventManager.isDraging=!1,i.interactionState===JC.scrolling&&i.updateInteractionState(JC.default)})),o.component.hScrollBar.addEventListener("pointerupoutside",(()=>{i.fastScrolling=!1,i.interactionState===JC.scrolling&&i.updateInteractionState(JC.default)})),o.component.hScrollBar.addEventListener("scrollUp",(t=>{o.table.eventManager.isDraging=!1}));const n=$w(i.updateVerticalScrollBar,20),r=$w(i.updateHorizontalScrollBar,20);o.component.vScrollBar.addEventListener("scrollDrag",(t=>{o.table.eventManager.isDown&&(o.table.eventManager.isDraging=!0),i.fastScrolling=!0,i.interactionState!==JC.scrolling&&i.updateInteractionState(JC.scrolling);const e=t.detail.value[0]/(1-t.detail.value[1]+t.detail.value[0]);n(e,t)})),o.component.hScrollBar.addEventListener("scrollDrag",(t=>{o.table.eventManager.isDown&&(o.table.eventManager.isDraging=!0),i.fastScrolling=!0,i.interactionState!==JC.scrolling&&i.updateInteractionState(JC.scrolling);const e=t.detail.value[0]/(1-t.detail.value[1]+t.detail.value[0]);r(e)}))}(this),function(t){const e=t.table,i=e.stateManager,o=e.scenegraph;t.touchMovePoints=[],e.scenegraph.tableGroup.addEventListener("touchstart",(e=>{e.target.isChildOf(o.component.vScrollBar)||e.target.isChildOf(o.component.vScrollBar)||(t.isTouchdown=!0,t.touchMovePoints.push({x:e.page.x,y:e.page.y,timestamp:Date.now()}))}));const n=o=>{var n,r;if(t.touchMove&&o.preventDefault(),t.isTouchdown&&pP(o))if((null===(r=null===(n=t.downIcon)||void 0===n?void 0:n.attribute)||void 0===r?void 0:r.funcType)===sw.dragReorder)o.preventDefault();else if(t.touchMovePoints.length>4&&t.touchMovePoints.shift(),t.touchMovePoints.push({x:o.changedTouches[0].pageX,y:o.changedTouches[0].pageY,timestamp:Date.now()}),t._enableTableScroll){const n=-t.touchMovePoints[t.touchMovePoints.length-1].x+t.touchMovePoints[t.touchMovePoints.length-2].x,r=-t.touchMovePoints[t.touchMovePoints.length-1].y+t.touchMovePoints[t.touchMovePoints.length-2].y;iP({deltaX:n,deltaY:r},i),o.cancelable&&("none"===e.internalProps.overscrollBehavior||Math.abs(r)>=Math.abs(n)&&0!==r&&oP(r,i)||Math.abs(r)<=Math.abs(n)&&0!==n&&nP(n,i))&&o.preventDefault()}};window.addEventListener("touchmove",n,{passive:!1}),t.globalEventListeners.push({name:"touchmove",env:"window",callback:n});const r=i=>{var o,n,r,s;if(t.touchEnd=!0,t.touchMove=!1,t.isTouchdown&&pP(i)){if((null===(n=null===(o=t.downIcon)||void 0===o?void 0:o.attribute)||void 0===n?void 0:n.funcType)===sw.dragReorder)i.preventDefault();else if((null===(r=t.touchMovePoints)||void 0===r?void 0:r.length)&&(t.touchMovePoints.length>4&&t.touchMovePoints.shift(),t.touchMovePoints.push({x:i.changedTouches[0].pageX,y:i.changedTouches[0].pageY,timestamp:Date.now()}),t._enableTableScroll)){const i=t.touchMovePoints[0],o=t.touchMovePoints[(null===(s=t.touchMovePoints)||void 0===s?void 0:s.length)-1],n=(o.x-i.x)/(o.timestamp-i.timestamp),r=(o.y-i.y)/(o.timestamp-i.timestamp);t.inertiaScroll.startInertia(n,r,.95),e.eventManager.inertiaScroll.setScrollHandle(((t,i)=>{iP({deltaX:-t,deltaY:-i},e.stateManager)}))}t.isTouchdown=!1,t.touchMovePoints=[]}};window.addEventListener("touchend",r),t.globalEventListeners.push({name:"touchend",env:"window",callback:r});const s=e=>{t.touchEnd=!0,t.touchMove=!1,t.isTouchdown&&(t.isTouchdown=!1,t.touchMovePoints=[])};window.addEventListener("touchcancel",s),t.globalEventListeners.push({name:"touchcancel",env:"window",callback:s})}(this),lP(this)}updateEventBinder(){setTimeout((()=>{var t;this.table.isReleased||($M(this.table)&&0===(null===(t=this.handleTextStickBindId)||void 0===t?void 0:t.length)?(this.handleTextStickBindId.push(this.table.on(Ax.SCROLL,(t=>{NM(this.table)}))),this.handleTextStickBindId.push(this.table.on(Ax.RESIZE_COLUMN_END,(t=>{NM(this.table)}))),this.handleTextStickBindId.push(this.table.on(Ax.RESIZE_ROW_END,(t=>{NM(this.table)})))):!$M(this.table)&&this.handleTextStickBindId&&(this.handleTextStickBindId.forEach((t=>{this.table.off(t)})),this.handleTextStickBindId=[]),eP(this.table))}),0)}bindSelfEvent(){var t;this.table.isReleased||(wP(this.table),(t=this.table).on(Ax.DROPDOWN_MENU_CLICK,(()=>{t.stateManager.hideMenu()})),this.updateEventBinder(),function(t){"browser"===zw.mode&&t.on(Ax.CLICK_CELL,(e=>{const{col:i,row:o}=e;if("image"===e.target.type&&e.target.role&&e.target.role.startsWith("icon"))return;let n;n=t.internalProps.layoutMap.isHeader(i,o)?t.isPivotTable()?t._getHeaderLayoutMap(i,o).headerType:t.getHeaderDefine(i,o).headerType:t.getBodyColumnType(i,o);const r=t.isHeader(i,o)?t.getHeaderDefine(i,o):t.getBodyColumnDefine(i,o),s=t.getCellValue(i,o),a=t.getCellOriginValue(i,o);if("link"===n){let e=ux(r.linkJump,{col:i,row:o,table:t,value:s,dataValue:a,cellHeaderPaths:void 0});if(e=!1!==e,!e)return;const n=r.templateLink;let l,h=ux(r.linkDetect,{col:i,row:o,table:t,value:s,dataValue:a,cellHeaderPaths:void 0});if(h=!1!==h,n){const e=t.getCellOriginRecord(i,o);if(e&&e.vtableMerge)return;const r=Object.assign({__value:s,__dataValue:a},e);if(et(n))l=n(r,i,o,t);else{const t=/\{\s*(\S+?)\s*\}/g;l=n.replace(t,((t,e)=>r[e]))}}else if(h){if(!Nx.test(s))return;l=s}else l=s;if(!l)return;const d=r.linkTarget,c=r.linkWindowFeatures;window.open(l,d,c)}else if("image"===n){const{clickToPreview:t}=r;if(!1===t)return;const e=document.createElement("div");e.style.width="100%",e.style.height="100%",e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.backgroundColor="rgba(30, 30, 30, 0.4)",e.style.display="flex",e.style.justifyContent="center",e.style.alignItems="center",e.style.overflow="hidden",e.style.zIndex="9999",e.addEventListener("click",(t=>{t.target===e&&document.body.removeChild(e)}));const i=new Image;i.src=s,i.style.maxWidth="80%",i.style.maxHeight="80%",e.appendChild(i),document.body.appendChild(e)}else if("video"===n){const{clickToPreview:t}=r;if(!1===t)return;const e=document.createElement("div");e.style.width="100%",e.style.height="100%",e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.backgroundColor="rgba(30, 30, 30, 0.4)",e.style.display="flex",e.style.justifyContent="center",e.style.alignItems="center",e.style.overflow="hidden",e.style.zIndex="9999",e.addEventListener("click",(t=>{t.target===e&&document.body.removeChild(e)}));const i=document.createElement("video");i.src=s,i.style.maxWidth="80%",i.style.maxHeight="80%",i.setAttribute("preload","auto"),i.setAttribute("controls","true"),e.appendChild(i),document.body.appendChild(e)}}))}(this.table),function(t){t.on(Ax.DBLCLICK_CELL,(e=>{var i,o,n;if(e.federatedEvent){const r=VB(e.federatedEvent),s=t.scenegraph.getResizeColAt(r.abstractPos.x,r.abstractPos.y,null===(i=r.eventArgs)||void 0===i?void 0:i.targetCell),a=null!==(o=t.options.disableDblclickAutoResizeColWidth)&&void 0!==o?o:null===(n=t.options.resize)||void 0===n?void 0:n.disableDblclickAutoResizeColWidth;if(t.eventManager.checkCellFillhandle(r))t.fireListeners(Ax.DBLCLICK_FILL_HANDLE,{});else if(t._canResizeColumn(s.col,s.row)&&s.col>=0&&!a){t.scenegraph.updateAutoColWidth(s.col),t.internalProps._widthResizedColMap.add(s.col),t.scenegraph.updateChartSizeForResizeColWidth(s.col);const e=t.stateManager;e.columnResize.col<e.table.frozenColCount&&!e.table.isPivotTable()&&!e.table.transpose&&e.table.scenegraph.component.setFrozenColumnShadow(e.table.frozenColCount-1,e.columnResize.isRightFrozen);const i=[];for(let e=0;e<t.colCount;e++)i.push(t.getColWidth(e));t.fireListeners(Ax.RESIZE_COLUMN_END,{col:s.col,colWidths:i})}}}))}(this.table),this.table.isPivotTable()&&function(t){const e=t.internalProps.layoutMap.rowsDefine,i=t.internalProps.layoutMap.columnsDefine;for(let t=0;t<e.length;t++){const i=e[t];if("string"!=typeof i&&(i.drillDown||i.drillUp))return!0}for(let t=0;t<i.length;t++){const e=i[t];if("string"!=typeof e&&(e.drillDown||e.drillUp))return!0}return!1}(this.table)&&function(t){t.on(Ax.MOUSEENTER_CELL,(e=>{const{col:i,row:o}=e;if(-1===i||-1===o)return;const n=t.internalProps.layoutMap.getHeaderDimension(i,o);(null==n?void 0:n.drillDown)||(null==n?void 0:n.drillUp)?t.stateManager.updateDrillState(n.dimensionKey,n.title,n.drillDown,n.drillUp,i,o):t.stateManager.updateDrillState(void 0,void 0,!1,!1,-1,-1)})),t.on(Ax.MOUSELEAVE_TABLE,(e=>{t.stateManager.updateDrillState(void 0,void 0,!1,!1,-1,-1)}))}(this.table),eP(this.table),function(t){t.isPivotChart()&&t.scenegraph.tableGroup.addEventListener("click",(e=>{var i;if(!t.stateManager.columnMove.moving&&!t.stateManager.columnResize.resizing)if("axis-label"===e.target.name){const i=VB(e),{col:o,row:n}=i.eventArgs,r=t.internalProps.layoutMap;let s,a;r.indicatorsAsCol?(s=r.getDimensionKeyInChartSpec(r.rowHeaderLevelCount,n),a=r.getCellHeaderPaths(r.rowHeaderLevelCount-2,n).rowHeaderPaths):(s=r.getDimensionKeyInChartSpec(o,r.columnHeaderLevelCount),a=r.getCellHeaderPaths(o,r.columnHeaderLevelCount-1).colHeaderPaths);const l=a.map((t=>({key:t.dimensionKey,value:t.value}))).filter((t=>t.key));if(l.push({key:s,value:e.target.attribute.text}),t._selectedDimensionInChart.length&&function(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i].key!==e[i].key||t[i].value!==e[i].value)return!1;return!0}(t._selectedDimensionInChart,l))return;t._selectedDimensionInChart=l,r.updateDataStateToChartInstance(),AL(t.scenegraph),t.scenegraph.updateNextFrame()}else(null===(i=t._selectedDimensionInChart)||void 0===i?void 0:i.length)&&(t._selectedDimensionInChart.length=0,t.internalProps.layoutMap.updateDataStateToChartInstance(),AL(t.scenegraph),t.scenegraph.updateNextFrame())}))}(this.table),function(t){t.isPivotChart()&&(t.on(Ax.MOUSEENTER_CELL,(e=>{t.scenegraph.getCell(e.col,e.row).forEachChildren((i=>{if("axis"===i.name){const i=fP(e.col,e.row,t.internalProps.layoutMap);e.axisPosition=i,t.fireListeners(Ax.MOUSEENTER_AXIS,e)}}))})),t.on(Ax.MOUSELEAVE_CELL,(e=>{t.scenegraph.getCell(e.col,e.row).forEachChildren((i=>{if("axis"===i.name){const i=fP(e.col,e.row,t.internalProps.layoutMap);e.axisPosition=i,t.fireListeners(Ax.MOUSELEAVE_AXIS,e)}}))})))}(this.table),function(t){t.on("checkbox_state_change",(e=>{var i,o;const{col:n,row:r,checked:s,field:a}=e;if("_vtable_rowSeries_number"!==a||!0!==(null===(i=t.internalProps.rowSeriesNumber)||void 0===i?void 0:i.enableTreeCheckbox))return;if(t.isHeader(n,r))return;const l=t.getCellOriginRecord(n,r),h=t.dataSource.currentPagerIndexedData,d=t.getRecordShowIndexByCell(n,r);let c=h[d];if(ut(c)&&(c=[c]),l.vtableMerge||(null===(o=l.children)||void 0===o?void 0:o.length))if(s)CP(t,n,r)===nw.collapse?yP(!0,c,t):vP(!0,d,c,h,t),bP(d,c,h,t);else{CP(t,n,r)===nw.collapse?yP(!1,c,t):vP(!1,d,c,h,t),bP(d,c,h,t);const e=t.stateManager.headerCheckedState._vtable_rowSeries_number,i=t.stateManager.updateHeaderCheckedState("_vtable_rowSeries_number",n,r);e!==i&&t.scenegraph.updateHeaderCheckboxCellState(n,r,i)}else bP(d,c,h,t)}))}(this.table),function(t){t.on("checkbox_state_change",(e=>{const{col:i,row:o,checked:n,field:r}=e;if(t.isHeader(i,o))t.stateManager.setHeaderCheckedState(r,n),"checkbox"===t.getCellType(i,o)&&t.scenegraph.updateCheckboxCellState(i,o,n);else if(t.stateManager.setCheckedState(i,o,r,n),"checkbox"===t.getCellType(i,o)){const e=t.stateManager.headerCheckedState[r],n=t.stateManager.updateHeaderCheckedState(r,i,o);e!==n&&t.scenegraph.updateHeaderCheckboxCellState(i,o,n)}}))}(this.table),function(t){t.on(Ax.CLICK_CELL,(e=>{const{col:i,row:o,target:n}=e;"button"!==n.name||n.attribute.disable||t.hasListeners(Ax.BUTTON_CLICK)&&t.fireListeners(Ax.BUTTON_CLICK,{col:i,row:o,event:e.event})}))}(this.table),function(t){t.on(Ax.CONTEXTMENU_CELL,(e=>{const{col:i,row:o}=e,n=t.getSelectedCellRanges();let r=!1;if(n.length>0)for(let t=0;t<n.length;t++){const e=n[t];if(i>=e.start.col&&i<=e.end.col&&o>=e.start.row&&o<=e.end.row){r=!0;break}}r||t.selectCell(i,o)}))}(this.table))}dealTableHover(t){if(!t)return void this.table.stateManager.updateHoverPos(-1,-1);const{eventArgs:e}=t;e?this.table.stateManager.updateHoverPos(e.col,e.row):this.table.stateManager.updateHoverPos(-1,-1)}dealIconHover(t){const{eventArgs:e}=t;e?this.table.stateManager.updateHoverIcon(e.col,e.row,e.target,e.targetCell):this.table.stateManager.updateHoverIcon(-1,-1,void 0,void 0)}dealMenuHover(t){}dealTableSelect(t,e){var i,o,n,r,s;if(!t)return this.table.stateManager.updateSelectPos(-1,-1),!1;const{eventArgs:a}=t;if(a){if("checkbox"===a.target.name||"radio"===a.target.name||"switch"===a.target.name||"button"===a.target.name)return!1;if(this.table.isHeader(a.col,a.row)&&Pk(this.table,a.col,a.row))return e||this.table.stateManager.updateSelectPos(-1,-1),!1;if(!this.table.isHeader(a.col,a.row)&&Pk(this.table,a.col,a.row)){if(!e){const t=!!(null===(i=this.table.stateManager.select.ranges)||void 0===i?void 0:i.length);this.table.stateManager.updateSelectPos(-1,-1),t&&this.table.stateManager.endSelectCells(!0,t)}return!1}return!this.table.isPivotChart()||"axis-label"!==(null===(o=null==t?void 0:t.eventArgs)||void 0===o?void 0:o.target.name)&&"chart"!==(null===(n=null==t?void 0:t.eventArgs)||void 0===n?void 0:n.target.type)?(this.table.stateManager.updateSelectPos(a.col,a.row,a.event.shiftKey,a.event.ctrlKey||a.event.metaKey,!1,!e&&(null===(s=null===(r=this.table.options.select)||void 0===r?void 0:r.makeSelectCellVisible)||void 0===s||s)),!0):(this.table.stateManager.updateSelectPos(-1,-1),!1)}return!1}dealFillSelect(t,e){var i,o;const{eventArgs:n}=t;if(n){if((null===(o=null===(i=this.table.stateManager.select)||void 0===i?void 0:i.ranges)||void 0===o?void 0:o.length)&&this.table.stateManager.isFillHandle()){let i,o;const r=this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1];e&&(ot(this.table.stateManager.fillHandle.directionRow)||(Math.abs(this.table.stateManager.fillHandle.startY-t.abstractPos.y)>=Math.abs(this.table.stateManager.fillHandle.startX-t.abstractPos.x)?this.table.stateManager.fillHandle.directionRow=!0:this.table.stateManager.fillHandle.directionRow=!1),Math.abs(this.table.stateManager.fillHandle.startY-t.abstractPos.y)>=Math.abs(this.table.stateManager.fillHandle.startX-t.abstractPos.x)?this.table.stateManager.fillHandle.startY-t.abstractPos.y>0?this.table.stateManager.fillHandle.direction="top":this.table.stateManager.fillHandle.direction="bottom":this.table.stateManager.fillHandle.startX-t.abstractPos.x>0?this.table.stateManager.fillHandle.direction="left":this.table.stateManager.fillHandle.direction="right",this.table.stateManager.fillHandle.directionRow?(i=n.row,o=r.end.col):(i=r.end.row,o=n.col)),this.table.stateManager.updateSelectPos(e?o:r.end.col,e?i:r.end.row,!0,n.event.ctrlKey||n.event.metaKey,!1,!e)}else this.table.stateManager.updateSelectPos(n.col,n.row,n.event.shiftKey,n.event.ctrlKey||n.event.metaKey,!1,!e);return!0}return!1}deelTableSelectAll(){this.table.stateManager.updateSelectPos(-1,-1,!1,!1,!0),this.table.fireListeners(Ax.SELECTED_CELL,{ranges:this.table.stateManager.select.ranges,col:0,row:0})}dealMenuSelect(t){}checkColumnResize(t,e){const{eventArgs:i}=t;if(this.table.options.enableTreeStickCell&&!i)return!1;const o=this.table.scenegraph.getResizeColAt(t.abstractPos.x,t.abstractPos.y,null==i?void 0:i.targetCell);return this.table._canResizeColumn(o.col,o.row)&&o.col>=0?(e&&this.table.stateManager.startResizeCol(o.col,t.abstractPos.x,t.abstractPos.y,o.rightFrozen),!0):(this.table.stateManager.isResizeCol()&&this.table.stateManager.endResizeCol(),!1)}checkRowResize(t,e){const{eventArgs:i}=t;if(i){const o=this.table.scenegraph.getResizeRowAt(t.abstractPos.x,t.abstractPos.y,i.targetCell);if(this.table._canResizeRow(o.col,o.row)&&o.row>=0)return e&&this.table.stateManager.startResizeRow(o.row,t.abstractPos.x,t.abstractPos.y,o.bottomFrozen),!0}return!1}cellIsHeaderCheck(t,e){const{eventArgs:i}=t,{col:o,row:n,target:r}=i;return!!this.table.isHeader(o,n)&&"checkbox"===this.table.getCellType(i.col,i.row)&&"checkbox"===r.name}checkCellFillhandle(t,e){var i,o,n,r,s;let a=!1;if(a="function"==typeof(null===(i=this.table.options.excelOptions)||void 0===i?void 0:i.fillHandle)?this.table.options.excelOptions.fillHandle({selectRanges:this.table.stateManager.select.ranges,table:this.table}):null===(o=this.table.options.excelOptions)||void 0===o?void 0:o.fillHandle,a){const{eventArgs:i}=t;if(i&&(null===(r=null===(n=this.table.stateManager.select)||void 0===n?void 0:n.ranges)||void 0===r?void 0:r.length)){const i=Math.max(this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].start.col,this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].end.col),o=Math.max(this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].start.row,this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].end.row),n=Math.min(this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].start.col,this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].end.col),r=Math.min(this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].start.row,this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].end.row);let a;a=i<this.table.colCount-1?this.table.scenegraph.highPerformanceGetCell(i,o).globalAABBBounds:this.table.scenegraph.highPerformanceGetCell(n-1,o).globalAABBBounds;const l=Math.abs(t.abstractPos.x-a.x2);a=o<this.table.rowCount-1?this.table.scenegraph.highPerformanceGetCell(i,o).globalAABBBounds:this.table.scenegraph.highPerformanceGetCell(i,r-1).globalAABBBounds;const h=Math.abs(t.abstractPos.y-a.y2),d=18;if((null===(s=this.table.stateManager.fillHandle)||void 0===s?void 0:s.isFilling)||l<=d/2&&h<=d/2)return e&&this.table.stateManager.startFillSelect(t.abstractPos.x,t.abstractPos.y),!0}}return!1}dealColumnResize(t,e){this.table.stateManager.updateResizeCol(t,e)}dealRowResize(t,e){this.table.stateManager.updateResizeRow(t,e)}checkColumnMover(t){var e;const{eventArgs:i}=t;return!(!i||!this.table._canDragHeaderPosition(i.col,i.row)||(this.table.stateManager.startMoveCol(i.col,i.row,t.abstractPos.x,t.abstractPos.y,null===(e=null==i?void 0:i.event)||void 0===e?void 0:e.nativeEvent),0))}dealColumnMover(t){var e;const{eventArgs:i}=t;ot(i.col)&&ot(i.row)&&this.table.stateManager.updateMoveCol(i.col,i.row,t.abstractPos.x,t.abstractPos.y,null===(e=null==i?void 0:i.event)||void 0===e?void 0:e.nativeEvent)}startColumnResize(t){}dealIconClick(t,e){const{eventArgs:i}=e,{target:o,event:n,col:r,row:s}=i||{target:t.target,event:t,col:-1,row:-1},a=o;if(a.role&&a.role.startsWith("icon-"))return this.table.fireListeners(Ax.ICON_CLICK,{name:a.name,x:(a.globalAABBBounds.x1+a.globalAABBBounds.x2)/2,y:a.globalAABBBounds.y2,col:r,row:s,funcType:a.attribute.funcType,icon:a,event:n}),!0;if(o instanceof gc){const t=o.pickIcon(n.global);if(t)return this.table.fireListeners(Ax.ICON_CLICK,{name:t.attribute.id,x:t.globalX+t.globalAABBBounds.width()/2,y:t.globalY+t.AABBBounds.height(),col:r,row:s,funcType:t.attribute.funcType,icon:t,event:n}),!0}return!1}release(){this.gesture.release(),this.globalEventListeners.forEach((t=>{"document"===t.env?document.removeEventListener(t.name,t.callback):"body"===t.env?document.body.removeEventListener(t.name,t.callback):"window"===t.env&&window.removeEventListener(t.name,t.callback)})),this.globalEventListeners=[]}enableScroll(){this._enableTableScroll=!0}disableScroll(){this._enableTableScroll=!1}}(this),this.animationManager=new HE(this),e.legends){at.legends=[];const t=a_.getFunction("createLegend");if(Array.isArray(e.legends)){for(let i=0;i<e.legends.length;i++)at.legends.push(t(e.legends[i],this));this.scenegraph.tableGroup.setAttributes({x:this.tableX,y:this.tableY})}else at.legends.push(t(e.legends,this)),this.scenegraph.tableGroup.setAttributes({x:this.tableX,y:this.tableY})}if(at.tooltip=Object.assign({parentElement:this.getElement(),renderMode:"html",isShowOverflowTextTooltip:!1,confine:!0,position:ow.bottom},e.tooltip),"html"===at.tooltip.renderMode){const t=a_.getComponent("tooltipHandler");t&&(at.tooltipHandler=new t(this,at.tooltip.confine))}if(at.menu=Object.assign({renderMode:"html"},e.menu),Array.isArray(null===(u=e.menu)||void 0===u?void 0:u.dropDownMenuHighlight)&&this.setDropDownMenuHighlight(null===(g=e.menu)||void 0===g?void 0:g.dropDownMenuHighlight),(Array.isArray(null===(p=e.menu)||void 0===p?void 0:p.defaultHeaderMenuItems)||"function"==typeof(null===(f=e.menu)||void 0===f?void 0:f.defaultHeaderMenuItems))&&(this.globalDropDownMenu=e.menu.defaultHeaderMenuItems),"html"===at.menu.renderMode){const t=a_.getComponent("menuHandler");at.menuHandler=new t(this)}this.headerStyleCache=new Map,this.bodyStyleCache=new Map,this.bodyMergeTitleCache=new Map,this.bodyBottomStyleCache=new Map,at.stick={changedCells:new Map},at.customMergeCell=FE(e.customMergeCell);const ct=a_.getComponent("customCellStylePlugin");ct&&(this.customCellStylePlugin=new ct(this,null!==(v=e.customCellStyle)&&void 0!==v?v:[],null!==(b=e.customCellStyleArrangement)&&void 0!==b?b:[])),this._adjustCanvasSizeByOption()}_adjustCanvasSizeByOption(){"auto"!==this.options.canvasHeight&&"auto"!==this.options.canvasWidth||setTimeout((()=>{var t,e,i,o,n,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x,_;let S,A;if("auto"===this.options.canvasHeight){let u=0;if(null===(t=this.theme.frameStyle)||void 0===t?void 0:t.innerBorder)u+=null!==(o=OE(null!==(i=null===(e=this.internalProps.theme.frameStyle)||void 0===e?void 0:e.shadowBlur)&&void 0!==i?i:[0])[1])&&void 0!==o?o:0;else if(this.theme.frameStyle){const t=OE(null!==(r=null===(n=this.internalProps.theme.frameStyle)||void 0===n?void 0:n.borderLineWidth)&&void 0!==r?r:[null]),e=OE(null!==(a=null===(s=this.internalProps.theme.frameStyle)||void 0===s?void 0:s.shadowBlur)&&void 0!==a?a:[0]);u+=(null!==(l=t[0])&&void 0!==l?l:0)+(null!==(h=e[0])&&void 0!==h?h:0)+((null!==(d=t[2])&&void 0!==d?d:0)+(null!==(c=e[2])&&void 0!==c?c:0))}A=Math.min(this.options.maxCanvasHeight?this.options.maxCanvasHeight-u:2e4,this.getAllRowsHeight())+u}else A=this.canvasHeight;if("auto"===this.options.canvasWidth){let t=0;if(null===(u=this.theme.frameStyle)||void 0===u?void 0:u.innerBorder)t+=null!==(f=OE(null!==(p=null===(g=this.internalProps.theme.frameStyle)||void 0===g?void 0:g.shadowBlur)&&void 0!==p?p:[0])[2])&&void 0!==f?f:0;else if(this.theme.frameStyle){const e=OE(null!==(b=null===(v=this.internalProps.theme.frameStyle)||void 0===v?void 0:v.borderLineWidth)&&void 0!==b?b:[null]),i=OE(null!==(y=null===(m=this.internalProps.theme.frameStyle)||void 0===m?void 0:m.shadowBlur)&&void 0!==y?y:[0]);t+=(null!==(C=e[1])&&void 0!==C?C:0)+(null!==(w=i[1])&&void 0!==w?w:0)+((null!==(x=e[3])&&void 0!==x?x:0)+(null!==(_=i[3])&&void 0!==_?_:0))}S=Math.min(this.options.maxCanvasWidth?this.options.maxCanvasWidth-t:2e4,this.getAllColsWidth())+t}else S=this.canvasWidth;this.setCanvasSize(S,A)}),0)}getContainer(){return this.container}getElement(){return this.internalProps.element}get canvas(){return this.internalProps.canvas}setCanvasSize(t,e){this.canvasWidth=t,this.canvasHeight=e,this.options.canvasHeight=e,this.options.canvasWidth=t,this.resize()}resize(){var t;this._updateSize(),null===(t=this.internalProps.legends)||void 0===t||t.forEach((t=>{null==t||t.resize()})),this.internalProps.title&&this.internalProps.title.resize(),this.internalProps.emptyTip&&this.internalProps.emptyTip.resize(),this.scenegraph.resize()}get rowCount(){return this.internalProps.rowCount}set rowCount(t){this.internalProps.rowCount=t}get colCount(){var t;return null!==(t=this.internalProps.colCount)&&void 0!==t?t:0}set colCount(t){this.internalProps.colCount=t}get frozenColCount(){var t,e,i,o,n;return null!==(n=null!==(i=null===(e=null===(t=this.internalProps)||void 0===t?void 0:t.layoutMap)||void 0===e?void 0:e.frozenColCount)&&void 0!==i?i:null===(o=this.internalProps)||void 0===o?void 0:o.frozenColCount)&&void 0!==n?n:0}set frozenColCount(t){t>=this.colCount&&(t=0),this.internalProps.frozenColCount=t,this.options.frozenColCount=t;const e=this._getMaxFrozenWidth();if(this.getColsWidth(0,t-1)>e)if(this.internalProps.unfreezeAllOnExceedsMaxWidth)this.internalProps.frozenColCount=0;else{const e=this._getComputedFrozenColCount(t);this.internalProps.frozenColCount=e}this.stateManager.setFrozenCol(this.internalProps.frozenColCount)}setFrozenColCount(t){t>=this.colCount&&(t=0),this.internalProps.frozenColCount=t,this.options.frozenColCount=t;const e=this._getMaxFrozenWidth();if(this.getColsWidth(0,t-1)>e)if(this.internalProps.unfreezeAllOnExceedsMaxWidth)this.internalProps.frozenColCount=0;else{const e=this._getComputedFrozenColCount(t);this.internalProps.frozenColCount=e}this.stateManager.setFrozenCol(this.internalProps.frozenColCount)}_setFrozenColCount(t){t>=this.colCount&&(t=0),this.internalProps.frozenColCount=t}_resetFrozenColCount(){this.options.frozenColCount&&(this.tableNoFrameWidth-this.getColsWidth(0,this.options.frozenColCount-1)<=120?this._setFrozenColCount(0):this.frozenColCount!==this.options.frozenColCount&&this._setFrozenColCount(this.options.frozenColCount))}get frozenRowCount(){var t,e,i,o,n;return null!==(n=null!==(i=null===(e=null===(t=this.internalProps)||void 0===t?void 0:t.layoutMap)||void 0===e?void 0:e.frozenRowCount)&&void 0!==i?i:null===(o=this.internalProps)||void 0===o?void 0:o.frozenRowCount)&&void 0!==n?n:0}set frozenRowCount(t){this.internalProps.frozenRowCount=t,this.stateManager.setFrozenRow(this.internalProps.frozenRowCount)}get rightFrozenColCount(){var t,e,i,o,n;return null!==(n=null!==(i=null===(e=null===(t=this.internalProps)||void 0===t?void 0:t.layoutMap)||void 0===e?void 0:e.rightFrozenColCount)&&void 0!==i?i:null===(o=this.internalProps)||void 0===o?void 0:o.rightFrozenColCount)&&void 0!==n?n:0}set rightFrozenColCount(t){this.scenegraph.dealWidthRightFrozen(t)}get bottomFrozenRowCount(){var t,e,i,o,n;return null!==(n=null!==(i=null===(e=null===(t=this.internalProps)||void 0===t?void 0:t.layoutMap)||void 0===e?void 0:e.bottomFrozenRowCount)&&void 0!==i?i:null===(o=this.internalProps)||void 0===o?void 0:o.bottomFrozenRowCount)&&void 0!==n?n:0}set bottomFrozenRowCount(t){this.scenegraph.dealWidthBottomFrozen(t)}get defaultRowHeight(){return ut(this.internalProps.defaultRowHeight)?this.internalProps.defaultRowHeight:40}set defaultRowHeight(t){this.internalProps.defaultRowHeight=t,this.options.defaultRowHeight=t}get defaultHeaderRowHeight(){return this.internalProps.defaultHeaderRowHeight}set defaultHeaderRowHeight(t){this.internalProps.defaultHeaderRowHeight=t,this.options.defaultHeaderRowHeight=t}get defaultColWidth(){return this.internalProps.defaultColWidth}set defaultColWidth(t){this.internalProps.defaultColWidth=t,this.options.defaultColWidth=t}get defaultHeaderColWidth(){return this.internalProps.defaultHeaderColWidth}set defaultHeaderColWidth(t){this.internalProps.defaultHeaderColWidth=t,this.options.defaultHeaderColWidth=t}get colWidthsMap(){return this.internalProps._colWidthsMap}set colWidthsMap(t){this.internalProps._colWidthsMap=t}get colContentWidthsMap(){return this.internalProps._colContentWidthsMap}set colContentWidthsMap(t){this.internalProps._colContentWidthsMap=t}get _colRangeWidthsMap(){return this.internalProps._colRangeWidthsMap}set _colRangeWidthsMap(t){this.internalProps._colRangeWidthsMap=t}get _rowRangeHeightsMap(){return this.internalProps._rowRangeHeightsMap}set _rowRangeHeightsMap(t){this.internalProps._rowRangeHeightsMap=t}get rowHeightsMap(){return this.internalProps._rowHeightsMap}set rowHeightsMap(t){this.internalProps._rowHeightsMap=t}get colWidthsLimit(){return this.internalProps._colWidthsLimit}set colWidthsLimit(t){this.internalProps._colWidthsLimit=t}get keyboardOptions(){var t;return null!==(t=this.internalProps.keyboardOptions)&&void 0!==t?t:null}set keyboardOptions(t){this.internalProps.keyboardOptions=null!=t?t:void 0}get eventOptions(){var t;return null!==(t=this.internalProps.eventOptions)&&void 0!==t?t:null}set eventOptions(t){this.internalProps.eventOptions=null!=t?t:void 0}get widthMode(){return this._widthMode}set widthMode(t){t!==this._widthMode&&(this._widthMode=t,this.options.widthMode=t)}get heightMode(){return this._heightMode}set heightMode(t){t!==this._heightMode&&(this._heightMode=t,this.options.heightMode=t)}get autoFillWidth(){return this._autoFillWidth}set autoFillWidth(t){t!==this._autoFillWidth&&(this._autoFillWidth=t)}get autoFillHeight(){return this._autoFillHeight}set autoFillHeight(t){t!==this._autoFillHeight&&(this._autoFillHeight=t)}get widthAdaptiveMode(){return this._widthAdaptiveMode}set widthAdaptiveMode(t){t!==this._widthAdaptiveMode&&(this._widthAdaptiveMode=t)}get heightAdaptiveMode(){return this._heightAdaptiveMode}set heightAdaptiveMode(t){t!==this._heightAdaptiveMode&&(this._heightAdaptiveMode=t)}_colWidthDefineToPxWidth(t){return"auto"===t?0:OB(this,t)}_getMaxFrozenWidth(){var t;return OB(this,null!==(t=this.options.maxFrozenWidth)&&void 0!==t?t:"80%")}_getComputedFrozenColCount(t){const e=this._getMaxFrozenWidth();let i=t;for(;this.getColsWidth(0,i-1)>e&&(i--,!(i<=0)););return i}_getColWidthLimits(t){const e=this.colWidthsLimit[t];if(!e)return null;const i={};return e.min&&(i.min=OB(this,e.min),i.minDef=e.min),e.max&&(i.max=OB(this,e.max),i.maxDef=e.max),i}_adjustColWidth(t,e){const i=this._getColWidthLimits(t);return Math.max(function(t,e){return t?t.min&&t.min>e?t.min:t.max&&t.max<e?t.max:e:e}(i,e),0)}get pixelRatio(){return this.internalProps.pixelRatio}setPixelRatio(t){var e;if(t!==(null===(e=this.internalProps)||void 0===e?void 0:e.pixelRatio)){this.internalProps.pixelRatio=t;const e=this.canvasWidth;this.internalProps.calcWidthContext={_:this.internalProps,get full(){var i;return"node"===zw.mode?e/(null!=t?t:1):this._.canvas.width/(null!==(i=this._.context.pixelRatio)&&void 0!==i?i:window.devicePixelRatio)}},this.scenegraph.setPixelRatio(t)}}_updateSize(){var t,e,i,o,n,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x,_,S,A,B,R,T,k;const{padding:M}=this;let L=0,P=0;if(this.tableX=0,this.tableY=0,this.options.canvas&&this.options.viewBox)L=this.options.viewBox.x2-this.options.viewBox.x1,P=this.options.viewBox.y2-this.options.viewBox.y1,(null===(t=null==this?void 0:this.scenegraph)||void 0===t?void 0:t.stage)&&(this.options.viewBox?this.scenegraph.stage.setViewBox(this.options.viewBox,!1):this.scenegraph.stage.resize(L,P));else if("browser"===zw.mode){const t=this.getElement();let d=0,c=0;const u=ot(this.canvasWidth),g=ot(this.canvasHeight);if(this.canvasSizeSeted&&(u&&(d=this.canvasWidth),g&&(c=this.canvasHeight)),(!u||!g)&&t.parentElement){const e=t.parentElement.style||window.getComputedStyle(t.parentElement);u||(d=t.parentElement.offsetWidth-(parseInt(e.paddingLeft,10)||0)-(parseInt(e.paddingRight,10)||0)),g||(c=t.parentElement.offsetHeight-parseInt(e.paddingTop||"0px",10)-parseInt(e.paddingBottom||"0px",20)),d=(null!=d?d:1)-(this.options.tableSizeAntiJitter?1:0),c=(null!=c?c:1)-(this.options.tableSizeAntiJitter?1:0)}t.style.width=d&&d-M.left-M.right+"px"||"0px",t.style.height=c&&c-M.top-M.bottom+"px"||"0px";const{canvas:p}=this.internalProps;L=(null!==(i=null===(e=p.parentElement)||void 0===e?void 0:e.offsetWidth)&&void 0!==i?i:1)-(this.options.tableSizeAntiJitter?1:0),P=(null!==(n=null===(o=p.parentElement)||void 0===o?void 0:o.offsetHeight)&&void 0!==n?n:1)-(this.options.tableSizeAntiJitter?1:0),(null===(r=null==this?void 0:this.scenegraph)||void 0===r?void 0:r.stage)?(null===(s=this.options)||void 0===s?void 0:s.viewBox)&&!(null===(a=this.options)||void 0===a?void 0:a.canvas)&&this.scenegraph.stage.resize(L,P):(p.style.width="",p.style.height="",p.width=L,p.height=P,p.style.width=`${L}px`,p.style.height=`${P}px`),(null===(l=this.options)||void 0===l?void 0:l.viewBox)&&(L=this.options.viewBox.x2-this.options.viewBox.x1,P=this.options.viewBox.y2-this.options.viewBox.y1),(null===(h=null==this?void 0:this.scenegraph)||void 0===h?void 0:h.stage)&&(this.options.viewBox?this.scenegraph.stage.setViewBox(this.options.viewBox,!1):this.scenegraph.stage.resize(L,P))}else"node"===zw.mode&&(L=this.canvasWidth-1,P=this.canvasHeight-1);const E=Math.floor(L-function(t){var e;return(null==t?void 0:t.hoverOn)||(null==t?void 0:t.verticalVisible)&&"none"===(null==t?void 0:t.verticalVisible)||!(null==t?void 0:t.verticalVisible)&&"none"===(null==t?void 0:t.visible)?0:null!==(e=null==t?void 0:t.width)&&void 0!==e?e:7}(this.getTheme().scrollStyle)),H=Math.floor(P-function(t){var e;return(null==t?void 0:t.hoverOn)||(null==t?void 0:t.horizontalVisible)&&"none"===(null==t?void 0:t.horizontalVisible)||!(null==t?void 0:t.horizontalVisible)&&"none"===(null==t?void 0:t.visible)?0:null!==(e=null==t?void 0:t.width)&&void 0!==e?e:7}(this.getTheme().scrollStyle));if(null===(d=this.internalProps.theme)||void 0===d?void 0:d.frameStyle){const t=OE(null!==(u=null===(c=this.internalProps.theme.frameStyle)||void 0===c?void 0:c.borderLineWidth)&&void 0!==u?u:[null]),e=OE(null!==(p=null===(g=this.internalProps.theme.frameStyle)||void 0===g?void 0:g.shadowBlur)&&void 0!==p?p:[0]);(null===(f=this.theme.frameStyle)||void 0===f?void 0:f.innerBorder)?(this.tableX=0,this.tableY=0,this.tableNoFrameWidth=E-(null!==(v=e[1])&&void 0!==v?v:0),this.tableNoFrameHeight=H-(null!==(b=e[2])&&void 0!==b?b:0)):(this.tableX=(null!==(m=t[3])&&void 0!==m?m:0)+(null!==(y=e[3])&&void 0!==y?y:0),this.tableY=(null!==(C=t[0])&&void 0!==C?C:0)+(null!==(w=e[0])&&void 0!==w?w:0),this.tableNoFrameWidth=E-((null!==(x=t[1])&&void 0!==x?x:0)+(null!==(_=e[1])&&void 0!==_?_:0))-((null!==(S=t[3])&&void 0!==S?S:0)+(null!==(A=e[3])&&void 0!==A?A:0)),this.tableNoFrameHeight=H-((null!==(B=t[0])&&void 0!==B?B:0)+(null!==(R=e[0])&&void 0!==R?R:0))-((null!==(T=t[2])&&void 0!==T?T:0)+(null!==(k=e[2])&&void 0!==k?k:0)))}}updateViewBox(t){var e,i,o,n,r,s,a,l,h,d,c,u;const g=(null!==(o=null===(i=null===(e=this.options)||void 0===e?void 0:e.viewBox)||void 0===i?void 0:i.x2)&&void 0!==o?o:0)-(null!==(s=null===(r=null===(n=this.options)||void 0===n?void 0:n.viewBox)||void 0===r?void 0:r.x1)&&void 0!==s?s:0),p=(null!==(h=null===(l=null===(a=this.options)||void 0===a?void 0:a.viewBox)||void 0===l?void 0:l.y2)&&void 0!==h?h:0)-(null!==(u=null===(c=null===(d=this.options)||void 0===d?void 0:d.viewBox)||void 0===c?void 0:c.y1)&&void 0!==u?u:0),f=t.x2-t.x1,v=t.y2-t.y1;this.options.viewBox=t,g!==f||p!==v?this.resize():this.scenegraph.stage.setViewBox(this.options.viewBox,!0)}setViewBoxTransform(t,e,i,o,n,r){this.internalProps.modifiedViewBoxTransform=!0,this.scenegraph.stage.window.setViewBoxTransform(t,e,i,o,n,r)}get rowHierarchyType(){return this.dataSource.rowHierarchyType}getColsWidth(t,e){var i;if(t>e)return 0;t=Math.max(t,0),e=Math.min(e,(null!==(i=this.colCount)&&void 0!==i?i:1/0)-1);const o=this._colRangeWidthsMap.get(`$${t}$${e}`);if(null!=o)return o;const n=this._colRangeWidthsMap.get(`$${t}$${e-1}`);if(null!=n){const i=n+this.getColWidth(e);return t>=0&&e>=0&&!Number.isNaN(i)&&this._colRangeWidthsMap.set(`$${t}$${e}`,Math.round(i)),Math.round(i)}let r=0;for(let i=t;i<=e;i++)r+=this.getColWidth(i);return t>=0&&e>=0&&this._colRangeWidthsMap.set(`$${t}$${e}`,Math.round(r)),Math.round(r)}getRowHeight(t){var e;if(ot(this.rowHeightsMap.get(t))){if(null===(e=this.options.customConfig)||void 0===e?void 0:e._disableColumnAndRowSizeRound){const e=this.rowHeightsMap.get(t);let i;return i=t<this.frozenRowCount?this.rowHeightsMap.getSumInRange(0,t):t>=this.rowCount-this.bottomFrozenRowCount?this.rowHeightsMap.getSumInRange(t,this.rowCount-1):this.rowHeightsMap.getSumInRange(this.frozenRowCount,t),i=Number(i.toFixed(2)),Number.isInteger(i)?Math.ceil(e):Math.floor(e)}return this.rowHeightsMap.get(t)}const i=this.getDefaultRowHeight(t);return ut(i)?i:this.defaultRowHeight}getDefaultColumnWidth(t){var e,i;return this.isRowHeader(t,0)||this.isCornerHeader(t,0)?Array.isArray(this.defaultHeaderColWidth)?null!==(e=this.defaultHeaderColWidth[t])&&void 0!==e?e:this.defaultColWidth:this.defaultHeaderColWidth:this.isRightFrozenColumn(t,this.columnHeaderLevelCount)&&this.isPivotTable()?Array.isArray(this.defaultHeaderColWidth)?null!==(i=this.defaultHeaderColWidth[this.rowHeaderLevelCount-this.rightFrozenColCount])&&void 0!==i?i:this.defaultColWidth:this.defaultHeaderColWidth:this.defaultColWidth}getDefaultRowHeight(t){var e,i;return this.isColumnHeader(0,t)||this.isCornerHeader(0,t)||this.isSeriesNumberInHeader(0,t)?Array.isArray(this.defaultHeaderRowHeight)?null!==(e=this.defaultHeaderRowHeight[t])&&void 0!==e?e:this.internalProps.defaultRowHeight:this.defaultHeaderRowHeight:this.isBottomFrozenRow(t)?Array.isArray(this.defaultHeaderRowHeight)?null!==(i=this.defaultHeaderRowHeight[this.columnHeaderLevelCount>0?this.columnHeaderLevelCount-this.bottomFrozenRowCount:0])&&void 0!==i?i:this.internalProps.defaultRowHeight:this.defaultHeaderRowHeight:this.internalProps.defaultRowHeight}_setRowHeight(t,e,i){var o;this.rowHeightsMap.put(t,(null===(o=this.options.customConfig)||void 0===o?void 0:o._disableColumnAndRowSizeRound)?e:Math.round(e)),i&&this._clearRowRangeHeightsMap(t)}setRowHeight(t,e){this.scenegraph.setRowHeight(t,e),this.scenegraph.updateChartSizeForResizeRowHeight(t),this.internalProps._heightResizedRowMap.add(t)}getRowsHeight(t,e){var i,o;if(t>e||0===this.rowCount)return 0;t=Math.max(t,0),e=Math.min(e,(null!==(i=this.rowCount)&&void 0!==i?i:1/0)-1);let n=0;const r="auto"===this.options.defaultRowHeight;if("standard"!==this.heightMode||this.options.customComputeRowHeight||this.autoFillHeight||!this.internalProps.layoutMap||this.hasAutoImageColumn()||r||0!==this.internalProps._heightResizedRowMap.size){if(null===(o=this.options.customConfig)||void 0===o?void 0:o._disableColumnAndRowSizeRound){const i=this.rowHeightsMap.getSumInRange(t,e);let o;return o=e<this.frozenRowCount?this.rowHeightsMap.getSumInRange(0,e):e>=this.rowCount-this.bottomFrozenRowCount?this.rowHeightsMap.getSumInRange(e,this.rowCount-1):this.rowHeightsMap.getSumInRange(this.frozenRowCount,e),o=Number(o.toFixed(2)),Number.isInteger(o)?Math.ceil(i):Math.floor(i)}n=this.rowHeightsMap.getSumInRange(t,e)}else{for(let i=t;i<Math.min(e+1,this.columnHeaderLevelCount);i++)n+=this.getRowHeight(i);e>=this.columnHeaderLevelCount&&(n+=this.defaultRowHeight*(Math.min(e,this.rowCount-this.bottomFrozenRowCount-1)-Math.max(this.columnHeaderLevelCount,t)+1));for(let t=this.rowCount-this.bottomFrozenRowCount;t<e+1;t++)n+=this.getRowHeight(t)}return Math.round(n)}getColWidthDefined(t){var e;const{layoutMap:i}=this.internalProps;if("autoWidth"===this.widthMode)return"auto";const{width:o}=null!==(e=null==i?void 0:i.getColumnWidthDefined(t))&&void 0!==e?e:{};return"number"==typeof o&&o<=0?0:o||this.getDefaultColumnWidth(t)}getColWidthDefinedNumber(t){const e=this.getColWidthDefined(t);return this._adjustColWidth(t,this._colWidthDefineToPxWidth(e))}isAutoRowHeight(t){return"autoHeight"===this.heightMode||!!this.options.customComputeRowHeight||(t>=0&&t<this.columnHeaderLevelCount?"auto"===this.getDefaultRowHeight(t):"auto"===this.internalProps.defaultRowHeight)}getColWidth(t){var e;const i=null!==(e=this.colWidthsMap.get(t))&&void 0!==e?e:this.getDefaultColumnWidth(t);return"adaptive"===this.widthMode&&"number"==typeof i||this.transpose&&"number"==typeof i?this._colWidthDefineToPxWidth(i):this._adjustColWidth(t,this._colWidthDefineToPxWidth(i))}_setColWidth(t,e,i,o){this.colWidthsMap.put(t,"number"==typeof e?Math.round(e):e),i&&this._clearColRangeWidthsMap(t),o||this.stateManager.checkFrozen()}setColWidth(t,e){this.scenegraph.setColWidth(t,e),this.scenegraph.updateChartSizeForResizeColWidth(t),this.internalProps._widthResizedColMap.add(t)}_clearColRangeWidthsMap(t){if("number"!=typeof t)this._colRangeWidthsMap.clear();else{const e=this._colRangeWidthsMap.keys();for(const i of e){const e=zE.exec(i);if(e){const o=Number(e[1]),n=Number(e[2]);t>=o&&t<=n&&this._colRangeWidthsMap.delete(i)}}}}_clearRowRangeHeightsMap(t){this.rowHeightsMap.clearRange()}_getColContentWidth(t){return Number(this.colContentWidthsMap.get(t))}_setColContentWidth(t,e){this.colContentWidthsMap.put(t,e)}getAllRowsHeight(){return this.internalProps.rowCount<=0?0:this.getRowsHeight(0,this.internalProps.rowCount-1)}getAllColsWidth(){return this.internalProps.colCount<=0?0:this.getColsWidth(0,this.internalProps.colCount-1)}getMaxColWidth(t){var e;const i=this.colWidthsLimit[t];let o=null!==(e=i&&i.max)&&void 0!==e?e:1/0;return"string"==typeof o&&(o=OB(this,o)),o}setMaxColWidth(t,e){(this.colWidthsLimit[t]||(this.colWidthsLimit[t]={})).max=e}getMinColWidth(t){var e;const i=this.colWidthsLimit[t];let o=null!==(e=i&&i.min)&&void 0!==e?e:0;return"string"==typeof o&&(o=OB(this,o)),o}setMinColWidth(t,e){(this.colWidthsLimit[t]||(this.colWidthsLimit[t]={})).min=e}getCellRect(t,e){var i,o;const n=this.isFrozenCell(t,e);let r;const s=this.getColWidth(t);let a;r=n&&n.col&&this.isRightFrozenColumn(t,e)?this.getAllColsWidth()<=this.tableNoFrameWidth?this.getColsWidth(0,t-1)||0:this.tableNoFrameWidth-(null!==(i=this.getColsWidth(t,this.colCount-1))&&void 0!==i?i:0):this.getColsWidth(0,t-1)||0;const l=this.getRowHeight(e);return a=n&&n.row&&this.isBottomFrozenRow(t,e)?this.getAllRowsHeight()<=this.tableNoFrameHeight?this.getRowsHeight(0,e-1):this.tableNoFrameHeight-(null!==(o=this.getRowsHeight(e,this.rowCount-1))&&void 0!==o?o:0):this.getRowsHeight(0,e-1),new Px(Math.round(r),Math.round(a),Math.round(s),Math.round(l))}getMergeCellRect(t,e){const i=this.getCellRange(t,e),o=this.getColsWidth(0,i.start.col-1)||0,n=this.getColsWidth(i.start.col,i.end.col),r=this.getRowsHeight(0,i.start.row-1)||0,s=this.getRowsHeight(i.start.row,i.end.row);return new Px(Math.round(o),Math.round(r),Math.round(n),Math.round(s))}getCellRelativeRect(t,e){const i=this.isFrozenCell(t,e);let o=!0,n=!0;(null==i?void 0:i.col)&&(null==i?void 0:i.row)?(o=!1,n=!1):(null==i?void 0:i.col)?o=!1:(null==i?void 0:i.row)&&(n=!1);const r=this.getCellRect(t,e);return this._toRelativeRect(r,o,n)}getCellRangeRelativeRect(t){if(t.start){const e=this.isFrozenCell(t.start.col,t.start.row);let i=!0,o=!0;return(null==e?void 0:e.col)&&(null==e?void 0:e.row)?(i=!1,o=!1):(null==e?void 0:e.col)?i=!1:(null==e?void 0:e.row)&&(o=!1),this._toRelativeRect(this.getCellsRect(t.start.col,t.start.row,t.end.col,t.end.row),i,o)}const e=this.getCellRange(t.col,t.row),i=this.isFrozenCell(t.col,t.row);let o=!0,n=!0;return(null==i?void 0:i.col)&&(null==i?void 0:i.row)?(o=!1,n=!1):(null==i?void 0:i.col)?o=!1:(null==i?void 0:i.row)&&(n=!1),this._toRelativeRect(this.getCellsRect(e.start.col,e.start.row,e.end.col,e.end.row),o,n)}getVisibleCellRangeRelativeRect(t){let e;return e=t.start?t:this.getCellRange(t.col,t.row),this._getVisiableRect(this.getCellRangeRelativeRect(t),e)}_getVisiableRect(t,e){const i=e.start.col>=this.frozenColCount?Math.max(t.left,this.frozenColCount>=1?this.getColsWidth(0,this.frozenColCount-1):0):t.left,o=Math.min(t.right,this.tableNoFrameWidth),n=t.copy();n.left=i,n.right=o;const r=e.start.row>=this.frozenRowCount?Math.max(t.top,this.frozenRowCount>=1?this.getRowsHeight(0,this.frozenRowCount-1):0):t.top,s=Math.min(t.bottom,this.tableNoFrameHeight);return n.top=r,n.bottom=s,n}getCellsRect(t,e,i,o){var n,r,s,a,l,h;let d=this.getColsWidth(0,t-1)||0,c=this.getColsWidth(t,i);const u=this.scrollLeft;this.isLeftFrozenColumn(t)&&this.isRightFrozenColumn(i)?c=this.tableNoFrameWidth-(null!==(n=this.getColsWidth(t+1,this.colCount-1))&&void 0!==n?n:0)-d:this.isLeftFrozenColumn(t)&&!this.isLeftFrozenColumn(i)?c=Math.max(c-u,this.getColsWidth(t,this.frozenColCount-1)):!this.isRightFrozenColumn(t)&&this.isRightFrozenColumn(i)?(d=Math.min(d-u,this.tableNoFrameWidth-this.getRightFrozenColsWidth()),c=this.tableNoFrameWidth-(null!==(r=this.getColsWidth(t+1,this.colCount-1))&&void 0!==r?r:0)-d):this.isRightFrozenColumn(t)&&(d=this.tableNoFrameWidth-(null!==(s=this.getColsWidth(t,this.colCount-1))&&void 0!==s?s:0));let g=this.getRowsHeight(0,e-1),p=this.getRowsHeight(e,o);const f=this.scrollTop;return this.isTopFrozenRow(e)&&this.isBottomFrozenRow(o)?p=this.tableNoFrameHeight-(null!==(a=this.getRowsHeight(e+1,this.rowCount-1))&&void 0!==a?a:0)-g:this.isTopFrozenRow(e)&&!this.isTopFrozenRow(o)?p=Math.max(p-f,this.getRowsHeight(e,this.frozenRowCount-1)):!this.isBottomFrozenRow(e)&&this.isBottomFrozenRow(o)?(g=Math.min(g-f,this.tableNoFrameHeight-this.getBottomFrozenRowsHeight()),p=this.tableNoFrameHeight-(null!==(l=this.getRowsHeight(e+1,this.rowCount-1))&&void 0!==l?l:0)-g):this.isBottomFrozenRow(e)&&(g=this.tableNoFrameHeight-(null!==(h=this.getRowsHeight(e,this.rowCount-1))&&void 0!==h?h:0)),new Px(Math.round(d),Math.round(g),Math.round(c),Math.round(p))}getCellsRectWidth(t,e,i,o){const n=this.isFrozenCell(t,e),r=this.isFrozenCell(i,o);let s=this.getColsWidth(t,i);if(n&&n.col){const e=this.scrollLeft;r&&r.col||(s-=e,s=Math.max(s,this.getColsWidth(t,this.frozenColCount-1)))}return s}getCellRangeRect(t){if(t.start)return this.getCellsRect(t.start.col,t.start.row,t.end.col,t.end.row);const e=this.getCellRange(t.col,t.row);return this.getCellsRect(e.start.col,e.start.row,e.end.col,e.end.row)}getCellRangeRectWidth(t){if(t.start)return this.getCellsRectWidth(t.start.col,t.start.row,t.end.col,t.end.row);const e=this.getCellRange(t.col,t.row);return this.getCellsRectWidth(e.start.col,e.start.row,e.end.col,e.end.row)}isFrozenCell(t,e){const i=this.isFrozenRow(e),o=this.isFrozenColumn(t);return i||o?{row:i,col:o}:null}getRowAt(t){return lE(t,this)}getColAt(t){return hE(t,this)}getCellAt(t,e){return function(t,e,i){const o=lE(e,i),{row:n,top:r,bottom:s,height:a}=o,l=hE(t,i),{col:h,left:d,right:c,width:u}=l;return{row:n,col:h,rect:{left:d,right:c,top:r,bottom:s,width:u,height:a}}}(t,e,this)}getCellAtRelativePosition(t,e){return function(t,e,i){t-=i.tableX;let o=!1;(e-=i.tableY)>0&&e<i.getFrozenRowsHeight()&&(o=!0);let n=!1;t>0&&t<i.getFrozenColsWidth()&&(n=!0);let r=!1;e>i.tableNoFrameHeight-i.getBottomFrozenRowsHeight()&&e<i.tableNoFrameHeight&&e<=i.getAllRowsHeight()&&(r=!0);let s=!1;t>i.tableNoFrameWidth-i.getRightFrozenColsWidth()&&t<i.tableNoFrameWidth&&t<=i.getAllColsWidth()&&(s=!0);const a=uE((n||s?t:t+i.scrollLeft)+i.tableX,s,i),l=gE((o||r?e:e+i.scrollTop)+i.tableY,r,i);if(a&&l){const{row:t,top:e,bottom:i,height:o}=l,{col:n,left:r,right:s,width:h}=a;return{row:t,col:n,rect:{left:r,right:s,top:e,bottom:i,width:h,height:o}}}return{col:-1,row:-1}}(t,e,this)}_checkRowCol(t,e){return t>=0&&t<this.colCount&&e>=0&&e<this.rowCount}_makeVisibleCell(t,e){if(this._checkRowCol(t,e)){const i=this.isFrozenCell(t,e);if(i&&i.col&&i.row)return;const o=this.getCellRect(t,e),n=function(t){let e=0,i=0;t.frozenColCount>0&&(e=t.getFrozenColsWidth()),t.rightFrozenColCount>0&&(i=t.getRightFrozenColsWidth());let o=0,n=0;return t.frozenRowCount>0&&(o=t.getFrozenRowsHeight()),t.bottomFrozenRowCount>0&&(n=t.getBottomFrozenRowsHeight()),new Px(t.scrollLeft+e,t.scrollTop+o,t.tableNoFrameWidth-e-i,t.tableNoFrameHeight-o-n)}(this);if(n.contains(o))return;i&&i.col||this.getColsWidth(0,this.frozenColCount-1)+o.width>this.canvas.width||(o.left<n.left?this.scrollLeft-=n.left-o.left:n.right<o.right&&(this.scrollLeft-=n.right-o.right)),i&&i.row||this.getRowsHeight(0,this.frozenRowCount-1)+o.height>this.canvas.height||(o.top<n.top?this.scrollTop-=n.top-o.top:n.bottom<o.bottom&&(this.scrollTop-=n.bottom-o.bottom))}}render(){this.scenegraph.renderSceneGraph()}renderAsync(){return this.scenegraph.updateNextFrame(),new Promise(((t,e)=>{setTimeout((()=>{t()}),0)}))}_toRelativeRect(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var o,n,r,s;const a=t.copy(),l=this.getVisibleRect();return a.offsetLeft(this.tableX-(e?l.left:0)),a.offsetTop(this.tableY-(i?l.top:0)),a.offsetLeft(null!==(n=null===(o=this.options.viewBox)||void 0===o?void 0:o.x1)&&void 0!==n?n:0),a.offsetTop(null!==(s=null===(r=this.options.viewBox)||void 0===r?void 0:r.y1)&&void 0!==s?s:0),a}getVisibleRect(){const{scrollTop:t,scrollLeft:e}=this,i=this.tableNoFrameWidth,o=this.tableNoFrameHeight;return new Px(e,t,i,o)}get visibleRowCount(){const{frozenRowCount:t}=this,e=this.getVisibleRect(),i=t>0?e.top+this.getRowsHeight(0,t-1):e.top,o=this.getTargetRowAt(i);if(!o)return 0;const n=Math.max(o.top>=i?o.row:o.row+1,t);let r=this.getRowsHeight(0,n-1),s=0;const{rowCount:a}=this;for(let t=n;t<a;t++){const i=r+this.getRowHeight(t);if(e.bottom<i)break;s++,r=i}return s}getBodyVisibleCellRange(){const{scrollTop:t,scrollLeft:e}=this,i=this.getFrozenRowsHeight(),o=this.getFrozenColsWidth(),n=this.getBottomFrozenRowsHeight(),r=this.getRightFrozenColsWidth(),{row:s}=this.getRowAt(t+i+1),{col:a}=this.getColAt(e+o+1),l=this.getAllRowsHeight()>this.tableNoFrameHeight?this.getRowAt(t+this.tableNoFrameHeight-1-n).row:this.rowCount-1,h=this.getAllColsWidth()>this.tableNoFrameWidth?this.getColAt(e+this.tableNoFrameWidth-1-r).col:this.colCount-1;return h<0||l<0?null:{rowStart:s,colStart:a,rowEnd:l,colEnd:h}}getBodyVisibleRowRange(){const{scrollTop:t}=this,e=this.getFrozenRowsHeight(),i=this.getBottomFrozenRowsHeight(),{row:o}=this.getRowAt(t+e+1),n=this.getAllRowsHeight()>this.tableNoFrameHeight?this.getRowAt(t+this.tableNoFrameHeight-1-i).row:this.rowCount-1;return n<0?null:{rowStart:o,rowEnd:n}}getBodyVisibleColRange(){const{scrollLeft:t}=this,e=this.getFrozenColsWidth(),i=this.getRightFrozenColsWidth(),{col:o}=this.getColAt(t+e+1),n=this.getAllColsWidth()>this.tableNoFrameWidth?this.getColAt(t+this.tableNoFrameWidth-1-i).col:this.colCount-1;return n<0?null:{colStart:o,colEnd:n}}get visibleColCount(){const{frozenColCount:t}=this,e=this.getVisibleRect(),i=t>0?e.left+this.getColsWidth(0,t-1):e.left,o=this.getTargetColAt(i);if(!o)return 0;const n=Math.max(o.left>=i?o.col:o.col+1,t);let r=this.getColsWidth(0,n-1),s=0;const{colCount:a}=this;for(let t=n;t<a;t++){const i=r+this.getColWidth(t);if(e.right<i)break;s++,r=i}return s}get scrollTop(){return this.stateManager.scroll.verticalBarPos}set scrollTop(t){this.stateManager.setScrollTop(t)}get scrollLeft(){return this.stateManager.scroll.horizontalBarPos}set scrollLeft(t){this.stateManager.setScrollLeft(t)}getScrollLeft(){return this.scrollLeft}getScrollTop(){return this.scrollTop}setScrollLeft(t){this.scrollLeft=Math.ceil(t)}setScrollTop(t){this.scrollTop=Math.ceil(t)}getCellOverflowText(t,e){return this.scenegraph.getCellOverflowText(t,e)}addReleaseObj(t){if(!t||!t.release||"function"!=typeof t.release)throw new Error("not releaseObj!");(this.internalProps.releaseList=this.internalProps.releaseList||[]).push(t)}dispose(){this.release()}release(){var t,e,i,o,n,r,s,a,l,h,d,c,u,g,p,f;const v=this.internalProps;if(this.isReleased)return;null===(e=null===(t=v.tooltipHandler)||void 0===t?void 0:t.release)||void 0===e||e.call(t),null===(o=null===(i=v.menuHandler)||void 0===i?void 0:i.release)||void 0===o||o.call(i),nR.clearAll(),null===(n=super.release)||void 0===n||n.call(this),null===(s=null===(r=v.handler)||void 0===r?void 0:r.release)||void 0===s||s.call(r),this.eventManager.release(),null===(l=null===(a=v.focusControl)||void 0===a?void 0:a.release)||void 0===l||l.call(a),null===(h=v.legends)||void 0===h||h.forEach((t=>{null==t||t.release()})),null===(d=v.title)||void 0===d||d.release(),v.title=null,null===(c=v.emptyTip)||void 0===c||c.release(),v.emptyTip=null,v.layoutMap.release(),v.releaseList&&(v.releaseList.forEach((t=>{var e;return null===(e=null==t?void 0:t.release)||void 0===e?void 0:e.call(t)})),v.releaseList=null),this.scenegraph.stage.release(),this.scenegraph.proxy.release(),v.focusControl.release();const{parentElement:b}=v.element;b&&!this.options.canvas&&b.removeChild(v.element),null===(p=null===(g=null===(u=this.editorManager)||void 0===u?void 0:u.editingEditor)||void 0===g?void 0:g.onEnd)||void 0===p||p.call(g),this.isReleased=!0,this.scenegraph=null,this.internalProps=null,null===(f=this.reactCustomLayout)||void 0===f||f.clearCache(),bk()}fireListeners(t,e){return super.fireListeners(t,e)}updateOption(t){var e,i,o,n,r,s,a,l,h,d,c,u,g,p,f,v,b,m;this.options=t,this._hasAutoImageColumn=void 0;const{frozenColCount:y=0,unfreezeAllOnExceedsMaxWidth:C,defaultRowHeight:w=40,defaultHeaderRowHeight:x,defaultColWidth:_=80,defaultHeaderColWidth:S=80,keyboardOptions:A,eventOptions:B,rowSeriesNumber:R,columnResizeMode:T,rowResizeMode:k="none",resize:M,dragHeaderMode:L,dragOrder:P,showFrozenIcon:E,allowFrozenColCount:H,padding:F,hover:O,menu:I,select:z,pixelRatio:D,widthMode:W,heightMode:N,autoFillWidth:G,autoFillHeight:j,widthAdaptiveMode:V,heightAdaptiveMode:U,customRender:$,renderChartAsync:X,renderChartAsyncBatchCount:Y,canvasWidth:K,canvasHeight:q,overscrollBehavior:Z,limitMinWidth:J,limitMinHeight:Q}=t;D&&D!==this.internalProps.pixelRatio&&(this.internalProps.pixelRatio=D),F&&("number"==typeof F?(this.padding.top=F,this.padding.left=F,this.padding.bottom=F,this.padding.right=F):(F.top&&(this.padding.top=F.top),F.bottom&&(this.padding.bottom=F.bottom),F.left&&(this.padding.left=F.left),F.right&&(this.padding.right=F.right))),this.showFrozenIcon="boolean"!=typeof E||E,"number"==typeof H&&H<=0&&(this.showFrozenIcon=!1),this.widthMode=null!=W?W:"standard",this.heightMode=null!=N?N:"standard",this._widthAdaptiveMode=null!=V?V:"only-body",this._heightAdaptiveMode=null!=U?U:"only-body",this.autoFillWidth=null!=G&&G,this.autoFillHeight=null!=j&&j,this.customRender=$,this.canvasWidth=ut(K)?K:void 0,this.canvasHeight=ut(q)?q:void 0;const tt=this.internalProps;if("node"===zw.mode||t.canvas||function(t,e){var i,o;t.style.margin=`${e.top}px ${e.right}px ${e.bottom}px ${e.left}px`;const n=(t.offsetWidth||(null===(i=t.parentElement)||void 0===i?void 0:i.offsetWidth)||1)-1,r=(t.offsetHeight||(null===(o=t.parentElement)||void 0===o?void 0:o.offsetHeight)||1)-1;t.style.width=n&&n-e.left-e.right+"px"||"0px",t.style.height=r&&r-e.top-e.bottom+"px"||"0px"}(tt.element,this.padding),this.columnWidthComputeMode=null!==(e=t.columnWidthComputeMode)&&void 0!==e?e:"normal",tt.frozenColCount=y,tt.unfreezeAllOnExceedsMaxWidth=null==C||C,tt.defaultRowHeight=w,tt.defaultHeaderRowHeight=null!=x?x:w,tt.defaultColWidth=_,tt.defaultHeaderColWidth=null!=S?S:_,tt.keyboardOptions=A,tt.eventOptions=B,tt.rowSeriesNumber=R,tt.columnResizeMode=null!==(i=null==M?void 0:M.columnResizeMode)&&void 0!==i?i:T,tt.rowResizeMode=null!==(o=null==M?void 0:M.rowResizeMode)&&void 0!==o?o:k,tt.dragHeaderMode=null!==(r=null!==(n=null==P?void 0:P.dragHeaderMode)&&void 0!==n?n:L)&&void 0!==r?r:"none",tt.renderChartAsync=X,vk(Y),tt.overscrollBehavior=null!=Z?Z:"auto",tt.cellTextOverflows={},tt._rowHeightsMap=new oE(this),tt._rowRangeHeightsMap=new Map,tt._colRangeWidthsMap=new Map,tt._widthResizedColMap=new Set,tt._heightResizedRowMap=new Set,this.colWidthsMap=new Lx,this.colContentWidthsMap=new Lx,this.colWidthsLimit={},tt.stick.changedCells.clear(),tt.theme=n_.of(null!==(s=t.theme)&&void 0!==s?s:n_.DEFAULT),tt.theme.isPivot=this.isPivotTable(),kR(tt.theme.functionalIconsStyle),this.scenegraph.updateStageBackground(),tt.autoWrapText=t.autoWrapText,tt.enableLineBreak=t.enableLineBreak,tt.allowFrozenColCount=null!==(a=t.allowFrozenColCount)&&void 0!==a?a:0,tt.limitMaxAutoWidth=null!==(l=t.limitMaxAutoWidth)&&void 0!==l?l:450,tt.limitMinWidth=null!=J?"number"==typeof J?J:J?10:0:10,tt.limitMinHeight=null!=Q?"number"==typeof Q?Q:Q?10:0:10,null===(h=tt.legends)||void 0===h||h.forEach((t=>{null==t||t.release()})),null===(d=tt.title)||void 0===d||d.release(),tt.title=null,null===(c=tt.emptyTip)||void 0===c||c.release(),tt.emptyTip=null,tt.layoutMap.release(),bk(),this.scenegraph.clearCells(),this.scenegraph.updateComponent(),this.stateManager.updateOptionSetState(),this._updateSize(),this.eventManager.updateEventBinder(),t.legends){tt.legends=[];const e=a_.getFunction("createLegend");if(Array.isArray(t.legends)){for(let i=0;i<t.legends.length;i++)tt.legends.push(e(t.legends[i],this));this.scenegraph.tableGroup.setAttributes({x:this.tableX,y:this.tableY})}else tt.legends.push(e(t.legends,this)),this.scenegraph.tableGroup.setAttributes({x:this.tableX,y:this.tableY})}if(tt.tooltip=Object.assign({parentElement:this.getElement(),renderMode:"html",isShowOverflowTextTooltip:!1,confine:!0,position:ow.bottom},t.tooltip),"html"===tt.tooltip.renderMode&&!tt.tooltipHandler){const t=a_.getComponent("tooltipHandler");tt.tooltipHandler=new t(this,tt.tooltip.confine)}if(tt.menu=Object.assign({renderMode:"html"},t.menu),Array.isArray(null===(u=t.menu)||void 0===u?void 0:u.dropDownMenuHighlight)&&this.setDropDownMenuHighlight(null===(g=t.menu)||void 0===g?void 0:g.dropDownMenuHighlight),(Array.isArray(null===(p=t.menu)||void 0===p?void 0:p.defaultHeaderMenuItems)||"function"==typeof(null===(f=t.menu)||void 0===f?void 0:f.defaultHeaderMenuItems))&&(this.globalDropDownMenu=t.menu.defaultHeaderMenuItems),"html"===tt.menu.renderMode&&!tt.menuHandler){const t=a_.getComponent("menuHandler");tt.menuHandler=new t(this)}this.clearCellStyleCache(),this.clearColWidthCache(),this.clearRowHeightCache(),tt.customMergeCell=FE(t.customMergeCell),null===(v=this.customCellStylePlugin)||void 0===v||v.updateCustomCell(null!==(b=t.customCellStyle)&&void 0!==b?b:[],null!==(m=t.customCellStyleArrangement)&&void 0!==m?m:[]),this._adjustCanvasSizeByOption()}renderWithRecreateCells(){this.internalProps.stick.changedCells.clear();const t={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(t.col,t.row),this.render()}getFrozenRowsHeight(){return this.getRowsHeight(0,this.frozenRowCount-1)}getFrozenColsWidth(){return this.getColsWidth(0,this.frozenColCount-1)}getBottomFrozenRowsHeight(){if(this.bottomFrozenRowCount>0){let t=0;for(let e=this.rowCount-this.bottomFrozenRowCount;e<=this.rowCount-1;e++)t+=this.getRowHeight(e);return t}return 0}getRightFrozenColsWidth(){if(this.rightFrozenColCount>0){let t=0;for(let e=this.colCount-this.rightFrozenColCount;e<=this.colCount-1;e++)t+=this.getColWidth(e);return t}return 0}getDrawRange(){const t=Math.min(this.tableNoFrameWidth,this.getAllColsWidth()),e=Math.min(this.tableNoFrameHeight,this.getAllRowsHeight());return new Px(this.tableX,this.tableY,t,e)}_getMouseAbstractPoint(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var i,o,n,r;let s;if(!t)return{inTable:!1,x:void 0,y:void 0};s=IE(t)?t.changedTouches[0]:t;const a=s.clientX||s.pageX+window.scrollX,l=s.clientY||s.pageY+window.scrollY,h=this.internalProps.canvas.getBoundingClientRect();let d=!0;h.right<=a&&(d=!1),h.bottom<=l&&(d=!1);const c=h.width,u=c/(this.canvas.offsetWidth||c),g=h.height,p=g/(this.canvas.offsetHeight||g),f={x:(a-h.left)/u+(e?this.scrollLeft:0)-(null!==(o=null===(i=this.options.viewBox)||void 0===i?void 0:i.x1)&&void 0!==o?o:0),y:(l-h.top)/p+(e?this.scrollTop:0)-(null!==(r=null===(n=this.options.viewBox)||void 0===n?void 0:n.y1)&&void 0!==r?r:0),inTable:d};return this.internalProps.modifiedViewBoxTransform&&this.scenegraph.stage.window.getViewBoxTransform()&&this.scenegraph.stage.window.getViewBoxTransform().transformPoint(f,f),f}getTheme(){return this.internalProps.theme}getTargetColAt(t){return dE(t,this)}getTargetRowAt(t){const e=cE(t,this);return e&&(e.row=Math.min(e.row,this.rowCount-1)),e}getTargetColAtConsiderRightFrozen(t,e){return uE(t,e,this)}getTargetRowAtConsiderBottomFrozen(t,e){return gE(t,e,this)}clearSelected(){this.stateManager.updateSelectPos(-1,-1)}selectCell(t,e,i,o,n){let r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];var s,a,l;const h=!!(null===(s=this.stateManager.select.ranges)||void 0===s?void 0:s.length);this.stateManager.updateSelectPos(t,e,i,o,!1,null===(l=null!=n?n:null===(a=this.options.select)||void 0===a?void 0:a.makeSelectCellVisible)||void 0===l||l,r),this.stateManager.endSelectCells(!0,h)}selectCells(t){const{scrollLeft:e,scrollTop:i}=this;t.forEach(((t,e)=>{var i,o,n,r,s,a;t.start.col===t.end.col&&t.start.row===t.end.row?this.stateManager.updateSelectPos(t.start.col,t.start.row,!1,e>=1,!1,null===(o=null===(i=this.options.select)||void 0===i?void 0:i.makeSelectCellVisible)||void 0===o||o,!0):(this.stateManager.updateSelectPos(t.start.col,t.start.row,!1,e>=1,!1,null===(r=null===(n=this.options.select)||void 0===n?void 0:n.makeSelectCellVisible)||void 0===r||r,!0),this.stateManager.updateInteractionState(JC.grabing),this.stateManager.updateSelectPos(t.end.col,t.end.row,!1,e>=1,!1,null===(a=null===(s=this.options.select)||void 0===s?void 0:s.makeSelectCellVisible)||void 0===a||a,!0)),this.stateManager.endSelectCells(!1,!1),this.stateManager.updateInteractionState(JC.default)})),this.setScrollTop(i),this.setScrollLeft(e)}get recordsCount(){var t;return null===(t=this.records)||void 0===t?void 0:t.length}get allowFrozenColCount(){return this.internalProps.allowFrozenColCount}get rowHeaderLevelCount(){return this.internalProps.layoutMap.rowHeaderLevelCount}get columnHeaderLevelCount(){return this.internalProps.layoutMap.columnHeaderLevelCount}get records(){return this.internalProps.records}get dataSource(){return this.internalProps.dataSource}set dataSource(t){this.scenegraph.clearCells(),function(t,e){EB(t,(()=>{var i,o;t.internalProps.dataSource&&(null===(o=(i=t.internalProps.dataSource).release)||void 0===o||o.call(i)),e?e instanceof g_?(t.internalProps.dataSource=e,t.internalProps.dataSource.supplementConfig(t.pagination,t.options.columns,t.internalProps.layoutMap.rowHierarchyType,FB(t))):t.internalProps.dataSource=new NA(e):t.internalProps.dataSource=g_.EMPTY,t.addReleaseObj(t.internalProps.dataSource),t.internalProps.records=null}))}(this,t),this.refreshRowColCount(),this.scenegraph.createSceneGraph(),this.render()}get autoWrapText(){return this.internalProps.autoWrapText}set autoWrapText(t){this.internalProps.autoWrapText=t,this.options.autoWrapText=t}get enableLineBreak(){return this.internalProps.enableLineBreak}set enableLineBreak(t){this.internalProps.enableLineBreak=t,this.options.enableLineBreak=t}updateAutoWrapText(t){this.internalProps.autoWrapText!==t&&(this.internalProps.autoWrapText=t,this.options.autoWrapText=t,this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.render())}get theme(){return this.internalProps.theme}set theme(t){this.internalProps.theme=n_.of(null!=t?t:n_.DEFAULT),this.internalProps.theme.isPivot=this.isPivotTable(),this.options.theme=t,kR(this.internalProps.theme.functionalIconsStyle)}updateTheme(t){const e={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.internalProps.theme=n_.of(null!=t?t:n_.DEFAULT),this.internalProps.theme.isPivot=this.isPivotTable(),kR(this.internalProps.theme.functionalIconsStyle),this.options.theme=t,this.scenegraph.updateComponent(),this.scenegraph.updateStageBackground(),this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(e.col,e.row),this.render()}getBodyField(t,e){return this.internalProps.layoutMap.getBody(t,e).field}getBodyColumnDefine(t,e){const i=this.internalProps.layoutMap.getBody(t,e);return null==i?void 0:i.define}getBodyColumnType(t,e){var i,o;return FR("cellType",{cellType:null!==(o=null===(i=this.internalProps.layoutMap.getBody(t,e))||void 0===i?void 0:i.cellType)&&void 0!==o?o:"text"},t,e,this)}getCellType(t,e){let i;return this.isSeriesNumberInHeader(t,e)?this.internalProps.layoutMap.getSeriesNumberHeader(t,e).cellType:(i=this.isHeader(t,e)?this.internalProps.layoutMap.getHeader(t,e).headerType:this.internalProps.layoutMap.getBody(t,e).cellType,FR("cellType",{cellType:i},t,e,this))}getHeaderField(t,e){return this.internalProps.layoutMap.getHeaderField(t,e)}getHeaderDefine(t,e){const i=this.internalProps.layoutMap.getHeader(t,e);return null==i?void 0:i.define}getCellLocation(t,e){return this.internalProps.layoutMap.getCellLocation(t,e)}getCellHeaderPaths(t,e){return this.internalProps.layoutMap.getCellHeaderPaths(t,e)}getHeadersDefine(t,e){const i=[];for(;;){const o=this.getHeaderDefine(t,e);if(!o||!o.field&&!o.columns)break;i.push(o),e++}return i}_getHeaderLayoutMap(t,e){return this.internalProps.layoutMap.getHeader(t,e)}_getBodyLayoutMap(t,e){return this.internalProps.layoutMap.getBody(t,e)}getContext(){return this.internalProps.context}getRecordByCell(t,e){if(!this.internalProps.layoutMap.isHeader(t,e))return this.getCellOriginRecord(t,e)}getRecordByRowCol(t,e){return this.getRecordByCell(t,e)}getRecordStartRowByRecordIndex(t){return this.internalProps.layoutMap.getRecordStartRowByRecordIndex(t)}_getHeaderCellBySortState(t){const{layoutMap:e}=this.internalProps,i=e.headerObjects.find((e=>e&&e.field===t.field));if(i)return e.getHeaderCellAdressById(i.id)}getCellRange(t,e){var i;if(this.internalProps.customMergeCell){const i=this.internalProps.customMergeCell(t,e,this);if(i&&i.range&&(ot(i.text)||i.customLayout||i.customRender))return{start:{col:Math.max(i.range.start.col,0),row:Math.max(i.range.start.row,0)},end:{col:Math.min(i.range.end.col,this.colCount-1),row:Math.min(i.range.end.row,this.rowCount-1)},isCustom:!0}}return null===(i=this.internalProps.layoutMap)||void 0===i?void 0:i.getCellRange(t,e)}hasCustomMerge(){return!!this.internalProps.customMergeCell}getCustomMerge(t,e){if(this.internalProps.customMergeCell){const i=this.internalProps.customMergeCell(t,e,this);if(i&&i.range&&(ot(i.text)||i.customLayout||this.customRender)){if(i.style){const o=this.internalProps.bodyHelper.getStyleClass("text"),n=Iw(i.style,this.theme.bodyStyle,{col:t,row:e,table:this,value:i.text,dataValue:this.getCellOriginValue(t,e),cellHeaderPaths:this.getCellHeaderPaths(t,e)},o,this.options.autoWrapText,this.theme);i.style=n}return i.range={start:{col:Math.max(i.range.start.col,0),row:Math.max(i.range.start.row,0)},end:{col:Math.min(i.range.end.col,this.colCount-1),row:Math.min(i.range.end.row,this.rowCount-1)},isCustom:!0},i}}}isCellRangeEqual(t,e,i,o){return this.internalProps.layoutMap.isCellRangeEqual(t,e,i,o)}_getLayoutCellId(t,e){return this.internalProps.layoutMap.getCellId(t,e)}getHeaderDescription(t,e){var i;const o=this._getHeaderLayoutMap(t,e),n=null==o?void 0:o.define,r=null!==(i=null==n?void 0:n.description)&&void 0!==i?i:null==o?void 0:o.description;return"function"==typeof r?r({col:t,row:e,value:this.getCellValue(t,e),dataValue:this.getCellOriginValue(t,e)}):r}setDropDownMenuHighlight(t){this.stateManager.setDropDownMenuHighlight(t)}_dropDownMenuIsHighlight(t,e,i){return this.stateManager.dropDownMenuIsHighlight(t,e,i)}isSeriesNumberInBody(t,e){return this.internalProps.layoutMap&&this.internalProps.layoutMap.isSeriesNumberInBody(t,e)}isSeriesNumberInHeader(t,e){return this.internalProps.layoutMap&&this.internalProps.layoutMap.isSeriesNumberInHeader(t,e)}isHeader(t,e){return this.internalProps.layoutMap&&this.internalProps.layoutMap.isHeader(t,e)}isColumnHeader(t,e){var i;return null===(i=this.internalProps.layoutMap)||void 0===i?void 0:i.isColumnHeader(t,e)}isRowHeader(t,e){var i;return null===(i=this.internalProps.layoutMap)||void 0===i?void 0:i.isRowHeader(t,e)}isCornerHeader(t,e){var i;return null===(i=this.internalProps.layoutMap)||void 0===i?void 0:i.isCornerHeader(t,e)}isFrozenColumn(t,e){return this.isLeftFrozenColumn(t,e)||this.isRightFrozenColumn(t,e)}isLeftFrozenColumn(t,e){var i;return null===(i=this.internalProps.layoutMap)||void 0===i?void 0:i.isFrozenColumn(t,e)}isRightFrozenColumn(t,e){var i;return null===(i=this.internalProps.layoutMap)||void 0===i?void 0:i.isRightFrozenColumn(t,e)}isFrozenRow(t,e){return this.isTopFrozenRow(t,e)||this.isBottomFrozenRow(t,e)}isTopFrozenRow(t,e){var i;return null===(i=this.internalProps.layoutMap)||void 0===i?void 0:i.isFrozenRow(t,e)}isBottomFrozenRow(t,e){var i;return null===(i=this.internalProps.layoutMap)||void 0===i?void 0:i.isBottomFrozenRow(t,e)}getCellInfo(t,e){if(t>=0&&e>=0){const i=this.isHeader(t,e)?this.getHeaderDefine(t,e):this.getBodyColumnDefine(t,e);return{col:t,row:e,field:this.getHeaderField(t,e),cellHeaderPaths:this.internalProps.layoutMap.getCellHeaderPaths(t,e),title:null==i?void 0:i.title,cellType:this.getCellType(t,e),originData:this.getCellOriginRecord(t,e),cellRange:this.getCellRangeRelativeRect({col:t,row:e}),value:this.getCellValue(t,e),dataValue:this.getCellOriginValue(t,e),cellLocation:this.getCellLocation(t,e),scaleRatio:this.canvas.getBoundingClientRect().width/this.canvas.offsetWidth}}}_hasField(t,e,i){var o;if(null===t)return!1;if(this.internalProps.layoutMap.isHeader(e,i))return!1;const n=this.getRecordShowIndexByCell(e,i);return null===(o=this.internalProps.dataSource)||void 0===o?void 0:o.hasField(n,t)}_getCellStyle(t,e){return function(t,e,i){var o,n,r,s,a,l,h,d,c,u;const g=null===(o=i.customCellStylePlugin)||void 0===o?void 0:o.getCustomCellStyle(t,e),{layoutMap:p}=i.internalProps;if(p.isHeader(t,e)){let o;if(!i.isPivotTable()||i.isBottomFrozenRow(e)||i.isRightFrozenColumn(t))o=`${t}-${e}`;else{const n=i.getHeaderDefine(t,e),r=i.isCornerHeader(t,e);o=(null==n?void 0:n.dimensionKey)?r?`dim-cor-${n.dimensionKey}`:`dim-${n.dimensionKey}`:(null==n?void 0:n.indicatorKey)?`ind-${n.indicatorKey}`:`${t}-${e}`}let l=i.headerStyleCache.get(o);if(l)return g?ME(l,g):l;const h=p.getHeader(t,e);let d;if(i.isPivotChart()&&function(t,e,i){if(!i._table.isPivotChart())return!1;if(i.indicatorsAsCol){if(i.hasTwoIndicatorAxes&&e===i.columnHeaderLevelCount-1&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount)return!0;if(e===i.rowCount-i.bottomFrozenRowCount&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount)return!0}else if(e===i.rowCount-i.bottomFrozenRowCount&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount)return!0;return!1}(t,e,p)&&p.isAxisCell(t,e)?d=null!==(r=null===(n=p.getBody(t,i.rowHeaderLevelCount).style)||void 0===n?void 0:n.padding)&&void 0!==r?r:i.theme.bodyStyle.padding:i.isPivotChart()&&function(t,e,i){if(!i._table.isPivotChart())return!1;if(i.indicatorsAsCol){if(t===i.rowHeaderLevelCount-1&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount)return!0}else{if(t===i.rowHeaderLevelCount-1&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount)return!0;if(t===i.colCount-i.rightFrozenColCount&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount)return!0}return!1}(t,e,p)&&p.isAxisCell(t,e)&&(d=null!==(a=null===(s=p.getBody(i.columnHeaderLevelCount,e).style)||void 0===s?void 0:s.padding)&&void 0!==a?a:i.theme.bodyStyle.padding),(!h||h.isEmpty)&&(p.isLeftBottomCorner(t,e)||p.isRightBottomCorner(t,e)||p.isCornerHeader(t,e)||p.isRightTopCorner(t,e)))return LE;const c=i.internalProps.headerHelper.getStyleClass((null==h?void 0:h.headerType)||"text");if(p.isBottomFrozenRow(t,e)&&i.theme.bottomFrozenStyle)l=tE(d?{padding:d}:{},i.theme.bottomFrozenStyle,{col:t,row:e,table:i,value:i.getCellValue(t,e),dataValue:i.getCellOriginValue(t,e),cellHeaderPaths:i.getCellHeaderPaths(t,e)},c,i.options.autoWrapText,i.theme);else if(p.isRightFrozenColumn(t,e)&&i.theme.rightFrozenStyle)l=tE(d?{padding:d}:{},i.theme.rightFrozenStyle,{col:t,row:e,table:i,value:i.getCellValue(t,e),dataValue:i.getCellOriginValue(t,e),cellHeaderPaths:i.getCellHeaderPaths(t,e)},c,i.options.autoWrapText,i.theme);else{const o=(null==h?void 0:h.style)||{};d&&(o.padding=d),l=tE(o,p.isColumnHeader(t,e)||p.isBottomFrozenRow(t,e)?i.theme.headerStyle:p.isRowHeader(t,e)||p.isRightFrozenColumn(t,e)?i.theme.rowHeaderStyle:i.theme.cornerHeaderStyle,{col:t,row:e,table:i,value:i.getCellValue(t,e),dataValue:i.getCellOriginValue(t,e),cellHeaderPaths:i.getCellHeaderPaths(t,e)},c,i.options.autoWrapText,i.theme)}return i.headerStyleCache.set(o,l),g?ME(l,g):l}let f,v;(null===(h=null===(l=i.internalProps)||void 0===l?void 0:l.dataConfig)||void 0===h?void 0:h.mappingRules)&&!i.isHeader(t,e)&&(null===(u=null===(c=null===(d=i.internalProps)||void 0===d?void 0:d.dataConfig)||void 0===c?void 0:c.mappingRules)||void 0===u||u.forEach(((o,n)=>{o.bgColor&&i.internalProps.layoutMap.getIndicatorKey(t,e)===o.bgColor.indicatorKey&&(f=o.bgColor.mapping)})));const b=i.getCellType(t,e),m=i.getCellOriginRecord(t,e);let y;if(v=(null==m?void 0:m.vtableMerge)?"merge-title":i.isSeriesNumberInBody(t,e)?`${t}-series-`+b:i.isListTable()&&!i.transpose||i.isPivotTable()&&i.internalProps.layoutMap.indicatorsAsCol?t+b:e+b,y=(null==m?void 0:m.vtableMerge)?i.bodyMergeTitleCache.get(v):p.isBottomFrozenRow(e)?i.bodyBottomStyleCache.get(v):i.bodyStyleCache.get(v),y)return g?ME(y,g):y;const C=p.getBody(t,e),w=i.internalProps.bodyHelper.getStyleClass(i.getCellType(t,e)),x=null==C?void 0:C.style;return y=Iw(x,(null==m?void 0:m.vtableMerge)&&i.theme.groupTitleStyle?i.theme.groupTitleStyle:p.isBottomFrozenRow(e)&&i.theme.bottomFrozenStyle?i.theme.bottomFrozenStyle:p.isRightFrozenColumn(t)&&i.theme.rightFrozenStyle?i.theme.rightFrozenStyle:i.theme.bodyStyle,{col:t,row:e,table:i,value:i.getCellValue(t,e),dataValue:i.getCellOriginValue(t,e),cellHeaderPaths:i.getCellHeaderPaths(t,e)},w,i.options.autoWrapText,i.theme),f&&(y=ME(y,{bgColor:f})),et(x)||(p.isBottomFrozenRow(e)?i.bodyBottomStyleCache.set(v,y):i.bodyStyleCache.set(v,y)),g?ME(y,g):y}(t,e,this)}clearCellStyleCache(){this.headerStyleCache.clear(),this.bodyStyleCache.clear(),this.bodyMergeTitleCache.clear(),this.bodyBottomStyleCache.clear()}clearRowHeightCache(){this.internalProps._rowHeightsMap.clear(),this._clearRowRangeHeightsMap()}clearColWidthCache(){this.internalProps._colWidthsMap.clear(),this._clearColRangeWidthsMap()}_canResizeColumn(t,e){if(!(t>=0&&e>=0))return!1;if(this.isCellRangeEqual(t,e,t+1,e))return!1;if("none"===this.internalProps.columnResizeMode)return!1;if("header"===this.internalProps.columnResizeMode){if(!this.isHeader(t,e))return!1}else if("body"===this.internalProps.columnResizeMode&&this.isHeader(t,e))return!1;const i=this.colWidthsLimit[t];return!(i&&i.min&&i.max)||i.max!==i.min}_canResizeRow(t,e){if(!(t>=0&&e>=0))return!1;if(this.isCellRangeEqual(t,e,t,e+1))return!1;if("none"===this.internalProps.rowResizeMode)return!1;if("header"===this.internalProps.rowResizeMode){if(!this.isHeader(t,e))return!1}else if("body"===this.internalProps.rowResizeMode&&this.isHeader(t,e))return!1;return!0}_canDragHeaderPosition(t,e){var i;if(this.isHeader(t,e)&&(this.stateManager.isSelected(t,e)||"body"===(null===(i=this.options.select)||void 0===i?void 0:i.headerSelectMode)&&function(t,e,i){for(let o=0;o<i.length;o++)if(vx(i[o],t,e))return!0;return!1}(t,e,[this.getCellRange(this.stateManager.select.cellPos.col,this.stateManager.select.cellPos.row)])||Pk(this,t,e))){if("disabled"===this.internalProps.frozenColDragHeaderMode&&this.isFrozenColumn(t))return!1;if(this.stateManager.isSelected(t,e)){const i=this.stateManager.select.ranges[0];if(this.isColumnHeader(t,e)){if(i.end.row!==this.rowCount-1)return!1}else{if(!this.isRowHeader(t,e))return!1;if(i.end.col!==this.colCount-1)return!1}}const i=this.getHeaderDefine(t,e);if(!i)return!1;if(void 0===i.dragHeader){if("all"===this.internalProps.dragHeaderMode)return!0;if("column"===this.internalProps.dragHeaderMode){if(this.isColumnHeader(t,e))return!0}else if("row"===this.internalProps.dragHeaderMode&&this.isRowHeader(t,e))return!0;return!1}return i.dragHeader}return!1}getCellIcons(t,e){var i,o,n;let r;if(this.isHeader(t,e))r=this.internalProps.headerHelper.getIcons(t,e);else if(this.internalProps.layoutMap.isSeriesNumber(t,e)){this.options.groupBy&&(null===(i=this.getCellRawRecord(t,e))||void 0===i?void 0:i.vtableMerge)||(null===(n=null===(o=this.internalProps.layoutMap.getSeriesNumberBody(t,e))||void 0===o?void 0:o.define)||void 0===n?void 0:n.dragOrder)&&(r=this.internalProps.rowSeriesNumberHelper.getIcons(t,e));const s=this.getCellValue(t,e),a=this.getCellOriginValue(t,e),l=this.internalProps.context,h=this.internalProps.bodyHelper.getIcons(t,e,s,a,l);(null==r?void 0:r.length)>0?r=r.concat(h):(null==h?void 0:h.length)>0&&(r=h)}else{const i=this.getCellValue(t,e),o=this.getCellOriginValue(t,e),n=this.internalProps.context;r=this.internalProps.bodyHelper.getIcons(t,e,i,o,n)}return r}showDropDownMenu(t,e,i){let o="dropdown-menu";i&&(o=Array.isArray(i.content)?"dropdown-menu":"container"),"html"===this.internalProps.menu.renderMode&&(this.stateManager.menu.isShow=!0,this.internalProps.menuHandler._bindToCell(t,e,o,i))}showTooltip(t,e,i){"html"===this.internalProps.tooltip.renderMode&&this.internalProps.tooltipHandler._bindToCell(t,e,i)}getCellStyle(t,e){const i=this._getCellStyle(t,e),o=IB(i,this,t,e,FR).theme,{autoWrapText:n,lineClamp:r,textOverflow:s}=i;return{textAlign:o.text.textAlign,textBaseline:o.text.textBaseline,bgColor:tt(o.group.fill)?FR("bgColor",i,t,e,this):o.group.fill,color:tt(o.text.fill)?FR("color",i,t,e,this):o.text.fill,strokeColor:tt(o.text.stroke)?FR("strokeColor",i,t,e,this):o.text.stroke,fontFamily:o.text.fontFamily,fontSize:o.text.fontSize,fontWeight:o.text.fontWeight,fontVariant:o.text.fontVariant,fontStyle:o.text.fontStyle,lineHeight:o.text.lineHeight,autoWrapText:null!=n&&n,lineClamp:null!=r?r:"auto",textOverflow:s,borderColor:tt(o.group.stroke)?FR("borderColor",i,t,e,this):o.group.stroke,borderLineWidth:o.group.lineWidth,borderLineDash:o.group.lineDash,underline:!!o.text.underline,underlineDash:o.text.underlineDash,underlineOffset:o.text.underlineOffset,lineThrough:!!o.text.lineThrough,padding:o._vtable.padding,underlineWidth:o.text.underline,lineThroughLineWidth:o.text.lineThrough,_strokeArrayWidth:o.group.strokeArrayWidth,_strokeArrayColor:o.group.strokeArrayColor,_linkColor:FR("linkColor",i,t,e,this)}}getAllBodyCells(t,e){const i=this.rowHeaderLevelCount,o=this.columnHeaderLevelCount,n=this.colCount-1,r=this.rowCount-1;return Array(Math.min(null!=e?e:2e3,r-o+1,this.rowCount)).fill(0).map(((e,r)=>Array(Math.min(null!=t?t:2e3,n-i+1,this.colCount)).fill(0).map(((t,e)=>this.getCellInfo(e+i,r+o)))))}getAllCells(t,e){const i=this.colCount-1,o=this.rowCount-1;return Array(Math.min(null!=e?e:2e3,o-0+1,this.rowCount)).fill(0).map(((e,o)=>Array(Math.min(null!=t?t:2e3,i-0+1,this.colCount)).fill(0).map(((t,e)=>this.getCellInfo(e+0,o+0)))))}getAllColumnHeaderCells(){const t=this.rowHeaderLevelCount,e=this.colCount-1,i=this.columnHeaderLevelCount-1;return Array(i-0+1).fill(0).map(((i,o)=>Array(e-t+1).fill(0).map(((e,i)=>this.getCellInfo(i+t,o+0)))))}getAllRowHeaderCells(){const t=this.columnHeaderLevelCount,e=this.rowHeaderLevelCount-1,i=this.rowCount-1;return Array(i-t+1).fill(0).map(((i,o)=>Array(e-0+1).fill(0).map(((e,i)=>this.getCellInfo(i+0,o+t)))))}getCopyValue(){var t,e,i;if((null===(e=null===(t=this.stateManager.select)||void 0===t?void 0:t.ranges)||void 0===e?void 0:e.length)>0){const t=this.stateManager.select.ranges;let e=Math.min(t[0].start.col,t[0].end.col),o=Math.max(t[0].start.col,t[0].end.col),n=Math.min(t[0].start.row,t[0].end.row),r=Math.max(t[0].start.row,t[0].end.row);t.forEach((t=>{e=Math.min(e,t.start.col,t.end.col),o=Math.max(o,t.start.col,t.end.col),n=Math.min(n,t.start.row,t.end.row),r=Math.max(r,t.start.row,t.end.row)}));const s=e=>{let i=!1;return t.forEach((t=>{const o=Math.min(t.start.row,t.end.row),n=Math.max(t.start.row,t.end.row);o<=e&&n>=e&&(i=!0)})),i},a=e=>{let i=!1;return t.forEach((t=>{const o=Math.min(t.start.col,t.end.col),n=Math.max(t.start.col,t.end.col);o<=e&&n>=e&&(i=!0)})),i},l=(e,i)=>{let o;return t.forEach((t=>{const n=Math.min(t.start.row,t.end.row),r=Math.max(t.start.row,t.end.row),s=Math.min(t.start.col,t.end.col),a=Math.max(t.start.col,t.end.col);s<=e&&a>=e&&n<=i&&r>=i&&(o=t)})),o},h=(t,e,i)=>{const o=this.getCellRange(t,e);let n=o.start.col,r=o.start.row;if(i){const t=Math.min(i.start.col,i.end.col),e=Math.min(i.start.row,i.end.row);n=Math.max(t,o.start.col),r=Math.max(e,o.start.row)}return n!==t||r!==e?"":this.getCellValue(t,e)};let d="";for(let t=n;t<=r;t++)if(s(t)){for(let i=e;i<=o;i++)if(a(i)){const e=l(i,t);if(e){const n=h(i,t,e);if("undefined"!=typeof Promise&&n instanceof Promise);else{const t=ot(n)?`${n}`:"";/^\[object .*\]$/.exec(t)||(d+=t)}(i<e.end.col||i<o)&&(d+="\t")}else d+="\t"}t<r&&(d+="\r\n")}return(null===(i=this.options)||void 0===i?void 0:i.formatCopyValue)&&(d=this.options.formatCopyValue(d)),d}return""}getSelectedCellInfos(){var t;if(!(null===(t=this.stateManager.select)||void 0===t?void 0:t.ranges))return null;const e=this.stateManager.select.ranges;if(!e.length)return[];let i=Math.min(e[0].start.col,e[0].end.col),o=Math.max(e[0].start.col,e[0].end.col),n=Math.min(e[0].start.row,e[0].end.row),r=Math.max(e[0].start.row,e[0].end.row);e.forEach((t=>{i=Math.min(i,t.start.col,t.end.col),o=Math.max(o,t.start.col,t.end.col),n=Math.min(n,t.start.row,t.end.row),r=Math.max(r,t.start.row,t.end.row)}));const s=t=>{let i=!1;return e.forEach((e=>{const o=Math.min(e.start.row,e.end.row),n=Math.max(e.start.row,e.end.row);o<=t&&n>=t&&(i=!0)})),i},a=t=>{let i=!1;return e.forEach((e=>{const o=Math.min(e.start.col,e.end.col),n=Math.max(e.start.col,e.end.col);o<=t&&n>=t&&(i=!0)})),i},l=(t,i)=>{let o;return e.forEach((e=>{const n=Math.min(e.start.row,e.end.row),r=Math.max(e.start.row,e.end.row),s=Math.min(e.start.col,e.end.col),a=Math.max(e.start.col,e.end.col);s<=t&&a>=t&&n<=i&&r>=i&&(o=e)})),o},h=[];for(let t=n;t<=r;t++)if(s(t)){const e=[];for(let n=i;n<=o;n++)if(a(n)&&l(n,t)){const i=this.getCellInfo(n,t);e.push(i)}h.push(e)}return h}getSelectedCellRanges(){const t=this.stateManager.select.ranges;return t.length?St(t):[]}measureText(t,e){return CT.measureText(t,e)}measureTextBounds(t){return xT(t)}getCustomRender(t,e){let i;if("body"!==this.getCellLocation(t,e)){const o=this.getHeaderDefine(t,e);i=null==o?void 0:o.headerCustomRender}else{const o=this.getBodyColumnDefine(t,e);i=(null==o?void 0:o.customRender)||this.customRender}return i}getCustomLayout(t,e){let i;if("body"!==this.getCellLocation(t,e)){const o=this.getHeaderDefine(t,e);i=null==o?void 0:o.headerCustomLayout}else{const o=this.getBodyColumnDefine(t,e);i=null==o?void 0:o.customLayout}return i}hasAutoImageColumn(){return void 0===this._hasAutoImageColumn&&(this._hasAutoImageColumn=function(t){const{columns:e,rows:i,indicators:o}=t.options;if(t.isPivotTable()){if(ht(e)&&e.length>0)for(let t=0;t<e.length;t++){const i=e[t];if(!lt(i)&&("image"===i.headerType||"video"===i.headerType||"function"==typeof i.headerType)&&i.imageAutoSizing)return!0}if(ht(i)&&i.length>0)for(let t=0;t<i.length;t++){const e=i[t];if(!lt(e)&&("image"===e.headerType||"video"===e.headerType||"function"==typeof e.headerType)&&e.imageAutoSizing)return!0}if(ht(o)&&o.length>0)for(let t=0;t<o.length;t++){const e=o[t];if(!lt(e)&&(("image"===e.cellType||"video"===e.cellType||"function"==typeof e.cellType)&&e.imageAutoSizing||("image"===e.headerType||"video"===e.headerType||"function"==typeof e.headerType)&&e.imageAutoSizing))return!0}}else if(ht(e)&&e.length>0)for(let t=0;t<e.length;t++){const i=e[t];if(("image"===i.cellType||"video"===i.cellType||"function"==typeof i.cellType)&&i.imageAutoSizing||("image"===i.headerType||"video"===i.headerType||"function"==typeof i.headerType)&&i.imageAutoSizing)return!0}return!1}(this)),this._hasAutoImageColumn}_getActiveChartInstance(){var t,e,i,o,n,r;const s=this.scenegraph.getCell(null===(e=null===(t=this.stateManager.hover)||void 0===t?void 0:t.cellPos)||void 0===e?void 0:e.col,null===(o=null===(i=this.stateManager.hover)||void 0===i?void 0:i.cellPos)||void 0===o?void 0:o.row);return"chart"===(null===(r=null===(n=null==s?void 0:s.getChildren())||void 0===n?void 0:n[0])||void 0===r?void 0:r.type)?s.getChildren()[0].activeChartInstance:null}cellIsInVisualView(t,e){var i,o,n,r;const s=this.getDrawRange(),a=this.getCellRelativeRect(t,e);if(t<this.frozenColCount&&e<this.frozenRowCount)return!0;let l,h,d,c;if(this.frozenRowCount>=1&&(l=this.getCellRangeRelativeRect({start:{col:0,row:0},end:{col:this.colCount-1,row:this.frozenRowCount-1}})),this.frozenColCount>=1&&(h=this.getCellRangeRelativeRect({start:{col:0,row:0},end:{col:this.frozenColCount-1,row:this.rowCount-1}})),this.bottomFrozenRowCount>=1&&(d=this.getCellRangeRelativeRect({start:{col:0,row:this.rowCount-this.bottomFrozenRowCount},end:{col:this.colCount-1,row:this.rowCount-1}})),this.rightFrozenColCount>=1&&(c=this.getCellRangeRelativeRect({start:{col:this.colCount-this.rightFrozenColCount,row:0},end:{col:this.colCount-1,row:this.rowCount-1}})),a.top>=s.top&&a.bottom<=s.bottom&&a.left>=s.left&&a.right<=s.right){if(this.isFrozenCell(t,e))return!0;if(a.top>=(null!==(i=null==l?void 0:l.bottom)&&void 0!==i?i:a.top)&&a.left>=(null!==(o=null==h?void 0:h.right)&&void 0!==o?o:a.left)&&a.bottom<=(null!==(n=null==d?void 0:d.top)&&void 0!==n?n:a.bottom)&&a.right<=(null!==(r=null==c?void 0:c.left)&&void 0!==r?r:a.right))return!0}return!1}getCustomMergeValue(t,e){if(this.internalProps.customMergeCell){const i=this.getCustomMerge(t,e);if(i){const{text:t}=i;return t}}}exportImg(){return this.scenegraph.stage.toCanvas().toDataURL()}exportCellImg(t,e,i){var o,n,r,s;const a=this.cellIsInVisualView(t,e),{scrollTop:l,scrollLeft:h}=this;a||this.scrollToCell({col:t,row:e});const d=this.getCellRelativeRect(t,e);(null===(n=null===(o=this.stateManager.select)||void 0===o?void 0:o.ranges)||void 0===n?void 0:n.length)>0&&QM(this.scenegraph);const{col:c,row:u}=this.stateManager.hover.cellPos;let g,p;if(this.stateManager.updateHoverPos(-1,-1),this.scenegraph.component.hideVerticalScrollBar(),this.scenegraph.component.hideHorizontalScrollBar(),this.scenegraph.tableGroup.border.setAttribute("visible",!1),null==i?void 0:i.disableBackground){const i=this.scenegraph.getCell(t,e);g=i.attribute.fill,i.setAttribute("fill","transparent")}if(null==i?void 0:i.disableBorder){const i=this.scenegraph.getCell(t,e);p=i.attribute.stroke,i.setAttribute("stroke",!1)}this.scenegraph.renderSceneGraph();let f=0;"bottom-right"===this.theme.cellBorderClipDirection&&(f=1);const v=this.scenegraph.stage.toCanvas(!1,(new Fe).set(d.left+this.tableX+1,d.top+this.tableY+1,d.right+this.tableX-f,d.bottom+this.tableY-f));return a||(this.setScrollTop(l),this.setScrollLeft(h)),this.scenegraph.tableGroup.border.setAttribute("visible",!0),g&&this.scenegraph.getCell(t,e).setAttribute("fill",g),p&&this.scenegraph.getCell(t,e).setAttribute("stroke",p),(null===(s=null===(r=this.stateManager.select)||void 0===r?void 0:r.ranges)||void 0===s?void 0:s.length)>0&&tL(this.scenegraph),this.stateManager.updateHoverPos(c,u),this.scenegraph.updateNextFrame(),v.toDataURL()}exportCellRangeImg(t){var e,i,o,n;const{scrollTop:r,scrollLeft:s}=this,a=Math.min(t.start.col,t.end.col),l=Math.min(t.start.row,t.end.row),h=Math.max(t.start.col,t.end.col),d=Math.max(t.start.row,t.end.row),c=this.cellIsInVisualView(a,l),u=this.cellIsInVisualView(h,d);c&&u||this.scrollToCell({col:a,row:l});const g=this.getCellRangeRelativeRect({start:{col:a,row:l},end:{col:h,row:d}});(null===(i=null===(e=this.stateManager.select)||void 0===e?void 0:e.ranges)||void 0===i?void 0:i.length)>0&&QM(this.scenegraph);const{col:p,row:f}=this.stateManager.hover.cellPos;this.stateManager.updateHoverPos(-1,-1),this.scenegraph.component.hideVerticalScrollBar(),this.scenegraph.component.hideHorizontalScrollBar(),this.scenegraph.renderSceneGraph();const v=this.scenegraph.stage.toCanvas(!1,(new Fe).set(g.left+this.tableX+1,g.top+this.tableY+1,g.right+this.tableX,g.bottom+this.tableY)).toDataURL();return c&&u||(this.setScrollTop(r),this.setScrollLeft(s)),(null===(n=null===(o=this.stateManager.select)||void 0===o?void 0:o.ranges)||void 0===n?void 0:n.length)>0&&tL(this.scenegraph),this.stateManager.updateHoverPos(p,f),v}exportCanvas(){return this.scenegraph.stage.toCanvas()}getImageBuffer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image/png";if("node"!==this.options.mode)return;this.render();const e=this.scenegraph.stage;if(e){const i=this.tableX+this.getAllColsWidth(),o=this.tableY+this.getAllRowsHeight();return i>=this.canvasWidth&&o>=this.canvasHeight?(e.render(),e.window.getImageBuffer(t)):this.scenegraph.stage.toCanvas(!1,(new Fe).set(0,0,Math.min(this.canvasWidth,i),Math.min(this.canvasHeight,o))).toBuffer(t)}return null}getBodyIndexByTableIndex(t,e){return{col:t-this.rowHeaderLevelCount-this.leftRowSeriesNumberCount,row:e-this.columnHeaderLevelCount}}getTableIndexByBodyIndex(t,e){return{col:t+this.rowHeaderLevelCount+this.leftRowSeriesNumberCount,row:e+this.columnHeaderLevelCount}}onVChartEvent(t,e,i){this._chartEventMap[t]||(this._chartEventMap[t]=[]),"function"==typeof e?this._chartEventMap[t].push({callback:e}):this._chartEventMap[t].push({callback:i,query:e})}offVChartEvent(t,e){this._chartEventMap[t]&&(this._chartEventMap[t]=e?this._chartEventMap[t].filter((t=>t.callback!==e)):[])}_bindChartEvent(t){if(t)for(const e in this._chartEventMap)(this._chartEventMap[e]||[]).forEach((i=>{i.query?t.on(e,i.query,i.callback):t.on(e,i.callback)}))}changeRecordOrder(t,e){}hasCustomCellStyle(t){var e;return null===(e=this.customCellStylePlugin)||void 0===e?void 0:e.hasCustomCellStyle(t)}registerCustomCellStyle(t,e){var i;null===(i=this.customCellStylePlugin)||void 0===i||i.registerCustomCellStyle(t,e)}arrangeCustomCellStyle(t,e,i){var o;null===(o=this.customCellStylePlugin)||void 0===o||o.arrangeCustomCellStyle(t,e,i)}isSeriesNumber(t,e){return this.internalProps.layoutMap.isSeriesNumber(t,e)}isHasSeriesNumber(){var t;return(null===(t=this.internalProps.layoutMap)||void 0===t?void 0:t.leftRowSeriesNumberColumnCount)>0}get leftRowSeriesNumberCount(){var t,e;return null!==(e=null===(t=this.internalProps.layoutMap)||void 0===t?void 0:t.leftRowSeriesNumberColumnCount)&&void 0!==e?e:0}setMinMaxLimitWidth(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e,i;const o=this.internalProps;for(let n=0;n<o.layoutMap.columnWidths.length;n++){if(this.internalProps._widthResizedColMap.has(n))continue;const{width:r,minWidth:s,maxWidth:a}=null!==(i=null===(e=o.layoutMap.columnWidths)||void 0===e?void 0:e[n])&&void 0!==i?i:{};t&&r&&("string"==typeof r&&"auto"!==r||"number"==typeof r&&r>0)&&this._setColWidth(n,r),s&&("number"==typeof s&&s>0||"string"==typeof s)&&this.setMinColWidth(n,s),a&&("number"==typeof a&&a>0||"string"==typeof a)&&this.setMaxColWidth(n,a)}}setSortedIndexMap(t,e){var i;null===(i=this.dataSource)||void 0===i||i.setSortedIndexMap(t,e)}checkReactCustomLayout(){this.reactCustomLayout||(this.reactCustomLayout=new jB(this))}get bodyDomContainer(){return this.internalProps.bodyDomContainer}get headerDomContainer(){return this.internalProps.headerDomContainer}get frozenBodyDomContainer(){return this.internalProps.frozenBodyDomContainer}get frozenHeaderDomContainer(){return this.internalProps.frozenHeaderDomContainer}get rightFrozenBodyDomContainer(){return this.internalProps.rightFrozenBodyDomContainer}get rightFrozenHeaderDomContainer(){return this.internalProps.rightFrozenHeaderDomContainer}get frozenBottomDomContainer(){return this.internalProps.frozenBottomDomContainer}get bottomDomContainer(){return this.internalProps.bottomDomContainer}get rightFrozenBottomDomContainer(){return this.internalProps.rightFrozenBottomDomContainer}showMoverLine(t,e){this.scenegraph.component.showMoveCol(t,e,0),this.scenegraph.renderSceneGraph()}hideMoverLine(t,e){this.scenegraph.component.hideMoveCol(),this.scenegraph.renderSceneGraph()}disableScroll(){this.eventManager.disableScroll()}enableScroll(){this.eventManager.enableScroll()}getGroupTitleLevel(t,e){}scrollToRow(t,e){e?this.animationManager.scrollTo({row:t},e):this.scrollToCell({row:t})}scrollToCol(t,e){e?this.animationManager.scrollTo({col:t},e):this.scrollToCell({col:t})}scrollToCell(t,e){if(e)return void this.animationManager.scrollTo(t,e);const i=this.getDrawRange();if(ot(t.col)&&t.col>=this.frozenColCount){const e=this.getFrozenColsWidth(),o=this.getColsWidth(0,t.col-1);this.scrollLeft=Math.min(o-e,this.getAllColsWidth()-i.width)}if(ot(t.row)&&t.row>=this.frozenRowCount){const e=this.getFrozenRowsHeight(),o=this.getRowsHeight(0,t.row-1);this.scrollTop=Math.min(o-e,this.getAllRowsHeight()-i.height)}this.render()}checkHasColumnAutoWidth(){return function(t){if("autoWidth"===t.options.widthMode)return!0;if("auto"===t.options.defaultHeaderColWidth||Array.isArray(t.options.defaultHeaderColWidth)&&t.options.defaultHeaderColWidth.includes("auto"))return!0;const e=t.internalProps.layoutMap.columnObjects;for(let t=0;t<e.length;t++)if("auto"===e[t].width)return!0;return!1}(this)}}const WE={},NE={};function GE(t,e,i){const o=t[e];return t[e]=i,o}function jE(t){for(const e in t)delete t[e]}var VE=Object.freeze({__proto__:null,aggregator:function(t,e){null!=e&&GE(lw,t,e)},chartModule:function(t,e){return null!=e?GE(WE,t,e):WE[t]},clearAll:function(){jE(zx),jE(oR),jE(WE),jE(NE),jE(lw)},editor:function(t,e){return null!=e?GE(NE,t,e):NE[t]},icon:function(t,e){return null!=e?GE(oR,t,e):oR[t]},theme:function(t,e){return null!=e?GE(zx,t,e):zx[t]}});var UE=(t,e)=>Object.prototype.toString.call(t)===`[object ${e}]`;var $E=function(t){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"boolean"==typeof t:!0===t||!1===t||UE(t,"Boolean")};var XE=t=>"function"==typeof t;var YE=t=>null==t;var KE=t=>null!=t;var qE=t=>"object"==typeof t&&null!==t;var ZE=function(t){if(!qE(t)||!UE(t,"Object"))return!1;if(null===Object.getPrototypeOf(t))return!0;let e=t;for(;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e};var JE=function(t){const e=typeof t;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"string"===e:"string"===e||UE(t,"String")};var QE=t=>Array.isArray?Array.isArray(t):UE(t,"Array");var tH=function(t){return null!==t&&"function"!=typeof t&&Number.isFinite(t.length)};var eH=t=>UE(t,"Date");var iH=function(t){const e=typeof t;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"number"===e:"number"===e||UE(t,"Number")};function oH(t,e,i){let o;if(!KE(t)||"object"!=typeof t||e&&e(t))return t;const n=QE(t),r=t.length;o=n?new Array(r):"object"==typeof t?{}:$E(t)||iH(t)||JE(t)?t:eH(t)?new Date(+t):void 0;const s=n?void 0:Object.keys(Object(t));let a=-1;if(o)for(;++a<(s||t).length;){const n=s?s[a]:a,r=t[n];i&&i.includes(n.toString())?o[n]=r:o[n]=oH(r,e,i)}return o}function nH(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e){if(t===e)return;if(KE(e)&&"object"==typeof e){const n=Object(e),r=[];for(const t in n)r.push(t);let{length:s}=r,a=-1;for(;s--;){const s=r[++a];!KE(n[s])||"object"!=typeof n[s]||o&&QE(t[s])?sH(t,s,n[s]):rH(t,e,s,i,o)}}}}function rH(t,e,i){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const r=t[i],s=e[i];let a=e[i],l=!0;if(QE(s)){if(o)a=[];else if(QE(r))a=r;else if(tH(r)){a=new Array(r.length);let t=-1;const e=r.length;for(;++t<e;)a[t]=r[t]}}else ZE(s)?(a=null!=r?r:{},"function"!=typeof r&&"object"==typeof r||(a={})):l=!1;l&&nH(a,s,o,n),sH(t,i,a)}function sH(t,e,i){(void 0!==i&&!function(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}(t[e],i)||void 0===i&&!(e in t))&&(t[e]=i)}function aH(t,e,i){const o=function(t){if(!t)return[];if(Object.keys)return Object.keys(t);const e=[];for(const i in t)t.hasOwnProperty(i)&&e.push(i);return e}(e);for(let n=0;n<o.length;n++){const r=o[n];(i?null!=e[r]:null==t[r])&&(t[r]=e[r])}return t}function lH(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t="prototype"in t?t.prototype:t,e="prototype"in e?e.prototype:e,Object.getOwnPropertyNames){const o=Object.getOwnPropertyNames(e);for(let n=0;n<o.length;n++){const r=o[n];"constructor"!==r&&(i?null!=e[r]:null==t[r])&&(t[r]=e[r])}}else aH(t,e,i)}function hH(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function dH(t){return Number(t)}const cH="undefined"!=typeof console;function uH(t,e,i){const o=[e].concat([].slice.call(i));cH&&console[t].apply(console,o)}var gH;!function(t){t[t.None=0]="None",t[t.Error=1]="Error",t[t.Warn=2]="Warn",t[t.Info=3]="Info",t[t.Debug=4]="Debug"}(gH||(gH={}));class pH{static getInstance(t,e){return pH._instance&&iH(t)?pH._instance.level(t):pH._instance||(pH._instance=new pH(t,e)),pH._instance}static setInstance(t){return pH._instance=t}static setInstanceLevel(t){pH._instance?pH._instance.level(t):pH._instance=new pH(t)}static clearInstance(){pH._instance=null}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:gH.None,e=arguments.length>1?arguments[1]:void 0;this._onErrorHandler=[],this._level=t,this._method=e}addErrorHandler(t){this._onErrorHandler.find((e=>e===t))||this._onErrorHandler.push(t)}removeErrorHandler(t){const e=this._onErrorHandler.findIndex((e=>e===t));e<0||this._onErrorHandler.splice(e,1)}callErrorHandler(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this._onErrorHandler.forEach((t=>t(...e)))}canLogInfo(){return this._level>=gH.Info}canLogDebug(){return this._level>=gH.Debug}canLogError(){return this._level>=gH.Error}canLogWarn(){return this._level>=gH.Warn}level(t){return arguments.length?(this._level=+t,this):this._level}error(){for(var t,e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return this._level>=gH.Error&&(this._onErrorHandler.length?this.callErrorHandler(...i):uH(null!==(t=this._method)&&void 0!==t?t:"error","ERROR",i)),this}warn(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this._level>=gH.Warn&&uH(this._method||"warn","WARN",e),this}info(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this._level>=gH.Info&&uH(this._method||"log","INFO",e),this}debug(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this._level>=gH.Debug&&uH(this._method||"log","DEBUG",e),this}}pH._instance=null;const fH=1e-10,vH=1e-10;function bH(t,e){const i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:fH,o=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:vH)*Math.max(t,e);return Math.abs(t-e)<=Math.max(i,o)}function mH(t,e,i,o){return t>e&&!bH(t,e,i,o)}function yH(t,e,i,o){return t<e&&!bH(t,e,i,o)}const CH=t=>{let e=null,i=null;return function(){for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];return e&&n.every(((t,i)=>t===e[i]))||(e=n,i=t(...n)),i}};var wH=function(t,e,i){return t<e?e:t>i?i:t};function xH(t,e){let i;return t>e&&(i=t,t=e,e=i),i=>Math.max(t,Math.min(e,i))}function _H(t,e){return i=>t*(1-i)+e*i}function SH(t,e){return function(i){return Math.round(t*(1-i)+e*i)}}function AH(t,e,i){e/=100,i/=100;const o=(1-Math.abs(2*i-1))*e,n=o*(1-Math.abs(t/60%2-1)),r=i-o/2;let s=0,a=0,l=0;return 0<=t&&t<60?(s=o,a=n,l=0):60<=t&&t<120?(s=n,a=o,l=0):120<=t&&t<180?(s=0,a=o,l=n):180<=t&&t<240?(s=0,a=n,l=o):240<=t&&t<300?(s=n,a=0,l=o):300<=t&&t<360&&(s=o,a=0,l=n),s=Math.round(255*(s+r)),a=Math.round(255*(a+r)),l=Math.round(255*(l+r)),{r:s,g:a,b:l}}function BH(t,e,i){t/=255,e/=255,i/=255;const o=Math.min(t,e,i),n=Math.max(t,e,i),r=n-o;let s=0,a=0,l=0;return s=0===r?0:n===t?(e-i)/r%6:n===e?(i-t)/r+2:(t-e)/r+4,s=Math.round(60*s),s<0&&(s+=360),l=(n+o)/2,a=0===r?0:r/(1-Math.abs(2*l-1)),a=+(100*a).toFixed(1),l=+(100*l).toFixed(1),{h:s,s:a,l:l}}const RH=/^#([0-9a-f]{3,8})$/,TH={transparent:4294967040},kH={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function MH(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function LH(t){return iH(t)?new OH(t>>16,t>>8&255,255&t,1):QE(t)?new OH(t[0],t[1],t[2]):new OH(255,255,255)}function PH(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function EH(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}const HH=(t,e)=>{const i=RH.exec(t);if(e||i){const t=parseInt(i[1],16),e=i[1].length;return 3===e?new OH((t>>8&15)+((t>>8&15)<<4),(t>>4&15)+((t>>4&15)<<4),(15&t)+((15&t)<<4),1):6===e?LH(t):8===e?new OH(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):null}};class FH{static Brighter(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return 1===e?t:new FH(t).brighter(e).toRGBA()}static SetOpacity(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return 1===e?t:new FH(t).setOpacity(e).toRGBA()}static getColorBrightness(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"hsl";const i=t instanceof FH?t:new FH(t);switch(e){case"hsv":default:return i.getHSVBrightness();case"hsl":return i.getHSLBrightness();case"lum":return i.getLuminance();case"lum2":return i.getLuminance2();case"lum3":return i.getLuminance3()}}static parseColorString(t){if(KE(TH[t]))return function(t){return iH(t)?new OH(t>>>24,t>>>16&255,t>>>8&255,255&t):QE(t)?new OH(t[0],t[1],t[2],t[3]):new OH(255,255,255,1)}(TH[t]);if(KE(kH[t]))return LH(kH[t]);const e=`${t}`.trim().toLowerCase(),i=HH(e);if(void 0!==i)return i;if(/^(rgb|RGB|rgba|RGBA)/.test(e)){const t=e.replace(/(?:\(|\)|rgba|RGBA|rgb|RGB)*/g,"").split(",");return new OH(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10),parseFloat(t[3]))}if(/^(hsl|HSL|hsla|HSLA)/.test(e)){const t=e.replace(/(?:\(|\)|hsla|HSLA|hsl|HSL)*/g,"").split(","),i=AH(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10));return new OH(i.r,i.g,i.b,parseFloat(t[3]))}}constructor(t){const e=FH.parseColorString(t);this.color=e||new OH(255,255,255)}toRGBA(){return this.color.formatRgb()}toString(){return this.color.formatRgb()}toHex(){return this.color.formatHex()}toHsl(){return this.color.formatHsl()}brighter(t){const{r:e,g:i,b:o}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t))),this.color.b=Math.max(0,Math.min(255,Math.floor(o*t))),this}add(t){const{r:e,g:i,b:o}=this.color;return this.color.r+=Math.min(255,e+t.color.r),this.color.g+=Math.min(255,i+t.color.g),this.color.b+=Math.min(255,o+t.color.b),this}sub(t){return this.color.r=Math.max(0,this.color.r-t.color.r),this.color.g=Math.max(0,this.color.g-t.color.g),this.color.b=Math.max(0,this.color.b-t.color.b),this}multiply(t){const{r:e,g:i,b:o}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t.color.r))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t.color.g))),this.color.b=Math.max(0,Math.min(255,Math.floor(o*t.color.b))),this}getHSVBrightness(){return Math.max(this.color.r,this.color.g,this.color.b)/255}getHSLBrightness(){return.5*(Math.max(this.color.r,this.color.g,this.color.b)/255+Math.min(this.color.r,this.color.g,this.color.b)/255)}setHsl(t,e,i){const o=this.color.opacity,n=BH(this.color.r,this.color.g,this.color.b),r=AH(YE(t)?n.h:wH(t,0,360),YE(e)?n.s:e>=0&&e<=1?100*e:e,YE(i)?n.l:i<=1&&i>=0?100*i:i);return this.color=new OH(r.r,r.g,r.b,o),this}setRGB(t,e,i){return!YE(t)&&(this.color.r=t),!YE(e)&&(this.color.g=e),!YE(i)&&(this.color.b=i),this}setHex(t){const e=`${t}`.trim().toLowerCase(),i=HH(e,!0);return null!=i?i:this}setColorName(t){const e=kH[t.toLowerCase()];return void 0!==e&&this.setHex(e),this}setScalar(t){return this.color.r=t,this.color.g=t,this.color.b=t,this}setOpacity(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.color.opacity=t,this}getLuminance(){return(.2126*this.color.r+.7152*this.color.g+.0722*this.color.b)/255}getLuminance2(){return(.2627*this.color.r+.678*this.color.g+.0593*this.color.b)/255}getLuminance3(){return(.299*this.color.r+.587*this.color.g+.114*this.color.b)/255}clone(){return new FH(this.color.toString())}copyGammaToLinear(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return this.color.r=Math.pow(t.color.r,e),this.color.g=Math.pow(t.color.g,e),this.color.b=Math.pow(t.color.b,e),this}copyLinearToGamma(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const i=e>0?1/e:1;return this.color.r=Math.pow(t.color.r,i),this.color.g=Math.pow(t.color.g,i),this.color.b=Math.pow(t.color.b,i),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.color.r=PH(t.color.r),this.color.g=PH(t.color.g),this.color.b=PH(t.color.b),this}copyLinearToSRGB(t){return this.color.r=EH(t.color.r),this.color.g=EH(t.color.g),this.color.b=EH(t.color.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}}class OH{constructor(t,e,i,o){this.r=isNaN(+t)?255:Math.max(0,Math.min(255,+t)),this.g=isNaN(+e)?255:Math.max(0,Math.min(255,+e)),this.b=isNaN(+i)?255:Math.max(0,Math.min(255,+i)),KE(o)?this.opacity=isNaN(+o)?1:Math.max(0,Math.min(1,+o)):this.opacity=1}formatHex(){return`#${MH(this.r)+MH(this.g)+MH(this.b)+(1===this.opacity?"":MH(255*this.opacity))}`}formatRgb(){const t=this.opacity;return`${1===t?"rgb(":"rgba("}${this.r},${this.g},${this.b}${1===t?")":`,${t})`}`}formatHsl(){const t=this.opacity,{h:e,s:i,l:o}=BH(this.r,this.g,this.b);return`${1===t?"hsl(":"hsla("}${e},${i}%,${o}%${1===t?")":`,${t})`}`}toString(){return this.formatHex()}}var IH=Object.freeze({__proto__:null,Color:FH,DEFAULT_COLORS:kH,RGB:OH,hexToRgb:function(t){let e="",i="",o="";const n="#"===t[0]?1:0;for(let r=n;r<t.length;r++)"#"!==t[r]&&(r<n+2?e+=t[r]:r<n+4?i+=t[r]:r<n+6&&(o+=t[r]));return[parseInt(e,16),parseInt(i,16),parseInt(o,16)]},hslToRgb:AH,interpolateRgb:function(t,e){const i=t.r,o=e.r,n=t.g,r=e.g,s=t.b,a=e.b,l=t.opacity,h=e.opacity;return t=>{const e=Math.round(i*(1-t)+o*t),d=Math.round(n*(1-t)+r*t),c=Math.round(s*(1-t)+a*t);return new OH(e,d,c,l*(1-t)+h*t)}},rgbToHex:function(t,e,i){return Number((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1)},rgbToHsl:BH});const zH=(t,e)=>{var i,o;if(!(null==e?void 0:e.fields))return t;if(0===t.length)return t;const n=e.fields,r=t[0],s={},a=[];for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e)){const l=n[e];if(!l.type){let o=r;e in r||(o=null!==(i=t.find((t=>e in t)))&&void 0!==i?i:r),l.type="number"==typeof o[e]?"linear":"ordinal"}let h;if("number"==typeof l.sortIndex&&(h={key:e,type:l.type,index:l.sortIndex,sortIndex:{},sortIndexCount:0,sortReverse:!0===l.sortReverse},a.push(h)),(null===(o=l.domain)||void 0===o?void 0:o.length)>0)if("ordinal"===l.type){l._domainCache={},s[e]=l;const t={};l.domain.forEach(((e,i)=>{t[e]=i,l._domainCache[e]=i})),h&&(h.sortIndex=t,h.sortIndexCount=l.domain.length)}else l.domain.length>=2&&(s[e]=l)}return Object.keys(s).length>0&&(t=t.filter((t=>{for(const e in s){const i=s[e];if("ordinal"===i.type){if(!(t[e]in i._domainCache))return!1}else if(i.domain[0]>t[e]||i.domain[1]<t[e])return!1}return!0}))),a.sort(((t,e)=>t.index-e.index)),t.sort(((t,e)=>function(t,e,i){for(let o=0;o<i.length;o++){const n=i[o];let r=0;if("ordinal"===n.type?(void 0===n.sortIndex[e[n.key]]&&(n.sortIndex[e[n.key]]=n.sortIndexCount++),void 0===n.sortIndex[t[n.key]]&&(n.sortIndex[t[n.key]]=n.sortIndexCount++),r=n.sortIndex[t[n.key]]-n.sortIndex[e[n.key]]):"linear"===n.type&&(r=t[n.key]-e[n.key]),n.sortReverse&&(r=-r),0!==r)return r}return 0}(t,e,a))),t};let DH=0;function WH(){return DH>1e8&&(DH=0),(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"dataset")+"_"+DH++}class NH{constructor(t){var e;let i;this.options=t,this.isDataSet=!0,this.transformMap={},this.parserMap={},this.dataViewMap={},this.target=new J,i=(null==t?void 0:t.name)?t.name:WH("dataset"),this.name=i,this._logger=null!==(e=null==t?void 0:t.logger)&&void 0!==e?e:pH.getInstance()}setLogger(t){this._logger=t}getDataView(t){return this.dataViewMap[t]}setDataView(t,e){var i;this.dataViewMap[t]&&(null===(i=this._logger)||void 0===i||i.error(`Error: dataView ${t} 之前已存在，请重新命名`)),this.dataViewMap[t]=e}removeDataView(t){this.dataViewMap[t]=null,delete this.dataViewMap[t]}registerParser(t,e){var i;this.parserMap[t]&&(null===(i=this._logger)||void 0===i||i.warn(`Warn: transform ${t} 之前已注册，执行覆盖逻辑`)),this.parserMap[t]=e}removeParser(t){this.parserMap[t]=null,delete this.parserMap[t]}getParser(t){return this.parserMap[t]||this.parserMap.default}registerTransform(t,e){var i;this.transformMap[t]&&(null===(i=this._logger)||void 0===i||i.warn(`Warn: transform ${t} 之前已注册，执行覆盖逻辑`)),this.transformMap[t]=e}removeTransform(t){this.transformMap[t]=null,delete this.transformMap[t]}getTransform(t){return this.transformMap[t]}multipleDataViewAddListener(t,e,i){this._callMap||(this._callMap=new Map);let o=this._callMap.get(i);o||(o=()=>{t.some((t=>t.isRunning))||i()}),t.forEach((t=>{t.target.addListener(e,o)})),this._callMap.set(i,o)}allDataViewAddListener(t,e){this.multipleDataViewAddListener(Object.values(this.dataViewMap),t,e)}multipleDataViewRemoveListener(t,e,i){if(this._callMap){const o=this._callMap.get(i);o&&t.forEach((t=>{t.target.removeListener(e,o)})),this._callMap.delete(i)}}multipleDataViewUpdateInParse(t){t.forEach((t=>{var e;return null===(e=this.getDataView(t.name))||void 0===e?void 0:e.markRunning()})),t.forEach((t=>{var e;return null===(e=this.getDataView(t.name))||void 0===e?void 0:e.parseNewData(t.data,t.options)}))}multipleDataViewUpdateInRawData(t){t.forEach((t=>{var e;return null===(e=this.getDataView(t.name))||void 0===e?void 0:e.markRunning()})),t.forEach((t=>{var e;return null===(e=this.getDataView(t.name))||void 0===e?void 0:e.updateRawData(t.data,t.options)}))}destroy(){this.transformMap=null,this.parserMap=null,this.dataViewMap=null,this._callMap=null,this.target.removeAllListeners()}}const GH="_data-view-diff-rank";class jH{constructor(t,e){var i=this;let o;this.dataSet=t,this.options=e,this.isDataView=!0,this.target=new J,this.parseOption=null,this.transformsArr=[],this.isRunning=!1,this.rawData={},this.history=!1,this.parserData={},this.latestData={},this._fields=null,this.reRunAllTransform=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{pushHistory:!0,emitMessage:!0};return i.isRunning=!0,i.resetTransformData(),i.transformsArr.forEach((e=>{i.executeTransform(e,{pushHistory:t.pushHistory,emitMessage:!1}),i.isLastTransform(e)&&i.diffLastData()})),i.isRunning=!1,!1!==t.emitMessage&&i.target.emit("change",[]),i},this.markRunning=()=>{this.isRunning=!0,this.target.emit("markRunning",[])},o=(null==e?void 0:e.name)?e.name:WH("dataview"),this.name=o,(null==e?void 0:e.history)&&(this.history=e.history,this.historyData=[]),this.dataSet.setDataView(o,this),this.setFields(null==e?void 0:e.fields)}parse(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var o;this.isRunning=!0,i&&this.target.emit("beforeParse",[]),e&&(this.parseOption=e);const n=this.cloneParseData(t,e);if(null==e?void 0:e.type){const t=(null!==(o=this.dataSet.getParser(e.type))&&void 0!==o?o:this.dataSet.getParser("bytejson"))(n,e.options,this);this.rawData=n,this.parserData=t,this.history&&this.historyData.push(n,t),this.latestData=t}else this.parserData=n,this.rawData=n,this.history&&this.historyData.push(n),this.latestData=n;return this.isRunning=!1,i&&this.target.emit("afterParse",[]),this}transform(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.isRunning=!0,t&&t.type){let i=!0;if("fields"===t.type){this._fields=t.options.fields;const e=this.transformsArr.findIndex((e=>e.type===t.type));e>=0&&(i=!1,this.transformsArr[e].options.fields=this._fields)}if(i&&this.transformsArr.push(t),e){const e=this.isLastTransform(t);this.executeTransform(t),e&&this.diffLastData()}}return this.sortTransform(),this.isRunning=!1,this}isLastTransform(t){return this.transformsArr[this.transformsArr.length-1]===t}sortTransform(){this.transformsArr.length>=2&&this.transformsArr.sort(((t,e)=>{var i,o;return(null!==(i=t.level)&&void 0!==i?i:0)-(null!==(o=e.level)&&void 0!==o?o:0)}))}executeTransform(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{pushHistory:!0,emitMessage:!0};const{pushHistory:i,emitMessage:o}=e,n=this.dataSet.getTransform(t.type)(this.latestData,t.options);this.history&&!1!==i&&this.historyData.push(n),this.latestData=n,!1!==o&&this.target.emit("change",[])}resetTransformData(){this.latestData=this.parserData,this.history&&(this.historyData.length=0,this.historyData.push(this.rawData,this.parserData))}enableDiff(t){this._diffData=!0,this._diffKeys=t,this._diffMap=new Map,this._diffRank=0}disableDiff(){this._diffData=!1,this._diffMap=null,this._diffRank=null}resetDiff(){this._diffMap=new Map,this._diffRank=0}diffLastData(){var t;if(!this._diffData)return;if(!this.latestData.forEach)return;if(!(null===(t=this._diffKeys)||void 0===t?void 0:t.length))return;const e=this._diffRank+1;if(0===this._diffRank)this.latestData.forEach((t=>{t[GH]=e,this._diffMap.set(this._diffKeys.reduce(((e,i)=>e+t[i]),""),t)})),this.latestDataAUD={add:Array.from(this.latestData),del:[],update:[]};else{let t;this.latestDataAUD={add:[],del:[],update:[]},this.latestData.forEach((i=>{i[GH]=e,t=this._diffKeys.reduce(((t,e)=>t+i[e]),""),this._diffMap.get(t)?this.latestDataAUD.update.push(i):this.latestDataAUD.add.push(i),this._diffMap.set(t,i)})),this._diffMap.forEach(((t,i)=>{t[GH]<e&&(this.latestDataAUD.del.push(t),this._diffMap.delete(i))}))}this._diffRank=e}cloneParseData(t,e){let i=!1;return t instanceof jH||!0!==(null==e?void 0:e.clone)||(i=!0),i?oH(t):t}parseNewData(t,e){this.parse(t,e||this.parseOption),this.reRunAllTransform()}updateRawData(t,e){const i=this.cloneParseData(t,e);this.rawData=i,this.parserData=i,this.latestData=i,this.reRunAllTransform()}getFields(){var t;return this._fields?this._fields:"dataview"===(null===(t=this.parseOption)||void 0===t?void 0:t.type)&&1===this.rawData.length&&this.rawData[0].getFields?this.rawData[0].getFields():null}setFields(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._fields=t&&e?function(t){let e=-1;const i=arguments.length<=1?0:arguments.length-1;for(;++e<i;)nH(t,e+1<1||arguments.length<=e+1?void 0:arguments[e+1],!0);return t}({},this._fields,t):t;const i=this.transformsArr.find((t=>"fields"===t.type));!YE(this._fields)&&YE(i)?(this.dataSet.registerTransform("fields",zH),this.transform({type:"fields",options:{fields:this._fields}},!1)):i&&(i.options.fields=this._fields)}destroy(){this.dataSet.removeDataView(this.name),this._diffMap=null,this._diffRank=null,this.latestData=null,this.rawData=null,this.parserData=null,this.transformsArr=null,this.target=null}}function VH(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["data"];const i=t;let o;if(!KE(i)||"object"!=typeof i)return i;if(function(t){return t instanceof jH}(i)||function(t){try{return t instanceof Element}catch(e){const i=["children","innerHTML","classList","setAttribute","tagName","getBoundingClientRect"],o=Object.keys(t);return i.every((t=>o.includes(t)))}}(i))return i;const n=QE(i),r=i.length;o=n?new Array(r):"object"==typeof i?{}:$E(i)||iH(i)||JE(i)?i:eH(i)?new Date(+i):void 0;const s=n?void 0:Object.keys(Object(i));let a=-1;if(o)for(;++a<(s||i).length;){const t=s?s[a]:a,n=i[t];(null==e?void 0:e.includes(t.toString()))?o[t]=n:o[t]=VH(n,e)}return o}function UH(t){var e,i;const o=Object.assign({},t);return Ct(t.style)||(o.textStyle=$H(t.style)),Ct(t.textStyle)||Tt(o.textStyle,$H(t.textStyle)),(null===(e=t.shape)||void 0===e?void 0:e.style)&&$H(o.shape.style),(null===(i=t.background)||void 0===i?void 0:i.style)&&$H(o.background.style),o}function $H(t){return Ct(t)||t.angle&&(t.angle=be(t.angle)),t}function XH(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Ct(t.style)||(t.style=$H(t.style)),Ct(t.state)||Object.keys(t.state).forEach((e=>{Ct(t.state[e])||(t.state[e]=$H(t.state[e]))})),t}function YH(t){return Ct(t)?null:(Object.keys(t).forEach((e=>{Ct(t[e])||(t[e]=$H(t[e]))})),t)}const KH={left:{textAlign:"center",textBaseline:"bottom"},right:{textAlign:"center",textBaseline:"bottom"},radius:{},angle:{}},qH="PingFang SC,Microsoft Yahei,system-ui,-apple-system,segoe ui,Roboto,Helvetica,Arial,sans-serif, apple color emoji,segoe ui emoji,segoe ui symbol",ZH=14,JH=14,QH=4,tF={domainLine:{visible:!0,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},grid:{visible:!0,style:{lineWidth:1,stroke:"#EBEDF2",strokeOpacity:1,lineDash:[]}},subGrid:{visible:!1,style:{lineWidth:1,stroke:"#EBEDF2",strokeOpacity:1,lineDash:[4,4]}},tick:{visible:!0,tickSize:QH,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},subTick:{visible:!1,tickSize:QH/2,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},label:{visible:!0,space:1,style:{fontSize:JH,fill:"#89909D",fontWeight:"normal",fillOpacity:1},autoLimit:!0},title:{space:10,style:{fontSize:JH,fill:"#333333",fontWeight:"normal",fillOpacity:1}}};function eF(t){var e,i,o,n,r,s,a,l,h,d,c,u,g;const p=Tt({},t);let f,v=null!==(i=null===(e=p.title)||void 0===e?void 0:e.angle)&&void 0!==i?i:0;"left"!==p.orient&&"right"!==p.orient||(null===(o=p.title)||void 0===o?void 0:o.autoRotate)&&it(p.title.angle)&&(v="left"===p.orient?-90:90,f=KH[p.orient]);const b=function(t,e){if(!t||!st(t))return t;const i={};return Object.keys(t).forEach((o=>{const n=t[o];let r=!1;e.forEach((t=>{(lt(t)&&t===o||t instanceof RegExp&&o.match(t))&&(r=!0)})),r||(i[o]=n)})),i}(p.label,["style","formatMethod","state"]);return{orient:p.orient,select:p.select,hover:p.hover,line:(m=p.domainLine,XH(m),XH(m.startSymbol),XH(m.endSymbol),m),label:Object.assign({style:$H(p.label.style),formatMethod:p.label.formatMethod?(t,e,i)=>p.label.formatMethod(e.rawValue,e):null,state:YH(p.label.state)},b),tick:{visible:p.tick.visible,length:p.tick.tickSize,inside:p.tick.inside,alignWithLabel:p.tick.alignWithLabel,style:$H(p.tick.style),state:YH(p.tick.state),dataFilter:p.tick.dataFilter},subTick:{visible:p.subTick.visible,length:p.subTick.tickSize,inside:p.subTick.inside,count:p.subTick.tickCount,style:$H(p.subTick.style),state:YH(p.subTick.state)},grid:{type:"line",visible:p.grid.visible,alternateColor:p.grid.alternateColor,alignWithLabel:p.grid.alignWithLabel,style:$H(p.grid.style)},subGrid:{type:"line",visible:p.subGrid.visible,alternateColor:p.subGrid.alternateColor,style:$H(p.subGrid.style)},title:{visible:p.title.visible,position:p.title.position,space:p.title.space,autoRotate:!1,angle:v?be(v):null,textStyle:Tt({},f,$H(p.title.style)),padding:p.title.padding,shape:{visible:null===(n=p.title.shape)||void 0===n?void 0:n.visible,space:null===(r=p.title.shape)||void 0===r?void 0:r.space,style:$H(null===(s=p.title.shape)||void 0===s?void 0:s.style)},background:{visible:null===(a=p.title.background)||void 0===a?void 0:a.visible,style:$H(null===(l=p.title.background)||void 0===l?void 0:l.style)},state:{text:YH(p.title.state),shape:YH(null===(h=p.title.shape)||void 0===h?void 0:h.state),background:YH(null===(d=p.title.background)||void 0===d?void 0:d.state)}},panel:{visible:null===(c=p.background)||void 0===c?void 0:c.visible,style:$H(null===(u=p.background)||void 0===u?void 0:u.style),state:YH(null===(g=p.background)||void 0===g?void 0:g.state)}};var m}class iF{constructor(t,e,i,o){var n,r;this.seqId=0,this.leftRowSeriesNumberColumnCount=0,this.rightRowSeriesNumberColumnCount=0,this.bodyRowSpanCount=1,this._transpose=!1,this._showHeader=!0,this._recordsCount=0,this._hasAggregation=!1,this._hasAggregationOnTopCount=0,this._hasAggregationOnBottomCount=0,this._cellRangeMap=new Map,this._showHeader=i,this._table=t,this._columns=[],this._columnsIncludeHided=[],this._headerCellIds=[],this.hierarchyIndent=null!=o?o:20,this.hierarchyTextStartAlignment=t.options.hierarchyTextStartAlignment,this.columnHierarchyType=t.options.headerHierarchyType,this.columnExpandLevel=null!==(n=t.options.headerExpandLevel)&&void 0!==n?n:1,this.columnTree=new sE(e,{seqId:0},null!==(r=this.columnHierarchyType)&&void 0!==r?r:null,"grid-tree"===this.columnHierarchyType?this.columnExpandLevel:void 0),this._headerObjectsIncludeHided=this._addHeaders(0,e,[]),this._headerObjects=this._headerObjectsIncludeHided.filter((t=>!0!==t.define.hide)),this._headerObjectMap=this._headerObjects.reduce(((t,e)=>(t[e.id]=e,t)),{}),this.rowHierarchyType=function(t){if(t._table.options.groupBy)return!0;const{columns:e}=t._table.options;if(ht(e)&&e.length>0)for(let t=0;t<e.length;t++){const i=e[t];if(!lt(i)&&i.tree)return!0}return!1}(this)?"tree":"grid",this._hasAggregation=function(t){const e=t.columnObjects;for(let t=0;t<e.length;t++){const i=e[t];if(null==i?void 0:i.aggregation)return!0}return!1}(this),this._hasAggregationOnBottomCount=function(t){const e=t.columnObjects;let i=0;for(let t=0;t<e.length;t++){const o=e[t];(null==o?void 0:o.aggregation)&&(Array.isArray(null==o?void 0:o.aggregation)?i=Math.max(i,o.aggregation.filter((t=>!t.showOnTop)).length):o.aggregation.showOnTop||(i=Math.max(i,1)))}return i}(this),this._hasAggregationOnTopCount=function(t){const e=t.columnObjects;let i=0;for(let t=0;t<e.length;t++){const o=e[t];(null==o?void 0:o.aggregation)&&(Array.isArray(null==o?void 0:o.aggregation)?i=Math.max(i,o.aggregation.filter((t=>t.showOnTop)).length):o.aggregation.showOnTop&&(i=Math.max(i,1)))}return i}(this),this.handleRowSeriesNumber(t.internalProps.rowSeriesNumber)}handleRowSeriesNumber(t){var e;t&&(Array.isArray(t)?this.rowSeriesNumberColumn=t.map(((t,e)=>{var i,o;return{id:this.seqId++,title:t.title,define:Tt({field:"_vtable_rowSeries_number_"+e},t),cellType:null!==(i=t.cellType)&&void 0!==i?i:"text",headerType:"checkbox"===t.cellType?"checkbox":"text",style:t.style,width:t.width,format:t.format,field:null!==(o=t.field)&&void 0!==o?o:"_vtable_rowSeries_number_"+e,icon:t.icon,headerIcon:t.headerIcon,isChildNode:!1}})):this.rowSeriesNumberColumn=[{id:this.seqId++,title:t.title,define:Tt({field:"_vtable_rowSeries_number"},t),cellType:null!==(e=t.cellType)&&void 0!==e?e:"text",headerType:"checkbox"===t.cellType?"checkbox":"text",style:t.style,width:t.width,format:t.format,field:"_vtable_rowSeries_number",icon:t.icon,headerIcon:t.headerIcon,isChildNode:!1}],this.leftRowSeriesNumberColumn=this.rowSeriesNumberColumn.filter((t=>!0)),this.rightRowSeriesNumberColumn=this.rowSeriesNumberColumn.filter((t=>!1)),this.leftRowSeriesNumberColumnCount=this.leftRowSeriesNumberColumn.length,this.rightRowSeriesNumberColumnCount=this.rightRowSeriesNumberColumn.length)}get transpose(){return this._transpose}set transpose(t){this._transpose=t}get showHeader(){return this._showHeader}set showHeader(t){this._showHeader=t}isSeriesNumberInHeader(t,e){if(this.leftRowSeriesNumberColumnCount>0&&t>=0&&e>=0&&t<this.leftRowSeriesNumberColumnCount){if(this.transpose)return!1;if(e<this.headerLevelCount)return!0}if(this.rightRowSeriesNumberColumnCount>0&&e>=0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount){if(this.transpose)return!1;if(e<this.headerLevelCount)return!0}return!1}isSeriesNumberInBody(t,e){if(this.leftRowSeriesNumberColumnCount>0&&t>=0&&t<this.leftRowSeriesNumberColumnCount){if(this.transpose)return!0;if(e>=this.headerLevelCount)return!0}if(this.rightRowSeriesNumberColumnCount>0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount){if(this.transpose)return!0;if(e>=this.headerLevelCount)return!0}return!1}isSeriesNumber(t,e){if(ot(t)&&ot(e)){if(this.leftRowSeriesNumberColumnCount>0&&t>=0&&e>=0&&t<this.leftRowSeriesNumberColumnCount)return!0;if(this.rightRowSeriesNumberColumnCount>0&&e>=0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount)return!0}return!1}getSeriesNumberHeader(t,e){if(this.leftRowSeriesNumberColumnCount>0&&t>=0&&t<this.leftRowSeriesNumberColumnCount){if(this.transpose)return;if(e<this.headerLevelCount)return Object.assign({},this.leftRowSeriesNumberColumn[t],{style:Object.assign({},this._table.transpose?this._table.internalProps.theme.rowHeaderStyle:this._table.internalProps.theme.headerStyle,this._table.internalProps.rowSeriesNumber.headerStyle)})}if(this.rightRowSeriesNumberColumnCount>0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount&&e<this.headerLevelCount){if(this.transpose)return;if(e<this.headerLevelCount)return this.rightRowSeriesNumberColumn[t-(this.colCount-this.rightRowSeriesNumberColumnCount)]}}getSeriesNumberBody(t,e){if(this.leftRowSeriesNumberColumnCount>0&&t>=0&&t<this.leftRowSeriesNumberColumnCount){if(this.transpose)return this.leftRowSeriesNumberColumn[t];if(e>=this.headerLevelCount)return this.leftRowSeriesNumberColumn[t]}if(this.rightRowSeriesNumberColumnCount>0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount){if(this.transpose)return this.rightRowSeriesNumberColumn[t-(this.colCount-this.rightRowSeriesNumberColumnCount)];if(e>=this.headerLevelCount)return this.rightRowSeriesNumberColumn[t-(this.colCount-this.rightRowSeriesNumberColumnCount)]}}isHeader(t,e){return!!(this.transpose&&t>=this.leftRowSeriesNumberColumnCount&&t<this.headerLevelCount+this.leftRowSeriesNumberColumnCount)||!this.transpose&&e>=0&&e<this.headerLevelCount}isAggregation(t,e){if(this.hasAggregation){if(this.hasAggregationOnBottomCount)if(this.transpose){if(t>=this.colCount-this.hasAggregationOnBottomCount)return!0}else if(e>=this.rowCount-this.hasAggregationOnBottomCount)return!0;if(this.hasAggregationOnTopCount)if(this.transpose){if(t>=this.rowHeaderLevelCount&&t<this.rowHeaderLevelCount+this.hasAggregationOnTopCount)return!0}else if(e>=this.columnHeaderLevelCount&&e<this.columnHeaderLevelCount+this.hasAggregationOnTopCount)return!0}return!1}isTopAggregation(t,e){if(this.hasAggregationOnTopCount)if(this.transpose){if(t>=this.rowHeaderLevelCount&&t<this.rowHeaderLevelCount+this.hasAggregationOnTopCount)return!0}else if(e>=this.columnHeaderLevelCount&&e<this.columnHeaderLevelCount+this.hasAggregationOnTopCount)return!0;return!1}isBottomAggregation(t,e){if(this.hasAggregationOnBottomCount)if(this.transpose){if(t>=this.colCount-this.hasAggregationOnBottomCount)return!0}else if(e>=this.rowCount-this.hasAggregationOnBottomCount)return!0;return!1}get hasAggregation(){return this._hasAggregation}get hasAggregationOnTopCount(){return this._hasAggregationOnTopCount}get hasAggregationOnBottomCount(){return this._hasAggregationOnBottomCount}getAggregatorsByCell(t,e){return this.getColumnDefine(t,e).vtable_aggregator}getAggregatorsByCellRange(t,e,i,o){let n=[];if(!this.transpose){for(let o=t;o<=i;o++){const t=this.getColumnDefine(o,e);t.vtable_aggregator&&(n=n.concat(Array.isArray(t.vtable_aggregator)?t.vtable_aggregator:[t.vtable_aggregator]))}return n}for(let i=e;i<=o;i++){const e=this.getColumnDefine(t,i);e.vtable_aggregator&&(n=n.concat(Array.isArray(e.vtable_aggregator)?e.vtable_aggregator:[e.vtable_aggregator]))}return[]}getAggregatorOnTop(t,e){const i=this.getColumnDefine(t,e),o=i.vtable_aggregator,n=i.aggregation;if(Array.isArray(n)){const i=n.reduce(((t,e,i)=>(e.showOnTop&&t.push(i),t)),[]).map((t=>o[t]));return this.transpose?i[t-this.rowHeaderLevelCount]:i[e-this.columnHeaderLevelCount]}return this.transpose&&t-this.rowHeaderLevelCount==0?(null==n?void 0:n.showOnTop)?o:null:this.transpose||e-this.columnHeaderLevelCount!=0?null:(null==n?void 0:n.showOnTop)?o:null}getAggregatorOnBottom(t,e){const i=this.getColumnDefine(t,e),o=i.vtable_aggregator,n=i.aggregation;if(Array.isArray(n)){const i=n.reduce(((t,e,i)=>(e.showOnTop||t.push(i),t)),[]).map((t=>o[t]));return this.transpose?i[t-(this.colCount-this.hasAggregationOnBottomCount)]:i[e-(this.rowCount-this.hasAggregationOnBottomCount)]}return this.transpose&&t-(this.colCount-this.hasAggregationOnBottomCount)==0?(null==n?void 0:n.showOnTop)?null:o:this.transpose||e-(this.rowCount-this.hasAggregationOnBottomCount)!=0||(null==n?void 0:n.showOnTop)?null:o}getAggregatorCellAddress(t,e,i,o){const n=[],r=this.hasAggregationOnTopCount,s=this.hasAggregationOnBottomCount;if(this.transpose){for(let i=e;i<=o;i++)if(this.getColumnDefine(t,i).vtable_aggregator){for(let t=0;t<r;t++)n.push({col:this.headerLevelCount+t,row:i});for(let t=0;t<s;t++)n.push({col:this.rowCount-s+t,row:i})}}else for(let o=t;o<=i;o++)if(this.getColumnDefine(o,e).vtable_aggregator){for(let t=0;t<r;t++)n.push({col:o,row:this.headerLevelCount+t});for(let t=0;t<s;t++)n.push({col:o,row:this.rowCount-s+t})}return n}getCellLocation(t,e){return this.isHeader(t,e)?this.transpose?"rowHeader":"columnHeader":"body"}isRowHeader(t,e){return!!(this.transpose&&t>=this.leftRowSeriesNumberColumnCount&&t<this.headerLevelCount+this.leftRowSeriesNumberColumnCount)}isColumnHeader(t,e){return!this.transpose&&e>=0&&e<=this.headerLevelCount-1&&t>=this.leftRowSeriesNumberColumnCount&&t<this.colCount-this.rightRowSeriesNumberColumnCount}isFrozenColumn(t,e){if(ot(e)){if(t>=0&&t<this.frozenColCount&&e>=this.frozenRowCount&&e<this.rowCount-this.bottomFrozenRowCount)return!0}else if(this.frozenColCount>0&&t>=0&&t<this.frozenColCount)return!0;return!1}isRightFrozenColumn(t,e){if(ot(e)){if(t>=this.colCount-this.rightFrozenColCount&&e>=this.frozenRowCount&&e<this.rowCount-this.bottomFrozenRowCount)return!0}else if(this.rightFrozenColCount>0&&t>=this.colCount-this.rightFrozenColCount)return!0;return!1}isFrozenRow(t,e){if(ot(e)){if(e>=0&&e<this.frozenRowCount&&t>=this.frozenColCount&&t<this.colCount-this.rightFrozenColCount)return!0}else if(e=t,this.frozenRowCount>0&&e>=0&&e<this.frozenRowCount)return!0;return!1}isBottomFrozenRow(t,e){if(ot(e)){if(e>=this.rowCount-this.bottomFrozenRowCount&&t>=this.frozenColCount&&t<this.colCount-this.rightFrozenColCount)return!0}else if(e=t,this.bottomFrozenRowCount>0&&e>=this.rowCount-this.bottomFrozenRowCount)return!0;return!1}isLeftTopCorner(t,e){return t>=0&&t<this.frozenColCount&&e>=0&&e<this.frozenRowCount}isLeftBottomCorner(t,e){return t>=0&&t<this.frozenColCount&&e>=this.rowCount-this.bottomFrozenRowCount}isRightTopCorner(t,e){return t>=this.colCount-this.rightFrozenColCount&&e>=0&&e<this.frozenRowCount}isRightBottomCorner(t,e){return t>=this.colCount-this.rightFrozenColCount&&e>=this.rowCount-this.bottomFrozenRowCount}isCornerHeader(t,e){return!1}getColumnHeaderRange(){var t,e;return this.transpose?{start:{col:0,row:0},end:{col:this._headerCellIds.length-1,row:(null!==(t=this.rowCount)&&void 0!==t?t:0)-1}}:{start:{col:0,row:0},end:{col:(null!==(e=this.colCount)&&void 0!==e?e:0)-1,row:this._headerCellIds.length-1}}}getRowHeaderRange(){var t,e;return this.transpose?{start:{col:0,row:0},end:{col:this._headerCellIds.length-1,row:(null!==(t=this.rowCount)&&void 0!==t?t:0)-1}}:{start:{col:0,row:0},end:{col:(null!==(e=this.colCount)&&void 0!==e?e:0)-1,row:this._headerCellIds.length-1}}}getCornerHeaderRange(){}getBodyRange(){var t,e,i,o;return this.transpose?{start:{col:this.headerLevelCount,row:0},end:{col:(null!==(t=this.colCount)&&void 0!==t?t:0)-1,row:(null!==(e=this.rowCount)&&void 0!==e?e:0)-1}}:{start:{col:0,row:this.headerLevelCount},end:{col:(null!==(i=this.colCount)&&void 0!==i?i:0)-1,row:(null!==(o=this.rowCount)&&void 0!==o?o:0)-1}}}get headerLevelCount(){return this.showHeader?this._headerCellIds.length:0}get columnHeaderLevelCount(){return this.transpose?0:this.headerLevelCount}get rowHeaderLevelCount(){return this.transpose?this.headerLevelCount:0}get frozenColCount(){return this._table.internalProps.frozenColCount?this.colCount>this._table.internalProps.frozenColCount?this._table.internalProps.frozenColCount:this.colCount:0}get frozenRowCount(){return this._table.internalProps.frozenRowCount?this.rowCount>=this._table.internalProps.frozenRowCount?this._table.internalProps.frozenRowCount:this.rowCount:0}get bottomFrozenRowCount(){return this._table.internalProps.bottomFrozenRowCount?this.rowCount-this.headerLevelCount>=this._table.internalProps.bottomFrozenRowCount?this._table.internalProps.bottomFrozenRowCount:this.rowCount-this.headerLevelCount:0}get rightFrozenColCount(){return this._table.internalProps.rightFrozenColCount?this.colCount-this.frozenColCount>=this._table.internalProps.rightFrozenColCount?this._table.internalProps.rightFrozenColCount:Math.max(0,this.colCount-this.frozenColCount):0}get colCount(){return this.transpose?this.headerLevelCount+this.recordsCount+this.leftRowSeriesNumberColumnCount+this.rightRowSeriesNumberColumnCount:this._columns.length+this.leftRowSeriesNumberColumnCount+this.rightRowSeriesNumberColumnCount}get rowCount(){return this.transpose?this._columns.length:this.headerLevelCount+this.recordsCount}get bodyRowCount(){return this.transpose?this._columns.length:this.rowCount-this.bottomFrozenRowCount-this.headerLevelCount}get bodyColCount(){return this.transpose?this.colCount-this.rightFrozenColCount-this.rowHeaderLevelCount:this._columns.length}get recordsCount(){return this._recordsCount}set recordsCount(t){this._recordsCount=t}get headerObjects(){return this._headerObjects}get columnObjects(){return this._columns}get headerObjectsIncludeHided(){return this._headerObjectsIncludeHided}get columnWidths(){if(this.leftRowSeriesNumberColumnCount){const t=this.leftRowSeriesNumberColumn.map((t=>({width:t.width,minWidth:t.minWidth,maxWidth:t.maxWidth})));return t.push(...this._columns.map((t=>({width:t.width,minWidth:t.minWidth,maxWidth:t.maxWidth})))),t}return this._columns.map((t=>({width:t.width,minWidth:t.minWidth,maxWidth:t.maxWidth})))}getColumnWidthDefined(t){var e;if(t>=0){if(t<this.leftRowSeriesNumberColumnCount)return this.leftRowSeriesNumberColumn[t];if(this.transpose){let i,o,n=0;if(t>=this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount){let t;return this.columnObjects.forEach(((e,r)=>{"number"==typeof e.width?n=Math.max(e.width,n):"auto"===e.width&&(t=!0),"number"==typeof e.minWidth&&(o=Math.max(e.minWidth,o)),"number"==typeof e.maxWidth&&(i=Math.max(e.maxWidth,i))})),n=n>0?n:t?"auto":void 0,{width:n,minWidth:o,maxWidth:i}}if(this.isRowHeader(t,0)){const i=Array.isArray(this._table.defaultHeaderColWidth)?null!==(e=this._table.defaultHeaderColWidth[t])&&void 0!==e?e:this._table.defaultColWidth:this._table.defaultHeaderColWidth;return"auto"===i?{width:"auto"}:{width:i}}}return this._columns[t-this.leftRowSeriesNumberColumnCount]}}getCellId(t,e){var i,o,n,r;return this.transpose?t>=this.headerLevelCount+this.leftRowSeriesNumberColumnCount?null===(i=this._columns[e])||void 0===i?void 0:i.id:this.isSeriesNumber(t,e)?e+"_series_number":null===(o=this._headerCellIds[t-this.leftRowSeriesNumberColumnCount])||void 0===o?void 0:o[e]:this.isSeriesNumber(t,e)?this.rowSeriesNumberColumn[t].id:this.headerLevelCount<=e?null===(n=this._columns[t-this.leftRowSeriesNumberColumnCount])||void 0===n?void 0:n.id:null===(r=this._headerCellIds[e])||void 0===r?void 0:r[t-this.leftRowSeriesNumberColumnCount]}getHeader(t,e){if(this.isSeriesNumberInHeader(t,e))return this.getSeriesNumberHeader(t,e);const i=this.getCellId(t,e);return this._headerObjectMap[i]}getHeaderField(t,e){var i,o,n;if(this.isSeriesNumberInHeader(t,e))return null===(i=this.getSeriesNumberHeader(t,e))||void 0===i?void 0:i.field;if(this.isSeriesNumberInBody(t,e))return null===(o=this.getSeriesNumberBody(t,e))||void 0===o?void 0:o.field;const r=this.getCellId(t,e);return(null===(n=this._headerObjectMap[r])||void 0===n?void 0:n.field)||(this.transpose?this._columns[e]&&this._columns[e].field:this._columns[t-this.leftRowSeriesNumberColumnCount]&&this._columns[t-this.leftRowSeriesNumberColumnCount].field)}getHeaderCellAdressById(t){for(let e=0;e<this._headerCellIds.length;e++){const i=this._headerCellIds[e];for(let o=0;o<i.length;o++)if(i[o]===t)return this.transpose?{col:e,row:o}:{col:o+this.leftRowSeriesNumberColumnCount,row:e}}}getHeaderCellAddressByField(t){const e=this.headerObjects.find((e=>e&&e.field===t));return e&&this.getHeaderCellAdressById(e.id)}getBody(t,e){return this.isSeriesNumber(t,e)?this.getSeriesNumberBody(t,e):this.transpose?this._columns[e]:this._columns[t-this.leftRowSeriesNumberColumnCount]}getBodyLayoutRangeById(t){var e,i;if(this.transpose){for(let i=0;i<(null!==(e=this.rowCount)&&void 0!==e?e:0);i++)if(t===this._columns[i].id)return{start:{col:0,row:i},end:{col:0,row:i}}}else for(let e=this.leftRowSeriesNumberColumnCount;e<(null!==(i=this.colCount)&&void 0!==i?i:0);e++)if(t===this._columns[e-this.leftRowSeriesNumberColumnCount].id)return{start:{col:e,row:0},end:{col:e,row:0}};return{start:{col:-1,row:-1},end:{col:-1,row:-1}}}getCellRange(t,e){return function(t,e,i){var o,n,r;if(-1===t||-1===e)return{start:{col:t,row:e},end:{col:t,row:e}};if(i._cellRangeMap.has(`$${t}$${e}`))return i._cellRangeMap.get(`$${t}$${e}`);let s={start:{col:t,row:e},end:{col:t,row:e}};if(i.transpose)s=function(t,e,i){var o,n,r,s;const a={start:{col:t,row:e},end:{col:t,row:e}};if(i.headerLevelCount+i.leftRowSeriesNumberColumnCount<=t||-1===t&&-1===e){if(i.headerLevelCount+i.leftRowSeriesNumberColumnCount<=t&&(null===(n=null===(o=i.columnObjects[e])||void 0===o?void 0:o.define)||void 0===n?void 0:n.mergeCell)){const o=i._table.getCellValue(t,e);for(let n=t-1;n>=i.headerLevelCount+i.leftRowSeriesNumberColumnCount;n--){const r=i._table.getCellValue(n,e);if("boolean"==typeof i.columnObjects[e].define.mergeCell){if(o!==r)break}else if(!i.columnObjects[e].define.mergeCell(o,r,{source:{col:t,row:e},target:{col:n,row:e},table:i._table}))break;a.start.col=n}for(let n=t+1;n<(null!==(r=i.colCount)&&void 0!==r?r:0);n++){const r=i._table.getCellValue(n,e);if("boolean"==typeof i.columnObjects[e].define.mergeCell){if(o!==r)break}else if(!i.columnObjects[e].define.mergeCell(o,r,{source:{col:t,row:e},target:{col:n,row:e},table:i._table}))break;a.end.col=n}}return a}const l=i.getCellId(t,e);for(let o=e-1;o>=0&&l===i.getCellId(t,o);o--)a.start.row=o;for(let o=e+1;o<(null!==(s=i.rowCount)&&void 0!==s?s:0)&&l===i.getCellId(t,o);o++)a.end.row=o;for(let o=t-1;o>=0&&l===i.getCellId(o,e);o--)a.start.col=o;for(let o=t+1;o<i.headerLevelCount+i.leftRowSeriesNumberColumnCount&&l===i.getCellId(o,e);o++)a.end.col=o;return a}(t,e,i);else if(i.headerLevelCount<=e){if(i.headerLevelCount<=e&&(null===(n=null===(o=i.columnObjects[t-i.leftRowSeriesNumberColumnCount])||void 0===o?void 0:o.define)||void 0===n?void 0:n.mergeCell)){const o=i._table.getCellValue(t,e);for(let n=e-1;n>=i.headerLevelCount;n--){const r=i._table.getCellValue(t,n);if("boolean"==typeof i.columnObjects[t-i.leftRowSeriesNumberColumnCount].define.mergeCell){if(o!==r)break}else if(!i.columnObjects[t-i.leftRowSeriesNumberColumnCount].define.mergeCell(o,r,{source:{col:t,row:e},target:{col:t,row:n},table:i._table}))break;s.start.row=n}for(let n=e+1;n<i.rowCount;n++){const r=i._table.getCellValue(t,n);if("boolean"==typeof i.columnObjects[t-i.leftRowSeriesNumberColumnCount].define.mergeCell){if(o!==r)break}else if(!i.columnObjects[t-i.leftRowSeriesNumberColumnCount].define.mergeCell(o,r,{source:{col:t,row:e},target:{col:t,row:n},table:i._table}))break;s.end.row=n}}!function(t,e,i,o){var n;if("tree"!==o.rowHierarchyType)return;const r=o._table.getCellRawRecord(t,e);(null===(n=o._table.internalProps.rowSeriesNumber)||void 0===n?void 0:n.enableTreeCheckbox)?(null==r?void 0:r.vtableMerge)&&t>=o.leftRowSeriesNumberColumnCount&&(i.start.col=o.rowHeaderLevelCount+o.leftRowSeriesNumberColumnCount,i.end.col=o.colCount-1,i.start.row=i.end.row=e):(null==r?void 0:r.vtableMerge)&&(i.start.col=o.rowHeaderLevelCount,i.end.col=o.colCount-1,i.start.row=i.end.row=e)}(t,e,s,i)}else{const o=i.getCellId(t,e);for(let n=t-1;n>=0&&o===i.getCellId(n,e);n--)s.start.col=n;for(let n=t+1;n<(null!==(r=i.colCount)&&void 0!==r?r:0)&&o===i.getCellId(n,e);n++)s.end.col=n;for(let n=e-1;n>=0&&o===i.getCellId(t,n);n--)s.start.row=n;for(let n=e+1;n<i.headerLevelCount&&o===i.getCellId(t,n);n++)s.end.row=n}return i._cellRangeMap.set(`$${t}$${e}`,s),s}(t,e,this)}isCellRangeEqual(t,e,i,o){const n=this.getCellRange(t,e),r=this.getCellRange(i,o);return n.start.col===r.start.col&&n.end.col===r.end.col&&n.start.row===r.start.row&&n.end.row===r.end.row}getRecordShowIndexByCell(t,e){const i=this.hasAggregationOnTopCount?this.headerLevelCount+1:this.headerLevelCount;return this.transpose?t<i?-1:t-i:e<i?-1:e-i}getRecordStartRowByRecordIndex(t){return(this.hasAggregationOnTopCount?this.headerLevelCount+1:this.headerLevelCount)+t}_addHeaders(t,e,i,o){const n=[],r=this._newRow(t,o);return e.forEach((e=>{var s,a,l,h;const d=this._columns.length,c=this.seqId++,u={id:c,title:null!==(s=e.title)&&void 0!==s?s:e.caption,headerIcon:e.headerIcon,field:e.field,style:e.headerStyle,headerType:null!==(a=e.headerType)&&void 0!==a?a:"text",dropDownMenu:e.dropDownMenu,define:e,hierarchyState:e.hierarchyState,columnWidthComputeMode:e.columnWidthComputeMode};n[c]=u;for(let e=t-1;e>=0;e--)this._headerCellIds[e]&&(this._headerCellIds[e][d]=i[e]);o?this._headerCellIds[t-1]&&(r[d]=this._headerCellIds[t-1][d]):r[d]=c;const g=!e.hierarchyState||e.hierarchyState===nw.expand;if(e.columns&&g)!e.columns.every((t=>t.hide))&&this._addHeaders(t+1,e.columns,[...i,c],e.hideColumnsSubHeader||o).forEach((t=>n.push(t)));else{const i={id:this.seqId++,field:e.field,fieldFormat:e.fieldFormat,width:e.width,minWidth:e.minWidth,maxWidth:e.maxWidth,icon:e.icon,cellType:null!==(h=null!==(l=e.cellType)&&void 0!==l?l:e.columnType)&&void 0!==h?h:"text",chartModule:"chartModule"in e?e.chartModule:null,chartSpec:"chartSpec"in e?e.chartSpec:null,sparklineSpec:"sparklineSpec"in e?e.sparklineSpec:jx,style:e.style,define:e,columnWidthComputeMode:e.columnWidthComputeMode,disableColumnResize:null==e?void 0:e.disableColumnResize,aggregation:e.aggregation,isChildNode:t>=1};if(this._columnsIncludeHided.push(i),!0!==e.hide){this._columns.push(i);for(let e=t+1;e<this._headerCellIds.length;e++)this._headerCellIds[e][d]=c}}})),n}_newRow(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._headerCellIds[t]){const e=this._headerCellIds[t-1];if(e.length>this._headerCellIds[t].length)for(let i=this._headerCellIds[t].length;i<e.length;i++)this._headerCellIds[t][i]=e[i];return this._headerCellIds[t]}if(e)return[];const i=this._headerCellIds[t]=[];if(!this._columns.length)return i;const o=this._headerCellIds[t-1];for(let t=0;t<o.length;t++)i[t]=o[t];return i}getCellHeaderPaths(t,e){if(this.isSeriesNumber(t,e))return;let i=[],o=[];return this.transpose?o=[{field:this._columns[e].field}]:i=[{field:this._columns[t-this.leftRowSeriesNumberColumnCount].field}],{colHeaderPaths:i,rowHeaderPaths:o,cellLocation:this.getCellLocation(t,e)}}getParentCellId(t,e){if(0!==e){if(this.isColumnHeader(t,e))return this.getCellId(t,e-1);if(this.isRowHeader(t,e)){if(this.isSeriesNumberInBody(t-1,e))return;return this.getCellId(t-1,e)}}}canMoveHeaderPosition(t,e){if(this.isSeriesNumberInHeader(e.col,e.row)||this.isSeriesNumberInHeader(t.col,t.row))return!1;if(!this.transpose&&this.isSeriesNumberInBody(e.col,e.row)&&this.isSeriesNumberInBody(t.col,t.row)){const i=this.getRecordShowIndexByCell(0,t.row),o=this.getRecordShowIndexByCell(0,e.row);return this._table.dataSource.canChangeOrder(i,o)}if(this.transpose&&this.isSeriesNumberInBody(e.col,e.row)&&this.isSeriesNumberInBody(t.col,t.row)&&(this.getBody(t.col+this.leftRowSeriesNumberColumnCount,t.row).isChildNode&&this.getBody(e.col+this.leftRowSeriesNumberColumnCount,e.row).isChildNode?(t.col=t.col+this.leftRowSeriesNumberColumnCount+this.rowHeaderLevelCount-1,e.col=e.col+this.leftRowSeriesNumberColumnCount+this.rowHeaderLevelCount-1):(t.col=t.col+this.leftRowSeriesNumberColumnCount,e.col=e.col+this.leftRowSeriesNumberColumnCount)),t.col<0||t.row<0||e.col<0||e.row<0)return!1;if("disabled"===this._table.internalProps.frozenColDragHeaderMode&&this._table.isFrozenColumn(e.col))return!1;const i=this.getCellRange(t.col,t.row);return this.isColumnHeader(t.col,t.row)?this.getParentCellId(t.col,i.start.row)===this.getParentCellId(e.col,i.start.row):!!this.isRowHeader(t.col,t.row)&&this.getParentCellId(i.start.col,t.row)===this.getParentCellId(i.start.col,e.row)}moveHeaderPosition(t,e){var i,o;if(((null===(i=this._table.options.dragOrder)||void 0===i?void 0:i.validateDragOrderOnEnd(t,e))||!(null===(o=this._table.options.dragOrder)||void 0===o?void 0:o.validateDragOrderOnEnd))&&this.canMoveHeaderPosition(t,e)){let i=this.getCellRange(t.col,t.row);if(this.isColumnHeader(t.col,t.row)){const o=i.end.col-i.start.col+1;let n;const r=this.getCellRange(e.col,i.start.row);if(n=e.col>=t.col?r.end.col-o+1:r.start.col,n===i.start.col)return null;for(let t=0;t<this._headerCellIds.length;t++){const e=this._headerCellIds[t].splice(i.start.col-this.leftRowSeriesNumberColumnCount,o);e.unshift(n-this.leftRowSeriesNumberColumnCount,0),Array.prototype.splice.apply(this._headerCellIds[t],e)}const s=this._columns.splice(i.start.col-this.leftRowSeriesNumberColumnCount,o);return s.unshift(n-this.leftRowSeriesNumberColumnCount,0),Array.prototype.splice.apply(this._columns,s),this.columnTree.movePosition(i.start.row,i.start.col-this.leftRowSeriesNumberColumnCount,n-this.leftRowSeriesNumberColumnCount),this.columnTree.reset(this.columnTree.tree.children),this._cellRangeMap=new Map,{sourceIndex:i.start.col,targetIndex:n,sourceSize:o,targetSize:r.end.col-r.start.col+1,moveType:"column"}}if(this.isRowHeader(t.col,t.row)||this.isSeriesNumberInBody(t.col,t.row)&&this.transpose){this.isSeriesNumberInBody(t.col,t.row)&&(i=this.getCellRange(t.col+this.leftRowSeriesNumberColumnCount,t.row));const o=i.end.row-i.start.row+1;let n;const r=this.getCellRange(i.start.col,e.row);if(n=e.row>=t.row?r.end.row-o+1:r.start.row,n===i.start.row)return null;for(let t=0;t<this._headerCellIds.length;t++){const e=this._headerCellIds[t].splice(i.start.row,o);e.unshift(n,0),Array.prototype.splice.apply(this._headerCellIds[t],e)}const s=this._columns.splice(i.start.row,o);return s.unshift(n,0),Array.prototype.splice.apply(this._columns,s),this.columnTree.movePosition(i.start.col-this.leftRowSeriesNumberColumnCount,i.start.row,n+(e.row>t.row?i.end.row-i.start.row:0)),this.columnTree.reset(this.columnTree.tree.children),this._cellRangeMap=new Map,{sourceIndex:i.start.row,targetIndex:n,sourceSize:o,targetSize:r.end.row-r.start.row+1,moveType:"row"}}if(this.isSeriesNumberInBody(t.col,t.row))return{sourceIndex:t.row,targetIndex:e.row,sourceSize:1,targetSize:1,moveType:"row"}}return null}toggleHierarchyState(t){return{addCellPositions:t.add.map((t=>({col:0,row:this._table.columnHeaderLevelCount+t}))),removeCellPositions:t.remove.map((t=>({col:0,row:this._table.columnHeaderLevelCount+t})))}}setChartInstance(t,e,i){const o=this.transpose?this._columns[e]:this._columns[t-this.leftRowSeriesNumberColumnCount];"function"!=typeof o.chartSpec&&(o.chartInstance=i)}getChartInstance(t,e){return(this.transpose?this._columns[e]:this._columns[t-this.leftRowSeriesNumberColumnCount]).chartInstance}checkHasChart(){return function(t){let e=!1;for(let i=0;i<t.columnObjects.length;i++)if(t.columnObjects[i].chartSpec){e=!0;break}return e}(this)}getAxisConfigInPivotChart(t,e){}isEmpty(t,e){return!1}isAxisCell(t,e){return!1}getChartAxes(t,e){return[]}isShareChartSpec(t,e){const i=this.getBody(t,e);return"function"!=typeof(null==i?void 0:i.chartSpec)}isNoChartDataRenderNothing(t,e){const i=this.getBody(t,e);return(null==i?void 0:i.define).noDataRenderNothing}getChartSpec(t,e){return this.getRawChartSpec(t,e)}getRawChartSpec(t,e){const i=this.getBody(t,e),o=null==i?void 0:i.chartSpec;return"function"==typeof o?o({col:t,row:e,dataValue:this._table.getCellOriginValue(t,e)||"",value:this._table.getCellValue(t,e)||"",rect:this._table.getCellRangeRelativeRect(this._table.getCellRange(t,e)),table:this._table}):o}getChartDataId(t,e){return function(t,e,i){var o;const n=i.getRawChartSpec(t,e);if(null==n?void 0:n.series){const t={};return(null===(o=n.data)||void 0===o?void 0:o.id)&&(t[n.data.id]=void 0),null==n||n.series.forEach((e=>{var i,o,r,s,a,l,h,d,c,u,g;if(!(null===(i=e.data)||void 0===i?void 0:i.fromDataId))if(null===(o=e.data)||void 0===o?void 0:o.transforms)t[null!==(g=null!==(c=null===(d=e.data)||void 0===d?void 0:d.id)&&void 0!==c?c:null===(u=n.data)||void 0===u?void 0:u.id)&&void 0!==g?g:"data"]=void 0;else{const i="horizontal"===e.direction?e.xField:e.yField;t[null!==(l=null!==(s=null===(r=e.data)||void 0===r?void 0:r.id)&&void 0!==s?s:null===(a=n.data)||void 0===a?void 0:a.id)&&void 0!==l?l:"data"]=(null===(h=e.data)||void 0===h?void 0:h.id)?i:void 0}})),t}return n.data.id}(t,e,this)}release(){const t=this._table._getActiveChartInstance();null==t||t.release(),this.columnObjects.forEach((t=>{var e;null===(e=t.chartInstance)||void 0===e||e.release()}))}clearCellRangeMap(){this._cellRangeMap.clear()}updateColumnTitle(t,e,i){const o=this._table.internalProps.layoutMap.getHeader(t,e);o.title=i,o.define.title=i}getColumnByField(t){var e;return null===(e=this.columnObjects)||void 0===e?void 0:e.reduce(((e,i,o)=>(i.field===t&&e.push({col:o,columnDefine:i}),e)),[])}getColumnByKey(t){var e;let i;return{columnDefine:null===(e=this.columnObjects)||void 0===e?void 0:e.find(((e,o)=>{var n;return(null===(n=e.define)||void 0===n?void 0:n.key)===t&&(i=o,!0)})),col:i}}getColumnDefine(t,e){if(t>=0)return t<this.leftRowSeriesNumberColumnCount?this.leftRowSeriesNumberColumn[t].define:this.transpose?this._columns[e].define:this._columns[t-this.leftRowSeriesNumberColumnCount].define}}class oF{constructor(t){this.isValidatingValue=!1,this.listenersId=[],this.table=t,this.bindEvent()}bindEvent(){const t=this.table,e=t.on(Ax.DBLCLICK_CELL,(e=>{var i;const{editCellTrigger:o="doubleclick"}=t.options;if(!o.includes("doubleclick"))return;const{col:n,row:r}=e,s=VB(e.federatedEvent),a=t.scenegraph.getResizeColAt(s.abstractPos.x,s.abstractPos.y,null===(i=s.eventArgs)||void 0===i?void 0:i.targetCell);t._canResizeColumn(a.col,a.row)&&a.col>=0||this.startEditCell(n,r)})),i=t.on(Ax.CLICK_CELL,(e=>{const{editCellTrigger:i="doubleclick"}=t.options;if("click"===i||Array.isArray(i)&&i.includes("click")){const{col:t,row:i}=e;this.startEditCell(t,i)}}));this.listenersId.push(e,i)}startEditCell(t,e,i){var o,n,r,s,a;if(this.editingEditor)return;const l=this.table.getEditor(t,e);if(l){if(null===(n=null===(o=this.table.internalProps.layoutMap)||void 0===o?void 0:o.isAggregation)||void 0===n?void 0:n.call(o,t,e))return;const h=this.table.getCellRawRecord(t,e);if(null==h?void 0:h.vtableMerge)return;this.editingEditor||(this.editCell={col:t,row:e}),this.table._makeVisibleCell(t,e),this.editingEditor=l;const d=ot(i)?i:this.table.getCellOriginValue(t,e),c=this.table.getCellRangeRelativeRect(this.table.getCellRange(t,e)),u={rect:{left:c.left,top:c.top,width:c.width,height:c.height}};t===this.table.colCount-1&&(u.rect.width=c.width-1),e===this.table.rowCount-1&&(u.rect.height=c.height-1),l.beginEditing,null===(r=l.beginEditing)||void 0===r||r.call(l,this.table.getElement(),u,d),l.bindSuccessCallback,null===(s=l.bindSuccessCallback)||void 0===s||s.call(l,(()=>{this.completeEdit()})),null===(a=l.onStart)||void 0===a||a.call(l,{value:d,endEdit:()=>{this.completeEdit()},referencePosition:u,container:this.table.getElement(),col:t,row:e,table:this.table})}}completeEdit(t){var e,i;if(!this.editingEditor)return!0;if(this.isValidatingValue)return!1;const o=null==t?void 0:t.target,{editingEditor:n}=this;if(o)if(n.targetIsOnEditor){if(n.targetIsOnEditor(o))return!1}else if(!n.isEditorElement||n.isEditorElement(o))return!1;if(this.editingEditor.getValue,this.editingEditor.validateValue){this.isValidatingValue=!0;const t=this.editingEditor.getValue(),o=this.table.getCellOriginValue(this.editCell.col,this.editCell.row),n=null===(i=(e=this.editingEditor).validateValue)||void 0===i?void 0:i.call(e,t,o,this.editCell,this.table);return gx(n)?(this.isValidatingValue=!0,new Promise(((t,e)=>{n.then((e=>{nF(e,this,o,t)})).catch((t=>{this.isValidatingValue=!1,e(t)}))}))):nF(n,this,o)}return this.doExit(),!0}doExit(){var t,e,i,o,n,r;const s=null===(e=(t=this.editingEditor).getValue)||void 0===e?void 0:e.call(t),a=this.table.getCellRange(this.editCell.col,this.editCell.row),l=[];for(let t=a.start.row;t<=a.end.row;t++){const t=[];for(let e=a.start.col;e<=a.end.col;e++)t.push(s);l.push(t)}this.table.changeCellValues(a.start.col,a.start.row,l),this.editingEditor.exit,null===(o=(i=this.editingEditor).exit)||void 0===o||o.call(i),null===(r=(n=this.editingEditor).onEnd)||void 0===r||r.call(n),this.editingEditor=null,this.isValidatingValue=!1}cancelEdit(){var t,e,i,o;this.editingEditor&&(null===(e=(t=this.editingEditor).exit)||void 0===e||e.call(t),null===(o=(i=this.editingEditor).onEnd)||void 0===o||o.call(i),this.editingEditor=null)}release(){this.listenersId.forEach((t=>{this.table.off(t)}))}}function nF(t,e,i,o){return e.isValidatingValue=!1,"validate-exit"===t?(e.doExit(),null==o||o(!0),!0):"invalidate-exit"===t?(e.editingEditor.setValue(i),e.doExit(),null==o||o(!0),!0):"validate-not-exit"===t||"invalidate-not-exit"===t?(null==o||o(!1),!1):!0===t?(e.doExit(),null==o||o(!0),!0):(null==o||o(!1),!1)}function rF(t){return lt(t)?{groupByRules:[t]}:ht(t)?{groupByRules:t.map((t=>lt(t)?t:t.key))}:{}}function sF(t,e,i,o){if("group"===o)return o;if("sort"===o&&!i.options.groupBy)return o;let n="normal";return i.options.groupBy?n="group":!i.isHeader(t,e)&&i.dataSource.lastOrderField&&i.getBodyField(t,e)===i.dataSource.lastOrderField&&(n="sort"),n}function aF(t){let e=t.sortState;e=!e||Array.isArray(e)?e:[e],e&&(e=e.map((e=>{var i;return e.orderFn=null!==(i=t._getSortFuncFromHeaderOption(void 0,e.field))&&void 0!==i?i:Zw,e})),t.dataSource.sort(e))}class lF extends DE{constructor(t,e){var i,o,n,r,s,a,l,h;"node"===zw.mode?(e=t,t=null):t instanceof HTMLElement||(e=t,t=t.container?t.container:null),super(t,e),this.showHeader=!0;const d=this.internalProps;if(d.frozenColDragHeaderMode=null!==(o=null===(i=e.dragOrder)||void 0===i?void 0:i.frozenColDragHeaderMode)&&void 0!==o?o:e.frozenColDragHeaderMode,this.pagination=e.pagination,d.sortState=e.sortState,d.multipleSort=!!e.multipleSort,d.dataConfig=e.groupBy?rF(e.groupBy):{},d.columns=e.columns?VH(e.columns,["children"]):e.header?VH(e.header,["children"]):[],DB(this),d.enableTreeNodeMerge=null!==(r=null!==(n=e.enableTreeNodeMerge)&&void 0!==n?n:ot(e.groupBy))&&void 0!==r&&r,this.internalProps.headerHelper.setTableColumnsEditor(),this.showHeader=null===(s=e.showHeader)||void 0===s||s,this.internalProps.columnWidthConfig=e.columnWidthConfig,this.transpose=null!==(a=e.transpose)&&void 0!==a&&a,"node"!==zw.mode&&(this.editorManager=new oF(this)),this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,e.dataSource?this.dataSource=e.dataSource:e.records?this.setRecords(e.records,{sortState:d.sortState}):this.setRecords([]),e.title){const t=a_.getComponent("title");d.title=new t(e.title,this),this.scenegraph.resize()}if(this.options.emptyTip)if(this.internalProps.emptyTip)null===(l=this.internalProps.emptyTip)||void 0===l||l.resetVisible();else{const t=a_.getComponent("emptyTip");this.internalProps.emptyTip=new t(this.options.emptyTip,this),null===(h=this.internalProps.emptyTip)||void 0===h||h.resetVisible()}if(e.enableTreeStickCell){const t=a_.getComponent("listTreeStickCellPlugin");this.listTreeStickCellPlugin=new t(this)}setTimeout((()=>{this.fireListeners(Ax.INITIALIZED,null)}),0)}isListTable(){return!0}isPivotTable(){return!1}isPivotChart(){return!1}get sortState(){return this.internalProps.sortState}get records(){var t;return null===(t=this.dataSource)||void 0===t?void 0:t.records}get recordsCount(){return this.dataSource.records.length}updateColumns(t){var e,i,o,n;const r={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.internalProps.columns=VH(t,["children"]),DB(this),this.options.columns=t,this.internalProps.headerHelper.setTableColumnsEditor(),this._hasAutoImageColumn=void 0,this.refreshHeader(),null===(i=(e=this.dataSource).updateColumns)||void 0===i||i.call(e,this.internalProps.columns),this.records&&function(t){for(let e=0;e<t.length;e++)if(t[e].aggregation)return!0;return!1}(t)&&this.dataSource.processRecords(null!==(n=null===(o=this.dataSource.dataSourceObj)||void 0===o?void 0:o.records)&&void 0!==n?n:this.dataSource.dataSourceObj),this.internalProps.useOneRowHeightFillAll=!1,this.scenegraph.clearCells(),this.headerStyleCache=new Map,this.bodyStyleCache=new Map,this.bodyBottomStyleCache=new Map,this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(r.col,r.row),this.renderAsync(),this.eventManager.updateEventBinder()}get columns(){return this.internalProps.layoutMap.columnTree.getCopiedTree()}get header(){return this.internalProps.columns}set header(t){this.internalProps.columns=t,DB(this),this.options.header=t,this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,this.renderAsync()}get transpose(){var t;return null!==(t=this.internalProps.transpose)&&void 0!==t&&t}set transpose(t){this.internalProps.transpose!==t&&(this.internalProps.transpose=t,this.internalProps.layoutMap&&(this.internalProps.layoutMap.transpose=t,this.refreshRowColCount(),this._resetFrozenColCount(),this.renderAsync()))}getCellValue(t,e,i){if(-1===t||-1===e)return null;if(!i){const i=this.getCustomMergeValue(t,e);if(i)return i}const o=this;if(o.internalProps.layoutMap.isSeriesNumber(t,e)){if(o.internalProps.layoutMap.isSeriesNumberInHeader(t,e)){const{title:i}=o.internalProps.layoutMap.getSeriesNumberHeader(t,e);return i}let i;if(this.options.groupBy){const n=o.getCellRawRecord(t,e);if(null==n?void 0:n.vtableMerge)return"";i=this.dataSource.getGroupSeriesNumber(e-this.columnHeaderLevelCount)}else i=e-this.columnHeaderLevelCount+1;const{format:n}=o.internalProps.layoutMap.getSeriesNumberBody(t,e);return"function"==typeof n?n(t,e,this,i):i}if(o.internalProps.layoutMap.isHeader(t,e)){const{title:i}=o.internalProps.layoutMap.getHeader(t,e);return"function"==typeof i?i():i}if(o.internalProps.layoutMap.isAggregation(t,e)){if(o.internalProps.layoutMap.isTopAggregation(t,e)){const i=o.internalProps.layoutMap.getAggregatorOnTop(t,e);return(null==i?void 0:i.formatValue)?i.formatValue(t,e,this):""}if(o.internalProps.layoutMap.isBottomAggregation(t,e)){const i=o.internalProps.layoutMap.getAggregatorOnBottom(t,e);return(null==i?void 0:i.formatValue)?i.formatValue(t,e,this):""}}const{field:n,fieldFormat:r}=o.internalProps.layoutMap.getBody(t,e);return o.getFieldData(r||n,t,e)}getCellOriginValue(t,e){if(-1===t||-1===e)return null;const i=this;if(i.internalProps.layoutMap.isSeriesNumber(t,e)){if(i.internalProps.layoutMap.isSeriesNumberInHeader(t,e)){const{title:o}=i.internalProps.layoutMap.getSeriesNumberHeader(t,e);return o}const{format:o}=i.internalProps.layoutMap.getSeriesNumberBody(t,e);return"function"==typeof o?o(t,e,this):e-this.columnHeaderLevelCount}if(i.internalProps.layoutMap.isHeader(t,e)){const{title:o}=i.internalProps.layoutMap.getHeader(t,e);return"function"==typeof o?o():o}if(i.internalProps.layoutMap.isAggregation(t,e)){if(i.internalProps.layoutMap.isTopAggregation(t,e)){const o=i.internalProps.layoutMap.getAggregatorOnTop(t,e);return null==o?void 0:o.value()}if(i.internalProps.layoutMap.isBottomAggregation(t,e)){const o=i.internalProps.layoutMap.getAggregatorOnBottom(t,e);return null==o?void 0:o.value()}}const{field:o}=i.internalProps.layoutMap.getBody(t,e);return i.getFieldData(o,t,e)}getCellRawValue(t,e){if(-1===t||-1===e)return null;const i=this;if(i.internalProps.layoutMap.isHeader(t,e)){const{title:o}=i.internalProps.layoutMap.getHeader(t,e);return"function"==typeof o?o():o}const{field:o}=i.internalProps.layoutMap.getBody(t,e);return i.getRawFieldData(o,t,e)}getRecordShowIndexByCell(t,e){const{layoutMap:i}=this.internalProps;return i.getRecordShowIndexByCell(t,e)}getRecordIndexByCell(t,e){const{layoutMap:i}=this.internalProps,o=i.getRecordShowIndexByCell(t,e);return this.dataSource.getRecordIndexPaths(o)}getTableIndexByRecordIndex(t){return this.transpose?this.dataSource.getTableIndex(t)+this.rowHeaderLevelCount:this.dataSource.getTableIndex(t)+this.columnHeaderLevelCount}getTableIndexByField(t){const e=this.internalProps.layoutMap.columnObjects.find((e=>e.field===t));if(!e)return-1;const i=this.internalProps.layoutMap.getBodyLayoutRangeById(e.id);return this.transpose?i.start.row:i.start.col}getCellAddrByFieldRecord(t,e){return this.transpose?{col:this.getTableIndexByRecordIndex(e),row:this.getTableIndexByField(t)}:{col:this.getTableIndexByField(t),row:this.getTableIndexByRecordIndex(e)}}getCellOriginRecord(t,e){const i=this.getRecordShowIndexByCell(t,e);if(i>-1)return this.dataSource.get(i)}getCellRawRecord(t,e){const i=this.getRecordShowIndexByCell(t,e);if(i>-1)return this.dataSource.getRaw(i)}_canResizeColumn(t,e){const i=super._canResizeColumn(t,e);if(i&&!this.transpose){const i=this.internalProps.layoutMap.getBody(t,this.columnHeaderLevelCount),o=this.internalProps.layoutMap.isSeriesNumber(t,e);if(null==i?void 0:i.disableColumnResize)return!1;if(o&&!0===this.internalProps.rowSeriesNumber.disableColumnResize)return!1}return i}updateOption(t){var e,i,o,n,r,s,a,l;const h=this.internalProps;if(super.updateOption(t),h.frozenColDragHeaderMode=null!==(i=null===(e=t.dragOrder)||void 0===e?void 0:e.frozenColDragHeaderMode)&&void 0!==i?i:t.frozenColDragHeaderMode,this.pagination=t.pagination,h.sortState=t.sortState,h.dataConfig=t.groupBy?rF(t.groupBy):{},this.showHeader=null===(o=t.showHeader)||void 0===o||o,h.columns=t.columns?VH(t.columns,["children"]):t.header?VH(t.header,["children"]):[],DB(this),h.enableTreeNodeMerge=null!==(r=null!==(n=t.enableTreeNodeMerge)&&void 0!==n?n:ot(t.groupBy))&&void 0!==r&&r,this.internalProps.headerHelper.setTableColumnsEditor(),this.transpose=null!==(s=t.transpose)&&void 0!==s&&s,this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,this.internalProps.columnWidthConfig=t.columnWidthConfig,h.releaseList&&(h.releaseList.forEach((t=>{var e;return null===(e=null==t?void 0:t.release)||void 0===e?void 0:e.call(t)})),h.releaseList=null),t.dataSource?this.dataSource=t.dataSource:t.records?this.setRecords(t.records,{sortState:t.sortState}):(this._resetFrozenColCount(),this.scenegraph.createSceneGraph(),this.render()),t.title){const e=a_.getComponent("title");h.title=new e(t.title,this),this.scenegraph.resize()}if(this.options.emptyTip)if(this.internalProps.emptyTip)null===(a=this.internalProps.emptyTip)||void 0===a||a.resetVisible();else{const t=a_.getComponent("emptyTip");this.internalProps.emptyTip=new t(this.options.emptyTip,this),null===(l=this.internalProps.emptyTip)||void 0===l||l.resetVisible()}return new Promise((t=>{setTimeout(t,0)}))}updatePagination(t){this.pagination&&("number"==typeof t.currentPage&&t.currentPage>=0&&(this.pagination.currentPage=t.currentPage),t.perPageCount&&(this.pagination.perPageCount=t.perPageCount||this.pagination.perPageCount),this.internalProps.layoutMap.clearCellRangeMap(),this.internalProps.useOneRowHeightFillAll=!1,this.scenegraph.clearCells(),this.dataSource.updatePagination(this.pagination),this.refreshRowColCount(),this.stateManager.initCheckedState(this.records),this.scenegraph.createSceneGraph(),this.renderAsync())}refreshHeader(){var t;const e=this.internalProps,i=this.transpose,o=this.showHeader;(e.layoutMap=new iF(this,null!==(t=e.columns)&&void 0!==t?t:[],o,this.options.hierarchyIndent)).transpose=i,i||this.setMinMaxLimitWidth(!0),this.refreshRowColCount()}refreshRowColCount(){var t,e,i,o,n,r,s,a,l,h,d,c,u,g,p,f,v,b;const m=this,{layoutMap:y}=m.internalProps;if(!y)return;const C=null!==(e=null===(t=m.internalProps.dataSource)||void 0===t?void 0:t.length)&&void 0!==e?e:0;y.recordsCount=C+(C>0?y.hasAggregationOnTopCount+y.hasAggregationOnBottomCount:0),m.transpose?(m.rowCount=null!==(i=y.rowCount)&&void 0!==i?i:0,m.colCount=null!==(o=y.colCount)&&void 0!==o?o:0,this.internalProps.frozenColCount=Math.max((null!==(n=y.headerLevelCount)&&void 0!==n?n:0)+y.leftRowSeriesNumberColumnCount,null!==(r=this.options.frozenColCount)&&void 0!==r?r:0),this.internalProps.frozenRowCount=null!==(s=this.options.frozenRowCount)&&void 0!==s?s:0,m.bottomFrozenRowCount!==(null!==(a=this.options.bottomFrozenRowCount)&&void 0!==a?a:0)&&(m.bottomFrozenRowCount=null!==(l=this.options.bottomFrozenRowCount)&&void 0!==l?l:0),m.rightFrozenColCount!==(null!==(h=this.options.rightFrozenColCount)&&void 0!==h?h:0)&&(m.rightFrozenColCount=null!==(d=this.options.rightFrozenColCount)&&void 0!==d?d:0)):(m.colCount=null!==(c=y.colCount)&&void 0!==c?c:0,m.rowCount=y.recordsCount*y.bodyRowSpanCount+y.headerLevelCount,this.internalProps.frozenColCount=null!==(u=this.options.frozenColCount)&&void 0!==u?u:0,m.frozenRowCount=Math.max(y.headerLevelCount,null!==(g=this.options.frozenRowCount)&&void 0!==g?g:0),m.bottomFrozenRowCount!==(null!==(p=this.options.bottomFrozenRowCount)&&void 0!==p?p:0)&&(m.bottomFrozenRowCount=null!==(f=this.options.bottomFrozenRowCount)&&void 0!==f?f:0),m.rightFrozenColCount!==(null!==(v=this.options.rightFrozenColCount)&&void 0!==v?v:0)&&(m.rightFrozenColCount=null!==(b=this.options.rightFrozenColCount)&&void 0!==b?b:0)),this.stateManager.setFrozenCol(this.internalProps.frozenColCount)}getFieldData(t,e,i){if(null===t)return null;if(this.internalProps.layoutMap.isHeader(e,i))return null;const o=this.getRecordShowIndexByCell(this.transpose?e-this.internalProps.layoutMap.leftRowSeriesNumberColumnCount:e,i);return this.internalProps.dataSource.getField(o,t,e,i,this)}getRawFieldData(t,e,i){if(null===t)return null;if(this.internalProps.layoutMap.isHeader(e,i))return null;const o=this.getRecordShowIndexByCell(e,i);return this.internalProps.dataSource.getRawField(o,t,e,i,this)}_moveHeaderPosition(t,e){const i=this.getCellRange(t.col,t.row),o=this.getCellRange(e.col,e.row),n=this.internalProps.layoutMap.moveHeaderPosition(t,e);return n?("column"===n.moveType?(this.colWidthsMap.exchangeOrder(i.start.col,i.end.col-i.start.col+1,o.start.col,o.end.col-o.start.col+1,n.targetIndex),this.transpose||(this.colWidthsLimit={},this.setMinMaxLimitWidth())):n.targetIndex>n.sourceIndex?this.rowHeightsMap.exchangeOrder(n.sourceIndex,n.sourceSize,n.targetIndex+n.sourceSize-n.targetSize,n.targetSize,n.targetIndex):this.rowHeightsMap.exchangeOrder(n.sourceIndex,n.sourceSize,n.targetIndex,n.targetSize,n.targetIndex),n):null}changeRecordOrder(t,e){this.transpose?(t=this.getRecordShowIndexByCell(t,0),e=this.getRecordShowIndexByCell(e,0)):(t=this.getRecordShowIndexByCell(0,t),e=this.getRecordShowIndexByCell(0,e)),this.dataSource.changeOrder(t,e)}getCellAddress(t,e){let i;for(let e=0;e<this.internalProps.records.length;e++){const o=this.internalProps.records[e];if("function"==typeof t)t(o)&&(i=e);else{let n=!0;for(const e in t)if(o[e]!==t[e]){n=!1;break}n&&(i=e)}if(ot(i))break}const o=this.getCellRangeByField(e,i);if(o)return{row:o.start.row,col:o.start.col}}getCellRangeByField(t,e){const{layoutMap:i}=this.internalProps,o=i.columnObjects.find((e=>e.field===t));if(o){const t=i.getBodyLayoutRangeById(o.id);let n;return ot(e)&&(n=i.getRecordStartRowByRecordIndex(e)),this.transpose?{start:{row:t.start.row,col:ot(n)?n+t.start.col:void 0},end:{row:t.end.row,col:ot(n)?n+t.end.col:void 0}}:{start:{col:t.start.col,row:ot(n)?n+t.start.row:void 0},end:{col:t.end.col,row:ot(n)?n+t.end.row:void 0}}}return null}getHierarchyState(t,e){var i;if(this.isHeader(t,e))return null===(i=this._getHeaderLayoutMap(t,e))||void 0===i?void 0:i.hierarchyState;if((!this.options.groupBy||ht(this.options.groupBy)&&0===this.options.groupBy.length)&&!this.getBodyColumnDefine(t,e).tree)return nw.none;const o=this.getRecordShowIndexByCell(t,e);return this.dataSource.getHierarchyState(o)}toggleHierarchyState(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.stateManager.updateHoverIcon(t,e,void 0,void 0);const o=this.getHierarchyState(t,e);if(this.isHeader(t,e)){const i=this.internalProps.layoutMap.getHeader(t,e),{hierarchyState:n,define:r}=i;if(![nw.collapse,nw.expand].includes(n)||!r)return;const s=r.columns;if(Array.isArray(s)&&s.length>0){const t=n===nw.expand?nw.collapse:nw.expand;i.hierarchyState=t,i.define.hierarchyState=t,this.updateColumns(this.internalProps.columns)}this.fireListeners(Ax.TREE_HIERARCHY_STATE_CHANGE,{col:t,row:e,hierarchyState:o,originData:i,cellLocation:this.getCellLocation(t,e)})}else if(o===nw.expand)this._refreshHierarchyState(t,e,i),this.fireListeners(Ax.TREE_HIERARCHY_STATE_CHANGE,{col:t,row:e,hierarchyState:nw.collapse});else if(o===nw.collapse){const o=this.getCellOriginRecord(t,e);Array.isArray(o.children)&&this._refreshHierarchyState(t,e,i),this.fireListeners(Ax.TREE_HIERARCHY_STATE_CHANGE,{col:t,row:e,hierarchyState:nw.expand,originData:o})}}setLoadingHierarchyState(t,e){this.scenegraph.setLoadingHierarchyState(t,e)}_refreshHierarchyState(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var o,n;let r=!1,s=!1;const a=this.internalProps.layoutMap.checkHasChart();a&&(this.autoFillWidth&&(r=this.getAllColsWidth()<=this.tableNoFrameWidth),this.autoFillHeight&&(s=this.getAllRowsHeight()<=this.tableNoFrameHeight));const l=this.getRecordShowIndexByCell(t,e),h=this.dataSource.toggleHierarchyState(l,this.scenegraph.proxy.rowStart-this.columnHeaderLevelCount,Math.max(this.scenegraph.proxy.rowEnd-this.columnHeaderLevelCount,this.scenegraph.proxy.rowStart-this.columnHeaderLevelCount+this.scenegraph.proxy.rowLimit-1)),d=this.internalProps.layoutMap.toggleHierarchyState(h);this.refreshRowColCount();for(let t=this.rowCount-this.bottomFrozenRowCount;t<this.rowCount;t++){const e=AT(t,0,this.colCount-1,this);this._setRowHeight(t,e)}this.clearCellStyleCache(),this.internalProps.layoutMap.clearCellRangeMap(),this.internalProps.useOneRowHeightFillAll=!1;const{updateCells:c,addCells:u,removeCells:g}=function(t,e,i,o){const n=[{col:e,row:i}],r=[],s=[],{addCellPositions:a,removeCellPositions:l}=t,h=o.scenegraph.proxy,{rowStart:d,rowLimit:c}=h;let{rowEnd:u}=h,g=1/0;for(let t=0;t<a.length;t++){const{row:i}=a[t];u-d+1===c?i>=d&&i<=u&&(g=Math.min(g,i)):(r.push({col:e,row:i}),u++)}const p=Math.min(d+c,o.rowCount-1-o.bottomFrozenRowCount),f=p<d+c;for(let t=0;t<l.length;t++){const{row:i}=l[l.length-t-1];i<d||i>u||(i>p||f?(s.push({col:e,row:i}),g--):g=Math.min(g,i))}if(g!==1/0)for(let t=g;t<=u;t++)n.push({col:e,row:t});return o.scenegraph.proxy.refreshRowCount(),{updateCells:n,addCells:r,removeCells:s}}(d,t,e,this);null===(o=this.reactCustomLayout)||void 0===o||o.clearCache(),this.scenegraph.updateRow(g,u,c,i,!0),null===(n=this.reactCustomLayout)||void 0===n||n.updateAllCustomCell(),a&&(this.autoFillWidth&&!r&&(r=this.getAllColsWidth()<=this.tableNoFrameWidth),this.autoFillHeight&&!s&&(s=this.getAllRowsHeight()<=this.tableNoFrameHeight),("adaptive"===this.widthMode||r||"adaptive"===this.heightMode||s)&&this.scenegraph.updateChartSizeForResizeColWidth(-1))}_hasHierarchyTreeHeader(){var t,e;return null===(e=null!==(t=this.options.columns)&&void 0!==t?t:this.options.header)||void 0===e?void 0:e.some(((t,e)=>t.tree))}getMenuInfo(t,e,i){return{field:this.getHeaderField(t,e),value:this.getCellValue(t,e),cellLocation:this.getCellLocation(t,e),event:void 0}}_getSortFuncFromHeaderOption(t,e,i){if(t||(t=this.internalProps.columns),e&&t&&t.length>0)for(let o=0;o<t.length;o++){const n=t[o];if((i&&i===n.fieldKey||!i&&n.field===e)&&n.sort&&"function"==typeof n.sort)return n.sort;if(n.columns){const t=this._getSortFuncFromHeaderOption(n.columns,e,i);if(t)return t}}}updateSortState(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var i;if(t)this.internalProps.sortState=t;else if(this.internalProps.sortState)if(Array.isArray(this.internalProps.sortState))for(let e=0;e<this.internalProps.sortState.length;e++)(t=null===(i=this.internalProps.sortState)||void 0===i?void 0:i[e])&&(t.order="normal");else this.internalProps.sortState.order="normal",t=this.internalProps.sortState;(t=Array.isArray(t)?t:[t]).some((t=>t.field))&&e&&this.internalProps.layoutMap.headerObjects.some((t=>!1!==t.define.sort))&&(this.dataSource.sort(t.map((t=>{const e=this._getSortFuncFromHeaderOption(this.internalProps.columns,t.field);return this.internalProps.layoutMap.headerObjects.find((e=>e&&e.field===t.field)),{field:t.field,order:t.order,orderFn:null!=e?e:Zw}}))),this.internalProps.layoutMap.clearCellRangeMap(),this.internalProps.useOneRowHeightFillAll=!1,this.scenegraph.sortCell()),t.length&&this.stateManager.updateSortState(t)}updateFilterRules(t){this.scenegraph.clearCells(),this.sortState?(this.dataSource.updateFilterRulesForSorted(t),aF(this)):this.dataSource.updateFilterRules(t),this.refreshRowColCount(),this.stateManager.initCheckedState(this.records),this.scenegraph.createSceneGraph()}getCheckboxState(t){if(this.stateManager.checkedState.size<this.rowCount-this.columnHeaderLevelCount&&this.stateManager.initLeftRecordsCheckState(this.records),ot(t)){let e=Array.from(this.stateManager.checkedState.keys()).sort(((t,e)=>{var i,o;const n=t.split(","),r=e.split(","),s=Math.max(n.length,r.length);for(let t=0;t<s;t++){const e=null!==(i=Number(n[t]))&&void 0!==i?i:0,s=null!==(o=Number(r[t]))&&void 0!==o?o:0;if(e!==s)return e-s}return 0})).map((t=>this.stateManager.checkedState.get(t)));return this.options.groupBy&&(e=function(t){const e=[],i=t.dataSource,o=i.dataConfig.groupByRules.length+1;return i.currentIndexedData.forEach(((n,r)=>{if(ht(n)&&n.length===o){const o=i.getOriginRecordIndexForGroup(n);e[o]=t.stateManager.checkedState.get(n.toString())}})),e}(this)),Array.from(e,(e=>e&&e[t]))}return new Array(...this.stateManager.checkedState.values())}getCellCheckboxState(t,e){var i;const o=this.getBodyColumnDefine(t,e),n=null==o?void 0:o.field,r=this.getCellType(t,e);if(ot(n)&&("checkbox"===r||"switch"===r)){const o=this.dataSource.getIndexKey(this.getRecordShowIndexByCell(t,e)).toString();return null===(i=this.stateManager.checkedState.get(o))||void 0===i?void 0:i[n]}}getRadioState(t){return ot(t)?this.stateManager.radioState[t]:this.stateManager.radioState}getCellRadioState(t,e){return function(t,e,i){var o;const n=i.getBodyColumnDefine(t,e),r=null==n?void 0:n.field,s=i.getCellType(t,e);if(ot(r)&&"radio"===s){const n=i.dataSource.getIndexKey(i.getRecordShowIndexByCell(t,e)),s=null===(o=i.stateManager.radioState)||void 0===o?void 0:o[r];if(ut(s)){if(s===n)return!0}else if(nt(s)){const t=s[n];if(ut(t))return t}}return!1}(t,e,this)}setCellCheckboxState(t,e,i){!function(t,e,i,o){const n=o.scenegraph.getCell(t,e),r=null==n?void 0:n.getChildByName("checkbox");if(!r){const n=o.getHeaderField(t,e);if(o.isHeader(t,e))o.stateManager.setHeaderCheckedState(n,i),"checkbox"===o.getCellType(t,e)&&o.scenegraph.updateCheckboxCellState(t,e,i);else if(o.stateManager.setCheckedState(t,e,n,i),"checkbox"===o.getCellType(t,e)){const i=o.stateManager.headerCheckedState[n],r=o.stateManager.updateHeaderCheckedState(n,t,e);i!==r&&o.scenegraph.updateHeaderCheckboxCellState(t,e,r)}return}const{checked:s,indeterminate:a}=r.attribute;a?(i||r._handlePointerUp(),r._handlePointerUp()):s?i||r._handlePointerUp():i&&r._handlePointerUp()}(t,e,i,this)}setCellRadioState(t,e,i){!function(t,e,i,o){const n=o.scenegraph.getCell(t,e);if(n)if(ut(i)){const t=n.getChildAt(i);null==t||t._handlePointerUp()}else{const t=n.getChildByName("radio");null==t||t._handlePointerUp()}}(t,e,i,this)}getSwitchState(t){return this.getCheckboxState(t)}getCellSwitchState(t,e){return this.getCellCheckboxState(t,e)}setCellSwitchState(t,e,i){this.setCellCheckboxState(t,e,i)}setRecords(t,e){var i,o,n,r;let s;bk(),null===(i=this.internalProps.dataSource)||void 0===i||i.release(),this.internalProps.releaseList=null===(o=this.internalProps.releaseList)||void 0===o?void 0:o.filter((t=>!t.dataSourceObj)),this.internalProps.dataSource=null,Array.isArray(e)||(null==e?void 0:e.order)?s=e:e?s=e.sortState:null===e&&(s=null),"undefined"!=typeof window&&window.performance.now();const a={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};if(this.scenegraph.clearCells(),void 0!==s&&(null===s||!Array.isArray(s)&&ot(s.field)||Array.isArray(s))&&(this.internalProps.sortState=this.internalProps.multipleSort?Array.isArray(s)?s:[s]:s,this.stateManager.setSortState(this.sortState)),t){if(HB(this,t),this.sortState){const t=Array.isArray(this.sortState)?this.sortState:[this.sortState];t.some((t=>t.order&&t.field&&"normal"!==t.order))&&this.internalProps.layoutMap.headerObjectsIncludeHided.some((t=>!1!==t.define.sort))&&this.dataSource.sort(t.map((t=>{const e=this._getSortFuncFromHeaderOption(void 0,t.field);return this.internalProps.layoutMap.headerObjectsIncludeHided.find((e=>e&&e.field===t.field)),{field:t.field,order:t.order||"asc",orderFn:null!=e?e:Zw}})))}this.refreshRowColCount()}else HB(this,t);if(this.stateManager.initCheckedState(t),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(a.col,a.row),this.internalProps.title&&!this.internalProps.title.isReleased&&(this._updateSize(),this.internalProps.title.resize(),this.scenegraph.resize()),this.options.emptyTip)if(this.internalProps.emptyTip)null===(n=this.internalProps.emptyTip)||void 0===n||n.resetVisible();else{const t=a_.getComponent("emptyTip");this.internalProps.emptyTip=new t(this.options.emptyTip,this),null===(r=this.internalProps.emptyTip)||void 0===r||r.resetVisible()}this.render(),ot(a.col)&&ot(a.row)&&a.col>=0&&a.row>=0&&setTimeout((()=>{var t;null===(t=this.internalProps)||void 0===t||t.tooltipHandler.showTooltip(a.col,a.row)}),0)}setRecordChildren(t,e,i){let o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const n=this.getCellOriginRecord(e,i);n.children=t;const r=this.getRecordShowIndexByCell(e,i);this.dataSource.setRecord(n,r),this._refreshHierarchyState(e,i,o)}startEditCell(t,e,i){var o;if(ot(t)&&ot(e))this.eventManager.isDraging=!1,this.selectCell(t,e),this.editorManager.startEditCell(t,e,i);else if(null===(o=this.stateManager.select)||void 0===o?void 0:o.cellPos){const{col:t,row:e}=this.stateManager.select.cellPos;ot(t)&&ot(e)&&this.editorManager.startEditCell(t,e,i)}}completeEditCell(){this.editorManager.completeEdit()}getEditor(t,e){var i,o;const n=this.getBodyColumnDefine(t,e);let r=this.isHeader(t,e)?null!==(i=null==n?void 0:n.headerEditor)&&void 0!==i?i:this.options.headerEditor:null!==(o=null==n?void 0:n.editor)&&void 0!==o?o:this.options.editor;return"function"==typeof r&&(r=r({col:t,row:e,dataValue:this.getCellOriginValue(t,e),value:this.getCellValue(t,e)||"",table:this})),"string"==typeof r?function(t){if(NE[t])return NE[t]}(r):r}isHasEditorDefine(t,e){var i,o;const n=this.getBodyColumnDefine(t,e);let r=this.isHeader(t,e)?null!==(i=null==n?void 0:n.headerEditor)&&void 0!==i?i:this.options.headerEditor:null!==(o=null==n?void 0:n.editor)&&void 0!==o?o:this.options.editor;return"function"==typeof r&&(r=r({col:t,row:e,dataValue:this.getCellOriginValue(t,e),value:this.getCellValue(t,e)||"",table:this})),ot(r)}changeCellValue(t,e,i){return function(t,e,i,o,n,r){if(o&&r.isHasEditorDefine(t,e)||!1===o){const o=r.getRecordShowIndexByCell(t,e),{field:s}=r.internalProps.layoutMap.getBody(t,e),a=r.getCellRawValue(t,e),l=r.getCellOriginValue(t,e);r.isHeader(t,e)?r.internalProps.layoutMap.updateColumnTitle(t,e,i):r.dataSource.changeFieldValue(i,o,s,t,e,r);const h=r.getCellRange(t,e),d=r.internalProps.layoutMap.getAggregatorsByCell(t,e);if(d){if(Array.isArray(d))for(let t=0;t<(null==d?void 0:d.length);t++)d[t].recalculate();else d.recalculate();const t=r.internalProps.layoutMap.getAggregatorCellAddress(h.start.col,h.start.row,h.end.col,h.end.row);for(let e=0;e<t.length;e++){const i=r.getCellRange(t[e].col,t[e].row);for(let t=i.start.col;t<=i.end.col;t++)for(let e=i.start.row;e<=i.end.row;e++)r.scenegraph.updateCellContent(t,e)}}for(let t=h.start.col;t<=h.end.col;t++)for(let e=h.start.row;e<=h.end.row;e++)r.scenegraph.updateCellContent(t,e);if("adaptive"===r.widthMode||r.autoFillWidth&&r.getAllColsWidth()<=r.tableNoFrameWidth)0===r.internalProps._widthResizedColMap.size&&r.scenegraph.recalculateColWidths();else if(!r.internalProps._widthResizedColMap.has(t)){const e=r.getColWidth(t),i=sM(t,0,r.rowCount-1,r,!1);i!==e&&r.scenegraph.updateColWidth(t,i-e)}if("adaptive"===r.heightMode||r.autoFillHeight&&r.getAllRowsHeight()<=r.tableNoFrameHeight)0===r.internalProps._heightResizedRowMap.size&&r.scenegraph.recalculateRowHeights();else if(r.isAutoRowHeight(e)&&!r.internalProps._heightResizedRowMap.has(e)){const t=r.getRowHeight(e),i=AT(e,0,r.colCount-1,r);r.scenegraph.updateRowHeight(e,i-t)}const c=r.getCellOriginValue(t,e);l!==c&&n&&r.fireListeners(Ax.CHANGE_CELL_VALUE,{col:t,row:e,rawValue:a,currentValue:l,changedValue:c}),r.scenegraph.updateNextFrame()}}(t,e,i,arguments.length>3&&void 0!==arguments[3]&&arguments[3],!(arguments.length>4&&void 0!==arguments[4])||arguments[4],this)}changeCellValues(t,e,i){return function(t,e,i,o,n,r){var s,a;let l=t,h=e;const d=[],c=[];let u;for(let o=0;o<i.length&&!(e+o>r.rowCount-1);o++){const n=i[o],s=[],a=[];d.push(s),c.push(a);for(let i=0;i<n.length&&!(t+i>r.colCount-1);i++){u=sF(t+i,e+o,r,u);const n=r.getCellRawValue(t+i,e+o);s.push(n);const l=r.getCellOriginValue(t+i,e+o);a.push(l)}}for(let u=0;u<i.length&&!(e+u>r.rowCount-1);u++){h=e+u;const g=i[u];let p=t;for(let i=0;i<g.length&&!(t+i>r.colCount-1);i++){p=t+i;let l=!1;if(!1===o)l=!0;else if(r.isHasEditorDefine(t+i,e+u)){const o=r.getEditor(t+i,e+u),n=c[u][i],h=g[i],d=null===(a=null===(s=null==o?void 0:o.validateValue)||void 0===s?void 0:s.call(o,h,n))||void 0===a||a;l=!!gx(d)||!0===d||"validate-exit"===d||"invalidate-exit"===d}if(l){const o=g[i],s=r.getRecordShowIndexByCell(t+i,e+u),{field:a}=r.internalProps.layoutMap.getBody(t+i,e+u),l=d[u][i],h=c[u][i];r.isHeader(t+i,e+u)?r.internalProps.layoutMap.updateColumnTitle(t+i,e+u,o):r.dataSource.changeFieldValue(o,s,a,t+i,e+u,r);const p=r.getCellOriginValue(t+i,e+u);h!==p&&n&&r.fireListeners(Ax.CHANGE_CELL_VALUE,{col:t+i,row:e+u,rawValue:l,currentValue:h,changedValue:p})}}l=Math.max(l,p)}const g=r.getCellRange(t,e),p=r.getCellRange(l,h),f=r.internalProps.layoutMap.getAggregatorsByCellRange(g.start.col,g.start.row,p.end.col,p.end.row);if(f){for(let t=0;t<(null==f?void 0:f.length);t++)f[t].recalculate();if("normal"===u){const t=r.internalProps.layoutMap.getAggregatorCellAddress(g.start.col,g.start.row,p.end.col,p.end.row);for(let e=0;e<t.length;e++){const i=r.getCellRange(t[e].col,t[e].row);for(let t=i.start.col;t<=i.end.col;t++)for(let e=i.start.row;e<=i.end.row;e++)r.scenegraph.updateCellContent(t,e)}}}if("group"===u&&r.dataSource.updateRecordsForGroup([],[]),"sort"===u||"group"===u)return r.dataSource.sortedIndexMap.clear(),aF(r),r.refreshRowColCount(),r.internalProps.layoutMap.clearCellRangeMap(),r.scenegraph.clearCells(),void r.scenegraph.createSceneGraph();for(let t=g.start.col;t<=p.end.col;t++)for(let e=g.start.row;e<=p.end.row;e++)r.scenegraph.updateCellContent(t,e);if("adaptive"===r.widthMode||r.autoFillWidth&&r.getAllColsWidth()<=r.tableNoFrameWidth)0===r.internalProps._widthResizedColMap.size&&r.scenegraph.recalculateColWidths();else for(let e=t;e<=p.end.col;e++)if(!r.internalProps._widthResizedColMap.has(e)){const t=r.getColWidth(e),i=sM(e,0,r.rowCount-1,r,!1);i!==t&&r.scenegraph.updateColWidth(e,i-t)}if("adaptive"===r.heightMode||r.autoFillHeight&&r.getAllRowsHeight()<=r.tableNoFrameHeight)r.scenegraph.recalculateRowHeights();else if(r.isAutoRowHeight(e)){const t=[],i=[];for(let o=e;o<=p.end.row;o++)if(r.rowHeightsMap.get(o)){const e=r.getRowHeight(o),n=AT(o,0,r.colCount-1,r);t.push(o),i.push(n-e)}r.scenegraph.updateRowsHeight(t,i)}r.scenegraph.updateNextFrame()}(t,e,i,arguments.length>3&&void 0!==arguments[3]&&arguments[3],!(arguments.length>4&&void 0!==arguments[4])||arguments[4],this)}addRecord(t,e){var i;(function(t,e,i){var o,n,r,s;if(i.options.groupBy)null===(n=(o=i.dataSource).addRecordsForGroup)||void 0===n||n.call(o,[t],e),i.refreshRowColCount(),i.internalProps.layoutMap.clearCellRangeMap(),i.sortState&&aF(i),i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else if("tree"===i.dataSource.rowHierarchyType)null===(s=(r=i.dataSource).addRecordsForTree)||void 0===s||s.call(r,[t],e),i.refreshRowColCount(),i.internalProps.layoutMap.clearCellRangeMap(),i.sortState&&aF(i),i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else if(i.sortState)i.dataSource.addRecordForSorted(t),aF(i),i.refreshRowColCount(),i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else{(void 0===e||e>i.dataSource.sourceLength)&&(e=i.dataSource.sourceLength);const o=i.transpose?i.rowHeaderLevelCount:i.columnHeaderLevelCount;i.dataSource.addRecord(t,e);const n=i.rowCount;if(i.refreshRowColCount(),0===i.scenegraph.proxy.totalActualBodyRowCount)return i.scenegraph.clearCells(),void i.scenegraph.createSceneGraph();const r=i.transpose?i.colCount:i.rowCount;if(i.pagination){const{perPageCount:t,currentPage:s}=i.pagination,a=t*(s||0)+t;if(e<a)if(e<a-t)i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else{const s=e-(a-t)+o;if(n-o===i.pagination.perPageCount){const t=[];for(let e=s;e<r;e++)i.transpose?t.push({col:e,row:0}):t.push({col:0,row:e});i.transpose?i.scenegraph.updateCol([],[],t):i.scenegraph.updateRow([],[],t)}else{const t=[];for(let e=s;e<Math.min(r,s+1);e++)i.transpose?t.push({col:e,row:0}):t.push({col:0,row:e});i.transpose?i.scenegraph.updateCol([],t,[]):i.scenegraph.updateRow([],t,[])}}}else{const t=[];for(let n=e+o;n<e+o+1;n++)i.transpose?t.push({col:n,row:0}):t.push({col:0,row:n});const n=[],r=i.internalProps.layoutMap.hasAggregationOnTopCount,s=i.internalProps.layoutMap.hasAggregationOnBottomCount;for(let t=o;t<o+r;t++)i.transpose?n.push({col:t,row:0}):n.push({col:0,row:t});for(let t=(i.transpose?i.colCount:i.rowCount)-s;t<(i.transpose?i.colCount:i.rowCount);t++)i.transpose?n.push({col:t,row:0}):n.push({col:0,row:t});i.transpose?i.scenegraph.updateCol([],t,[]):i.scenegraph.updateRow([],t,[])}}})(t,e,this),null===(i=this.internalProps.emptyTip)||void 0===i||i.resetVisible()}addRecords(t,e){var i;(function(t,e,i){var o,n,r,s;if(i.options.groupBy)null===(n=(o=i.dataSource).addRecordsForGroup)||void 0===n||n.call(o,t,e),i.refreshRowColCount(),i.internalProps.layoutMap.clearCellRangeMap(),i.sortState&&aF(i),i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else if("tree"===i.dataSource.rowHierarchyType)null===(s=(r=i.dataSource).addRecordsForTree)||void 0===s||s.call(r,t,e),i.refreshRowColCount(),i.internalProps.layoutMap.clearCellRangeMap(),i.sortState&&aF(i),i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else if(i.sortState)i.dataSource.addRecordsForSorted(t),aF(i),i.refreshRowColCount(),i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else{void 0===e||e>i.dataSource.sourceLength?e=i.dataSource.sourceLength:e<0&&(e=0);const o=i.transpose?i.rowHeaderLevelCount:i.columnHeaderLevelCount;i.dataSource.addRecords(t,e);const n=i.transpose?i.colCount:i.rowCount;if(i.refreshRowColCount(),0===i.scenegraph.proxy.totalActualBodyRowCount)return i.scenegraph.clearCells(),void i.scenegraph.createSceneGraph();const r=i.transpose?i.colCount:i.rowCount;if(i.pagination){const{perPageCount:s,currentPage:a}=i.pagination,l=s*(a||0)+s;if(e<l)if(e<l-s)i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else{const a=e-(l-s)+o;if(n-o===i.pagination.perPageCount){const t=[];for(let e=a;e<r;e++)i.transpose?t.push({col:e,row:0}):t.push({col:0,row:e});i.transpose?i.scenegraph.updateCol([],[],t):i.scenegraph.updateRow([],[],t)}else{const e=[];for(let o=a;o<Math.min(r,a+(Array.isArray(t)?t.length:1));o++)i.transpose?e.push({col:o,row:0}):e.push({col:0,row:o});i.transpose?i.scenegraph.updateCol([],e,[]):i.scenegraph.updateRow([],e,[])}}}else{const n=[];for(let r=e+o;r<e+o+(Array.isArray(t)?t.length:1);r++)i.transpose?n.push({col:r,row:0}):n.push({col:0,row:r});const r=i.internalProps.layoutMap.hasAggregationOnTopCount,s=i.internalProps.layoutMap.hasAggregationOnBottomCount,a=[];for(let t=o;t<o+r;t++)i.transpose?a.push({col:t,row:0}):a.push({col:0,row:t});for(let t=(i.transpose?i.colCount:i.rowCount)-s;t<(i.transpose?i.colCount:i.rowCount);t++)i.transpose?a.push({col:t,row:0}):a.push({col:0,row:t});i.transpose?i.scenegraph.updateCol([],n,a):i.scenegraph.updateRow([],n,a)}}})(t,e,this),null===(i=this.internalProps.emptyTip)||void 0===i||i.resetVisible()}deleteRecords(t){var e;(function(t,e){var i,o,n,r,s,a,l,h;if((null==t?void 0:t.length)>0)if(e.options.groupBy)null===(o=(i=e.dataSource).deleteRecordsForGroup)||void 0===o||o.call(i,t),e.refreshRowColCount(),e.internalProps.layoutMap.clearCellRangeMap(),e.sortState&&aF(e),e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else if("tree"===e.dataSource.rowHierarchyType)null===(r=(n=e.dataSource).deleteRecordsForTree)||void 0===r||r.call(n,t),e.refreshRowColCount(),e.internalProps.layoutMap.clearCellRangeMap(),e.sortState&&aF(e),e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else if(e.sortState)e.dataSource.deleteRecordsForSorted(t),aF(e),e.refreshRowColCount(),e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else{const i=e.dataSource.deleteRecords(t);if(0===i.length)return;const o=e.transpose?e.colCount:e.rowCount;e.refreshRowColCount();const n=e.transpose?e.colCount:e.rowCount,r=i.sort(((t,e)=>t-e)),d=r[0];if(e.pagination){const{perPageCount:t,currentPage:i}=e.pagination,r=t*(i||0)+t;if(d<r)if(d<r-t)e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else{const i=e.transpose?e.rowHeaderLevelCount:e.columnHeaderLevelCount,l=e.internalProps.layoutMap.hasAggregationOnTopCount,h=[],c=[];for(let i=d-(r-t)+(e.transpose?e.rowHeaderLevelCount:e.columnHeaderLevelCount)+l;i<n;i++)e.transpose?h.push({col:i,row:0}):h.push({col:0,row:i});for(let t=i;t<i+l;t++)e.transpose?h.push({col:t,row:0}):h.push({col:0,row:t});if(n<o)for(let t=n;t<o;t++)e.transpose?c.push({col:t,row:0}):c.push({col:0,row:t});null===(s=e.reactCustomLayout)||void 0===s||s.clearCache(),e.transpose?e.scenegraph.updateCol(c,[],h):e.scenegraph.updateRow(c,[],h),null===(a=e.reactCustomLayout)||void 0===a||a.updateAllCustomCell()}}else{const t=[],i=e.transpose?e.rowHeaderLevelCount:e.columnHeaderLevelCount,o=e.internalProps.layoutMap.hasAggregationOnTopCount,n=e.internalProps.layoutMap.hasAggregationOnBottomCount;for(let n=0;n<r.length;n++){const s=r[n]+i+o;e.transpose?t.push({col:s,row:0}):t.push({col:0,row:s})}const s=[];for(let t=i;t<i+o;t++)e.transpose?s.push({col:t,row:0}):s.push({col:0,row:t});for(let t=(e.transpose?e.colCount:e.rowCount)-n;t<(e.transpose?e.colCount:e.rowCount);t++)e.transpose?s.push({col:t,row:0}):s.push({col:0,row:t});null===(l=e.reactCustomLayout)||void 0===l||l.clearCache(),e.transpose?e.scenegraph.updateCol(t,[],s):e.scenegraph.updateRow(t,[],s),null===(h=e.reactCustomLayout)||void 0===h||h.updateAllCustomCell()}}})(t,this),null===(e=this.internalProps.emptyTip)||void 0===e||e.resetVisible()}updateRecords(t,e){!function(t,e,i){var o,n,r,s;if((null==e?void 0:e.length)>0)if(i.options.groupBy)null===(n=(o=i.dataSource).updateRecordsForGroup)||void 0===n||n.call(o,t,e),i.refreshRowColCount(),i.internalProps.layoutMap.clearCellRangeMap(),i.sortState&&aF(i),i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else if("tree"===i.dataSource.rowHierarchyType)null===(s=(r=i.dataSource).updateRecordsForTree)||void 0===s||s.call(r,t,e),i.refreshRowColCount(),i.internalProps.layoutMap.clearCellRangeMap(),i.sortState&&aF(i),i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else if(i.sortState)i.dataSource.updateRecordsForSorted(t,e),aF(i),i.refreshRowColCount(),i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else{const o=i.dataSource.updateRecords(t,e);if(0===o.length)return;const n=o.map((t=>i.getBodyRowIndexByRecordIndex(t))).sort(((t,e)=>t-e));if(i.pagination){const{perPageCount:t,currentPage:e}=i.pagination,o=i.transpose?i.rowHeaderLevelCount:i.columnHeaderLevelCount,r=i.internalProps.layoutMap.hasAggregationOnTopCount,s=t*(e||0)+t,a=[];for(let e=0;e<n.length;e++){const o=n[e];if(o<s&&o>=s-t){const e=o-(s-t)+(i.transpose?i.rowHeaderLevelCount:i.columnHeaderLevelCount)+r;a.push(e)}}if(a.length>=1){const t=[];for(let e=0;e<a.length;e++){const o=a[e];i.transpose?t.push({col:o,row:0}):t.push({col:0,row:o})}for(let e=o;e<o+r;e++)i.transpose?t.push({col:e,row:0}):t.push({col:0,row:e});i.transpose?i.scenegraph.updateCol([],[],t):i.scenegraph.updateRow([],[],t)}}else{const t=[],e=i.transpose?i.rowHeaderLevelCount:i.columnHeaderLevelCount,o=i.internalProps.layoutMap.hasAggregationOnTopCount,r=i.internalProps.layoutMap.hasAggregationOnBottomCount;for(let r=0;r<n.length;r++){const s=n[r]+e+o;i.transpose?t.push({col:s,row:0}):t.push({col:0,row:s})}for(let n=e;n<e+o;n++)i.transpose?t.push({col:n,row:0}):t.push({col:0,row:n});for(let e=(i.transpose?i.colCount:i.rowCount)-r;e<(i.transpose?i.colCount:i.rowCount);e++)i.transpose?t.push({col:e,row:0}):t.push({col:0,row:e});i.transpose?i.scenegraph.updateCol([],[],t):i.scenegraph.updateRow([],[],t)}}}(t,e,this)}_hasCustomRenderOrLayout(){var t,e,i,o;const{headerObjects:n}=this.internalProps.layoutMap;if(this.options.customRender)return!0;for(let r=0;r<n.length;r++){const s=n[r];if((null===(t=null==s?void 0:s.define)||void 0===t?void 0:t.customLayout)||(null===(e=null==s?void 0:s.define)||void 0===e?void 0:e.headerCustomLayout)||(null===(i=null==s?void 0:s.define)||void 0===i?void 0:i.customRender)||(null===(o=null==s?void 0:s.define)||void 0===o?void 0:o.headerCustomRender))return!0}return!1}getAggregateValuesByField(t){const e=this.internalProps.layoutMap.getColumnByField(t),i=[];for(let t=0;t<e.length;t++){const o=e[t].columnDefine.aggregator;if(delete e[t].columnDefine,o){const n={col:e[t].col,aggregateValue:null};if(n.aggregateValue=[],Array.isArray(o))for(let t=0;t<o.length;t++)n.aggregateValue.push({aggregationType:o[t].type,value:o[t].value()});else n.aggregateValue.push({aggregationType:o.type,value:o.value()});i.push(n)}}return i}isAggregation(t,e){return this.internalProps.layoutMap.isAggregation(t,e)}getGroupTitleLevel(t,e){var i;if(!this.options.groupBy)return;const o=this.dataSource.getIndexKey(this.getRecordShowIndexByCell(t,e)),n=null!==(i=this.dataSource.getGroupLength())&&void 0!==i?i:0;let r=ht(o)?o.length-1:0;return n>0&&r===n&&(r=void 0),r}getBodyRowIndexByRecordIndex(t){return Array.isArray(t)&&1===t.length&&(t=t[0]),this.dataSource.getTableIndex(t)}_parseColumnWidthConfig(t){for(let e=0;e<(null==t?void 0:t.length);e++){const i=t[e],o=i.key,n=i.width,r=this.internalProps.layoutMap.getColumnByKey(o);if(r.columnDefine){const{col:t}=r;this.internalProps._widthResizedColMap.has(t)||(this._setColWidth(t,n),this.internalProps._widthResizedColMap.add(t))}}}release(){this.editorManager.release(),super.release()}}function hF(t){return"bottom"===t||"top"===t}var dF;function cF(t){return t}!function(t){t.Identity="identity",t.Linear="linear",t.Log="log",t.Pow="pow",t.Sqrt="sqrt",t.Symlog="symlog",t.Time="time",t.Quantile="quantile",t.Quantize="quantize",t.Threshold="threshold",t.Ordinal="ordinal",t.Point="point",t.Band="band"}(dF||(dF={})),Object.values(dF).forEach((t=>{}));const uF=t=>-Math.log(-t),gF=t=>-Math.exp(-t),pF=t=>isFinite(t)?Math.pow(10,t):t<0?0:t,fF=t=>10===t?pF:t===Math.E?Math.exp:e=>Math.pow(t,e),vF=t=>t===Math.E?Math.log:10===t?Math.log10:2===t?Math.log2:(t=Math.log(t),e=>Math.log(e)/t),bF=t=>e=>Math.sign(e)*Math.log1p(Math.abs(e/t)),mF=t=>e=>Math.sign(e)*Math.expm1(Math.abs(e))*t;function yF(t,e){if(t=Number(t),e=Number(e),e-=t)return i=>(i-t)/e;const i=Number.isNaN(e)?NaN:.5;return()=>i}function CF(t,e,i){const o=t[0],n=t[1],r=e[0],s=e[1];let a,l;return n<o?(a=yF(n,o),l=i(s,r)):(a=yF(o,n),l=i(r,s)),t=>l(a(t))}function wF(t,e,i){let o;return o=1===t?t+2*i:t-e+2*i,t?o>0?o:1:0}function xF(t,e){const i=(t[1]-t[0])/(e[1]-e[0]),o=t[0]-i*e[0];return[o,i+o]}function _F(t,e,i){const o=Math.min(t.length,e.length)-1,n=new Array(o),r=new Array(o);let s=-1;for(t[o]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++s<o;)n[s]=yF(t[s],t[s+1]),r[s]=i(e[s],e[s+1]);return function(e){const i=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0;for(YE(o)&&(o=t.length);i<o;){const n=i+o>>>1;hH(t[n],e)>0?o=n:i=n+1}return i}(t,e,1,o)-1;return r[i](n[i](e))}}const SF=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=Math.floor(Math.log10(t)),o=t/Math.pow(10,i);let n;return n=e?o<1.5?1:o<3?2:o<7?5:10:o<=1?1:o<=2?2:o<=5?5:10,n*Math.pow(10,i)};class AF{constructor(){this._rangeFactorStart=null,this._rangeFactorEnd=null}_calculateWholeRange(t){return this._wholeRange?this._wholeRange:KE(this._rangeFactorStart)&&KE(this._rangeFactorEnd)&&2===t.length?(this._wholeRange=xF(t,[this._rangeFactorStart,this._rangeFactorEnd]),this._wholeRange):t}rangeFactor(t,e,i){return t?(2===t.length&&t.every((t=>t>=0&&t<=1))&&(this._wholeRange=null,0===t[0]&&1===t[1]?(this._rangeFactorStart=null,this._rangeFactorEnd=null):(this._rangeFactorStart=t[0],this._rangeFactorEnd=t[1])),this):i?(this._wholeRange=null,this._rangeFactorStart=null,this._rangeFactorEnd=null,this):KE(this._rangeFactorStart)&&KE(this._rangeFactorEnd)?[this._rangeFactorStart,this._rangeFactorEnd]:null}rangeFactorStart(t,e){var i;return YE(t)?this._rangeFactorStart:(t>=0&&t<=1&&(this._wholeRange=null,0!==t||!YE(this._rangeFactorEnd)&&1!==this._rangeFactorEnd?(this._rangeFactorStart=t,this._rangeFactorEnd=null!==(i=this._rangeFactorEnd)&&void 0!==i?i:1):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}rangeFactorEnd(t,e){var i;return YE(t)?this._rangeFactorEnd:(t>=0&&t<=1&&(this._wholeRange=null,0!==t||!YE(this._rangeFactorStart)&&0!==this._rangeFactorStart?(this._rangeFactorEnd=t,this._rangeFactorStart=null!==(i=this._rangeFactorStart)&&void 0!==i?i:0):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}generateFishEyeTransform(){var t;if(!this._fishEyeOptions)return void(this._fishEyeTransform=null);const{distortion:e=2,radiusRatio:i=.1,radius:o}=this._fishEyeOptions,n=this.range(),r=n[0],s=n[n.length-1],a=Math.min(r,s),l=Math.max(r,s),h=wH(null!==(t=this._fishEyeOptions.focus)&&void 0!==t?t:0,a,l),d=YE(o)?(l-a)*i:o;let c=Math.exp(e);c=c/(c-1)*d;const u=e/d;this._fishEyeTransform=t=>{const e=Math.abs(t-h);if(e>=d)return t;if(e<=1e-6)return h;const i=c*(1-Math.exp(-e*u))/e*.75+.25;return h+(t-h)*i}}unknown(t){return arguments.length?(this._unknown=t,this):this._unknown}get(t,e){var i;return null!==(i=null==this?void 0:this[t])&&void 0!==i?i:e}}const BF=Symbol("implicit");class RF extends AF{specified(t){var e;return t?(this._specified=Object.assign(null!==(e=this._specified)&&void 0!==e?e:{},t),this):Object.assign({},this._specified)}_getSpecifiedValue(t){if(this._specified)return this._specified[t]}constructor(){super(),this.type=dF.Ordinal,this._index=new Map,this._domain=[],this._ordinalRange=[],this._unknown=BF}clone(){const t=(new RF).domain(this._domain).range(this._ordinalRange).unknown(this._unknown);return this._specified&&t.specified(this._specified),t}calculateVisibleDomain(t){return KE(this._rangeFactorStart)&&KE(this._rangeFactorEnd)&&2===t.length?[this.invert(t[0]),this.invert(t[1])]:this._domain}scale(t){const e=`${t}`,i=this._getSpecifiedValue(e);if(void 0!==i)return i;let o=this._index.get(e);if(!o){if(this._unknown!==BF)return this._unknown;o=this._domain.push(t),this._index.set(e,o)}const n=this._ordinalRange[(o-1)%this._ordinalRange.length];return this._fishEyeTransform?this._fishEyeTransform(n):n}invert(t){let e=0;for(;e<this._ordinalRange.length&&this._ordinalRange[e]!==t;)e++;return this._domain[(e-1)%this._domain.length]}domain(t){if(!t)return this._domain.slice();this._domain=[],this._index=new Map;for(const e of t){const t=`${e}`;this._index.has(t)||this._index.set(t,this._domain.push(e))}return this}range(t){if(!t)return this._ordinalRange.slice();const e=Array.from(t);return this._ordinalRange=e,this}index(t){var e;return this._index&&null!==(e=this._index.get(`${t}`))&&void 0!==e?e:-1}}function TF(t,e,i,o){const n=[];let r=t;for(;r<=e;)n.push(r),r+=i;return o&&n.reverse(),n}function kF(t,e,i,o){let n,r;if(e=Math.floor(+e),t=Math.floor(+t),!(i=Math.floor(+i)))return[];if(t===e)return[t];if(n=e<t){const i=t;t=e,e=i}let s=xH(1,e-t+1)(i);if(r=Math.floor((e-t+1)/s),!o)for(;Math.ceil((e-t+1)/r)>i&&s>1;)s-=1,r=Math.floor((e-t)/s);return TF(t,e,r,n)}class MF extends RF{constructor(t){super(),this.type=dF.Band,this._range=[0,1],this._step=void 0,this._bandwidth=void 0,this._isFixed=!1,this._round=!1,this._paddingInner=0,this._paddingOuter=0,this._align=.5,this._unknown=void 0,delete this.unknown,this.rescale(t)}rescale(t,e){if(t)return this;this._wholeRange=null;const i=this._calculateWholeRange(this._range,e),o=super.domain().length,n=i[1]<i[0];let r=i[Number(n)-0];const s=i[1-Number(n)],a=wF(o,this._paddingInner,this._paddingOuter);return this._step=(s-r)/Math.max(1,a||1),this._round&&(this._step=Math.floor(this._step)),r+=(s-r-this._step*(o-this._paddingInner))*this._align,this.isBandwidthFixed()||(this._bandwidth=this._step*(1-this._paddingInner)),this._round&&(r=Math.round(r),this.isBandwidthFixed()||(this._bandwidth=Math.round(this._bandwidth))),this._bandRangeState={reverse:n,start:n?r+this._step*(o-1):r,count:o},this.generateFishEyeTransform(),this}scale(t){if(!this._bandRangeState)return;const e=`${t}`,i=this._getSpecifiedValue(e);if(void 0!==i)return i;let o=this._index.get(e);if(!o){if(this._unknown!==BF)return this._unknown;o=this._domain.push(t),this._index.set(e,o)}const{count:n,start:r,reverse:s}=this._bandRangeState,a=r+(o-1)%n*(s?-1:1)*this._step;return this._fishEyeTransform?this._fishEyeTransform(a):a}_calculateWholeRange(t,e){if(this._wholeRange)return this._wholeRange;if((this._minBandwidth||this._maxBandwidth)&&!this._isBandwidthFixedByUser()){let e;if(KE(this._rangeFactorStart)&&KE(this._rangeFactorEnd)&&2===t.length){const i=xF(t,[this._rangeFactorStart,this._rangeFactorEnd]);e=Math.abs(i[1]-i[0])}else e=Math.abs(t[1]-t[0]);const i=function(t,e,i,o,n){const r=wF(t,i,o);let s=e/Math.max(1,r||1);n&&(s=Math.floor(s));let a=s*(1-i);return n&&(a=Math.round(a)),a}(super.domain().length,e,this._paddingInner,this._paddingOuter,this._round);i<this._minBandwidth?(this._bandwidth=this._minBandwidth,this._isFixed=!0):i>this._maxBandwidth?(this._bandwidth=this._maxBandwidth,this._isFixed=!0):(this._bandwidth=i,this._isFixed=!1)}if(this.isBandwidthFixed()){const s=(i=super.domain().length,o=this._bandwidth,n=this._paddingInner,r=this._paddingOuter,1===n&&(n=0),wF(i,n,r)*(o/(1-n))*Math.sign(t[1]-t[0])),a=Math.min((t[1]-t[0])/s,1);if(KE(this._rangeFactorStart)&&KE(this._rangeFactorEnd)){if(s>0){const e=t[0]-s*this._rangeFactorStart,i=e+s;this._wholeRange=[e,i]}else{const e=t[1]+s*(1-this._rangeFactorEnd),i=e-s;this._wholeRange=[i,e]}const i=this._rangeFactorStart+a<=1,o=this._rangeFactorEnd-a>=0;"rangeFactorStart"===e&&i?this._rangeFactorEnd=this._rangeFactorStart+a:"rangeFactorEnd"===e&&o?this._rangeFactorStart=this._rangeFactorEnd-a:t[0]<=t[1]?i?this._rangeFactorEnd=this._rangeFactorStart+a:o?this._rangeFactorStart=this._rangeFactorEnd-a:(this._rangeFactorStart=0,this._rangeFactorEnd=a):o?this._rangeFactorStart=this._rangeFactorEnd-a:i?this._rangeFactorEnd=this._rangeFactorStart+a:(this._rangeFactorStart=1-a,this._rangeFactorEnd=1)}else this._rangeFactorStart=0,this._rangeFactorEnd=a,this._wholeRange=[t[0],t[0]+s];return this._wholeRange}var i,o,n,r;return super._calculateWholeRange(t)}calculateWholeRangeSize(){const t=this._calculateWholeRange(this._range);return Math.abs(t[1]-t[0])}calculateVisibleDomain(t){const e=this._domain;if(KE(this._rangeFactorStart)&&KE(this._rangeFactorEnd)&&e.length){const i=this._getInvertIndex(t[0]),o=this._getInvertIndex(t[1]);return e.slice(Math.min(i,o),Math.max(i,o)+1)}return e}domain(t,e){return t?(super.domain(t),this.rescale(e)):super.domain()}range(t,e){return t?(this._range=[dH(t[0]),dH(t[1])],this.rescale(e)):this._range}rangeRound(t,e){return this._range=[dH(t[0]),dH(t[1])],this._round=!0,this.rescale(e)}ticks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return-1===t?e:kF(0,e.length-1,t,!1).map((t=>e[t]))}tickData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return this.ticks(t).map(((t,e)=>({index:e,tick:t,value:(this.scale(t)-this._range[0]+this._bandwidth/2)/(this._range[1]-this._range[0])})))}forceTicks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return kF(0,e.length-1,t,!0).filter((t=>t<e.length)).map((t=>e[t]))}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return function(t,e,i){let o;if(i=xH(1,(e=Math.floor(+e))-(t=Math.floor(+t))+1)(Math.floor(+i)),o=e<t){const i=t;t=e,e=i}return TF(t,e,i,o)}(0,e.length-1,t).map((t=>e[t]))}_getInvertIndex(t){let e=0;const i=this.step()/2,o=this.bandwidth()/2,n=this._domain.length,r=this.range(),s=r[0]>r[r.length-1];for(e=0;e<n;e++){const r=this.scale(this._domain[e])+o;if(0===e&&(!s&&!mH(t,r+i)||s&&!yH(t,r-i)))break;if(e===n-1)break;if(!yH(t,r-i)&&!mH(t,r+i))break}return e>=0&&e<=n-1?e:n-1}invert(t){return this._domain[this._getInvertIndex(t)]}padding(t,e){return void 0!==t?(this._paddingOuter=Math.max(0,Math.min(Array.isArray(t)?Math.min.apply(null,t):t)),this._paddingInner=this._paddingOuter,this.rescale(e)):this._paddingInner}paddingInner(t,e){return void 0!==t?(this._paddingInner=Math.max(0,Math.min(1,t)),this.rescale(e)):this._paddingInner}paddingOuter(t,e){return void 0!==t?(this._paddingOuter=Math.max(0,Math.min(1,t)),this.rescale(e)):this._paddingOuter}step(){return this._step}round(t,e){return void 0!==t?(this._round=t,this.rescale(e)):this._round}align(t,e){return void 0!==t?(this._align=Math.max(0,Math.min(1,t)),this.rescale(e)):this._align}rangeFactor(t,e){return t?(super.rangeFactor(t),this.rescale(e)):super.rangeFactor()}rangeFactorStart(t,e){return YE(t)?super.rangeFactorStart():(super.rangeFactorStart(t),this.rescale(e,"rangeFactorStart"))}rangeFactorEnd(t,e){return YE(t)?super.rangeFactorEnd():(super.rangeFactorEnd(t),this.rescale(e,"rangeFactorEnd"))}bandwidth(t,e){return t?("auto"===t?(this._bandwidth=void 0,this._isFixed=!1):(this._bandwidth=t,this._isFixed=!0),this._userBandwidth=t,this.rescale(e)):this._bandwidth}maxBandwidth(t,e){return t?(this._maxBandwidth="auto"===t?void 0:t,this.rescale(e)):this._maxBandwidth}minBandwidth(t,e){return t?(this._minBandwidth="auto"===t?void 0:t,this.rescale(e)):this._minBandwidth}fishEye(t,e,i){return t||i?(this._fishEyeOptions=t,this._fishEyeTransform=null,this.rescale(e)):this._fishEyeOptions}isBandwidthFixed(){return this._isFixed&&!!this._bandwidth}_isBandwidthFixedByUser(){return this._isFixed&&this._userBandwidth&&iH(this._userBandwidth)}clone(){var t,e,i;return new MF(!0).domain(this._domain,!0).range(this._range,!0).round(this._round,!0).paddingInner(this._paddingInner,!0).paddingOuter(this._paddingOuter,!0).align(this._align,!0).bandwidth(null!==(t=this._userBandwidth)&&void 0!==t?t:"auto",!0).maxBandwidth(null!==(e=this._maxBandwidth)&&void 0!==e?e:"auto",!0).minBandwidth(null!==(i=this._maxBandwidth)&&void 0!==i?i:"auto")}}const{interpolateRgb:LF}=IH;function PF(t,e){const i=typeof e;let o;if(YE(e)||"boolean"===i)return()=>e;if("number"===i)return _H(t,e);if("string"===i){if(o=FH.parseColorString(e)){const e=LF(FH.parseColorString(t),o);return t=>e(t).formatRgb()}return _H(Number(t),Number(e))}return e instanceof OH?LF(t,e):e instanceof FH?LF(t.color,e.color):e instanceof Date?function(t,e){const i=t.valueOf(),o=e.valueOf(),n=new Date;return t=>(n.setTime(i*(1-t)+o*t),n)}(t,e):_H(Number(t),Number(e))}class EF extends AF{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:cF,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:cF;super(),this._unknown=void 0,this.transformer=t,this.untransformer=e,this._forceAlign=!0,this._domain=[0,1],this._range=[0,1],this._clamp=cF,this._piecewise=CF,this._interpolate=PF}calculateVisibleDomain(t){var e;return KE(this._rangeFactorStart)&&KE(this._rangeFactorEnd)&&2===t.length?[this.invert(t[0]),this.invert(t[1])]:null!==(e=this._niceDomain)&&void 0!==e?e:this._domain}fishEye(t,e,i){return t||i?(this._fishEyeOptions=t,this._fishEyeTransform=null,this.rescale(e)):this._fishEyeOptions}scale(t){var e;if(t=Number(t),Number.isNaN(t)||this._domainValidator&&!this._domainValidator(t))return this._unknown;this._output||(this._output=this._piecewise((null!==(e=this._niceDomain)&&void 0!==e?e:this._domain).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const i=this._output(this.transformer(this._clamp(t)));return this._fishEyeTransform?this._fishEyeTransform(i):i}invert(t){var e;return this._input||(this._input=this._piecewise(this._calculateWholeRange(this._range),(null!==(e=this._niceDomain)&&void 0!==e?e:this._domain).map(this.transformer),_H)),this._clamp(this.untransformer(this._input(t)))}domain(t,e){var i;if(!t)return(null!==(i=this._niceDomain)&&void 0!==i?i:this._domain).slice();this._domainValidator=null,this._niceType=null,this._niceDomain=null;const o=Array.from(t,dH);return this._domain=o,this.rescale(e)}range(t,e){if(!t)return this._range.slice();const i=Array.from(t);return this._range=i,this.rescale(e)}rangeRound(t,e){const i=Array.from(t);return this._range=i,this._interpolate=SH,this.rescale(e)}rescale(t){var e;if(t)return this;const i=null!==(e=this._niceDomain)&&void 0!==e?e:this._domain,o=i.length,n=this._range.length;let r=Math.min(o,n);if(o&&o<n&&this._forceAlign){const t=n-o+1,e=i[o-1],s=o>=2?(e-i[o-2])/t:0;for(let n=1;n<=t;n++)i[o-2+n]=e-s*(t-n);r=n}return this._autoClamp&&(this._clamp=xH(i[0],i[r-1])),this._piecewise=r>2?_F:CF,this._output=this._input=null,this._wholeRange=null,this.generateFishEyeTransform(),this}clamp(t,e,i){return arguments.length?(e?(this._autoClamp=!1,this._clamp=e):(this._autoClamp=!!t,this._clamp=t?void 0:cF),this.rescale(i)):this._clamp!==cF}interpolate(t,e){return arguments.length?(this._interpolate=t,this.rescale(e)):this._interpolate}ticks(){return[]}tickData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.ticks(t);return(null!=e?e:[]).map(((t,e)=>({index:e,tick:t,value:(this.scale(t)-this._range[0])/(this._range[1]-this._range[0])})))}rangeFactor(t,e){return t?(super.rangeFactor(t),this._output=this._input=null,this):super.rangeFactor()}rangeFactorStart(t,e){return YE(t)?super.rangeFactorStart():(super.rangeFactorStart(t),this._output=this._input=null,this)}rangeFactorEnd(t,e){return YE(t)?super.rangeFactorEnd():(super.rangeFactorEnd(t),this._output=this._input=null,this)}forceAlignDomainRange(t){return arguments.length?(this._forceAlign=t,this):this._forceAlign}}const HF=Math.sqrt(50),FF=Math.sqrt(10),OF=Math.sqrt(2),IF=[1,2,5,10],zF=(t,e,i)=>{let o=1,n=t;const r=Math.floor((e-1)/2),s=Math.abs(t);return t>=0&&t<=Number.MIN_VALUE?n=0:t<0&&t>=-Number.MIN_VALUE?n=-(e-1):!i&&s<1?o=GF(s).step:(i||s>1)&&(n=Math.floor(t)-r*o),o>0?(t>0?n=Math.max(n,0):t<0&&(n=Math.min(n,-(e-1)*o)),function(t,e,i){KE(e)||(e=t,t=0),KE(i)||(i=1);let o=-1;const n=0|Math.max(0,Math.ceil((e-t)/i)),r=new Array(n);for(;++o<n;)r[o]=t+o*i;return r}(0,e).map((t=>n+t*o))):t>0?WF(0,-(e-1)/o,o):WF((e-1)/o,0,o)},DF=CH(((t,e,i,o)=>{let n,r,s,a,l=-1;if(i=+i,(t=+t)==(e=+e))return[t];if(Math.abs(t-e)<=Number.MIN_VALUE&&i>0)return[t];if((n=e<t)&&(r=t,t=e,e=r),a=jF(t,e,i).step,!isFinite(a))return[];if(a>0){let i=Math.round(t/a),o=Math.round(e/a);for(i*a<t&&++i,o*a>e&&--o,s=new Array(r=o-i+1);++l<r;)s[l]=(i+l)*a}else if(a<0&&(null==o?void 0:o.noDecimals)){a=1;const i=Math.ceil(t),o=Math.floor(e);if(!(i<=o))return[];for(s=new Array(r=o-i+1);++l<r;)s[l]=i+l}else{a=-a;let i=Math.round(t*a),o=Math.round(e*a);for(i/a<t&&++i,o/a>e&&--o,s=new Array(r=o-i+1);++l<r;)s[l]=(i+l)/a}return n&&s.reverse(),s})),WF=(t,e,i)=>{let o,n,r=-1;if(i>0){let s=Math.floor(t/i),a=Math.ceil(e/i);for((s+1)*i<t&&++s,(a-1)*i>e&&--a,n=new Array(o=a-s+1);++r<o;)n[r]=(s+r)*i}else{i=-i;let s=Math.floor(t*i),a=Math.ceil(e*i);for((s+1)/i<t&&++s,(a-1)/i>e&&--a,n=new Array(o=a-s+1);++r<o;)n[r]=(s+r)/i}return n},NF=CH(((t,e,i,o)=>{let n,r,s;if(i=+i,(t=+t)==(e=+e))return zF(t,i,null==o?void 0:o.noDecimals);if(Math.abs(t-e)<=Number.MIN_VALUE&&i>0)return zF(t,i,null==o?void 0:o.noDecimals);(n=e<t)&&(s=t,t=e,e=s);const a=jF(t,e,i);let l=a.step;if(!isFinite(l))return[];if(l>0){let o=1;const{power:n,gap:s}=a,h=10===s?2*10**n:1*10**n;for(;o<=5&&(r=WF(t,e,l),r.length>i+1)&&i>2;)l+=h,o+=1;i>2&&r.length<i-1&&(r=((t,e,i)=>{let o;const n=t[0],r=t[t.length-1],s=e-t.length;if(r<=0){const e=[];for(o=s;o>=1;o--)e.push(n-o*i);return e.concat(t)}if(n>=0){for(o=1;o<=s;o++)t.push(r+o*i);return t}let a=[];const l=[];for(o=1;o<=s;o++)o%2==0?a=[n-Math.floor(o/2)*i].concat(a):l.push(r+Math.ceil(o/2)*i);return a.concat(t).concat(l)})(r,i,l))}else(null==o?void 0:o.noDecimals)&&l<0&&(l=1),r=WF(t,e,l);return n&&r.reverse(),r})),GF=t=>{const e=Math.floor(Math.log(t)/Math.LN10),i=t/10**e;let o=IF[0];return i>=HF?o=IF[3]:i>=FF?o=IF[2]:i>=OF&&(o=IF[1]),e>=0?{step:o*10**e,gap:o,power:e}:{step:-(10**-e)/o,gap:o,power:e}};function jF(t,e,i){const o=(e-t)/Math.max(0,i);return GF(o)}function VF(t,e,i){let o;if(i=+i,(t=+t)==(e=+e)&&i>0)return[t];if(i<=0||0===(o=function(t,e,i){return(e-t)/Math.max(1,i-1)}(t,e,i))||!isFinite(o))return[];const n=new Array(i);for(let e=0;e<i;e++)n[e]=t+e*o;return n}function UF(t){let e,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=0,r=t.length-1,s=t[n],a=t[r],l=10;for(a<s&&(i=s,s=a,a=i,i=n,n=r,r=i);l-- >0;){if(i=jF(s,a,o).step,i===e)return t[n]=s,t[r]=a,t;if(i>0)s=Math.floor(s/i)*i,a=Math.ceil(a/i)*i;else{if(!(i<0))break;s=Math.ceil(s*i)/i,a=Math.floor(a*i)/i}e=i}}function $F(t,e){const i=iH(e.forceMin),o=iH(e.forceMax);let n=null;const r=[];let s=null;const a=i&&o?t=>t>=e.forceMin&&t<=e.forceMax:i?t=>t>=e.forceMin:o?t=>t<=e.forceMax:null;return i?r[0]=e.forceMin:iH(e.min)&&e.min<=Math.min(t[0],t[t.length-1])&&(r[0]=e.min),o?r[1]=e.forceMax:iH(e.max)&&e.max>=Math.max(t[0],t[t.length-1])&&(r[1]=e.max),iH(r[0])&&iH(r[1])?(s=t.slice(),s[0]=r[0],s[s.length-1]=r[1]):n=iH(r[0])||iH(r[1])?iH(r[0])?"max":"min":"all",{niceType:n,niceDomain:s,niceMinMax:r,domainValidator:a}}const XF=(t,e,i)=>Math.abs(e-t)<1?+i.toFixed(1):Math.round(+i),YF=CH(((t,e,i,o,n,r,s)=>{let a=t,l=e;const h=l<a;h&&([a,l]=[l,a]);let d,c,u=n(a),g=n(l),p=[];if(!(o%1)&&g-u<i){if(u=Math.floor(u),g=Math.ceil(g),a>0){for(;u<=g;++u)for(d=1;d<o;++d)if(c=u<0?d/r(-u):d*r(u),!(c<a)){if(c>l)break;p.push(c)}}else for(;u<=g;++u)for(d=o-1;d>=1;--d)if(c=u>0?d/r(-u):d*r(u),!(c<a)){if(c>l)break;p.push(c)}2*p.length<i&&(p=NF(a,l,i))}else p=NF(u,g,Math.min(g-u,i)).map(r);return p=p.filter((t=>0!==t)),(null==s?void 0:s.noDecimals)&&(p=Array.from(new Set(p.map((t=>Math.floor(t)))))),h?p.reverse():p})),KF=CH(((t,e,i,o,n,r)=>{const s=[],a={},l=n(t),h=n(e);let d=[];if(Number.isInteger(o))d=NF(l,h,i);else{const t=(h-l)/(i-1);for(let e=0;e<i;e++)d.push(l+e*t)}return d.forEach((i=>{const n=r(i),l=Number.isInteger(o)?XF(t,e,n):XF(t,e,SF(n)),h=XF(t,e,((t,e)=>{let i,o;return e[0]<e[1]?(i=e[0],o=e[1]):(i=e[1],o=e[0]),Math.min(Math.max(t,i),o)})(l,[t,e]));!a[h]&&!isNaN(h)&&d.length>1&&(a[h]=1,s.push(h))})),s})),qF=CH(((t,e,i,o,n)=>VF(o(t),o(e),i).map((t=>SF(n(t))))));class ZF extends EF{constructor(){super(...arguments),this.type=dF.Linear}clone(){return(new ZF).domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate)}tickFormat(){return()=>{}}d3Ticks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;const i=this.calculateVisibleDomain(this._range);return DF(i[0],i[i.length-1],t,e)}ticks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;var i;if(XE(null==e?void 0:e.customTicks))return e.customTicks(this,t);if(KE(this._rangeFactorStart)&&KE(this._rangeFactorEnd)&&(this._rangeFactorStart>0||this._rangeFactorEnd<1)&&2===this._range.length||!this._niceType)return this.d3Ticks(t,e);const o=null!==(i=this._niceDomain)&&void 0!==i?i:this._domain,n=this._domain,r=o[0],s=o[o.length-1];let a=NF(n[0],n[n.length-1],t,e);if(!a.length)return a;if(this._domainValidator)a=a.filter(this._domainValidator);else if((a[0]!==r||a[a.length-1]!==s)&&this._niceType){const t=o.slice();if("all"===this._niceType?(t[0]=a[0],t[t.length-1]=a[a.length-1],this._niceDomain=t,this.rescale()):"min"===this._niceType&&a[0]!==r?(t[0]=a[0],this._niceDomain=t,this.rescale()):"max"===this._niceType&&a[a.length-1]!==s&&(t[t.length-1]=a[a.length-1],this._niceDomain=t,this.rescale()),"all"!==this._niceType){const e=Math.min(t[0],t[t.length-1]),i=Math.max(t[0],t[t.length-1]);a=a.filter((t=>t>=e&&t<=i))}}return a}forceTicks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return VF(e[0],e[e.length-1],t)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return function(t,e,i){let o,n,r=-1;if(i=+i,(n=(e=+e)<(t=+t))&&(o=t,t=e,e=o),!isFinite(i)||e-t<=i)return[t];const s=Math.floor((e-t)/i+1),a=new Array(s);for(;++r<s;)a[r]=t+r*i;return n&&a.reverse(),a}(e[0],e[e.length-1],t)}nice(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;var i,o;const n=this._domain;let r=[];if(e){const t=$F(n,e);if(r=t.niceMinMax,this._domainValidator=t.domainValidator,this._niceType=t.niceType,t.niceDomain)return this._niceDomain=t.niceDomain,this.rescale(),this}else this._niceType="all";if(this._niceType){const e=UF(n.slice(),t);"min"===this._niceType?e[e.length-1]=null!==(i=r[1])&&void 0!==i?i:e[e.length-1]:"max"===this._niceType&&(e[0]=null!==(o=r[0])&&void 0!==o?o:e[0]),this._niceDomain=e,this.rescale()}return this}niceMin(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;this._niceType="min";const e=this._domain[this._domain.length-1],i=UF(this.domain(),t);return i&&(i[i.length-1]=e,this._niceDomain=i,this.rescale()),this}niceMax(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;this._niceType="max";const e=this._domain[0],i=UF(this._domain.slice(),t);return i&&(i[0]=e,this._niceDomain=i,this.rescale()),this}}class JF{nice(){let t=arguments.length>1?arguments[1]:void 0;var e,i,o,n;const r=this._domain;let s=[],a=null;if(t){const e=$F(r,t);if(s=e.niceMinMax,this._domainValidator=e.domainValidator,a=e.niceType,e.niceDomain)return this._niceDomain=e.niceDomain,this.rescale(),this}else a="all";if(a){const t=((t,e)=>{const i=t.slice();let o=0,n=i.length-1,r=i[o],s=i[n];return s<r&&([o,n]=[n,o],[r,s]=[s,r]),i[o]=e.floor(r),i[n]=e.ceil(s),i})(r.slice(),null!==(i=null===(e=this.getNiceConfig)||void 0===e?void 0:e.call(this))&&void 0!==i?i:{floor:t=>Math.floor(t),ceil:t=>Math.ceil(t)});return"min"===a?t[t.length-1]=null!==(o=s[1])&&void 0!==o?o:t[t.length-1]:"max"===a&&(t[0]=null!==(n=s[0])&&void 0!==n?n:t[0]),this._niceDomain=t,this.rescale(),this}return this}niceMin(){const t=this._domain[this._domain.length-1];this.nice();const e=this._domain.slice();return this._domain&&(e[e.length-1]=t,this._niceDomain=e,this.rescale()),this}niceMax(){const t=this._domain[0];this.nice();const e=this._domain.slice();return this._domain&&(e[0]=t,this._niceDomain=e,this.rescale()),this}}function QF(t){return e=>-t(-e)}function tO(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.EPSILON;return e=>Math.max(e,t)}class eO extends EF{constructor(){super(vF(10),fF(10)),this.type=dF.Log,this._limit=tO(),this._logs=this.transformer,this._pows=this.untransformer,this._domain=[1,10],this._base=10}clone(){return(new eO).domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate,!0).base(this._base)}rescale(t){var e;if(t)return this;super.rescale();const i=vF(this._base),o=fF(this._base);return(null!==(e=this._niceDomain)&&void 0!==e?e:this._domain)[0]<0?(this._logs=QF(i),this._pows=QF(o),this._limit=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.EPSILON;return e=>Math.min(e,-t)}(),this.transformer=uF,this.untransformer=gF):(this._logs=i,this._pows=o,this._limit=tO(),this.transformer=this._logs,this.untransformer=o),this}scale(t){var e;if(t=Number(t),Number.isNaN(t)||this._domainValidator&&!this._domainValidator(t))return this._unknown;this._output||(this._output=this._piecewise((null!==(e=this._niceDomain)&&void 0!==e?e:this._domain).map(this._limit).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const i=this._output(this.transformer(this._limit(this._clamp(t))));return this._fishEyeTransform?this._fishEyeTransform(i):i}base(t,e){return arguments.length?(this._base=t,this.rescale(e)):this._base}tickFormat(){return cF}d3Ticks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;const i=this.domain(),o=this._limit(i[0]),n=this._limit(i[i.length-1]);return YF(o,n,t,this._base,this.transformer,this.untransformer,e)}ticks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return KF(this._limit(e[0]),this._limit(e[e.length-1]),t,this._base,this.transformer,this.untransformer)}forceTicks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return qF(e[0],e[e.length-1],t,this.transformer,this.untransformer)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return qF(this._limit(e[0]),this._limit(e[e.length-1]),t,this.transformer,this.untransformer)}getNiceConfig(){return{floor:t=>this._pows(Math.floor(this._logs(this._limit(t)))),ceil:t=>Math.abs(t)>=1?Math.ceil(t):this._pows(Math.ceil(this._logs(this._limit(t))))}}}lH(eO,JF);class iO extends ZF{constructor(){super(bF(1),mF(1)),this.type=dF.Symlog,this._const=1}clone(){return(new iO).domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate,!0).constant(this._const)}constant(t,e){return arguments.length?(this._const=t,this.transformer=bF(t),this.untransformer=mF(t),this.rescale(e)):this._const}d3Ticks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;const i=this.domain(),o=i[0],n=i[i.length-1];return YF(o,n,t,this._const,this.transformer,this.untransformer,e)}ticks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return KF(e[0],e[e.length-1],t,this._const,this.transformer,this.untransformer)}forceTicks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return qF(e[0],e[e.length-1],t,this.transformer,this.untransformer)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return qF(e[0],e[e.length-1],t,this.transformer,this.untransformer)}}lH(iO,JF);class oO{constructor(){this._scale=new MF,this._scales=[this._scale]}valueToPosition(t){return this._scale.scale(t)}getPosition(t){let e=0,i=this._scale;if(1===this._scales.length||1===t.length)e=this.valueToPosition(t[0]);else{const o=Math.min(t.length,this._scales.length);for(let i=0;i<o;i++)e+=this._scales[i].scale(t[i]);i=this._scales[o-1]}return{position:e,bandScale:i}}calcScales(t,e){var i,o;const{bandPadding:n,paddingInner:r,paddingOuter:s}=this,a=ht(n),l=ht(r),h=ht(s);for(let d=0;d<this._scales.length;d++){const c=a?n[d]:n,u=l?r[d]:r,g=h?s[d]:s;this._scales[d].paddingInner(null!==(i=null!=u?u:c)&&void 0!==i?i:t,!0).paddingOuter(null!==(o=null!=g?g:c)&&void 0!==o?o:e)}}dataToPosition(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i;if(0===t.length||0===this._scales.length)return 0;const{position:o,bandScale:n}=this.getPosition(t);return o+n.bandwidth()*(null!==(i=e.bandPosition)&&void 0!==i?i:.5)}updateScaleDomain(t){for(let e=0;e<this._scales.length;e++)this._scales[e].domain(t)}updateRange(t){const[e,i]=this._scale.range();t[0]===e&&t[1]===i||this._scale.range(t)}}const nO=Math.sqrt(50),rO=Math.sqrt(10),sO=Math.sqrt(2);class aO{constructor(t){this._extend={},this.type=null!=t?t:"linear",this._scale="log"===t?new eO:"symlog"===t?new iO:new ZF,this._scales=[this._scale]}setExtraAttrFromSpec(t,e,i,o,n,r){this.nice=!1,this.zero=e,this.zero&&(i.min=Math.min(i.min,0),i.max=Math.max(i.max,0)),this.domain=i,this.expand=o,"log"===this.type?this._scale.base(null!=n?n:10):"symlog"===this.type&&this._scale.constant(null!=r?r:10)}transformScaleDomain(){"symlog"===this.type||"log"===this.type||this.setScaleNice()}setScaleNice(){"log"===this.type?this.setLogScaleNice():this.setLinearScaleNice()}setLogScaleNice(){var t,e,i,o,n,r;it(null===(t=this.domain)||void 0===t?void 0:t.min)&&it(null===(e=this.domain)||void 0===e?void 0:e.max)?this.nice&&this._scale.nice():ot(null===(i=this.domain)||void 0===i?void 0:i.min)&&it(null===(o=this.domain)||void 0===o?void 0:o.max)?this.nice&&this._scale.niceMax():it(null===(n=this.domain)||void 0===n?void 0:n.min)&&ot(null===(r=this.domain)||void 0===r?void 0:r.max)&&this.nice&&this._scale.niceMin()}setLinearScaleNice(){var t,e,i,o,n,r,s,a;let l=null!==(e=null!==(t=this.forceTickCount)&&void 0!==t?t:this.tickCount)&&void 0!==e?e:10;"accurateFirst"===this.niceType&&(l=Math.max(10,l)),it(null===(i=this.domain)||void 0===i?void 0:i.min)&&it(null===(o=this.domain)||void 0===o?void 0:o.max)?this.nice&&this._scale.nice(l):ot(null===(n=this.domain)||void 0===n?void 0:n.min)&&it(null===(r=this.domain)||void 0===r?void 0:r.max)?this.nice&&this._scale.niceMax(l):it(null===(s=this.domain)||void 0===s?void 0:s.min)&&ot(null===(a=this.domain)||void 0===a?void 0:a.max)?this.nice&&this._scale.niceMin(l):this.nice&&this._scale.nice(l)}dataToPosition(t){return this.valueToPosition(t[0])}valueToPosition(t){return this._scale.scale(t)}computeLinearDomain(t){const e=[];return t.forEach((t=>{const{min:i,max:o}=t;e[0]=void 0===e[0]?i:Math.min(e[0],i),e[1]=void 0===e[1]?o:Math.max(e[1],o)})),this.expandDomain(e),this.includeZero(e),this.setDomainMinMax(e),e}expandDomain(t){if(!this.expand)return;const e=t[0],i=t[t.length-1];ot(this.expand.min)&&(t[0]=e-(i-e)*this.expand.min),ot(this.expand.max)&&(t[t.length-1]=i+(i-e)*this.expand.max)}niceDomain(t){if(ot(t[0])||ot(t[1])||"linear"!==this.type)return t;if(Math.abs(Ot(t)-Ft(t))<=1e-12){let e=t[0];const i=e>=0?1:-1;if(e=Math.abs(e),e<1)t[0]=0,t[1]=1;else{let i=e/5;const o=Math.floor(Math.log(i)/Math.LN10),n=i/Math.pow(10,o);i=(n>=nO?10:n>=rO?5:n>=sO?2:1)*Math.pow(10,o),t[0]=0,t[1]=10*i}i<0&&(t.reverse(),t[0]*=-1,t[1]*=-1)}return t}niceMinMax(){var t,e,i,o,n,r,s,a;if(this.nice){let l=null!==(e=null!==(t=this.forceTickCount)&&void 0!==t?t:this.tickCount)&&void 0!==e?e:10;"accurateFirst"===this.niceType&&(l=Math.max(10,l)),it(null===(i=this.domain)||void 0===i?void 0:i.min)&&it(null===(o=this.domain)||void 0===o?void 0:o.max)?this._scale.nice(l):ot(null===(n=this.domain)||void 0===n?void 0:n.min)&&it(null===(r=this.domain)||void 0===r?void 0:r.max)?this._scale.niceMax(l):it(null===(s=this.domain)||void 0===s?void 0:s.min)&&ot(null===(a=this.domain)||void 0===a?void 0:a.max)?this._scale.niceMin(l):this._scale.nice(l)}}includeZero(t){this.zero&&(t[0]=Math.min(t[0],0),t[t.length-1]=Math.max(t[t.length-1],0))}setExtendDomain(t,e){if(void 0===e)return void delete this._extend[t];this._extend[t]=e;const i=this._scale.domain();this.extendDomain(i),this.includeZero(i),this.setDomainMinMax(i),this.niceDomain(i),this._scale.domain(i,this.nice),this.niceMinMax()}extendDomain(t){let e;const i=t.length-1,o=t[0]-t[i]>0,n=o?i:0,r=o?0:i;for(const i in this._extend)e=this._extend[i],e>t[r]&&(t[r]=e),e<t[n]&&(t[n]=e)}setDomainMinMax(t){if(!this.domain)return;const{min:e,max:i}=this.domain;ot(e)&&(t[0]=e),ot(i)&&(t[1]=i)}setZero(t){this.zero!==t&&(this.zero=t,this.updateScaleDomain())}updateScaleDomain(){const t=this.computeDomain([this.domain]);this.updateScaleDomainByModel(t)}computeDomain(t){return this.computeLinearDomain(t)}updateScaleDomainByModel(t){t=null!=t?t:this._scale.domain(),this.extendDomain(t),this.includeZero(t),this.setDomainMinMax(t),this.niceDomain(t),this._scale.domain(t,this.nice),this.niceMinMax()}updateRange(t){const[e,i]=this._scale.range();t[0]===e&&t[1]===i||this._scale.range(t)}}function lO(t,e){var i;const o=e.option;Ct(t)||(null===(i=null==o?void 0:o.label)||void 0===i?void 0:i.flush)&&function(t,e){const{width:i,height:o}=e.getLayoutRect(),n=hF(e.orient),r=!0===e.option.inverse,s=t[0],a=Ht(t);if(n)if(r){const t=i,e=0,o=s.AABBBounds.x2,n=a.AABBBounds.x1;o>t&&s.setAttributes({x:t,textAlign:"right"}),n<e&&a.setAttributes({x:e,textAlign:"left"})}else{const t=0,e=i,o=s.AABBBounds.x1,n=a.AABBBounds.x2;o<t&&s.setAttributes({x:t,textAlign:"left"}),n>e&&a.setAttributes({x:e,textAlign:"right"})}else if(r){const t=s.AABBBounds.y1,e=a.AABBBounds.y2,i=0,n=o;t<i&&s.setAttributes({y:i,textBaseline:"top"}),e>n&&a.setAttributes({y:n,textBaseline:"bottom"})}else{const t=o,e=0,i=s.AABBBounds.y2,n=a.AABBBounds.y1;i>t&&s.setAttributes({y:t,textBaseline:"bottom"}),n<e&&a.setAttributes({y:e,textBaseline:"top"})}}(t,e)}const hO=t=>t;class dO{constructor(t,e,i,o,n){var r,s,a;if(this.x=0,this.y=0,this.padding=o,this.table=n,this.orient=null!==(r=t.orient)&&void 0!==r?r:"left",this.type=null!==(s=t.type)&&void 0!==s?s:"band",this.option=Tt({},function(t){var e,i;return(null===(i=null===(e=null==t?void 0:t.colorScheme)||void 0===e?void 0:e.default)||void 0===i?void 0:i.palette)?Tt({},tF,{tick:{style:{stroke:t.colorScheme.default.palette.axisDomainColor||"#D9DDE4"}},subTick:{style:{stroke:t.colorScheme.default.palette.axisDomainColor||"#D9DDE4"}},label:{style:{fill:t.colorScheme.default.palette.axisLabelFontColor||"#89909D"}},title:{style:{fill:t.colorScheme.default.palette.secondaryFontColor||"#333333"}}}):tF}(t.__vtableChartTheme),function(t,e){let i;return"left"===t?i=e.axisStyle.leftAxisStyle:"right"===t?i=e.axisStyle.rightAxisStyle:"top"===t?i=e.axisStyle.topAxisStyle:"bottom"===t&&(i=e.axisStyle.bottomAxisStyle),Tt({},e.axisStyle.defaultAxisStyle,i)}(this.orient,n.theme),function(t,e,i){if(!i)return{};const o=i.axis;let n,r;return"linear"===e||"log"===e||"symlog"===e?n=i.axisLinear:"band"===e&&(n=i.axisBand),"top"===t||"bottom"===t?r=i.axisX:"left"!==t&&"right"!==t||(r=i.axisY),Tt({},o,n,r)}(this.orient,this.type,t.__vtableChartTheme),t),"left"===this.orient||"right"===this.orient){const t=0,n=0;this.width=e,this.height=i-o[0]-o[2]-n,this.y=o[0]+t}else if("top"===this.orient||"bottom"===this.orient){const t=0,n=0;this.width=e-o[1]-o[3]-n,this.height=i,this.x=o[3]+t}this.visible=null===(a=t.visible)||void 0===a||a,this.inverse="inverse"in t&&!!t.inverse,"band"===t.type&&(this.data=t.domain),this.initScale(),this.initData(),this.createComponent(),this.initEvent()}initScale(){const t=this.option;"band"===this.type||"point"===this.type?(this.scale=new oO,this.scale.bandPadding=t.bandPadding,this.scale.paddingInner=t.paddingInner,this.scale.paddingOuter=t.paddingOuter,this.scale.calcScales(.1,.3),this.scale.updateScaleDomain(this.data),this.updateScaleRange()):"linear"!==this.type&&"time"!==this.type&&"log"!==this.type&&"symlog"!==this.type||(this.scale=new aO(this.type),this.scale.setExtraAttrFromSpec(t.nice,t.zero,t.range,t.expand,t.base,t.constant),this.scale.transformScaleDomain(),this.scale.updateScaleDomain(),this.updateScaleRange())}initData(){var t,e,i;this.table._vDataSet||(this.table._vDataSet=new NH),function(t,e,i){t.getParser(e)||t.registerParser(e,i)}(this.table._vDataSet,"scale",hO),t=this.table._vDataSet,e="ticks",i=wy,t.getTransform(e)||t.registerTransform(e,i);const o=this.option.label||{},n=this.option.tick||{},r=new jH(this.table._vDataSet).parse(this.scale._scale,{type:"scale"}).transform({type:"ticks",options:{sampling:!1!==this.option.sampling,tickCount:n.tickCount,forceTickCount:n.forceTickCount,tickStep:n.tickStep,tickMode:n.tickMode,noDecimals:n.noDecimals,axisOrientType:this.orient,coordinateType:"cartesian",labelStyle:o.style,labelFormatter:o.formatMethod,labelGap:o.minGap,labelLastVisible:o.lastVisible,labelFlush:o.flush}},!1);this.tickData=r,this.computeData()}computeData(){this.tickData.reRunAllTransform()}initEvent(){}createComponent(){const t=eF(this.option),e=this.getUpdateAttribute();e.verticalFactor="top"===this.orient||"right"===this.orient?-1:1,this.component=new zm(Tt({disableTriggerEvent:this.table.options.disableInteraction},t,e)),this.component.setAttributes(this.setLayoutStartPosition({x:this.x,y:this.y})),this.component.originAxis=this}resize(t,e){this.width=t-("top"===this.orient||"bottom"===this.orient?this.padding[1]+this.padding[3]:0),this.height=e-("left"===this.orient||"right"===this.orient?this.padding[2]+this.padding[0]:0),this.updateScaleRange(),this.computeData();const i=eF(this.option),o=this.getUpdateAttribute();o.verticalFactor="top"===this.orient||"right"===this.orient?-1:1,this.component.setAttributes(Tt({},i,o)),this.component.setAttributes(this.setLayoutStartPosition({x:this.x,y:this.y})),this.overlap()}overlap(){!function(t,e){const i=t.find((t=>"axis-label-container-layer-0"===t.name),!0),o=t.find((t=>"axis-label-container-layer-1"===t.name),!0);lO(i?i.getChildren():[],e),lO(o?o.getChildren():[],e)}(this.component,this)}getLayoutRect(){return{width:this.width,height:this.height}}getUpdateAttribute(){this.table.tableNoFrameHeight,this.table.tableNoFrameWidth;const{width:t,height:e}=this.getLayoutRect(),i=hF(this.orient),o="left"===(n=this.orient)||"right"===n;var n;let r={x:0,y:0},s=0;i?(r={x:t,y:0},s=t):o&&(r={x:0,y:e},s=e);const a="top"===this.orient||"bottom"===this.orient?e:t;return{start:{x:0,y:0},end:r,title:{text:this.option.title.text,maxWidth:this._getTitleLimit(i)},items:this.getLabelItems(s),verticalLimitSize:a,verticalMinSize:a}}getLabelItems(t){return[this.tickData.latestData.map((e=>({id:e.value,label:e.value,value:0===t?0:this.scale.dataToPosition([e.value])/t,rawValue:e.value}))).filter((t=>t.value>=0&&t.value<=1))]}updateScaleRange(){var t,e,i,o,n,r,s,a;const l=null!==(e=null===(t=this.option.innerOffset)||void 0===t?void 0:t.right)&&void 0!==e?e:0,h=null!==(o=null===(i=this.option.innerOffset)||void 0===i?void 0:i.left)&&void 0!==o?o:0,d=null!==(r=null===(n=this.option.innerOffset)||void 0===n?void 0:n.top)&&void 0!==r?r:0,c=null!==(a=null===(s=this.option.innerOffset)||void 0===s?void 0:s.bottom)&&void 0!==a?a:0,{width:u,height:g}=this.getLayoutRect(),p=this.option.inverse||!1;let f=[0,0];hF(this.orient)?gt(u)&&(f=p?[u-l,h]:[h,u-l]):gt(g)&&(f=p?[d,g-c]:[g-c,d]),this.scale.updateRange(f)}setLayoutStartPosition(t){let{x:e,y:i}=t;return gt(e)&&(e+=Number("left"===this.orient)*this.getLayoutRect().width),gt(i)&&(i+=Number("top"===this.orient)*this.getLayoutRect().height),{x:e,y:i}}_getTitleLimit(t){var e,i,o;if(this.option.title.visible&&it(null===(e=this.option.title.style)||void 0===e?void 0:e.maxLineWidth)){let e=(null===(i=this.option.title.style)||void 0===i?void 0:i.angle)||0;if((null===(o=this.option.title)||void 0===o?void 0:o.autoRotate)&&it(this.option.title.angle)&&(e="left"===this.option.orient?-90:90),t){const t=this.getLayoutRect().width,i=Math.abs(Math.cos(be(e)));return i<1e-6?1/0:t/i}const n=this.getLayoutRect().height,r=Math.abs(Math.sin(be(e)));return r<1e-6?1/0:n/r}return null}getScale(){return this.scale._scale}getDomainSpec(){return this.scale.domain}}function cO(t,e){var i,o,n,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y;const C=Tt({},tF,t);let w=0;!1!==C.tick.visible&&(w=null!==(i=C.tick.width)&&void 0!==i?i:4);let x=0;if(C.label.visible){if("band"===C.type)C.domain.forEach((t=>{var i,o,n,r,s,a,l,h,d,c,u,g,p,f,v,b;C.label.formatMethod&&(t=C.label.formatMethod(t));const{width:m,height:y}=e.measureText(t,{fontSize:null!==(n=null===(o=null===(i=C.label)||void 0===i?void 0:i.style)||void 0===o?void 0:o.fontSize)&&void 0!==n?n:ZH,fontWeight:null!==(a=null===(s=null===(r=C.label)||void 0===r?void 0:r.style)||void 0===s?void 0:s.fontWeight)&&void 0!==a?a:"normal",fontFamily:null!==(d=null===(h=null===(l=C.label)||void 0===l?void 0:l.style)||void 0===h?void 0:h.fontFamily)&&void 0!==d?d:qH}),w=(null===(u=null===(c=C.label)||void 0===c?void 0:c.style)||void 0===u?void 0:u.maxLineWidth)||1/0,_=(null!==(f=null===(p=null===(g=C.label)||void 0===g?void 0:g.style)||void 0===p?void 0:p.angle)&&void 0!==f?f:0)+("vertical"===(null===(b=null===(v=C.label)||void 0===v?void 0:v.style)||void 0===b?void 0:b.direction)?90:0);x=Math.max(x,pO(Math.min(m,w),y,_).width)}));else{let i;if((null===(o=t.sync)||void 0===o?void 0:o.tickAlign)&&et(null===(n=t.tick)||void 0===n?void 0:n.tickMode))i=t.tick.tickMode();else if(ht(t.__ticksForVTable))i=t.__ticksForVTable;else{const t=C.range,e=Math.abs(t.min)>1?Math.round(t.min):t.min,o=Math.abs(t.max)>1?Math.round(t.max):t.max;i=[gO(e),gO(o)]}i.forEach((t=>{var i,o,n,r,s,a,l,h,d,c,u,g,p,f,v,b;C.label.formatMethod&&(t=C.label.formatMethod(t));const{width:m,height:y}=e.measureText(t,{fontSize:null!==(n=null===(o=null===(i=C.label)||void 0===i?void 0:i.style)||void 0===o?void 0:o.fontSize)&&void 0!==n?n:ZH,fontWeight:null!==(a=null===(s=null===(r=C.label)||void 0===r?void 0:r.style)||void 0===s?void 0:s.fontWeight)&&void 0!==a?a:"normal",fontFamily:null!==(d=null===(h=null===(l=C.label)||void 0===l?void 0:l.style)||void 0===h?void 0:h.fontFamily)&&void 0!==d?d:qH}),w=(null===(u=null===(c=C.label)||void 0===c?void 0:c.style)||void 0===u?void 0:u.maxLineWidth)||1/0,_=(null!==(f=null===(p=null===(g=C.label)||void 0===g?void 0:g.style)||void 0===p?void 0:p.angle)&&void 0!==f?f:0)+("vertical"===(null===(b=null===(v=C.label)||void 0===v?void 0:v.style)||void 0===b?void 0:b.direction)?90:0);x=Math.max(x,pO(Math.min(m,w),y,_).width)}))}x+=null!==(r=C.label.space)&&void 0!==r?r:4}let _=0;if(C.title.visible&&lt(C.title.text)){const{width:i,height:o}=e.measureText(C.title.text,{fontSize:null!==(l=null===(a=null===(s=C.title)||void 0===s?void 0:s.style)||void 0===a?void 0:a.fontSize)&&void 0!==l?l:ZH,fontWeight:null!==(c=null===(d=null===(h=C.title)||void 0===h?void 0:h.style)||void 0===d?void 0:d.fontWeight)&&void 0!==c?c:"normal",fontFamily:null!==(p=null===(g=null===(u=C.title)||void 0===u?void 0:u.style)||void 0===g?void 0:g.fontFamily)&&void 0!==p?p:qH}),n=(null===(v=null===(f=C.label)||void 0===f?void 0:f.style)||void 0===v?void 0:v.maxLineWidth)||1/0,r=pO(Math.min(i,n),o,null===(m=null===(b=C.title)||void 0===b?void 0:b.style)||void 0===m?void 0:m.angle);_="left"!==t.orient&&"right"!==t.orient||!C.title.autoRotate?r.width:r.height,_+=null!==(y=C.title.space)&&void 0!==y?y:4}return Math.ceil(w+x+_+1)}function uO(t,e){var i,o,n,r,s,a,l,h,d,c,u,g,p,f,v,b,m,y;const C=Tt({},tF,t);let w=0;!1!==C.tick.visible&&(w=null!==(i=C.tick.width)&&void 0!==i?i:4);let x=0;if(C.label.visible){if("band"===C.type)C.domain.forEach((t=>{var i,o,n,r,s,a,l,h,d,c,u,g,p,f,v,b;C.label.formatMethod&&(t=C.label.formatMethod(t));const{width:m,height:y}=e.measureText(t,{fontSize:null!==(n=null===(o=null===(i=C.label)||void 0===i?void 0:i.style)||void 0===o?void 0:o.fontSize)&&void 0!==n?n:ZH,fontWeight:null!==(a=null===(s=null===(r=C.label)||void 0===r?void 0:r.style)||void 0===s?void 0:s.fontWeight)&&void 0!==a?a:"normal",fontFamily:null!==(d=null===(h=null===(l=C.label)||void 0===l?void 0:l.style)||void 0===h?void 0:h.fontFamily)&&void 0!==d?d:qH}),w=(null===(u=null===(c=C.label)||void 0===c?void 0:c.style)||void 0===u?void 0:u.maxLineWidth)||1/0,_=(null!==(f=null===(p=null===(g=C.label)||void 0===g?void 0:g.style)||void 0===p?void 0:p.angle)&&void 0!==f?f:0)+("vertical"===(null===(b=null===(v=C.label)||void 0===v?void 0:v.style)||void 0===b?void 0:b.direction)?90:0);x=Math.max(x,pO(Math.min(m,w),y,_).height)}));else{let i;if((null===(o=t.sync)||void 0===o?void 0:o.tickAlign)&&et(null===(n=t.tick)||void 0===n?void 0:n.tickMode))i=t.tick.tickMode();else if(ht(t.__ticksForVTable))i=t.__ticksForVTable;else{const t=C.range,e=Math.abs(t.min)>1?Math.round(t.min):t.min,o=Math.abs(t.max)>1?Math.round(t.max):t.max;i=[gO(e),gO(o)]}i.forEach((t=>{var i,o,n,r,s,a,l,h,d,c,u,g,p,f,v,b;C.label.formatMethod&&(t=C.label.formatMethod(t));const{width:m,height:y}=e.measureText(t,{fontSize:null!==(n=null===(o=null===(i=C.label)||void 0===i?void 0:i.style)||void 0===o?void 0:o.fontSize)&&void 0!==n?n:ZH,fontWeight:null!==(a=null===(s=null===(r=C.label)||void 0===r?void 0:r.style)||void 0===s?void 0:s.fontWeight)&&void 0!==a?a:"normal",fontFamily:null!==(d=null===(h=null===(l=C.label)||void 0===l?void 0:l.style)||void 0===h?void 0:h.fontFamily)&&void 0!==d?d:qH}),w=(null===(u=null===(c=C.label)||void 0===c?void 0:c.style)||void 0===u?void 0:u.maxLineWidth)||1/0,_=(null!==(f=null===(p=null===(g=C.label)||void 0===g?void 0:g.style)||void 0===p?void 0:p.angle)&&void 0!==f?f:0)+("vertical"===(null===(b=null===(v=C.label)||void 0===v?void 0:v.style)||void 0===b?void 0:b.direction)?90:0);x=Math.max(x,pO(Math.min(m,w),y,_).height)}))}x+=null!==(r=C.label.space)&&void 0!==r?r:4}let _=0;if(C.title.visible&&C.title.text){const{width:i,height:o}=e.measureText(C.title.text,{fontSize:null!==(l=null===(a=null===(s=C.title)||void 0===s?void 0:s.style)||void 0===a?void 0:a.fontSize)&&void 0!==l?l:ZH,fontWeight:null!==(c=null===(d=null===(h=C.title)||void 0===h?void 0:h.style)||void 0===d?void 0:d.fontWeight)&&void 0!==c?c:"normal",fontFamily:null!==(p=null===(g=null===(u=C.title)||void 0===u?void 0:u.style)||void 0===g?void 0:g.fontFamily)&&void 0!==p?p:qH}),n=(null===(v=null===(f=C.label)||void 0===f?void 0:f.style)||void 0===v?void 0:v.maxLineWidth)||1/0,r=pO(Math.min(i,n),o,null===(m=null===(b=C.title)||void 0===b?void 0:b.style)||void 0===m?void 0:m.angle);_="bottom"!==t.orient&&"top"!==t.orient||!C.title.autoRotate?r.height:r.width,_+=null!==(y=C.title.space)&&void 0!==y?y:4}return w+x+_+1}function gO(t){return"number"!=typeof t&&(t=Number(t)),Number(t.toPrecision(1)).toString()}function pO(t,e){const i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)*Math.PI/180,o=-t/2,n=-e/2,r=t/2,s=-e/2,a=t/2,l=e/2,h=-t/2,d=e/2,c={x:o*Math.cos(i)-n*Math.sin(i),y:o*Math.sin(i)+n*Math.cos(i)},u={x:r*Math.cos(i)-s*Math.sin(i),y:r*Math.sin(i)+s*Math.cos(i)},g={x:a*Math.cos(i)-l*Math.sin(i),y:a*Math.sin(i)+l*Math.cos(i)},p={x:h*Math.cos(i)-d*Math.sin(i),y:h*Math.sin(i)+d*Math.cos(i)},f=Math.min(c.x,u.x,g.x,p.x),v=Math.max(c.x,u.x,g.x,p.x),b=Math.min(c.y,u.y,g.y,p.y);return{width:v-f,height:Math.max(c.y,u.y,g.y,p.y)-b}}class fO{constructor(t,e){this._emptyTipOption={spaceBetweenTextAndIcon:20,text:"no data",textStyle:{fontSize:14,color:"#000"},icon:{image:'<svg t="1716726614852" class="icon" viewBox="0 0 1194 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2621" width="200" height="200"><path d="M1038.694079 367.237067c13.265507 23.342857-16.633865-40.004445-63.05621-40.004446H219.018794c-26.558738 0-46.46393 13.334815-63.05621 40.004446S0.006238 607.277601 0.006238 650.608819V940.647979a82.351494 82.351494 0 0 0 82.961402 83.349526H1111.702885a82.337632 82.337632 0 0 0 82.975264-83.349526V650.608819c0-43.331218-155.970208-283.371753-155.970208-283.371752zM730.066575 667.284269a136.328386 136.328386 0 0 1-132.738243 133.33429 133.417459 133.417459 0 0 1-132.738243-133.33429v-6.681269a40.6698 40.6698 0 0 0-36.497473-26.66963H73.015044l119.458874-220.02445s23.231965-40.004445 53.103614-40.004446h713.481918c26.544876 0 29.871649 10.008042 46.436207 40.004446L1128.33675 633.947231H769.904682c-26.184476 0-39.838107 7.623855-39.838107 33.337038zM338.505391 210.559919l-89.601086-86.69016a22.178487 22.178487 0 0 1 0-33.26773 21.984425 21.984425 0 0 1 33.170699 0l89.601087 86.676299a22.317102 22.317102 0 0 1 0 33.26773 24.950798 24.950798 0 0 1-33.1707 0z m252.197118-40.059891a25.532983 25.532983 0 0 1-6.639685-16.633865l-3.326773-126.694606A28.263709 28.263709 0 0 1 603.995739 0.515788c13.251646-3.326773 23.204242 10.021904 26.544877 23.342858V153.866163a28.249847 28.249847 0 0 1-23.259688 26.66963c-6.611961-3.312911-13.279369-3.312911-16.578419-10.035765z m235.646421 33.337038a22.372548 22.372548 0 0 1 0-33.337038l86.288175-90.030795a22.039871 22.039871 0 0 1 33.170699 0 22.289379 22.289379 0 0 1 0 33.364761l-82.961401 90.003072a25.962691 25.962691 0 0 1-36.483611 0z" fill="#8a8a8a" p-id="2622"></path></svg>',width:100,height:100}},this.isReleased=!1,this.table=e,this._emptyTipOption=Object.assign(this._emptyTipOption,!0===t?{}:t),ot(this._emptyTipOption.displayMode)||(this.table.isListTable()?this._emptyTipOption.displayMode="basedOnTable":this._emptyTipOption.displayMode="basedOnContainer"),this._emptyTipComponent=this._createOrUpdateEmptyTipComponent(this._getEmptyTipAttrs())}_createOrUpdateEmptyTipComponent(t){if(this._emptyTipComponent)Lt(t,this._cacheAttrs)||this._emptyTipComponent.setAttributes(t);else{const e=new Xy(t);e.name="emptyTip",this.table.scenegraph.stage.defaultLayer.appendChild(e),this._emptyTipComponent=e,this.bindEvents()}return this._emptyTipComponent}bindEvents(){this._emptyTipComponent.on("click",(t=>{const e=new Fe;this._emptyTipComponent.forEachChildren((t=>{e.union(t.globalAABBBounds)})),e.contains(t.x,t.y)&&this.table.fireListeners("empty_tip_click",t)})),this._emptyTipComponent.on("dblclick",(t=>{const e=new Fe;this._emptyTipComponent.forEachChildren((t=>{e.union(t.globalAABBBounds)})),e.contains(t.x,t.y)&&this.table.fireListeners("empty_tip_dblclick",t)}))}resize(){var t;if(!this._emptyTipComponent)return;const{leftHeaderWidth:e,topHeaderHeight:i,width:o,height:n}=this.getWidthAndHeight();this._emptyTipComponent.setAttributes({spaceBetweenTextAndIcon:this._emptyTipOption.spaceBetweenTextAndIcon,x:this.table.tableX+e,y:this.table.tableY+i,width:o,height:n,text:Object.assign(Object.assign({text:this._emptyTipOption.text},this._emptyTipOption.textStyle),{fill:null===(t=this._emptyTipOption.textStyle)||void 0===t?void 0:t.color}),icon:Object.assign({},this._emptyTipOption.icon)})}release(){this._emptyTipComponent&&this.table.scenegraph.stage.defaultLayer.removeChild(this._emptyTipComponent),this._emptyTipComponent=null,this.isReleased=!0}resetVisible(){(this.table.recordsCount&&0!==this.table.recordsCount||this.table.internalProps.layoutMap.rowCount!==this.table.internalProps.layoutMap.columnHeaderLevelCount)&&this.table.internalProps.layoutMap.colCount!==this.table.internalProps.layoutMap.rowHeaderLevelCount?this.table.scenegraph.stage.defaultLayer.children.includes(this._emptyTipComponent)&&this.table.scenegraph.stage.defaultLayer.removeChild(this._emptyTipComponent):this.table.scenegraph.stage.defaultLayer.children.includes(this._emptyTipComponent)||this.table.scenegraph.stage.defaultLayer.appendChild(this._emptyTipComponent)}getWidthAndHeight(){const t=this.table.transpose||!1===this.table.options.indicatorsAsCol?this.table.getFrozenColsWidth():0,e=!this.table.transpose||this.table.options.indicatorsAsCol?this.table.getFrozenRowsHeight():0;return{leftHeaderWidth:t,topHeaderHeight:e,width:("basedOnContainer"!==this._emptyTipOption.displayMode&&this.table.columnHeaderLevelCount>0&&this.table.colCount>this.table.rowHeaderLevelCount?this.table.getDrawRange().width:this.table.tableNoFrameWidth)-t-this.table.getTheme().scrollStyle.width,height:("basedOnContainer"!==this._emptyTipOption.displayMode&&this.table.rowHeaderLevelCount>0&&this.table.rowCount>this.table.columnHeaderLevelCount?this.table.getDrawRange().height:this.table.tableNoFrameHeight)-e-this.table.getTheme().scrollStyle.width}}_getEmptyTipAttrs(){var t;const{leftHeaderWidth:e,topHeaderHeight:i,width:o,height:n}=this.getWidthAndHeight();return{spaceBetweenTextAndIcon:this._emptyTipOption.spaceBetweenTextAndIcon,x:this.table.tableX+e,y:this.table.tableY+i,width:o,height:n,text:Object.assign(Object.assign({text:this._emptyTipOption.text},this._emptyTipOption.textStyle),{fill:null===(t=this._emptyTipOption.textStyle)||void 0===t?void 0:t.color}),icon:Object.assign({},this._emptyTipOption.icon)}}}var vO=function(t,e){var i={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(i[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(t);n<o.length;n++)e.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(t,o[n])&&(i[o[n]]=t[o[n]])}return i};const bO={orient:"bottom",position:"middle",padding:30,title:{visible:!1,padding:0,textStyle:{fontSize:14,fill:"#000000",fontWeight:"normal"},space:12},item:{visible:!0,spaceCol:10,spaceRow:10,padding:2,background:{state:{selectedHover:{fill:"gray",fillOpacity:.7},unSelectedHover:{fill:"gray",fillOpacity:.2}}},shape:{space:4,state:{unSelected:{fillOpacity:.5}}},label:{space:4,style:{fill:"#89909D",fontSize:14},state:{unSelected:{fillOpacity:.5}}}},allowAllCanceled:!0,visible:!0};class mO{constructor(t,e){var i,o,n,r;this.table=e,this.option=St(t),this.orient=null!==(i=t.orient)&&void 0!==i?i:"left",this.visible=null===(o=t.visible)||void 0===o||o,this.position=null!==(n=t.position)&&void 0!==n?n:"middle",this.selectedData=null!==(r=t.defaultSelected)&&void 0!==r?r:null,this.createComponent(),this.initEvent()}createComponent(){const t=this.getLegendAttributes({width:this.table.tableNoFrameWidth,height:this.table.tableNoFrameHeight}),e=new Oy(Tt({},t,{defaultSelected:this.selectedData,disableTriggerEvent:this.table.options.disableInteraction}));e.name="legend",this.legendComponent=e,!1===this.visible&&(e.setAttributes({visible:!1,visibleAll:!1}),e.hideAll()),this.table.scenegraph.stage.defaultLayer.appendChild(e),this.adjustTableSize(t)}resize(){this.legendComponent&&!1!==this.visible&&(this.legendComponent.setAttributes({maxWidth:this.table.tableNoFrameWidth,maxHeight:this.table.tableNoFrameHeight}),this.adjustTableSize(this.legendComponent.attribute))}adjustTableSize(t){var e,i;if(!this.legendComponent||!1===this.visible)return;let o=isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,n=isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0;if(o<=0||n<=0)return;const r=this.table.tableNoFrameWidth,s=this.table.tableNoFrameHeight,a=tB(null!==(i=null!==(e=t.padding)&&void 0!==e?e:this.option.padding)&&void 0!==i?i:10);let l=0,h=0;"left"===this.orient?(l=a[3],h=0,o+=a[1]+a[3]):"top"===this.orient?(l=0,h=a[0],n+=a[0]+a[2]):"right"===this.orient?(l=r-o-a[1],h=0,o+=a[1]+a[3]):"bottom"===this.orient&&(l=0,h=s-n-a[2],n+=a[0]+a[2]);const d="bottom"===this.orient||"top"===this.orient?"horizontal":"vertical",c=this.position;let u=0,g=0;"horizontal"===d?u="middle"===c?(r-o)/2:"end"===c?r-o-a[1]:a[3]:g="middle"===c?(s-n)/2:"end"===c?s-n-a[2]:a[0],this.legendComponent.setAttributes({dx:u,dy:g,x:l,y:h}),"left"===this.orient?(this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(o),this.table.tableX+=Math.ceil(o)):"top"===this.orient?(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(n),this.table.tableY+=Math.ceil(n)):"right"===this.orient?this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(o):"bottom"===this.orient&&(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(n))}getLegendAttributes(t){var e,i;const o="bottom"===this.orient||"top"===this.orient?"horizontal":"vertical",n=function(t,e){const i=Tt({},bO,t),{title:o={},item:n={},pager:r={},background:s={},type:a,id:l,visible:h,orient:d,position:c,data:u,filter:g,regionId:p,regionIndex:f,seriesIndex:v,seriesId:b,padding:m}=i,y=vO(i,["title","item","pager","background","type","id","visible","orient","position","data","filter","regionId","regionIndex","seriesIndex","seriesId","padding"]);return o.visible&&(y.title=UH(o)),Ct(n.focusIconStyle)||$H(n.focusIconStyle),XH(n.shape),XH(n.label),XH(n.value),XH(n.background),PB(n.maxWidth)&&(n.maxWidth=Number(n.maxWidth.substring(0,n.maxWidth.length-1))*e.width/100),PB(n.width)&&(n.width=Number(n.width.substring(0,n.width.length-1))*e.width/100),PB(n.height)&&(n.height=Number(n.height.substring(0,n.height.length-1))*e.width/100),y.item=n,Ct(r.textStyle)||$H(r.textStyle),XH(r.handler),y.pager=r,s.visible&&!Ct(s.style)&&(Tt(y,s.style),ot(s.padding)&&(y.padding=s.padding)),y}(this.option,t),r=tB(null!==(i=null!==(e=n.padding)&&void 0!==e?e:this.option.padding)&&void 0!==i?i:10);return Object.assign({layout:o,items:this.getLegendItems(),maxWidth:t.width-r[1]-r[3],maxHeight:t.height-r[0]-r[2]},n)}getLegendItems(){return this.option.data}initEvent(){this.legendComponent&&(this.legendComponent.addEventListener(ky.legendItemClick,(t=>{const e=wt(t,"detail.currentSelected");this.table.fireListeners(Ax.LEGEND_ITEM_CLICK,{model:this,value:e,event:t})})),this.legendComponent.addEventListener(ky.legendItemHover,(t=>{const e=wt(t,"detail");this.table.fireListeners(Ax.LEGEND_ITEM_HOVER,{model:this,value:e,event:t})})),this.legendComponent.addEventListener(ky.legendItemUnHover,(t=>{const e=wt(t,"detail");this.table.fireListeners(Ax.LEGEND_ITEM_UNHOVER,{model:this,value:e,event:t})})),this.legendComponent.addEventListener("legendItemAttributeUpdate",(t=>{this.table.scenegraph.updateNextFrame()})))}getLegendBounds(){return{width:isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,height:isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0}}release(){this.legendComponent&&this.table.scenegraph.stage.defaultLayer.removeChild(this.legendComponent),this.legendComponent=null}}var yO=function(t,e){var i={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(i[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(t);n<o.length;n++)e.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(t,o[n])&&(i[o[n]]=t[o[n]])}return i};const CO={orient:"right",position:"middle",padding:30,title:{visible:!1,padding:0,textStyle:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"titleFontColor"}},space:12},handler:{visible:!0},startText:{style:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"labelFontColor"}}},endText:{style:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"labelFontColor"}}},handlerText:{style:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"labelFontColor"}}}},wO={horizontal:Object.assign(Object.assign({},CO),{rail:{width:200,height:8,style:{fill:"rgba(0,0,0,0.04)"}}}),vertical:Object.assign(Object.assign({},CO),{rail:{width:8,height:200,style:{fill:"rgba(0,0,0,0.04)"}}})},xO={horizontal:Object.assign({sizeBackground:{fill:"#cdcdcd"},track:{style:{fill:"rgba(20,20,20,0.1)"}},rail:{width:200,height:4,style:{fill:"rgba(0,0,0,0.04)"}}},CO),vertical:Object.assign({sizeBackground:{fill:"#cdcdcd"},track:{style:{fill:"rgba(20,20,20,0.1)"}},rail:{width:4,height:200,style:{fill:"rgba(0,0,0,0.04)"}}},CO)};class _O{constructor(t,e){var i,o,n,r;this.table=e,this.option=St(t),this.orient=null!==(i=t.orient)&&void 0!==i?i:"left",this.visible=null===(o=t.visible)||void 0===o||o,this.position=null!==(n=t.position)&&void 0!==n?n:"middle",this.selectedData=null!==(r=t.defaultSelected)&&void 0!==r?r:null,this.createComponent(),this.initEvent()}createComponent(){const t=this.getLegendAttributes({width:this.table.tableNoFrameWidth,height:this.table.tableNoFrameHeight});let e;e="color"===this.option.type?new Ny(Tt({},t,{slidable:!0})):new jy(Tt({},t,{slidable:!0})),e.name="legend",this.legendComponent=e,!1===this.visible&&(e.setAttributes({visible:!1,visibleAll:!1}),e.hideAll()),this.table.scenegraph.stage.defaultLayer.appendChild(e),this.adjustTableSize(t)}resize(){this.legendComponent&&!1!==this.visible&&(this.legendComponent.setAttributes({width:this.table.tableNoFrameWidth,height:this.table.tableNoFrameHeight}),this.adjustTableSize(this.legendComponent.attribute))}adjustTableSize(t){var e,i;if(!this.legendComponent||!1===this.visible)return;let o=isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,n=isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0;if(o<=0||n<=0)return;const r=this.table.tableNoFrameWidth,s=this.table.tableNoFrameHeight,a=tB(null!==(i=null!==(e=t.padding)&&void 0!==e?e:this.option.padding)&&void 0!==i?i:10);let l=0,h=0;"left"===this.orient?(l=a[3],h=0,o+=a[1]+a[3]):"top"===this.orient?(l=0,h=a[0],n+=a[0]+a[2]):"right"===this.orient?(l=r-o-a[1],h=0,o+=a[1]+a[3]):"bottom"===this.orient&&(l=0,h=s-n-a[2],n+=a[0]+a[2]);const d="bottom"===this.orient||"top"===this.orient?"horizontal":"vertical",c=this.position;let u=0,g=0;"horizontal"===d?u="middle"===c?(r-o)/2:"end"===c?r-o-a[1]:a[3]:g="middle"===c?(s-n)/2:"end"===c?s-n-a[2]:a[0],this.legendComponent.setAttributes({dx:u,dy:g,x:l,y:h}),"left"===this.orient?(this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(o),this.table.tableX+=Math.ceil(o)):"top"===this.orient?(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(n),this.table.tableY+=Math.ceil(n)):"right"===this.orient?this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(o):"bottom"===this.orient&&(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(n))}getLegendAttributes(t){const e="bottom"===this.orient||"top"===this.orient?"horizontal":"vertical",i="horizontal"===e?"bottom":this.orient;return Object.assign(Object.assign({},function(t,e){const i=Tt({},("color"===t.type?wO:xO)["bottom"===t.orient||"top"===t.orient?"horizontal":"vertical"],t),{title:o={},handler:n={},rail:r={},track:s={},startText:a,endText:l,handlerText:h,sizeBackground:d,background:c={},type:u,id:g,visible:p,orient:f,position:v,data:b,defaultSelected:m,field:y,filter:C,regionId:w,regionIndex:x,seriesIndex:_,seriesId:S,padding:A}=i,B=yO(i,["title","handler","rail","track","startText","endText","handlerText","sizeBackground","background","type","id","visible","orient","position","data","defaultSelected","field","filter","regionId","regionIndex","seriesIndex","seriesId","padding"]);return o.visible&&(B.title=UH(o)),B.showHandler=!1!==n.visible,Ct(n.style)||(B.handlerStyle=$H(n.style)),ot(r.width)&&(B.railWidth=r.width),ot(r.height)&&(B.railHeight=r.height),Ct(r.style)||(B.railStyle=$H(r.style)),Ct(s.style)||(B.trackStyle=$H(s.style)),B.startText=XH(a),B.endText=XH(l),B.handlerText=XH(h),Ct(d)||(B.sizeBackground=$H(d)),c.visible&&!Ct(c.style)&&(Tt(B,c.style),ot(c.padding)&&(B.padding=c.padding)),B}(this.option)),{layout:e,align:i,min:this.option.min,max:this.option.max,value:this.option.value,["color"===this.option.type?"colors":"sizeRange"]:"color"===this.option.type?this.option.colors:this.option.sizeRange})}initEvent(){this.legendComponent&&this.legendComponent.addEventListener("change",(t=>{const e=wt(t,"detail.value");this.table.fireListeners(Ax.LEGEND_CHANGE,{model:this,value:e,event:t}),this.table.scenegraph.updateNextFrame()}))}getLegendBounds(){return{width:isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,height:isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0}}release(){this.legendComponent&&this.table.scenegraph.stage.defaultLayer.removeChild(this.legendComponent),this.legendComponent=null}}function SO(t,e){return"color"===t.type||"size"===t.type?new _O(t,e):new mO(t,e)}class AO{constructor(t){this._table=t}release(){this.unbindMenuElement(),this._menuElement&&this._menuElement.release(),this._menuElement=void 0}_getMenuElement(){return this._menuElement||(this._menuElement=this.createMenuElementInternal()),this._menuElement}bindMenuElement(t,e,i){return this._getMenuElement().bindToCell(this._table,t,e,i)}unbindMenuElement(){this._getMenuElement().unbindFromCell()}pointInMenuElement(t,e){return this._getMenuElement().pointInMenuElement(t,e)}getRootElement(){return this._getMenuElement().rootElement}}const BO="vtable__menu-element",RO=`${BO}--hidden`,TO=`${BO}--shown`;class kO{constructor(t){var e,i,o;this._handler=new kx,this._rootElement=RP("div",[BO,RO]),this._rootElement.addEventListener("wheel",(t=>{t.stopPropagation()})),null===(e=this._rootElement)||void 0===e||e.addEventListener("mousedown",(t=>{t.stopPropagation(),t.preventDefault()})),null===(i=this._rootElement)||void 0===i||i.addEventListener("click",(e=>{if(e.stopPropagation(),e.preventDefault(),this._rootElement.classList.contains(RO))return;const{col:i,row:o,dropDownIndex:n,menuKey:r,text:s,hasChildren:a}=e.target;if("number"!=typeof n||a)return void e.stopPropagation();const l=t.isPivotTable()?t.internalProps.layoutMap.getPivotDimensionInfo(i,o):t.getHeaderField(i,o),h=t._dropDownMenuIsHighlight(i,o,n);t.fireListeners(Ax.DROPDOWN_MENU_CLICK,{col:i,row:o,field:l,menuKey:r,text:s,highlight:h,cellLocation:t.getCellLocation(i,o),event:e}),t.fireListeners(Ax.DROPDOWN_MENU_CLEAR,null),t.fireListeners(Ax.HIDE_MENU,null),e.stopPropagation()})),null===(o=this._rootElement)||void 0===o||o.addEventListener("mousemove",(t=>{this._rootElement.classList.contains(RO)||t.stopPropagation()}))}get rootElement(){return this._rootElement}release(){this.unbindFromCell();const t=this._rootElement;(null==t?void 0:t.parentElement)&&t.parentElement.removeChild(t),this._handler.release(),delete this._rootElement}bindToCell(t,e,i,o){const n=this._rootElement;if(this._menuInstanceInfo=o,null==n||n.classList.remove(TO),null==n||n.classList.add(RO),this._canBindToCell(t,e,i)){if(n.innerHTML="",n.appendChild(o.content),this._bindCell(t,e,i,o.position,o.referencePosition))return null==n||n.classList.add(TO),null==n||n.classList.remove(RO),!0}else this.unbindFromCell();return!1}unbindFromCell(){const t=this._rootElement;this._menuInstanceInfo=void 0,(null==t?void 0:t.parentElement)&&(t.classList.remove(TO),t.classList.add(RO))}_canBindToCell(t,e,i){var o;const n=t.getCellRangeRelativeRect({col:e,row:i}),r=null!==(o=t.internalProps.menu.parentElement)&&void 0!==o?o:t.getElement(),{top:s,bottom:a,left:l,right:h}=n;if(t.isFrozenCell(e,i))return!0;if(a<t.getFrozenRowsHeight()||h<t.getFrozenColsWidth()||l>t.tableNoFrameWidth-t.getRightFrozenColsWidth()||s>t.tableNoFrameHeight-t.getBottomFrozenRowsHeight())return!1;const{offsetHeight:d,offsetWidth:c}=r;return!(d<s||c<l)}_bindCell(t,e,i,o,n){var r;const s=this._rootElement,a=null!==(r=t.internalProps.menu.parentElement)&&void 0!==r?r:t.getElement(),{width:l,height:h,left:d,top:c}=a.getBoundingClientRect();if(s){s.parentElement!==a&&a.appendChild(s),s.style.left="0px";const e=.8*l;s.style.maxWidth=`${e}px`;const i=s.clientWidth,r=s.clientHeight;let u,g;o&&(u=o.x,g=o.y),n&&(u=n.rect.right-i,g=n.rect.bottom),g+r>h&&(g=h-r,u+=i-2),g<0&&(g/=2);let p=0,f=0;if(t.getElement()!==a){const{left:e,top:i}=t.getElement().getBoundingClientRect();p=i-c,f=e-d}return s.style.top=`${g+p}px`,u<0?u=0:u+i>l&&(u=l-i),s.style.left=`${u+f}px`,!0}return!1}pointInMenuElement(t,e){const i=this._rootElement,{x:o,y:n,width:r,height:s}=i.getBoundingClientRect();return t>o-5&&t<o+r+5&&e>n-5&&e<n+s+5}}class MO extends AO{createMenuElementInternal(){return new jP(this._table)}}let LO=class extends AO{createMenuElementInternal(){return new kO(this._table)}};const PO={"dropdown-menu":function(t){return new MO(t)},"context-menu":function(t){return new MO(t)},container:t=>new LO(t)};class EO{constructor(t){this._table=t,this._menuInstances={},this._bindTableEvent(t)}release(){const t=this._menuInstances;for(const e in t)t[e].release();delete this._menuInstances,this._attachInfo=null}_bindToCell(t,e,i,o){var n;const r=this._attachInfo,s=this._getMenuInstanceInfo(t,e,i,o);if(!r||s&&r.instance===s.instance||(null===(n=r.instance)||void 0===n||n.unbindMenuElement(),this._attachInfo=null),!s)return;const{instance:a,info:l}=s;if(a&&a.bindMenuElement(t,e,l)){const i=this._table.getCellRange(t,e);this._attachInfo={range:i,instance:a}}}_unbindFromCell(){const t=this._attachInfo;if(!t)return;const{instance:e}=t;null==e||e.unbindMenuElement(),this._attachInfo=null}_isBindToCell(t,e){const i=this._attachInfo;return!!i&&vx(i.range,t,e)}pointInMenuElement(t,e){if(!this._attachInfo)return!1;const i=this._attachInfo,{instance:o}=i;return o.pointInMenuElement(t,e)}_bindTableEvent(t){t.on(Ax.DROPDOWN_ICON_CLICK,(t=>{this._attachInfo&&this._isBindToCell(t.col,t.row)?this._unbindFromCell():this._bindToCell(t.col,t.row,"dropdown-menu")})),t.on(Ax.DROPDOWN_MENU_CLEAR,(t=>{this._unbindFromCell()})),t.on(Ax.CONTEXTMENU_CELL,(e=>{var i,o,n,r;if("html"===(null===(i=t.internalProps.menu)||void 0===i?void 0:i.renderMode)){const i=t._getMouseAbstractPoint(e.event,!1);let s=null;i.inTable&&"function"==typeof(null===(o=t.internalProps.menu)||void 0===o?void 0:o.contextMenuItems)?s=t.internalProps.menu.contextMenuItems(t.getHeaderField(e.col,e.row),e.row,e.col,t):i.inTable&&Array.isArray(null===(n=t.internalProps.menu)||void 0===n?void 0:n.contextMenuItems)&&(s=null===(r=t.internalProps.menu)||void 0===r?void 0:r.contextMenuItems),this._bindToCell(e.col,e.row,"context-menu",{content:s,position:{x:i.x,y:i.y}})}}))}_getMenuInstanceInfo(t,e,i,o){const n=this._table,r=this._menuInstances,s=function(t,e,i,o,n){var r,s;const{lineHeight:a,textBaseline:l,textStick:h}=t._getCellStyle(e,i);let d=t.getCellRangeRelativeRect(t.getCellRange(e,i));h&&(d=t.getVisibleCellRangeRelativeRect({col:e,row:i}));let{left:c,right:u,bottom:g,top:p,width:f,height:v}=d;if(t.isHeader(e,i)&&({left:c,right:u,bottom:g,top:p,width:f,height:v}=t.internalProps.headerHelper.getDropDownIconRect(d,a,l||"middle")),null==n?void 0:n.content)return{type:o,position:n.position,referencePosition:null!==(r=n.referencePosition)&&void 0!==r?r:{rect:{left:c,right:u,top:p,bottom:g,width:f,height:v}},content:n.content};if("dropdown-menu"===o){let n=t.globalDropDownMenu;const r=t._getHeaderLayoutMap(e,i);n=null!==(s=r.dropDownMenu)&&void 0!==s?s:n;const a=r.pivotInfo;return"function"==typeof n&&(n=n({row:i,col:e,table:t})),{type:o,referencePosition:{rect:{left:c,right:u,top:p,bottom:g,width:f,height:v}},content:n,pivotInfo:a}}return null}(n,t,e,i,o);return s?{instance:r&&r[i]||r&&(r[i]=PO[i](n)),type:i,info:s}:null}containElement(t){var e;for(const i in this._menuInstances)if(null===(e=this._menuInstances[i].getRootElement())||void 0===e?void 0:e.contains(t))return!0;return!1}}class HO{constructor(t,e){this.isReleased=!1,this.table=e,this._titleOption=Tt({orient:"top"},t),!1!==t.visible&&(this._titleComponent=this._createOrUpdateTitleComponent(this._getTitleAttrs()))}_createOrUpdateTitleComponent(t){if(this._titleComponent)Lt(t,this._cacheAttrs)||this._titleComponent.setAttributes(t);else{const e=new Vy(t);e.name="title",this.table.scenegraph.stage.defaultLayer.appendChild(e),this._titleComponent=e}return this._adjustTableSize(this._titleComponent.attribute),this._titleComponent}resize(){var t,e,i,o,n;if(!this._titleComponent)return;const r=tB(null!==(t=this._titleOption.padding)&&void 0!==t?t:10),s=null!==(e=this._titleOption.width)&&void 0!==e?e:("adaptive"===this.table.widthMode?this.table.tableNoFrameWidth:Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width))-r[1]-r[3],a=null!==(i=this._titleOption.height)&&void 0!==i?i:("adaptive"===this.table.heightMode?this.table.tableNoFrameHeight:Math.min(this.table.tableNoFrameHeight,this.table.getDrawRange().height))-r[0]-r[2];this._titleComponent.setAttributes({x:(null!==(o=this._titleOption.x)&&void 0!==o?o:"right"===this._titleOption.orient)?this.table.tableX+Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width):this.table.tableX,y:(null!==(n=this._titleOption.y)&&void 0!==n?n:"bottom"===this._titleOption.orient)?this.table.tableY+this.table.tableNoFrameHeight:this.table.tableY,width:"top"===this._titleOption.orient||"bottom"===this._titleOption.orient?s:this._titleOption.width,height:"left"===this._titleOption.orient||"right"===this._titleOption.orient?a:this._titleOption.height,textStyle:Object.assign({width:s},this._titleOption.textStyle),subtextStyle:Object.assign({width:s},this._titleOption.subtextStyle)}),this._adjustTableSize(this._titleComponent.attribute)}_adjustTableSize(t){var e,i,o,n;const r=isFinite(null===(e=this._titleComponent)||void 0===e?void 0:e.AABBBounds.width())?this._titleComponent.AABBBounds.width():0,s=isFinite(null===(i=this._titleComponent)||void 0===i?void 0:i.AABBBounds.height())?this._titleComponent.AABBBounds.height():0;"left"===this._titleOption.orient?(this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(r),this.table.tableX+=Math.ceil(r)):"top"===this._titleOption.orient?(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(s),this.table.tableY+=Math.ceil(s)):"right"===this._titleOption.orient?this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(r):"bottom"===this._titleOption.orient&&(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(s)),this._cacheAttrs=t,"right"!==this._titleOption.orient&&"bottom"!==this._titleOption.orient||this._titleComponent.setAttributes({x:(null!==(o=this._titleOption.x)&&void 0!==o?o:"right"===this._titleOption.orient)?this.table.tableX+this.table.tableNoFrameWidth:this.table.tableX,y:(null!==(n=this._titleOption.y)&&void 0!==n?n:"bottom"===this._titleOption.orient)?this.table.tableY+this.table.tableNoFrameHeight:this.table.tableY})}release(){this._titleComponent&&this.table.scenegraph.stage.defaultLayer.removeChild(this._titleComponent),this._titleComponent=null,this.isReleased=!0}_getTitleAttrs(){var t,e,i,o,n,r,s,a,l,h,d;const c=this._titleOption.text||this._titleOption.subtext?10:0,u=tB(null!==(t=this._titleOption.padding)&&void 0!==t?t:c),g=null!==(e=this._titleOption.width)&&void 0!==e?e:Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width)-u[1]-u[3],p=null!==(i=this._titleOption.height)&&void 0!==i?i:Math.min(this.table.tableNoFrameHeight,this.table.getDrawRange().height)-u[0]-u[2];return{text:null!==(o=this._titleOption.text)&&void 0!==o?o:"",subtext:null!==(n=this._titleOption.subtext)&&void 0!==n?n:"",x:(null!==(r=this._titleOption.x)&&void 0!==r?r:"right"===this._titleOption.orient)?this.table.tableX+Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width):this.table.tableX,y:(null!==(s=this._titleOption.y)&&void 0!==s?s:"bottom"===this._titleOption.orient)?this.table.tableY+this.table.tableNoFrameHeight:this.table.tableY,width:"top"===this._titleOption.orient||"bottom"===this._titleOption.orient?g:this._titleOption.width,height:"left"===this._titleOption.orient||"right"===this._titleOption.orient?p:this._titleOption.height,minWidth:this._titleOption.minWidth,maxWidth:this._titleOption.maxWidth,minHeight:this._titleOption.minHeight,maxHeight:this._titleOption.maxHeight,padding:this._titleOption.padding,align:null!==(a=this._titleOption.align)&&void 0!==a?a:"left",verticalAlign:null!==(l=this._titleOption.verticalAlign)&&void 0!==l?l:"top",textStyle:Object.assign({width:g},this._titleOption.textStyle),subtextStyle:Object.assign({width:g},this._titleOption.subtextStyle),dx:null!==(h=this._titleOption.dx)&&void 0!==h?h:0,dy:null!==(d=this._titleOption.dy)&&void 0!==d?d:0}}getComponentGraphic(){return this._titleComponent}}class FO{constructor(t){this._table=t}release(){var t,e;this.unbindTooltipElement(),this._tooltipElement&&(null===(e=(t=this._tooltipElement).release)||void 0===e||e.call(t)),this._tooltipElement=void 0}_getTooltipElement(){return this._tooltipElement||(this._tooltipElement=this.createTooltipElementInternal()),this._tooltipElement}bindTooltipElement(t,e,i,o){return this._getTooltipElement().bindToCell(this._table,t,e,i,o)}moveTooltipElement(t,e,i,o){this._getTooltipElement().move(this._table,t,e,i,o)}unbindTooltipElement(){this._getTooltipElement().unbindFromCell()}locateTooltipElement(t,e,i,o,n){this._getTooltipElement()._locate(this._table,t,e,i,o,n)}}!function(){if("node"===zw.mode)return;const t=document.createElement("style");t.id="vtable-tooltip-styleSheet",t.textContent="\n@keyframes vtable__bubble-tooltip-element--shown-animation {\n\t0% {\n\t\topacity: 0;\n\t}\n\t100% {\n\t\topacity: 1;\n\t}\n}\n.vtable__bubble-tooltip-element {\n\tposition: absolute;\n\t\n\t// pointer-events: none;\n\t//user-select: none;\n\tmax-width: 300px;\n\tz-index: 99999;\n\n\tbackground: #FFFFFF;\n    border: 1px solid #E6E8ED;\n    box-sizing: border-box;\n    border-radius: 4px;\n    box-shadow: 0px 2px 4px rgb(27 31 35 / 8%);\n    color: #141414;\n    font-size: 13px;\n}\n.vtable__bubble-tooltip-element--hidden {\n\topacity: 0;\n  pointer-events: none;\n\tuser-select: none;\n\t/* transform: translate(-50%, -50%); */\n\ttransition: opacity 75ms linear;\n}\n.vtable__bubble-tooltip-element--shown {\n\topacity: 1;\n\t/* transform: translate(-50%, -50%); */\n\tanimation: vtable__bubble-tooltip-element--shown-animation 150ms ease-out;\n}\n.vtable__bubble-tooltip-element__content {\n\t/* font-size: .75rem; */\n\tpadding: 6px 8px;\n\tmin-height: 1em;\n\tline-height: 1.5;\n\twidth: 100%;\n\tdisplay: block;\n\twhite-space: pre-wrap;\n\tmargin: 0;\n\tbox-sizing: border-box;\n\toverflow: auto;\n\tword-wrap: break-word;\n\tposition: relative;\n\tbackground-color: #FFF;\n\tz-index: 2;\n\tborder-radius: 4px;\n}\n/*  WebKit Microsoft Edge（新版）： */\n.vtable__bubble-tooltip-element__content::-webkit-scrollbar {\n  width: 0;\n  height: 0;\n  background-color: transparent;\n}\n/*  Opera Firefox  */\n.vtable__bubble-tooltip-element__content > scrollbar-track {\n  width: 0;\n  height: 0;\n  background-color: transparent;\n}\n/* Internet Explorer 11 和 Microsoft Edge（旧版） */\n.vtable__bubble-tooltip-element__content > scrollbar {\n  width: 0;\n  height: 0;\n  background-color: transparent;\n}\n.vtable__bubble-tooltip-element__triangle {\n\t/* font-size: .75rem; */\n\tposition: absolute;\n\twidth: 10px;\n\theight: 10px;\n\tdisplay: block;\n\ttransform: rotate(45deg);\n    transform-origin: 50% 50% 0;\n\tz-index: 1;\n\tbackground-color: #FFF;\n\tborder: 1px solid #E6E8ED;\n}\n",document.head.appendChild(t)}();const OO="vtable__bubble-tooltip-element",IO=`${OO}__content`,zO=`${OO}__triangle`,DO=`${OO}--hidden`,WO=`${OO}--shown`;class NO{constructor(){this._handler=new kx;const t=this._rootElement=RP("div",[OO,DO]),e=RP("div",[IO]),i=RP("span",[zO]);t.appendChild(i),t.appendChild(e),this._messageElement=t.querySelector(`.${IO}`)||void 0,this._triangleElement=t.querySelector(`.${zO}`)||void 0,t.addEventListener("mousemove",(()=>{this._disappearDelayId&&clearTimeout(this._disappearDelayId)})),t.addEventListener("mouseleave",(()=>{this._disappearDelay=void 0,this.unbindFromCell()})),e.addEventListener("wheel",(t=>{t.stopPropagation()})),e.addEventListener("copy",(t=>{(function(t){const e=window.getSelection();if(e.rangeCount){const i=e.getRangeAt(0);return i.endOffset>i.startOffset&&t.contains(i.commonAncestorContainer)}return!1})(e)&&t.stopPropagation()}))}bindToCell(t,e,i,o,n){var r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x,_;this._disappearDelay=null==o?void 0:o.disappearDelay,this._disappearDelayId&&clearTimeout(this._disappearDelayId);const S=this._rootElement,A=this._messageElement,B=this._triangleElement;if(null==S||S.classList.remove(WO),null==S||S.classList.add(DO),this._canBindToCell(t,e,i)){if(A.setAttribute("style",""),B.setAttribute("style",""),(null==o?void 0:o.className)&&S.classList.add(o.className),(null===(r=null==o?void 0:o.style)||void 0===r?void 0:r.bgColor)&&(A.style.backgroundColor=null===(s=null==o?void 0:o.style)||void 0===s?void 0:s.bgColor),(null===(a=null==o?void 0:o.style)||void 0===a?void 0:a.bgColor)&&(B.style.backgroundColor=null===(l=null==o?void 0:o.style)||void 0===l?void 0:l.bgColor),B.style.display=!0===(null===(h=null==o?void 0:o.style)||void 0===h?void 0:h.arrowMark)?"block":"none",(null===(d=null==o?void 0:o.style)||void 0===d?void 0:d.fontSize)&&(A.style.fontSize=(null!==(u=null===(c=null==o?void 0:o.style)||void 0===c?void 0:c.fontSize)&&void 0!==u?u:12)+"px"),(null===(g=null==o?void 0:o.style)||void 0===g?void 0:g.fontFamily)&&(A.style.fontFamily=null===(p=null==o?void 0:o.style)||void 0===p?void 0:p.fontFamily),(null===(f=null==o?void 0:o.style)||void 0===f?void 0:f.color)&&(A.style.color=null===(v=null==o?void 0:o.style)||void 0===v?void 0:v.color),(null===(b=null==o?void 0:o.style)||void 0===b?void 0:b.padding)&&(A.style.padding=`${null===(m=null==o?void 0:o.style)||void 0===m?void 0:m.padding.join("px ")}px`),(null===(y=null==o?void 0:o.style)||void 0===y?void 0:y.maxHeight)&&(A.style.maxHeight=`${null===(C=null==o?void 0:o.style)||void 0===C?void 0:C.maxHeight}px`),(null===(w=null==o?void 0:o.style)||void 0===w?void 0:w.maxWidth)&&(A.style.maxWidth=`${null===(x=null==o?void 0:o.style)||void 0===x?void 0:x.maxWidth}px`),A&&(A.textContent=null==o?void 0:o.content),this._bindToCell(t,e,i,null==o?void 0:o.position,null==o?void 0:o.referencePosition,n,null===(_=null==o?void 0:o.style)||void 0===_?void 0:_.arrowMark))return null==S||S.classList.add(WO),null==S||S.classList.remove(DO),!0}else this.unbindFromCell();return!1}release(){var t,e;this.unbindFromCell();const i=this._rootElement;(null==i?void 0:i.parentElement)&&i.parentElement.removeChild(i),null===(e=null===(t=this._handler)||void 0===t?void 0:t.release)||void 0===e||e.call(t),delete this._rootElement,delete this._messageElement}move(t,e,i,o,n){const r=this._rootElement;this._canBindToCell(t,e,i)?(this._bindToCell(t,e,i,null==o?void 0:o.position,null==o?void 0:o.referencePosition,n),null==r||r.classList.add(WO),null==r||r.classList.remove(DO)):this.unbindFromCell()}unbindFromCell(){var t;if(this._disappearDelay)this._disappearDelayId=setTimeout((()=>{const t=this._rootElement;(null==t?void 0:t.parentElement)&&(t.classList.remove(WO),t.classList.add(DO))}),null!==(t=this._disappearDelay)&&void 0!==t?t:0);else{const t=this._rootElement;(null==t?void 0:t.parentElement)&&(t.classList.remove(WO),t.classList.add(DO))}}_canBindToCell(t,e,i){const o=t.getCellRangeRelativeRect({col:e,row:i}),n=t.getElement(),{bottom:r,left:s,right:a,top:l}=o;if(t.isFrozenCell(e,i))return!0;if(r<t.getFrozenRowsHeight()||a<t.getFrozenColsWidth()||s>t.tableNoFrameWidth-t.getRightFrozenColsWidth()||l>t.tableNoFrameHeight-t.getBottomFrozenRowsHeight())return!1;const{offsetHeight:h,offsetWidth:d}=n;return!(l>h||s>d)}_bindToCell(t,e,i,o,n,r,s){const a=this._rootElement,l=t.getCellRangeRelativeRect({col:e,row:i}),h=t.internalProps.tooltip.parentElement,d=t.internalProps.element.offsetWidth,{width:c}=l;if(a){let l,u;a.parentElement!==h&&h.appendChild(a),a.style.left="0px";const g=Math.min(.8*d,4*c);a.style.maxWidth=`${g}px`;const p=a.clientWidth,f=a.clientHeight;if(!o&&!n)return!1;{const a=this.getComputedPosition(t,e,i,o,n,r,s);u=a.x,l=a.y}a.style.left=`${u}px`,a.style.top=`${l}px`,qw()&&(a.style.fontSize="11px");const{x1:v,x2:b,y1:m,y2:y}=t.stateManager.menu.bounds,C=u,w=C+p,x=l,_=C+f;return!(t.stateManager.menu.isShow&&v<w&&b>C&&y>x&&m<_)}return!1}getComputedPosition(t,e,i,o,n,r,s){var a;const l=this._rootElement,h=t.getCellRangeRelativeRect({col:e,row:i}),{x:d,y:c}=t.internalProps.tooltip.parentElement.getBoundingClientRect(),{width:u,height:g,x:p,y:f}=t.internalProps.element.getBoundingClientRect(),{width:v}=h;let b,m;const y=Math.min(.8*u,4*v);l.style.maxWidth=`${y}px`;const C=l.clientWidth,w=l.clientHeight,x=s?6:0;if(o)m=o.x,b=o.y+x,this._triangleElement.style.left="50%",this._triangleElement.style.marginLeft="-5px",this._triangleElement.style.top="-5px";else if(n){let t=null!==(a=n.placement)&&void 0!==a?a:ow.bottom;const e=n.rect.left+n.rect.width/2,i=n.rect.top+n.rect.height/2,o=n.rect.top,s=n.rect.bottom,l=n.rect.left,h=n.rect.right;let d=0;const c=()=>{d++,d>=4||(this.removeStyleFromTriangle(),t===ow.top?(m=e-C/2,b=o-w-x,this._triangleElement.style.left="50%",this._triangleElement.style.marginLeft="-5px",this._triangleElement.style.bottom="-5px",r&&b<0&&(t=ow.right,c())):t===ow.bottom?(m=e-C/2,b=s+x,this._triangleElement.style.left="50%",this._triangleElement.style.marginLeft="-5px",this._triangleElement.style.top="-5px",r&&b+w>g&&(t=ow.left,c())):t===ow.left?(b=i-w/2,m=l-C-x,this._triangleElement.style.top="50%",this._triangleElement.style.marginTop="-5px",this._triangleElement.style.right="-5px",r&&m<0&&(t=ow.top,c())):t===ow.right&&(b=i-w/2,m=h+x,this._triangleElement.style.top="50%",this._triangleElement.style.marginTop="-5px",this._triangleElement.style.left="-5px",r&&m+C>u&&(t=ow.bottom,c())))};c()}return r&&(m<0?m=0:m+l.offsetWidth>u&&(m=u-l.offsetWidth)),{x:m+p-d,y:b+f-c}}removeStyleFromTriangle(){this._triangleElement.style.left="",this._triangleElement.style.right="",this._triangleElement.style.top="",this._triangleElement.style.bottom="",this._triangleElement.style.marginLeft="",this._triangleElement.style.marginTop=""}_locate(t,e,i,o,n,r){const s=this.getComputedPosition(t,e,i,o,n,r),a=s.x,l=s.y;this._rootElement.style.left=`${a}px`,this._rootElement.style.top=`${l}px`}}class GO extends FO{createTooltipElementInternal(){return new NO}}const jO=function(t){return new GO(t)};class VO{constructor(t,e){this._table=t,this._tooltipInstances={},this._bindTableEvent(t),this.confine=e}release(){var t,e;const i=this._tooltipInstances;for(const o in i)null===(e=null===(t=i[o])||void 0===t?void 0:t.release)||void 0===e||e.call(t);delete this._tooltipInstances,this._attachInfo=null}_bindToCell(t,e,i){var o;const n=this._attachInfo,r=this._getTooltipInstanceInfo(t,e);if(!n||r&&n.instance===r||(null===(o=n.instance)||void 0===o||o.unbindTooltipElement(),this._attachInfo=null),r&&r&&r.bindTooltipElement(t,e,i,this.confine)){const o=this._table.getCellRange(t,e);this._attachInfo={range:o,instance:r,tooltipOptions:i}}}_move(t,e,i){const o=this._attachInfo;if(!o||!vx(o.range,t,e))return;const{instance:n}=o;null==n||n.moveTooltipElement(t,e,i,this.confine)}moveToPosition(t,e,i,o){const n=this._attachInfo;if(!n||!vx(n.range,t,e))return;const{instance:r}=n;this._attachInfo.tooltipOptions.position=i,this._attachInfo.tooltipOptions.referencePosition=o,null==r||r.locateTooltipElement(t,e,i,o,this.confine)}_unbindFromCell(){const t=this._attachInfo;if(!t)return;const{instance:e}=t;null==e||e.unbindTooltipElement(),this._attachInfo=null}_isBindCell(t,e){const i=this._attachInfo;return!!i&&vx(i.range,t,e)}_bindTableEvent(t){t.on(Ax.MOUSEENTER_CELL,(e=>{if(qw())return;const{x1:i,x2:o,y1:n,y2:r}=t.stateManager.menu.bounds;if(t.stateManager.menu.isShow&&"number"==typeof e.x&&"number"==typeof e.y&&e.x>i&&e.x<o&&e.y>n&&e.y<r)return;const{col:s,row:a}=e;this.showTooltip(s,a)})),t.on(Ax.MOUSEMOVE_CELL,(e=>{var i,o;if(!qw()){if(null===(o=null===(i=this._attachInfo)||void 0===i?void 0:i.tooltipOptions)||void 0===o?void 0:o.referencePosition){const i=this._attachInfo.tooltipOptions.referencePosition,{event:o}=e,{left:n,right:r,top:s,bottom:a}=i.rect,l=t._getMouseAbstractPoint(o,!1);l.inTable&&l.x>=n-5&&l.x<=r+5&&l.y>=s-5&&l.y<=a+5||this._unbindFromCell()}this._attachInfo&&t.stateManager.menu.isShow&&this._bindToCell(e.col,e.row)}})),t.on(Ax.MOUSELEAVE_CELL,(t=>{this._unbindFromCell()})),t.on(Ax.SELECTED_CELL,(t=>{this._isBindCell(t.col,t.row)&&this._unbindFromCell()})),t.on(Ax.MOUSELEAVE_TABLE,(t=>{this._unbindFromCell()})),t.on(Ax.SCROLL,(t=>{this._unbindFromCell()}))}showTooltip(t,e){var i,o,n;let r;const s=this._table,a=s.getHeaderDescription(t,e);if(a){const o=s.getCellRangeRelativeRect({col:t,row:e});r={content:a,referencePosition:{placement:s.internalProps.tooltip.position,rect:o},disappearDelay:null!==(i=s.internalProps.tooltip.overflowTextTooltipDisappearDelay)&&void 0!==i?i:0,style:s.theme.tooltipStyle}}else if(et(null===(o=s.internalProps.tooltip)||void 0===o?void 0:o.isShowOverflowTextTooltip)?s.internalProps.tooltip.isShowOverflowTextTooltip(t,e,s):s.internalProps.tooltip.isShowOverflowTextTooltip){const i=s.getCellOverflowText(t,e),o=s.getCellRangeRelativeRect({col:t,row:e});i&&(r={content:a?`${a}\n  ${i}`:i,referencePosition:{placement:s.internalProps.tooltip.position,rect:o},disappearDelay:null!==(n=s.internalProps.tooltip.overflowTextTooltipDisappearDelay)&&void 0!==n?n:0,style:s.theme.tooltipStyle})}r?this._bindToCell(t,e,r):this._unbindFromCell()}_getTooltipInstanceInfo(t,e){const i=this._table,o=this._tooltipInstances;return o&&o["bubble-tooltip"]||o&&(o["bubble-tooltip"]=jO(i))}isBinded(t){var e;return JSON.stringify(t)===JSON.stringify(null===(e=this._attachInfo)||void 0===e?void 0:e.tooltipOptions)}}class UO{constructor(t){this.titleRows=[],this.showedTitleRows=[],this.rowNow=-1,this.skipStartRow=-1,this.skipEndRow=-1,this.table=t,this.table.on("scroll",(t=>{"vertical"===t.scrollDirection&&this.updateGroupTitle()})),this.table.on("tree_hierarchy_state_change",(t=>{this.updateGroupTitle()})),this.table.on("resize_column",(t=>{this.updateGroupTitle()}))}updateGroupTitle(){0===this.table.scrollTop?(this.titleRows=[],this.showedTitleRows=[]):-1!==this.skipStartRow&&-1!==this.skipEndRow&&this.skipStartRow!==this.table.scenegraph.proxy.bodyTopRow-1?(this.table.scenegraph.proxy.screenTopRow<=this.skipStartRow||this.table.scenegraph.proxy.screenTopRow>=this.skipEndRow)&&(this.skipStartRow=-1,this.skipEndRow=-1,this.updateGroupTitleInfo()):(this.skipStartRow=-1,this.skipEndRow=-1,this.updateGroupTitleInfo()),this.updateScenegraph()}updateGroupTitleInfo(){this.rowNow=this.table.scenegraph.proxy.screenTopRow+this.titleRows.length;const t=this.table.getRecordIndexByCell(0,this.rowNow),e=this.table.getRecordIndexByCell(0,this.rowNow+1);this.getTitleRowsByRecordIndex(t,e)}getTitleRowsByRecordIndex(t,e){ht(t)||(t=[t]),ht(e)||(e=[e]);for(let e=0;e<t.length;e++){const i=t.slice(0,e+1);this.table.dataSource.getRaw(i)}const i=[],o=e.length===t.length+1;let n=t.slice(0,o?t.length:t.length-1);const r=this.table.dataSource.currentIndexedData;for(let e=this.rowNow-this.table.columnHeaderLevelCount;e>=0;e--){const o=r[e];if(ht(o)&&n.length===o.length){let t=!0;for(let e=0;e<o.length;e++)if(o[e]!==n[e]){t=!1;break}t&&(i.push(e+this.table.columnHeaderLevelCount),n=n.slice(0,n.length-1))}else if(o===t[0]){i.push(e+this.table.columnHeaderLevelCount);break}}this.titleRows=i.reverse()}updateScenegraph(){const{table:t}=this,{shadowGroup:e,shadowGroupFrozen:i}=function(t){const e=t.scenegraph.colHeaderGroup,i=t.scenegraph.cornerHeaderGroup;if(!e.border){const i=oc({x:0,y:0,width:0,height:0,cursor:"pointer"});e.add(i),e.border=i,i.attachShadow(i.shadowRoot),i.name="border-rect",i.addEventListener("click",(e=>{const i=t.listTreeStickCellPlugin.titleRows,{shadowTarget:o}=e.pickParams,n=UB(o),{col:r,row:s}=n;YO(s-i.indexOf(s),t)}))}if(!i.border){const e=oc({x:0,y:0,width:0,height:0,cursor:"pointer"});i.add(e),i.border=e,e.attachShadow(e.shadowRoot),e.name="border-rect",e.addEventListener("click",(e=>{const i=t.listTreeStickCellPlugin.titleRows,{shadowTarget:o}=e.pickParams,n=UB(o),{col:r,row:s}=n;YO(s-i.indexOf(s),t)}))}const o=e.border.shadowRoot,n=i.border.shadowRoot;return o.removeAllChild(),n.removeAllChild(),{shadowGroup:o,shadowGroupFrozen:n}}(t);this.showedTitleRows.length=0;let o=0;for(let n=0;n<t.colCount;n++){let r;n<t.frozenColCount?(r=new PR({x:t.getColsWidth(0,n-1),y:t.getFrozenRowsHeight()}),i.add(r)):(r=new PR({x:t.getColsWidth(t.frozenColCount,n-1),y:t.getFrozenRowsHeight()}),e.add(r)),r.col=n;for(let e=0;e<this.titleRows.length;e++){const i=this.titleRows[e];if($O(i,this.rowNow,t.scenegraph.proxy.screenTopRow,this.titleRows)){0===n&&o++;continue}0===n&&this.showedTitleRows.push(i);const s=t.scenegraph.getCell(n,i);if("cell"===s.role){const t=XO(s);t.setAttributes({y:40*e}),r.add(t)}else{const o=nT(n,i,t,!0,!0);o.setAttributes({y:40*e}),r.add(o)}}}o>0&&-1===this.skipStartRow&&-1===this.skipEndRow&&(this.skipStartRow=t.scenegraph.proxy.screenTopRow-1,this.skipEndRow=t.scenegraph.proxy.screenTopRow+1)}}function $O(t,e,i,o){return t===e&&t!==i+o.length-1||t===i+o.indexOf(t)+1&&t<e}function XO(t){const e=t.clone();if(e.role=t.role,e.col=t.col,e.row=t.row,e.mergeStartCol=t.mergeStartCol,e.mergeStartRow=t.mergeStartRow,e.mergeEndCol=t.mergeEndCol,e.mergeEndRow=t.mergeEndRow,e.contentWidth=t.contentWidth,e.contentHeight=t.contentHeight,"cell"===e.role){const t=oc({x:0,y:0,width:e.attribute.width,height:e.attribute.height});e.add(t)}if("group"===t.type){const i=e;t.forEachChildren((t=>{const e=XO(t);i.add(e)}))}return e}function YO(t,e){const i=e.getDrawRange();if(ot(t)&&t>=e.frozenRowCount){const o=e.getFrozenRowsHeight(),n=e.getRowsHeight(0,t-1);e.scrollTop=Math.min(n-o,e.getAllRowsHeight()-i.height)-1}e.scenegraph.updateNextFrame()}const KO={};function qO(t,e,i,o,n,r,s,a,l,h,d,c,u,g,p,f,v,b,m){var y,C,w,x,_,S,A,B,R,T,k,M,L,P,E,H,F,O,I,z,D,W,N,G,j;const V=hx(KO,WE)[d],U=OR("padding",p._getCellStyle(n,r),n,r,p);if(ot(U)&&(l=U),!t){const l=IR(n,r,f,p);b&&(t=p.scenegraph.highPerformanceGetCell(n,r,!0))&&"cell"===t.role&&t.setAttributes({x:i,y:o,width:s,height:a,lineWidth:null!==(C=null===(y=null==f?void 0:f.group)||void 0===y?void 0:y.lineWidth)&&void 0!==C?C:void 0,fill:null!==(x=null===(w=null==f?void 0:f.group)||void 0===w?void 0:w.fill)&&void 0!==x?x:void 0,stroke:null!==(S=null===(_=null==f?void 0:f.group)||void 0===_?void 0:_.stroke)&&void 0!==S?S:void 0,strokeArrayWidth:l,strokeArrayColor:null!==(B=null===(A=null==f?void 0:f.group)||void 0===A?void 0:A.strokeArrayColor)&&void 0!==B?B:void 0,cursor:null!==(T=null===(R=null==f?void 0:f.group)||void 0===R?void 0:R.cursor)&&void 0!==T?T:void 0,lineDash:null!==(M=null===(k=null==f?void 0:f.group)||void 0===k?void 0:k.lineDash)&&void 0!==M?M:void 0,lineCap:"butt",clip:!0,cornerRadius:f.group.cornerRadius}),t&&"cell"===t.role||((t=new PR({x:i,y:o,width:s,height:a,lineWidth:null!==(P=null===(L=null==f?void 0:f.group)||void 0===L?void 0:L.lineWidth)&&void 0!==P?P:void 0,fill:null!==(H=null===(E=null==f?void 0:f.group)||void 0===E?void 0:E.fill)&&void 0!==H?H:void 0,stroke:null!==(O=null===(F=null==f?void 0:f.group)||void 0===F?void 0:F.stroke)&&void 0!==O?O:void 0,strokeArrayWidth:l,strokeArrayColor:null!==(z=null===(I=null==f?void 0:f.group)||void 0===I?void 0:I.strokeArrayColor)&&void 0!==z?z:void 0,cursor:null!==(W=null===(D=null==f?void 0:f.group)||void 0===D?void 0:D.cursor)&&void 0!==W?W:void 0,lineDash:null!==(G=null===(N=null==f?void 0:f.group)||void 0===N?void 0:N.lineDash)&&void 0!==G?G:void 0,lineCap:"butt",clip:!0,cornerRadius:f.group.cornerRadius})).role="cell",t.col=n,t.row=r,null==e||e.addCellGroup(t))}if(t.AABBBounds.width(),m&&Array.isArray(p.getCellValue(n,r))||!m){const e=new dk(v,{stroke:!1,x:l[3],y:l[0],canvas:null!==(j=p.canvas)&&void 0!==j?j:p.scenegraph.stage.window.getContext().canvas,mode:p.options.mode,modeParams:p.options.modeParams,spec:p.options.specTransformInCell?p.options.specTransformInCell(c,n,r):c,ClassType:V,width:s-l[3]-l[1],height:a-l[2]-l[0],chartInstance:u,dataId:g,data:p.getCellValue(n,r)||[],cellPadding:l,dpr:p.internalProps.pixelRatio,axes:p.isPivotChart()?p.internalProps.layoutMap.getChartAxes(n,r):[],tableChartOption:p.options.chartOption,col:n,row:r});t.appendChild(e),p.internalProps.layoutMap.setChartInstance(n,r,e.chartInstance)}return t}function ZO(t,e,i,o,n,r,s,a,l,h,d,c,u,g,p,f,v,b){var m,y,C,w,x,_,S,A,B,R,T,k,M,L,P,E,H,F,O,I,z,D,W,N;if(!t){const s=IR(n,r,p,g);b&&(t=g.scenegraph.highPerformanceGetCell(n,r,!0))&&"cell"===t.role&&t.setAttributes({x:i,y:o,width:a,height:l,lineWidth:null!==(y=null===(m=null==p?void 0:p.group)||void 0===m?void 0:m.lineWidth)&&void 0!==y?y:void 0,fill:null!==(w=null===(C=null==p?void 0:p.group)||void 0===C?void 0:C.fill)&&void 0!==w?w:void 0,stroke:null!==(_=null===(x=null==p?void 0:p.group)||void 0===x?void 0:x.stroke)&&void 0!==_?_:void 0,strokeArrayWidth:s,strokeArrayColor:null!==(A=null===(S=null==p?void 0:p.group)||void 0===S?void 0:S.strokeArrayColor)&&void 0!==A?A:void 0,cursor:null!==(R=null===(B=null==p?void 0:p.group)||void 0===B?void 0:B.cursor)&&void 0!==R?R:void 0,lineDash:null!==(k=null===(T=null==p?void 0:p.group)||void 0===T?void 0:T.lineDash)&&void 0!==k?k:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius}),t&&"cell"===t.role||((t=new PR({x:i,y:o,width:a,height:l,lineWidth:null!==(L=null===(M=null==p?void 0:p.group)||void 0===M?void 0:M.lineWidth)&&void 0!==L?L:void 0,fill:null!==(E=null===(P=null==p?void 0:p.group)||void 0===P?void 0:P.fill)&&void 0!==E?E:void 0,stroke:null!==(F=null===(H=null==p?void 0:p.group)||void 0===H?void 0:H.stroke)&&void 0!==F?F:void 0,strokeArrayWidth:s,strokeArrayColor:null!==(I=null===(O=null==p?void 0:p.group)||void 0===O?void 0:O.strokeArrayColor)&&void 0!==I?I:void 0,cursor:null!==(D=null===(z=null==p?void 0:p.group)||void 0===z?void 0:z.cursor)&&void 0!==D?D:void 0,lineDash:null!==(N=null===(W=null==p?void 0:p.group)||void 0===W?void 0:W.lineDash)&&void 0!==N?N:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius})).role="cell",t.col=n,t.row=r,null==e||e.addCellGroup(t))}let G;if(u){let t=n,e=r;v&&(t=v.start.col,e=v.start.row),G=g.getCellIcons(t,e)}let j=0,V=0;if(Array.isArray(G)&&0!==G.length){const{leftIconWidth:e,rightIconWidth:i,absoluteLeftIconWidth:o,absoluteRightIconWidth:n}=UR(G,t,v,g);j=e+i,V=e,t.forEachChildren((t=>{"icon-left"===t.role?t.setAttribute("x",t.attribute.x+h[3]):"icon-right"===t.role?t.setAttribute("x",t.attribute.x+a-i-h[1]):"icon-absolute-right"===t.role&&t.setAttribute("x",t.attribute.x+a-n-h[1])})),t.forEachChildren((t=>{"middle"===c?t.setAttribute("y",(l-t.AABBBounds.height())/2):"bottom"===c?t.setAttribute("y",l-t.AABBBounds.height()-h[2]):t.setAttribute("y",h[0])}))}const U=function(t,e,i,o,n,r,s,a,l){var h,d,c,u;const g=l._getCellStyle(t,e),p=FR("size",g,t,e,l),f=FR("spaceBetweenTextAndIcon",g,t,e,l),v=FR("defaultFill",g,t,e,l),b=FR("defaultStroke",g,t,e,l),m=FR("disableFill",g,t,e,l),y=FR("checkedFill",g,t,e,l),C=FR("checkedStroke",g,t,e,l),w=FR("disableCheckedFill",g,t,e,l),x=FR("disableCheckedStroke",g,t,e,l),_=FR("checkIconImage",g,t,e,l),S=FR("indeterminateIconImage",g,t,e,l),A=l.getCellValue(t,e),B=l.getCellOriginValue(t,e);let R,T,k=null!==(h=A)&&void 0!==h?h:"";nt(A)?(R=A.checked,T=A.disable,k=null!==(d=A.text)&&void 0!==d?d:""):"boolean"==typeof A&&(R=A,k=""),R=l.stateManager.syncCheckedState(t,e,a.field,R);const M=DR(t,e,l),L=l._getCellStyle(t,e),P=null!==(c=L.autoWrapText)&&void 0!==c?c:l.internalProps.autoWrapText,{lineClamp:E}=L,{checked:H,disable:F}=a;if(null==R||"function"==typeof R){const i=ux(H,{col:t,row:e,table:l,context:null,value:A,dataValue:B});R=l.stateManager.syncCheckedState(t,e,a.field,i)}const O=ux(F,{col:t,row:e,table:l,context:null,value:A,dataValue:B}),I="auto"===i,z=l.isAutoRowHeight(e),D={text:1===k.length?k[0]:k,maxLineWidth:I?1/0:o-(r[1]+r[3]+M)-p-f,textAlign:"left",textBaseline:"top",autoWrapText:P,lineClamp:E,wordBreak:"break-word",heightLimit:z?-1:n-Math.floor(r[0]+r[2]),pickable:!1,dx:M,whiteSpace:1!==k.length||P?"normal":"no-wrap"},W={x:0,y:0,text:s.text?Object.assign({},s.text,D):D,icon:{width:Math.floor(p/1.4),height:Math.floor(p/1.4)},box:{width:p,height:p},spaceBetweenTextAndIcon:f,disabled:null!==(u=null!=T?T:O)&&void 0!==u&&u};"indeterminate"===R?(W.checked=void 0,W.indeterminate=!0):(W.checked=R,W.indeterminate=void 0),v&&(W.box.fill=v),b&&(W.box.stroke=b),m&&(W.box.disableFill=m),y&&(W.box.checkedFill=y),C&&(W.box.checkedStroke=C),w&&(W.box.disableCheckedFill=w),x&&(W.box.disableCheckedStroke=x),_&&(W.icon.checkIconImage=_),S&&(W.icon.indeterminateIconImage=S);const N=new Uy(W);return N.name="checkbox",N}(n,r,s-j,a,l,h,p,f,g);return U&&t.appendChild(U),U.render(),a-=h[1]+h[3]+j,l-=h[0]+h[2],"center"===d?U.setAttribute("x",h[3]+V+(a-U.AABBBounds.width())/2):"right"===d?U.setAttribute("x",h[3]+V+a-U.AABBBounds.width()):U.setAttribute("x",h[3]+V),"middle"===c?U.setAttribute("y",h[0]+(l-U.AABBBounds.height())/2):"bottom"===c?U.setAttribute("y",h[0]+l-U.AABBBounds.height()):U.setAttribute("y",h[0]),t}function JO(t,e,i,o,n,r,s,a,l,h,d,c,u,g,p,f){var v,b,m,y,C,w,x,_,S,A,B,R;if(!t){const s=IR(n,r,g,u);(t=new PR({x:i,y:o,width:a,height:l,lineWidth:null!==(b=null===(v=null==g?void 0:g.group)||void 0===v?void 0:v.lineWidth)&&void 0!==b?b:void 0,fill:null!==(y=null===(m=null==g?void 0:g.group)||void 0===m?void 0:m.fill)&&void 0!==y?y:void 0,stroke:null!==(w=null===(C=null==g?void 0:g.group)||void 0===C?void 0:C.stroke)&&void 0!==w?w:void 0,strokeArrayWidth:s,strokeArrayColor:null!==(_=null===(x=null==g?void 0:g.group)||void 0===x?void 0:x.strokeArrayColor)&&void 0!==_?_:void 0,cursor:null!==(A=null===(S=null==g?void 0:g.group)||void 0===S?void 0:S.cursor)&&void 0!==A?A:void 0,lineDash:null!==(R=null===(B=null==g?void 0:g.group)||void 0===B?void 0:B.lineDash)&&void 0!==R?R:void 0,lineCap:"butt",clip:!0,cornerRadius:g.group.cornerRadius})).role="cell",t.col=n,t.row=r,null==e||e.addCellGroup(t)}const{width:T,height:k}=function(t,e,i,o,n,r,s,a,l,h,d){var c,u,g,p;const f=d._getCellStyle(t,e);let v=FR("size",f,t,e,d),b=FR("innerRadius",f,t,e,d),m=FR("outerRadius",f,t,e,d);const y=FR("spaceBetweenTextAndIcon",f,t,e,d),C=FR("spaceBetweenRadio",f,t,e,d),w=FR("defaultFill",f,t,e,d),x=FR("defaultStroke",f,t,e,d),_=FR("disableFill",f,t,e,d),S=FR("checkedFill",f,t,e,d),A=FR("checkedStroke",f,t,e,d),B=FR("disableCheckedFill",f,t,e,d),R=FR("disableCheckedStroke",f,t,e,d);ut(m)?v=2*m:m=Math.round(v/2),(!ut(b)||b<0)&&(b=Math.round(m/7*3));const T=d.getCellValue(t,e),k=d.getCellOriginValue(t,e),M=DR(t,e,d),L=d._getCellStyle(t,e),P=null!==(c=L.autoWrapText)&&void 0!==c?c:d.internalProps.autoWrapText,{lineClamp:E}=L,H="auto"===i,F=d.isAutoRowHeight(e),O={maxLineWidth:H?1/0:o-(r[1]+r[3]+M)-v-y,textAlign:"left",textBaseline:"top",autoWrapText:P,lineClamp:E,wordBreak:"break-word",heightLimit:F?-1:n-Math.floor(r[0]+r[2]),pickable:!1,dx:M},I={x:0,y:0,text:s.text?Object.assign({},s.text,O):O,circle:{innerRadius:b,outerRadius:m},spaceBetweenTextAndIcon:y};w&&(I.circle.fill=w),x&&(I.circle.stroke=x),_&&(I.circle.disableFill=_),S&&(I.circle.checkedFill=S),A&&(I.circle.checkedStroke=A),B&&(I.circle.disableCheckedFill=B),R&&(I.circle.disableCheckedStroke=R);let z=0,D=0;const W=null!==(u=a.radioDirectionInCell)&&void 0!==u?u:"vertical";if(ht(T))T.forEach(((i,o)=>{var n,r;const s=QO(i,k,o,t,e,a,P,I,d);s&&l.appendChild(s),s.id=`radio-${null!==(n=null==h?void 0:h.start.col)&&void 0!==n?n:t}-${null!==(r=null==h?void 0:h.start.row)&&void 0!==r?r:e}-${o}`,s.render();const c=s.AABBBounds;"vertical"===W?(s.setAttribute("y",D),D+=c.height()+(o!==T.length-1?C:0),z=Math.max(z,c.width())):"horizontal"===W&&(s.setAttribute("x",z),z+=c.width()+(o!==T.length-1?C:0),D=Math.max(D,c.height()))}));else{const i=QO(T,k,void 0,t,e,a,P,I,d);i&&l.appendChild(i),i.id=`radio-${null!==(g=null==h?void 0:h.start.col)&&void 0!==g?g:t}-${null!==(p=null==h?void 0:h.start.row)&&void 0!==p?p:e}`,i.render();const o=i.AABBBounds;z=o.width(),D=o.height()}return{width:z,height:D}}(n,r,s,a,l,h,g,p,t,f,u);return a-=h[1]+h[3],l-=h[0]+h[2],t.forEachChildren((t=>{"center"===d?t.setAttribute("x",h[3]+t.attribute.x+(a-T)/2):"right"===d?t.setAttribute("x",h[3]+t.attribute.x+a-T):t.setAttribute("x",h[3]+t.attribute.x),"middle"===c?t.setAttribute("y",h[0]+t.attribute.y+(l-k)/2):"bottom"===c?t.setAttribute("y",h[0]+t.attribute.y+l-k):t.setAttribute("y",h[0]+t.attribute.y)})),t}function QO(t,e,i,o,n,r,s,a,l){const h=function(t,e,i,o,n,r,s){var a,l;const h=null!==(a=r.radioCheckType)&&void 0!==a?a:"column";let d,c;return nt(t)?d=t.checked:"boolean"==typeof t&&(d=t),d=s.stateManager.syncRadioState(o,n,r.field,h,i,d),null!=d&&"function"!=typeof d||(c=ux(r.checked,{col:o,row:n,table:s,context:null,value:t,dataValue:e}),d=s.stateManager.syncRadioState(o,n,r.field,h,i,c)),null!==(l=null!=d?d:c)&&void 0!==l&&l}(t,e,i,o,n,r,l),d=function(t,e,i,o,n,r){var s;let a;nt(t)&&(a=t.disable);const l=ux(n.disable,{col:i,row:o,table:r,context:null,value:t,dataValue:e});return null!==(s=null!=a?a:l)&&void 0!==s&&s}(t,e,o,n,r,l),c=nt(t)?t.text:tt(t)?"":null!=t?t:"",u=Tt({},a,{checked:h,disabled:d,text:{text:1===c.length?c[0]:c,whiteSpace:1!==c.length||s?"normal":"no-wrap"},boundsPadding:0}),g=new $y(u);return g.name="radio",g}function tI(t,e,i,o,n,r,s,a,l,h,d,c,u,g,p,f,v,b){var m,y,C,w,x,_,S,A,B,R,T,k,M,L,P,E,H,F,O,I,z,D,W,N;if(!t){const s=IR(n,r,p,g);b&&(t=g.scenegraph.highPerformanceGetCell(n,r,!0))&&"cell"===t.role&&t.setAttributes({x:i,y:o,width:a,height:l,lineWidth:null!==(y=null===(m=null==p?void 0:p.group)||void 0===m?void 0:m.lineWidth)&&void 0!==y?y:void 0,fill:null!==(w=null===(C=null==p?void 0:p.group)||void 0===C?void 0:C.fill)&&void 0!==w?w:void 0,stroke:null!==(_=null===(x=null==p?void 0:p.group)||void 0===x?void 0:x.stroke)&&void 0!==_?_:void 0,strokeArrayWidth:s,strokeArrayColor:null!==(A=null===(S=null==p?void 0:p.group)||void 0===S?void 0:S.strokeArrayColor)&&void 0!==A?A:void 0,cursor:null!==(R=null===(B=null==p?void 0:p.group)||void 0===B?void 0:B.cursor)&&void 0!==R?R:void 0,lineDash:null!==(k=null===(T=null==p?void 0:p.group)||void 0===T?void 0:T.lineDash)&&void 0!==k?k:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius}),t&&"cell"===t.role||((t=new PR({x:i,y:o,width:a,height:l,lineWidth:null!==(L=null===(M=null==p?void 0:p.group)||void 0===M?void 0:M.lineWidth)&&void 0!==L?L:void 0,fill:null!==(E=null===(P=null==p?void 0:p.group)||void 0===P?void 0:P.fill)&&void 0!==E?E:void 0,stroke:null!==(F=null===(H=null==p?void 0:p.group)||void 0===H?void 0:H.stroke)&&void 0!==F?F:void 0,strokeArrayWidth:s,strokeArrayColor:null!==(I=null===(O=null==p?void 0:p.group)||void 0===O?void 0:O.strokeArrayColor)&&void 0!==I?I:void 0,cursor:null!==(D=null===(z=null==p?void 0:p.group)||void 0===z?void 0:z.cursor)&&void 0!==D?D:void 0,lineDash:null!==(N=null===(W=null==p?void 0:p.group)||void 0===W?void 0:W.lineDash)&&void 0!==N?N:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius})).role="cell",t.col=n,t.row=r,null==e||e.addCellGroup(t))}let G;if(u){let t=n,e=r;v&&(t=v.start.col,e=v.start.row),G=g.getCellIcons(t,e)}let j=0,V=0;if(Array.isArray(G)&&0!==G.length){const{leftIconWidth:e,rightIconWidth:i,absoluteLeftIconWidth:o,absoluteRightIconWidth:n}=UR(G,t,v,g);j=e+i,V=e,t.forEachChildren((t=>{"icon-left"===t.role?t.setAttribute("x",t.attribute.x+h[3]):"icon-right"===t.role?t.setAttribute("x",t.attribute.x+a-i-h[1]):"icon-absolute-right"===t.role&&t.setAttribute("x",t.attribute.x+a-n-h[1])})),t.forEachChildren((t=>{"middle"===c?t.setAttribute("y",(l-t.AABBBounds.height())/2):"bottom"===c?t.setAttribute("y",l-t.AABBBounds.height()-h[2]):t.setAttribute("y",h[0])}))}const U=function(t,e,i,o,n,r,s,a,l){var h,d,c,u;const g=l._getCellStyle(t,e),p=FR("spaceBetweenTextAndCircle",g,t,e,l),f=FR("circleRadius",g,t,e,l),v=FR("boxWidth",g,t,e,l),b=FR("boxHeight",g,t,e,l),m=FR("checkedFill",g,t,e,l),y=FR("uncheckedFill",g,t,e,l),C=FR("disableCheckedFill",g,t,e,l),w=FR("disableUncheckedFill",g,t,e,l),x=FR("circleFill",g,t,e,l),_=l.getCellValue(t,e),S=l.getCellOriginValue(t,e);let A,B,R=null!==(h=_)&&void 0!==h?h:"";nt(_)?(A=_.checked,B=_.disable,R=null!==(d=_.text)&&void 0!==d?d:""):"boolean"==typeof _&&(A=_,R=""),A=l.stateManager.syncCheckedState(t,e,a.field,A);const T=DR(t,e,l),k=l._getCellStyle(t,e),M=null!==(c=k.autoWrapText)&&void 0!==c?c:l.internalProps.autoWrapText,{lineClamp:L}=k,{checked:P,disable:E,uncheckedText:H,checkedText:F}=a;if(null==A||"function"==typeof A){const i=ux(P,{col:t,row:e,table:l,context:null,value:_,dataValue:S});A=l.stateManager.syncCheckedState(t,e,a.field,i)}const O=ux(E,{col:t,row:e,table:l,context:null,value:_,dataValue:S}),I=ux(F,{col:t,row:e,table:l,context:null,value:_,dataValue:S}),z=ux(H,{col:t,row:e,table:l,context:null,value:_,dataValue:S}),D="auto"===i,W=l.isAutoRowHeight(e),N={text:1===R.length?R[0]:R,maxLineWidth:D?1/0:o-(r[1]+r[3]+T)-2*f-p,textAlign:"left",textBaseline:"top",autoWrapText:M,lineClamp:L,wordBreak:"break-word",heightLimit:W?-1:n-Math.floor(r[0]+r[2]),pickable:!1,dx:T,whiteSpace:1!==R.length||M?"normal":"no-wrap",checkedText:I,uncheckedText:z},G={x:0,y:0,text:s.text?Object.assign({},s.text,N):N,circle:{radius:f},box:{width:v,height:b},spaceBetweenTextAndCircle:p,disabled:null!==(u=null!=B?B:O)&&void 0!==u&&u};G.checked=A,y&&(G.box.uncheckedFill=y),w&&(G.box.disableUncheckedFill=w),m&&(G.box.checkedFill=m),C&&(G.box.disableCheckedFill=C),x&&(G.circle.fill=x);const j=new Yy(G);return j.name="switch",j}(n,r,s-j,a,l,h,p,f,g);return U&&t.appendChild(U),U.render(),a-=h[1]+h[3]+j,l-=h[0]+h[2],"center"===d?U.setAttribute("x",h[3]+V+(a-U.AABBBounds.width())/2):"right"===d?U.setAttribute("x",h[3]+V+a-U.AABBBounds.width()):U.setAttribute("x",h[3]+V),"middle"===c?U.setAttribute("y",h[0]+(l-U.AABBBounds.height())/2):"bottom"===c?U.setAttribute("y",h[0]+l-U.AABBBounds.height()):U.setAttribute("y",h[0]),t}const eI=new class extends MF{constructor(t){super(!1),this.type=dF.Point,this._padding=0,this.paddingInner(1,t),this.padding=this.paddingOuter,this.paddingInner=void 0,this.paddingOuter=void 0}},iI=new ZF;function oI(t,e,i,o,n,r,s,a,l,h,d,c){var u,g,p,f,v,b,m,y,C,w,x,_,S,A,B,R,T,k,M,L,P,E,H,F;if(!t){const l=IR(n,r,d,h);c&&(t=h.scenegraph.highPerformanceGetCell(n,r,!0))&&"cell"===t.role&&t.setAttributes({x:i,y:o,width:s,height:a,lineWidth:null!==(g=null===(u=null==d?void 0:d.group)||void 0===u?void 0:u.lineWidth)&&void 0!==g?g:void 0,fill:null!==(f=null===(p=null==d?void 0:d.group)||void 0===p?void 0:p.fill)&&void 0!==f?f:void 0,stroke:null!==(b=null===(v=null==d?void 0:d.group)||void 0===v?void 0:v.stroke)&&void 0!==b?b:void 0,strokeArrayWidth:l,strokeArrayColor:null!==(y=null===(m=null==d?void 0:d.group)||void 0===m?void 0:m.strokeArrayColor)&&void 0!==y?y:void 0,cursor:null!==(w=null===(C=null==d?void 0:d.group)||void 0===C?void 0:C.cursor)&&void 0!==w?w:void 0,lineDash:null!==(_=null===(x=null==d?void 0:d.group)||void 0===x?void 0:x.lineDash)&&void 0!==_?_:void 0,lineCap:"butt",clip:!0,cornerRadius:d.group.cornerRadius}),t&&"cell"===t.role||((t=new PR({x:i,y:o,width:s,height:a,lineWidth:null!==(A=null===(S=null==d?void 0:d.group)||void 0===S?void 0:S.lineWidth)&&void 0!==A?A:void 0,fill:null!==(R=null===(B=null==d?void 0:d.group)||void 0===B?void 0:B.fill)&&void 0!==R?R:void 0,stroke:null!==(k=null===(T=null==d?void 0:d.group)||void 0===T?void 0:T.stroke)&&void 0!==k?k:void 0,strokeArrayWidth:l,strokeArrayColor:null!==(L=null===(M=null==d?void 0:d.group)||void 0===M?void 0:M.strokeArrayColor)&&void 0!==L?L:void 0,cursor:null!==(E=null===(P=null==d?void 0:d.group)||void 0===P?void 0:P.cursor)&&void 0!==E?E:void 0,lineDash:null!==(F=null===(H=null==d?void 0:d.group)||void 0===H?void 0:H.lineDash)&&void 0!==F?F:void 0,lineCap:"butt",clip:!0,cornerRadius:d.group.cornerRadius})).role="cell",t.col=n,t.row=r,null==e||e.addCellGroup(t))}const O=function(t,e,i,o,n,r){let s,a;const l=r.internalProps.layoutMap.getBody(t,e).sparklineSpec,h=r.getCellValue(t,e);if(!Array.isArray(h))return;const d=n[3],c=n[0];i-=n[1]+n[3];const u=o-=n[0]+n[2];if("function"==typeof l){const n={col:t,row:e,dataValue:r.getCellOriginValue(t,e)||"",value:r.getCellValue(t,e)||"",rect:r.getCellRangeRelativeRect(r.getCellRange(t,e)),table:r};s=l(n),a=nI(s,d,c,i,o)}else s=l,a=nI(l,d,c,i,o);const g=[],p=[];let f,v;if("object"==typeof s.xField)eI.domain(s.xField.domain),f=s.xField.field;else if("string"==typeof s.xField){const t=h.map((t=>t[s.xField]));eI.domain(t),f=s.xField}else Array.isArray(h)&&(eI.domain(Array.from({length:h.length},((t,e)=>e))),f=s.xField);if(eI.range([0,i]),"object"==typeof s.yField)iI.domain(s.yField.domain),v=s.yField.field;else if("string"==typeof s.yField){const t=rI(h,s.yField);iI.domain([Math.min(...t),Math.max(...t)]),v=s.yField}else if(Array.isArray(h)){const t=rI(h);iI.domain([Math.min(...t),Math.max(...t)]),v=s.yField}if(iI.range([0,o]),"object"==typeof s.xField&&Array.isArray(s.xField.domain)){const t=h.map((t=>t[s.xField.field])),e=s.xField.domain;for(let i=0;i<e.length;i++){let o=!1;for(let n=0;n<t.length;n++)if(e[i]===t[n]){const t=h[n];if(!ot(t[f])||!ot(t[v]))break;g.push({x:0+eI.scale(t[f]),y:u-iI.scale(t[v]),defined:ot(t[v])}),p.push(t),o=!0;break}o||(g.push({x:0+eI.scale(e[i]),y:0,defined:!1}),p.push({[f]:e[i],[v]:null}))}}else for(let t=0;t<h.length;t++){const e=h[t];g.push({x:0+eI.scale(f?e[f]:t),y:u-iI.scale(v?e[v]:e),defined:ot(v?e[v]:e),rawData:e}),p.push(e)}const b=a.getChildByName("sparkline-line");b&&b.setAttribute("points",g),b.bandwidth=eI.step(),b.min=iI.range()[0],b.max=iI.range()[1];const m=a.getChildByName("sparkline-symbol-group");if(m){const t="isolatedPoint"===s.pointShowRule;if("all"===s.pointShowRule)for(let t=0;t<g.length;t++){const{x:e,y:i,defined:o}=g[t];if(o){const t=Zd({x:e,y:i});m.appendChild(t)}}else if(t)for(let t=0;t<g.length;t++){const{x:e,y:i,defined:o}=g[t];if(o&&(!g[t-1]||!g[t-1].defined)&&(!g[t+1]||!g[t+1].defined)){const t=Zd({x:e,y:i});m.appendChild(t)}}}return a}(n,r,s,a,l,h);return O&&t.appendChild(O),t}function nI(t,e,i,o,n){var r,s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w,x,_,S,A,B;let R;R="function"==typeof t?t(null):t;const T=new PR({x:e,y:i,width:o,height:n,stroke:!1,fill:!1});if(T.name="sparkline","line"===R.type){const t=tc({x:0,y:0,curveType:R.smooth?"monotoneX":"linear",stroke:null!==(a=null===(s=null===(r=R.line)||void 0===r?void 0:r.style)||void 0===s?void 0:s.stroke)&&void 0!==a?a:"blue",lineWidth:null!==(d=null===(h=null===(l=R.line)||void 0===l?void 0:l.style)||void 0===h?void 0:h.strokeWidth)&&void 0!==d?d:2});t.name="sparkline-line",T.addChild(t),R.crosshair&&(t.hover=null!==(u=null===(c=R.crosshair)||void 0===c?void 0:c.style)&&void 0!==u?u:{stroke:"#000",interpolate:"linear"});const e=new PR({x:0,y:0,width:o,height:n,stroke:!1,fill:!1});e.name="sparkline-symbol-group",e.setTheme({symbol:{stroke:null!==(f=null===(p=null===(g=R.point)||void 0===g?void 0:g.style)||void 0===p?void 0:p.stroke)&&void 0!==f?f:"#000",lineWidth:null!==(m=null===(b=null===(v=R.point)||void 0===v?void 0:v.style)||void 0===b?void 0:b.strokeWidth)&&void 0!==m?m:1,fill:null!==(w=null===(C=null===(y=R.point)||void 0===y?void 0:y.style)||void 0===C?void 0:C.fill)&&void 0!==w?w:"#000",size:2*(null!==(S=null===(_=null===(x=R.point)||void 0===x?void 0:x.style)||void 0===_?void 0:_.size)&&void 0!==S?S:3),symbolType:"circle"}}),T.addChild(e),e.hover=null!==(B=null===(A=R.point)||void 0===A?void 0:A.hover)&&void 0!==B&&B}return T}function rI(t,e){const i=[];for(let o=0;o<t.length;o++){const n=t[o];ot(e)&&ot(n[e])?i.push(n[e]):!ot(e)&&ot(n)&&i.push(n)}return i}const sI=LR();function aI(t,e,i,o,n,r,s,a,l,h,d,c,u,g,p,f,v){var b,m,y,C,w,x,_,S,A,B,R,T,k,M,L,P,E,H,F,O,I,z,D,W,N,G,j,V,U,$;const X=OR("padding",g._getCellStyle(o,n),o,n,g);(null===(b=g.options.customConfig)||void 0===b?void 0:b.imageMargin)?h=tB(null===(m=g.options.customConfig)||void 0===m?void 0:m.imageMargin):ot(X)&&(h=X),(null===(y=null==p?void 0:p.text)||void 0===y?void 0:y.textAlign)&&(d=null===(C=null==p?void 0:p.text)||void 0===C?void 0:C.textAlign),(null===(w=null==p?void 0:p.text)||void 0===w?void 0:w.textBaseline)&&(c=null===(x=null==p?void 0:p.text)||void 0===x?void 0:x.textBaseline);const Y=IR(o,n,p,g);let K,q;if(v&&(K=g.scenegraph.highPerformanceGetCell(o,n,!0),K&&"cell"===K.role&&K.setAttributes({x:e,y:i,width:r,height:s,lineWidth:null!==(S=null===(_=null==p?void 0:p.group)||void 0===_?void 0:_.lineWidth)&&void 0!==S?S:void 0,fill:null!==(B=null===(A=null==p?void 0:p.group)||void 0===A?void 0:A.fill)&&void 0!==B?B:void 0,stroke:null!==(T=null===(R=null==p?void 0:p.group)||void 0===R?void 0:R.stroke)&&void 0!==T?T:void 0,strokeArrayWidth:Y,strokeArrayColor:null!==(M=null===(k=null==p?void 0:p.group)||void 0===k?void 0:k.strokeArrayColor)&&void 0!==M?M:void 0,cursor:null!==(P=null===(L=null==p?void 0:p.group)||void 0===L?void 0:L.cursor)&&void 0!==P?P:void 0,lineDash:null!==(H=null===(E=null==p?void 0:p.group)||void 0===E?void 0:E.lineDash)&&void 0!==H?H:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius})),K&&"cell"===K.role||(K=new PR({x:e,y:i,width:r,height:s,lineWidth:null!==(O=null===(F=null==p?void 0:p.group)||void 0===F?void 0:F.lineWidth)&&void 0!==O?O:void 0,fill:null!==(z=null===(I=null==p?void 0:p.group)||void 0===I?void 0:I.fill)&&void 0!==z?z:void 0,stroke:null!==(W=null===(D=null==p?void 0:p.group)||void 0===D?void 0:D.stroke)&&void 0!==W?W:void 0,strokeArrayWidth:Y,strokeArrayColor:null!==(G=null===(N=null==p?void 0:p.group)||void 0===N?void 0:N.strokeArrayColor)&&void 0!==G?G:void 0,cursor:null!==(V=null===(j=null==p?void 0:p.group)||void 0===j?void 0:j.cursor)&&void 0!==V?V:void 0,lineDash:null!==($=null===(U=null==p?void 0:p.group)||void 0===U?void 0:U.lineDash)&&void 0!==$?$:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius}),K.role="cell",K.col=o,K.row=n,null==t||t.addCellGroup(K)),u){let t=o,e=n;f&&(t=f.start.col,e=f.start.row),q=g.getCellIcons(t,e)}let Z=0,J=0;if(Array.isArray(q)&&0!==q.length){const{leftIconWidth:t,rightIconWidth:e,absoluteLeftIconWidth:i,absoluteRightIconWidth:o}=UR(q,K,f,g);Z=t,J=e,K.forEachChildren((t=>{"icon-left"===t.role?t.setAttribute("x",t.attribute.x+h[3]):"icon-right"===t.role?t.setAttribute("x",t.attribute.x+r-e-h[1]):"icon-absolute-right"===t.role&&t.setAttribute("x",t.attribute.x+r-o-h[1])})),K.forEachChildren((t=>{"middle"===c?t.setAttribute("y",(s-t.AABBBounds.height())/2):"bottom"===c?t.setAttribute("y",s-t.AABBBounds.height()-h[2]):t.setAttribute("y",h[0])})),K._cellLeftIconWidth=Z,K._cellRightIconWidth=J}const Q=g.getCellValue(o,n),tt=document.createElement("video");tt.addEventListener("loadeddata",(()=>{l&&YR(o,n,tt.videoWidth,tt.videoHeight,g.scenegraph,h,K);const{width:t,height:e,isMerge:i}=qR(K,g);if(a){const{width:i,height:o}=ER(tt.videoWidth,tt.videoHeight,t-h[1]-h[3],e-h[0]-h[2]),n=HR(0,0,t,e,i,o,d,c,h);et.setAttributes({width:i,height:o,x:n.x,y:n.y,dx:0})}else et.setAttributes({x:h[3],y:h[0],width:t-h[1]-h[3],height:e-h[2]-h[0],dy:0});i&&ZR(K.mergeStartCol,K.mergeEndCol,K.mergeStartRow,K.mergeEndRow,g);const{width:r,height:s}=qR(K,g),u=Math.floor(Math.min(r-h[1]-h[3],s-h[2]-h[0])/2),p=0+(r>et.attribute.width?et.attribute.x-0+et.attribute.width/2:r/2),f=0+(s>et.attribute.height?et.attribute.y-0+et.attribute.height/2:s/2),v=K.getChildByName("image",!0),{dx:b,dy:m}=v.attribute,y=new WB({x:p-u/2,y:f-u/2,width:u,height:u,image:sI.play.svg,cursor:sI.play.cursor,dx:b,dy:m});y.name="play-icon",K.appendChild(y),g.scenegraph.updateNextFrame()})),tt.onerror=()=>{et.image=sI.damage_pic.svg},tt.src=Q,tt.setAttribute("preload","auto");const et=lc({x:h[3],y:h[0],width:r-h[1]-h[3],height:s-h[2]-h[0],image:tt,cursor:"pointer"});return et.name="image",et.keepAspectRatio=a,et.textAlign=d,et.textBaseline=c,K.appendChild(et),K}function lI(t,e,i,o,n,r,s,a,l,h,d,c,u,g,p,f,v,b,m){var y,C,w,x,_,S,A,B,R,T,k,M,L,P,E,H,F,O,I,z,D,W,N,G,j,V,U,$,X,Y,K,q,Z;const J=t._getCellStyle(r,s),Q=OR("padding",J,r,s,t);ot(Q)&&(d=Q),(null===(y=null==v?void 0:v.text)||void 0===y?void 0:y.textAlign)&&(c=null===(C=null==v?void 0:v.text)||void 0===C?void 0:C.textAlign),(null===(w=null==v?void 0:v.text)||void 0===w?void 0:w.textBaseline)&&(u=null===(x=null==v?void 0:v.text)||void 0===x?void 0:x.textBaseline);const tt=t.isAutoRowHeight(s),et="auto"===a,it=null!==(_=J.autoWrapText)&&void 0!==_?_:t.internalProps.autoWrapText,nt=J.lineClamp,rt=IR(r,s,v,t);let st;if(m&&(st=t.scenegraph.getCell(r,s,!0),st&&"cell"===st.role&&st.setAttributes({x:o,y:n,width:l,height:h,lineWidth:null!==(A=null===(S=null==v?void 0:v.group)||void 0===S?void 0:S.lineWidth)&&void 0!==A?A:void 0,fill:null!==(R=null===(B=null==v?void 0:v.group)||void 0===B?void 0:B.fill)&&void 0!==R?R:void 0,stroke:null!==(k=null===(T=null==v?void 0:v.group)||void 0===T?void 0:T.stroke)&&void 0!==k?k:void 0,strokeArrayWidth:null!=rt?rt:void 0,strokeArrayColor:null!==(L=null===(M=null==v?void 0:v.group)||void 0===M?void 0:M.strokeArrayColor)&&void 0!==L?L:void 0,cursor:null!==(E=null===(P=null==v?void 0:v.group)||void 0===P?void 0:P.cursor)&&void 0!==E?E:void 0,lineDash:null!==(F=null===(H=null==v?void 0:v.group)||void 0===H?void 0:H.lineDash)&&void 0!==F?F:void 0,lineCap:"butt",clip:!0,cornerRadius:v.group.cornerRadius})),st&&"cell"===st.role||(st=new PR({x:o,y:n,width:l,height:h,lineWidth:null!==(I=null===(O=null==v?void 0:v.group)||void 0===O?void 0:O.lineWidth)&&void 0!==I?I:void 0,fill:null!==(D=null===(z=null==v?void 0:v.group)||void 0===z?void 0:z.fill)&&void 0!==D?D:void 0,stroke:null!==(N=null===(W=null==v?void 0:v.group)||void 0===W?void 0:W.stroke)&&void 0!==N?N:void 0,strokeArrayWidth:null!=rt?rt:void 0,strokeArrayColor:null!==(j=null===(G=null==v?void 0:v.group)||void 0===G?void 0:G.strokeArrayColor)&&void 0!==j?j:void 0,cursor:null!==(U=null===(V=null==v?void 0:v.group)||void 0===V?void 0:V.cursor)&&void 0!==U?U:void 0,lineDash:null!==(X=null===($=null==v?void 0:v.group)||void 0===$?void 0:$.lineDash)&&void 0!==X?X:void 0,lineCap:"butt",clip:!0,cornerRadius:v.group.cornerRadius}),st.role="cell",st.col=r,st.row=s,null==i||i.addCellGroup(st)),p&&st.appendChild(p),f){const i=e;let o;if(g){let e=r,i=s;b&&(e=b.start.col,i=b.start.row),o=t.getCellIcons(e,i)}(function(t,e,i,o,n,r,s,a,l,h,d,c,u,g,p){var f,v,b,m,y,C,w,x,_;let S,A=0,B=0,R=0;if(Array.isArray(e)&&0!==e.length){const{inlineFrontIcons:f,inlineEndIcons:v,contentLeftIcons:b,contentRightIcons:T,leftIconWidth:k,rightIconWidth:M,absoluteRightIconWidth:L}=UR(e,t,p,u);let P;if(A=k,B=M,R=L,0===f.length&&0===v.length){let e=0;ut(u.theme._contentOffset)&&("left"===d?e=u.theme._contentOffset:"right"===d&&(e=-u.theme._contentOffset));const c=p?DR(p.start.col,p.start.row,u):DR(t.col,t.row,u),{text:f,moreThanMaxCharacters:v}=WR(i,u),w={text:1===f.length?f[0]:f,moreThanMaxCharacters:v,maxLineWidth:n?1/0:l-(o[1]+o[3])-A-B-c,textBaseline:"top",heightLimit:!1===(null===(m=u.options.customConfig)||void 0===m?void 0:m.limitContentHeight)||r&&!(null===(y=u.options.customConfig)||void 0===y?void 0:y.multilinesForXTable)?-1:h-Math.floor(o[0]+o[2]),pickable:!1,autoWrapText:s,lineClamp:a,wordBreak:"break-word",whiteSpace:!1===(null===(C=u.options.customConfig)||void 0===C?void 0:C.limitContentHeight)||1!==f.length||s?"normal":"no-wrap",dx:("left"===d?b.length?0:c:0)+e,keepCenterInLine:!0},x=new zh(g.text?Object.assign({},g.text,w):w);x.name="text",P=x}else{const e=Object.assign({text:null==i?void 0:i.toString()},(null===(_=null===(x=null===(w=t.parent)||void 0===w?void 0:w.theme)||void 0===x?void 0:x.userTheme)||void 0===_?void 0:_.text)||{});g.text&&Object.assign(e,g.text),e.textBaseline="middle";const a=[...f.map((t=>GR(t))),e,...v.map((t=>GR(t)))];a[0].textAlign=d;const u=new gc({width:n?0:l-(o[1]+o[3])-A-B,height:r&&s?0:Math.ceil(h-(o[0]+o[2])),textConfig:a,verticalDirection:r&&s?"top":c,ellipsis:e.ellipsis});u.name="text",P=u,u.bindIconEvent(),!p||p.start.col===p.end.col&&p.start.row===p.end.row||(u.onBeforeAttributeUpdate=$R)}if(0!==b.length||0!==T.length){const e=new zR({x:0,y:0,fill:!1,stroke:!1,pickable:!1});e.name="content",e.setCellContentOption({autoWidth:n,autoHeight:r,cellWidth:l-(o[1]+o[3])-A-B,cellHeight:h-(o[0]+o[2]),align:d,baseline:c});const i={addedHierarchyOffset:0};b.forEach((o=>{const n=NR(o,void 0,t.col,t.row,p,u,i);n.role="icon-content-left",n.name=o.name,e.addLeftOccupyingIcon(n)})),T.forEach((o=>{const n=NR(o,void 0,t.col,t.row,p,u,i);n.role="icon-content-right",n.name=o.name,e.addRightOccupyingIcon(n)})),e.addContent(P),t.appendChild(e),e.layout(),S=e.AABBBounds.width(),e.AABBBounds.height()}else t.firstChild?t.insertBefore(P,t.firstChild):t.appendChild(P),S=P.AABBBounds.width(),P.AABBBounds.height()}else if(ot(i)){const{text:e,moreThanMaxCharacters:m}=WR(i,u),y=p?DR(p.start.col,p.start.row,u):DR(t.col,t.row,u);let C=0;ut(u.theme._contentOffset)&&("left"===d?C=u.theme._contentOffset:"right"===d&&(C=-u.theme._contentOffset));const w={text:1===e.length?e[0]:e,moreThanMaxCharacters:m,maxLineWidth:n?1/0:l-(o[1]+o[3]+y),textBaseline:"top",autoWrapText:s,lineClamp:a,wordBreak:"break-word",heightLimit:!1===(null===(f=u.options.customConfig)||void 0===f?void 0:f.limitContentHeight)||r&&!(null===(v=u.options.customConfig)||void 0===v?void 0:v.multilinesForXTable)?-1:h-Math.floor(o[0]+o[2]),pickable:!1,dx:("left"===d?y:0)+C,whiteSpace:!1===(null===(b=u.options.customConfig)||void 0===b?void 0:b.limitContentHeight)||1!==e.length||s?"normal":"no-wrap",keepCenterInLine:!0},x=new zh(g.text?Object.assign({},g.text,w):w);x.name="text",x.textBaseline=c,t.appendChild(x),S=x.AABBBounds.width(),x.AABBBounds.height()}const T=n?A+S+B:l-(o[1]+o[3]),k=h-(o[0]+o[2]);t.forEachChildren((t=>{"icon-left"===t.role?t.setAttribute("x",t.attribute.x+o[3]):"icon-right"===t.role?t.setAttribute("x",t.attribute.x+T-B+o[3]):"icon-absolute-right"===t.role?t.setAttribute("x",t.attribute.x+T-R+o[3]+o[1]):"content"!==t.name&&"text"!==t.name||("center"===d&&"richtext"!==t.type?t.setAttribute("x",o[3]+A+(T-A-B)/2):"right"===d&&"richtext"!==t.type?t.setAttribute("x",o[3]+T-B):t.setAttribute("x",o[3]+A))})),t.forEachChildren((t=>{t.name!==KB&&("middle"===c?t.setAttribute("y",o[0]+(k-t.AABBBounds.height())/2):"bottom"===c?t.setAttribute("y",o[0]+k-t.AABBBounds.height()):t.setAttribute("y",o[0]))})),t.setAttributes({width:T+o[1]+o[3],height:k+o[0]+o[2]})})(st,o,i,d,et,tt,it,"number"==typeof nt?nt:void 0,st.attribute.width,st.attribute.height,c,u,t,v,b),(null===(Y=null==v?void 0:v._vtable)||void 0===Y?void 0:Y.marked)&&function(t,e,i){if("boolean"==typeof t){const t=xc({x:e.attribute.width,y:0,startAngle:Math.PI/2,endAngle:Math.PI,outerRadius:6,fill:"#3073F2",pickable:!1});t.name="mark",e.appendChild(t)}else{const{bgColor:i="#3073F2",shape:o="sector",position:n="right-top",size:r=10,offset:s=0}=t;let a,l,h,d,c,u;if("sector"===o)"right-top"===n?(a=e.attribute.width-s,l=s,h=Math.PI/2,d=Math.PI):"left-top"===n?(a=s,l=s,h=0,d=Math.PI/2):"right-bottom"===n?(a=e.attribute.width-s,l=e.attribute.height-s,h=Math.PI,d=Math.PI/2*3):"left-bottom"===n&&(a=s,l=e.attribute.height-s,h=Math.PI/2*3,d=2*Math.PI),c=i,u=xc({x:a,y:l,startAngle:h,endAngle:d,outerRadius:r,fill:c,pickable:!1});else if("triangle"===o){let t,o,h,d;"right-top"===n?(a=e.attribute.width-s,l=s,t=a-r,o=l,h=a,d=l+r):"left-top"===n?(a=s,l=s,t=a+r,o=l,h=a,d=l+r):"right-bottom"===n?(a=e.attribute.width-s,l=e.attribute.height-s,t=a-r,o=l,h=a,d=l-r):"left-bottom"===n&&(a=s,l=e.attribute.height-s,t=a+r,o=l,h=a,d=l-r),c=i,u=Ac({points:[{x:a,y:l},{x:t,y:o},{x:h,y:d}],fill:c,pickable:!1})}else"rect"===o&&("right-top"===n?(a=e.attribute.width-r-s,l=s):"left-top"===n?(a=s,l=s):"right-bottom"===n?(a=e.attribute.width-r-s,l=e.attribute.height-r-s):"left-bottom"===n&&(a=s,l=e.attribute.height-r-s),c=i,u=oc({x:a,y:l,width:r,height:r,fill:c,pickable:!1}));u.name="mark",e.appendChild(u)}}(null===(K=null==v?void 0:v._vtable)||void 0===K?void 0:K.marked,st)}return p&&st.setAttributes({width:Math.max(st.attribute.width,null!==(q=p.attribute.width)&&void 0!==q?q:0),height:Math.max(st.attribute.height,null!==(Z=p.attribute.height)&&void 0!==Z?Z:0)}),st}function hI(t,e,i,o,n,r,s,a,l,h){var d,c,u,g,p;if(t.dependField){const e=ux(t.dependField,{col:r,row:s,table:l,value:o,dataValue:n,cellHeaderPaths:void 0});n=null!==(c=null===(d=l.getCellOriginRecord(r,s))||void 0===d?void 0:d[e])&&void 0!==c?c:n}const f=null!==(u=ux(t.barType,{col:r,row:s,table:l,value:o,dataValue:n,cellHeaderPaths:void 0}))&&void 0!==u?u:"default",v=null!==(g=ux(t.min,{col:r,row:s,table:l,value:o,dataValue:n,cellHeaderPaths:void 0}))&&void 0!==g?g:0,b=null!==(p=ux(t.max,{col:r,row:s,table:l,value:o,dataValue:n,cellHeaderPaths:void 0}))&&void 0!==p?p:v+100;let m=0;m=h?l.getRowsHeight(h.start.row,h.end.row):l.getRowHeight(s);let y=i,C=m,w=0;ut(l.theme._contentOffset)&&(w=l.theme._contentOffset);const x=new PR({x:-w,y:-w,width:y,height:C});x.name="progress-bar";const{showBar:_,barColor:S,barBgColor:A,barPositiveColor:B,barNegativeColor:R,barAxisColor:T,barRightToLeft:k,showBarMark:M,barMarkPositiveColor:L,barMarkNegativeColor:P,barMarkWidth:E,barMarkPosition:H,barMarkInBar:F}=e;let{barHeight:O,barBottom:I,barPadding:z}=e;1===z.length?z=[z[0],z[0],z[0],z[0]]:2===z.length?z=[z[0],z[1],z[0],z[1]]:3===z.length&&(z=[z[0],z[1],z[2],z[1]]),z=z.map(((t,e)=>{if("string"==typeof t&&wx.endsWith(t,"%")){const o=Number(t.substr(0,t.length-1));return 0===e||2===e?m*o/100:i*o/100}return Number(t)}));const D=tB(FR("borderLineWidth",e,r,s,l)),W=Math.max(z[0],Math.ceil(D[0]/2));let N=Math.max(z[1],Math.floor(D[1]/2));const G=Math.max(z[2],Math.floor(D[2]/2));let j=Math.max(z[3],Math.ceil(D[3]/2));M&&E>0&&"right"===H&&!1===F&&(N+=E,j+=E),y-=N+j,C-=G+W,s===l.rowCount-1&&[0,"0"].includes(I)&&(C-=1);const V=W,U=j,$=y;if("string"==typeof O&&wx.endsWith(O,"%")?(O=Number(O.substr(0,O.length-1)),O=C*O/100):O=Number(O),"string"==typeof I&&wx.endsWith(I,"%")?(I=Number(I.substr(0,I.length-1)),I=C*I/100):I=Number(I),ux(_,{col:r,row:s,table:l,context:null,value:o,dataValue:n})){let t=`${n}`;wx.endsWith(t,"%")&&(t=t.substr(0,t.length-1));const e=Number(t);if(isNaN(e))return x;if("default"===(null!=f?f:"default")){const t=e<v?0:e>b?1:(e-v)/(b-v),i=y,a=V+C-O-I;let h=Math.min(i*t,i);const d=k?U+$-h:U;r!==l.colCount-1||1!==t||k||(h-=1);const c=ux(A,{col:r,row:s,table:l,context:null,value:o,dataValue:n,percentile:t});if(c){const t=oc({x:d,y:a,width:i,height:O,fill:c});x.addChild(t)}const u=oc({x:d,y:a,width:h,height:O,fill:ux(S,{col:r,row:s,table:l,context:null,value:o,dataValue:n,percentile:t})||"#20a8d8"});x.addChild(u)}else if("negative"===f){const t=v<0?-v:0,i=b>0?b:0,a=t/(t+i),h=1-a,d=e>0?e/i:0,c=e<0?-e/t:0,u=y,g=V+C-O-I,p=U,f=ux(A,{col:r,row:s,table:l,context:null,value:o,dataValue:n,percentile:d});if(f){const t=oc({x:p,y:g,width:u,height:O,fill:f});x.addChild(t)}const w=k?h*u:a*u,_=Math.min(u*a*c,u),S=k?{left:p+w,top:g,width:_,height:O}:{left:p+w-_,top:g,width:_,height:O},z=ux(R,{col:r,row:s,table:l,context:null,value:o,dataValue:n,percentile:c})||"#20a8d8",D=oc({x:S.left,y:S.top,width:S.width,height:S.height,fill:z});x.addChild(D);let W=Math.min(u*h*d,u);r!==l.colCount-1||1!==d||k||(W-=1);const N=k?{left:p+w-W,top:g,width:W,height:O}:{left:p+w,top:g,width:W,height:O},G=ux(B,{col:r,row:s,table:l,context:null,value:o,dataValue:n,percentile:d})||"#20a8d8",j=oc({x:N.left,y:N.top,width:N.width,height:N.height,fill:G});x.addChild(j);const $=k?S.left:N.left,X=tc({x:0,y:0,stroke:ux(T,{col:r,row:s,table:l,context:null,value:o,dataValue:n,percentile:d}),lineWidth:1,lineDash:[2,2],points:[{x:$,y:0},{x:$,y:m}]});if(x.addChild(X),M&&(d||c)){const t=E,e=[];let i;if(d>0)if(i=ux(L,{col:r,row:s,table:l,context:null,value:o,dataValue:n,percentile:d})||"#20a8d8","right"===H){const t=k?N.left+E/2:N.left+N.width+(F?-E/2:E/2);e.push({x:t,y:N.top}),e.push({x:t,y:N.top+N.height})}else"bottom"===H&&(e.push({x:N.left,y:N.top+N.height-E/2}),e.push({x:N.left+N.width,y:N.top+N.height-E/2}));else if(c>0)if(i=ux(P,{col:r,row:s,table:l,context:null,value:o,dataValue:n,percentile:c})||"#20a8d8","right"===H){const t=k?S.left+S.width-E/2:S.left+E/2;e.push({x:t,y:S.top}),e.push({x:t,y:S.top+S.height})}else"bottom"===H&&(e.push({x:S.left,y:S.top+S.height-E/2}),e.push({x:S.left+S.width,y:S.top+S.height-E/2}));const a=tc({x:0,y:0,stroke:i,lineWidth:t,points:e});x.addChild(a)}}else if("negative_no_axis"===f){const t=v<0?-v:0,i=b>0?b:0,a=Math.max(t,i),h=0===a?0:Math.abs(e)/a,d=y;let c=Math.min(d*h,d);r!==l.colCount-1||1!==h||k||(c-=1);const u=V+C-O-I,g=k?U+$-c:U,p=ux(A,{col:r,row:s,table:l,context:null,value:o,dataValue:n,percentile:h});if(p){const t=oc({x:g,y:u,width:d,height:O,fill:p});x.addChild(t)}const f={left:g,top:u,width:c,height:O};let m;m=e>=0?ux(B,{col:r,row:s,table:l,context:null,value:o,percentile:h,dataValue:n})||"#20a8d8":ux(R,{col:r,row:s,table:l,context:null,value:o,dataValue:n,percentile:h})||"#20a8d8";const w=oc({x:f.left,y:f.top,width:f.width,height:f.height,fill:m});if(x.addChild(w),M&&e){const t=E,i=[];let a;if(a=e>=0?ux(L,{col:r,row:s,table:l,context:null,value:o,dataValue:n,percentile:h})||"#20a8d8":ux(P,{col:r,row:s,table:l,context:null,value:o,dataValue:n,percentile:h})||"#20a8d8","right"===H){const t=k?f.left+E/2:f.left+f.width-E/2;i.push({x:t,y:f.top}),i.push({x:t,y:f.top+f.height})}else"bottom"===H&&(i.push({x:f.left,y:f.top+f.height-E/2}),i.push({x:f.left+f.width,y:f.top+f.height-E/2}));const d=tc({x:0,y:0,stroke:a,lineWidth:t,points:i});x.addChild(d)}}}return x}function dI(t,e,i,o,n,r){var s,a,l,h,d,c,u,g,p,f,v,b,m,y,C,w;if((null==i?void 0:i.zero)&&(t=Math.min(t,0),e=Math.max(e,0)),null==i?void 0:i.expand){const o=t,n=e;ot(i.expand.min)&&(t=o-(n-o)*i.expand.min),ot(i.expand.max)&&(e=n+(n-o)*i.expand.max)}let x,_;if(ut(null==i?void 0:i.min)&&(t=i.min),ut(null==i?void 0:i.max)&&(e=i.max),"log"===(null==i?void 0:i.type)?(x=new eO,x.base(null!==(s=null==i?void 0:i.base)&&void 0!==s?s:10)):"symlog"===(null==i?void 0:i.type)?(x=new iO,x.constant(null!==(a=null==i?void 0:i.constant)&&void 0!==a?a:10)):x=new ZF,x.domain([t,e],!!(null==i?void 0:i.nice)),r)!function(t,e){t.niceMax(e.targetTicks.length)}(x,r);else if(null==i?void 0:i.nice){let t=null!==(c=null!==(h=null===(l=i.tick)||void 0===l?void 0:l.forceTickCount)&&void 0!==h?h:null===(d=i.tick)||void 0===d?void 0:d.tickCount)&&void 0!==c?c:10;et(t)&&(t=t({axisLength:n,labelStyle:null!==(g=null===(u=null==i?void 0:i.label)||void 0===u?void 0:u.style)&&void 0!==g?g:{fontSize:JH}})),"accurateFirst"===i.niceType&&(t=Math.max(10,t)),it(i.min)&&it(i.max)?x.nice(t):ot(i.min)&&it(i.max)?x.niceMax(t):it(i.min)&&ot(i.max)&&x.niceMin(t)}return delete x._niceType,_=(null!==(f=null===(p=null==r?void 0:r.targetTicks)||void 0===p?void 0:p.length)&&void 0!==f?f:null===(v=null==i?void 0:i.tick)||void 0===v?void 0:v.forceTickCount)?x.forceTicks(null!==(m=null===(b=null==r?void 0:r.targetTicks)||void 0===b?void 0:b.length)&&void 0!==m?m:null===(y=null==i?void 0:i.tick)||void 0===y?void 0:y.forceTickCount):x.ticks(ut(null===(C=null==i?void 0:i.tick)||void 0===C?void 0:C.tickCount)?i.tick.tickCount:5,{noDecimals:null===(w=null==i?void 0:i.tick)||void 0===w?void 0:w.noDecimals}),{range:x.domain(),ticks:_}}function cI(t,e,i,o,n,r,s,a,l,h,d,c,u,g,p,f,v,b){var m,y,C,w,x,_,S,A,B,R,T,k,M,L,P,E,H,F,O,I,z,D,W,N;if(!t){const s=IR(n,r,p,g);b&&(t=g.scenegraph.highPerformanceGetCell(n,r,!0))&&"cell"===t.role&&t.setAttributes({x:i,y:o,width:a,height:l,lineWidth:null!==(y=null===(m=null==p?void 0:p.group)||void 0===m?void 0:m.lineWidth)&&void 0!==y?y:void 0,fill:null!==(w=null===(C=null==p?void 0:p.group)||void 0===C?void 0:C.fill)&&void 0!==w?w:void 0,stroke:null!==(_=null===(x=null==p?void 0:p.group)||void 0===x?void 0:x.stroke)&&void 0!==_?_:void 0,strokeArrayWidth:s,strokeArrayColor:null!==(A=null===(S=null==p?void 0:p.group)||void 0===S?void 0:S.strokeArrayColor)&&void 0!==A?A:void 0,cursor:null!==(R=null===(B=null==p?void 0:p.group)||void 0===B?void 0:B.cursor)&&void 0!==R?R:void 0,lineDash:null!==(k=null===(T=null==p?void 0:p.group)||void 0===T?void 0:T.lineDash)&&void 0!==k?k:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius}),t&&"cell"===t.role||((t=new PR({x:i,y:o,width:a,height:l,lineWidth:null!==(L=null===(M=null==p?void 0:p.group)||void 0===M?void 0:M.lineWidth)&&void 0!==L?L:void 0,fill:null!==(E=null===(P=null==p?void 0:p.group)||void 0===P?void 0:P.fill)&&void 0!==E?E:void 0,stroke:null!==(F=null===(H=null==p?void 0:p.group)||void 0===H?void 0:H.stroke)&&void 0!==F?F:void 0,strokeArrayWidth:s,strokeArrayColor:null!==(I=null===(O=null==p?void 0:p.group)||void 0===O?void 0:O.strokeArrayColor)&&void 0!==I?I:void 0,cursor:null!==(D=null===(z=null==p?void 0:p.group)||void 0===z?void 0:z.cursor)&&void 0!==D?D:void 0,lineDash:null!==(N=null===(W=null==p?void 0:p.group)||void 0===W?void 0:W.lineDash)&&void 0!==N?N:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius})).role="cell",t.col=n,t.row=r,null==e||e.addCellGroup(t))}let G;if(u){let t=n,e=r;v&&(t=v.start.col,e=v.start.row),G=g.getCellIcons(t,e)}let j=0,V=0;if(Array.isArray(G)&&0!==G.length){const{leftIconWidth:e,rightIconWidth:i,absoluteLeftIconWidth:o,absoluteRightIconWidth:n}=UR(G,t,v,g);j=e+i,V=e,t.forEachChildren((t=>{"icon-left"===t.role?t.setAttribute("x",t.attribute.x+h[3]):"icon-right"===t.role?t.setAttribute("x",t.attribute.x+a-i-h[1]):"icon-absolute-right"===t.role&&t.setAttribute("x",t.attribute.x+a-n-h[1])})),t.forEachChildren((t=>{"middle"===c?t.setAttribute("y",(l-t.AABBBounds.height())/2):"bottom"===c?t.setAttribute("y",l-t.AABBBounds.height()-h[2]):t.setAttribute("y",h[0])}))}const U=function(t,e,i,o,n,r,s,a,l){var h,d;const c=l._getCellStyle(t,e),u=FR("buttonColor",c,t,e,l),g=FR("buttonBorderColor",c,t,e,l),p=FR("buttonLineWidth",c,t,e,l),f=FR("buttonBorderRadius",c,t,e,l),v=FR("buttonHoverColor",c,t,e,l),b=FR("buttonHoverBorderColor",c,t,e,l),m=FR("buttonPadding",c,t,e,l),y=FR("buttonTextHoverColor",c,t,e,l),C=FR("buttonDisableColor",c,t,e,l),w=FR("buttonDisableBorderColor",c,t,e,l),x=FR("buttonTextDisableColor",c,t,e,l),_=l.getCellValue(t,e),S=l.getCellOriginValue(t,e),A=DR(t,e,l),B=l._getCellStyle(t,e),R=null!==(h=B.autoWrapText)&&void 0!==h?h:l.internalProps.autoWrapText,{lineClamp:T}=B,k="auto"===i,M=l.isAutoRowHeight(e),{disable:L,text:P}=a,E=ux(L,{col:t,row:e,table:l,context:null,value:_,dataValue:S}),H=ux(P,{col:t,row:e,table:l,context:null,value:_,dataValue:S}),F=null!==(d=null!=H?H:_)&&void 0!==d?d:"",O={maxLineWidth:k?1/0:o-(r[1]+r[3]+A),textAlign:"left",textBaseline:"top",autoWrapText:R,lineClamp:T,wordBreak:"break-word",heightLimit:M?-1:n-Math.floor(r[0]+r[2]),pickable:!1,dx:A,whiteSpace:1!==F.length||R?"normal":"no-wrap"},I=s.text?Object.assign({},s.text,O):O,z={x:0,y:0,cursor:E?"not-allowed":"pointer",disable:E,childrenPickable:!1,text:1===F.length?F[0]:F,textStyle:I,padding:m,panel:{visible:!0,fill:E?C:u,stroke:E?w:g,lineWidth:p,cornerRadius:f},state:{text:{hover:{}},panel:{hover:{fill:v,stroke:b}}}};x&&(z.state.text.fill=x),y&&(z.state.text.hover.fill=y);const D=new Qb(z);return D.name="button",E||(D.addEventListener("mouseenter",(()=>{D.addState("hover",!0,!1),D.stage.renderNextFrame()})),D.addEventListener("mouseleave",(()=>{D.removeState("hover",!1),D.stage.renderNextFrame()}))),D}(n,r,s-j,a,l,h,p,f,g);return U&&t.appendChild(U),a-=h[1]+h[3]+j,l-=h[0]+h[2],"center"===d?U.setAttribute("x",h[3]+V+(a-U.AABBBounds.width())/2):"right"===d?U.setAttribute("x",h[3]+V+a-U.AABBBounds.width()):U.setAttribute("x",h[3]+V),"middle"===c?U.setAttribute("y",h[0]+(l-U.AABBBounds.height())/2):"bottom"===c?U.setAttribute("y",h[0]+l-U.AABBBounds.height()):U.setAttribute("y",h[0]),t}a_.registerComponent("axis",dO),a_.registerFunction("computeAxisComponentWidth",cO),a_.registerFunction("computeAxisComponentHeight",uO),a_.registerFunction("getAxisConfigInPivotChart",wE),a_.registerComponent("emptyTip",fO),a_.registerFunction("createLegend",SO),a_.registerComponent("menuHandler",EO),a_.registerComponent("title",HO),a_.registerComponent("tooltipHandler",VO),a_.registerComponent("listTreeStickCellPlugin",UO),a_.registerComponent("customCellStylePlugin",kE),a_.registerFunction("createChartCellGroup",qO),a_.registerFunction("getAxisDomainRangeAndLabels",dI),a_.registerFunction("createCheckboxCellGroup",ZO),a_.registerFunction("createImageCellGroup",XR),a_.registerFunction("createProgressBarCell",hI),a_.registerFunction("createRadioCellGroup",JO),a_.registerFunction("createSwitchCellGroup",tI),a_.registerFunction("createButtonCellGroup",cI),a_.registerFunction("createSparkLineCellGroup",oI),a_.registerFunction("createTextCellGroup",lI),a_.registerFunction("createVideoCellGroup",aI);class uI extends lF{}class gI extends vs{constructor(t){var e,i,o,n,r,s,a,l,h,d,c,u,g,p;t.direction&&(t.flexDirection=t.direction),!t.justifyContent||"start"!==t.justifyContent&&"end"!==t.justifyContent||(t.justifyContent="flex-"+t.justifyContent),!t.alignItems||"start"!==t.alignItems&&"end"!==t.alignItems||(t.alignItems="flex-"+t.alignItems),!t.alignContent||"start"!==t.alignContent&&"end"!==t.alignContent||(t.alignContent="flex-"+t.alignContent),t.display="flex",t.flexDirection||(t.flexDirection="row"),t.clip=!0,t.fill=null===(e=null==t?void 0:t.background)||void 0===e?void 0:e.fill,t.stroke=null===(i=null==t?void 0:t.background)||void 0===i?void 0:i.stroke,t.lineWidth=null===(o=null==t?void 0:t.background)||void 0===o?void 0:o.lineWidth,t.cornerRadius=null===(n=null==t?void 0:t.background)||void 0===n?void 0:n.cornerRadius;const f=ht(t.boundsPadding),v=[null!==(s=null!==(r=t.marginTop)&&void 0!==r?r:f?t.boundsPadding[0]:t.boundsPadding)&&void 0!==s?s:0,null!==(l=null!==(a=t.marginRight)&&void 0!==a?a:f?t.boundsPadding[1]:t.boundsPadding)&&void 0!==l?l:0,null!==(c=null!==(h=t.marginBottom)&&void 0!==h?h:f?null!==(d=t.boundsPadding[2])&&void 0!==d?d:t.boundsPadding[0]:t.boundsPadding)&&void 0!==c?c:0,null!==(p=null!==(u=t.marginLeft)&&void 0!==u?u:f?null!==(g=t.boundsPadding[3])&&void 0!==g?g:t.boundsPadding[1]:t.boundsPadding)&&void 0!==p?p:0];t.boundsPadding=v,super(t)}}var pI=Object.freeze({__proto__:null,Arc:class extends wc{constructor(t){var e,i,o,n,r,s,a,l,h,d;const c=ht(t.boundsPadding),u=[null!==(i=null!==(e=t.marginTop)&&void 0!==e?e:c?t.boundsPadding[0]:t.boundsPadding)&&void 0!==i?i:0,null!==(n=null!==(o=t.marginRight)&&void 0!==o?o:c?t.boundsPadding[1]:t.boundsPadding)&&void 0!==n?n:0,null!==(a=null!==(r=t.marginBottom)&&void 0!==r?r:c?null!==(s=t.boundsPadding[2])&&void 0!==s?s:t.boundsPadding[0]:t.boundsPadding)&&void 0!==a?a:0,null!==(d=null!==(l=t.marginLeft)&&void 0!==l?l:c?null!==(h=t.boundsPadding[3])&&void 0!==h?h:t.boundsPadding[1]:t.boundsPadding)&&void 0!==d?d:0];t.boundsPadding=u,super(t)}},CheckBox:Uy,Circle:class extends Hh{constructor(t){var e,i,o,n,r,s,a,l,h,d;const c=ht(t.boundsPadding),u=[null!==(i=null!==(e=t.marginTop)&&void 0!==e?e:c?t.boundsPadding[0]:t.boundsPadding)&&void 0!==i?i:0,null!==(n=null!==(o=t.marginRight)&&void 0!==o?o:c?t.boundsPadding[1]:t.boundsPadding)&&void 0!==n?n:0,null!==(a=null!==(r=t.marginBottom)&&void 0!==r?r:c?null!==(s=t.boundsPadding[2])&&void 0!==s?s:t.boundsPadding[0]:t.boundsPadding)&&void 0!==a?a:0,null!==(d=null!==(l=t.marginLeft)&&void 0!==l?l:c?null!==(h=t.boundsPadding[3])&&void 0!==h?h:t.boundsPadding[1]:t.boundsPadding)&&void 0!==d?d:0];t.boundsPadding=u,super(t)}},Container:gI,Group:class extends vs{constructor(t){var e,i,o,n,r,s,a,l,h,d;const c=ht(t.boundsPadding),u=[null!==(i=null!==(e=t.marginTop)&&void 0!==e?e:c?t.boundsPadding[0]:t.boundsPadding)&&void 0!==i?i:0,null!==(n=null!==(o=t.marginRight)&&void 0!==o?o:c?t.boundsPadding[1]:t.boundsPadding)&&void 0!==n?n:0,null!==(a=null!==(r=t.marginBottom)&&void 0!==r?r:c?null!==(s=t.boundsPadding[2])&&void 0!==s?s:t.boundsPadding[0]:t.boundsPadding)&&void 0!==a?a:0,null!==(d=null!==(l=t.marginLeft)&&void 0!==l?l:c?null!==(h=t.boundsPadding[3])&&void 0!==h?h:t.boundsPadding[1]:t.boundsPadding)&&void 0!==d?d:0];t.boundsPadding=u,super(t)}},GroupElement:class extends gI{constructor(t){t.flexWrap="nowrap",super(t)}},Icon:class extends ac{constructor(t){var e,i,o,n,r,s,a,l,h,d,c,u;let g;lt(t.iconName)&&(g=LR()[t.iconName],g&&(t.width=null!==(e=t.width)&&void 0!==e?e:g.width,t.height=null!==(i=t.height)&&void 0!==i?i:g.height,t.svg=g.svg,t.cursor=g.cursor)),t.svg&&(t.image=t.svg);const p=ht(t.boundsPadding),f=[null!==(n=null!==(o=t.marginTop)&&void 0!==o?o:p?t.boundsPadding[0]:t.boundsPadding)&&void 0!==n?n:0,null!==(s=null!==(r=t.marginRight)&&void 0!==r?r:p?t.boundsPadding[1]:t.boundsPadding)&&void 0!==s?s:0,null!==(h=null!==(a=t.marginBottom)&&void 0!==a?a:p?null!==(l=t.boundsPadding[2])&&void 0!==l?l:t.boundsPadding[0]:t.boundsPadding)&&void 0!==h?h:0,null!==(u=null!==(d=t.marginLeft)&&void 0!==d?d:p?null!==(c=t.boundsPadding[3])&&void 0!==c?c:t.boundsPadding[1]:t.boundsPadding)&&void 0!==u?u:0];t.boundsPadding=f,super(t),this.cache=g}},Image:class extends ac{constructor(t){var e,i,o,n,r,s,a,l,h,d;t.src&&(t.image=t.src),"circle"===t.shape&&(t.cornerRadius=t.width/2);const c=ht(t.boundsPadding),u=[null!==(i=null!==(e=t.marginTop)&&void 0!==e?e:c?t.boundsPadding[0]:t.boundsPadding)&&void 0!==i?i:0,null!==(n=null!==(o=t.marginRight)&&void 0!==o?o:c?t.boundsPadding[1]:t.boundsPadding)&&void 0!==n?n:0,null!==(a=null!==(r=t.marginBottom)&&void 0!==r?r:c?null!==(s=t.boundsPadding[2])&&void 0!==s?s:t.boundsPadding[0]:t.boundsPadding)&&void 0!==a?a:0,null!==(d=null!==(l=t.marginLeft)&&void 0!==l?l:c?null!==(h=t.boundsPadding[3])&&void 0!==h?h:t.boundsPadding[1]:t.boundsPadding)&&void 0!==d?d:0];t.boundsPadding=u,super(t)}},Line:Qd,Radio:$y,Rect:class extends ic{constructor(t){var e,i,o,n,r,s,a,l,h,d;const c=ht(t.boundsPadding),u=[null!==(i=null!==(e=t.marginTop)&&void 0!==e?e:c?t.boundsPadding[0]:t.boundsPadding)&&void 0!==i?i:0,null!==(n=null!==(o=t.marginRight)&&void 0!==o?o:c?t.boundsPadding[1]:t.boundsPadding)&&void 0!==n?n:0,null!==(a=null!==(r=t.marginBottom)&&void 0!==r?r:c?null!==(s=t.boundsPadding[2])&&void 0!==s?s:t.boundsPadding[0]:t.boundsPadding)&&void 0!==a?a:0,null!==(d=null!==(l=t.marginLeft)&&void 0!==l?l:c?null!==(h=t.boundsPadding[3])&&void 0!==h?h:t.boundsPadding[1]:t.boundsPadding)&&void 0!==d?d:0];t.boundsPadding=u,super(t)}},Tag:class extends Qb{constructor(t){var e,i,o,n,r,s,a,l,h,d;const c=ht(t.boundsPadding),u=[null!==(i=null!==(e=t.marginTop)&&void 0!==e?e:c?t.boundsPadding[0]:t.boundsPadding)&&void 0!==i?i:0,null!==(n=null!==(o=t.marginRight)&&void 0!==o?o:c?t.boundsPadding[1]:t.boundsPadding)&&void 0!==n?n:0,null!==(a=null!==(r=t.marginBottom)&&void 0!==r?r:c?null!==(s=t.boundsPadding[2])&&void 0!==s?s:t.boundsPadding[0]:t.boundsPadding)&&void 0!==a?a:0,null!==(d=null!==(l=t.marginLeft)&&void 0!==l?l:c?null!==(h=t.boundsPadding[3])&&void 0!==h?h:t.boundsPadding[1]:t.boundsPadding)&&void 0!==d?d:0];t.boundsPadding=u,super(t)}getSize(t){this.AABBBounds.width()}},Text:class extends zh{constructor(t){var e,i,o,n,r,s,a,l,h,d,c;t.textBaseline||(t.textBaseline="top");const u=ht(t.boundsPadding),g=[null!==(i=null!==(e=t.marginTop)&&void 0!==e?e:u?t.boundsPadding[0]:t.boundsPadding)&&void 0!==i?i:0,null!==(n=null!==(o=t.marginRight)&&void 0!==o?o:u?t.boundsPadding[1]:t.boundsPadding)&&void 0!==n?n:0,null!==(a=null!==(r=t.marginBottom)&&void 0!==r?r:u?null!==(s=t.boundsPadding[2])&&void 0!==s?s:t.boundsPadding[0]:t.boundsPadding)&&void 0!==a?a:0,null!==(d=null!==(l=t.marginLeft)&&void 0!==l?l:u?null!==(h=t.boundsPadding[3])&&void 0!==h?h:t.boundsPadding[1]:t.boundsPadding)&&void 0!==d?d:0];t.boundsPadding=g,t.fill=null!==(c=t.fill)&&void 0!==c?c:"#000",super(t)}getSize(t){this.AABBBounds.width()}},percentCalc:function(t){return{percent:t,delta:arguments.length>1&&void 0!==arguments[1]?arguments[1]:0}}});qy();const fI=(t,e)=>(t=>{switch(Object.prototype.toString.call(t)){case"[object Object]":return"object";case"[object Function]":return"function";case"[object Array]":return"array";case"[object String]":return"string";case"[object Number]":return"number";case"[object RegExp]":return"regExp";case"[object Boolean]":return"boolean";case"[object Symbol]":return"symbol";case"[object Date]":return"date";case"[object Undefined]":return"undefined";case"[object Null]":return"null";case"[object Error]":return"error";case"[object HTMLDocument]":return"document";case"[object global]":return"global";default:return null}})(t)===e;function vI(t,e,i){let o,n,r,s,a,l,h=0,d=!1,c=!1,u=!0;const g=!e&&0!==e&&"function"==typeof requestAnimationFrame;if("function"!=typeof t)throw new TypeError("Expected a function");function p(e){const i=o,r=n;return n=void 0,o=void 0,h=e,s=t.apply(r,i),s}function f(t,e){return g?requestAnimationFrame(t):setTimeout(t,e)}function v(t){const i=t-l;return void 0===l||i>=e||i<0||d&&t-h>=r}function b(){const t=Date.now();if(v(t))return function(t){return a=void 0,u&&o?p(t):(n=void 0,o=void 0,s)}(t);a=f(b,function(t){const i=t-h,o=e&&-(t-l);return d?Math.min(o,r-i):o}(t))}return e=+e||0,fI(i,"object")&&(c=!!i.leading,d="maxWait"in i,d&&(r=Math.max(+i.maxWait||0,e)),u="trailing"in i?!!i.trailing:u),function(...t){const i=Date.now(),r=v(i);if(o=t,n=this,l=i,r){if(void 0===a)return function(t){return h=t,a=f(b,e),c?p(t):s}(l);if(d)return a=f(b,e),p(l)}return void 0===a&&(a=f(b,e)),s}}let bI=1;class mI{resizeTime=100;element;cb;observer;lastSize={width:0,height:0};callBackDebounce;constructor(t,e,i){if(this.element=t,this.cb=e,this.lastSize=this.getSize(),i&&(this.resizeTime=Math.max(i,16)),this.callBackDebounce=vI(this.callBack,this.resizeTime),window?.addEventListener("resize",this.onResize),"ResizeObserver"in window){const t=window.ResizeObserver;this.observer=new t(this.mutationResize),this.observer?.observe(this.element)}else"MutationObserver"in window&&(this.observer=new MutationObserver(this.mutationResize),this.observer.observe(this.element,{attributes:!0,attributeFilter:["style"]}))}mutationResize=()=>{this.onResize()};disConnect(){window.removeEventListener("resize",this.onResize),this.observer&&(this.observer.disconnect(),this.observer=void 0)}callBack=()=>{const t=this.getSize();let e=!1;t.width===this.lastSize.width&&t.height===this.lastSize.height&&(e=!0),this.lastSize=t,this.cb&&this.cb({...this.lastSize,windowSizeNotChange:e})};setSize(t){this.lastSize=t}onResize=()=>{this.callBackDebounce()};checkSize(){const t=this.getSize();return t.width!==this.lastSize.width||t.height!==this.lastSize.height}getSize(){return this.element?{width:Math.floor(this.element.clientWidth),height:Math.floor(this.element.clientHeight)}:{...this.lastSize}}}class yI{resizeTime;listeners={};reseizeListeners={};on(t,e,i,...o){if("node"===vC.mode)return-1;const n=bI++;if(t?.addEventListener)if("resize"!==e||t===window)t?.addEventListener(e,i,...o);else{const e=new mI(t,i,this.resizeTime);this.reseizeListeners[n]=e}const r={target:t,type:e,listener:i,options:o};return this.listeners[n]=r,n}once(t,e,i,...o){if("node"===vC.mode)return-1;const n=this.on(t,e,((...t)=>{this.off(n),i(...t)}),...o);return n}off(t){if("node"===vC.mode)return;if(null==t)return;const e=this.listeners?.[t];e&&(delete this.listeners[t],e.target.removeEventListener&&e.target.removeEventListener(e.type,e.listener,...e.options))}fire(t,e,...i){if("node"!==vC.mode)for(const o in this.listeners){const n=this.listeners[o];n.target===t&&n.type===e&&n.listener.call(n.target,...i)}}hasListener(t,e){if("node"===vC.mode)return!1;let i=!1;for(const o in this.listeners){const n=this.listeners[o];n.target===t&&n.type===e&&(i=!0)}return i}clear(){if("node"!==vC.mode){for(const t in this.listeners){const e=this.listeners[t];e.target.removeEventListener&&e.target.removeEventListener(e.type,e.listener,...e.options)}for(const t in this.reseizeListeners){const e=this.reseizeListeners[t];e?.disConnect()}this.listeners={}}}release(){"node"!==vC.mode&&(this.clear(),this.listeners={})}}let CI=1;function wI(){return CC?CI=1:(CI=Math.ceil(window.devicePixelRatio||1),CI>1&&CI%2!=0&&(CI+=1)),CI}wI();class xI{_gantt;_eventHandler;isDown=!1;isDraging=!1;lastDragPointerXYOnWindow;globalEventListeners=[];poniterState;constructor(t){this._gantt=t,this._eventHandler=new yI,this.bindEvent()}release(){this._eventHandler.release(),this.globalEventListeners.forEach((t=>{"document"===t.env?document.removeEventListener(t.name,t.callback):"body"===t.env?document.body.removeEventListener(t.name,t.callback):"window"===t.env&&window.removeEventListener(t.name,t.callback)})),this.globalEventListeners=[]}bindEvent(){!function(t){const i=t._gantt.scenegraph,r=t._gantt,s=r.stateManager;i.ganttGroup.addEventListener("pointerdown",(t=>{if(0!==t.button)return;let o,n,a;if(t.detailPath.find((t=>"task-bar"===t.name?(o=t,!0):"task-creation-button"===t.name||("task-bar-link-point-left"===t.name?(n=t,!0):"task-bar-link-point-right"===t.name?(a=t,!0):!!t.attribute.vtable_link&&(t.attribute.vtable_link,!0)))),o){if("task-bar-hover-shadow-left-icon"===t.target.name)s.startResizeTaskBar(o,t.nativeEvent.x,t.nativeEvent.y,t.offset.y,"left"),s.updateInteractionState(e.grabing);else if("task-bar-hover-shadow-right-icon"===t.target.name)s.startResizeTaskBar(o,t.nativeEvent.x,t.nativeEvent.y,t.offset.y,"right"),s.updateInteractionState(e.grabing);else if(r.parsedOptions.taskBarMoveable){let n=!0;if("function"==typeof r.parsedOptions.taskBarMoveable){const{startDate:t,endDate:e,taskRecord:s}=i._gantt.getTaskInfoByTaskListIndex(o.task_index,o.sub_task_index),a={index:o.task_index,startDate:t,endDate:e,taskRecord:s,ganttInstance:i._gantt};n=r.parsedOptions.taskBarMoveable(a)}else n=r.parsedOptions.taskBarMoveable;n&&(s.startMoveTaskBar(o,t.nativeEvent.x,t.nativeEvent.y,t.offset.y),s.updateInteractionState(e.grabing))}}else n?(s.startCreateDependencyLine(n,t.nativeEvent.x,t.nativeEvent.y,t.offset.y,"left"),s.updateInteractionState(e.grabing)):a&&(s.startCreateDependencyLine(a,t.nativeEvent.x,t.nativeEvent.y,t.offset.y,"right"),s.updateInteractionState(e.grabing))})),i.ganttGroup.addEventListener("pointermove",(t=>{if(s.interactionState===e.default){const e=t.detailPath.find((t=>"task-bar"===t.name)),a=t.detailPath.find((t=>"markline-hover-group"===t.name)),l=t.detailPath.find((t=>"mark-line-content"===t.name));if(r.parsedOptions.markLineCreateOptions?.markLineCreatable&&(a&&!function(t,e){const i=t.startDate.getTime(),o=t.endDate.getTime();return e.some((t=>{const e=new Date(t.date).getTime();return e>=i&&e<=o}))}(a.data,r.parsedOptions.markLine)?i._gantt.stateManager.marklineIcon.target!==a&&(i._gantt.stateManager.marklineIcon.target=a,s.showMarklineIconHover()):i._gantt.stateManager.marklineIcon.target&&s.hideMarklineIconHover()),e){if(i._gantt.stateManager.hoverTaskBar.target!==e&&(i._gantt.stateManager.hoverTaskBar.target=e,s.showTaskBarHover(),i._gantt.hasListeners(n.MOUSEENTER_TASK_BAR))){const o=e.task_index,r=e.sub_task_index,s=i._gantt.getRecordByIndex(o,r);i._gantt.fireListeners(n.MOUSEENTER_TASK_BAR,{federatedEvent:t,event:t.nativeEvent,index:o,sub_task_index:r,record:s})}}else{if(i._gantt.stateManager.hoverTaskBar.target){if(i._gantt.hasListeners(n.MOUSELEAVE_TASK_BAR)){const e=i._gantt.stateManager.hoverTaskBar.target.task_index,o=i._gantt.stateManager.hoverTaskBar.target.sub_task_index,r=i._gantt.getRecordByIndex(e,o);i._gantt.fireListeners(n.MOUSELEAVE_TASK_BAR,{federatedEvent:t,event:t.nativeEvent,index:e,sub_task_index:o,record:r})}s.hideTaskBarHover(t)}if(r.parsedOptions.taskBarCreatable&&!l){const e=LC(t.offset.y-r.headerHeight+r.stateManager.scrollTop,r),i=r.getTaskInfoByTaskListIndex(e.task_index,e.sub_task_index);let n=!0;if("function"==typeof r.parsedOptions.taskBarCreatable){const{startDate:t,endDate:o,taskRecord:s}=i,a={index:e.task_index,sub_task_index:e.sub_task_index,startDate:t,endDate:o,taskRecord:s,ganttInstance:r};n=r.parsedOptions.taskBarCreatable(a)}else n=r.parsedOptions.taskBarCreatable;if(n){const n=function(t,e,i){const n=LC(e-i.headerHeight+i.stateManager.scrollTop,i),r=i.getRecordByIndex(n.task_index),s=xC(t,i),a=i.getDateRangeByIndex(s);if(r?.children){const t=LC(e-i.headerHeight+i.stateManager.scrollTop,i);for(let e=0;e<r.children.length;e++){const{startDate:n,endDate:r,taskDays:s,progress:l,taskRecord:h}=i.getTaskInfoByTaskListIndex(t.task_index,e);if(((i.parsedOptions.tasksShowMode===o.Sub_Tasks_Compact||i.parsedOptions.tasksShowMode===o.Sub_Tasks_Arrange)&&h.vtable_gantt_showIndex===t.sub_task_index||i.parsedOptions.tasksShowMode===o.Sub_Tasks_Inline)&&a.startDate.getTime()>=n.getTime()&&a.endDate.getTime()<=r.getTime())return{startDate:n,endDate:r,taskDays:s,progress:l,taskRecord:h}}}}(t.offset.x,t.offset.y,r);if((r.parsedOptions.tasksShowMode===o.Sub_Tasks_Separate||r.parsedOptions.tasksShowMode===o.Tasks_Separate)&&!i.taskDays&&i.taskRecord&&!i.taskRecord.vtableMerge||(r.parsedOptions.tasksShowMode===o.Sub_Tasks_Inline||r.parsedOptions.tasksShowMode===o.Sub_Tasks_Arrange||r.parsedOptions.tasksShowMode===o.Sub_Tasks_Compact)&&!n){const i=xC(t.offset.x,r),o=(i>=1?r.getDateColsWidth(0,i-1):0)-r.stateManager.scroll.horizontalBarPos,n=r.taskListTableInstance.getRowsHeight(r.taskListTableInstance.columnHeaderLevelCount,e.task_index+r.taskListTableInstance.columnHeaderLevelCount-1)+(e.sub_task_index??0)*r.parsedOptions.rowHeight-r.stateManager.scroll.verticalBarPos;return void r.scenegraph.showTaskCreationButton(o,n,i)}}}}r.scenegraph.hideTaskCreationButton()}else if(s.interactionState===e.grabing){let e,o,n;t.detailPath.find((t=>"task-bar"===t.name?(e=t,!0):"task-creation-button"===t.name||("task-bar-link-point-left"===t.name?(o=t,!0):"task-bar-link-point-right"===t.name?(n=t,!0):!!t.attribute.vtable_link&&(t.attribute.vtable_link,!0)))),e=e??o?.parent?.attribute.attachedToTaskBarNode??n?.parent?.attribute.attachedToTaskBarNode,i._gantt.stateManager.isCreatingDependencyLine()&&!e?s.hideSecondTaskBarSelectedBorder():i._gantt.stateManager.isCreatingDependencyLine()&&o&&i._gantt.stateManager.selectedTaskBar.target!==e?(s.highlightLinkPointNode(o),s.creatingDenpendencyLink.lastHighLightLinkPoint=o,s.creatingDenpendencyLink.secondTaskBarPosition="left"):i._gantt.stateManager.isCreatingDependencyLine()&&n&&i._gantt.stateManager.selectedTaskBar.target!==e?(s.highlightLinkPointNode(n),s.creatingDenpendencyLink.lastHighLightLinkPoint=n,s.creatingDenpendencyLink.secondTaskBarPosition="right"):i._gantt.stateManager.isCreatingDependencyLine()&&e&&i._gantt.stateManager.selectedTaskBar.target!==e&&(s.unhighlightLinkPointNode(s.creatingDenpendencyLink.lastHighLightLinkPoint),s.creatingDenpendencyLink.secondTaskBarNode&&s.creatingDenpendencyLink.secondTaskBarNode===e||(s.creatingDenpendencyLink.secondTaskBarNode&&s.creatingDenpendencyLink.secondTaskBarNode!==e&&s.hideSecondTaskBarSelectedBorder(),s.creatingDenpendencyLink.secondTaskBarNode=e,s.showSecondTaskBarSelectedBorder()))}})),i.ganttGroup.addEventListener("pointerup",(e=>{if(0===e.button){let a,l,h,d=!1,c=!1,u=!1,g=!1,p=!1,f=!1,v=!1;const b=e.detailPath.find((t=>"task-bar"===t.name?(d=!0,!0):"task-creation-button"===t.name?(c=!0,!1):"task-bar-link-point-left"===t.name?(g=!0,!1):"task-bar-link-point-right"===t.name?(p=!0,!1):t.attribute.vtable_link?(u=!0,a=t.attribute.vtable_link,!1):"markline-hover-group"===t.name?(f=!0,h=t,!1):"mark-line-content"===t.name&&(v=!0,l=t,!1)));if(d&&i._gantt.parsedOptions.taskBarSelectable&&"down"===t.poniterState){if(s.hideDependencyLinkSelectedLine(),s.showTaskBarSelectedBorder(b),r.hasListeners(n.CLICK_TASK_BAR)){const t=b.task_index,i=b.sub_task_index,o=r.getRecordByIndex(t,i);r.fireListeners(n.CLICK_TASK_BAR,{federatedEvent:e,event:e.nativeEvent,index:t,sub_task_index:i,record:o})}}else if(c&&"down"===t.poniterState){s.hideDependencyLinkSelectedLine(),s.hideTaskBarSelectedBorder();const t=LC(e.offset.y-r.headerHeight+r.stateManager.scrollTop,r);if(r.parsedOptions.tasksShowMode===o.Sub_Tasks_Arrange||r.parsedOptions.tasksShowMode===o.Sub_Tasks_Inline||r.parsedOptions.tasksShowMode===o.Sub_Tasks_Compact){if(r.hasListeners(n.CREATE_TASK_SCHEDULE)){const i=xC(e.offset.x,r),o=r.getDateRangeByIndex(i),s=r.parsedOptions.dateFormat??(r.parsedOptions.timeScaleIncludeHour?"yyyy-mm-dd hh:mm:ss":"yyyy-mm-dd");r.fireListeners(n.CREATE_TASK_SCHEDULE,{federatedEvent:e,event:e.nativeEvent,index:t.task_index,sub_task_index:t.sub_task_index,startDate:Jy(o.startDate,s),endDate:Jy(o.endDate,s),record:void 0,parentRecord:r.getRecordByIndex(t.task_index)})}}else{const i=r.getTaskInfoByTaskListIndex(t.task_index,t.sub_task_index);if(i.taskRecord){const o=r.parsedOptions.dateFormat??(r.parsedOptions.timeScaleIncludeHour?"yyyy-mm-dd hh:mm:ss":"yyyy-mm-dd"),s=xC(e.offset.x,r),a=r.getDateRangeByIndex(s);i.taskRecord[r.parsedOptions.startDateField]=Jy(a.startDate,o),i.taskRecord[r.parsedOptions.endDateField]=Jy(a.endDate,o),r.scenegraph.hideTaskCreationButton(),r.updateTaskRecord(i.taskRecord,t.task_index,t.sub_task_index),r.hasListeners(n.CREATE_TASK_SCHEDULE)&&r.fireListeners(n.CREATE_TASK_SCHEDULE,{federatedEvent:e,event:e.nativeEvent,index:t.task_index,sub_task_index:t.sub_task_index,startDate:i.taskRecord[r.parsedOptions.startDateField],endDate:i.taskRecord[r.parsedOptions.endDateField],record:i.taskRecord})}}}else if(u&&i._gantt.parsedOptions.dependencyLinkSelectable&&"down"===t.poniterState)s.hideDependencyLinkSelectedLine(),s.hideTaskBarSelectedBorder(),i._gantt.stateManager.selectedDenpendencyLink.link=a,s.showDependencyLinkSelectedLine();else if((g||p)&&"down"===t.poniterState){if(r.hasListeners(n.CLICK_DEPENDENCY_LINK_POINT)){const t=LC(e.offset.y-r.headerHeight+r.stateManager.scrollTop,r),i=r.getRecordByIndex(t.task_index,t.sub_task_index);r.fireListeners(n.CLICK_DEPENDENCY_LINK_POINT,{event:e.nativeEvent,index:t.task_index,sub_task_index:t.sub_task_index,point:g?"start":"end",record:i})}s.hideTaskBarSelectedBorder()}else if(f&&"down"===t.poniterState)r.hasListeners(n.CLICK_MARKLINE_CREATE)&&r.fireListeners(n.CLICK_MARKLINE_CREATE,{event:e.nativeEvent,position:IC(h,i._gantt),data:i._gantt.stateManager.marklineIcon.target.data});else if(v&&"down"===t.poniterState)r.hasListeners(n.CLICK_MARKLINE_CONTENT)&&r.fireListeners(n.CLICK_MARKLINE_CONTENT,{event:e.nativeEvent,position:IC(l,i._gantt),data:l.data});else if(g&&"draging"===t.poniterState){if(s.isCreatingDependencyLine()){const t=s.endCreateDependencyLine(e.offset.y);r.hasListeners(n.CREATE_DEPENDENCY_LINK)&&r.fireListeners(n.CREATE_DEPENDENCY_LINK,{federatedEvent:e,event:e.nativeEvent,link:t})}}else if(p&&"draging"===t.poniterState){if(s.isCreatingDependencyLine()){const t=s.endCreateDependencyLine(e.offset.y);r.hasListeners(n.CREATE_DEPENDENCY_LINK)&&r.fireListeners(n.CREATE_DEPENDENCY_LINK,{federatedEvent:e,event:e.nativeEvent,link:t})}}else s.hideDependencyLinkSelectedLine(),s.hideTaskBarSelectedBorder()}})),i.ganttGroup.addEventListener("rightdown",(t=>{let e,i=!1,o=!1;const s=t.detailPath.find((t=>"task-bar"===t.name?(i=!0,!0):!!t.attribute.vtable_link&&(o=!0,e=t.attribute.vtable_link,!1)));if(i){if(r.hasListeners(n.CONTEXTMENU_TASK_BAR)){const e=s.task_index,i=s.sub_task_index,o=r.getRecordByIndex(e,i);r.fireListeners(n.CONTEXTMENU_TASK_BAR,{federatedEvent:t,event:t.nativeEvent,index:e,sub_task_index:i,record:o})}}else o&&r.hasListeners(n.CONTEXTMENU_DEPENDENCY_LINK)&&r.fireListeners(n.CONTEXTMENU_DEPENDENCY_LINK,{federatedEvent:t,event:t.nativeEvent,link:e})})),i.ganttGroup.addEventListener("pointerenter",(t=>{(r.parsedOptions.scrollStyle.horizontalVisible&&"focus"===r.parsedOptions.scrollStyle.horizontalVisible||!r.parsedOptions.scrollStyle.horizontalVisible&&"focus"===r.parsedOptions.scrollStyle.visible)&&i.scrollbarComponent.showHorizontalScrollBar(),(r.parsedOptions.scrollStyle.verticalVisible&&"focus"===r.parsedOptions.scrollStyle.verticalVisible||!r.parsedOptions.scrollStyle.verticalVisible&&"focus"===r.parsedOptions.scrollStyle.visible)&&i.scrollbarComponent.showVerticalScrollBar()})),i.ganttGroup.addEventListener("pointerleave",(t=>{if((r.parsedOptions.scrollStyle.horizontalVisible&&"focus"===r.parsedOptions.scrollStyle.horizontalVisible||!r.parsedOptions.scrollStyle.horizontalVisible&&"focus"===r.parsedOptions.scrollStyle.visible)&&i.scrollbarComponent.hideHorizontalScrollBar(),(r.parsedOptions.scrollStyle.verticalVisible&&"focus"===r.parsedOptions.scrollStyle.verticalVisible||!r.parsedOptions.scrollStyle.verticalVisible&&"focus"===r.parsedOptions.scrollStyle.visible)&&i.scrollbarComponent.hideVerticalScrollBar(),i._gantt.stateManager.hoverTaskBar.target){if(i._gantt.hasListeners(n.MOUSELEAVE_TASK_BAR)){const e=i._gantt.stateManager.hoverTaskBar.target.task_index,o=i._gantt.stateManager.hoverTaskBar.target.sub_task_index,r=i._gantt.getRecordByIndex(e,o);i._gantt.fireListeners(n.MOUSELEAVE_TASK_BAR,{federatedEvent:t,event:t.nativeEvent,index:e,sub_task_index:o,record:r})}s.hideTaskBarHover(t)}})),i.ganttGroup.addEventListener("wheel",(t=>{mC(t,s,r)}))}(this),function(t){const i=t._gantt;t._gantt.scenegraph;const o=i.stateManager,r=t._eventHandler;r.on(i.getElement(),"contextmenu",(t=>{!1!==i.parsedOptions.eventOptions?.preventDefaultContextMenu&&t.preventDefault()})),r.on(i.getContainer(),"resize",(t=>{0===t.width&&0===t.height||(ot(i.options.pixelRatio)||i.setPixelRatio(wI()),t.windowSizeNotChange||i._resize())})),i.taskListTableInstance&&i.parsedOptions.verticalSplitLineMoveable&&r.on(i.verticalSplitResizeLine,"mousedown",(t=>{o.updateInteractionState(e.grabing),o.startResizeTableWidth(t)}));i.parsedOptions.verticalSplitLineHighlight&&(i.verticalSplitResizeLine&&r.on(i.verticalSplitResizeLine,"mouseover",(t=>{i.verticalSplitResizeLine.childNodes[1].style.opacity="1"})),i.verticalSplitResizeLine&&r.on(i.verticalSplitResizeLine,"mouseout",(t=>{i.verticalSplitResizeLine.childNodes[1].style.opacity="0"})));const s=t=>{i.eventManager.lastDragPointerXYOnWindow={x:t.x,y:t.y},i.eventManager.poniterState="down"};t.globalEventListeners.push({name:"mousedown",env:"document",callback:s}),fu.addEventListener("mousedown",s);const a=t=>{if("down"===i.eventManager.poniterState){const e=i.eventManager.lastDragPointerXYOnWindow.x??t.x,o=t.x-e,n=i.eventManager.lastDragPointerXYOnWindow.y??t.y,r=t.y-n;(Math.abs(o)>=1||Math.abs(r)>=1)&&(i.eventManager.poniterState="draging")}if(o.interactionState===e.grabing&&"draging"===i.eventManager.poniterState){const e=i.eventManager.lastDragPointerXYOnWindow?.x??t.x,n=i.eventManager.lastDragPointerXYOnWindow?.y??t.y;(Math.abs(e-t.x)>=1||Math.abs(n-t.y)>=1)&&(o.isResizingTableWidth()?(o.hideDependencyLinkSelectedLine(),o.hideTaskBarSelectedBorder(),o.dealResizeTableWidth(t)):o.isMoveingTaskBar()?(o.hideDependencyLinkSelectedLine(),o.hideTaskBarSelectedBorder(),o.dealTaskBarMove(t)):o.isResizingTaskBar()?(o.hideDependencyLinkSelectedLine(),o.hideTaskBarSelectedBorder(),o.dealTaskBarResize(t)):o.isCreatingDependencyLine()&&o.dealCreateDependencyLine(t),i.eventManager.lastDragPointerXYOnWindow={x:t.x,y:t.y})}};t.globalEventListeners.push({name:"mousemove",env:"document",callback:a}),fu.addEventListener("mousemove",a);const l=t=>{"grabing"===o.interactionState&&(o.updateInteractionState(e.default),o.isResizingTableWidth()?o.endResizeTableWidth():o.isMoveingTaskBar()?o.endMoveTaskBar():o.isResizingTaskBar()&&o.endResizeTaskBar(t.x)),i.eventManager.lastDragPointerXYOnWindow=void 0,i.eventManager.poniterState="up"};t.globalEventListeners.push({name:"mouseup",env:"document",callback:l}),fu.addEventListener("mouseup",l);const h=t=>{if(i.parsedOptions.dependencyLinkDeletable&&("Delete"===t.key&&i.parsedOptions.keyboardOptions?.deleteLinkOnDel||"Backspace"===t.key&&i.parsedOptions.keyboardOptions?.deleteLinkOnBack)&&i.stateManager.selectedDenpendencyLink.link){const e=i.stateManager.selectedDenpendencyLink.link;i.deleteLink(i.stateManager.selectedDenpendencyLink.link),o.hideDependencyLinkSelectedLine(),o.hideTaskBarSelectedBorder(),i.hasListeners(n.DELETE_DEPENDENCY_LINK)&&i.fireListeners(n.DELETE_DEPENDENCY_LINK,{event:t,link:e})}};t.globalEventListeners.push({name:"keydown",env:"document",callback:h}),fu.addEventListener("keydown",h)}(this)}}function _I(t){const{scroll:e}=t.stateManager,{verticalBarPos:i}=e;t.taskListTableInstance.stateManager.setScrollTop(i,void 0,!1)}function SI(t){const e=t.taskTableWidth;t.taskTableWidth=t.taskListTableInstance.getAllColsWidth()+t.parsedOptions.outerFrameStyle.borderLineWidth,t.options?.taskListTable?.maxTableWidth&&(t.taskTableWidth=Math.min(t.options?.taskListTable?.maxTableWidth,t.taskTableWidth)),t.options?.taskListTable?.minTableWidth&&(t.taskTableWidth=Math.max(t.options?.taskListTable?.minTableWidth,t.taskTableWidth)),e!==t.taskTableWidth&&(t.element.style.left=t.taskTableWidth?`${t.taskTableWidth}px`:"0px",t.taskListTableInstance.setCanvasSize(t.taskTableWidth,t.tableNoFrameHeight+2*t.parsedOptions.outerFrameStyle.borderLineWidth),t._updateSize(),RC(t))}class AI{friction;lastTime;speedX;speedY;runingId;stopped;scrollHandle;constructor(){}setScrollHandle(t){this.scrollHandle=t}startInertia(t,e,i){this.stopped=!1,this.lastTime=Date.now(),this.speedX=t,this.speedY=e,this.friction=i,this.runingId||(this.runingId=requestAnimationFrame(this.inertia.bind(this)))}inertia(){if(this.stopped)return;const t=Date.now(),e=t-this.lastTime;let i=!0;const o=Math.pow(this.friction,e/16),n=o*this.speedX,r=o*this.speedY;let s=0,a=0;Math.abs(n)>.05&&(i=!1,s=(this.speedX+n)/2*e),Math.abs(r)>.05&&(i=!1,a=(this.speedY+r)/2*e),this.scrollHandle?.(s,a),i?this.runingId=null:(this.lastTime=t,this.speedX=n,this.speedY=r,this.runingId=requestAnimationFrame(this.inertia.bind(this)))}endInertia(){cancelAnimationFrame(this.runingId),this.runingId=null,this.stopped=!0}isInertiaScrolling(){return!!this.runingId}}class BI{_gantt;scroll;fastScrolling;interactionState=e.default;moveTaskBar;hoverTaskBar;resizeTaskBar;selectedTaskBar;resizeTableWidth;selectedDenpendencyLink;creatingDenpendencyLink;marklineIcon;resetInteractionState=vI((()=>{this.updateInteractionState(e.default)}),100);constructor(t){this._gantt=t,this.scroll={horizontalBarPos:0,verticalBarPos:0},this.moveTaskBar={targetStartX:null,targetStartY:null,deltaX:0,deltaY:0,startOffsetY:null,startX:null,startY:null,moving:!1,target:null,moveTaskBarXSpeed:0,moveTaskBarXInertia:new AI},this.hoverTaskBar={targetStartX:null,startX:null,target:null},this.marklineIcon={target:null},this.selectedTaskBar={target:null},this.resizeTaskBar={startOffsetY:null,targetStartX:null,targetEndX:null,startX:null,startY:null,target:null,resizing:!1,onIconName:""},this.resizeTableWidth={lastX:null,resizing:!1},this.selectedDenpendencyLink={link:null},this.creatingDenpendencyLink={startClickedPoint:null,startX:null,startY:null,startOffsetY:null,targetStartX:null,creating:!1,secondTaskBarNode:null},this.updateVerticalScrollBar=this.updateVerticalScrollBar.bind(this),this.updateHorizontalScrollBar=this.updateHorizontalScrollBar.bind(this),function(t){t.taskListTableInstance&&t.taskListTableInstance?.on("scroll",(e=>{if("vertical"===e.scrollDirection){const{scroll:e}=t.taskListTableInstance.stateManager,{verticalBarPos:i}=e;t.stateManager.setScrollTop(i,!1)}}))}(this._gantt),function(t){t.taskListTableInstance?.on("change_cell_value",(e=>{const{col:i,row:o,rawValue:n,changedValue:r}=e;t._refreshTaskBar(o-t.taskListTableInstance.columnHeaderLevelCount)}))}(this._gantt),function(t){t.taskListTableInstance?.on("change_header_position",(e=>{t.parsedOptions.tasksShowMode===o.Sub_Tasks_Arrange||t.parsedOptions.tasksShowMode===o.Sub_Tasks_Compact||t.parsedOptions.tasksShowMode===o.Sub_Tasks_Separate?t.scenegraph.refreshTaskBarsAndGrid():t.scenegraph.refreshTaskBars(),t.scenegraph.dragOrderLine.hideDragLine();const i=t.stateManager.scroll.horizontalBarPos,n=t.stateManager.scroll.verticalBarPos;t.scenegraph.setX(-i),t.scenegraph.setY(-n)})),t.taskListTableInstance?.on("change_header_position_start",(e=>{const{col:i,row:o,x:n,y:r,backX:s,lineX:a,backY:l,lineY:h,event:d}=e;t.scenegraph.dragOrderLine.showDragLine(h),t.scenegraph.updateNextFrame()})),t.taskListTableInstance?.on("changing_header_position",(e=>{const{col:i,row:o,x:n,y:r,backX:s,lineX:a,backY:l,lineY:h,event:d}=e;t.scenegraph.dragOrderLine.showDragLine(h),t.scenegraph.updateNextFrame()})),t.taskListTableInstance?.on("change_header_position_fail",(e=>{t.scenegraph.dragOrderLine.hideDragLine(),t.scenegraph.updateNextFrame()}))}(this._gantt),function(t){t.taskListTableInstance?.on("tree_hierarchy_state_change",(e=>{t._syncPropsFromTable(),t.scenegraph.refreshTaskBarsAndGrid(),!t.taskListTableInstance.checkHasColumnAutoWidth()||"auto"!==t.options.taskListTable?.tableWidth&&-1!==t.taskTableWidth||SI(t);const i=t.stateManager.scroll.horizontalBarPos,o=t.stateManager.scroll.verticalBarPos;t.scenegraph.setX(-i),t.scenegraph.setY(-o)}))}(this._gantt),function(t){t.taskListTableInstance?.on("after_sort",(e=>{t.scenegraph.refreshTaskBars();const i=t.stateManager.scroll.horizontalBarPos,o=t.stateManager.scroll.verticalBarPos;t.scenegraph.setX(-i),t.scenegraph.setY(-o)}))}(this._gantt),"auto"!==this._gantt.options.taskListTable?.tableWidth&&-1!==this._gantt.taskTableWidth||function(t){t.taskListTableInstance?.on("resize_column",(e=>{SI(t)}))}(this._gantt)}setScrollTop(t,e=!0){const i=this._gantt.getAllRowsHeight();t=Math.max(0,Math.min(t,i-this._gantt.scenegraph.height)),t=Math.ceil(t);const o=this.scroll.verticalBarPos;this.scroll.verticalBarPos=t,ot(this.scroll.verticalBarPos)&&!isNaN(this.scroll.verticalBarPos)||(this.scroll.verticalBarPos=0),this._gantt.scenegraph.setY(-t);const r=t/(i-this._gantt.scenegraph.height);this._gantt.scenegraph.scrollbarComponent.updateVerticalScrollBarPos(r),o!==t&&e&&(_I(this._gantt),this._gantt.fireListeners(n.SCROLL,{scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollDirection:"vertical",scrollRatioY:r}))}get scrollLeft(){return this.scroll.horizontalBarPos}get scrollTop(){return this.scroll.verticalBarPos}setScrollLeft(t,e=!0){const i=this._gantt.getAllDateColsWidth();t=Math.max(0,Math.min(t,i-this._gantt.scenegraph.width)),t=Math.ceil(t);const o=this.scroll.horizontalBarPos;this.scroll.horizontalBarPos=t,ot(this.scroll.horizontalBarPos)&&!isNaN(this.scroll.horizontalBarPos)||(this.scroll.horizontalBarPos=0),this._gantt.scenegraph.setX(-t);const r=t/(i-this._gantt.scenegraph.width);this._gantt.scenegraph.scrollbarComponent.updateHorizontalScrollBarPos(r),o!==t&&e&&this._gantt.fireListeners(n.SCROLL,{scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollDirection:"horizontal",scrollRatioX:r})}updateInteractionState(t){if(this.interactionState===t)return;const i=this.interactionState;this.interactionState=t,i===e.scrolling&&e.default}updateVerticalScrollBar(t){const e=this._gantt.getAllRowsHeight();this.scroll.verticalBarPos,this.scroll.verticalBarPos=Math.ceil(t*(e-this._gantt.scenegraph.height)),ot(this.scroll.verticalBarPos)&&!isNaN(this.scroll.verticalBarPos)||(this.scroll.verticalBarPos=0),this._gantt.scenegraph.setY(-this.scroll.verticalBarPos,1===t),_I(this._gantt),this._gantt.fireListeners(n.SCROLL,{scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollDirection:"vertical",scrollRatioY:t})}updateHorizontalScrollBar(t){const e=this._gantt.getAllDateColsWidth();this.scroll.horizontalBarPos,this.scroll.horizontalBarPos=Math.ceil(t*(e-this._gantt.scenegraph.width)),ot(this.scroll.horizontalBarPos)&&!isNaN(this.scroll.horizontalBarPos)||(this.scroll.horizontalBarPos=0),this._gantt.scenegraph.setX(-this.scroll.horizontalBarPos,1===t),this._gantt.fireListeners(n.SCROLL,{scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollDirection:"horizontal",scrollRatioY:t})}startMoveTaskBar(t,e,i,o){"task-bar-hover-shadow"===t.name&&(t=t.parent),this.moveTaskBar.moving=!0,this.moveTaskBar.target=t,this.moveTaskBar.targetStartX=t.attribute.x,this.moveTaskBar.targetStartY=t.attribute.y,this.moveTaskBar.startX=e,this.moveTaskBar.startY=i,this.moveTaskBar.startOffsetY=o,t.setAttribute("zIndex",1e4)}isMoveingTaskBar(){return this.moveTaskBar.moving}endMoveTaskBar(){this.moveTaskBar.moveTaskBarXInertia.isInertiaScrolling()&&this.moveTaskBar.moveTaskBarXInertia.endInertia();const t=this.moveTaskBar.deltaX,e=this.moveTaskBar.deltaY,i=this.moveTaskBar.target;if(Math.abs(t)>=1||Math.abs(e)>=1){const t=i.task_index,r=i.sub_task_index,{startDate:s,endDate:a}=this._gantt.getTaskInfoByTaskListIndex(t,r),l=this.moveTaskBar.targetStartY+this._gantt.parsedOptions.rowHeight*Math.round(e/this._gantt.parsedOptions.rowHeight),h=this._gantt.parsedOptions.taskBarMilestoneStyle.width,d=xC(this.moveTaskBar.target.attribute.x+("milestone"===i.record.type?h/2:0)-this._gantt.stateManager.scroll.horizontalBarPos,this._gantt),c=this._gantt.parsedOptions.reverseSortedTimelineScales[0].timelineDates[d];if(!c)return;const u=c.startDate,g=new Date(u.getTime()+(aC(a).getTime()-aC(s).getTime()));let p;if(aC(s).getTime()!==u.getTime()){p=aC(s).getTime()>u.getTime()?"left":"right",this._gantt._updateStartEndDateToTaskRecord(u,g,t,r);const e=this._gantt.getRecordByIndex(t,r);this._gantt.hasListeners(n.CHANGE_DATE_RANGE)&&this._gantt.fireListeners(n.CHANGE_DATE_RANGE,{startDate:e[this._gantt.parsedOptions.startDateField],endDate:e[this._gantt.parsedOptions.endDateField],oldStartDate:s,oldEndDate:a,index:t,record:e})}if(this._gantt.parsedOptions.tasksShowMode===o.Sub_Tasks_Arrange||this._gantt.parsedOptions.tasksShowMode===o.Sub_Tasks_Compact){const t=LC(l,this._gantt);this._gantt._dragOrderTaskRecord(i.task_index,i.sub_task_index,t.task_index,t.sub_task_index),MC(this._gantt.records),this._gantt.taskListTableInstance.renderWithRecreateCells(),this._gantt._syncPropsFromTable(),this._gantt.scenegraph.refreshTaskBarsAndGrid()}else if(this._gantt.parsedOptions.tasksShowMode!==o.Tasks_Separate&&Math.abs(Math.round(e/this._gantt.parsedOptions.rowHeight))>=1){const t=LC(l,this._gantt);this._gantt._dragOrderTaskRecord(i.task_index,i.sub_task_index,t.task_index,t.sub_task_index),this._gantt.parsedOptions.tasksShowMode===o.Sub_Tasks_Separate?(this._gantt.taskListTableInstance.renderWithRecreateCells(),this._gantt.scenegraph.refreshTaskBarsAndGrid()):(this._gantt.scenegraph.taskBar.refresh(),this._gantt.scenegraph.dependencyLink.refresh())}else{let t=d>=1?this._gantt.getDateColsWidth(0,d-1):0;if("milestone"===i.record.type){t-=this._gantt.parsedOptions.taskBarMilestoneStyle.width/2}if(TI(i,t-i.attribute.x,l-i.attribute.y,this),"right"===p){let t=i;for(;t.nextSibling&&t.nextSibling.attribute.y===i.attribute.y&&t.nextSibling.record[this._gantt.parsedOptions.startDateField]<=i.record[this._gantt.parsedOptions.startDateField];)t=t.nextSibling;t!==i&&t.parent.insertAfter(i,t)}else if("left"===p){let t=i;for(;t.previousSibling&&t.previousSibling.attribute.y===i.attribute.y&&t.previousSibling.record[this._gantt.parsedOptions.startDateField]>=i.record[this._gantt.parsedOptions.startDateField];)t=t.previousSibling;t!==i&&t.parent.insertBefore(i,t)}}this._gantt.scenegraph.updateNextFrame()}this.moveTaskBar.moving=!1,this.selectedTaskBar.target!==i&&i.setAttribute("zIndex",0),this.moveTaskBar.target=null,this.moveTaskBar.deltaX=0,this.moveTaskBar.deltaY=0,this.moveTaskBar.moveTaskBarXSpeed=0}dealTaskBarMove(t){const e=this._gantt;let i=this.moveTaskBar.target;i.setAttribute("zIndex",1e4);const o=e.eventManager.lastDragPointerXYOnWindow.x,n=t.x-o,r=e.eventManager.lastDragPointerXYOnWindow.y,s=t.y-r;if(this.moveTaskBar.deltaX+=n,this.moveTaskBar.deltaY+=s,TI(i,n,s,this),i.attribute.x<=e.stateManager.scrollLeft&&n<0)if(e.parsedOptions.moveTaskBarToExtendDateRange&&0===e.stateManager.scrollLeft){this.moveTaskBar.moveTaskBarXInertia?.endInertia();const o=e.parsedOptions.reverseSortedTimelineScales[0].timelineDates[1].startDate.getTime()-e.parsedOptions.reverseSortedTimelineScales[0].timelineDates[0].startDate.getTime(),{unit:n,startOfWeek:r}=e.parsedOptions.reverseSortedTimelineScales[0];e.parsedOptions.minDate=gC(new Date(e.parsedOptions.reverseSortedTimelineScales[0].timelineDates[0].startDate.getTime()-o/2),n,r),e.parsedOptions._minDateTime=e.parsedOptions.minDate?.getTime(),e._generateTimeLineDateMap(),e._updateSize(),e.scenegraph.refreshAll(),i=this.moveTaskBar.target=e.scenegraph.taskBar.getTaskBarNodeByIndex(this.moveTaskBar.target.task_index,this.moveTaskBar.target.sub_task_index),e.scrollLeft=e.parsedOptions.timelineColWidth-1,e.eventManager.lastDragPointerXYOnWindow.x=t.x,i.setAttribute("x",e.scrollLeft)}else this.moveTaskBar.moveTaskBarXSpeed=-e.parsedOptions.timelineColWidth/100,this.moveTaskBar.moveTaskBarXInertia.startInertia(this.moveTaskBar.moveTaskBarXSpeed,0,1),this.moveTaskBar.moveTaskBarXInertia.setScrollHandle(((t,o)=>{this.moveTaskBar.deltaX+=t,this.moveTaskBar.deltaY+=o,TI(i,t,o,this),e.stateManager.setScrollLeft(i.attribute.x),0===e.stateManager.scrollLeft&&this.moveTaskBar.moveTaskBarXInertia.endInertia()}));else if(i.attribute.x+i.attribute.width>=e.stateManager.scrollLeft+e.tableNoFrameWidth&&n>0)if(e.parsedOptions.moveTaskBarToExtendDateRange&&e.stateManager.scrollLeft+e.tableNoFrameWidth===e.getAllDateColsWidth()){this.moveTaskBar.moveTaskBarXInertia?.endInertia();const o=e.parsedOptions.reverseSortedTimelineScales[0].timelineDates,n=o[1].startDate.getTime()-o[0].startDate.getTime(),{unit:r,startOfWeek:s,step:a}=e.parsedOptions.reverseSortedTimelineScales[0];e.parsedOptions.maxDate=uC(e.parsedOptions.minDate,new Date(o[o.length-1].endDate.getTime()+n/2),r,a),e.parsedOptions._maxDateTime=e.parsedOptions.maxDate?.getTime(),e._generateTimeLineDateMap(),e._updateSize(),e.scenegraph.refreshAll(),i=this.moveTaskBar.target=e.scenegraph.taskBar.getTaskBarNodeByIndex(this.moveTaskBar.target.task_index,this.moveTaskBar.target.sub_task_index),e.scrollLeft+=1,e.eventManager.lastDragPointerXYOnWindow.x=t.x,i.setAttribute("x",e.scrollLeft+e.tableNoFrameWidth-i.attribute.width)}else this.moveTaskBar.moveTaskBarXSpeed=e.parsedOptions.timelineColWidth/100,this.moveTaskBar.moveTaskBarXInertia.startInertia(this.moveTaskBar.moveTaskBarXSpeed,0,1),this.moveTaskBar.moveTaskBarXInertia.setScrollHandle(((t,o)=>{this.moveTaskBar.deltaX+=t,this.moveTaskBar.deltaY+=o,TI(i,t,o,this),e.stateManager.setScrollLeft(i.attribute.x+i.attribute.width-e.tableNoFrameWidth),e.stateManager.scrollLeft===e.getAllDateColsWidth()-e.tableNoFrameWidth&&this.moveTaskBar.moveTaskBarXInertia.endInertia()}));else this.moveTaskBar.moveTaskBarXInertia.isInertiaScrolling()?this.moveTaskBar.moveTaskBarXInertia.endInertia():this.moveTaskBar.moveTaskBarXSpeed=0;e.scenegraph.updateNextFrame()}startResizeTaskBar(t,e,i,o,n){this.resizeTaskBar.onIconName=n,this.resizeTaskBar.resizing=!0,this.resizeTaskBar.target=t,this.resizeTaskBar.targetStartX=t.attribute.x,this.resizeTaskBar.targetEndX=t.attribute.x+t.attribute.width,this.resizeTaskBar.startX=e,this.resizeTaskBar.startY=i,this.resizeTaskBar.startOffsetY=o}isResizingTaskBar(){return this.resizeTaskBar.resizing}endResizeTaskBar(t){const e=this._gantt.stateManager.resizeTaskBar.onIconName,i=t-this.resizeTaskBar.startX;if(Math.abs(i)>=1){const t=xC(("left"===e?this.resizeTaskBar.target.attribute.x:this.resizeTaskBar.target.attribute.x+this.resizeTaskBar.target.attribute.width)-this._gantt.stateManager.scroll.horizontalBarPos,this._gantt),i=this._gantt.parsedOptions.reverseSortedTimelineScales[0].timelineDates[t];if(!i)return;const r="left"===e?i.startDate:i.endDate,s=this.resizeTaskBar.target,a=s.clipGroupBox,l=s.barRect,h=s.progressRect,d=s.textLabel,c=s.task_index,u=s.sub_task_index,{taskDays:g,progress:p,startDate:f,endDate:v}=this._gantt.getTaskInfoByTaskListIndex(c,u);let b=!1;if("left"===e?(this._gantt._updateStartDateToTaskRecord(r,c,u),r.getTime()!==new Date(f).getTime()&&(b=!0)):(this._gantt._updateEndDateToTaskRecord(r,c,u),r.getTime()!==new Date(v).getTime()&&(b=!0)),this._gantt.parsedOptions.tasksShowMode===o.Sub_Tasks_Arrange||this._gantt.parsedOptions.tasksShowMode===o.Sub_Tasks_Compact)this._gantt.taskListTableInstance.renderWithRecreateCells(),this._gantt._syncPropsFromTable(),this._gantt.scenegraph.refreshTaskBarsAndGrid();else{if("left"===e){const e=t>=1?this._gantt.getDateColsWidth(0,t-1):0;s.setAttribute("x",e),s.setAttribute("width",this.resizeTaskBar.targetEndX-e)}else if("right"===e){const e=this._gantt.getDateColsWidth(0,t);s.setAttribute("width",e-this.resizeTaskBar.targetStartX)}if(a.setAttribute("width",s.attribute.width),l?.setAttribute("width",s.attribute.width),h?.setAttribute("width",p/100*s.attribute.width),d){const{textAlign:t,textBaseline:e,padding:i}=this._gantt.parsedOptions.taskBarLabelStyle,o=BC(rC(i),t,e,s.attribute.width,s.attribute.height);d.setAttribute("maxLineWidth",s.attribute.width-20),d.setAttribute("x",o.x)}this._gantt.scenegraph.refreshRecordLinkNodes(c,u,s,0),this.showTaskBarHover(),RI(this._gantt,s,c,u),s.setAttribute("zIndex",0)}if(this.resizeTaskBar.resizing=!1,this.resizeTaskBar.target=null,b&&this._gantt.hasListeners(n.CHANGE_DATE_RANGE)){const t=this._gantt.getRecordByIndex(c,u);this._gantt.fireListeners(n.CHANGE_DATE_RANGE,{startDate:t[this._gantt.parsedOptions.startDateField],endDate:t[this._gantt.parsedOptions.endDateField],oldStartDate:f,oldEndDate:v,index:c,record:t})}this._gantt.scenegraph.updateNextFrame()}}dealTaskBarResize(t){const e=this._gantt.eventManager.lastDragPointerXYOnWindow.x,i=t.x-e,o=this._gantt.stateManager.resizeTaskBar.target;let n="left"===this._gantt.stateManager.resizeTaskBar.onIconName?-i:i;const r=Math.max(1,o.attribute.width+n);n=r-o.attribute.width,function(t,e,i,o){const n=o._gantt.parsedOptions.progressField,r=t.clipGroupBox,s=t.barRect,a=t.progressRect,l=t.textLabel,h=t.task_index,d=t.sub_task_index,c=t.record,u=c[n],g="milestone"===c.type;t.setAttribute("zIndex",1e4),e&&t.setAttribute("x",t.attribute.x+e);g&&t.setAttribute("anchor",[t.attribute.x+t.attribute.width/2,t.attribute.y+t.attribute.height/2]);i&&t.setAttribute("width",i);if(r.setAttribute("width",t.attribute.width),s?.setAttribute("width",t.attribute.width),a?.setAttribute("width",u/100*t.attribute.width),l){const{textAlign:e,textBaseline:n,padding:r}=o._gantt.parsedOptions.taskBarLabelStyle,s=BC(rC(r),e,n,i,t.attribute.height);l.setAttribute("maxLineWidth",i-20),l.setAttribute("x",s.x)}o.showTaskBarHover(),RI(o._gantt,t,h,d),o._gantt.scenegraph.refreshRecordLinkNodes(h,d,t,0)}(o,"left"===this._gantt.stateManager.resizeTaskBar.onIconName?-n:0,r,this),this._gantt.scenegraph.updateNextFrame()}startCreateDependencyLine(t,e,i,o,n){this.creatingDenpendencyLink.creating=!0,this.creatingDenpendencyLink.startClickedPoint=t,this.creatingDenpendencyLink.startX=e,this.creatingDenpendencyLink.startY=i,this.creatingDenpendencyLink.startOffsetY=o,this.creatingDenpendencyLink.firstTaskBarPosition=n,this.highlightLinkPointNode(t)}isCreatingDependencyLine(){return this.creatingDenpendencyLink.creating}endCreateDependencyLine(t){const e=this._gantt.parsedOptions.taskKeyField,o=this.selectedTaskBar.target.task_index,n=this.selectedTaskBar.target.sub_task_index,r=this.creatingDenpendencyLink.secondTaskBarNode.task_index,s=this.creatingDenpendencyLink.secondTaskBarNode.sub_task_index,a={linkedFromTaskKey:this._gantt.getRecordByIndex(o,n)[e],linkedToTaskKey:this._gantt.getRecordByIndex(r,s)[e],type:"left"===this.creatingDenpendencyLink.firstTaskBarPosition&&"left"===this.creatingDenpendencyLink.secondTaskBarPosition?i.StartToStart:"right"===this.creatingDenpendencyLink.firstTaskBarPosition&&"left"===this.creatingDenpendencyLink.secondTaskBarPosition?i.FinishToStart:"right"===this.creatingDenpendencyLink.firstTaskBarPosition&&"right"===this.creatingDenpendencyLink.secondTaskBarPosition?i.FinishToFinish:i.StartToFinish};return this._gantt.addLink(a),this.hideTaskBarSelectedBorder(),this._gantt.scenegraph.updateNextFrame(),this.creatingDenpendencyLink.creating=!1,a}dealCreateDependencyLine(t){const e=this.creatingDenpendencyLink.startX,i=this.creatingDenpendencyLink.startY,o=t.x-e,n=t.y-i,r=this.creatingDenpendencyLink.startClickedPoint,s=r.attribute.x+r.attribute.width/2,a=r.attribute.y+r.attribute.height/2;this._gantt.scenegraph.taskBar.updateCreatingDependencyLine(s,a,s+o,a+n),this._gantt.scenegraph.updateNextFrame()}startResizeTableWidth(t){this.resizeTableWidth.resizing=!0,this.resizeTableWidth.lastX=t.pageX}isResizingTableWidth(){return this.resizeTableWidth.resizing}endResizeTableWidth(){this.resizeTableWidth.resizing=!1}dealResizeTableWidth(t){if(!this.resizeTableWidth.resizing)return;const e=t.pageX-this.resizeTableWidth.lastX;if(Math.abs(e)>=1){let i=this._gantt.taskTableWidth+e;const o=Math.min(this._gantt.taskListTableInstance.getAllColsWidth()+this._gantt.parsedOptions.outerFrameStyle.borderLineWidth,this._gantt.options.taskListTable.maxTableWidth??1e5),n=Math.max(this._gantt.parsedOptions.outerFrameStyle.borderLineWidth,this._gantt.options.taskListTable.minTableWidth??0);e>0&&i>o&&(i=o),e<0&&i<n&&(i=n),this._gantt.taskTableWidth=i,this._gantt.element.style.left=this._gantt.taskTableWidth?`${this._gantt.taskTableWidth}px`:"0px",this._gantt.verticalSplitResizeLine.style.left=this._gantt.taskTableWidth?this._gantt.taskTableWidth-7+"px":"0px",this._gantt._resize(),this.resizeTableWidth.lastX=t.pageX}}showTaskBarHover(){const t=this._gantt.stateManager.hoverTaskBar.target;if(t){const e=t.attribute.x,i=t.attribute.y,o=t.attribute.width,n=t.attribute.height;this._gantt.scenegraph.taskBar.showHoverBar(e,i,o,n,t),this._gantt.scenegraph.updateNextFrame()}}hideTaskBarHover(t){this._gantt.stateManager.hoverTaskBar.target=null,this._gantt.scenegraph.taskBar.hideHoverBar(),this._gantt.scenegraph.updateNextFrame()}showTaskBarSelectedBorder(t){this._gantt.stateManager.selectedTaskBar.target?.setAttribute("zIndex",0),this._gantt.stateManager.selectedTaskBar.target=t;const e=this._gantt.parsedOptions.dependencyLinkCreatable;t.setAttribute("zIndex",1e4);const i=t.attribute.x,o=t.attribute.y,n=t.attribute.width,r=t.attribute.height;this._gantt.scenegraph.taskBar.createSelectedBorder(i,o,n,r,t,e),this._gantt.scenegraph.updateNextFrame()}hideTaskBarSelectedBorder(){this._gantt.stateManager.selectedTaskBar.target?.setAttribute("zIndex",0),this._gantt.stateManager.selectedTaskBar.target=null,this._gantt.scenegraph.taskBar.removeSelectedBorder(),this._gantt.scenegraph.updateNextFrame()}showSecondTaskBarSelectedBorder(){const t=this._gantt.stateManager.creatingDenpendencyLink.secondTaskBarNode,e=t.attribute.x,i=t.attribute.y,o=t.attribute.width,n=t.attribute.height;this._gantt.scenegraph.taskBar.createSelectedBorder(e,i,o,n,t,!0),this._gantt.scenegraph.updateNextFrame()}hideSecondTaskBarSelectedBorder(){this._gantt.stateManager.creatingDenpendencyLink.secondTaskBarNode=null,this._gantt.scenegraph.taskBar.removeSecondSelectedBorder(),this._gantt.scenegraph.updateNextFrame()}showDependencyLinkSelectedLine(){const t=this._gantt.stateManager.selectedDenpendencyLink.link;this._gantt.scenegraph.dependencyLink.createSelectedLinkLine(t);const{taskKeyField:e,dependencyLinks:i}=this._gantt.parsedOptions,{linkedToTaskKey:n,linkedFromTaskKey:r,type:s}=t;let a,l,h,d;const c=TC(this._gantt.records,e,n),u=TC(this._gantt.records,e,r);this._gantt.parsedOptions.tasksShowMode===o.Sub_Tasks_Inline||this._gantt.parsedOptions.tasksShowMode===o.Sub_Tasks_Separate||this._gantt.parsedOptions.tasksShowMode===o.Sub_Tasks_Arrange||this._gantt.parsedOptions.tasksShowMode===o.Sub_Tasks_Compact?(a=u.index[0],l=u.index[1],h=c.index[0],d=c.index[1]):(a=this._gantt.getTaskShowIndexByRecordIndex(u.index),h=this._gantt.getTaskShowIndexByRecordIndex(c.index));const g=this._gantt.scenegraph.taskBar.getTaskBarNodeByIndex(a,l);this._gantt.scenegraph.taskBar.createSelectedBorder(g.attribute.x,g.attribute.y,g.attribute.width,g.attribute.height,g,!1);const p=this._gantt.scenegraph.taskBar.getTaskBarNodeByIndex(h,d);this._gantt.scenegraph.taskBar.createSelectedBorder(p.attribute.x,p.attribute.y,p.attribute.width,p.attribute.height,p,!1),this._gantt.scenegraph.updateNextFrame()}hideDependencyLinkSelectedLine(){this._gantt.stateManager.selectedDenpendencyLink.link=null,this._gantt.scenegraph.dependencyLink.removeSelectedLinkLine(),this._gantt.scenegraph.taskBar.removeSelectedBorder(),this._gantt.scenegraph.updateNextFrame()}highlightLinkPointNode(t){if(t?.children.length>0){const e=t.children[0];e.setAttribute("fill",this._gantt.parsedOptions.dependencyLinkLineCreatingPointStyle.fillColor),e.setAttribute("stroke",this._gantt.parsedOptions.dependencyLinkLineCreatingPointStyle.strokeColor),e.setAttribute("radius",this._gantt.parsedOptions.dependencyLinkLineCreatingPointStyle.radius),e.setAttribute("lineWidth",this._gantt.parsedOptions.dependencyLinkLineCreatingPointStyle.strokeWidth),this._gantt.scenegraph.updateNextFrame()}}unhighlightLinkPointNode(t){if(t?.children.length>0){const e=t.children[0];e.setAttribute("fill",this._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.fillColor),e.setAttribute("stroke",this._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.strokeColor),e.setAttribute("radius",this._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.radius),e.setAttribute("lineWidth",this._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.strokeWidth),this._gantt.scenegraph.updateNextFrame()}}showMarklineIconHover(){const t=this._gantt.stateManager.marklineIcon.target;if(t){const e=this._gantt.scenegraph.timelineHeader.showMarklineIcon(t.parent);e&&this._gantt.parsedOptions.markLineCreateOptions?.markLineCreationHoverToolTip?.tipContent&&this._gantt.scenegraph.showToolTip(e),this._gantt.scenegraph.updateNextFrame()}}hideMarklineIconHover(){this._gantt.scenegraph.timelineHeader.hideMarklineIconHover(this._gantt.stateManager.marklineIcon.target.parent),this._gantt.scenegraph.hideToolTip(),this._gantt.stateManager.marklineIcon.target=null,this._gantt.scenegraph.updateNextFrame()}}function RI(t,e,i,o){const n=t.parsedOptions.taskBarCustomLayout;if(n){let r;if("function"==typeof n){const{startDate:s,endDate:a,taskDays:l,progress:h,taskRecord:d}=t.getTaskInfoByTaskListIndex(i,o);r=n({width:e.attribute.width,height:e.attribute.height,index:i,startDate:s,endDate:a,taskDays:l,progress:h,taskRecord:d,ganttInstance:t})}else r=n;if(r){const t=r.rootContainer;t.name="task-bar-custom-render";const i=e.children.find((t=>"task-bar-group"===t.name));if(i){const e=i.children.findIndex((t=>"task-bar-custom-render"===t.name)),o=i.children[e];o&&(i.removeChild(o),i.insertInto(t,e))}}}}function TI(t,e,i,n){const r=t.task_index,s=t.sub_task_index,a="milestone"===t.record.type;e&&t.setAttribute("x",Math.max(0,t.attribute.x+e)),n._gantt.parsedOptions.tasksShowMode!==o.Tasks_Separate?i&&t.setAttribute("y",t.attribute.y+i):i=0,a&&t.setAttribute("anchor",[t.attribute.x+t.attribute.width/2,t.attribute.y+t.attribute.height/2]),n._gantt.scenegraph.refreshRecordLinkNodes(r,s,t,i)}let kI=1,MI=class{listenersData={listeners:{},listenerData:{}};on(t,e){const i=this.listenersData.listeners[t]||(this.listenersData.listeners[t]=[]);i.push(e);const o=kI++;return this.listenersData.listenerData[o]={type:t,listener:e,remove:()=>{delete this.listenersData.listenerData[o];const n=i.indexOf(e);i.splice(n,1),this.listenersData.listeners[t].length||delete this.listenersData.listeners[t]}},o}off(t,e){if(e){const i=t;this.removeEventListener(i,e)}else{const e=t;if(!this.listenersData)return;this.listenersData.listenerData[e]?.remove()}}addEventListener(t,e,i){this.on(t,e)}removeEventListener(t,e){if(this.listenersData)for(const i in this.listenersData.listenerData){const o=this.listenersData.listenerData[i];o.type===t&&o.listener===e&&this.off(i)}}hasListeners(t){return!!this.listenersData&&!!this.listenersData.listeners[t]}fireListeners(t,e){if(!this.listenersData)return[];const i=this.listenersData.listeners[t];return i?i.map((t=>t.call(this,e))).filter((t=>ot(t))):[]}release(){delete this.listenersData}};class LI{records;_gantt;constructor(t){this._gantt=t,this.records=t.records,this.processRecords()}processRecords(){const t=!this._gantt.options.minDate,e=!this._gantt.options.maxDate;let i=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;if((t||e||this._gantt.parsedOptions.tasksShowMode===o.Sub_Tasks_Inline||this._gantt.parsedOptions.tasksShowMode===o.Sub_Tasks_Compact)&&this.records.length){for(let r=0;r<this.records.length;r++){const s=this.records[r];if(t&&s[this._gantt.parsedOptions.startDateField]){const t=aC(s[this._gantt.parsedOptions.startDateField]);i=Math.min(i,t.getTime())}if(e&&s[this._gantt.parsedOptions.endDateField]){const t=aC(s[this._gantt.parsedOptions.endDateField]);n=Math.max(n,t.getTime())}this._gantt.parsedOptions.tasksShowMode!==o.Sub_Tasks_Inline&&this._gantt.parsedOptions.tasksShowMode!==o.Sub_Tasks_Compact||s.children&&s.children.sort(((t,e)=>aC(t[this._gantt.parsedOptions.startDateField]).getTime()-aC(e[this._gantt.parsedOptions.startDateField]).getTime()))}const{unit:r,startOfWeek:s,step:a}=this._gantt.parsedOptions.reverseSortedTimelineScales[0];t&&(this._gantt.parsedOptions.minDate=gC(new Date(i),r,s),this._gantt.parsedOptions._minDateTime=this._gantt.parsedOptions.minDate.getTime()),e&&(this._gantt.parsedOptions.maxDate=uC(this._gantt.parsedOptions.minDate,new Date(n),r,a),this._gantt.parsedOptions._maxDateTime=this._gantt.parsedOptions.maxDate.getTime())}}adjustOrder(t,e,i,n){if(this._gantt.parsedOptions.tasksShowMode!==o.Sub_Tasks_Arrange&&this._gantt.parsedOptions.tasksShowMode!==o.Sub_Tasks_Compact||t!==i)if(this._gantt.parsedOptions.tasksShowMode===o.Sub_Tasks_Inline){if(ot(e)&&ot(n)&&ot(t)&&ot(i)){const o=this.records[t].children[e];this.records[t].children.splice(e,1),this.records[i].children||(this.records[i].children=[]),this.records[i].children.splice(n,0,o)}this.records[i]?.children?.sort(((t,e)=>aC(t[this._gantt.parsedOptions.startDateField]).getTime()-aC(e[this._gantt.parsedOptions.startDateField]).getTime()))}else if(ot(e)&&ot(n)&&ot(t)&&ot(i)){const o=this.records[t].children[e];this.records[t].children.splice(e,1),this.records[i].children||(this.records[i].children=[]),this.records[i].children.splice(n,0,o)}}setRecords(t){this.records=t,this.processRecords()}}var PI=Object.freeze({__proto__:null,formatDate:Jy,getTodayNearDay:function(t,e){const i=(new Date).getTime(),o=new Date(i+864e5*t);if(e){const t=o.getFullYear().toString(),i=(o.getMonth()+1).toString().padStart(2,"0"),n=o.getDate().toString().padStart(2,"0");return e=(e=(e=e.replace("yyyy",t)).replace("mm",i)).replace("dd",n)}return o},getWeekNumber:sC,getWeekday:function(t,e="long"){const i=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],o=new Date(t);return"short"===e?i[o.getDay()].substr(0,3):"long"===e?i[o.getDay()]:'Invalid format specified. Please use "short" or "long".'}}),EI=Object.freeze({__proto__:null,Arc:wc,Area:yc,Circle:Hh,Group:vs,Image:ac,Line:Qd,Path:vc,Rect:ic,RichText:gc,Text:zh}),HI=Object.freeze({__proto__:null,CustomLayout:pI,TYPES:yw,register:VE,themes:r_});t.Gantt=class extends MI{options;container;tableNoFrameWidth;tableNoFrameHeight;tableX;tableY;scenegraph;stateManager;eventManager;taskListTableInstance;canvas;element;verticalSplitResizeLine;horizontalSplitLine;context;timeLineHeaderLevel;itemCount;drawHeight;headerHeight;gridHeight;parsedOptions={};taskTableWidth;taskTableColumns;records;data;constructor(t,i){super(),this.container=t,this.options=i,this.taskTableWidth="number"==typeof i?.taskListTable?.tableWidth?i?.taskListTable?.tableWidth:-1,this.taskTableColumns=i?.taskListTable?.columns??[],this.records=i?.records??[],this._sortScales(),SC(this),this.data=new LI(this),this._generateTimeLineDateMap(),this.timeLineHeaderLevel=this.parsedOptions.sortedTimelineScales.length,this.element=function(t,e="vtable-gantt"){const i=document.createElement("div");i.setAttribute("tabindex","0"),i.classList.add(e),i.style.outline="none",i.style.margin=`${t.top}px ${t.right}px ${t.bottom}px ${t.left}px`;const o=(i.offsetWidth||i.parentElement?.offsetWidth||1)-1,n=(i.offsetHeight||i.parentElement?.offsetHeight||1)-1;return i.style.width=o&&o-t.left-t.right+"px"||"0px",i.style.height=n&&n-t.top-t.bottom+"px"||"0px",i}({top:0,right:0,left:0,bottom:0},"vtable-gantt"),this.element.style.left=this.taskTableWidth?`${this.taskTableWidth}px`:"0px",this.canvas=document.createElement("canvas"),this.element.appendChild(this.canvas),this.context=this.canvas.getContext("2d"),t?(t.appendChild(this.element),this._updateSize()):this._updateSize(),this._generateListTable(),this._syncPropsFromTable(),function(t){if(t.taskListTableInstance){t.verticalSplitResizeLine=document.createElement("div"),t.verticalSplitResizeLine.style.position="absolute",t.verticalSplitResizeLine.style.top=t.tableY+"px",t.verticalSplitResizeLine.style.left=(t.taskTableWidth?t.taskTableWidth-7+t.parsedOptions.verticalSplitLine.lineWidth/2:0)+"px",t.verticalSplitResizeLine.style.width="14px",t.verticalSplitResizeLine.style.height=t.drawHeight+"px",t.verticalSplitResizeLine.style.backgroundColor="rgba(0,0,0,0)",t.verticalSplitResizeLine.style.zIndex="100",t.parsedOptions.verticalSplitLineMoveable&&(t.verticalSplitResizeLine.style.cursor="col-resize"),t.verticalSplitResizeLine.style.userSelect="none",t.verticalSplitResizeLine.style.opacity="1";const e=document.createElement("div");if(e.style.position="absolute",e.style.top="0px",e.style.left=(14-t.parsedOptions.verticalSplitLine.lineWidth)/2+"px",e.style.width=t.parsedOptions.verticalSplitLine.lineWidth+"px",e.style.height="100%",e.style.backgroundColor=t.parsedOptions.verticalSplitLine.lineColor,e.style.zIndex="100",e.style.userSelect="none",e.style.pointerEvents="none",e.style.transition="background-color 0.3s",t.verticalSplitResizeLine.appendChild(e),t.parsedOptions.verticalSplitLineHighlight){const e=document.createElement("div");e.style.position="absolute",e.style.top="0px",e.style.left=(14-t.parsedOptions.verticalSplitLineHighlight.lineWidth??2)/2+"px",e.style.width=(t.parsedOptions.verticalSplitLineHighlight.lineWidth??2)+"px",e.style.height="100%",e.style.backgroundColor=t.parsedOptions.verticalSplitLineHighlight.lineColor,e.style.zIndex="100",e.style.cursor="col-resize",e.style.userSelect="none",e.style.pointerEvents="none",e.style.opacity="0",e.style.transition="background-color 0.3s",t.verticalSplitResizeLine.appendChild(e)}t.container.appendChild(t.verticalSplitResizeLine)}}(this),this.scenegraph=new class{dateStepWidth;rowHeight;_scales;timelineHeader;grid;dependencyLink;taskBar;_gantt;ganttGroup;scrollbarComponent;markLine;dragOrderLine;frameBorder;taskCreationButton;toolTip;stage;tableGroupWidth;tableGroupHeight;constructor(t){let e,i;this._gantt=t,this.tableGroupWidth=t.tableNoFrameWidth,this.tableGroupHeight=Math.min(t.tableNoFrameHeight,t.drawHeight),"node"===vC.mode||(fu.setEnv("browser"),e=t.canvas.width,i=t.canvas.height),this.stage=Pu({canvas:t.canvas,width:e,height:i,disableDirtyBounds:!1,background:t.parsedOptions.underlayBackgroundColor,enableLayout:!0,autoRender:!1,context:{appName:"vtable"},pluginList:["poptipForText"]}),this.stage.gantt=this._gantt,this.stage.table=this._gantt,this.stage.defaultLayer.setTheme({group:{boundsPadding:0,strokeBoundsBuffer:0,lineJoin:"round"},text:{ignoreBuf:!0}}),this.initSceneGraph()}initSceneGraph(){const t=this;t.ganttGroup=new vs({x:t._gantt.tableX,y:t._gantt.tableY,width:this.tableGroupWidth,height:this.tableGroupHeight,clip:!0,pickable:!1}),t.stage.defaultLayer.add(t.ganttGroup),t.ganttGroup.name="table",t.timelineHeader=new zC(t),t.grid=new fC(t),t.dependencyLink=new KC(t),t.taskBar=new GC(t),t.markLine=new jC(t),t.toolTip=new YC(t),t.frameBorder=new VC(t),t.scrollbarComponent=new bC(t._gantt),t.stage.defaultLayer.addChild(t.scrollbarComponent.hScrollBar),t.stage.defaultLayer.addChild(t.scrollbarComponent.vScrollBar),t.dragOrderLine=new ZC(t)}updateSceneGraph(){const t=this._gantt;let e,i;this.tableGroupWidth=t.tableNoFrameWidth,this.tableGroupHeight=Math.min(t.tableNoFrameHeight,t.drawHeight),"node"===vC.mode||(fu.setEnv("browser"),e=t.canvas.width,i=t.canvas.height),this.stage.resize(e,i),this.refreshAll()}afterCreateSceneGraph(){this.scrollbarComponent.updateScrollBar(),function(t){const i=t._gantt,o=i.stateManager,n=i.scenegraph;n.scrollbarComponent.vScrollBar.addEventListener("pointerover",(t=>{n.scrollbarComponent.showVerticalScrollBar()})),n.scrollbarComponent.hScrollBar.addEventListener("pointerover",(t=>{n.scrollbarComponent.showHorizontalScrollBar()})),n.scrollbarComponent.vScrollBar.addEventListener("pointerout",(t=>{o.interactionState!==e.scrolling&&n.scrollbarComponent.hideVerticalScrollBar()})),n.scrollbarComponent.hScrollBar.addEventListener("pointerout",(t=>{o.interactionState!==e.scrolling&&n.scrollbarComponent.hideHorizontalScrollBar()})),n.scrollbarComponent.vScrollBar.addEventListener("pointermove",(t=>{t.stopPropagation()})),n.scrollbarComponent.vScrollBar.addEventListener("scrollDown",(t=>{n._gantt.eventManager.isDown=!0})),n.scrollbarComponent.vScrollBar.addEventListener("pointerup",(()=>{n._gantt.eventManager.isDraging=!1,o.interactionState===e.scrolling&&o.updateInteractionState(e.default)})),n.scrollbarComponent.vScrollBar.addEventListener("pointerupoutside",(()=>{o.interactionState===e.scrolling&&o.updateInteractionState(e.default)})),n.scrollbarComponent.vScrollBar.addEventListener("scrollUp",(t=>{n._gantt.eventManager.isDraging=!1})),n.scrollbarComponent.hScrollBar.addEventListener("pointermove",(t=>{t.stopPropagation()})),n.scrollbarComponent.hScrollBar.addEventListener("pointerdown",(t=>{t.stopPropagation()})),n.scrollbarComponent.hScrollBar.addEventListener("scrollDown",(t=>{n._gantt.eventManager.isDown=!0,o.interactionState!==e.scrolling&&o.updateInteractionState(e.scrolling)})),n.scrollbarComponent.hScrollBar.addEventListener("pointerup",(()=>{o.interactionState===e.scrolling&&o.updateInteractionState(e.default)})),n.scrollbarComponent.hScrollBar.addEventListener("pointerupoutside",(()=>{o.interactionState===e.scrolling&&o.updateInteractionState(e.default)})),n.scrollbarComponent.hScrollBar.addEventListener("scrollUp",(t=>{n._gantt.eventManager.isDraging=!1}));const r=Zy(o.updateVerticalScrollBar,20),s=Zy(o.updateHorizontalScrollBar,20);n.scrollbarComponent.vScrollBar.addEventListener("scrollDrag",(t=>{n._gantt.eventManager.isDown&&(n._gantt.eventManager.isDraging=!0),o.interactionState!==e.scrolling&&o.updateInteractionState(e.scrolling);const i=t.detail.value[0]/(1-t.detail.value[1]+t.detail.value[0]);r(i,t)})),n.scrollbarComponent.hScrollBar.addEventListener("scrollDrag",(t=>{n._gantt.eventManager.isDown&&(n._gantt.eventManager.isDraging=!0),o.fastScrolling=!0,o.interactionState!==e.scrolling&&o.updateInteractionState(e.scrolling);const i=t.detail.value[0]/(1-t.detail.value[1]+t.detail.value[0]);s(i)}))}(this._gantt.eventManager)}refreshAll(){this.tableGroupHeight=Math.min(this._gantt.tableNoFrameHeight,this._gantt.drawHeight),this.tableGroupWidth=this._gantt.tableNoFrameWidth,this.ganttGroup.setAttribute("height",this.tableGroupHeight),this.ganttGroup.setAttribute("width",this.tableGroupWidth),this.timelineHeader.refresh(),this.grid.refresh(),this.taskBar.refresh(),this.dependencyLink.refresh(),this.markLine.refresh(),this.dependencyLink.refresh(),this.frameBorder.refresh(),this.scrollbarComponent.updateScrollBar(),this.updateNextFrame()}refreshTaskBars(){this.dependencyLink.refresh(),this.taskBar.refresh(),this.updateNextFrame()}refreshTaskBarsAndGrid(){this._gantt.verticalSplitResizeLine.style.height=this._gantt.drawHeight+"px",this.tableGroupHeight=Math.min(this._gantt.tableNoFrameHeight,this._gantt.drawHeight),this.ganttGroup.setAttribute("height",this.tableGroupHeight),this.grid.refresh(),this.taskBar.refresh(),this.dependencyLink.refresh(),this.markLine.refresh(),this.frameBorder.resize(),this.scrollbarComponent.updateScrollBar(),this.updateNextFrame()}updateTableSize(){this.tableGroupHeight=Math.min(this._gantt.tableNoFrameHeight,this._gantt.drawHeight),this.tableGroupWidth=this._gantt.tableNoFrameWidth,this.ganttGroup.setAttributes({x:this._gantt.tableX,y:this._gantt.tableY,width:this._gantt.tableNoFrameWidth,height:this.tableGroupHeight}),this.grid.resize(),this.taskBar.resize(),this.dependencyLink.resize(),this.markLine.refresh(),this.frameBorder.resize()}updateStageBackground(){this.stage.background=this._gantt.parsedOptions.underlayBackgroundColor,this.updateNextFrame()}renderSceneGraph(){this.stage.render()}updateNextFrame(){this.stage.renderNextFrame()}get width(){return this.ganttGroup.attribute?.width??0}get height(){return this.ganttGroup.attribute?.height??0}get x(){return this.ganttGroup.attribute?.x??0}get y(){return this.ganttGroup.attribute?.y??0}setX(t,e=!1){this.timelineHeader.setX(t),this.grid.setX(t),this.taskBar.setX(t),this.dependencyLink.setX(t),this.markLine.setX(t),this.updateNextFrame()}setY(t,e=!1){this.grid.setY(t),this.taskBar.setY(t),this.dependencyLink.setY(t),this.updateNextFrame()}setPixelRatio(t){this.stage.disableDirtyBounds(),this.stage.window.setDpr(t),this.stage.render(),this.stage.enableDirtyBounds()}resize(){this.updateTableSize(),this.scrollbarComponent.updateScrollBar(),this.updateNextFrame()}release(){this.stage.release()}showTaskCreationButton(t,e,i){this.taskCreationButton||(this.taskCreationButton=new XC(this._gantt.scenegraph));const o=this._gantt.parsedOptions.taskBarCreationMaxWidth,n=this._gantt.parsedOptions.taskBarCreationMinWidth,r=this._gantt.getDateColWidth(i),s=o?Math.min(o,n?Math.max(n,r):r):n?Math.max(n,r):r,a=t-(s-r)/2;this.taskCreationButton.show(a,e,s,this._gantt.parsedOptions.rowHeight),this.updateNextFrame()}hideTaskCreationButton(){this.taskCreationButton&&(this.taskCreationButton.hide(),this.updateNextFrame())}showToolTip(t){this.toolTip||(this.toolTip=new YC(this._gantt.scenegraph)),this.toolTip.show(t)}hideToolTip(){this.toolTip.hide()}refreshRecordLinkNodes(t,e,i,n=0){const r=this._gantt,s=r.getRecordByIndex(t,e),a=s.vtable_gantt_linkedTo,l=s.vtable_gantt_linkedFrom;for(let s=0;s<a?.length;s++){const l=a[s],h=l.vtable_gantt_linkLineNode,d=l.vtable_gantt_linkArrowNode,{linkedToTaskKey:c,linkedFromTaskKey:u,type:g}=l,{taskKeyField:p,minDate:f}=r.parsedOptions,v=TC(r.records,p,u),b=TC(r.records,p,c);let m,y,C,w,x,_,S,A,B;const R=this._gantt.getTaskBarStyle(t,e);if(r.parsedOptions.tasksShowMode===o.Sub_Tasks_Inline){const t=LC(i.attribute.y+n,r);A=v.index[0],S=r.getRowsHeightByIndex(0,t.task_index-1)/r.parsedOptions.rowHeight,({startDate:m,endDate:y,taskDays:C}=r.getTaskInfoByTaskListIndex(b.index[0],b.index[1])),({startDate:w,endDate:x,taskDays:_}=r.getTaskInfoByTaskListIndex(v.index[0],v.index[1]));const e=R.width;B=i.attribute.y+e/2-(S+.5)*r.parsedOptions.rowHeight}else if(r.parsedOptions.tasksShowMode===o.Sub_Tasks_Separate||r.parsedOptions.tasksShowMode===o.Sub_Tasks_Arrange||r.parsedOptions.tasksShowMode===o.Sub_Tasks_Compact){const t=LC(i.attribute.y+n,r);A=r.getRowsHeightByIndex(0,v.index[0]-1)/r.parsedOptions.rowHeight+(r.parsedOptions.tasksShowMode===o.Sub_Tasks_Arrange||r.parsedOptions.tasksShowMode===o.Sub_Tasks_Compact?v.record.vtable_gantt_showIndex:v.index[1]),S=r.getRowsHeightByIndex(0,t.task_index-1)/r.parsedOptions.rowHeight+(r.parsedOptions.tasksShowMode===o.Sub_Tasks_Arrange||r.parsedOptions.tasksShowMode===o.Sub_Tasks_Compact?b.record.vtable_gantt_showIndex:t.sub_task_index),({startDate:m,endDate:y,taskDays:C}=r.getTaskInfoByTaskListIndex(b.index[0],b.index[1])),({startDate:w,endDate:x,taskDays:_}=r.getTaskInfoByTaskListIndex(v.index[0],v.index[1]));const e=R.width;B=i.attribute.y+e/2-(S+.5)*r.parsedOptions.rowHeight}else{if(A=r.getTaskShowIndexByRecordIndex(v.index),S=r.getTaskShowIndexByRecordIndex(b.index),-1===A||-1===S)continue;({startDate:m,endDate:y,taskDays:C}=r.getTaskInfoByTaskListIndex(S)),({startDate:w,endDate:x,taskDays:_}=r.getTaskInfoByTaskListIndex(A))}if(!(w&&x&&m&&y&&h&&d))return;const{linePoints:T,arrowPoints:k}=qC(g,w,x,A,0,"milestone"===v.record.type,null,0,m,y,S,0,"milestone"===b.record.type,i,B??0,this._gantt);h.setAttribute("points",T),d.setAttribute("points",k)}for(let s=0;s<l?.length;s++){const a=l[s],h=a.vtable_gantt_linkLineNode,d=a.vtable_gantt_linkArrowNode,{linkedToTaskKey:c,linkedFromTaskKey:u,type:g}=a,{taskKeyField:p,minDate:f}=r.parsedOptions,v=TC(r.records,p,c),b=TC(r.records,p,u);let m,y,C,w,x,_,S,A,B;const R=this._gantt.getTaskBarStyle(t,e);if(r.parsedOptions.tasksShowMode===o.Sub_Tasks_Inline){const t=LC(i.attribute.y+n,r);A=r.getRowsHeightByIndex(0,t.task_index-1)/r.parsedOptions.rowHeight,S=v.index[0],({startDate:m,endDate:y,taskDays:C}=r.getTaskInfoByTaskListIndex(v.index[0],v.index[1])),({startDate:w,endDate:x,taskDays:_}=r.getTaskInfoByTaskListIndex(b.index[0],b.index[1]));const e=R.width;B=i.attribute.y+e/2-(A+.5)*r.parsedOptions.rowHeight}else if(r.parsedOptions.tasksShowMode===o.Sub_Tasks_Separate||r.parsedOptions.tasksShowMode===o.Sub_Tasks_Arrange||r.parsedOptions.tasksShowMode===o.Sub_Tasks_Compact){const t=LC(i.attribute.y+n,r);A=r.getRowsHeightByIndex(0,t.task_index-1)/r.parsedOptions.rowHeight+(r.parsedOptions.tasksShowMode===o.Sub_Tasks_Arrange||r.parsedOptions.tasksShowMode===o.Sub_Tasks_Compact?b.record.vtable_gantt_showIndex:t.sub_task_index),S=r.getRowsHeightByIndex(0,v.index[0]-1)/r.parsedOptions.rowHeight+(r.parsedOptions.tasksShowMode===o.Sub_Tasks_Arrange||r.parsedOptions.tasksShowMode===o.Sub_Tasks_Compact?v.record.vtable_gantt_showIndex:v.index[1]),({startDate:m,endDate:y,taskDays:C}=r.getTaskInfoByTaskListIndex(v.index[0],v.index[1])),({startDate:w,endDate:x,taskDays:_}=r.getTaskInfoByTaskListIndex(b.index[0],b.index[1]));const e=R.width;B=i.attribute.y+e/2-(A+.5)*r.parsedOptions.rowHeight}else{if(A=r.getTaskShowIndexByRecordIndex(b.index),S=r.getTaskShowIndexByRecordIndex(v.index),-1===A||-1===S)continue;({startDate:m,endDate:y,taskDays:C}=r.getTaskInfoByTaskListIndex(S)),({startDate:w,endDate:x,taskDays:_}=r.getTaskInfoByTaskListIndex(A))}if(!(w&&x&&m&&y&&h&&d))return;const{linePoints:T,arrowPoints:k}=qC(g,w,x,A,0,"milestone"===b.record.type,i,B??0,m,y,S,0,"milestone"===v.record.type,null,0,this._gantt);h.setAttribute("points",T),d.setAttribute("points",k)}}}(this),this.stateManager=new BI(this),this.eventManager=new xI(this),this.scenegraph.afterCreateSceneGraph(),this._scrollToMarkLine()}renderTaskBarsTable(){this.scenegraph.updateNextFrame()}_updateSize(){let t=0,e=0;if("browser"===vC.mode){const i=this.getElement();let o=0,n=0;if(i.parentElement){const t=i.parentElement.style||window.getComputedStyle(i.parentElement);o=i.parentElement.offsetWidth-parseInt(t.paddingLeft||"0px",10)-parseInt(t.paddingRight||"0px",10),n=i.parentElement.offsetHeight-parseInt(t.paddingTop||"0px",10)-parseInt(t.paddingBottom||"0px",20)}const r=(o??1)-1-this.taskTableWidth,s=(n??1)-1;i.style.width=r&&`${r}px`||"0px",i.style.height=s&&`${s}px`||"0px";const{canvas:a}=this;t=a.parentElement?.offsetWidth??1,e=a.parentElement?.offsetHeight??1,this?.scenegraph?.stage?this.scenegraph.stage.resize(t,e):(a.style.width="",a.style.height="",a.width=t,a.height=e,a.style.width=`${t}px`,a.style.height=`${e}px`)}const i=Math.floor(t-(o=this.parsedOptions.scrollStyle,o?.hoverOn||o?.verticalVisible&&"none"===o?.verticalVisible||!o?.verticalVisible&&"none"===o?.visible?0:o?.width??7));var o;const n=Math.floor(e-function(t){return t?.hoverOn||t?.horizontalVisible&&"none"===t?.horizontalVisible||!t?.horizontalVisible&&"none"===t?.visible?0:t?.width??7}(this.parsedOptions.scrollStyle));if(this.tableNoFrameWidth=t,this.tableNoFrameHeight=Math.floor(e),this.parsedOptions.outerFrameStyle){const t=this.parsedOptions.outerFrameStyle?.borderLineWidth;this.tableX=this.taskTableColumns.length>=1||this.options?.rowSeriesNumber?this.parsedOptions.verticalSplitLine.lineWidth??0:t,this.tableY=t,this.tableNoFrameWidth=Math.min(i-t-this.tableX,this.getAllDateColsWidth()),this.tableNoFrameHeight=n-2*t}}_updateListTableSize(t){if(t&&("auto"!==this.options?.taskListTable?.tableWidth&&-1!==this.taskTableWidth||(this.taskTableWidth=t.getAllColsWidth()+this.parsedOptions.outerFrameStyle.borderLineWidth,this.options?.taskListTable?.maxTableWidth&&(this.taskTableWidth=Math.min(this.options?.taskListTable?.maxTableWidth,this.taskTableWidth)),this.options?.taskListTable?.minTableWidth&&(this.taskTableWidth=Math.max(this.options?.taskListTable?.minTableWidth,this.taskTableWidth)),this.element.style.left=this.taskTableWidth?`${this.taskTableWidth}px`:"0px",t.setCanvasSize(this.taskTableWidth,this.tableNoFrameHeight+2*this.parsedOptions.outerFrameStyle.borderLineWidth),this._updateSize()),t.columnHeaderLevelCount>1))if(t.columnHeaderLevelCount===this.parsedOptions.timeLineHeaderRowHeights.length)for(let e=0;e<t.columnHeaderLevelCount;e++)t.setRowHeight(e,this.parsedOptions.timeLineHeaderRowHeights[e]);else{const e=this.getAllHeaderRowsHeight()/t.columnHeaderLevelCount;for(let i=0;i<t.columnHeaderLevelCount;i++)t.setRowHeight(i,e)}}_generateListTable(){if(this.taskTableColumns.length>=1||this.options?.rowSeriesNumber){const t=this._generateListTableOptions();this.taskListTableInstance=new uI(this.container,t),this._updateListTableSize(this.taskListTableInstance)}}_generateListTableOptions(){const t={},e=["container","records","rowSeriesNumber","overscrollBehavior","pixelRatio","eventOptions"];for(const i in this.options)e.indexOf(i)>=0&&(t[i]=this.options[i]);for(const e in this.options.taskListTable){if(t[e]=this.options.taskListTable[e],"columns"===e&&(t[e][t[e].length-1].disableColumnResize=!0,this.parsedOptions.tasksShowMode===o.Sub_Tasks_Inline||this.parsedOptions.tasksShowMode===o.Sub_Tasks_Separate||this.parsedOptions.tasksShowMode===o.Sub_Tasks_Arrange||this.parsedOptions.tasksShowMode===o.Sub_Tasks_Compact))for(let e=0;e<t.columns.length;e++)t.columns[e].tree&&(t.columns[e].tree=!1);"hierarchyExpandLevel"!==e||this.parsedOptions.tasksShowMode!==o.Sub_Tasks_Inline&&this.parsedOptions.tasksShowMode!==o.Sub_Tasks_Separate&&this.parsedOptions.tasksShowMode!==o.Sub_Tasks_Arrange&&this.parsedOptions.tasksShowMode!==o.Sub_Tasks_Compact||delete t[e]}if(this.options.taskListTable?.theme)if(t.theme=this.options.taskListTable?.theme,t.theme.bodyStyle&&!function(t,e){const i=Object.getOwnPropertyDescriptor(t,e);return!(!i||!i.set&&!0!==i.writable)}(t.theme,"bodyStyle")){t.theme=(this.options.taskListTable?.theme).extends((this.options.taskListTable?.theme).getExtendTheme());const e=t.theme.getExtendTheme();t.theme.clearBodyStyleCache(),t.theme.headerStyle?.bgColor||(e.headerStyle?e.headerStyle.bgColor||(e.headerStyle.bgColor=this.parsedOptions.timelineHeaderBackgroundColor):e.headerStyle={bgColor:this.parsedOptions.timelineHeaderBackgroundColor}),e.bodyStyle?e.bodyStyle.frameStyle={borderLineWidth:[this.parsedOptions.horizontalSplitLine?.lineWidth??0,0,0,0],borderColor:this.parsedOptions.horizontalSplitLine?.lineColor}:e.bodyStyle={frameStyle:{borderLineWidth:[this.parsedOptions.horizontalSplitLine?.lineWidth??0,0,0,0],borderColor:this.parsedOptions.horizontalSplitLine?.lineColor}},e.cellInnerBorder=!1,e.frameStyle=Object.assign({},this.parsedOptions.outerFrameStyle,{shadowBlur:0,cornerRadius:[this.parsedOptions.outerFrameStyle?.cornerRadius??0,0,0,this.parsedOptions.outerFrameStyle?.cornerRadius??0],borderLineWidth:[this.parsedOptions.outerFrameStyle?.borderLineWidth??0,0,this.parsedOptions.outerFrameStyle?.borderLineWidth??0,this.parsedOptions.outerFrameStyle?.borderLineWidth??0]}),e.scrollStyle=Object.assign({},this.options.taskListTable?.theme?.scrollStyle,this.parsedOptions.scrollStyle,{verticalVisible:"none"}),e.columnResize=Object.assign({labelColor:"rgba(0,0,0,0)",labelBackgroundFill:"rgba(0,0,0,0)"},e?.columnResize),e.underlayBackgroundColor||(e.underlayBackgroundColor=this.parsedOptions.underlayBackgroundColor)}else t.theme.headerStyle?t.theme.headerStyle.bgColor||(t.theme.headerStyle.bgColor=this.parsedOptions.timelineHeaderBackgroundColor):t.theme.headerStyle={bgColor:this.parsedOptions.timelineHeaderBackgroundColor},t.theme.headerStyle=Object.assign({},Jx.headerStyle,{bgColor:this.parsedOptions.timelineHeaderBackgroundColor},this.options.taskListTable?.theme?.headerStyle),t.theme.bodyStyle=Object.assign({},Jx.bodyStyle,this.options.taskListTable?.theme?.bodyStyle,{frameStyle:{borderLineWidth:[this.parsedOptions.horizontalSplitLine?.lineWidth??0,0,0,0],borderColor:this.parsedOptions.horizontalSplitLine?.lineColor}}),t.theme.cellInnerBorder=!1,t.theme.frameStyle=Object.assign({},this.parsedOptions.outerFrameStyle,{cornerRadius:[this.parsedOptions.outerFrameStyle?.cornerRadius??0,0,0,this.parsedOptions.outerFrameStyle?.cornerRadius??0],borderLineWidth:[this.parsedOptions.outerFrameStyle?.borderLineWidth??0,0,this.parsedOptions.outerFrameStyle?.borderLineWidth??0,this.parsedOptions.outerFrameStyle?.borderLineWidth??0]}),t.theme.scrollStyle=Object.assign({},this.options.taskListTable?.theme?.scrollStyle,this.parsedOptions.scrollStyle,{verticalVisible:"none"}),t.theme.columnResize=Object.assign({labelColor:"rgba(0,0,0,0)",labelBackgroundFill:"rgba(0,0,0,0)"},this.options.taskListTable?.theme?.columnResize),t.theme.underlayBackgroundColor||(t.theme.underlayBackgroundColor=this.parsedOptions.underlayBackgroundColor);else t.theme={scrollStyle:Object.assign({},this.options.taskListTable?.theme?.scrollStyle,this.parsedOptions.scrollStyle,{verticalVisible:"none"}),headerStyle:Object.assign({},Jx.headerStyle,{bgColor:this.parsedOptions.timelineHeaderBackgroundColor},this.options.taskListTable?.theme?.headerStyle),bodyStyle:Object.assign({},Jx.bodyStyle,this.options.taskListTable?.theme?.bodyStyle,{frameStyle:{borderLineWidth:[this.parsedOptions.horizontalSplitLine?.lineWidth??0,0,0,0],borderColor:this.parsedOptions.horizontalSplitLine?.lineColor}}),cellInnerBorder:!1,frameStyle:Object.assign({},this.parsedOptions.outerFrameStyle,{cornerRadius:[this.parsedOptions.outerFrameStyle?.cornerRadius??0,0,0,this.parsedOptions.outerFrameStyle?.cornerRadius??0],borderLineWidth:[this.parsedOptions.outerFrameStyle?.borderLineWidth??0,0,this.parsedOptions.outerFrameStyle?.borderLineWidth??0,this.parsedOptions.outerFrameStyle?.borderLineWidth??0]}),columnResize:Object.assign({labelColor:"rgba(0,0,0,0)",labelBackgroundFill:"rgba(0,0,0,0)"},this.options.taskListTable?.theme?.columnResize),underlayBackgroundColor:this.parsedOptions.underlayBackgroundColor};return t.canvasWidth=this.taskTableWidth,t.canvasHeight=this.canvas.height,t.defaultHeaderRowHeight=this.getAllHeaderRowsHeight(),this.parsedOptions.tasksShowMode===o.Sub_Tasks_Separate?(t.customComputeRowHeight=t=>{const{row:e,table:i}=t,o=i.getRecordByRowCol(0,e);if(o)return(o.children?.length||1)*this.parsedOptions.rowHeight},t.defaultRowHeight="auto"):this.parsedOptions.tasksShowMode===o.Sub_Tasks_Compact?(t.customComputeRowHeight=t=>{const{row:e,table:i}=t,o=i.getRecordByRowCol(0,e);if(o)return PC(this,o)*this.parsedOptions.rowHeight},t.defaultRowHeight="auto"):this.parsedOptions.tasksShowMode===o.Sub_Tasks_Arrange?(t.customComputeRowHeight=t=>{const{row:e,table:i}=t,o=i.getRecordByRowCol(0,e);if(o)return HC(this,o)*this.parsedOptions.rowHeight},t.defaultRowHeight="auto"):t.defaultRowHeight=this.options.rowHeight??40,t.clearDOM=!1,t}getElement(){return this.element}getContainer(){return this.element.parentElement}_sortScales(){const{timelineHeader:t}=this.options;if(t){const e=t.scales,i=["year","quarter","month","week","day","hour","minute","second"];1===e.length&&("hour"!==e[0].unit&&"minute"!==e[0].unit&&"second"!==e[0].unit||(this.parsedOptions.timeScaleIncludeHour=!0));const o=e.slice().sort(((t,e)=>{"hour"!==t.unit&&"minute"!==t.unit&&"second"!==t.unit||(this.parsedOptions.timeScaleIncludeHour=!0);const o=i.indexOf(t.unit),n=i.indexOf(e.unit);return-1===o?1:-1===n?-1:o-n})),n=e.slice().sort(((t,e)=>{const o=i.indexOf(t.unit),n=i.indexOf(e.unit);return-1===o?1:-1===n?-1:n-o}));this.parsedOptions.sortedTimelineScales=o,this.parsedOptions.reverseSortedTimelineScales=n}}_generateTimeLineDateMap(){if(this.parsedOptions.minDate&&this.parsedOptions.maxDate)for(const t of this.parsedOptions.reverseSortedTimelineScales)t.timelineDates=AC(new Date(this.parsedOptions.minDate),this.parsedOptions.maxDate,t)}getRowHeightByIndex(t){return this.taskListTableInstance?this.taskListTableInstance.getRowHeight(t+this.taskListTableInstance.columnHeaderLevelCount):this.parsedOptions.rowHeight}getRowsHeightByIndex(t,e){return this.taskListTableInstance?this.taskListTableInstance.getRowsHeight(t+this.taskListTableInstance.columnHeaderLevelCount,e+this.taskListTableInstance.columnHeaderLevelCount):this.parsedOptions.rowHeight*(e-t+1)}getAllRowsHeight(){return this.taskListTableInstance?this.taskListTableInstance.getAllRowsHeight():this.getAllHeaderRowsHeight()+this.itemCount*this.parsedOptions.rowHeight}getAllHeaderRowsHeight(){return this.parsedOptions.timeLineHeaderRowHeights.reduce(((t,e,i)=>!1===this.parsedOptions.sortedTimelineScales[i].visible?t:t+e),0)}getAllDateColsWidth(){return this.parsedOptions.timelineColWidth*(this.parsedOptions.reverseSortedTimelineScales[0].timelineDates?.length??0)}getAllTaskBarsHeight(){return this.taskListTableInstance?this.taskListTableInstance.getRowsHeight(this.taskListTableInstance.columnHeaderLevelCount,this.taskListTableInstance.rowCount-1):this.itemCount*this.parsedOptions.rowHeight}getRecordIndexByTaskShowIndex(t){return this.taskListTableInstance?this.taskListTableInstance.getRecordIndexByCell(0,this.taskListTableInstance.columnHeaderLevelCount+t):t}getTaskShowIndexByRecordIndex(t){return this.taskListTableInstance.getBodyRowIndexByRecordIndex(t)}getRecordByIndex(t,e){return ot(e)?this.records[t]?.children?.[e]:this.taskListTableInstance?this.taskListTableInstance.getRecordByCell(0,t+this.taskListTableInstance.columnHeaderLevelCount):this.records[t]}_refreshTaskBar(t,e){this.scenegraph.taskBar.updateTaskBarNode(t,e),this.scenegraph.refreshRecordLinkNodes(t,void 0,this.scenegraph.taskBar.getTaskBarNodeByIndex(t,e)),this.scenegraph.updateNextFrame()}_updateRecordToListTable(t,e){this.taskListTableInstance.updateRecords([t],[e])}getTaskInfoByTaskListIndex(t,e){const i=this.getRecordByIndex(t,e),o=i?.type,n=this.parsedOptions.startDateField,r=this.parsedOptions.endDateField,s=this.parsedOptions.progressField,a=aC(i?.[n]).getTime(),l=aC(i?.[r]).getTime();if(o&&!i?.[n]||!o&&(l<this.parsedOptions._minDateTime||a>this.parsedOptions._maxDateTime||!i?.[n]||!i?.[r]))return{taskDays:0,progress:0,startDate:null,endDate:null,taskRecord:i};const h=function(t){return"string"==typeof t&&(t=t.replace("%",""),t=parseFloat(t)),Math.round(t)}(i[s]);let d,c;this.parsedOptions.timeScaleIncludeHour?(d=aC(Math.min(Math.max(this.parsedOptions._minDateTime,a),this.parsedOptions._maxDateTime)),c=dC(Math.max(Math.min(this.parsedOptions._maxDateTime,l),this.parsedOptions._minDateTime),!0)):(d=aC(Math.min(Math.max(this.parsedOptions._minDateTime,a),this.parsedOptions._maxDateTime),!0),c=cC(Math.max(Math.min(this.parsedOptions._maxDateTime,l),this.parsedOptions._minDateTime),!0));return{taskRecord:i,taskDays:(c.getTime()-d.getTime()+1)/864e5,startDate:d,endDate:c,progress:h}}_updateStartDateToTaskRecord(t,e,i){const o=this.getRecordByIndex(e,i),n=this.parsedOptions.startDateField,r=Jy(t,this.parsedOptions.dateFormat??iC(o[n]));if(o[n]=r,!ot(i)){const t=this.getRecordIndexByTaskShowIndex(e);this._updateRecordToListTable(o,t)}}_updateEndDateToTaskRecord(t,e,i){const o=this.getRecordByIndex(e,i),n=this.parsedOptions.endDateField,r=Jy(t,this.parsedOptions.dateFormat??iC(o[n]));if(o[n]=r,!ot(i)){const t=this.getRecordIndexByTaskShowIndex(e);this._updateRecordToListTable(o,t)}}_updateStartEndDateToTaskRecord(t,e,i,o){const n=this.getRecordByIndex(i,o),r=this.parsedOptions.startDateField,s=this.parsedOptions.endDateField,a=this.parsedOptions.dateFormat??iC(n[r]),l=Jy(t,a);n[r]=l;const h=Jy(e,a);if(n[s]=h,!ot(o)){const t=this.getRecordIndexByTaskShowIndex(i);this._updateRecordToListTable(n,t)}}_dragOrderTaskRecord(t,e,i,o){this.data.adjustOrder(t,e,i,o)}updateTaskRecord(t,e,i){if(ot(i)){const o="number"==typeof e?e:e[0];return this._updateRecordToListTable(t,[o,i]),void this._refreshTaskBar(o,i)}if(Array.isArray(e)){const i=e[0],o=e[1];return this._updateRecordToListTable(t,e),void this._refreshTaskBar(i,o)}let o=e;"tree"===this.taskListTableInstance.rowHierarchyType&&(o=this.taskListTableInstance.getRecordIndexByCell(0,e+this.taskListTableInstance.columnHeaderLevelCount)),this._updateRecordToListTable(t,o),this._refreshTaskBar(e,void 0)}setPixelRatio(t){this.taskListTableInstance?.setPixelRatio(t),this.parsedOptions.pixelRatio=t,this.scenegraph.setPixelRatio(t)}_resize(){this._updateSize(),this.taskListTableInstance?.setCanvasSize(this.taskTableWidth,this.tableNoFrameHeight+2*this.parsedOptions.outerFrameStyle.borderLineWidth),this._syncPropsFromTable(),this.scenegraph.resize(),RC(this)}_syncPropsFromTable(){this.itemCount=this.taskListTableInstance?this.taskListTableInstance.rowCount-this.taskListTableInstance.columnHeaderLevelCount:this.records.length,this.headerHeight=this.getAllHeaderRowsHeight(),this.drawHeight=Math.min(this.getAllRowsHeight(),this.tableNoFrameHeight),this.gridHeight=this.drawHeight-this.headerHeight}getContext(){return this.context}release(){super.release?.(),this.eventManager.release(),this.taskListTableInstance?.release();const{parentElement:t}=this.element;t&&(t.removeChild(this.element),this.verticalSplitResizeLine&&t.removeChild(this.verticalSplitResizeLine),this.horizontalSplitLine&&t.removeChild(this.horizontalSplitLine)),this.scenegraph=null}updateOption(t){if(this.parsedOptions={},this.options=t,this.taskTableWidth="number"==typeof t?.taskListTable?.tableWidth?t?.taskListTable?.tableWidth:-1,this.taskTableColumns=t?.taskListTable?.columns??[],this.records=t?.records??[],this._sortScales(),SC(this),this.data.setRecords(this.records),this._generateTimeLineDateMap(),this.timeLineHeaderLevel=this.parsedOptions.sortedTimelineScales.length,this._updateSize(),this.taskListTableInstance){const t=this._generateListTableOptions();this.taskListTableInstance.updateOption(t),this._updateListTableSize(this.taskListTableInstance)}this._syncPropsFromTable(),this.scenegraph.updateStageBackground(),this.element.style.left=this.taskTableWidth?`${this.taskTableWidth}px`:"0px",RC(this),this.scenegraph.updateSceneGraph(),this.scenegraph.afterCreateSceneGraph(),this._scrollToMarkLine()}setRecords(t){this.records=t,this.data.setRecords(t),function(t){const e=t.options,{unit:i,startOfWeek:o}=t.parsedOptions.reverseSortedTimelineScales[0];t.parsedOptions.markLine=_C(e?.markLine),t.parsedOptions.markLine?.length&&(t.parsedOptions.markLine?.every((t=>void 0===t.scrollToMarkLine))&&(t.parsedOptions.markLine[0].scrollToMarkLine=!0),t.parsedOptions.markLine?.find((t=>t.scrollToMarkLine))&&(t.parsedOptions.scrollToMarkLineDate=gC(new Date(t.parsedOptions.markLine?.find((t=>t.scrollToMarkLine)).date),i,o))),t.parsedOptions.dependencyLinks=e.dependency?.links}(this),this.taskListTableInstance.setRecords(t),this._syncPropsFromTable(),this._generateTimeLineDateMap(),this.timeLineHeaderLevel=this.parsedOptions.sortedTimelineScales.length,this._updateSize(),this.scenegraph.refreshAll(),this.verticalSplitResizeLine.style.height=this.drawHeight+"px";const e=this.stateManager.scroll.horizontalBarPos,i=this.stateManager.scroll.verticalBarPos;this.scenegraph.setX(-e),this.scenegraph.setY(-i)}updateScales(t){const e=this.parsedOptions.sortedTimelineScales.length;if(this.options.timelineHeader.scales=t,this._sortScales(),function(t){const e=t.options,{unit:i,startOfWeek:o,step:n}=t.parsedOptions.reverseSortedTimelineScales[0];t.parsedOptions.minDate=gC(new Date(t.parsedOptions.minDate),i,o),t.parsedOptions.maxDate=uC(t.parsedOptions.minDate,new Date(t.parsedOptions.maxDate),i,n),t.parsedOptions._minDateTime=t.parsedOptions.minDate?.getTime(),t.parsedOptions._maxDateTime=t.parsedOptions.maxDate?.getTime(),t.parsedOptions.timeLineHeaderRowHeights=[],t.parsedOptions.timelineHeaderStyles=[];for(let i=0;i<t.parsedOptions.sortedTimelineScales.length;i++){const o=t.parsedOptions.sortedTimelineScales[i].style;t.parsedOptions.timelineHeaderStyles.push(Object.assign({fontSize:20,fontWeight:"bold",textAlign:"center",textBaseline:"middle",color:"#000",backgroundColor:"#fff"},o)),t.parsedOptions.timeLineHeaderRowHeights.push(t.parsedOptions.sortedTimelineScales[i].rowHeight??e?.headerRowHeight??40)}}(this),this._generateTimeLineDateMap(),this.timeLineHeaderLevel=this.parsedOptions.sortedTimelineScales.length,this.scenegraph.refreshAll(),RC(this),this.taskListTableInstance)if(this.taskListTableInstance.columnHeaderLevelCount===this.parsedOptions.timeLineHeaderRowHeights.length)for(let t=0;t<this.taskListTableInstance.columnHeaderLevelCount;t++)this.taskListTableInstance.setRowHeight(t,this.parsedOptions.timeLineHeaderRowHeights[t]);else{const t=this.getAllHeaderRowsHeight()/this.taskListTableInstance.columnHeaderLevelCount;for(let e=0;e<this.taskListTableInstance.columnHeaderLevelCount;e++)this.taskListTableInstance.setRowHeight(e,t)}e!==t.length&&this._resize()}updateDateRange(t,e){this.options.minDate=t,this.options.maxDate=e,function(t){const e=t.options,{unit:i,startOfWeek:o,step:n}=t.parsedOptions.reverseSortedTimelineScales[0];t.parsedOptions.minDate=e?.minDate?gC(new Date(e.minDate),i,o):void 0,t.parsedOptions.maxDate=e?.maxDate?uC(t.parsedOptions.minDate,new Date(e.maxDate),i,n):void 0,t.parsedOptions._minDateTime=t.parsedOptions.minDate?.getTime(),t.parsedOptions._maxDateTime=t.parsedOptions.maxDate?.getTime()}(this),this._generateTimeLineDateMap(),this._updateSize(),this.scenegraph.refreshAll(),this._scrollToMarkLine()}updateMarkLine(t){this.options.markLine=t,OC(this),this.scenegraph.markLine.refresh(),this.scenegraph.renderSceneGraph()}addMarkLine(t){this.options.markLine=[...this.parsedOptions.markLine,t],OC(this),this.scenegraph.markLine.refresh(),this.scenegraph.renderSceneGraph(),this.scenegraph.updateNextFrame()}updateCurrentMarkLine(t){const e=this.parsedOptions.markLine.findIndex((e=>e.date===t.date));-1!==e&&(this.options.markLine=[...this.parsedOptions.markLine.slice(0,e),{...this.options.markLine[e],...t},...this.parsedOptions.markLine.slice(e+1)],OC(this),this.scenegraph.markLine.refresh(),this.scenegraph.renderSceneGraph(),this.scenegraph.updateNextFrame())}_scrollToMarkLine(){if(this.parsedOptions.scrollToMarkLineDate&&this.parsedOptions.minDate){const t=this.parsedOptions.minDate,{unit:e,step:i}=this.parsedOptions.reverseSortedTimelineScales[0],o=pC(this.parsedOptions.scrollToMarkLineDate,t,e,i)*this.parsedOptions.timelineColWidth-this.tableNoFrameWidth/2;this.stateManager.setScrollLeft(o)}}scrollToMarkLine(t){if(!t||!this.parsedOptions.minDate)return;const e=this.parsedOptions.minDate,{unit:i,step:o}=this.parsedOptions.reverseSortedTimelineScales[0],n=pC(t,e,i,o)*this.parsedOptions.timelineColWidth-this.tableNoFrameWidth/2;this.stateManager.setScrollLeft(n)}addLink(t){this.parsedOptions.dependencyLinks.push(t),this.scenegraph.dependencyLink.initLinkLine(this.parsedOptions.dependencyLinks.length-1),this.scenegraph.updateNextFrame()}deleteLink(t){if(this.parsedOptions.dependencyLinkDeletable){const e=this.parsedOptions.dependencyLinks.findIndex((e=>e.type===t.type&&e.linkedFromTaskKey===t.linkedFromTaskKey&&e.linkedToTaskKey===t.linkedToTaskKey));if(-1!==e){const t=this.parsedOptions.dependencyLinks[e];this.parsedOptions.dependencyLinks.splice(e,1),this.scenegraph.dependencyLink.deleteLink(t),this.scenegraph.updateNextFrame()}}}get scrollTop(){return this.stateManager.scrollTop}set scrollTop(t){this.stateManager.setScrollTop(t)}get scrollLeft(){return this.stateManager.scrollLeft}set scrollLeft(t){this.stateManager.setScrollLeft(t)}getTaskBarRelativeRect(t){const e=this.scenegraph.taskBar.getTaskBarNodeByIndex(t);return{left:e.attribute.x+this.taskListTableInstance.tableNoFrameWidth+this.taskListTableInstance.tableX+this.tableX-this.scrollLeft,top:e.attribute.y+this.tableY+this.headerHeight-this.scrollTop,width:e.attribute.width,height:e.attribute.height}}getDateColWidth(t){return this.parsedOptions.timelineColWidth}getDateColsWidth(t,e){return(e-t+1)*this.parsedOptions.timelineColWidth}getDateRangeByIndex(t){const e=this.parsedOptions.reverseSortedTimelineScales[0];if(t<e.timelineDates.length){return{startDate:e.timelineDates[t].startDate,endDate:e.timelineDates[t].endDate}}return null}parseTimeFormat(t){return iC(t)}getTaskBarStyle(t,e){if("function"==typeof this.parsedOptions.taskBarStyle){const{startDate:i,endDate:o,taskRecord:n}=this.getTaskInfoByTaskListIndex(t,e),r={index:t,startDate:i,endDate:o,taskRecord:n,ganttInstance:this};return this.parsedOptions.taskBarStyle(r)}return this.parsedOptions.taskBarStyle}},t.TYPES=r,t.VRender=EI,t.VTable=HI,t.tools=PI,t.version="1.17.6"}));
